<ng-container
  *erzLet="{
    tests: state.tests$ | async,
    studentGrades: state.studentGrades$ | async,
    filter: state.filter$ | async
  } as data"
>
  <div class="d-flex text-justify justify-content-start mt-3 mb-2">
    <p
      class="d-flex btn desktop"
      (click)="changeFilter('all-tests')"
      [ngClass]="{
        'btn-primary': data.filter === 'all-tests',
        'btn-outline-primary': data.filter !== 'all-tests'
      }"
    >
      {{ 'tests.all-tests' | translate }}
    </p>
    <p
      class="d-flex btn ml-3 desktop"
      (click)="changeFilter('my-tests')"
      [ngClass]="{
        'btn-primary': data.filter === 'my-tests',
        'btn-outline-primary': data.filter !== 'my-tests'
      }"
    >
      {{ 'tests.owned-tests' | translate }}
    </p>
  </div>
  <table class="table table-hover">
    <thead>
      <tr>
        <th class="primary-column-width" (click)="state.sortBy('FullName')">
          <div class="d-flex">
            <div class="column-title">
              {{ 'tests.student.name' | translate }}
            </div>
            <div class="sort-direction">
              {{ state.getSortingChar$('FullName') | async }}
            </div>
          </div>
        </th>
        <th class="secondary-column-width desktop">
          {{ 'tests.grade' | translate }}
        </th>
        <th class="secondary-column-width border-right desktop">
          {{ 'tests.average' | translate }}
        </th>
        <th
          *ngFor="let test of data.tests"
          container="body"
          (click)="state.sortBy(test)"
          [ngbTooltip]="tooltipTests"
          tooltipClass="tooltip-template"
          class="grade"
          [ngClass]="test.Id === selectedTest.Id ? 'selected' : ''"
        >
          <div class="d-flex">
            <div class="column-title">
              <span class="desktop">{{ test.Designation }}</span>
              <span class="mobile">{{ 'tests.grade' | translate }}</span>
            </div>
            <div class="sort-direction">
              {{ state.getSortingChar$(test) | async }}
            </div>
          </div>

          <ng-template #tooltipTests>
            <div class="d-flex flex-column align-items-start">
              <div>{{ test.Designation }}</div>
              <div>{{ test.Date | date: 'dd.MM.yyyy' }}</div>
              <div>
                {{ test | erzTestWeight }}, {{ test | erzTestGradingType }}
              </div>
              <div *ngIf="test.IsPublished; else notPublished">
                <div class="d-flex align-items-end">
                  <i class="material-icons tooltip-published-icon">lock</i>
                  {{ 'tests.published' | translate }}
                </div>
              </div>
              <ng-template #notPublished>
                <div class="d-flex align-items-end">
                  <i class="material-icons tooltip-published-icon">lock_open</i>
                  {{ 'tests.not-published' | translate }}
                </div>
              </ng-template>
            </div>
          </ng-template>
        </th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let studentGrade of data.studentGrades">
        <td>
          {{ studentGrade.student.FullName }}
          <p class="mobile">Mittelwert: 5.15</p>
        </td>
        <td class="grade"></td>
        <td class="grade border-right"></td>
        <td
          *ngFor="let grade of studentGrade.grades"
          class="grade"
          [ngClass]="
            grade.result?.TestId === selectedTest.Id ||
            grade.TestId === selectedTest.Id
              ? 'selected'
              : ''
          "
        >
          <erz-grade [grade]="grade"></erz-grade>
        </td>
      </tr>
      <tr>
        <td>{{ 'tests.average' | translate }}</td>
        <td class="desktop">4.75</td>
        <td class="desktop border-right">4.805</td>
        <td
          *ngFor="let test of data.tests"
          class="grade"
          [ngClass]="
            test.Id === selectedTest.Id || test.Id === selectedTest.Id
              ? 'selected'
              : ''
          "
        >
          <div class="d-flex flex-row w-100">
            <span *ngIf="test.IsPointGrading" class="w-25">20.16</span>
            <span>4.733</span>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</ng-container>
