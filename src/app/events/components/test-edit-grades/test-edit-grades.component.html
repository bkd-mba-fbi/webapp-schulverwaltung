<ng-container
  *erzLet="{
    tests: state.tests$ | async,
    studentGrades: state.studentGrades$ | async,
    filter: state.filter$ | async,
    expanded: state.expandedHeader$ | async
  } as data"
>
  <div class="d-flex text-justify justify-content-start mt-3 mb-2">
    <p
      class="d-flex btn desktop"
      (click)="changeFilter('all-tests')"
      [ngClass]="{
        'btn-primary': data.filter === 'all-tests',
        'btn-outline-primary': data.filter !== 'all-tests'
      }"
    >
      {{ 'tests.all-tests' | translate }}
    </p>
    <p
      class="d-flex btn ml-3 desktop"
      (click)="changeFilter('my-tests')"
      [ngClass]="{
        'btn-primary': data.filter === 'my-tests',
        'btn-outline-primary': data.filter !== 'my-tests'
      }"
    >
      {{ 'tests.owned-tests' | translate }}
    </p>
  </div>
  <table class="table table-hover h-100">
    <thead class="h-100">
      <tr class="h-100">
        <th class="primary-column-width desktop"></th>
        <th class="secondary-column-width desktop"></th>
        <th class="secondary-column-width border-right desktop"></th>
        <th
          *ngFor="let test of data.tests"
          container="body"
          class="grade h-100 test-info-desktop"
          [ngClass]="test.Id === selectedTest.Id ? 'selected' : ''"
        >
          <erz-test-table-header
            [test]="test"
            [expanded]="data.expanded"
            (toggle)="state.toggleHeader($event)"
          ></erz-test-table-header>
        </th>
        <th
          *ngFor="let test of data.tests"
          container="body"
          class="grade h-100 header-mobile test-info-mobile"
          colspan="3"
          [ngClass]="test.Id === selectedTest.Id ? 'selected' : ''"
        >
          <erz-test-table-header
            [test]="test"
            [expanded]="data.expanded"
            (toggle)="state.toggleHeader($event)"
          ></erz-test-table-header>
        </th>
      </tr>
      <tr>
        <th class="primary-column-width" (click)="state.sortBy('FullName')">
          <div class="d-flex">
            <div class="column-title">
              {{ 'tests.student.name' | translate }}
            </div>
            <div class="sort-direction">
              {{ state.getSortingChar$('FullName') | async }}
            </div>
          </div>
        </th>
        <th class="secondary-column-width desktop">
          {{ 'tests.grade' | translate }}
        </th>
        <th class="secondary-column-width border-right desktop">
          {{ 'tests.average' | translate }}
        </th>
        <th
          *ngFor="let test of data.tests"
          container="body"
          class="grade h-100"
          [ngClass]="test.Id === selectedTest.Id ? 'selected' : ''"
        >
          <div class="d-flex">
            <div class="w-25 column-title" *ngIf="test.IsPointGrading">
              <span (click)="state.sortBy(test)">{{
                'tests.points' | translate
              }}</span>
            </div>
            <div class="column-title">
              <span (click)="state.sortBy(test)">{{
                'tests.grade' | translate
              }}</span>
            </div>
            <div class="sort-direction">
              {{ state.getSortingChar$(test) | async }}
            </div>
          </div>
        </th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let studentGrade of data.studentGrades">
        <td>
          <a [routerLink]="'#'">
            {{ studentGrade.student.FullName }}
            <p class="mobile">
              <a href=""> Mittelwert: 5.15 </a>
            </p>
          </a>
        </td>
        <td class="grade"></td>
        <td class="grade border-right"></td>
        <td
          *ngFor="let grade of studentGrade.grades"
          class="grade"
          [ngClass]="
            grade.result?.TestId === selectedTest.Id ||
            grade.TestId === selectedTest.Id
              ? 'selected'
              : ''
          "
        >
          <erz-grade [grade]="grade"></erz-grade>
        </td>
      </tr>
      <tr>
        <td>{{ 'tests.average' | translate }}</td>
        <td class="desktop">4.75</td>
        <td class="desktop border-right">4.805</td>
        <td
          *ngFor="let test of data.tests"
          class="grade"
          [ngClass]="
            test.Id === selectedTest.Id || test.Id === selectedTest.Id
              ? 'selected'
              : ''
          "
        >
          <div class="d-flex flex-row w-100">
            <span *ngIf="test.IsPointGrading" class="w-25">20.16</span>
            <span>4.733</span>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</ng-container>
