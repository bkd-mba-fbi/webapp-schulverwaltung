import{a as re,b as ve}from"./chunk-GZOANHXY.js";import{a as Cn,b as Pn}from"./chunk-YU2OE6DK.js";import{b as Sn}from"./chunk-EODBRHRQ.js";import{a as Vt,b as Ft,c as Je,d as At,e as Rt,g as vn}from"./chunk-GXPKR22I.js";import{a as yn}from"./chunk-VGYWDNUP.js";import{a as hn,b as fn}from"./chunk-WYN4IZCG.js";import{e as gn}from"./chunk-E4SARKOR.js";import{c as et,g as mn}from"./chunk-RDNZARDR.js";import"./chunk-6TCJNTKT.js";import{g as dn}from"./chunk-XWISOVKN.js";import{a as sn,b as an}from"./chunk-3DIISX7M.js";import"./chunk-6A3MULQJ.js";import{a as xn}from"./chunk-I75JD2K7.js";import{b as Ne,c as rn,e as He}from"./chunk-GOVFDFD6.js";import{B as on,C as ie,E as nt,G as un,H as _n,b as Wt,f as fe,g as Jt,k as Xt,l as Ue,p as je,q as Zt,r as en,s as Ze,x as nn}from"./chunk-BQGWWMPT.js";import{a as qt}from"./chunk-C4EQUSNO.js";import"./chunk-WORSXEGE.js";import{a as Gt,b as Nt,c as Ut,d as ge,e as ne}from"./chunk-6LRQCBUO.js";import"./chunk-Y4QYVF5K.js";import"./chunk-UOIIL2R2.js";import{e as zt,p as Yt}from"./chunk-JE6RMKPQ.js";import{i as Ge,j as q}from"./chunk-RXV77OBQ.js";import{c as Ot,f as Et,g as de,h as me,j as Bt,k as ue,z as ee}from"./chunk-M3VKTN3S.js";import{a as jt}from"./chunk-USF5QQBL.js";import{a as qe,b as bn}from"./chunk-QLQ6HFBO.js";import{a as te,d as _e}from"./chunk-RWAE7AP7.js";import"./chunk-GXPB5I4C.js";import"./chunk-D2H555EG.js";import{b as tt}from"./chunk-KZWEGXU2.js";import{a as tn}from"./chunk-YHCR7GAG.js";import"./chunk-KFP6476W.js";import{a as Kt,e as cn,f as pn,g as ln,i as Ce}from"./chunk-QWYAXZZX.js";import"./chunk-KKDVS2NL.js";import{b as Ht}from"./chunk-WNZFLLQC.js";import"./chunk-DVBPCEX4.js";import{b as Qt,d as Re}from"./chunk-GH7I4V3C.js";import{a as he}from"./chunk-M732YBIP.js";import{A as j,B as Xe,H as Ae,O as Me,e as Ye,i as kt,r as Ve,s as Lt,u as Fe}from"./chunk-RYYQAFJB.js";import{$b as y,A as ye,Ac as A,Ba as Y,Bc as J,C as ct,Cc as K,E as z,Ec as R,F as Pe,Fc as pe,Gc as we,Hb as T,Hc as X,Ib as Oe,Ic as Mt,J as pt,Ja as ut,Jb as I,Ka as gt,L as lt,Lb as ht,Lc as l,M as Se,Mb as D,Mc as d,Nb as O,Nc as G,O as $,Ob as b,Pb as a,Q as $e,Qb as c,Rb as U,Sb as Ee,Tb as xe,V as dt,W as mt,X as L,Xc as Tt,Y as ze,Z as De,Zd as $t,_ as M,_d as Dt,a as se,aa as V,b as ae,bc as _,cc as ft,dc as h,fb as s,h as w,ha as F,i as Le,ie as H,j as be,je as E,lc as Ct,ma as p,mc as _t,md as It,nc as vt,o as Q,pc as W,qc as ce,qd as Be,rc as m,sa as f,sc as S,t as g,ta as C,tc as v,td as Z,u as x,ub as k,uc as bt,ud as le,vc as yt,wc as Pt,xc as St,yc as xt,zc as wt}from"./chunk-CHBP6U4G.js";function wn(t){return Ge(t,Date.now())}function Mn(t,o){return+q(t)<+q(o)}function Tn(t,o){return+q(t)==+q(o)}function In(t,o){return Ne(Ge(o?.in||t,t),wn(o?.in||t))}function kn(t,o,e){let n=+q(t,e?.in),[i,r]=[+q(o.start,e?.in),+q(o.end,e?.in)].sort((u,P)=>u-P);return n>=i&&n<=r}function Ln(t,o,e){let n=o.map(r=>({eventId:r,group:t})),i=e.map(r=>n.find(u=>u.eventId===r.eventId)||r);return[...new Set([...i,...n])].filter(r=>r.group!==null)}var it=(()=>{class t extends nn{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=gt(t)))(i||t)}})()}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();function $n(t,o){return o?[...t].sort(ei(o)):t}function ei(t){return(o,e)=>{switch(t.primarySortKey){case"name":{let n=o.name.localeCompare(e.name);return t.ascending?n:n*-1}case"group":{let n=o.detail.Value?String(o.detail.Value):"",i=e.detail.Value?String(e.detail.Value):"",r=n.localeCompare(i);return t.ascending?r:r*-1}default:throw new tn(t.primarySortKey,"Unhandled sort criteria")}}}function Dn(t,o){return t.map(e=>ti(e,o))}function ti(t,o){return{id:t.IdPerson,name:o.find(e=>e.StudentRef.Id===t.IdPerson)?.StudentFullName||"",group:t.Value?String(t.Value):"",detail:t}}function On(t,o){return t.filter(e=>e.VssId===o.subscriptionDetailGroupId)}function ot(t,o){return t.find(e=>e.VssId===o.subscriptionDetailGroupId)}var En="presence-control-group",oe=(()=>{class t{constructor(){this.userSettings=p(ve),this.eventService=p(bn),this.subscriptionDetailsService=p(qe),this.loadingService=p(ne),this.settings=p(j),this.selectGroup$=new w,this.selectedLesson$=new be,this.lessonPresences$=new be,this.reloadSubscriptionDetails$=new w,this.defaultGroup=null,this.savedGroup$=this.selectedLesson$.pipe(M(e=>this.userSettings.getPresenceControlGroupView().pipe(g(n=>this.findGroupByLesson(n,e))))),this.group$=z(this.selectGroup$,this.savedGroup$).pipe(De(this.defaultGroup),L(1)),this.loading$=this.loadingService.loading(En),this.subscriptionDetailsDefinitions$=this.selectedLesson$.pipe(g(e=>e?.getEventIds()||[]),M(e=>ye(e.map(n=>this.eventService.getSubscriptionDetailsDefinitions(n)))),L(1)),this.groupsAvailability$=this.subscriptionDetailsDefinitions$.pipe(g(e=>e.every(n=>ot(n,this.settings))),L(1)),this.subscriptionDetails$=x([this.selectedLesson$,this.groupsAvailability$,this.reloadSubscriptionDetails$.pipe(g(()=>!1),De(!0))]).pipe(M(([e,n,i])=>e&&n?this.loadSubscriptionDetailsForLesson(e,i):Q([])),g(e=>On(e,this.settings)),L(1)),this.subscriptionDetailPersonIds$=x([this.group$,this.subscriptionDetails$]).pipe(g(([e,n])=>n.filter(i=>i.Value===e).map(i=>i.IdPerson)),De([]))}selectGroup(e){this.selectGroup$.next(e)}setSelectedLesson(e){this.selectedLesson$.next(e)}setLessonPresences(e){this.lessonPresences$.next(e)}getSubscriptionDetailsDefinitions(){return this.subscriptionDetailsDefinitions$.pipe(g(Xe),g(e=>ot(e,this.settings)))}getSubscriptionDetailsForStudents(){return x([this.subscriptionDetails$,this.lessonPresences$]).pipe(g(ie(Dn)))}reloadSubscriptionDetails(){this.reloadSubscriptionDetails$.next(void 0)}loadSubscriptionDetailsForLesson(e,n=!0){return this.loadingService.load(ye(Me(e.getEventIds()).map(i=>this.subscriptionDetailsService.getListForEvent(i))),n?void 0:En).pipe(g(Xe))}findGroupByLesson(e,n){return e.find(r=>r.eventId===n?.getEventIds()[0])?.group||this.defaultGroup}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();var Bn=(()=>{class t extends Kt{constructor(){let e=p(kt),n=p(j);super(e,n,et,"LessonTeachers")}loadOtherTeachersLessonAbsences(e,n,i){let r=Jt(new Date,60),u=`${this.baseUrl}/except/${e}/LessonAbsences?expand=LessonRef&filter.CreatedOn=>${Dt(r)}`;return n&&n.length>0&&(u=u.concat("&filter.StudentRef=;"+n.join(";"))),this.http.get(u,{params:i}).pipe(M(Ht(et)))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Vn(t,o){return t===null&&o===null||t!==null&&o!==null&&t.TeacherInformation===o.TeacherInformation&&t.LessonDateTimeFrom.getTime()===o.LessonDateTimeFrom.getTime()&&t.LessonDateTimeTo.getTime()===o.LessonDateTimeTo.getTime()}function Fn(t){let o=new rt(t.TeacherInformation,t.LessonDateTimeFrom,t.LessonDateTimeTo);return o.addLesson(t),o}var rt=class{constructor(o,e,n){this.TeacherInformation=o,this.LessonDateTimeFrom=e,this.LessonDateTimeTo=n,this.lessons=[]}addLesson(o){this.lessons.some(e=>je(e,o))||(this.lessons.push(o),this.updateId(),this.updateStudyClassNumbers(),this.updateEventDesignations())}getIds(){return[...new Set(this.lessons.map(o=>o.LessonRef.Id))]}getEventIds(){return[...new Set(this.lessons.map(o=>o.EventRef.Id))]}updateId(){this.id=[...new Set(this.lessons.map(o=>o.LessonRef.Id).sort())].join("-")}updateStudyClassNumbers(){this.studyClassNumbers=[...new Set(this.lessons.map(o=>o.StudyClassNumber).sort((o,e)=>o.localeCompare(e)))].join(", ")}updateEventDesignations(){this.eventDesignations=[...new Set(this.lessons.map(o=>o.EventDesignation).sort())].join(", ")}};function An(t){return ni(t).reduce((o,e)=>{let n=o.find(r=>Vn(r,e));if(n)return n.addLesson(e),o;let i=Fn(e);return[...o,i]},[]).sort(Ze)}function Rn(t){if(t.length===0)return null;let o=new Date;if(t=[...t].sort(Ze),Ne(o,t[0].LessonDateTimeFrom)){for(let e of t)if(Mn(o,e.LessonDateTimeFrom)||kn(o,{start:e.LessonDateTimeFrom,end:e.LessonDateTimeTo}))return e;return t[t.length-1]}return t[0]}function ni(t){return t.reduce((o,e)=>o.some(n=>je(n,e))?o:[...o,e],[])}function Gn(t,o,e,n){return t.map(i=>{let r=o.find(u=>ii(u.presence,i));if(r){let u;return!r.newPresenceTypeId&&i.Comment?u=e.find(P=>P.IsComment)||null:u=e.find(P=>P.Id===r.newPresenceTypeId)||null,ae(se({},i),{TypeRef:oi(u),Date:null,Type:u?u.Designation:null,ConfirmationStateId:Ue(u,n)})}return i})}function ii(t,o){return t.LessonRef.Id===o.LessonRef.Id&&t.StudentRef.Id===o.StudentRef.Id}function oi(t){return{Id:t?t.Id:null,HRef:null}}function We(t){return o=>o.reduce((e,n)=>e+(n.presenceCategory===t?1:0),0)}function Nn(){return t=>t.reduce((o,e)=>o+(e.precedingAbsences&&e.precedingAbsences.length>0?1:0),0)}var Un=Object.values(re),N=(()=>{class t{constructor(){this.userSettings=p(ve),this.lessonPresencesService=p(He),this.lessonTeacherService=p(Bn),this.presenceTypesService=p(fe),this.groupService=p(oe),this.dropDownItemsService=p(qt),this.loadingService=p(ne),this.storageService=p(jt),this.settings=p(j),this.location=p(It),this.selectedDateSubject$=new Le(new Date),this.selectedDate$=this.selectedDateSubject$.asObservable().pipe(g(e=>zt(e)),$e(Ae)),this.viewModeSubject$=new w,this.viewMode$=z(this.viewModeSubject$,this.userSettings.getPresenceControlViewMode().pipe($(1))),this.lessons$=this.selectedDate$.pipe(M(e=>this.loadLessonsByDate(e)),L(1)),this.selectLessonId$=new w,this.selectLesson$=this.selectLessonId$.pipe(M(e=>this.getLessonById(e))),this.selectedLesson$=x([cn(this.selectLesson$.pipe($e((e,n)=>Ae(e,n))),pn(this.settings.lessonPresencesRefreshTime)),this.lessons$]).pipe(g(([e,n])=>n.find(i=>i.id===e.id)?e:null),L(1)),this.studyClassCount$=this.selectedLesson$.pipe(g(e=>e?.lessons.length||0)),this.updateLessonPresences$=new w,this.reloadLessonPresences$=new w,this.lessonPresences$=z(ln(this.selectedLesson$,this.reloadLessonPresences$).pipe(M(e=>e?this.loadLessonPresencesByLesson(e):Q([]))),this.updateLessonPresences$).pipe(L(1)),this.presenceTypes$=this.loadPresenceTypes().pipe(L(1)),this.reloadStudentIdsWithUnconfirmedAbsences$=new w,this.studentIdsWithUnconfirmedAbsences$=z(this.selectedDate$,this.selectedLesson$.pipe(ze(1)),this.reloadStudentIdsWithUnconfirmedAbsences$).pipe(M(()=>this.loadStudentIdsWithUnconfirmedAbsences()),L(1)),this.loading$=this.loadingService.loading$,this.absenceConfirmationStates$=this.dropDownItemsService.getAbsenceConfirmationStates().pipe(L(1)),this.studentIds$=this.lessonPresences$.pipe(g(e=>Me(e.map(n=>n.StudentRef.Id))),L(1)),this.otherTeachersAbsences$=x([this.studentIds$.pipe($e(Ae)),this.selectedDate$]).pipe(M(([e,n])=>e.length>0&&In(n)?this.lessonTeacherService.loadOtherTeachersLessonAbsences(this.getMyself(),e):Q([])),L(1)),this.groupsAvailability$=this.groupService.groupsAvailability$,this.presenceControlEntries$=x([this.selectedLesson$,this.lessonPresences$,this.presenceTypes$,this.absenceConfirmationStates$,this.otherTeachersAbsences$]).pipe(g(ie(Zt))),this.presenceControlEntriesByGroup$=x([this.groupService.group$,this.presenceControlEntries$,this.groupService.subscriptionDetailPersonIds$]).pipe(g(ie(Sn)),L(1)),this.presentCount$=this.presenceControlEntriesByGroup$.pipe(g(We("present"))),this.absentCount$=this.presenceControlEntriesByGroup$.pipe(g(We("absent"))),this.unapprovedCount$=this.presenceControlEntriesByGroup$.pipe(g(We("unapproved"))),this.absentPrecedingCount$=this.presenceControlEntriesByGroup$.pipe(g(Nn())),this.queryParamsString$=x([this.selectedDate$,this.selectedLesson$,this.viewMode$]).pipe(g(ie(this.buildQueryParams.bind(this))),g(an)),this.destroy$=new w,this.queryParamsString$.pipe(V(this.destroy$)).subscribe(e=>{this.location.replaceState("/presence-control",e),this.confirmBackLinkParams={returnparams:e}}),this.viewMode$.pipe(ze(1),M(e=>this.userSettings.savePresenceControlViewMode(e)),V(this.destroy$)).subscribe(),this.selectedLesson$.pipe(V(this.destroy$)).subscribe(e=>{this.groupService.setSelectedLesson(e)}),this.lessonPresences$.pipe(V(this.destroy$)).subscribe(e=>this.groupService.setLessonPresences(e))}ngOnDestroy(){this.destroy$.next()}setDate(e){this.selectedDateSubject$.next(e)}setLessonId(e){this.selectLessonId$.next(e)}setViewMode(e){this.viewModeSubject$.next(e)}updateLessonPresencesTypes(e){x([this.lessonPresences$.pipe($(1)),this.presenceTypes$.pipe($(1))]).pipe(g(([n,i])=>Gn(n,e,i,this.settings))).subscribe(n=>this.updateLessonPresences$.next(n))}getNextPresenceType(e){return this.presenceTypes$.pipe($(1),g(n=>e.getNextPresenceType(n)))}hasUnconfirmedAbsences(e){return this.studentIdsWithUnconfirmedAbsences$.pipe(g(n=>n.includes(e.lessonPresence.StudentRef.Id)))}updateAfterConfirm(){this.reloadLessonPresences$.next(),this.reloadStudentIdsWithUnconfirmedAbsences$.next()}loadLessonPresencesByLesson(e){return this.loadingService.load(this.lessonPresencesService.getListByLessons(e.lessons))}loadLessonsByDate(e){return this.loadingService.load(this.lessonPresencesService.getLessonsByDate(e)).pipe(g(An))}loadPresenceTypes(){return this.loadingService.load(this.presenceTypesService.presenceTypes$)}loadStudentIdsWithUnconfirmedAbsences(){return ct(0,this.settings.unconfirmedAbsencesRefreshTime||-1).pipe(M(()=>this.lessonPresencesService.getListOfUnconfirmed()),g(e=>Me(e.map(n=>n.StudentRef.Id))))}buildQueryParams(e,n,i){let r={date:Yt(e,"yyyy-MM-dd"),viewMode:i};return n&&(r.lesson=String(n.id)),r}getLessonById(e){let n=String(e);return this.lessons$.pipe(g(i=>n&&i.find(r=>r.id===n)||Rn(i)),Pe(Boolean))}getMyself(){let e=this.storageService.getPayload();return Number(e?.holder_id||e?.id_person)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();var ri=(t,o)=>o.id;function si(t,o){if(t&1){let e=y();a(0,"div",3)(1,"input",7),_("change",function(){let i=f(e).$implicit,r=h();return C(r.onSelectionChange(i))}),c(),a(2,"label",8),m(3),c()()}if(t&2){let e=o.$implicit,n=o.$index,i=h();s(),b("id",R("group-",n))("checked",e.id===i.selected.id)("value",e.id),s(),b("for",R("group-",n)),s(),v(" ",e.label," ")}}var Te=(function(t){return t.Select="select",t.Assign="assign",t})(Te||{}),jn=(()=>{class t{constructor(){this.activeModal=p(te),this.translate=p(H),this.groupOptions=[]}ngOnInit(){this.title=`presence-control.groups.${this.dialogMode}.title`;let e=this.createEmtpyOption();this.groupOptions=this.createGroupOptions(this.subscriptionDetailsDefinitions),this.groupOptions.unshift(e),this.selected=this.groupOptions.find(n=>n.id===this.group)||e}createEmtpyOption(){let e=this.dialogMode===Te.Select?"presence-control.groups.all":"presence-control.groups.none";return{id:null,label:this.translate.instant(e)}}createGroupOptions(e){return e.DropdownItems?e.DropdownItems.map(n=>({id:n.Key,label:`${this.translate.instant("presence-control.groups.group")} ${n.Value}`})):[]}getSelectedGroup(){return this.selected}onSelectionChange(e){this.selected=e}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-presence-control-group-dialog"]],inputs:{dialogMode:"dialogMode",subscriptionDetailsDefinitions:"subscriptionDetailsDefinitions",group:"group"},decls:15,vars:9,consts:[[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"form-check"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["type","radio","name","groups",1,"form-check-input",3,"change","id","checked","value"],[1,"form-check-label",3,"for"]],template:function(n,i){n&1&&(a(0,"div",0)(1,"h5",1),m(2),l(3,"translate"),c()(),a(4,"div",2)(5,"form"),D(6,si,4,7,"div",3,ri),c()(),a(8,"div",4)(9,"button",5),_("click",function(){return i.activeModal.dismiss()}),m(10),l(11,"translate"),c(),a(12,"button",6),_("click",function(){return i.activeModal.close(i.getSelectedGroup())}),m(13),l(14,"translate"),c()()),n&2&&(s(2),v(" ",d(3,3,i.title)," "),s(4),O(i.groupOptions),s(4),v(" ",d(11,5,"presence-control.groups.cancel")," "),s(3),v(" ",d(14,7,"presence-control.groups.save")," "))},dependencies:[ee,ue,de,me,E],encapsulation:2})}}return t})();var ai=()=>[],ci=()=>["/presence-control"],pi=(t,o)=>o.id;function li(t,o){if(t&1){let e=y();a(0,"bkd-sortable-header",11),l(1,"translate"),wt("sortCriteriaChange",function(i){f(e);let r=h();return xt(r.sortCriteria,i)||(r.sortCriteria=i),C(i)}),c()}if(t&2){let e=o.$implicit,n=h();b("ngClass",e)("label",d(1,4,"presence-control.groups.list.header."+e))("sortKey",e),St("sortCriteria",n.sortCriteria)}}function di(t,o){t&1&&U(0,"bkd-spinner")}function mi(t,o){t&1&&U(0,"bkd-spinner",17)}function ui(t,o){if(t&1){let e=y();a(0,"div",12)(1,"div",13)(2,"input",14,0),l(4,"async"),_("change",function(){let i=f(e).$implicit,r=h(2);return C(r.selectionService.toggle(i))}),c()(),a(5,"div",15),m(6),c(),a(7,"div",16)(8,"span"),m(9),c(),T(10,mi,1,0,"bkd-spinner",17),l(11,"async"),c()()}if(t&2){let e=o.$implicit,n=h(2);s(2),b("checked",d(4,4,n.selectionService.isSelected$(e))),s(4),v(" ",e.name," "),s(3),S(e.group?e.group:""),s(),I(d(11,6,n.groupService.loading$)?10:-1)}}function gi(t,o){if(t&1&&D(0,ui,12,8,"div",12,pi),t&2){h();let e=K(0);O(e)}}var hi=["name","group"],Hn=(()=>{class t{constructor(){this.route=p(Ve),this.state=p(N),this.selectionService=p(it),this.groupService=p(oe),this.userSettings=p(ve),this.subscriptionDetailService=p(qe),this.toastService=p(he),this.translate=p(H),this.modalService=p(_e),this.sortService=p(_n),this.sortKeys=hi,this.backlinkQueryParams$=this.route.queryParams.pipe(g(({returnparams:e})=>e),g(sn)),this.eventIds$=this.state.selectedLesson$.pipe(g(e=>e?.getEventIds()||[])),this.sortCriteria=this.sortService.sortCriteria,this.sortedEntries$=x([this.groupService.getSubscriptionDetailsForStudents(),this.sortService.sortCriteria$]).pipe(g(ie($n))),this.selected=[],this.sortService.sortCriteria.set({primarySortKey:"name",ascending:!0})}ngOnInit(){this.selectionService.selection$.subscribe(e=>this.selected=e)}selectGroup(){this.openGroupModal(Te.Select,this.selectCallback.bind(this))}assignGroup(){this.openGroupModal(Te.Assign,this.assignCallback.bind(this))}openGroupModal(e,n){x([this.groupService.getSubscriptionDetailsDefinitions(),this.groupService.group$]).pipe($(1)).subscribe(([i,r])=>{let u=this.modalService.open(jn);u.componentInstance.dialogMode=e,u.componentInstance.subscriptionDetailsDefinitions=i,u.componentInstance.group=r,u.result.then(P=>{n(P)},()=>{})})}selectCallback(e){x([this.eventIds$,this.userSettings.getPresenceControlGroupView()]).pipe($(1),M(([n,i])=>this.userSettings.savePresenceControlGroupView(Ln(e.id,n,i))),g(()=>e.id)).subscribe(n=>this.groupService.selectGroup(n))}assignCallback(e){ye(this.selected.map(n=>this.subscriptionDetailService.update(n.detail,e.id))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.groupService.reloadSubscriptionDetails(),this.selectionService.clear(),this.toastService.success(this.translate.instant("presence-control.groups.notifications.save-success"))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-presence-control-group"]],features:[pe([it])],decls:31,vars:29,consts:[["checkbox",""],[3,"link","params"],[1,"group-header","mb-2","d-flex","justify-content-between"],[1,"d-flex","align-items-baseline"],[1,"ps-3"],["type","button",1,"show","btn","btn-link",3,"click"],["aria-label","edit",1,"btn","btn-primary","btn-icon","me-2",3,"click"],[1,"material-icons"],[1,"group-list"],[1,"group-list-header"],[3,"ngClass","label","sortKey","sortCriteria"],[3,"sortCriteriaChange","ngClass","label","sortKey","sortCriteria"],[1,"group-list-entry"],[1,"checkbox"],["type","checkbox",1,"form-check-input",3,"change","checked"],[1,"name","pe-2"],[1,"group","d-flex","justify-content-between"],[1,"inline","small"]],template:function(n,i){if(n&1){let r=y();A(0),l(1,"async"),A(2),l(3,"async"),A(4),l(5,"async"),a(6,"div"),U(7,"bkd-backlink",1),l(8,"async"),a(9,"h1"),m(10),l(11,"translate"),c(),a(12,"div",2)(13,"div",3)(14,"span",4),m(15),l(16,"translate"),c(),a(17,"button",5),_("click",function(){return f(r),C(i.selectGroup())}),m(18),l(19,"translate"),l(20,"translate"),c()(),a(21,"a",6),_("click",function(){return f(r),C(i.assignGroup())}),a(22,"i",7),m(23,"edit"),c()()(),a(24,"div",8)(25,"div",9),D(26,li,2,6,"bkd-sortable-header",10,ht),c(),T(28,di,1,0,"bkd-spinner"),l(29,"async"),Oe(30,gi,2,0),c()()}if(n&2){J(d(1,8,i.sortedEntries$));let r=d(3,11,i.selectionService.selection$)??we(27,ai),u=d(5,13,i.groupService.group$);s(7),b("link",we(28,ci))("params",d(8,15,i.backlinkQueryParams$)),s(3),S(d(11,17,"presence-control.groups.title")),s(5),S(d(16,19,"presence-control.groups.show")),s(3),v(" ",u?d(19,21,"presence-control.groups.group")+" "+u:d(20,23,"presence-control.groups.all")," "),s(3),W("disabled",r.length===0),s(5),O(i.sortKeys),s(2),I(d(29,25,i.state.loading$)?28:30)}},dependencies:[un,Ce,yn,Be,Z,E],styles:['[_nghost-%COMP%]{display:block}.group-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#000;font-weight:300;text-decoration:underline;padding-left:.5rem}.group-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.group-list-header[_ngcontent-%COMP%]{cursor:pointer;padding:1rem;display:grid;grid-template-areas:"name group";grid-template-columns:3fr 2fr;border-top:1px solid #dee2e6;border-bottom:2px solid #dee2e6}.group-list-entry[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox name group";grid-template-columns:min-content 3fr 2fr}.checkbox[_ngcontent-%COMP%]{grid-area:checkbox;margin:0;padding:.3rem 1rem 0 0}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.name[_ngcontent-%COMP%]{grid-area:name;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.group[_ngcontent-%COMP%]{grid-area:group}@media(max-width:750px){.group-list[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.group-list-header[_ngcontent-%COMP%]{grid-template-columns:3fr 1fr}.group-list-entry[_ngcontent-%COMP%]{grid-template-columns:min-content 3fr 1fr}}'],changeDetection:0})}}return t})();var fi=20,Ci=100,Ie=(function(t){return t.AddUpdateAction="ADD",t.RemoveUpdateAction="REMOVE",t})(Ie||{}),Ke=(()=>{class t{constructor(){this.toastService=p(he),this.translate=p(H),this.restService=p(Wt),this.presenceTypesService=p(fe),this.settings=p(j),this.destroy$=new w,this.action$=new w,this.pendingUpdates$=this.action$.pipe(dt(this.reduceUpdates.bind(this),[]),mt()),this.revertUpdates$=new w,this.performUpdates$=this.pendingUpdates$.pipe(Se(Ci),Pe(Re(nt)),lt(this.performUpdates.bind(this))),this.stateUpdates$=z(this.pendingUpdates$,this.revertUpdates$).pipe(Se(fi),Pe(Re(nt))),this.performUpdates$.pipe(V(this.destroy$)).subscribe()}ngOnDestroy(){this.destroy$.next()}updatePresenceType(e,n=null){this.dispatchAddUpdate(e.lessonPresence,n)}performUpdates(e){let n=this.groupUpdates(e);return x(Object.keys(n).reduce((i,r)=>{let u=n[r];return Object.keys(u).forEach(P=>{let ke=u[P];i.push(this.performUpdateForGroup(ke))}),i},[])).pipe(g(()=>n))}performUpdateForGroup(e){return e.forEach(n=>this.dispatchRemoveUpdate(n.presence)),this.performLessonPresencesUpdatesByIds(e[0].presence.LessonRef.Id,e.map(n=>n.presence.StudentRef.Id),e[0].newPresenceTypeId).pipe(pt(n=>this.revertUpdatesAfterError(e,n)))}performLessonPresencesUpdatesByIds(e,n,i=null){return i?(i?this.presenceTypesService.getPresenceType(i):Q(null)).pipe(M(u=>this.restService.editLessonPresences([e],n,u?.Id,Ue(u,this.settings)||void 0,{context:new Ye().set(tt,{disableErrorHandling:!0})}))):this.restService.removeLessonPresences([e],n,{context:new Ye().set(tt,{disableErrorHandling:!0})})}revertUpdatesAfterError(e,n){return console.error("Bulk-update of lesson presences failed"),console.error(n),this.toastService.error(this.translate.instant("shared.lesson-presences-update.error")),this.revertUpdates$.next(e.map(i=>ae(se({},i),{newPresenceTypeId:i.presence.TypeRef.Id}))),Q(void 0)}groupUpdates(e){return e.reduce((n,i)=>{let r=String(i.newPresenceTypeId&&i.newPresenceTypeId);return n[r]||(n[r]={}),Array.isArray(n[r][i.presence.LessonRef.Id])||(n[r][i.presence.LessonRef.Id]=[]),n[r][i.presence.LessonRef.Id].push(i),n},{})}reduceUpdates(e,n){switch(n.type){case Ie.AddUpdateAction:{let{presence:i,newPresenceTypeId:r}=n.payload,u=e.findIndex(qn(i));return u===-1?[...e,{presence:i,newPresenceTypeId:r}]:[...e.slice(0,u),{presence:e[u].presence,newPresenceTypeId:r},...e.slice(u+1)]}case Ie.RemoveUpdateAction:return e.filter(Re(qn(n.payload)));default:return e}}dispatchAddUpdate(e,n){this.action$.next({type:Ie.AddUpdateAction,payload:{presence:e,newPresenceTypeId:n}})}dispatchRemoveUpdate(e){this.action$.next({type:Ie.RemoveUpdateAction,payload:e})}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function qn(t){return o=>o.presence.LessonRef.Id===t.LessonRef.Id&&o.presence.StudentRef.Id===t.StudentRef.Id}var _i=30;function at(t){return`blockLesson${t.lessonPresence.Id}`}var Qe=(()=>{class t{constructor(){this.state=p(N),this.lessonPresencesService=p(He),this.loadingService=p(ne),this.settings=p(j)}getBlockLessonPresenceControlEntries(e){return x([this.state.lessons$.pipe($(1)),this.loadChangeableLessonPresences(e),this.state.presenceTypes$.pipe($(1)),this.state.absenceConfirmationStates$.pipe($(1)),this.state.otherTeachersAbsences$.pipe($(1))]).pipe(g(([n,i,r,u,P])=>this.filterBlockLessonPresences(e,i).map(ke=>en(n.find(Zn=>Zn.id===ke.LessonRef.Id.toString()),ke,r,u,P))))}filterBlockLessonPresences(e,n){return[...n].sort((i,r)=>i.LessonDateTimeFrom>r.LessonDateTimeFrom?1:-1).reduce((i,r)=>{let u=i[i.length-1];return this.isWithinBlockTime(r,u)?(i.push(r),i):i.find(P=>P.Id===e.lessonPresence.Id)?i:[r]},[])}isWithinBlockTime(e,n){return n?e.LessonDateTimeFrom.getTime()-n.LessonDateTimeTo.getTime()<=_i*60*1e3:!0}loadChangeableLessonPresences(e){return x([this.loadLessonPresences(e),this.state.presenceTypes$.pipe($(1))]).pipe(g(([n,i])=>n.filter(r=>Xt(r,i.find(u=>u.Id===r.TypeRef.Id)||null,this.settings))))}loadLessonPresences(e){return this.loadingService.load(this.lessonPresencesService.getListByDateStudentClass(e.lessonPresence.LessonDateTimeFrom,e.lessonPresence.StudentRef.Id,e.lessonPresence.StudyClassRef.Id??void 0).pipe(g(n=>n.filter(i=>i.TeacherInformation===e.lessonPresence.TeacherInformation))),at(e))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=F({token:t,factory:t.\u0275fac})}}return t})();var vi=(t,o)=>o.entry.id;function bi(t,o){if(t&1){let e=y();a(0,"div",1)(1,"input",5),_("change",function(){let i=f(e).$implicit;return C(i.selected=!i.selected)}),c(),a(2,"label",6)(3,"i"),m(4),c(),a(5,"div",7),m(6),l(7,"date"),l(8,"date"),c()()()}if(t&2){let e=o.$implicit,n=o.$index,i=h();s(),b("id",R("lesson-presence-",n))("checked",e.selected),s(),W("fw-bold",i.isCurrentLesson(e)),b("for",R("lesson-presence-",n)),s(),ce(R("",e.entry.presenceCategory," material-icons pe-2")),s(),S(e.entry.presenceCategoryIcon),s(2),yt(" ",G(7,14,e.entry.lessonPresence.LessonDateTimeFrom,"HH:mm"),"\u2013",G(8,17,e.entry.lessonPresence.LessonDateTimeTo,"HH:mm")," ",e.entry.lessonPresence.EventDesignation," ")}}var Wn=(()=>{class t{constructor(){this.activeModal=p(te),this.blockLessonOptions=[]}ngOnInit(){this.blockLessonOptions=this.buildLessonPresenceOptions()}getSelectedEntries(){return this.blockLessonOptions.filter(({selected:e})=>e).map(({entry:e})=>e)}isCurrentLesson(e){return Tn(e.entry.lessonPresence.LessonDateTimeFrom,this.entry.lessonPresence.LessonDateTimeFrom)}buildLessonPresenceOptions(){return this.blockPresenceControlEntries.map(e=>({entry:e,selected:this.entry.confirmationState===e.confirmationState}))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-presence-control-block-lesson-component"]],inputs:{entry:"entry",blockPresenceControlEntries:"blockPresenceControlEntries"},decls:15,vars:11,consts:[[1,"modal-body"],[1,"form-check"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["type","checkbox",1,"form-check-input",3,"change","id","checked"],[1,"form-check-label","d-flex",3,"for"],[1,"d-block","text-truncate"]],template:function(n,i){if(n&1){let r=y();a(0,"div",0)(1,"p"),m(2),l(3,"translate"),c(),a(4,"form"),D(5,bi,9,20,"div",1,vi),c()(),A(7),a(8,"div",2)(9,"button",3),_("click",function(){return f(r),C(i.activeModal.close())}),m(10),l(11,"translate"),c(),a(12,"button",4),_("click",function(){f(r);let P=K(7);return C(i.activeModal.close(P))}),m(13),l(14,"translate"),c()()}if(n&2){s(2),v(" ",d(3,4,"presence-control.block-lesson.text")," "),s(3),O(i.blockLessonOptions),s(2);let r=J(i.getSelectedEntries());s(3),v(" ",d(11,7,"presence-control.block-lesson.cancel")," "),s(2),b("disabled",r.length===0),s(),v(" ",d(14,9,"presence-control.block-lesson.save")," ")}},dependencies:[ee,ue,de,me,le,E],styles:[".checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.absent[_ngcontent-%COMP%]{color:#ea161f}.present[_ngcontent-%COMP%]{color:#3d8608}.unapproved[_ngcontent-%COMP%]{color:#ffa814}"]})}}return t})();var yi=(t,o)=>o.Id;function Pi(t,o){if(t&1&&(Ee(0,"div"),m(1),l(2,"date"),l(3,"date"),l(4,"addSpace"),xe()),t&2){let e=o.$implicit;s(),Pt(" ",G(2,5,e.LessonRef.From,"HH:mm"),"\u2013",G(3,8,e.LessonRef.To,"HH:mm")," ",e.LessonRef.EventDesignation,"",G(4,11,":",":")," ",e.Type," ")}}var Kn=(()=>{class t{constructor(){this.activeModal=p(te)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-presence-control-preceding-absence"]],inputs:{precedingAbsences:"precedingAbsences"},decls:10,vars:6,consts:[[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"]],template:function(n,i){n&1&&(Ee(0,"div",0)(1,"p"),m(2),l(3,"translate"),xe(),D(4,Pi,5,14,"div",null,yi),xe(),Ee(6,"div",1)(7,"button",2),ft("click",function(){return i.activeModal.dismiss()}),m(8),l(9,"translate"),xe()()),n&2&&(s(2),v(" ",d(3,2,"presence-control.preceding-absence.text")," "),s(2),O(i.precedingAbsences),s(4),v(" ",d(9,4,"presence-control.preceding-absence.cancel")," "))},dependencies:[le,E,mn],encapsulation:2})}}return t})();var Si=t=>["student",t,"absences"],xi=t=>["/presence-control/student",t,"absences"];function wi(t,o){if(t&1&&(U(0,"bkd-avatar",0),l(1,"async")),t&2){let e=h();b("studentId",d(1,3,e.studentId$))("link",X(5,xi,e.entry.lessonPresence.StudentRef.Id.toString()))("linkParams",e.profileReturnParams)}}function Mi(t,o){if(t&1&&(a(0,"span"),m(1),c()),t&2){let e=h(2);s(),S(e.entry.presenceType==null?null:e.entry.presenceType.Designation)}}function Ti(t,o){if(t&1){let e=y();a(0,"button",12),_("click",function(){f(e);let i=h();return C(i.updatePresenceType(i.entry))}),T(1,Mi,2,1,"span"),c()}if(t&2){let e=h();s(),I(e.entry.presenceType!=null&&e.entry.presenceType.IsIncident?-1:1)}}function Ii(t,o){t&1&&U(0,"bkd-spinner",5)}function ki(t,o){if(t&1){let e=y();a(0,"button",13),_("click",function(){f(e);let i=h();return C(i.showPrecedingAbsences(i.entry))}),a(1,"i",14),m(2,"info"),c()()}}function Li(t,o){if(t&1&&(a(0,"span",9),m(1),c()),t&2){let e=h();s(),v(" ",e.entry.lessonPresence.StudyClassNumber," ")}}function $i(t,o){if(t&1){let e=y();a(0,"a",15),_("click",function(){f(e);let i=h();return C(i.updateIncident(i.entry))}),a(1,"i",4),m(2,"edit"),c(),a(3,"span"),m(4),l(5,"translate"),c()()}if(t&2){let e=h();s(4),S(d(5,1,(e.entry.presenceType==null?null:e.entry.presenceType.IsIncident)&&(e.entry.presenceType==null?null:e.entry.presenceType.Designation)||"presence-control.entry.incident"))}}var Qn=(()=>{class t{constructor(){this.toastService=p(he),this.translate=p(H),this.modalService=p(_e),this.loadingService=p(ne),this.hasUnconfirmedAbsences=!1,this.showClassName=!1,this.togglePresenceType=new Y,this.changeIncident=new Y,this.entry$=new be(1),this.studentId$=this.entry$.pipe(g(({lessonPresence:e})=>e.StudentRef.Id)),this.loading$=this.entry$.pipe(M(e=>this.loadingService.loading(at(e))))}get classNames(){return[this.entry.presenceCategory,this.viewMode].join(" ")}ngOnChanges(e){e.entry&&this.entry$.next(e.entry.currentValue)}get isListViewMode(){return this.viewMode===re.List}updatePresenceType(e){e.canChangePresenceType?this.togglePresenceType.emit(e):this.toastService.warning(this.translate.instant("presence-control.entry.update-warning"))}updateIncident(e){e.canChangeIncident&&this.changeIncident.emit(e)}showPrecedingAbsences(e){let n=this.modalService.open(Kn);n.componentInstance.precedingAbsences=e.precedingAbsences}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-presence-control-entry"]],hostVars:2,hostBindings:function(n,i){n&2&&ce(i.classNames)},inputs:{entry:"entry",hasUnconfirmedAbsences:"hasUnconfirmedAbsences",viewMode:"viewMode",showClassName:"showClassName",profileReturnParams:"profileReturnParams"},outputs:{togglePresenceType:"togglePresenceType",changeIncident:"changeIncident"},features:[ut],decls:18,vars:20,consts:[[1,"avatar","large",3,"studentId","link","linkParams"],["type","button",1,"presence-category","designation","btn","btn-link"],["type","button",1,"presence-category","status","btn","btn-link",3,"click","disabled"],[1,"position-relative"],[1,"material-icons"],[1,"inline","small"],["type","button",1,"previously-absent","d-flex","btn","btn-link"],[1,"student-info",3,"routerLink","queryParams"],[1,"student-name","text-truncate"],[1,"study-class","text-truncate"],[1,"unconfirmed-absences"],[1,"incident","btn","btn-link"],["type","button",1,"presence-category","designation","btn","btn-link",3,"click"],["type","button",1,"previously-absent","d-flex","btn","btn-link",3,"click"],[1,"material-icons-outlined"],[1,"incident","btn","btn-link",3,"click"]],template:function(n,i){if(n&1){let r=y();T(0,wi,2,7,"bkd-avatar",0),T(1,Ti,2,1,"button",1),A(2),l(3,"async"),a(4,"button",2),_("click",function(){return f(r),C(i.updatePresenceType(i.entry))}),a(5,"div",3)(6,"i",4),m(7),c(),T(8,Ii,1,0,"bkd-spinner",5),c()(),T(9,ki,3,0,"button",6),a(10,"a",7)(11,"span",8),m(12),c(),T(13,Li,2,1,"span",9),a(14,"span",10),m(15),l(16,"translate"),c()(),T(17,$i,6,3,"a",11)}if(n&2){I(i.isListViewMode?-1:0),s(),I(i.entry.showDesignation?1:-1);let r=d(3,14,i.loading$);s(3),b("disabled",r),s(2),W("invisible",r),s(),S(i.entry.presenceCategoryIcon),s(),I(r?8:-1),s(),I(i.entry.precedingAbsences!=null&&i.entry.precedingAbsences.length?9:-1),s(),b("routerLink",X(18,Si,i.entry.lessonPresence.StudentRef.Id))("queryParams",i.profileReturnParams),s(2),S(i.entry.lessonPresence.StudentFullName),s(),I(i.isListViewMode&&i.showClassName?13:-1),s(2),v(" ",i.hasUnconfirmedAbsences?d(16,16,"presence-control.entry.unconfirmed-absences"):""," "),s(2),I(i.entry.canChangeIncident?17:-1)}},dependencies:[gn,Ce,Fe,Z,E],styles:['[_nghost-%COMP%]{padding:2rem 1rem;background-color:#fff;display:grid;grid-template-areas:"avatar status designation previously-absent" "avatar student-info student-info student-info" "avatar incident incident incident";grid-template-columns:min-content min-content 3fr min-content}[_nghost-%COMP%] > *[_ngcontent-%COMP%]{align-self:center}.presence-category[_ngcontent-%COMP%]{text-decoration:none}.presence-category[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{top:.1875rem}.absent[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#ea161f}.present[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#3d8608}.unapproved[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#ffa814}.presence-category[_ngcontent-%COMP%]   bkd-spinner[_ngcontent-%COMP%]{color:#000;position:absolute;top:4px;left:5px}.designation[_ngcontent-%COMP%], .student-info[_ngcontent-%COMP%], a.incident[_ngcontent-%COMP%], .incident[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.avatar[_ngcontent-%COMP%]{grid-area:avatar;margin-right:1.5rem}.status[_ngcontent-%COMP%]{grid-area:status}.status[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:2rem}.designation[_ngcontent-%COMP%]{grid-area:designation;text-align:left;line-height:2.375rem}.previously-absent[_ngcontent-%COMP%]{grid-area:previously-absent;text-decoration:none;color:#00000080;justify-self:end}.student-info[_ngcontent-%COMP%]{grid-area:student-info;display:flex;flex-direction:column;text-decoration:none}.student-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{text-decoration:underline}.student-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}.unconfirmed-absences[_ngcontent-%COMP%]{color:#ea161f;font-size:.875rem;line-height:1}.study-class[_ngcontent-%COMP%]{font-size:.875rem;line-height:1}.incident[_ngcontent-%COMP%]{color:#00000080;padding-right:1.5rem;grid-area:incident;display:flex;text-decoration:none}.incident[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.incident[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.incident[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.3em}.grid[_nghost-%COMP%]   .status[_ngcontent-%COMP%], .grid[_nghost-%COMP%]   .designation[_ngcontent-%COMP%]{align-self:start;margin-left:-1.5rem;margin-top:-.375rem}.grid[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{align-self:end;margin-left:-1.5rem;margin-bottom:-.375rem}.grid[_nghost-%COMP%]   .previously-absent[_ngcontent-%COMP%]{padding-right:0;align-self:start}.grid[_nghost-%COMP%]   .unconfirmed-absences[_ngcontent-%COMP%]{height:.875rem}.list[_nghost-%COMP%]{grid-template-areas:"student-info status incidentordesignation previously-absent";grid-template-columns:3fr min-content 4fr 3em;padding:.5rem 1rem}.list[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{justify-self:start}.list[_nghost-%COMP%]   .student-name[_ngcontent-%COMP%]{line-height:1;margin-bottom:.5rem}.list[_nghost-%COMP%]   .incident[_ngcontent-%COMP%], .list[_nghost-%COMP%]   .designation[_ngcontent-%COMP%]{grid-area:incidentordesignation}.list[_nghost-%COMP%]   .previously-absent[_ngcontent-%COMP%]{padding-right:0}@media(max-width:750px){.list[_nghost-%COMP%]{grid-template-areas:"student-info student-info student-info previously-absent" "status incidentordesignation incidentordesignation incidentordesignation";grid-template-columns:min-content 1fr 1fr min-content;row-gap:1rem}.list[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.list[_nghost-%COMP%]   .student-name[_ngcontent-%COMP%]{margin-top:.5rem}.list[_nghost-%COMP%]   .previously-absent[_ngcontent-%COMP%]{align-self:start}}']})}}return t})();var Di=(t,o)=>({"btn-link":t,"btn-danger":o}),Oi=t=>["groups",t],Ei=t=>({returnparams:t}),Bi=(t,o)=>o.viewMode,Vi=(t,o)=>o.id;function Fi(t,o){if(t&1){let e=y();a(0,"div",22),_("click",function(){let i;f(e);let r=h();return C((i=r.lessonDropdown())==null?null:i.toggle())}),m(1),l(2,"date"),a(3,"span",23),m(4),l(5,"date"),c()()}if(t&2){let e=h();s(),v(" ",G(2,2,e.selectedLesson.LessonDateTimeFrom,"HH:mm"),"\u2013"),s(3),S(G(5,5,e.selectedLesson.LessonDateTimeTo,"HH:mm"))}}function Ai(t,o){if(t&1){let e=y();a(0,"div",28),_("click",function(){let i=f(e).$implicit,r=h(2);return C(r.selectLessonChange.emit(i))}),a(1,"div",29)(2,"div"),m(3),l(4,"date"),l(5,"date"),c(),a(6,"div",25),m(7),c(),a(8,"div",25),m(9),c()()()}if(t&2){let e=o.$implicit,n=h(2);W("active",e.id===n.selectedLesson.id),s(3),bt(" ",G(4,6,e.LessonDateTimeFrom,"HH:mm"),"\u2013",G(5,9,e.LessonDateTimeTo,"HH:mm")," "),s(4),v(" ",e.eventDesignations," "),s(2),v(" ",e.studyClassNumbers," ")}}function Ri(t,o){if(t&1&&(a(0,"div",7)(1,"div",24)(2,"div",25),m(3),c(),a(4,"div",25),m(5),c()(),a(6,"div",26),D(7,Ai,10,12,"div",27,Vi),c()()),t&2){let e=h();s(3),S(e.selectedLesson.eventDesignations),s(2),S(e.selectedLesson.studyClassNumbers),s(2),O(e.lessons)}}function Gi(t,o){if(t&1){let e=y();a(0,"bkd-caret",30),_("click",function(){let i;f(e);let r=h();return C((i=r.lessonDropdown())==null?null:i.toggle())}),c()}if(t&2){let e,n=h();b("expanded",((e=n.lessonDropdown())==null?null:e.isOpen())||!1)}}function Ni(t,o){if(t&1&&(a(0,"a",19),l(1,"async"),l(2,"async"),l(3,"async"),a(4,"i",31),m(5,"groups"),c()()),t&2){let e=h();b("ngClass",Mt(9,Di,d(1,3,e.isGroupSelected$)===!1,d(2,5,e.isGroupSelected$)))("routerLink",X(12,Oi,e.selectedLesson.id))("queryParams",X(14,Ei,d(3,7,e.state.queryParamsString$)))}}function Ui(t,o){if(t&1){let e=y();a(0,"button",32),_("click",function(){let i=f(e).$implicit,r=h();return C(r.viewModeChange.emit(i.viewMode))}),a(1,"i",31),m(2),c()()}if(t&2){let e=o.$implicit,n=h();W("btn-outline-secondary",e.viewMode===n.viewMode)("btn-link",e.viewMode!==n.viewMode)("active",e.viewMode===n.viewMode),b("disabled",!n.selectedLesson),s(2),S(e.icon)}}var ji=ge.prototype._positionMenu;ge.prototype._positionMenu=function(...o){let e=ji.apply(this,o);if(this._anchor.nativeElement.id==="lesson-dropdown"){let n=this._bodyContainer||this._menu.nativeElement,i=n.style.transform?.match(/translate\(([0-9-.]+)px, ([0-9-.]+)px\)/);i&&parseFloat(i[1])<0&&(n.style.transform=`translate(0px, ${i[2]}px)`)}return e};var Hi=1e3,zn=(()=>{class t{constructor(){this.state=p(N),this.groupService=p(oe),this.presentCount=null,this.absentCount=null,this.unapprovedCount=null,this.absentPrecedingCount=null,this.search="",this.selectLessonChange=new Y,this.selectDateChange=new Y,this.searchChange=new Y,this.viewModeChange=new Y,this.dateSubject=new w,this.destroy$=new w,this.lessonDropdown=Tt(ge),this.viewModeOptions=[{viewMode:re.List,icon:"list"},{viewMode:re.Grid,icon:"view_module"}],this.isGroupSelected$=this.groupService.group$.pipe(g(Qt));let e=p(Je);e.popperOptions=n=>ae(se({},n),{modifiers:n.modifiers?.map(i=>(i.name==="offset"&&(i.options={offset:({placement:r,reference:u,popper:P})=>r==="bottom-start"?[(window.innerWidth-P.width)/2-u.x,0]:[]}),i))})}ngOnInit(){this.dateSubject.pipe(Se(Hi),V(this.destroy$)).subscribe(e=>{this.selectDateChange.emit(e)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onDateChange(e){e instanceof Date&&(e.getFullYear()<1e3&&e.setFullYear(e.getFullYear()+2e3),this.dateSubject.next(e))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-presence-control-header"]],viewQuery:function(n,i){n&1&&Ct(i.lessonDropdown,ge,5),n&2&&_t()},inputs:{selectedLesson:"selectedLesson",lessons:"lessons",presentCount:"presentCount",absentCount:"absentCount",unapprovedCount:"unapprovedCount",absentPrecedingCount:"absentPrecedingCount",viewMode:"viewMode",selectDate:"selectDate",search:"search"},outputs:{selectLessonChange:"selectLessonChange",selectDateChange:"selectDateChange",searchChange:"searchChange",viewModeChange:"viewModeChange"},features:[pe([Je,{provide:Vt,useClass:Rt},{provide:Ft,useClass:vn}])],decls:41,vars:19,consts:[["d","ngbDatepicker"],[1,"navigation"],[1,"lesson-date"],["type","button",1,"btn","btn-link",3,"click"],[1,"material-icons"],["positionTarget",".lesson-date-input","ngbDatepicker","","placement","bottom-start",1,"lesson-date-input",3,"ngModelChange","ngModel"],[1,"lesson-time"],["ngbDropdown","","container","body","display","dynamic","placement","bottom",1,"lesson-description"],[1,"dropdown-caret",3,"expanded"],[1,"states"],[1,"state","present"],[1,"count"],[1,"state","absent"],[1,"state","unapproved"],[1,"state","previously-absent"],[1,"material-icons-outlined"],[1,"search-and-views"],[1,"search",3,"valueChange","value","disabled","placeholder","label"],[1,"group-and-views","d-flex","align-items-center"],["type","button",1,"group","btn","me-2","me-sm-4",3,"ngClass","routerLink","queryParams"],[1,"views"],["type","button",1,"view","btn","btn-primary","btn-icon",3,"disabled","btn-outline-secondary","btn-link","active"],[1,"lesson-time",3,"click"],[1,"lesson-time-to"],["id","lesson-dropdown","ngbDropdownToggle",""],[1,"text-truncate"],["ngbDropdownMenu","","aria-labelledby","lesson-dropdown"],["ngbDropdownItem","",3,"active"],["ngbDropdownItem","",3,"click"],[1,"lesson-entry"],[1,"dropdown-caret",3,"click","expanded"],[1,"material-icons","align-middle"],["type","button",1,"view","btn","btn-primary","btn-icon",3,"click","disabled"]],template:function(n,i){if(n&1){let r=y();a(0,"div",1)(1,"div",2)(2,"button",3),_("click",function(){f(r);let P=vt(6);return C(P.toggle())}),a(3,"i",4),m(4,"calendar_today"),c()(),a(5,"input",5,0),_("ngModelChange",function(P){return f(r),C(i.onDateChange(P))}),c()(),T(7,Fi,6,8,"div",6),T(8,Ri,9,2,"div",7),T(9,Gi,1,1,"bkd-caret",8),c(),a(10,"div",9)(11,"div",10)(12,"i",4),m(13,"check_circle"),c(),a(14,"span",11),m(15),c()(),a(16,"div",12)(17,"i",4),m(18,"cancel"),c(),a(19,"span",11),m(20),c()(),a(21,"div",13)(22,"i",4),m(23,"help"),c(),a(24,"span",11),m(25),c()(),a(26,"div",14)(27,"i",15),m(28,"info"),c(),a(29,"span",11),m(30),c()()(),a(31,"div",16)(32,"bkd-resettable-input",17),l(33,"translate"),l(34,"translate"),_("valueChange",function(P){return f(r),C(i.searchChange.emit(P))}),c(),a(35,"div",18),T(36,Ni,6,16,"a",19),l(37,"async"),a(38,"div",20),D(39,Ui,3,8,"button",21,Bi),c()()()}n&2&&(s(5),b("ngModel",i.selectDate),s(2),I(i.selectedLesson?7:-1),s(),I(i.selectedLesson?8:-1),s(),I(i.lessons.length>0?9:-1),s(6),S(i.presentCount!==null?i.presentCount:"?"),s(5),S(i.absentCount!==null?i.absentCount:"?"),s(5),S(i.unapprovedCount!==null?i.unapprovedCount:"?"),s(5),S(i.absentPrecedingCount!==null?i.absentPrecedingCount:"?"),s(2),b("value",i.search)("disabled",!i.selectedLesson)("placeholder",d(33,13,"presence-control.header.search-by-name"))("label",d(34,15,"presence-control.header.search")),s(4),I(d(37,17,i.selectedLesson&&i.state.groupsAvailability$)?36:-1),s(3),O(i.viewModeOptions))},dependencies:[At,ee,Ot,Et,Bt,ge,Ut,Nt,Gt,dn,Pn,Be,Fe,Z,le,E],styles:['[_nghost-%COMP%]{display:flex;flex-direction:column;padding:.75rem 0}.navigation[_ngcontent-%COMP%]{display:grid;grid-template-areas:". date time dropdown-caret" ". description description dropdown-caret";grid-template-columns:1fr auto auto 1fr;align-items:center}.lesson-date[_ngcontent-%COMP%]{grid-area:date;justify-self:end;display:flex;align-items:center;justify-content:flex-end}.lesson-date[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0 .5ch 0 0}.lesson-date[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#000;position:relative}.lesson-date-input[_ngcontent-%COMP%]{font-weight:600;background:transparent;border:none;width:11ch}.lesson-time[_ngcontent-%COMP%]{grid-area:time;cursor:pointer}.lesson-description[_ngcontent-%COMP%]{grid-area:description;overflow:hidden;text-align:center;cursor:pointer}.dropdown-toggle[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.dropdown-caret[_ngcontent-%COMP%]{grid-area:dropdown-caret;line-height:100%;text-align:left;color:#000}.dropdown-menu[_ngcontent-%COMP%]{width:50ch;padding:0;box-shadow:2px 2px 3px -1px #0003}@media(max-width:800px){.dropdown-menu[_ngcontent-%COMP%]{width:100vw}}.dropdown-item[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #dee2e6}.states[_ngcontent-%COMP%]{margin:.75rem 0;display:flex;justify-content:center}.state[_ngcontent-%COMP%]{margin-right:7%;display:flex}.state[_ngcontent-%COMP%]:last-child{margin-right:0}@media(min-width:1000px){.state[_ngcontent-%COMP%]{margin-right:4rem}}.state.present[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#3d8608}.state.absent[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#ea161f}.state.unapproved[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#ffa814}.state.previously-absent[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#00000080}.state[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{margin-left:.3em;margin-top:1px}.search-and-views[_ngcontent-%COMP%]{padding-top:.75rem;display:flex;justify-content:space-between;border-top:1px solid #dee2e6}.search[_ngcontent-%COMP%]{flex:auto;max-width:300px;margin-right:1rem}.views[_ngcontent-%COMP%]{display:flex}.view[_ngcontent-%COMP%]{color:#4e4e4ef2;background-color:#fff}.view.active[_ngcontent-%COMP%]{color:#fff;background-color:#4e4e4ef2;border:none}.group[_ngcontent-%COMP%], .view[_ngcontent-%COMP%]{text-decoration:none;padding-left:0;padding-right:0;aspect-ratio:1/1;width:calc(.75rem + 2 * var(--bs-border-width) + 1.625rem);border-radius:50%}.group.btn-link[_ngcontent-%COMP%]{color:#000}@media(max-width:380px){[_nghost-%COMP%]{padding-left:.5rem;padding-right:.5rem}#search-addon[_ngcontent-%COMP%]{padding-left:.5rem;padding-right:.5rem}}@media(max-width:365px){.lesson-time[_ngcontent-%COMP%]{line-height:1}.lesson-time-to[_ngcontent-%COMP%]{display:block}.dropdown-caret[_ngcontent-%COMP%]{padding-left:0}}']})}}return t})();var qi=(t,o)=>o.id;function Wi(t,o){if(t&1){let e=y();a(0,"div",3)(1,"input",7),_("change",function(){let i=f(e).$implicit,r=h();return C(r.onSelectionChange(i))}),c(),a(2,"label",8),m(3),c()()}if(t&2){let e=o.$implicit,n=o.$index,i=h();s(),b("id",R("incident-",n))("checked",e.id===i.selected.id)("value",e.id),s(),b("for",R("incident-",n)),s(),v(" ",e.label," ")}}var Yn=(()=>{class t{constructor(){this.activeModal=p(te),this.translate=p(H),this.incidentOptions=[]}ngOnInit(){let e=this.createIncidentOption();this.incidentOptions=this.incidentTypes.map(n=>this.createIncidentOption(n)),this.incidentOptions.unshift(e),this.selected=this.incidentOptions.find(n=>n.id===this.incident?.Id)||e}createIncidentOption(e){return{id:e?e.Id:null,label:e?e.Designation:this.translate.instant("presence-control.incident.no-incident")}}onSelectionChange(e){this.selected=e}getSelectedIncident(){return this.incidentTypes.find(e=>e.Id===this.selected?.id)||null}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-presence-control-incident"]],inputs:{incident:"incident",incidentTypes:"incidentTypes"},decls:15,vars:9,consts:[[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"form-check"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["type","radio","name","incident",1,"form-check-input",3,"change","id","checked","value"],[1,"form-check-label",3,"for"]],template:function(n,i){n&1&&(a(0,"div",0)(1,"h5",1),m(2),l(3,"translate"),c()(),a(4,"div",2)(5,"form"),D(6,Wi,4,7,"div",3,qi),c()(),a(8,"div",4)(9,"button",5),_("click",function(){return i.activeModal.dismiss()}),m(10),l(11,"translate"),c(),a(12,"button",6),_("click",function(){return i.activeModal.close(i.getSelectedIncident())}),m(13),l(14,"translate"),c()()),n&2&&(s(2),v(" ",d(3,3,"presence-control.incident.text")," "),s(4),O(i.incidentOptions),s(4),v(" ",d(11,5,"presence-control.incident.cancel")," "),s(3),v(" ",d(14,7,"presence-control.incident.save")," "))},dependencies:[ee,ue,de,me,E],encapsulation:2})}}return t})();var Ki=()=>[],Qi=t=>({returnparams:t}),zi=(t,o)=>o.id;function Yi(t,o){t&1&&U(0,"bkd-spinner")}function Ji(t,o){t&1&&(a(0,"p",1),m(1),l(2,"translate"),c()),t&2&&(s(),S(d(2,1,"presence-control.no-lessons")))}function Xi(t,o){t&1&&(a(0,"p",1),m(1),l(2,"translate"),c()),t&2&&(s(),v(" ",d(2,1,"presence-control.no-lesson-presences")," "))}function Zi(t,o){if(t&1){let e=y();a(0,"bkd-presence-control-entry",4),l(1,"async"),l(2,"async"),l(3,"async"),l(4,"async"),_("togglePresenceType",function(i){f(e);let r=h(3);return C(r.togglePresenceType(i))})("changeIncident",function(i){f(e);let r=h(3);return C(r.changeIncident(i))}),c()}if(t&2){let e=o.$implicit,n=h(3);b("entry",e)("hasUnconfirmedAbsences",d(1,5,n.state.hasUnconfirmedAbsences(e)))("viewMode",d(2,7,n.state.viewMode$))("showClassName",(d(3,9,n.state.studyClassCount$)??0)>1)("profileReturnParams",X(13,Qi,d(4,11,n.state.queryParamsString$)))}}function eo(t,o){if(t&1&&(a(0,"div"),l(1,"async"),D(2,Zi,5,15,"bkd-presence-control-entry",3,zi),c()),t&2){let e=h(2),n=K(4);ce(R("default-entries entries view-mode-",d(1,3,e.state.viewMode$))),s(2),O(n)}}function to(t,o){if(t&1){let e=y();a(0,"bkd-presence-control-header",0),l(1,"async"),l(2,"async"),l(3,"async"),l(4,"async"),l(5,"async"),l(6,"async"),l(7,"async"),_("searchChange",function(i){f(e);let r=h();return C(r.search$.next(i))})("viewModeChange",function(i){f(e);let r=h();return C(r.state.setViewMode(i))})("selectDateChange",function(i){f(e);let r=h();return C(r.state.setDate(i))})("selectLessonChange",function(i){f(e);let r=h();return C(r.state.setLessonId(i.id))}),c(),T(8,Ji,3,3,"p",1)(9,Xi,3,3,"p",1)(10,eo,4,5,"div",2)}if(t&2){let e=h(),n=K(0),i=K(2),r=K(4);b("selectedLesson",n)("lessons",i)("presentCount",d(1,10,e.state.presentCount$))("absentCount",d(2,12,e.state.absentCount$))("unapprovedCount",d(3,14,e.state.unapprovedCount$))("absentPrecedingCount",d(4,16,e.state.absentPrecedingCount$))("viewMode",d(5,18,e.state.viewMode$))("selectDate",d(6,20,e.state.selectedDate$))("search",d(7,22,e.search$)),s(8),I(n?r.length===0?9:10:8)}}var no=["studentFullName"],Jn=(()=>{class t{constructor(){this.state=p(N),this.blockLessons=p(Qe),this.lessonPresencesUpdateService=p(Ke),this.presenceTypesService=p(fe),this.modalService=p(_e),this.scrollPosition=p(xn),this.route=p(Ve),this.search$=new Le(""),this.entries$=x([this.state.presenceControlEntriesByGroup$,this.search$]).pipe(g(([e,n])=>Cn(e,no,n)),L(1)),this.destroy$=new w}ngOnInit(){this.route.queryParams.pipe(V(this.destroy$)).subscribe(this.restoreStateFromParams.bind(this))}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}doTogglePresenceType(e){e.forEach(n=>this.state.getNextPresenceType(n).subscribe(i=>this.lessonPresencesUpdateService.updatePresenceType(n,i?i.Id:null)))}togglePresenceType(e){this.blockLessons.getBlockLessonPresenceControlEntries(e).pipe($(1)).subscribe(n=>{if(n.length===1){let i=n[0];this.doTogglePresenceType([i])}else{let i=this.modalService.open(Wn);i.componentInstance.entry=e,i.componentInstance.blockPresenceControlEntries=n,i.result.then(r=>{r&&this.doTogglePresenceType(r)},()=>{})}})}updateIncident(e,n){this.lessonPresencesUpdateService.updatePresenceType(e,n)}changeIncident(e){this.presenceTypesService.incidentTypes$.subscribe(n=>{let i=this.modalService.open(Yn);i.componentInstance.incident=n.find(r=>r.Id===e.presenceType?.Id)||null,i.componentInstance.incidentTypes=n,i.result.then(r=>{this.updateIncident(e,r?.Id||null)},()=>{})})}restoreStateFromParams(e){e.date&&this.state.setDate($t(e.date));let n=String(e.lesson);n&&this.state.setLessonId(n),e.viewMode&&Un.includes(e.viewMode)&&this.state.setViewMode(e.viewMode)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-presence-control-list"]],decls:12,vars:16,consts:[[3,"searchChange","viewModeChange","selectDateChange","selectLessonChange","selectedLesson","lessons","presentCount","absentCount","unapprovedCount","absentPrecedingCount","viewMode","selectDate","search"],[1,"mt-3"],[3,"class"],[3,"entry","hasUnconfirmedAbsences","viewMode","showClassName","profileReturnParams"],[3,"togglePresenceType","changeIncident","entry","hasUnconfirmedAbsences","viewMode","showClassName","profileReturnParams"]],template:function(n,i){n&1&&(A(0),l(1,"async"),A(2),l(3,"async"),A(4),l(5,"async"),a(6,"h1"),m(7),l(8,"translate"),c(),T(9,Yi,1,0,"bkd-spinner"),l(10,"async"),Oe(11,to,11,24)),n&2&&(J(d(1,2,i.state.selectedLesson$)),s(2),J(d(3,5,i.state.lessons$)),s(2),J(d(5,8,i.entries$)??we(15,Ki)),s(3),S(d(8,11,"presence-control.title")),s(2),I(d(10,13,i.state.loading$)?9:11))},dependencies:[zn,Qn,Ce,Z,E],styles:["bkd-presence-control-entry[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6}.entries.view-mode-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(400px,1fr))}.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{border-right:1px solid #dee2e6}[_nghost-%COMP%]{display:block;overflow:hidden;width:100%}.entries.view-mode-grid[_ngcontent-%COMP%]{width:calc(100% + 1px)}"],changeDetection:0})}}return t})();var Xn=(()=>{class t{constructor(){this.state=p(N),this.lessonPresencesUpdateService=p(Ke),this.destroy$=new w}ngOnInit(){this.lessonPresencesUpdateService.stateUpdates$.pipe(V(this.destroy$)).subscribe(e=>this.state.updateLessonPresencesTypes(e))}ngOnDestroy(){this.destroy$.next()}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-presence-control"]],features:[pe([N,Qe,oe,on,{provide:rn,useExisting:N}])],decls:1,vars:0,template:function(n,i){n&1&&U(0,"router-outlet")},dependencies:[Lt],encapsulation:2,changeDetection:0})}}return t})();var wc=[{path:"",component:Xn,children:[{path:"",component:Jn,data:{restoreScrollPositionFrom:fn.map(t=>`/presence-control/student/:id/${t}`)}},hn,{path:"groups/:id",component:Hn}]}];export{wc as PRESENCE_CONTROL_ROUTES};
