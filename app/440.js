"use strict";(self.webpackChunkwebapp_schulverwaltung=self.webpackChunkwebapp_schulverwaltung||[]).push([[440],{440:(lt,S,r)=>{r.r(S),r.d(S,{EditAbsencesModule:()=>it});var D=r(9121),h=r(5357),I=r(9841),b=r(4782),p=r(4004),A=r(2722),k=r(7402),R=r(6478),B=r(5186),$=r(6649),x=r(8029),G=r(7746),e=r(5e3),g=r(9808),H=r(2024),V=r(4379),K=r(7129),q=r(6501),F=r(7639);let v=(()=>{class n extends $.f{constructor(t,s,a,o,l,d,m){super(t,s,a,o,"/edit-absences"),this.lessonPresencesService=l,this.presenceTypesService=d,this.dropDownItemsService=m,this.presenceTypes$=this.loadPresenceTypes().pipe((0,b.d)(1)),this.absenceConfirmationStates$=this.loadAbsenceConfirmationStates().pipe((0,p.U)(k.I),(0,b.d)(1)),this.presenceControlEntries$=(0,I.a)([this.entries$,this.presenceTypes$,this.absenceConfirmationStates$]).pipe((0,p.U)((0,R.h)(G.v)),(0,b.d)(1)),this.selected=[],this.queryParamsString$.pipe((0,A.R)(this.destroy$)).subscribe(L=>this.confirmBackLinkParams={returnparams:L})}resetSelection(){this.selected=[]}getInitialFilter(){return{student:null,educationalEvent:null,studyClass:null,dateFrom:null,dateTo:null,presenceTypes:null,confirmationStates:null,incidentTypes:null}}isValidFilter(t){return Boolean(t.student||t.educationalEvent||t.studyClass||t.dateFrom||t.dateTo||t.presenceTypes||t.confirmationStates||t.incidentTypes)}loadEntries(t,s,a){return this.loadingService.load(this.lessonPresencesService.getFilteredList(t,a,{sort:"StudentFullName.asc,LessonDateTimeFrom.asc"}),$.O)}buildParamsFromFilter(t){return(0,B.i)(t)}loadPresenceTypes(){return this.loadingService.load(this.presenceTypesService.activePresenceTypes$)}loadAbsenceConfirmationStates(){return this.loadingService.load(this.dropDownItemsService.getAbsenceConfirmationStates())}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(g.Ye),e.LFG(H.b),e.LFG(V.K),e.LFG(x.L),e.LFG(K.q),e.LFG(q.c),e.LFG(F.R))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();var X=r(3509),w=r(8109);let W=(()=>{class n{constructor(t){this.state=t}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(v))},n.\u0275cmp=e.Xpm({type:n,selectors:[["erz-edit-absences"]],features:[e._Bn([v,{provide:X.m,useExisting:v},{provide:w.b,useValue:"/edit-absences"}])],decls:1,vars:0,template:function(t,s){1&t&&e._UZ(0,"router-outlet")},directives:[h.lC],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),n})();var P=r(7579),f=r(5698),ee=r(4813),te=r(9300),ne=r(4343);let U=(()=>{class n extends ne.z{}return n.\u0275fac=function(){let i;return function(s){return(i||(i=e.n5z(n)))(s||n)}}(),n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();var J=r(6316),T=r(3978),se=r(3657),O=r(1104),C=r(1504),ie=r(8115),E=r(5803),ae=r(6124),_=r(7198),re=r(386),oe=r(77),ce=r(7283),Z=r(8995),le=r(6628),de=r(2859),pe=r(8781);let ue=(()=>{class n{constructor(t,s,a,o,l){this.studentsService=t,this.educationalEventsService=s,this.studyClassService=a,this.state=o,this.translate=l,this.filter={student:null,educationalEvent:null,studyClass:null,dateFrom:null,dateTo:null,presenceTypes:null,confirmationStates:null,incidentTypes:null},this.filterChange=new e.vpe,this.absenceConfirmationStatesGrouped$=this.state.absenceConfirmationStates$.pipe((0,p.U)(d=>(0,_.pt)(d,this.translate.instant("shared.multiselect.all-option")))),this.presenceTypesGrouped$=this.state.presenceTypes$.pipe((0,p.U)(d=>d.filter((0,T.ff)(E.C3)).filter((0,T.ff)(E.hm))),(0,p.U)(_.KV),(0,p.U)(_.nC),(0,p.U)(d=>(0,_.pt)(d,this.translate.instant("shared.multiselect.all-option")))),this.incidentTypesGrouped$=this.state.presenceTypes$.pipe((0,p.U)(d=>d.filter(E.hm)),(0,p.U)(_.KV),(0,p.U)(_.nC),(0,p.U)(d=>(0,_.pt)(d,this.translate.instant("shared.multiselect.all-option")))),this.classesHttpFilter={params:{fields:"IsActive","filter.IsActive":"=true"}}}show(){this.filterChange.emit(Object.assign(Object.assign({},this.filter),{dateFrom:N(this.filter.dateFrom),dateTo:N(this.filter.dateTo)}))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(re.l),e.Y36(oe.$),e.Y36(ce.R),e.Y36(v),e.Y36(Z.sK))},n.\u0275cmp=e.Xpm({type:n,selectors:[["erz-edit-absences-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},features:[e._Bn([{provide:C.DO,useClass:C.s5},{provide:C.NG,useClass:ae.n}])],decls:49,vars:48,consts:[[1,"filters","mb-2"],[1,"form-group"],[3,"typeaheadService","value","valueChange"],[3,"typeaheadService","value","additionalHttpParams","valueChange"],[3,"value","valueChange"],[1,"filters","mt-2"],[3,"options","values","valuesChange"],[1,"buttons"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"label"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"erz-typeahead",2),e.NdJ("valueChange",function(o){return s.filter.student=o}),e.qZA(),e.qZA(),e.TgZ(6,"div",1),e.TgZ(7,"label"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"erz-typeahead",2),e.NdJ("valueChange",function(o){return s.filter.educationalEvent=o}),e.qZA(),e.qZA(),e.TgZ(11,"div",1),e.TgZ(12,"label"),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"erz-typeahead",3),e.NdJ("valueChange",function(o){return s.filter.studyClass=o}),e.qZA(),e.qZA(),e.TgZ(16,"div",1),e.TgZ(17,"label"),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"erz-date-select",4),e.NdJ("valueChange",function(o){return s.filter.dateFrom=o}),e.qZA(),e.qZA(),e.TgZ(21,"div",1),e.TgZ(22,"label"),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.TgZ(25,"erz-date-select",4),e.NdJ("valueChange",function(o){return s.filter.dateTo=o}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(26,"div",5),e.TgZ(27,"div",1),e.TgZ(28,"label"),e._uU(29),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"erz-multiselect",6),e.NdJ("valuesChange",function(o){return s.filter.confirmationStates=o}),e.ALo(32,"async"),e.qZA(),e.qZA(),e.TgZ(33,"div",1),e.TgZ(34,"label"),e._uU(35),e.ALo(36,"translate"),e.qZA(),e.TgZ(37,"erz-multiselect",6),e.NdJ("valuesChange",function(o){return s.filter.presenceTypes=o}),e.ALo(38,"async"),e.qZA(),e.qZA(),e.TgZ(39,"div",1),e.TgZ(40,"label"),e._uU(41),e.ALo(42,"translate"),e.qZA(),e.TgZ(43,"erz-multiselect",6),e.NdJ("valuesChange",function(o){return s.filter.incidentTypes=o}),e.ALo(44,"async"),e.qZA(),e.qZA(),e.TgZ(45,"div",7),e.TgZ(46,"button",8),e.NdJ("click",function(){return s.show()}),e._uU(47),e.ALo(48,"translate"),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(3),e.Oqu(e.lcZ(4,24,"edit-absences.header.student")),e.xp6(2),e.Q6J("typeaheadService",s.studentsService)("value",s.filter.student),e.xp6(3),e.Oqu(e.lcZ(9,26,"edit-absences.header.module-instance")),e.xp6(2),e.Q6J("typeaheadService",s.educationalEventsService)("value",s.filter.educationalEvent),e.xp6(3),e.Oqu(e.lcZ(14,28,"edit-absences.header.study-class")),e.xp6(2),e.Q6J("typeaheadService",s.studyClassService)("value",s.filter.studyClass)("additionalHttpParams",s.classesHttpFilter),e.xp6(3),e.Oqu(e.lcZ(19,30,"edit-absences.header.date-from")),e.xp6(2),e.Q6J("value",s.filter.dateFrom),e.xp6(3),e.Oqu(e.lcZ(24,32,"edit-absences.header.date-to")),e.xp6(2),e.Q6J("value",s.filter.dateTo),e.xp6(4),e.Oqu(e.lcZ(30,34,"edit-absences.header.confirmation-state")),e.xp6(2),e.Q6J("options",e.lcZ(32,36,s.absenceConfirmationStatesGrouped$))("values",s.filter.confirmationStates),e.xp6(4),e.Oqu(e.lcZ(36,38,"edit-absences.header.presence-type")),e.xp6(2),e.Q6J("options",e.lcZ(38,40,s.presenceTypesGrouped$))("values",s.filter.presenceTypes),e.xp6(4),e.Oqu(e.lcZ(42,42,"edit-absences.header.incident")),e.xp6(2),e.Q6J("options",e.lcZ(44,44,s.incidentTypesGrouped$))("values",s.filter.incidentTypes),e.xp6(4),e.hij(" ",e.lcZ(48,46,"edit-absences.header.show")," "))},directives:[le.t,de.T,pe.z],pipes:[Z.X$,g.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1.5rem;border-bottom:1px solid #dee2e6}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.form-group[_ngcontent-%COMP%]{flex:1;min-width:20rem;max-width:40rem;margin-right:1.5rem;margin-bottom:.75rem}.buttons[_ngcontent-%COMP%]{flex:none;margin-top:2.75rem;margin-right:0}@media (max-width: 767.98px){.buttons[_ngcontent-%COMP%]{width:100%;margin-top:1.5rem;margin-bottom:1.5rem}}"],changeDetection:0}),n})();function N(n){return n?(0,ie.Z)(n):null}var me=r(8689),ge=r(2925);const z=function(n){return{count:n}},Y=function(n){return{returnparams:n}};function fe(n,i){if(1&n&&(e.TgZ(0,"div",12),e.TgZ(1,"div",13),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"async"),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"a",14),e.ALo(7,"async"),e.TgZ(8,"i",15),e._uU(9,"edit"),e.qZA(),e.qZA(),e.qZA()),2&n){const t=e.oxw(4).erzLet,s=e.oxw();e.xp6(2),e.AsE(" ",e.xi3(3,5,"edit-absences.list.total",e.VKq(15,z,e.lcZ(4,8,s.state.total$)||0)),", ",e.xi3(5,10,"edit-absences.list.selected",e.VKq(17,z,t.selection.length))," "),e.xp6(4),e.ekj("disabled",0===t.selection.length),e.Q6J("queryParams",e.VKq(19,Y,e.lcZ(7,13,s.state.queryParamsString$)))}}const he=function(n){return["student",n]};function _e(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"tr"),e.TgZ(1,"td",20),e.NdJ("click",function(a){e.CHM(t);const o=e.MAs(3);return e.oxw(6).onCheckboxCellClick(a,o)}),e.TgZ(2,"input",17,21),e.NdJ("change",function(){const o=e.CHM(t).$implicit;return e.oxw(6).selectionService.toggle(o.lessonPresence)}),e.ALo(4,"async"),e.qZA(),e.qZA(),e.TgZ(5,"td",18),e.ALo(6,"translate"),e.TgZ(7,"span",22),e.TgZ(8,"i",15),e._uU(9),e.qZA(),e.qZA(),e.qZA(),e.TgZ(10,"td"),e.ALo(11,"translate"),e.TgZ(12,"a",23),e.ALo(13,"async"),e._uU(14),e.qZA(),e._UZ(15,"br"),e._uU(16),e.qZA(),e.TgZ(17,"td"),e.ALo(18,"translate"),e._uU(19),e.ALo(20,"date"),e.qZA(),e.TgZ(21,"td"),e.ALo(22,"translate"),e._uU(23),e.ALo(24,"date"),e.ALo(25,"date"),e.qZA(),e.TgZ(26,"td"),e.ALo(27,"translate"),e._uU(28),e.qZA(),e.TgZ(29,"td",24),e.ALo(30,"translate"),e._uU(31),e.qZA(),e.TgZ(32,"td"),e.ALo(33,"translate"),e._uU(34),e.qZA(),e.qZA()}if(2&n){const t=i.$implicit,s=e.oxw(6);e.xp6(2),e.Q6J("checked",e.lcZ(4,21,s.selectionService.isSelected$(t.lessonPresence))),e.xp6(3),e.uIk("data-label",e.lcZ(6,23,"edit-absences.list.header.presence")),e.xp6(2),e.Q6J("className",t.presenceCategory),e.xp6(2),e.Oqu(t.presenceCategoryIcon),e.xp6(1),e.uIk("data-label",e.lcZ(11,25,"edit-absences.list.header.mobil-student-module-instance-study-class")),e.xp6(2),e.Q6J("routerLink",e.VKq(48,he,t.lessonPresence.StudentRef.Id))("queryParams",e.VKq(50,Y,e.lcZ(13,27,s.profileReturnParams$))),e.xp6(2),e.hij(" ",t.lessonPresence.StudentFullName," "),e.xp6(2),e.AsE(" ",t.lessonPresence.EventDesignation,", ",t.lessonPresence.StudyClassNumber," "),e.xp6(1),e.uIk("data-label",e.lcZ(18,29,"edit-absences.list.header.date")),e.xp6(2),e.hij(" ",e.xi3(20,31,t.lessonPresence.LessonDateTimeFrom,"mediumDate")," "),e.xp6(2),e.uIk("data-label",e.lcZ(22,34,"edit-absences.list.header.time")),e.xp6(2),e.AsE(" ",e.xi3(24,36,t.lessonPresence.LessonDateTimeFrom,"shortTime"),"\u2013",e.xi3(25,39,t.lessonPresence.LessonDateTimeTo,"shortTime")," "),e.xp6(3),e.uIk("data-label",e.lcZ(27,42,"edit-absences.list.header.confirmation-state")),e.xp6(2),e.hij(" ",null==t.confirmationState?null:t.confirmationState.Value," "),e.xp6(1),e.uIk("data-label",e.lcZ(30,44,"edit-absences.list.header.mobil-presence-type-incident")),e.xp6(2),e.hij(" ",null==t.presenceType?null:t.presenceType.Designation," "),e.xp6(1),e.uIk("data-label",e.lcZ(33,46,"edit-absences.list.header.teacher")),e.xp6(2),e.hij(" ",t.lessonPresence.TeacherInformation," ")}}function ve(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"table",16),e.TgZ(1,"thead"),e.TgZ(2,"tr"),e.TgZ(3,"th"),e.TgZ(4,"input",17),e.NdJ("change",function(a){return e.CHM(t),e.oxw(5).toggleAll(a.currentTarget.checked)}),e.qZA(),e.qZA(),e.TgZ(5,"th",18),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"th"),e._uU(9),e.ALo(10,"translate"),e._UZ(11,"br"),e._uU(12),e.ALo(13,"translate"),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"th"),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.TgZ(18,"th"),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"th"),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"th"),e._uU(25),e.ALo(26,"translate"),e.ALo(27,"translate"),e.qZA(),e.TgZ(28,"th"),e._uU(29),e.ALo(30,"translate"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(31,"tbody"),e.YNc(32,_e,35,52,"tr",19),e.qZA(),e.qZA()}if(2&n){const t=e.oxw(4).erzLet;e.xp6(4),e.Q6J("checked",t.selection.length===t.entries.length),e.xp6(2),e.hij(" ",e.lcZ(7,12,"edit-absences.list.header.presence")," "),e.xp6(3),e.hij(" ",e.lcZ(10,14,"edit-absences.list.header.student")," "),e.xp6(3),e.AsE(" ",e.lcZ(13,16,"edit-absences.list.header.module-instance"),", ",e.lcZ(14,18,"edit-absences.list.header.study-class")," "),e.xp6(4),e.hij(" ",e.lcZ(17,20,"edit-absences.list.header.date")," "),e.xp6(3),e.Oqu(e.lcZ(20,22,"edit-absences.list.header.time")),e.xp6(3),e.hij(" ",e.lcZ(23,24,"edit-absences.list.header.confirmation-state")," "),e.xp6(3),e.AsE(" ",e.lcZ(26,26,"edit-absences.list.header.presence-type")," / ",e.lcZ(27,28,"edit-absences.list.header.incident")," "),e.xp6(4),e.Oqu(e.lcZ(30,30,"edit-absences.list.header.teacher")),e.xp6(3),e.Q6J("ngForOf",t.entries)}}function be(n,i){1&n&&e._UZ(0,"erz-spinner",25)}function Ae(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"button",26),e.NdJ("click",function(){return e.CHM(t),e.oxw(5).state.nextPage()}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"global.pagination.load-more")," "))}function Ze(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",7),e.NdJ("scrolled",function(){return e.CHM(t),e.oxw(4).onScroll()}),e.YNc(1,fe,10,21,"div",8),e.YNc(2,ve,33,32,"table",9),e.YNc(3,be,1,0,"erz-spinner",10),e.YNc(4,Ae,3,3,"button",11),e.qZA()}if(2&n){const t=e.oxw(3).erzLet;e.xp6(1),e.Q6J("ngIf",t.entries&&t.entries.length>0),e.xp6(1),e.Q6J("ngIf",t.entries&&t.entries.length>0),e.xp6(1),e.Q6J("ngIf",t.loadingPage),e.xp6(1),e.Q6J("ngIf",t.hasMore&&!t.loadingPage)}}function ye(n,i){1&n&&(e.TgZ(0,"p",27),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"edit-absences.no-entries")))}function Te(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Ze,5,4,"div",5),e.YNc(2,ye,3,3,"ng-template",null,6,e.W1O),e.BQk()),2&n){const t=e.MAs(3),s=e.oxw(2).erzLet;e.xp6(1),e.Q6J("ngIf",s.entries&&s.entries.length>0||s.loadingPage)("ngIfElse",t)}}function xe(n,i){1&n&&e._UZ(0,"erz-spinner")}function Ce(n,i){if(1&n&&(e.ynx(0),e.YNc(1,Te,4,2,"ng-container",2),e.ALo(2,"async"),e.YNc(3,xe,1,0,"ng-template",null,4,e.W1O),e.BQk()),2&n){const t=e.MAs(4),s=e.oxw(2);e.xp6(1),e.Q6J("ngIf",!1===e.lcZ(2,2,s.state.loading$))("ngIfElse",t)}}function Ee(n,i){1&n&&(e.TgZ(0,"p",27),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"edit-absences.no-filter")))}function Le(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"erz-edit-absences-header",1),e.NdJ("filterChange",function(a){return e.CHM(t),e.oxw().state.setFilter(a)}),e.ALo(2,"async"),e.qZA(),e.YNc(3,Ce,5,4,"ng-container",2),e.ALo(4,"async"),e.YNc(5,Ee,3,3,"ng-template",null,3,e.W1O),e.BQk()}if(2&n){const t=e.MAs(6),s=e.oxw();e.xp6(1),e.Q6J("filter",e.lcZ(2,3,s.filterFromParams$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,5,s.state.isFilterValid$))("ngIfElse",t)}}const Se=function(n,i,t,s){return{selection:n,entries:i,hasMore:t,loadingPage:s}};let Ie=(()=>{class n{constructor(t,s,a,o){this.state=t,this.selectionService=s,this.scrollPosition=a,this.route=o,this.filterFromParams$=this.route.queryParams.pipe((0,p.U)($e)),this.profileReturnParams$=this.state.queryParamsString$,this.destroy$=new P.x}ngOnInit(){this.filterFromParams$.pipe((0,f.q)(1)).subscribe(t=>this.state.setFilter(t)),this.state.validFilter$.pipe((0,A.R)(this.destroy$)).subscribe(()=>this.selectionService.clear()),this.selectionService.selection$.pipe((0,A.R)(this.destroy$)).subscribe(t=>this.state.selected=t),this.route.queryParams.pipe((0,f.q)(1),(0,ee.j)("reload"),(0,te.h)(T.fQ)).subscribe(()=>this.state.resetEntries())}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}toggleAll(t){this.state.entries$.pipe((0,f.q)(1)).subscribe(s=>this.selectionService.clear(t?s:null))}onCheckboxCellClick(t,s){t.target!==s&&s.click()}onScroll(){this.state.nextPage()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(v),e.Y36(U),e.Y36(se.X),e.Y36(h.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["erz-edit-absences-list"]],features:[e._Bn([U])],decls:5,vars:14,consts:[[4,"erzLet"],[3,"filter","filterChange"],[4,"ngIf","ngIfElse"],["noFilter",""],["loading",""],["class","p-3","infiniteScroll","",3,"scrolled",4,"ngIf","ngIfElse"],["noEntries",""],["infiniteScroll","",1,"p-3",3,"scrolled"],["class","d-flex align-items-center justify-content-between",4,"ngIf"],["class","table table-striped",4,"ngIf"],["class","inline",4,"ngIf"],["type","button","class","btn btn-secondary btn-sm d-block mx-auto",3,"click",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between"],[1,"total"],["routerLink","/edit-absences/edit",1,"edit","btn","btn-primary","mt-1","mb-2",3,"queryParams"],[1,"material-icons"],[1,"table","table-striped"],["type","checkbox",3,"checked","change"],[1,"presence-category"],[4,"ngFor","ngForOf"],[1,"edit-absences-checkbox",3,"click"],["checkbox",""],[3,"className"],[1,"student",3,"routerLink","queryParams"],[1,"designation-incident"],[1,"inline"],["type","button",1,"btn","btn-secondary","btn-sm","d-block","mx-auto",3,"click"],[1,"mt-3","px-3"]],template:function(t,s){1&t&&(e.YNc(0,Le,7,7,"ng-container",0),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async"),e.ALo(4,"async")),2&t&&e.Q6J("erzLet",e.l5B(9,Se,e.lcZ(1,1,s.selectionService.selection$),e.lcZ(2,3,s.state.presenceControlEntries$),e.lcZ(3,5,s.state.hasMore$),e.lcZ(4,7,s.state.loadingPage$)))},directives:[O.e,ue,g.O5,me.R,h.yS,g.sg,ge.O],pipes:[g.Ov,Z.X$,g.uU],styles:[".edit[_ngcontent-%COMP%]{line-height:1;font-size:2.2rem}.presence-category[_ngcontent-%COMP%]{text-align:center}.presence-category[_ngcontent-%COMP%]   .absent[_ngcontent-%COMP%]{color:#dc3545}.presence-category[_ngcontent-%COMP%]   .present[_ngcontent-%COMP%]{color:#28a745}.presence-category[_ngcontent-%COMP%]   .unapproved[_ngcontent-%COMP%]{color:#ffa814}.designation-incident[_ngcontent-%COMP%]{max-width:50ch}.student[_ngcontent-%COMP%]{color:#33333d}@media screen and (max-width: 820px){.edit-absences-checkbox[_ngcontent-%COMP%]{text-align:left}.presence-category[_ngcontent-%COMP%]{text-align:right}.designation-incident[_ngcontent-%COMP%]{max-width:initial}}"],changeDetection:0}),n})();function $e(n){return{student:n.student?Number(n.student):null,educationalEvent:n.educationalEvent?Number(n.educationalEvent):null,studyClass:n.studyClass?Number(n.studyClass):null,dateFrom:n.dateFrom?(0,J.nx)(n.dateFrom):null,dateTo:n.dateTo?(0,J.nx)(n.dateTo):null,presenceTypes:n.presenceTypes?n.presenceTypes.split(",").map(Number):null,confirmationStates:n.confirmationStates?n.confirmationStates.split(",").map(Number):null,incidentTypes:n.incidentTypes?n.incidentTypes.split(",").map(Number):null}}var u=r(3075),Q=r(1135),qe=r(3900),Fe=r(8746),Pe=r(6569),Ue=r(9718),M=r(1363),Je=r(1694),c=(()=>{return(n=c||(c={})).Absent="absent",n.Dispensation="dispensation",n.HalfDay="half-day",n.Incident="incident",n.Present="present",c;var n})();let Oe=(()=>{class n{constructor(t,s){this.updateService=t,this.settings=s}update(t,s,a,o,l,d){let m=[];switch(a){case c.Present:m=this.createResetBulkRequests(t);break;case c.Absent:m=this.createAbsentEditBulkRequests(t,s,o,l);break;case c.Dispensation:m=this.createEditBulkRequests(t,null,this.settings.dispensationPresenceTypeId);break;case c.HalfDay:m=this.createEditBulkRequests(t,null,this.settings.halfDayPresenceTypeId);break;case c.Incident:m=this.createEditBulkRequests(t,null,d)}return(0,I.a)(m).pipe((0,Ue.h)(void 0))}createAbsentEditBulkRequests(t,s,a,o){return a===this.settings.excusedAbsenceStateId?this.createEditBulkRequests(t,a,o):a===this.settings.unexcusedAbsenceStateId?this.createEditBulkRequests(t,a,this.settings.absencePresenceTypeId):[...this.createEditBulkRequests(t.filter(j(s,this.settings)),a,this.settings.absencePresenceTypeId),...this.createEditBulkRequests(t.filter((0,T.ff)(j(s,this.settings))),a,null)]}createResetBulkRequests(t){return(0,M.fG)(t).map(({lessonIds:s,personIds:a})=>this.updateService.removeLessonPresences(s,a))}createEditBulkRequests(t,s,a){return(0,M.fG)(t).map(({lessonIds:o,personIds:l})=>this.updateService.editLessonPresences(o,l,a||void 0,s||void 0))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(Je.O),e.LFG(x.L))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function j(n,i){return t=>{const s=n.find(a=>a.Id===t.TypeRef.Id);return!s||s.Id===i.dispensationPresenceTypeId||s.Id===i.halfDayPresenceTypeId||s.IsIncident}}var y=r(2103),Ne=r(7832),ze=r(2290);function Ye(n,i){if(1&n&&(e.TgZ(0,"div",11),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=i.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,"global.validation-errors."+t.error,t.params)," ")}}function Qe(n,i){if(1&n&&(e.TgZ(0,"option",23),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.Q6J("ngValue",t.Id),e.xp6(1),e.hij(" ",t.Designation," ")}}function Me(n,i){if(1&n&&(e.TgZ(0,"select",22),e.ALo(1,"async"),e.TgZ(2,"option",23),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.YNc(5,Qe,2,2,"option",24),e.ALo(6,"async"),e.qZA()),2&n){const t=e.oxw(6);e.ekj("is-invalid",e.lcZ(1,5,t.absenceTypeIdErrors$).length>0),e.xp6(2),e.Q6J("ngValue",null),e.xp6(1),e.hij(" ",e.lcZ(4,7,"edit-absences.edit.absence-type-placeholder")," "),e.xp6(2),e.Q6J("ngForOf",e.lcZ(6,9,t.absenceTypes$))}}function je(n,i){if(1&n&&(e.TgZ(0,"div",25),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=i.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,"global.validation-errors."+t.error,t.params)," ")}}function De(n,i){if(1&n&&(e.TgZ(0,"div",18),e._UZ(1,"input",19),e.TgZ(2,"label",14),e._uU(3),e.qZA(),e.YNc(4,Me,7,11,"select",20),e.YNc(5,je,3,4,"div",21),e.ALo(6,"async"),e.qZA()),2&n){const t=i.$implicit,s=e.oxw(5);e.xp6(1),e.Q6J("id","state-"+t.Key)("value",t.Key),e.xp6(1),e.s9C("for","state-"+t.Key),e.xp6(1),e.hij(" ",t.Value," "),e.xp6(1),e.Q6J("ngIf",s.isExcused(t)),e.xp6(1),e.Q6J("ngForOf",e.lcZ(6,6,s.absenceTypeIdErrors$))}}function ke(n,i){if(1&n&&(e.TgZ(0,"div",16),e.YNc(1,De,7,8,"div",17),e.qZA()),2&n){const t=e.oxw(3).erzLet;e.xp6(1),e.Q6J("ngForOf",t.confirmationStates)}}function Re(n,i){if(1&n&&(e.TgZ(0,"option",23),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.Q6J("ngValue",t.Id),e.xp6(1),e.hij(" ",t.Designation," ")}}function Be(n,i){if(1&n&&(e.TgZ(0,"div",25),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=i.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,"global.validation-errors."+t.error,t.params)," ")}}function Ge(n,i){if(1&n&&(e.TgZ(0,"div",16),e.TgZ(1,"select",26),e.ALo(2,"async"),e.TgZ(3,"option",23),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.YNc(6,Re,2,2,"option",24),e.ALo(7,"async"),e.qZA(),e.YNc(8,Be,3,4,"div",21),e.ALo(9,"async"),e.qZA()),2&n){const t=e.oxw(4);e.xp6(1),e.ekj("is-invalid",e.lcZ(2,6,t.incidentIdErrors$).length>0),e.xp6(2),e.Q6J("ngValue",null),e.xp6(1),e.hij(" ",e.lcZ(5,8,"edit-absences.edit.incident-placeholder")," "),e.xp6(2),e.Q6J("ngForOf",e.lcZ(7,10,t.incidents$)),e.xp6(2),e.Q6J("ngForOf",e.lcZ(9,12,t.incidentIdErrors$))}}function He(n,i){if(1&n&&(e.TgZ(0,"div",12),e._UZ(1,"input",13),e.TgZ(2,"label",14),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.YNc(5,ke,2,1,"div",15),e.YNc(6,Ge,10,14,"div",15),e.qZA()),2&n){const t=i.$implicit,s=e.oxw(3);e.xp6(1),e.Q6J("id","category-"+t)("value",t),e.xp6(1),e.s9C("for","category-"+t),e.xp6(1),e.hij(" ",e.lcZ(4,6,"edit-absences.edit.categories."+t)," "),e.xp6(2),e.Q6J("ngIf",s.isAbsent(t)),e.xp6(1),e.Q6J("ngIf",s.isIncident(t))}}function Ve(n,i){1&n&&(e.TgZ(0,"div",27),e.TgZ(1,"span",28),e._uU(2,"Loading..."),e.qZA(),e.qZA())}function Ke(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"form",3),e.NdJ("ngSubmit",function(){return e.CHM(t),e.oxw(2).onSubmit()}),e.YNc(1,Ye,3,4,"div",4),e.ALo(2,"async"),e.TgZ(3,"div",5),e.YNc(4,He,7,8,"div",6),e.qZA(),e.TgZ(5,"div",7),e.TgZ(6,"button",8),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).cancel()}),e.ALo(7,"async"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"button",9),e.ALo(11,"async"),e._uU(12),e.ALo(13,"translate"),e.YNc(14,Ve,3,0,"div",10),e.ALo(15,"async"),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=e.oxw().erzLet,s=e.oxw();e.Q6J("formGroup",t.formGroup),e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,8,s.formErrors$)),e.xp6(3),e.Q6J("ngForOf",t.categories),e.xp6(2),e.Q6J("disabled",e.lcZ(7,10,s.saving$)),e.xp6(2),e.hij(" ",e.lcZ(9,12,"edit-absences.edit.cancel")," "),e.xp6(2),e.Q6J("disabled",e.lcZ(11,14,s.saving$)),e.xp6(2),e.hij(" ",e.lcZ(13,16,"edit-absences.edit.save")," "),e.xp6(2),e.Q6J("ngIf",e.lcZ(15,18,s.saving$))}}function Xe(n,i){if(1&n&&(e.TgZ(0,"div",1),e.YNc(1,Ke,16,20,"form",2),e.qZA()),2&n){const t=i.erzLet;e.xp6(1),e.Q6J("ngIf",t.formGroup&&t.confirmationStates)}}const we=function(n,i,t){return{confirmationStates:n,categories:i,formGroup:t}};let We=(()=>{class n{constructor(t,s,a,o,l,d,m,L,at,rt){this.fb=t,this.router=s,this.route=a,this.toastr=o,this.translate=l,this.state=d,this.dropDownItemsService=m,this.presenceTypesService=L,this.updateService=at,this.settings=rt,this.absenceTypes$=this.presenceTypesService.confirmationTypes$,this.incidents$=this.presenceTypesService.incidentTypes$,this.formGroup$=this.createFormGroup(),this.saving$=new Q.X(!1),this.submitted$=new Q.X(!1),this.formErrors$=(0,y.Z6)(this.formGroup$,this.submitted$),this.absenceTypeIdErrors$=(0,y.Z6)(this.formGroup$,this.submitted$,"absenceTypeId"),this.incidentIdErrors$=(0,y.Z6)(this.formGroup$,this.submitted$,"incidentId"),this.availableCategories=[c.Absent,c.Dispensation,c.HalfDay,c.Incident,c.Present],this.confirmationStates$=this.dropDownItemsService.getAbsenceConfirmationStates().pipe((0,p.U)(this.sortAbsenceConfirmationStates.bind(this)),(0,b.d)(1)),this.activeCategories$=this.presenceTypesService.halfDayActive$.pipe((0,p.U)(ot=>ot?this.availableCategories:this.availableCategories.filter(ct=>ct!==c.HalfDay))),this.destroy$=new P.x}ngOnInit(){0===this.state.selected.length&&this.navigateBack(),(0,y.ZX)(this.formGroup$,"category").pipe((0,A.R)(this.destroy$)).subscribe(this.updateConfirmationValueDisabled.bind(this)),(0,y.ZX)(this.formGroup$,"confirmationValue").pipe((0,A.R)(this.destroy$)).subscribe(this.updateAbsenceTypeIdDisabled.bind(this))}ngOnDestroy(){this.destroy$.next()}isAbsent(t){return t===c.Absent}isExcused(t){return t.Key===this.settings.excusedAbsenceStateId}isIncident(t){return t===c.Incident}onSubmit(){this.submitted$.next(!0),this.formGroup$.pipe((0,f.q)(1)).subscribe(t=>{t.valid&&this.save(t)})}cancel(){this.navigateBack()}createFormGroup(){return this.getInitialAbsenceTypeId().pipe((0,p.U)(t=>this.fb.group({category:[c.Absent,u.kI.required],confirmationValue:[this.settings.excusedAbsenceStateId,u.kI.required],absenceTypeId:[t,u.kI.required],incidentId:[{value:null,disabled:!0},u.kI.required]})),(0,b.d)(1))}getInitialAbsenceTypeId(){return this.absenceTypes$.pipe((0,f.q)(1),(0,p.U)(t=>{const s=t.map(o=>o.Id),a=(0,Pe.Z)(this.state.selected.map(o=>o.TypeRef.Id));return 1===a.length&&null!=a[0]&&s.includes(a[0])?a[0]:null}))}updateConfirmationValueDisabled(){this.formGroup$.pipe((0,f.q)(1)).subscribe(t=>{const s=t.get("category"),a=t.get("confirmationValue"),o=t.get("absenceTypeId"),l=t.get("incidentId");s&&a&&o&&l&&(s.value===c.Absent?(a.enable(),this.updateAbsenceTypeIdDisabled()):(a.disable(),o.disable()),s.value===c.Incident?l.enable():l.disable())})}updateAbsenceTypeIdDisabled(){this.formGroup$.pipe((0,f.q)(1)).subscribe(t=>{const s=t.get("confirmationValue"),a=t.get("absenceTypeId");s&&a&&(s.value===this.settings.excusedAbsenceStateId?a.enable():a.disable())})}save(t){this.saving$.next(!0);const{category:s,confirmationValue:a,absenceTypeId:o,incidentId:l}=t.value;this.presenceTypesService.presenceTypes$.pipe((0,qe.w)(d=>this.updateService.update(this.state.selected,d,s,a,o,l)),(0,Fe.x)(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.state.resetSelection(),this.toastr.success(this.translate.instant("edit-absences.edit.save-success")),this.navigateBack(!0)}navigateBack(t){this.route.queryParams.pipe((0,f.q)(1)).subscribe(s=>{this.router.navigate(["/edit-absences"],{queryParams:Object.assign(Object.assign({},(0,Ne.dD)(s.returnparams)),{reload:t})})})}sortAbsenceConfirmationStates(t){return t.slice().sort((s,a)=>s.Key===this.settings.excusedAbsenceStateId?-1:a.Key===this.settings.excusedAbsenceStateId?1:s.Value.localeCompare(a.Value))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(u.qu),e.Y36(h.F0),e.Y36(h.gz),e.Y36(ze._W),e.Y36(Z.sK),e.Y36(v),e.Y36(F.R),e.Y36(q.c),e.Y36(Oe),e.Y36(x.L))},n.\u0275cmp=e.Xpm({type:n,selectors:[["erz-edit-absences-edit"]],decls:4,vars:11,consts:[["class","erz-container erz-container-limited erz-container-padding-y",4,"erzLet"],[1,"erz-container","erz-container-limited","erz-container-padding-y"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"formGroup","ngSubmit"],["class","alert alert-danger",4,"ngFor","ngForOf"],[1,"form-group","pb-4"],["class","form-check mt-2 mb-3",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],["type","submit",1,"btn","btn-primary","ml-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"alert","alert-danger"],[1,"form-check","mt-2","mb-3"],["type","radio","formControlName","category",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],["class","ml-5",4,"ngIf"],[1,"ml-5"],["class","form-check mt-2 mb-2",4,"ngFor","ngForOf"],[1,"form-check","mt-2","mb-2"],["type","radio","formControlName","confirmationValue",1,"form-check-input",3,"id","value"],["class","form-control mt-1","formControlName","absenceTypeId",3,"is-invalid",4,"ngIf"],["class","invalid-feedback",4,"ngFor","ngForOf"],["formControlName","absenceTypeId",1,"form-control","mt-1"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"invalid-feedback"],["formControlName","incidentId",1,"form-control","mt-1"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"sr-only"]],template:function(t,s){1&t&&(e.YNc(0,Xe,2,1,"div",0),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async")),2&t&&e.Q6J("erzLet",e.kEZ(7,we,e.lcZ(1,1,s.confirmationStates$),e.lcZ(2,3,s.activeCategories$),e.lcZ(3,5,s.formGroup$)))},directives:[O.e,g.O5,u._Y,u.JL,u.sg,g.sg,u._,u.Fj,u.JJ,u.u,u.EJ,u.YN,u.Kr],pipes:[g.Ov,Z.X$],styles:[""],changeDetection:0}),n})();var et=r(8574),tt=r(5275);const nt=[{path:"",component:W,children:[{path:"",component:Ie,data:{restoreScrollPositionFrom:["/edit-absences/edit","/edit-absences/student/:id"]}},{path:"edit",component:We},{path:"student/:id",children:[{path:"",component:et.$},{path:"confirm",component:tt.A}]}]}];let st=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[h.Bz.forChild(nt)],h.Bz]}),n})(),it=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[D.m,st]]}),n})()}}]);