import{a as ht,b as ft}from"./chunk-XUSNBG4X.js";import{a as qn}from"./chunk-XC4KWMTB.js";import{a as Ae}from"./chunk-HGZDPHGY.js";import{a as Un}from"./chunk-SAPHGUXN.js";import{a as gt}from"./chunk-RSH73DDE.js";import{a as mt}from"./chunk-2OGX72FJ.js";import{e as Wn}from"./chunk-BMSLE3QC.js";import{a as En,b as kn}from"./chunk-R57N3KQJ.js";import{a as kt,b as Ln,c as Dn,d as $n,e as Fn,f as lt,g as pt,h as Gn,i as Bn,k as Rn,l as ye,m as Vn,o as An,p as Hn,q as jn,r as Pe}from"./chunk-42ODZPRN.js";import{b as On,d as Re}from"./chunk-3Y4IHYFH.js";import{a as wn,d as Pn}from"./chunk-TB6BZPNF.js";import{e as In}from"./chunk-TKJDMFYQ.js";import{C as Tn,D as Ge,H as Ee,I as zn}from"./chunk-SDJFSJVJ.js";import{a as Fe,c as bn}from"./chunk-3MQT4YQ4.js";import{o as Sn}from"./chunk-DAMT53C4.js";import{i as we,j as Be}from"./chunk-4QADG3V2.js";import{a as Mn}from"./chunk-Y4QYVF5K.js";import{a as $e}from"./chunk-M3OI3IZ2.js";import{a as ut}from"./chunk-FPH5VJE7.js";import{c as Ve,d as Nn,e as ct}from"./chunk-JDICAM5O.js";import{a as xn}from"./chunk-YHCR7GAG.js";import{d as dt}from"./chunk-IBM6IU7V.js";import{a as ot,i as me}from"./chunk-FGZ22EAH.js";import{a as Xe,b as pe,h as mn,i as un,k as hn,l as gn,r as st}from"./chunk-PQCUED26.js";import{b as _n}from"./chunk-R5Z3WMFK.js";import{a as yn,b as ce}from"./chunk-DQAQYQ7K.js";import{a as at}from"./chunk-V5EJL46U.js";import{$a as v,$b as G,$d as vn,Aa as de,Ab as f,Ba as r,Bb as y,Bd as rn,Cb as We,Cd as sn,D as Gt,Dd as nt,Ed as an,F as Bt,Fb as W,G as Rt,Gb as N,Gc as ve,Gd as on,Hb as U,Hc as Ie,I as te,Ia as Ut,Ib as D,Ic as Oe,Id as dn,Jb as R,Jc as X,K as Z,Ka as ue,Kb as k,La as _,Lb as le,M as Ke,Mb as fe,Md as it,N as Vt,Na as zt,Nb as $,Nd as rt,Oa as qt,Ob as Et,Od as ln,P as J,Pa as Ze,Qd as pn,R as Ye,Rb as p,Rd as De,S as L,Sa as b,Sb as c,Sd as cn,Tb as F,U as Se,Va as m,Wb as Jt,Xa as Y,Yd as fn,Zd as Cn,_ as ae,a as B,ac as Xt,b as H,bb as xe,bc as en,be as ne,ca as h,cb as V,ce as P,db as A,ea as At,eb as a,f as se,fa as Ht,fb as s,g as z,ga as Me,gb as C,h as Pt,ha as T,ia as w,ic as Ce,ka as jt,kb as O,la as Qe,lc as K,m as j,mb as E,mc as Te,n as Ft,na as Nt,nb as u,ob as Kt,oc as tn,p as x,pa as ie,pb as Yt,q,qb as ge,rb as Ne,rd as _e,ta as I,ua as Wt,ud as et,vc as Je,wa as oe,wb as Qt,wd as Le,xb as Zt,xd as tt,y as qe,yb as he,yd as nn,z as be,zb as l}from"./chunk-4HLXNFKK.js";var Ji=10300,Xi=10260,er=10250,tr=14030,nr=10350;function Ct(t){let{HasEvaluationStarted:o,EvaluationUntil:e,HasTestGrading:n}=t.EvaluationStatusRef;if(o===!0&&(t.StatusId===tr||t.StatusId===nr))return{value:re.Rating};if(o===!0&&n===!1){if(e)return{value:re.RatingUntil};if(t.StatusId===Ji)return{value:re.IntermediateRating}}return o===!1&&n===!0&&t.StatusId!==Xi&&t.StatusId!==er?{value:re.Tests}:o===!0&&n===!0?e?{value:re.Tests,label:re.RatingUntil}:{value:re.Tests,label:re.IntermediateRating}:null}function Kn(t){return t.EvaluationStatusRef.HasEvaluationStarted===!0}function Yn(t){return t.EvaluationStatusRef.HasReviewOfEvaluationStarted===!0&&!!t.FinalGrades?.length}function vt(t){let o=t.Classes?t.Classes.map(e=>e.Number).join(", "):null;return o?t.Designation+", "+o:t.Designation}function Qn(t,o){return t?(o.Leadership??"").split(",").some(e=>e.trim()===t.fullname):!1}function Zn(t,o){let e=new URLSearchParams({returnlink:o});return o.startsWith("/dashboard")?`/dashboard/students/${t}?${e}`:o.startsWith("/events/current")?`/events/current/${t}?${e}`:`/events/${t}/students?${e}`}function Jn(t){let o=t.ParticipatingStudents?.map(e=>({id:e.Id,name:e.FullName,email:e.DisplayEmail??void 0}))??[];return{eventId:t.Id,eventDesignation:t.Designation,studyClasses:(t.Classes??[]).map(e=>e.Designation).sort(),entries:o}}function Mt(t,o){return H(B({},t),{entries:t.entries.map(e=>{let n=o.find(d=>d.StudentId===e.id),i=n?[n.CompanyName,n.CompanyNameAddition].filter(Boolean).join(" \u2013 "):void 0;return H(B({},e),{company:i})})})}function It(t,o,e,{eventDesignation:n,emailFallback:i}={}){return{eventId:t,eventDesignation:n??e[0]?.EventDesignation??"",studyClasses:[],entries:o.map(d=>{let g=e.find(S=>S.PersonId===d.Id);return{id:d.Id,subscriptionId:g?.Id,name:d.FullName,email:(i?d.DisplayEmail??d.Email:d.DisplayEmail)??void 0,status:g?.Status,registrationDate:g?.RegistrationDate??void 0}})}}function Xn(t,o){return H(B({},t),{entries:t.entries.map(e=>H(B({},e),{studyClass:o.find(n=>n.StudentRef.Id===e.id)?.StudyClassNumber}))})}var re=function(t){return t.Rating="rating",t.RatingUntil="rating-until",t.IntermediateRating="intermediate-rating",t.Tests="add-tests",t}(re||{}),He=(()=>{class t{constructor(){this.coursesRestService=h(ye),this.eventsRestService=h(ut),this.studyClassRestService=h(Un),this.subscriptionsRestService=h(Ve),this.loadingService=h(we),this.storageService=h($e),this.translate=h(ne),this.router=h(Oe),this.settings=h(_e),this.loading$=this.loadingService.loading$,this.searchFields$=new z(["designation"]),this.searchSubject$=new z(""),this.search$=this.searchSubject$.asObservable(),this.roles$=new z(null),this.isClassTeacher$=this.roles$.pipe(x(e=>Mn(e,"ClassTeacherRole")),J(1)),this.withStudyCourses$=new z(!1),this.unratedCourses$=this.roles$.pipe(L(this.loadUnratedCourses.bind(this)),J(1)),this.studyCourses$=this.withStudyCourses$.pipe(L(this.loadStudyCourses.bind(this)),J(1)),this.formativeAssessments$=this.isClassTeacher$.pipe(L(this.loadFormativeAssessments.bind(this)),J(1)),this.studyClasses$=this.isClassTeacher$.pipe(L(this.loadStudyClasses.bind(this)),J(1)),this.events$=this.getEvents().pipe(J(1)),this.filteredEvents$=q([this.events$,this.searchFields$,this.search$]).pipe(x(Ge(ht)))}setSearch(e){this.searchSubject$.next(e)}setRoles(e){this.roles$.next(e)}setWithStudyCourses(e){this.withStudyCourses$.next(e)}setSearchFields(e){this.searchFields$.next(e)}getEntries(e=!1){return this.filteredEvents$.pipe(x(n=>e?n.filter(i=>i.evaluationText):n))}getEvents(){return this.loadingService.load(q([this.unratedCourses$,this.studyCourses$,this.formativeAssessments$,this.studyClasses$]),{stopOnFirstValue:!0}).pipe(x(Ge(this.createAndSortEvents.bind(this))))}loadUnratedCourses(e){return this.coursesRestService.getExpandedCourses(e).pipe(x(n=>n.filter(i=>!Yn(i))))}loadStudyCourses(e){if(!e)return j([]);let n=this.storageService.getPayload();return this.eventsRestService.getStudyCourseEvents().pipe(x(i=>i.filter(d=>Qn(n,d))),L(i=>this.subscriptionsRestService.getSubscriptionCountsByEvents(i.map(d=>d.Id)).pipe(x(d=>i.map(g=>H(B({},g),{StudentCount:d[g.Id]??0}))))))}loadFormativeAssessments(e){return e?this.studyClassRestService.getActiveFormativeAssessments():j([])}loadStudyClasses(e){return e?this.studyClassRestService.getActive():j([])}createAndSortEvents(e,n,i,d){let g=d.filter(S=>!i.map(ee=>ee.Id).includes(S.Id));return[...this.createFromCourses(e),...this.createFromStudyCourses(n),...this.createFromAssessments(i),...this.createFromStudyClasses(g)].sort((S,ee)=>S.designation.localeCompare(ee.designation))}createFromCourses(e){return e.map(n=>{let i=Ct(n);return{id:n.Id,designation:vt(n),detailLink:this.buildStudentsLink(n.Id),studentCount:n.AttendanceRef.StudentCount||0,dateFrom:n.DateFrom,dateTo:n.DateTo,state:i?.value||null,evaluationText:this.getEvaluationText(i,n.EvaluationStatusRef.EvaluationUntil),evaluationLink:i?.value&&i?.value!==re.Tests?this.buildEvaluationLink(n.Id):null}})}createFromStudyCourses(e){return e.map(n=>({id:n.Id,designation:n.Designation,detailLink:this.buildStudentsLink(n.Id),studentCount:n.StudentCount,state:null}))}createFromAssessments(e){return this.createFromStudyClasses(e).map(i=>H(B({},i),{state:re.Rating,evaluationText:this.translate.instant("events.state.rating"),evaluationLink:this.buildEvaluationLink(i.id)}))}createFromStudyClasses(e){return e.map(n=>({id:n.Id,designation:n.Number,detailLink:this.buildStudentsLink(n.Id),studentCount:n.StudentCount,state:null}))}getEvaluationText(e,n){let i=e?.label||e?.value;return i?this.translate.instant(`events.state.${i}`)+(i===re.RatingUntil?` ${n?Sn(n,"dd.MM.yyyy"):""}`:""):""}buildStudentsLink(e){return Zn(e,this.router.url)}buildEvaluationLink(e){return(this.settings.eventlist.evaluation??"").replace(":id",String(e))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=ae({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var ei=(()=>{class t{constructor(){}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events"]],features:[le([He,Tn])],decls:1,vars:0,template:function(n,i){n&1&&C(0,"router-outlet")},dependencies:[Ie],encapsulation:2})}}return t})();var ir={primarySortKey:"name",ascending:!0},rr=10,ti=(()=>{class t{constructor(){this.sortCriteria=oe(ir),this.loading=oe(!1),this.event=oe({Id:10064,Designation:"Mathematik-ALB, BVS2024a",EventTypeId:1,StudentCount:23,Leadership:void 0}),this.isStudyClass=G(()=>this.event()?.EventTypeId===rr),this.gradingItems=oe([{Id:"1",IdPerson:1,PersonFullname:"Paul McCartney",IdGrade:null,GradeValue:null},{Id:"2",IdPerson:2,PersonFullname:"John Lennon",IdGrade:null,GradeValue:null},{Id:"3",IdPerson:3,PersonFullname:"George Harrison",IdGrade:null,GradeValue:null},{Id:"4",IdPerson:4,PersonFullname:"Ringo Starr",IdGrade:null,GradeValue:null}])}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=ae({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function ni(t,o,e){o||Ht(t);let n=o??h(Nt);return e?At(n,e):n}function ke(t,o){let e=ni(ke,o?.injector),n;return G(()=>(n||(n=Xt(()=>pe(t,H(B({},o),{injector:e})))),n()))}var sr=()=>["/events"],ar=t=>({count:t}),ii=(()=>{class t{constructor(){this.reportsService=h(Re),this.event=I.required(),this.reports=ke(Xe(this.event).pipe(x(e=>e?.Id),Z(),L(e=>e?this.reportsService.getEvaluationReports(e):j([])),Ye([])))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-evaluation-header"]],inputs:{event:[1,"event"]},decls:11,vars:10,consts:[[3,"link"],[1,"d-flex"],[1,"ms-2",3,"reports"],["id","excel-import"],[1,"d-flex","flex-column","header"],[1,"additional-info"]],template:function(n,i){if(n&1&&(a(0,"bkd-backlink",0)(1,"div",1),C(2,"bkd-reports-link",2)(3,"div",3),s()(),a(4,"div",4)(5,"h1"),l(6),s(),a(7,"div",5),D(8),l(9),p(10,"translate"),s()()),n&2){m("link",fe(7,sr)),r(2),m("reports",i.reports()),r(4),f(i.event().Designation);let d=i.event().StudentCount;r(3),y(" ",F(10,4,d===1?"courses.registration":"courses.registrations",$(8,ar,d))," ")}},dependencies:[Ee,P,Be],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem;border-bottom:1px solid #dee2e6}h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"],changeDetection:0})}}return t})();var or=576,je=(()=>{class t{constructor(){this.portal=h(Nn),this.inlineHeader=I.required(),this.stickyHeader=I.required(),this.handleWindowScroll=()=>{this.updateStickyVisibility(),this.updateStickyTopOffset()},this.handleWindowResize=()=>{this.updateStickyWidth(),this.updateStickyVisibility(),this.updateStickyTopOffset()},this.handleTableScroll=()=>{this.updateStickyLeftOffset()}}ngAfterViewInit(){this.handleWindowScroll(),this.handleTableScroll(),this.handleWindowResize(),this.window.addEventListener("scroll",this.handleWindowScroll),this.getTableScrollContainer()?.addEventListener("scroll",this.handleTableScroll),this.window.addEventListener("resize",this.handleWindowResize)}ngOnDestroy(){this.window.removeEventListener("scroll",this.handleWindowScroll),this.getTableScrollContainer()?.removeEventListener("scroll",this.handleTableScroll),this.window.removeEventListener("resize",this.handleWindowResize)}refresh(){setTimeout(()=>this.updateStickyWidth())}get window(){return this.portal.window??window}getTableScrollContainer(){return document.querySelector(".table-responsive-wrapper")??null}updateStickyVisibility(){if(this.isSmallBreakpointDown())return;let e=this.inlineHeader().getTop()+this.getIframeScrollY();this.stickyHeader().shown.set(this.getScrollTop()>e)}updateStickyTopOffset(){this.isSmallBreakpointDown()||this.stickyHeader().setTopOffset(this.portal.inIframe?this.getScrollTop():0)}updateStickyLeftOffset(){this.isSmallBreakpointDown()||this.stickyHeader().setLeftOffset(this.inlineHeader().getLeft())}updateStickyWidth(){this.isSmallBreakpointDown()||(this.stickyHeader().setWidth(this.inlineHeader().getWidth()),this.stickyHeader().setColumnWidths(this.inlineHeader().getColumnWidths()),this.stickyHeader().setStickyColumnHeights(this.inlineHeader().getStickyColumnsHeights()))}getScrollTop(){return this.window.scrollY-this.portal.getIframeTop()}getIframeScrollY(){return window.scrollY}isSmallBreakpointDown(){return window.innerWidth<or}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275dir=zt({type:t,selectors:[["","bkdTableHeaderSticky",""]],inputs:{inlineHeader:[1,"inlineHeader"],stickyHeader:[1,"stickyHeader"]}})}}return t})();var _t=(()=>{class t{get stickyClass(){return this.sticky()}constructor(){this.element=h(Wt),this.sticky=I(!1),this.shown=oe(!1),en(this.updateShownClass.bind(this))}getTop(){return this.element.nativeElement.getBoundingClientRect().top}getLeft(){return this.element.nativeElement.getBoundingClientRect().left}setTopOffset(e){this.element.nativeElement.style.top=`${e}px`}setLeftOffset(e){this.element.nativeElement.style.left=`${e}px`}getWidth(){return this.element.nativeElement.getBoundingClientRect().width}setWidth(e){this.element.nativeElement.style.width=`${e}px`}getColumnWidths(){return this.getRowsAndColumns().map(e=>e.map(n=>n.getBoundingClientRect().width))}setColumnWidths(e){let n=this.getRowsAndColumns();if(n.length!==e.length||!n.every((i,d)=>i.length===e[d].length))throw new Error("Given column widths do not match number of header rows/columns");n.forEach((i,d)=>i.forEach((g,S)=>{g.style.width=`${e[d][S]}px`,g.style.minWidth=`${e[d][S]}px`}))}getStickyColumnsHeights(){return this.getRowsAndColumns(".sticky").map(e=>e.map(n=>n.getBoundingClientRect().height))}setStickyColumnHeights(e){let n=this.getRowsAndColumns(".sticky");if(n.length!==e.length||!n.every((i,d)=>i.length===e[d].length))throw new Error("Given column heights do not match number of sticky header columns");n.forEach((i,d)=>i.forEach((g,S)=>{g.style.height=`${e[d][S]}px`})),this.getRows().forEach((i,d)=>{let g=e[d].reduce((S,ee)=>Math.max(S,ee),0);i.style.height=`${g}px`})}updateShownClass(){let e=this.element.nativeElement.classList;this.shown()?e.add("shown"):e.remove("shown")}getRowsAndColumns(e){return this.getRows().map(n=>Array.from(n.querySelectorAll(`th:not(.header-mobile)${e??""}`)))}getRows(){return Array.from(this.element.nativeElement.querySelectorAll("tr"))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["ng-component"]],hostVars:2,hostBindings:function(n,i){n&2&&Y("sticky",i.stickyClass)},inputs:{sticky:[1,"sticky"]},decls:0,vars:0,template:function(n,i){},encapsulation:2})}}return t})();var dr=["bkdEvaluationTableHeader",""],lr=()=>["Anforderungen","Absenzen entschuldigt","Absenzen unentschuldigt","Formative Beurteilung (generell)","Bemerkung"];function pr(t,o){if(t&1){let e=O();a(0,"th",5)(1,"bkd-sortable-header",1),p(2,"translate"),U("sortCriteriaChange",function(i){T(e);let d=u();return N(d.sortCriteria,i)||(d.sortCriteria=i),w(i)}),s()()}if(t&2){let e=u();Y("selected",e.gradeColumnSelected()),r(),m("label",c(2,5,"evaluation.columns.grade"))("sortKey","grade"),W("sortCriteria",e.sortCriteria)}}function cr(t,o){if(t&1&&(a(0,"th",3),l(1),s()),t&2){let e=o.$implicit;r(),f(e)}}var ri=(()=>{class t extends _t{constructor(){super(...arguments),this.sortCriteria=ue.required(),this.selectedColumn=I.required(),this.isStudyClass=I.required(),this.gradeColumnSelected=G(()=>this.selectedColumn()===Ue),this.absencesColumnSelected=G(()=>this.selectedColumn()===ze)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=Qe(t)))(i||t)}})()}static{this.\u0275cmp=_({type:t,selectors:[["thead","bkdEvaluationTableHeader",""]],inputs:{sortCriteria:[1,"sortCriteria"],selectedColumn:[1,"selectedColumn"],isStudyClass:[1,"isStudyClass"]},outputs:{sortCriteria:"sortCriteriaChange"},features:[Ze],attrs:dr,decls:8,vars:9,consts:[[1,"sticky","student-name"],[3,"sortCriteriaChange","label","sortKey","sortCriteria"],[1,"border-end","sticky","student-grade","desktop",3,"selected"],[1,"subscription-detail"],[1,"filler"],[1,"border-end","sticky","student-grade","desktop"]],template:function(n,i){n&1&&(a(0,"tr")(1,"th",0)(2,"bkd-sortable-header",1),p(3,"translate"),U("sortCriteriaChange",function(g){return N(i.sortCriteria,g)||(i.sortCriteria=g),g}),s()(),b(4,pr,3,7,"th",2),V(5,cr,2,1,"th",3,xe),C(7,"th",4),s()),n&2&&(r(),Y("border-end",i.isStudyClass()),r(),m("label",c(3,6,"evaluation.columns.name"))("sortKey","name"),W("sortCriteria",i.sortCriteria),r(2),v(i.isStudyClass()?-1:4),r(),A(fe(8,lr)))},dependencies:[P,Ae],styles:["[_nghost-%COMP%]{--spacer: 16px;--grade-input-size: 127px;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--subscription-detail-columns-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (max-width: 810px){th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%]{width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));min-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));max-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer))}}th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .subscription-detail[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%], tfoot[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.student-grade[_ngcontent-%COMP%], .subscription-detail[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}}.sticky[_nghost-%COMP%]{position:fixed;top:0;left:0;z-index:1000;display:none}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;vertical-align:top}@media (min-width: 811px){.sticky.shown[_nghost-%COMP%]{display:table-header-group}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;padding-top:.25rem;padding-bottom:.25rem;border-top:initial}.sticky[_nghost-%COMP%]{margin-left:var(--subscription-detail-columns-offset)}.sticky[_nghost-%COMP%]   th.sticky[_ngcontent-%COMP%]{position:fixed}}"],changeDetection:0})}}return t})();var mr=(t,o)=>o.Id,ur=t=>["student",t,"grades"];function hr(t,o){if(t&1&&(a(0,"td",12),l(1),s()),t&2){let e,n=u().$implicit,i=u();Y("selected",i.gradeColumnSelected()),r(),y(" ",(e=n.GradeValue)!==null&&e!==void 0?e:"\u2013"," ")}}function gr(t,o){if(t&1&&(a(0,"tr")(1,"td",6)(2,"a",11)(3,"div"),l(4),s()()(),b(5,hr,2,3,"td",7),a(6,"td",8),l(7,"..."),s(),a(8,"td",8),l(9,"..."),s(),a(10,"td",8),l(11,"..."),s(),a(12,"td",8),l(13,"..."),s(),a(14,"td",8),l(15,"..."),s(),C(16,"td",9),s()),t&2){let e=o.$implicit,n=u();r(),Y("border-end",n.isStudyClass()),r(),m("routerLink",$(5,ur,e.IdPerson)),r(2),f(e.PersonFullname),r(),v(n.isStudyClass()?-1:5)}}function fr(t,o){if(t&1&&(a(0,"td",12),l(1," 4.5 "),s()),t&2){let e=u();Y("selected",e.gradeColumnSelected())}}var si=(()=>{class t{constructor(){this.sortCriteria=ue.required(),this.selectedColumn=I.required(),this.gradingItems=I.required(),this.isStudyClass=I.required(),this.gradeColumnSelected=G(()=>this.selectedColumn()===Ue),this.absencesColumnSelected=G(()=>this.selectedColumn()===ze)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-evaluation-table"]],inputs:{sortCriteria:[1,"sortCriteria"],selectedColumn:[1,"selectedColumn"],gradingItems:[1,"gradingItems"],isStudyClass:[1,"isStudyClass"]},outputs:{sortCriteria:"sortCriteriaChange"},decls:22,vars:13,consts:[["inlineHeader",""],["stickyHeader",""],[1,"table-responsive-wrapper"],["bkdTableHeaderSticky","",1,"table","table-hover","h-100",3,"inlineHeader","stickyHeader"],["bkdEvaluationTableHeader","",3,"sortCriteriaChange","sortCriteria","selectedColumn","isStudyClass"],["bkdEvaluationTableHeader","",3,"sortCriteriaChange","sticky","sortCriteria","selectedColumn","isStudyClass"],[1,"sticky","student-name"],[1,"border-end","sticky","student-grade",3,"selected"],[1,"subscription-detail"],[1,"filler"],[1,"action-buttons"],[3,"routerLink"],[1,"border-end","sticky","student-grade"]],template:function(n,i){if(n&1){let d=O();a(0,"div",2)(1,"table",3)(2,"thead",4,0),U("sortCriteriaChange",function(S){return T(d),N(i.sortCriteria,S)||(i.sortCriteria=S),w(S)}),s(),a(4,"thead",5,1),U("sortCriteriaChange",function(S){return T(d),N(i.sortCriteria,S)||(i.sortCriteria=S),w(S)}),s(),a(6,"tbody"),V(7,gr,17,7,"tr",null,mr),s(),a(9,"tfoot")(10,"tr")(11,"td",6),l(12),p(13,"translate"),s(),b(14,fr,2,2,"td",7),C(15,"td",8)(16,"td",8)(17,"td",8)(18,"td",8)(19,"td",8)(20,"td",9),s()()(),C(21,"div",10),s()}if(n&2){let d=he(3),g=he(5);r(),m("inlineHeader",d)("stickyHeader",g),r(),W("sortCriteria",i.sortCriteria),m("selectedColumn",i.selectedColumn())("isStudyClass",i.isStudyClass()),r(2),m("sticky",!0),W("sortCriteria",i.sortCriteria),m("selectedColumn",i.selectedColumn())("isStudyClass",i.isStudyClass()),r(3),A(i.gradingItems()),r(5),y(" ",c(13,11,"evaluation.average")," "),r(2),v(i.isStudyClass()?-1:14)}},dependencies:[X,P,ri,je],styles:["[_nghost-%COMP%]{--spacer: 16px;--grade-input-size: 127px;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--subscription-detail-columns-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (max-width: 810px){th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%]{width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));min-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));max-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer))}}th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .subscription-detail[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%], tfoot[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.student-grade[_ngcontent-%COMP%], .subscription-detail[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child{text-decoration:underline}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}@media (min-width: 811px){.table-responsive-wrapper[_ngcontent-%COMP%]{display:block;overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.action-buttons[_ngcontent-%COMP%]{position:sticky;left:0}}"],changeDetection:0})}}return t})();function Cr(t,o){t&1&&C(0,"bkd-spinner")}function vr(t,o){if(t&1&&C(0,"bkd-evaluation-header",1),t&2){u();let e=k(0);m("event",e)}}function _r(t,o){if(t&1){let e=O();a(0,"bkd-select",5),U("valueChange",function(i){T(e),u(3);let d=k(0);return N(d,i),w(i)}),s()}if(t&2){let e=u(3),n=k(0);m("options",e.columns()),W("value",n),m("allowEmpty",!1)}}function yr(t,o){if(t&1){let e=O();b(0,_r,1,3,"bkd-select",3),a(1,"bkd-evaluation-table",4),U("sortCriteriaChange",function(i){T(e);let d=u(2);return N(d.state.sortCriteria,i)||(d.state.sortCriteria=i),w(i)}),s()}if(t&2){u();let e=k(2),n=u(),i=k(0);v(n.columns().length>1?0:-1),r(),W("sortCriteria",n.state.sortCriteria),m("gradingItems",e)("selectedColumn",i())("isStudyClass",n.state.isStudyClass())}}function br(t,o){t&1&&(a(0,"p",2),l(1),p(2,"translate"),s()),t&2&&(r(),f(c(2,1,"evaluation.no-items")))}function Sr(t,o){if(t&1&&(D(0),b(1,vr,1,1,"bkd-evaluation-header",1),D(2),b(3,yr,2,5)(4,br,3,3,"p",2)),t&2){let e=u(),n=R(e.state.event());r(),v(n?1:-1),r();let i=R(e.state.gradingItems());r(),v(i.length>0?3:4)}}var Ue=-1,ze=-2,ai=(()=>{class t{constructor(){this.state=h(ti),this.translate=h(ne),this.columns=G(()=>{let e={Key:Ue,Value:this.translate.instant("evaluation.columns.grade")},n={Key:ze,Value:this.translate.instant("evaluation.columns.absences")},i=[{Key:1,Value:"Anforderungen"},n,{Key:4,Value:"Formative Beurteilung (generell)"},{Key:5,Value:"Bemerkung"}];return[this.state.isStudyClass()?null:e,...i].filter(ce)}),this.selectedColumn=G(()=>{let e=this.columns(),n=e.length?Number(e[0].Key):null;return oe(n)})}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-evaluation-list"]],decls:4,vars:2,consts:[[1,"bkd-container"],[3,"event"],[1,"mt-3","px-3"],["width","100%",1,"columns-dropdown",3,"options","value","allowEmpty"],[3,"sortCriteriaChange","sortCriteria","gradingItems","selectedColumn","isStudyClass"],["width","100%",1,"columns-dropdown",3,"valueChange","options","value","allowEmpty"]],template:function(n,i){n&1&&(D(0),a(1,"div",0),b(2,Cr,1,0,"bkd-spinner")(3,Sr,5,4),s()),n&2&&(R(i.selectedColumn()),r(2),v(i.state.loading()?2:3))},dependencies:[P,ii,si,me,Pe],styles:[".columns-dropdown[_ngcontent-%COMP%]{display:block;padding:1rem 0}@media (min-width: 811px){.columns-dropdown[_ngcontent-%COMP%]{display:none}}"],changeDetection:0})}}return t})();var oi=(()=>{class t extends ot{constructor(){let e=h(Je),n=h(_e);super(e,n,En,"ApprenticeshipContracts")}getCompaniesForStudents(e){if(e.length===0)return j([]);let n=new Date,i={"filter.StudentId":`;${e.join(";")}`,"filter.ApprenticeshipDateFrom":`<${n.toISOString()}`,"filter.ApprenticeshipDateTo":`>${n.toISOString()}`,fields:"Id,StudentId,CompanyName,CompanyNameAddition"};return this.http.get(`${this.baseUrl}/`,{params:i}).pipe(L(_n(kn)))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=ae({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var yt=1;var di=10,bt=(()=>{class t{constructor(){this.route=h(ve),this.loadingService=h(we),this.eventsService=h(ut),this.coursesService=h(ye),this.subscriptionsService=h(Ve),this.personsService=h(dt),this.apprenticeshipContractsService=h(oi),this.lessonPresencesService=h(In),this.reportsService=h(Re),this.eventId$=q([this.route.paramMap,this.route.parent?.paramMap??j(null)]).pipe(x(([e,n])=>Number(e.get("id")||n?.get("id"))),Z()),this.eventSummary$=this.eventId$.pipe(L(this.loadEventSummary.bind(this)),J(1)),this.eventSummary=ke(this.eventSummary$,{initialValue:null}),this.eventTypeId=G(()=>this.eventSummary()?.EventTypeId??null),this.studentEntries=ke(this.loadStudentEntries(),{initialValue:null}),this.isStudyCourse=G(()=>this.eventTypeId()===yt),this.loading=pe(this.loadingService.loading(gt)),this.title=G(()=>this.getTitle(this.studentEntries())),this.multipleStudyClasses=G(()=>(this.studentEntries()?.studyClasses?.length??0)>1),this.searchTerm=oe(""),this.sortCriteria=oe({primarySortKey:"registrationDate",ascending:!1}),this.entries=G(()=>this.studentEntries()?.entries??[]),this.sortedEntries=G(()=>this.sortStudentEntries(this.entries(),this.sortCriteria())),this.filteredEntries=G(()=>ht(this.sortedEntries(),["name","status","company","studyClass"],this.searchTerm())),this.mailtoLink=G(()=>this.getMailtoLink(this.eventTypeId(),this.entries())),this.reports=ke(this.eventSummary$.pipe(be(ce)).pipe(L(this.loadReports.bind(this))),{initialValue:[]})}loadEventSummary(e){return this.loadingService.load(this.eventsService.getEventSummary(e),gt)}loadStudentEntries(){return this.eventSummary$.pipe(L(e=>{let n=()=>{if(!e)return j(null);switch(e.EventTypeId){case yt:return this.loadStudyCourseStudents(e);case di:return this.loadStudyClassStudents(e.Id);default:return this.loadCourseStudents(e.Id)}};return this.loadingService.load(n(),gt)}))}loadStudyCourseStudents({Id:e,Designation:n}){return this.subscriptionsService.getSubscriptionsByCourse(e).pipe(L(i=>this.personsService.getSummaries(i.map(({PersonId:d})=>d).filter(ce)).pipe(x(d=>It(e,d,i,{eventDesignation:n})))))}loadStudyClassStudents(e){return this.subscriptionsService.getSubscriptionsByCourse(e,{"filter.IsOkay":"=1"}).pipe(L(n=>{let i=n.map(({PersonId:d})=>d).filter(ce);return q([this.personsService.getSummaries(i),this.apprenticeshipContractsService.getCompaniesForStudents(i)]).pipe(x(([d,g])=>{let S=It(e,d,n,{emailFallback:!0});return Mt(S,g)}))}))}loadCourseStudents(e){return this.coursesService.getExpandedCourseWithParticipants(e).pipe(x(Jn),L(n=>q([this.apprenticeshipContractsService.getCompaniesForStudents(n.entries.map(({id:i})=>i)),this.lessonPresencesService.getLessonStudyClassesByEvent(e)]).pipe(x(([i,d])=>{let g=Mt(n,i);return Xn(g,d)}))))}getTitle(e){if(!e||!e.eventDesignation)return null;let{eventDesignation:n,studyClasses:i}=e;return[n,...i].join(", ")}getMailtoLink(e,n){if(e===null||e===yt)return null;let i=n.map(d=>d.email).filter(Boolean);return i.length>0?`mailto:${i.join(";")}`:null}loadReports({Id:e,EventTypeId:n}){switch(n){case null:case yt:return j([]);case di:return this.reportsService.getStudyClassStudentsReports(e);default:return this.reportsService.getCourseStudentsReports(e)}}sortStudentEntries(e,n){return[...e].sort(xr(n))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=ae({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function xr(t){return(o,e)=>{switch(t.primarySortKey){case"registrationDate":return Tr(o,e,t.ascending);case"name":return li(o,e,t.ascending);default:throw new xn(t.primarySortKey,"Unhandled sort criteria")}}}function Tr(t,o,e){let n=t.registrationDate?new Date(t.registrationDate).getTime():0,i=o.registrationDate?new Date(o.registrationDate).getTime():0,d=e?n-i:i-n;return d===0?li(t,o,!0):d}function li(t,o,e){return e?t.name.localeCompare(o.name):o.name.localeCompare(t.name)}var pi=(()=>{class t{constructor(){this.entry=I.required(),this.multipleStudyClasses=I(!1),this.returnLink=I(null),this.link=G(()=>["student",this.entry().id,"contact"]),this.linkParams=G(()=>{let e=this.returnLink();return e?{returnparams:new URLSearchParams({returnlink:e}).toString()}:{}})}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-course-entry"]],inputs:{entry:[1,"entry"],multipleStudyClasses:[1,"multipleStudyClasses"],returnLink:[1,"returnLink"]},decls:7,vars:10,consts:[[1,"avatar","large",3,"studentId","link","linkParams"],[1,"name",3,"title","routerLink","queryParams"],[1,"study-class"],[1,"company",3,"title"]],template:function(n,i){n&1&&(C(0,"bkd-avatar",0),a(1,"a",1),l(2),s(),a(3,"div",2),l(4),s(),a(5,"div",3),l(6),s()),n&2&&(m("studentId",i.entry().id)("link",i.link())("linkParams",i.linkParams()),r(),m("title",i.entry().name)("routerLink",i.link())("queryParams",i.linkParams()),r(),f(i.entry().name),r(2),y(" ",i.multipleStudyClasses()?i.entry().studyClass:"",`
`),r(),m("title",i.entry().company),r(),f(i.entry().company))},dependencies:[X,Wn],styles:['[_nghost-%COMP%]{display:grid;grid-template-columns:min-content 1fr;grid-template-rows:min-content min-content 1fr;grid-template-areas:"avatar name" "avatar study-class" "avatar company";padding:2rem 1rem}.avatar[_ngcontent-%COMP%]{grid-area:avatar;margin-right:1.5rem}.name[_ngcontent-%COMP%]{grid-area:name}.study-class[_ngcontent-%COMP%]{grid-area:study-class;font-size:.875rem}.company[_ngcontent-%COMP%]{grid-area:company;align-content:end;padding-bottom:1.5rem}.name[_ngcontent-%COMP%], .company[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}'],changeDetection:0})}}return t})();var wr=t=>({count:t});function Pr(t,o){if(t&1&&(a(0,"div",0),l(1),p(2,"translate"),s()),t&2){u();let e=k(2);r(),y(" ",F(2,1,e===1?"events-students.registration":"events-students.registrations",$(4,wr,e))," ")}}var St=(()=>{class t{constructor(){this.title=I.required(),this.count=I(null),this.searchTerm=ue()}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-header"]],inputs:{title:[1,"title"],count:[1,"count"],searchTerm:[1,"searchTerm"]},outputs:{searchTerm:"searchTermChange"},decls:7,vars:10,consts:[[1,"additional-info"],[1,"search",3,"valueChange","value","placeholder","label"]],template:function(n,i){if(n&1){let d=O();a(0,"h1"),l(1),s(),D(2),b(3,Pr,3,6,"div",0),a(4,"bkd-resettable-input",1),p(5,"translate"),p(6,"translate"),E("valueChange",function(S){return T(d),w(i.searchTerm.set(S))}),s()}if(n&2){r(),f(i.title()),r();let d=R(i.count());r(),v(d!==null?3:-1),r(),m("value",i.searchTerm())("placeholder",c(5,6,"events-students.search-placeholder"))("label",c(6,8,"events-students.search"))}},dependencies:[P,ft],styles:["h1[_ngcontent-%COMP%]{margin-bottom:0}.search[_ngcontent-%COMP%]{margin-top:1rem;display:flex;max-width:300px}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"],changeDetection:0})}}return t})();var Er=(t,o)=>o.id;function kr(t,o){t&1&&(a(0,"p"),l(1),p(2,"translate"),s()),t&2&&(r(),f(c(2,1,"events-students.no-entries")))}function Mr(t,o){if(t&1&&C(0,"bkd-events-students-course-entry",2),t&2){let e=o.$implicit,n=u();m("entry",e)("multipleStudyClasses",n.multipleStudyClasses())("returnLink",n.returnLink())}}var ci=(()=>{class t{constructor(){this.title=I.required(),this.count=I.required(),this.entries=I.required(),this.multipleStudyClasses=I(!1),this.returnLink=I(null),this.searchTerm=ue()}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-course-list"]],inputs:{title:[1,"title"],count:[1,"count"],entries:[1,"entries"],multipleStudyClasses:[1,"multipleStudyClasses"],returnLink:[1,"returnLink"],searchTerm:[1,"searchTerm"]},outputs:{searchTerm:"searchTermChange"},decls:5,vars:4,consts:[[3,"searchTermChange","title","count","searchTerm"],[1,"list"],[3,"entry","multipleStudyClasses","returnLink"]],template:function(n,i){n&1&&(a(0,"bkd-events-students-header",0),U("searchTermChange",function(g){return N(i.searchTerm,g)||(i.searchTerm=g),g}),s(),a(1,"section",1),b(2,kr,3,3,"p"),V(3,Mr,1,3,"bkd-events-students-course-entry",2,Er),s()),n&2&&(m("title",i.title())("count",i.count()),W("searchTerm",i.searchTerm),r(2),v(i.entries().length===0?2:-1),r(),A(i.entries()))},dependencies:[P,St,pi],styles:["[_nghost-%COMP%]{display:block;overflow:hidden}section.list[_ngcontent-%COMP%]{width:calc(100% + 1px);margin-top:1rem;display:grid;grid-template-columns:repeat(auto-fill,minmax(400px,1fr))}bkd-events-students-course-entry[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;border-right:1px solid #dee2e6}"],changeDetection:0})}}return t})();var mi=(()=>{class t{constructor(){this.entry=I.required(),this.returnLink=I(null),this.link=G(()=>["study-course-student",this.entry().id]),this.linkParams=G(()=>{let e=this.returnLink();return e?{returnparams:new URLSearchParams({returnlink:e}).toString()}:{}})}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-study-course-entry"]],inputs:{entry:[1,"entry"],returnLink:[1,"returnLink"]},decls:7,vars:8,consts:[[1,"name",3,"routerLink","queryParams"],[1,"status"],[1,"registration-date"]],template:function(n,i){n&1&&(a(0,"a",0),l(1),s(),a(2,"div",1),l(3),s(),a(4,"div",2),l(5),p(6,"date"),s()),n&2&&(m("routerLink",i.link())("queryParams",i.linkParams()),r(),f(i.entry().name),r(2),f(i.entry().status),r(2),y(" ",F(6,5,i.entry().registrationDate,"dd.MM.yyyy"),`
`))},dependencies:[X,tn,Te],styles:['[_nghost-%COMP%]{display:grid;align-items:center;grid-template-areas:"name status registration-date";grid-template-columns:2fr 1fr 1fr;border-bottom:1px solid #dee2e6}.name[_ngcontent-%COMP%], .status[_ngcontent-%COMP%], .registration-date[_ngcontent-%COMP%]{padding:1rem}.name[_ngcontent-%COMP%]{grid-area:name;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.status[_ngcontent-%COMP%]{grid-area:status;padding-left:0}.registration-date[_ngcontent-%COMP%]{grid-area:registration-date}@media (max-width: 750px){[_nghost-%COMP%]{grid-template-areas:"name registration-date" "status registration-date";grid-template-columns:2fr 1fr;align-items:start}.name[_ngcontent-%COMP%]{padding-bottom:0}.status[_ngcontent-%COMP%]{padding-top:0;padding-left:1rem;font-size:.875rem}}'],changeDetection:0})}}return t})();var Ir=(t,o)=>o.id;function Or(t,o){if(t&1){let e=O();a(0,"div",2)(1,"bkd-sortable-header",4),p(2,"translate"),U("sortCriteriaChange",function(i){T(e);let d=u();return N(d.sortCriteria,i)||(d.sortCriteria=i),w(i)}),s(),a(3,"bkd-sortable-header",5),p(4,"translate"),U("sortCriteriaChange",function(i){T(e);let d=u();return N(d.sortCriteria,i)||(d.sortCriteria=i),w(i)}),s()()}if(t&2){let e=u();r(),m("label",c(2,6,"events-students.list.header.name"))("sortKey","name"),W("sortCriteria",e.sortCriteria),r(2),m("label",c(4,8,"events-students.list.header.registration-date"))("sortKey","registrationDate"),W("sortCriteria",e.sortCriteria)}}function Lr(t,o){t&1&&(a(0,"p"),l(1),p(2,"translate"),s()),t&2&&(r(),f(c(2,1,"events-students.no-entries")))}function Dr(t,o){if(t&1&&C(0,"bkd-events-students-study-course-entry",3),t&2){let e=o.$implicit,n=u();m("entry",e)("returnLink",n.returnLink())}}var ui=(()=>{class t{constructor(){this.title=I.required(),this.count=I.required(),this.entries=I.required(),this.returnLink=I(null),this.sortCriteria=ue.required(),this.searchTerm=ue()}updateSortCriteria(e){this.sortCriteria.set(e)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-study-course-list"]],inputs:{title:[1,"title"],count:[1,"count"],entries:[1,"entries"],returnLink:[1,"returnLink"],sortCriteria:[1,"sortCriteria"],searchTerm:[1,"searchTerm"]},outputs:{sortCriteria:"sortCriteriaChange",searchTerm:"searchTermChange"},features:[le([])],decls:6,vars:4,consts:[[3,"searchTermChange","title","count","searchTerm"],[1,"list"],[1,"list-header"],[3,"entry","returnLink"],[1,"name",3,"sortCriteriaChange","label","sortKey","sortCriteria"],[1,"registration-date",3,"sortCriteriaChange","label","sortKey","sortCriteria"]],template:function(n,i){n&1&&(a(0,"bkd-events-students-header",0),U("searchTermChange",function(g){return N(i.searchTerm,g)||(i.searchTerm=g),g}),s(),a(1,"section",1),b(2,Or,5,10,"div",2)(3,Lr,3,3,"p"),V(4,Dr,1,2,"bkd-events-students-study-course-entry",3,Ir),s()),n&2&&(m("title",i.title())("count",i.count()),W("searchTerm",i.searchTerm),r(2),v(i.entries().length>0?2:3),r(2),A(i.entries()))},dependencies:[P,St,mi,Ae],styles:[".list-header[_ngcontent-%COMP%]{cursor:pointer;display:grid;grid-template-columns:3fr 1fr;align-items:center;border-bottom:2px solid #dee2e6}.name[_ngcontent-%COMP%], .registration-date[_ngcontent-%COMP%]{padding:1rem}.name[_ngcontent-%COMP%]{flex:3}.registration-date[_ngcontent-%COMP%]{flex:1}@media (max-width: 750px){.list-header[_ngcontent-%COMP%]{grid-template-columns:2fr 1fr}.name[_ngcontent-%COMP%]{flex:2}.registration-date[_ngcontent-%COMP%]{flex:1;white-space:nowrap}}"],changeDetection:0})}}return t})();var $r=t=>[t];function Fr(t,o){if(t&1&&(a(0,"a",4)(1,"i",6),l(2,"mail"),s()()),t&2){let e=u(2);m("href",e.state.mailtoLink(),de)}}function Gr(t,o){if(t&1&&(a(0,"bkd-backlink",0)(1,"div",3),b(2,Fr,3,1,"a",4),C(3,"bkd-reports-link",5),s()()),t&2){let e=u(),n=k(0);m("link",$(3,$r,n)),r(2),v(e.state.mailtoLink()?2:-1),r(),m("reports",e.state.reports())}}function Br(t,o){t&1&&C(0,"bkd-spinner")}function Rr(t,o){t&1&&(a(0,"p"),l(1),p(2,"translate"),s()),t&2&&(r(),f(c(2,1,"events-students.no-entries")))}function Vr(t,o){if(t&1){let e=O();a(0,"bkd-events-students-study-course-list",7),U("sortCriteriaChange",function(i){T(e);let d=u();return N(d.state.sortCriteria,i)||(d.state.sortCriteria=i),w(i)})("searchTermChange",function(i){T(e);let d=u();return N(d.state.searchTerm,i)||(d.state.searchTerm=i),w(i)}),s()}if(t&2){let e=u();m("title",e.state.title())("count",e.state.entries().length)("entries",e.state.filteredEntries())("returnLink",e.returnLink()),W("sortCriteria",e.state.sortCriteria)("searchTerm",e.state.searchTerm)}}function Ar(t,o){if(t&1){let e=O();a(0,"bkd-events-students-course-list",8),U("searchTermChange",function(i){T(e);let d=u();return N(d.state.searchTerm,i)||(d.state.searchTerm=i),w(i)}),s()}if(t&2){let e=u();m("title",e.state.title())("count",e.state.entries().length)("entries",e.state.filteredEntries())("multipleStudyClasses",e.state.multipleStudyClasses())("returnLink",e.returnLink()),W("searchTerm",e.state.searchTerm)}}var hi=(()=>{class t{constructor(){this.state=h(bt),this.route=h(ve),this.returnLink=pe(this.route.queryParams.pipe(x(({returnlink:e})=>e?decodeURIComponent(e):null)))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-list"]],decls:6,vars:3,consts:[[3,"link"],[3,"title","count","entries","returnLink","sortCriteria","searchTerm"],[3,"title","count","entries","multipleStudyClasses","returnLink","searchTerm"],[1,"d-flex"],["target","_blank",1,"mail","btn","btn-primary","btn-icon","me-2",3,"href"],[1,"ms-2",3,"reports"],[1,"material-icons"],[3,"sortCriteriaChange","searchTermChange","title","count","entries","returnLink","sortCriteria","searchTerm"],[3,"searchTermChange","title","count","entries","multipleStudyClasses","returnLink","searchTerm"]],template:function(n,i){if(n&1&&(D(0),b(1,Gr,4,5,"bkd-backlink",0)(2,Br,1,0,"bkd-spinner")(3,Rr,3,3,"p")(4,Vr,1,6,"bkd-events-students-study-course-list",1)(5,Ar,1,6,"bkd-events-students-course-list",2)),n&2){let d=R(i.returnLink());r(),v(d?1:-1),r(),v(i.state.loading()?2:i.state.entries().length===0?3:i.state.isStudyCourse()?4:5)}},dependencies:[P,me,Ee,Be,ci,ui],encapsulation:2,changeDetection:0})}}return t})();var Hr=(t,o)=>o.id;function jr(t,o){if(t&1&&(l(0),p(1,"date")),t&2){u(2);let e=k(2);y(" ",F(1,1,e.Birthdate,"dd.MM.yyyy")," ")}}function Nr(t,o){if(t&1&&l(0),t&2){u(2);let e=k(2);y(" (",e.Gender,") ")}}function Wr(t,o){if(t&1&&(l(0),C(1,"br")),t&2){u(2);let e=k(2);y(" ",e.AddressLine1,"")}}function Ur(t,o){if(t&1&&(l(0),C(1,"br")),t&2){u(2);let e=k(2);y(" ",e.AddressLine2,"")}}function zr(t,o){if(t&1&&(l(0),C(1,"br")),t&2){u(2);let e=k(2);We(" ",e.Zip," ",e.Location,"")}}function qr(t,o){if(t&1&&(a(0,"a",4),l(1),s(),C(2,"br")),t&2){u(2);let e=k(2);Ne("href","tel:",e.PhonePrivate,"",de),r(),f(e.PhonePrivate)}}function Kr(t,o){if(t&1&&(a(0,"a",4),l(1),s(),C(2,"br")),t&2){u(2);let e=k(2);Ne("href","tel:",e.PhoneMobile,"",de),r(),f(e.PhoneMobile)}}function Yr(t,o){if(t&1&&(a(0,"a",4),l(1),s(),C(2,"br")),t&2){u(2);let e=k(2);Ne("href","mailto:",e.Email,"",de),r(),y(" ",e.Email," ")}}function Qr(t,o){if(t&1&&(a(0,"a",4),l(1),s(),C(2,"br")),t&2){u(2);let e=k(2);Ne("href","mailto:",e.Email2,"",de),r(),y(" ",e.Email2," ")}}function Zr(t,o){if(t&1&&(a(0,"h1"),l(1),s(),a(2,"span",3),b(3,jr,2,4)(4,Nr,1,1),s(),a(5,"address"),b(6,Wr,2,1)(7,Ur,2,1)(8,zr,2,2)(9,qr,3,3)(10,Kr,3,3)(11,Yr,3,3)(12,Qr,3,3),s()),t&2){u();let e=k(2);r(),f(e.FullName),r(2),v(e.Birthdate?3:-1),r(),v(e.Gender?4:-1),r(2),v(e.AddressLine1?6:-1),r(),v(e.AddressLine2?7:-1),r(),v(e.Zip&&e.Location?8:-1),r(),v(e.PhonePrivate?9:-1),r(),v(e.PhoneMobile?10:-1),r(),v(e.Email?11:-1),r(),v(e.Email2?12:-1)}}function Jr(t,o){if(t&1&&(a(0,"div",2),l(1),p(2,"translate"),a(3,"span",5),l(4),s()()),t&2){u();let e=k(4);r(),y(" ",c(2,2,"events-students.study-course-detail.status"),": "),r(3),f(e)}}function Xr(t,o){if(t&1&&(a(0,"div",6)(1,"h2"),l(2),s()()),t&2){let e=u().$implicit;r(2),f(e.label)}}function es(t,o){if(t&1&&(a(0,"a",7),l(1),s()),t&2){let e=u(2).$implicit;ge("href",e.file,de),r(),f(e.value)}}function ts(t,o){if(t&1&&l(0),t&2){let e=u(2).$implicit;y(" ",e.value," ")}}function ns(t,o){if(t&1&&(a(0,"div",6)(1,"div"),l(2),s(),b(3,es,2,2,"a",7)(4,ts,1,1),s()),t&2){let e=u().$implicit;r(2),f(e.label),r(),v(e.file!==null?3:4)}}function is(t,o){if(t&1&&b(0,Xr,3,1,"div",6)(1,ns,5,2,"div",6),t&2){let e=o.$implicit;v(e.heading?0:e.value?1:-1)}}function rs(t,o){t&1&&C(0,"bkd-spinner")}var gi=(()=>{class t{constructor(){this.settings=h(_e),this.route=h(ve),this.personsService=h(dt),this.subscriptionsService=h(Ve),this.storageService=h($e),this.loadingService=h(we),this.eventId$=this.route.parent?.paramMap.pipe(x(e=>Number(e.get("id"))))??j(0),this.personId$=this.route.paramMap.pipe(x(e=>Number(e.get("id")))),this.person=pe(this.personId$.pipe(L(e=>this.personsService.get(e))),{initialValue:null}),this.subscription=pe(this.loadSubscription()),this.subscriptionId=G(()=>this.subscription()?.Id??null),this.subscriptionDetails=pe(this.loadSubscriptionDetails(),{initialValue:[]}),this.backLink=pe(this.route.queryParams.pipe(x(({returnparams:e})=>e),x(wn))),this.loading=pe(this.loadingService.loading$,{initialValue:!0})}loadSubscription(){return this.loadingService.load(q([this.eventId$,this.personId$]).pipe(L(([e,n])=>this.subscriptionsService.getSubscriptionsByCourse(e,{"filter.PersonId":`=${n}`})),x(e=>e[0]??null)),{stopOnFirstValue:!0})}loadSubscriptionDetails(){return this.loadingService.load(Xe(this.subscriptionId).pipe(be(ce),L(e=>this.subscriptionsService.getSubscriptionDetailsById(e)),x(e=>e.map(n=>this.toSubscriptionDetailsEntry(n)))),{stopOnFirstValue:!0})}toSubscriptionDetailsEntry(e){let n=e.Value??"";return n=this.normalizeSubscriptionDetailsDropdownValue(e,n)??"",{id:e.Id,label:e.VssDesignation,value:n,file:this.buildFileUrl(e),heading:e.VssStyle==="HE"}}normalizeSubscriptionDetailsDropdownValue(e,n){return e.DropdownItems&&e.VssStyle!=="CB"?e.DropdownItems.find(i=>String(i.Key)===n)?.Value??n:n}buildFileUrl(e){if(e.VssStyle==="PD"||e.VssStyle==="PF"||e.VssStyle==="DA"){let n=this.storageService.getAccessToken()||"";return`${this.settings.apiUrl}/Files/SubscriptionDetails/${e.Id}?token=${n}`}return null}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-study-course-detail"]],decls:9,vars:6,consts:[[1,"bkd-container","bkd-container-limited"],["link","../..",3,"params"],[1,"status"],[1,"additional-info"],[3,"href"],[1,"ms-2"],[1,"detail"],["target","_blank",3,"href"]],template:function(n,i){if(n&1&&(a(0,"div",0),C(1,"bkd-backlink",1),D(2),b(3,Zr,13,10),D(4),b(5,Jr,5,4,"div",2),V(6,is,2,1,null,null,Hr),b(8,rs,1,0,"bkd-spinner"),s()),n&2){let d;r(),m("params",i.backLink()),r();let g=R(i.person());r(),v(g?3:-1),r();let S=R((d=i.subscription())==null?null:d.Status);r(),v(S?5:-1),r(),A(i.subscriptionDetails()),r(2),v(i.loading()?8:-1)}},dependencies:[P,Te,Ee,me],styles:["h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}address[_ngcontent-%COMP%]{margin:1rem 0}.status[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem 0;border-top:1px solid #dee2e6;border-bottom:1px solid #dee2e6}.detail[_ngcontent-%COMP%]{max-width:70ch;padding-top:1rem}.detail[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.detail[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-weight:400;color:#00000080}"],changeDetection:0})}}return t})();var fi=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students"]],features:[le([bt])],decls:1,vars:0,template:function(n,i){n&1&&C(0,"router-outlet")},dependencies:[Ie],encapsulation:2,changeDetection:0})}}return t})();var ss=t=>[t,"tests"];function as(t,o){if(t&1&&(a(0,"span"),l(1),p(2,"date"),C(3,"wbr"),l(4),p(5,"date"),s()),t&2){let e=u();r(),y("",F(2,2,e.event().dateFrom,"dd.MM.yyyy"),"\u2013"),r(3),f(F(5,5,e.event().dateTo,"dd.MM.yyyy"))}}function os(t,o){if(t&1&&(a(0,"a",6)(1,"i",8),l(2,"arrow_right_alt"),s(),a(3,"span",9),l(4),s()()),t&2){let e=u(2);m("routerLink",$(2,ss,e.event().id)),r(4),f(e.event().evaluationText)}}function ds(t,o){if(t&1&&(a(0,"a",7)(1,"i",8),l(2,"arrow_right_alt"),s(),a(3,"span",9),l(4),s()()),t&2){let e=u(2);m("href",e.event().evaluationLink,de),r(4),y("",e.event().evaluationText," ")}}function ls(t,o){if(t&1&&(a(0,"div",5),b(1,os,5,4,"a",6)(2,ds,5,2,"a",7),s()),t&2){let e=u();r(),v(e.event().evaluationLink?-1:1),r(),v(e.event().evaluationLink?2:-1)}}var Ci=(()=>{class t{constructor(){this.event=I.required(),this.withRatings=I(!0),this.link=G(()=>Pn(this.event().detailLink))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-list-entry"]],inputs:{event:[1,"event"],withRatings:[1,"withRatings"]},decls:11,vars:9,consts:[[1,"designation"],[3,"routerLink","queryParams"],[1,"date"],[1,"registrations"],[1,"registrations-label"],[1,"rating"],[1,"d-flex",3,"routerLink"],[1,"d-flex",3,"href"],[1,"material-icons"],[1,"ps-1"]],template:function(n,i){n&1&&(a(0,"div",0)(1,"a",1),l(2),s()(),a(3,"div",2),b(4,as,6,8,"span"),s(),a(5,"div",3),l(6),a(7,"span",4),l(8),p(9,"translate"),s()(),b(10,ls,3,2,"div",5)),n&2&&(r(),m("routerLink",i.link().link)("queryParams",i.link().params),r(),f(i.event().designation),r(2),v(i.event().dateFrom&&i.event().dateTo?4:-1),r(2),y(" ",i.event().studentCount," "),r(2),f(c(9,7,i.event().studentCount===1?"events.registration":"events.registrations")),r(2),v(i.withRatings()&&i.event().evaluationText?10:-1))},dependencies:[X,Te,P],styles:['[_nghost-%COMP%]{display:grid;padding:1rem;border-bottom:1px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}.designation[_ngcontent-%COMP%]{grid-area:designation;padding-right:1rem}.date[_ngcontent-%COMP%]{grid-area:date;padding-right:1rem}.registrations[_ngcontent-%COMP%]{grid-area:registrations;padding-right:1rem}.rating[_ngcontent-%COMP%]{grid-area:rating}.rating[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.registrations-label[_ngcontent-%COMP%]{display:none}@media (max-width: 575.98px){.registrations-label[_ngcontent-%COMP%]{display:inline}.designation[_ngcontent-%COMP%], .date[_ngcontent-%COMP%], .registrations[_ngcontent-%COMP%]{padding-right:0}[_nghost-%COMP%]{grid-template-areas:"designation" "date" "registrations" "rating";grid-template-columns:1fr}}']})}}return t})();var ps=(t,o)=>o.id,cs=()=>[];function ms(t,o){t&1&&C(0,"bkd-spinner")}function us(t,o){t&1&&(a(0,"div",7),l(1),p(2,"translate"),s()),t&2&&(r(),y(" ",c(2,1,"events.rating")," "))}function hs(t,o){if(t&1&&C(0,"bkd-events-list-entry",8),t&2){let e=o.$implicit,n=u(3);m("event",e)("withRatings",n.withRatings)}}function gs(t,o){if(t&1&&(a(0,"div",3)(1,"div",4),l(2),p(3,"translate"),s(),a(4,"div",5),l(5),p(6,"translate"),s(),a(7,"div",6),l(8),p(9,"translate"),s(),b(10,us,3,3,"div",7),s(),V(11,hs,1,2,"bkd-events-list-entry",8,ps)),t&2){let e=u(2),n=k(0);r(2),f(c(3,4,"events.designation")),r(3),f(c(6,6,"events.date")),r(3),y(" ",c(9,8,"events.registrations")," "),r(2),v(e.withRatings?10:-1),r(),A(n)}}function fs(t,o){t&1&&(a(0,"p",2),l(1),p(2,"translate"),s()),t&2&&(r(),f(c(2,1,"events.no-events")))}function Cs(t,o){if(t&1&&b(0,gs,13,10)(1,fs,3,3,"p",2),t&2){u();let e=k(0);v(e.length>0?0:1)}}var vi=["designation"],vs=[...vi,"evaluationText"],xt=(()=>{class t{constructor(){this.state=h(He),this.storage=h($e),this.withStudyCourses=!1,this.withRatings=!0,this.state.setRoles(this.storage.getPayload()?.roles??null)}ngOnChanges(e){e.withStudyCourses&&this.state.setWithStudyCourses(e.withStudyCourses.currentValue),e.withRatings&&this.state.setSearchFields(e.withRatings.currentValue?vs:vi)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-list"]],inputs:{withStudyCourses:"withStudyCourses",withRatings:"withRatings"},features:[Me],decls:10,vars:17,consts:[[1,"bkd-container"],[1,"d-flex","search",3,"valueChange","value","placeholder","label","disabled"],[1,"mt-3"],[1,"event-header"],[1,"designation"],[1,"date"],[1,"registrations"],[1,"rating"],[3,"event","withRatings"]],template:function(n,i){if(n&1){let d=O();D(0),p(1,"async"),a(2,"div",0)(3,"bkd-resettable-input",1),p(4,"async"),p(5,"translate"),p(6,"translate"),E("valueChange",function(S){return T(d),w(i.state.setSearch(S))}),s(),b(7,ms,1,0,"bkd-spinner"),p(8,"async"),b(9,Cs,2,1),s()}if(n&2){let d,g=R((d=c(1,5,i.state.getEntries(i.withRatings)))!==null&&d!==void 0?d:fe(16,cs));r(3),m("value",c(4,8,i.state.search$))("placeholder",c(5,10,"events.search-by"))("label",c(6,12,"events.search"))("disabled",!g),r(4),v(c(8,14,i.state.loading$)?7:9)}},dependencies:[ft,me,K,P,Ci],styles:['.search[_ngcontent-%COMP%]{max-width:500px}.event-header[_ngcontent-%COMP%]{display:grid;padding:1rem;border-bottom:2px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr;font-weight:500}@media (max-width: 575.98px){.event-header[_ngcontent-%COMP%]{display:none}}']})}}return t})();var _i=(()=>{class t{constructor(){}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-tests"]],decls:4,vars:4,consts:[[3,"withRatings"]],template:function(n,i){n&1&&(a(0,"h1"),l(1),p(2,"translate"),s(),C(3,"bkd-events-list",0)),n&2&&(r(),f(c(2,2,"events.title")),r(2),m("withRatings",!0))},dependencies:[xt,P],encapsulation:2})}}return t})();function Ot(t){return t.map(({finalGrade:o})=>o).filter(_s)}function _s(t){return t!==null}function Si(t,o,e,n){return t?.map(i=>({student:i,finalGrade:bs(i,e,n),grades:ys(i,o)}))}function ys(t,o){return o.map(e=>{if(e.Results===void 0||e.Results?.length===0)return{kind:"no-result",test:e};let n=e.Results?.find(i=>i.StudentId===t.Id);return n!==void 0?{kind:"grade",result:n,test:e}:{kind:"no-result",test:e}})}function bs(t,o,e){let n=o.find(d=>d.StudentId===t.Id);if(n)return{gradingId:n.Id,gradeId:n.GradeId??void 0,average:n.AverageTestResult||void 0,canGrade:n.CanGrade};let i=e.find(d=>d.StudentId===t.Id);if(i)return{finalGradeValue:i.Grade,average:i.AverageTestResult||void 0,canGrade:!1};throw new Error(`Student ${t.FullName} has neither a grading and nor a final grade, this should not happen`)}var xi=({primarySortKey:t,ascending:o},e)=>{let n=o?1:-1,i=null;if(t.startsWith("Test-")){let d=Number(t.replace("Test-",""));i=e.find(g=>g.Id===d)??null}return(d,g)=>{switch(t){case"FullName":return n*d.student.FullName.localeCompare(g.student.FullName);case"FinalGrade":return!d.finalGrade?.gradeId||!g.finalGrade?.gradeId?n*-1:n*yi(d.finalGrade.gradeId,g.finalGrade.gradeId);case"TestsMean":return!d.finalGrade?.average||!g.finalGrade?.average?n*-1:n*yi(d.finalGrade.average,g.finalGrade.average);default:return t.startsWith("Test-")&&i?n*Ss(i,d,g):0}}},Ss=(t,o,e)=>{let n=o.grades.filter(bi).find(d=>d.test.Id===t.Id),i=e.grades.filter(bi).find(d=>d.test.Id===t.Id);return t.IsPointGrading&&n?.result.GradeId===i?.result.GradeId?(n?.result.Points??0)-(i?.result.Points??0):((n?.result.GradeId??Number.POSITIVE_INFINITY)-(i?.result.GradeId??Number.POSITIVE_INFINITY))*-1};function yi(t,o){return t===o?0:t<o?-1:1}function bi(t){return t.kind==="grade"}function Ti(t){return(t?.test?.MaxPointsAdjusted||t?.test?.MaxPoints)??0}function wi(t){let o=t.map(e=>e.average).filter(e=>e!=null&&e!==0).map(Number);return kt(o)}function Pi(t,o){return kt(t.map(e=>xs(e,o)).filter(yn))}function xs({gradeId:t,finalGradeValue:o},e){let n;t?n=e.find(g=>g.Key===t)?.Value:n=o;let i=Number(n);return isNaN(i)?0:i}var Ei=(()=>{class t extends ot{constructor(){let e=h(Je),n=h(_e);super(e,n,Rn,"Gradings")}updateGrade(e,n){return this.http.put(`${this.baseUrl}/${e}`,{GradeId:n}).pipe(x(()=>e))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=ae({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Lt(t,o){return[...o.filter(e=>e.Id!==t?.Id),t].filter(e=>e!=null)}function ki({id:t,selectedGradeId:o},e){return e.map(n=>n.Id!==t?n:H(B({},n),{GradeId:o}))}function Mi(t,o){switch(o.type){case"reset":return o.payload;case"updateResult":return t?H(B({},t),{Tests:Dn(o.payload.testResult,t.Tests||[],o.payload.ignore),Gradings:o.payload.grading?Lt(o.payload.grading,t.Gradings||[]):t.Gradings}):null;case"deleteResult":return t?H(B({},t),{Tests:$n(o.payload.testId,o.payload.studentId,t.Tests||[]),Gradings:o.payload.grading?Lt(o.payload.grading,t.Gradings||[]):t.Gradings||[]}):null;case"toggle-test-state":return t?H(B({},t),{Tests:Fn(o.payload,t.Tests||[])}):null;case"final-grade-overwritten":return t?H(B({},t),{Gradings:ki({id:o.payload.id,selectedGradeId:o.payload.selectedGradeId},t.Gradings||[])}):null;case"replace-grades":return t?H(B({},t),{Gradings:o.payload}):null;case"delete-test":return t?H(B({},t),{Tests:Gn(o.payload,t.Tests||[])}):null;default:return t}}var Dt={onlyMine:!1,hidePublished:!1},Q=(()=>{class t{constructor(){this.coursesRestService=h(ye),this.gradingScalesRestService=h(Vn),this.gradingsRestService=h(Ei),this.loadingService=h(we),this.sortService=h(zn),this.action$=new Pt(1),this.loading$=this.loadingService.loading$,this._courseId$=new Pt(1),this.courseId$=this._courseId$.asObservable(),this.fetchedCourse$=this._courseId$.pipe(L(e=>this.loadingService.load(this.coursesRestService.getExpandedCourse(e))),J(1)),this.course$=qe(this.action$,this.fetchedCourse$.pipe(be(ce),x(e=>({type:"reset",payload:e})))).pipe(Vt(Mi,null),be(ce),J(1)),this.tests$=this.course$.pipe(x(e=>e.Tests||[]),x(Bn)),this.hasTests$=this.tests$.pipe(x(e=>e.length>0)),this.filterSubject$=new z(Dt),this.filter$=this.filterSubject$.asObservable(),this.expandedHeaderSubject$=new z(!1),this.expandedHeader$=this.expandedHeaderSubject$.asObservable(),this.filteredTests$=q([this.tests$,this.filter$]).pipe(x(([e,n])=>e.filter(i=>(!n.onlyMine||i.IsOwner)&&(!n.hidePublished||!i.IsPublished)))),this.sortCriteria$=this.sortService.sortCriteria$,this.sortCriteria=this.sortService.sortCriteria,this.studentGrades$=q([this.course$,this.filteredTests$,this.sortCriteria$]).pipe(x(Ge(this.toStudentGrades.bind(this)))),this.canSetFinalGrade$=this.course$.pipe(x(Kn)),this.gradingScaleIds$=this.course$.pipe(x(e=>Cn([...(e.Tests??[]).map(n=>n.GradingScaleId),e.GradingScaleId]).filter(ce)),Z(fn),J(1)),this.gradingScales$=this.gradingScaleIds$.pipe(L(e=>this.gradingScalesRestService.getGradingScales(e)),J(1)),this.UNDEFINED_GRADINGSCALE_ID=-1,this.gradingScalesOptions$=this.gradingScales$.pipe(x(e=>e.map(n=>{let i=n?.Id||this.UNDEFINED_GRADINGSCALE_ID,d=n?.Grades.map(g=>({Key:g.Id,Value:g.Designation}))||[];return{id:i,options:d}}).reduce((n,i)=>H(B({},n),{[i.id]:i.options}),{})),J(1)),this.meanOfStudentGradesForCourse$=this.studentGrades$.pipe(x(e=>wi(Ot(e)))),this.meanOfFinalGradesForCourse$=q([this.gradingScalesOptions$,this.studentGrades$]).pipe(L(Ge(this.meanOfOverwrittenGradesForCourse.bind(this))))}setCourseId(e){this._courseId$.next(e)}reload(){this._courseId$.pipe(te(1)).subscribe(e=>{this.setCourseId(e)})}setFilter(e){this.filterSubject$.next(e)}gradingOptionsForTest$(e){return this.gradingOptions$(e.GradingScaleId)}gradingOptionsForCourse$(){return this.course$.pipe(L(e=>this.gradingOptions$(e.GradingScaleId)))}toStudentGrades(e,n=[],i){let d=Si(e.ParticipatingStudents??[],n,e.Gradings??[],e.FinalGrades??[]);return i?d.sort(xi(i,n)):d}toggleHeader(e){this.expandedHeaderSubject$.next(e)}optimisticallyUpdateGrade(e){return this.course$.pipe(te(1),x(n=>{let{originalResult:i,updatedResult:d}=this.buildOptimisticResultUpdate(n,e);return this.updateTestResult(d,null),i}))}saveGrade(e,n){this.course$.pipe(te(1),L(i=>this.coursesRestService.updateTestResult(i.Id,e).pipe(Gt(d=>(n&&this.updateTestResult(B({},n),null),Ft(()=>d)))))).subscribe(({testResult:i,grading:d})=>this.updateOrDeleteTestResult(e.testId,e.studentId,i,d,"gradeId"in e?"grade":"points"))}publish(e){this.coursesRestService.publishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}unpublish(e){this.coursesRestService.unpublishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}deleteTest(e){this.action$.next({type:"delete-test",payload:e})}overwriteFinalGrade({id:e,selectedGradeId:n}){this.gradingsRestService.updateGrade(e,n).subscribe(()=>{this.action$.next({type:"final-grade-overwritten",payload:{id:e,selectedGradeId:n}})})}setAveragesAsFinalGrades(e){this.coursesRestService.setAverageAsFinalGrade(e).subscribe(n=>this.action$.next({type:"replace-grades",payload:n.Gradings}))}buildOptimisticResultUpdate(e,n){let i=Ln(e,n.testId,n.studentId),d=i?B({},i):{Id:"",TestId:n.testId,StudentId:n.studentId,CourseRegistrationId:0,GradeId:null,GradeValue:null,GradeDesignation:null,Points:null};return d.GradeId="gradeId"in n?n.gradeId:i?.GradeId??null,d.Points="points"in n?n.points:i?.Points??null,{originalResult:i,updatedResult:d}}updateOrDeleteTestResult(e,n,i,d,g){i?this.updateTestResult(i,d,g):this.deleteTestResult(e,n,d)}updateTestResult(e,n,i){this.action$.next({type:"updateResult",payload:{testResult:e,grading:n??null,ignore:i}})}deleteTestResult(e,n,i){this.action$.next({type:"deleteResult",payload:{testId:e,studentId:n,grading:i}})}toggleTestPublishedState(e){this.action$.next({type:"toggle-test-state",payload:e})}gradingOptions$(e){return e===null?j(null):this.gradingScalesOptions$.pipe(x(n=>n[e]),J(1))}meanOfOverwrittenGradesForCourse(e,n){return this.course$.pipe(x(i=>{if(i.GradingScaleId===null||e[i.GradingScaleId]===void 0)return null;let d=e[i.GradingScaleId];return Pi(Ot(n),d)}))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=ae({token:t,factory:t.\u0275fac})}}return t})();function Ii(t){return o=>{let e=Number(o.value);return e<=t?{greaterThan:{value:e,greaterThanValue:t}}:null}}var ws=t=>["/events",t,"tests"];function Ps(t,o){if(t&1&&(a(0,"div",7),l(1),p(2,"translate"),s()),t&2){let e=o.$implicit;r(),y(" ",F(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Es(t,o){if(t&1&&(a(0,"div",7),l(1),p(2,"translate"),s()),t&2){let e=o.$implicit;r(),y(" ",F(2,1,"global.validation-errors."+e.error,e.params)," ")}}function ks(t,o){if(t&1&&(a(0,"div",7),l(1),p(2,"translate"),s()),t&2){let e=o.$implicit;r(),y(" ",F(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Ms(t,o){if(t&1&&(a(0,"div",7),l(1),p(2,"translate"),s()),t&2){let e=o.$implicit;r(),y(" ",F(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Is(t,o){if(t&1&&(a(0,"div",7),l(1),p(2,"translate"),s()),t&2){let e=o.$implicit;r(),y(" ",F(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Os(t,o){if(t&1&&(a(0,"div",29)(1,"div",30)(2,"div",16)(3,"label",31),l(4),p(5,"translate"),s(),a(6,"div",32),C(7,"input",33),p(8,"async"),V(9,Ms,3,4,"div",7,xe),p(11,"async"),s()()(),a(12,"div",30)(13,"div",16)(14,"label",34),l(15),p(16,"translate"),s(),a(17,"div",32),C(18,"input",35),p(19,"async"),V(20,Is,3,4,"div",7,xe),p(22,"async"),s()()()(),a(23,"div",36),jt(),a(24,"math")(25,"mi"),l(26),p(27,"translate"),s(),a(28,"mo"),l(29,"="),s(),a(30,"mfrac")(31,"mrow")(32,"mi"),l(33),p(34,"translate"),s(),a(35,"mo"),l(36,"\xD7"),s(),a(37,"mn"),l(38,"5"),s()(),a(39,"mi"),l(40),p(41,"translate"),s()(),a(42,"mo"),l(43,"+"),s(),a(44,"mn"),l(45,"1"),s()()()),t&2){let e,n,i=u(2);r(4),f(c(5,9,"tests.form.max-points")),r(3),Y("is-invalid",((e=c(8,11,i.maxPointsErrors$))==null?null:e.length)||!1),r(2),A(c(11,13,i.maxPointsErrors$)),r(6),f(c(16,15,"tests.form.max-points-adjusted")),r(3),Y("is-invalid",((n=c(19,17,i.maxPointsAdjustedErrors$))==null?null:n.length)||!1),r(2),A(c(22,19,i.maxPointsAdjustedErrors$)),r(6),y(" ",c(27,21,"tests.form.math.grade")," "),r(7),y(" ",c(34,23,"tests.form.math.points")," "),r(7),f(c(41,25,"tests.form.math.max-points"))}}function Ls(t,o){t&1&&(a(0,"div",28)(1,"span",37),l(2,"Loading..."),s()())}function Ds(t,o){if(t&1){let e=O();a(0,"form",2),E("ngSubmit",function(){T(e);let i=u();return w(i.onSubmit())}),a(1,"div",3)(2,"div",4)(3,"label",5),l(4),p(5,"translate"),s(),C(6,"input",6),p(7,"async"),p(8,"translate"),V(9,Ps,3,4,"div",7,xe),p(11,"async"),s(),a(12,"div",8)(13,"label",9),l(14),p(15,"translate"),s(),a(16,"div",10)(17,"span",11)(18,"i",12),l(19,"calendar_today"),s()(),a(20,"input",13,0),p(22,"async"),p(23,"translate"),E("click",function(){T(e);let i=he(21);return w(i.toggle())}),s(),V(24,Es,3,4,"div",7,xe),p(26,"async"),s()()(),a(27,"div",14)(28,"label",15),l(29),p(30,"translate"),s(),a(31,"div",4)(32,"div",16)(33,"label",17),l(34),p(35,"translate"),s(),a(36,"div",18),C(37,"input",19),p(38,"async"),V(39,ks,3,4,"div",7,xe),p(41,"async"),s()()()(),a(42,"div")(43,"label",15),l(44),p(45,"translate"),s(),a(46,"div",20),C(47,"input",21),a(48,"label",22),l(49),p(50,"translate"),s()(),a(51,"div",20),C(52,"input",23),a(53,"label",24),l(54),p(55,"translate"),s()(),b(56,Os,46,27),s(),a(57,"div",25)(58,"button",26),p(59,"async"),l(60),p(61,"translate"),s(),a(62,"button",27),l(63),p(64,"translate"),b(65,Ls,3,0,"div",28),s()()()}if(t&2){let e,n,i,d,g=u();m("formGroup",g.formGroup),r(4),f(c(5,26,"tests.form.designation")),r(2),Y("is-invalid",((e=c(7,28,g.designationErrors$))==null?null:e.length)||!1),m("placeholder",c(8,30,"tests.form.designation-placeholder")),r(3),A(c(11,32,g.designationErrors$)),r(5),f(c(15,34,"tests.form.date")),r(3),m("id",g.componentId),r(3),Y("is-invalid",((n=c(22,36,g.dateErrors$))==null?null:n.length)||!1),m("placeholder",c(23,38,"shared.date-select.default-placeholder")),r(4),A(c(26,40,g.dateErrors$)),r(5),f(c(30,42,"tests.form.weight")),r(5),f(c(35,44,"tests.form.factor")),r(3),Y("is-invalid",((i=c(38,46,g.weightErrors$))==null?null:i.length)||!1),r(2),A(c(41,48,g.weightErrors$)),r(5),f(c(45,50,"tests.form.grading-type")),r(3),m("value",!1),r(2),f(c(50,52,"tests.form.grades")),r(3),m("value",!0),r(2),f(c(55,54,"tests.form.points")),r(2),v((d=g.formGroup.get("isPointGrading"))!=null&&d.value?56:-1),r(2),m("disabled",g.saving)("routerLink",$(62,ws,c(59,56,g.courseId$))),r(2),y(" ",c(61,58,"tests.form.cancel")," "),r(2),m("disabled",g.saving),r(),y(" ",c(64,60,"tests.form.save")," "),r(2),v(g.saving?65:-1)}}var Tt=(()=>{class t{constructor(){this.fb=h(pn),this.translate=h(ne),this.testStateService=h(Q),this.test=null,this.saving=!1,this.save=new ie,this.componentId=vn("bkd-tests-edit-form"),this.formGroup=this.createFormGroup(),this.submitted$=new z(!1),this.destroy$=new se,this.designationErrors$=Fe(j(this.formGroup),this.submitted$,"designation"),this.dateErrors$=Fe(j(this.formGroup),this.submitted$,"date"),this.maxPointsErrors$=Fe(j(this.formGroup),this.submitted$,"maxPoints"),this.maxPointsAdjustedErrors$=Fe(j(this.formGroup),this.submitted$,"maxPointsAdjusted"),this.weightErrors$=Fe(j(this.formGroup),this.submitted$,"weight"),this.courseId$=this.testStateService.courseId$}ngOnInit(){this.test&&this.setInitialValues(this.test),bn(j(this.formGroup),"isPointGrading").pipe(Se(this.destroy$)).subscribe(this.togglePointFieldsDisability.bind(this))}ngOnDestroy(){this.destroy$.next()}onSubmit(){this.submitted$.next(!0),this.formGroup.valid&&this.save.emit(this.formGroup.value)}createFormGroup(){return this.fb.group({designation:["",Le.required],date:[null,Le.required],weight:[1,Le.compose([Le.required,Ii(0)])],isPointGrading:[!1],maxPoints:[{value:null,disabled:!0},Le.required],maxPointsAdjusted:[{value:null,disabled:!0},null]})}setInitialValues(e){this.formGroup.patchValue({designation:e.Designation,date:e.Date,weight:e.Weight,isPointGrading:e.IsPointGrading,maxPoints:e.MaxPoints,maxPointsAdjusted:e.MaxPointsAdjusted}),e.Results&&e.Results.length>0&&(this.formGroup.get("isPointGrading")?.disable(),this.formGroup.get("maxPoints")?.disable(),this.formGroup.get("maxPointsAdjusted")?.disable()),this.togglePointFieldsDisability()}togglePointFieldsDisability(){let e=this.formGroup.get("maxPoints"),n=this.formGroup.get("maxPointsAdjusted");this.formGroup.get("isPointGrading")?.value?(e?.enable(),n?.enable()):(e?.reset({value:this.test?.MaxPoints,disabled:!0}),n?.reset({value:this.test?.MaxPointsAdjusted,disabled:!0}))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-edit-form"]],inputs:{test:"test",saving:"saving"},outputs:{save:"save"},features:[le([{provide:mn,useClass:gn},{provide:un,useClass:qn}])],decls:1,vars:1,consts:[["dp","ngbDatepicker"],[3,"formGroup"],[3,"ngSubmit","formGroup"],[1,"row","g-3","mb-3"],[1,"col-md-6"],["for","designation",1,"form-label"],["id","designation","name","designation","type","text","formControlName","designation","required","",1,"form-control",3,"placeholder"],[1,"invalid-feedback"],[1,"col-md-6","mb-3"],["for","date",1,"form-label"],[1,"input-group"],[1,"input-group-text",3,"id"],[1,"material-icons"],["id","date","name","date","type","text","ngbDatepicker","","formControlName","date","required","",1,"form-control",3,"click","placeholder"],[1,"row","mb-3"],[1,"form-label"],[1,"row"],["for","factor",1,"form-label","col-3","col-sm-2"],[1,"col-9","col-sm-10"],["id","factor","name","factor","type","number","formControlName","weight","step","0.05","min","0","required","",1,"form-control"],[1,"form-check"],["type","radio","formControlName","isPointGrading","id","type-grades",1,"form-check-input",3,"value"],["for","type-grades",1,"form-check-label"],["type","radio","formControlName","isPointGrading","id","type-points",1,"form-check-input",3,"value"],["for","type-points",1,"form-check-label"],[1,"d-flex","justify-content-end","mt-4"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","routerLink"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"row","ms-4","mb-3","g-3"],[1,"col-sm-6","col-md-4"],["for","max-points",1,"ms-2","col-4","col-form-label"],[1,"col-6"],["type","number","name","maxPoints","id","max-points","formControlName","maxPoints","step","0.01","min","0","max","999","required","",1,"form-control"],["for","max-points-adjusted",1,"ms-2","col-4","col-form-label"],["type","number","name","maxPointsAdjusted","id","max-points-adjusted","formControlName","maxPointsAdjusted","step","0.01","min","0","max","999",1,"form-control"],[1,"ms-4","ps-3","py-3"],[1,"visually-hidden"]],template:function(n,i){n&1&&b(0,Ds,66,64,"form",1),n&2&&v(i.formGroup?0:-1)},dependencies:[De,sn,et,nt,an,tt,nn,ln,rt,it,cn,on,dn,hn,X,K,P],styles:["#factor[_ngcontent-%COMP%], #max-points[_ngcontent-%COMP%], #max-points-adjusted[_ngcontent-%COMP%]{width:5em}"]})}}return t})();var Oi=(()=>{class t{constructor(){this.courseService=h(ye),this.toastService=h(at),this.translate=h(ne),this.router=h(Oe),this.state=h(Q),this.saving$=new z(!1)}save(e){this.saving$.next(!0);let{designation:n,date:i,weight:d,isPointGrading:g,maxPoints:S,maxPointsAdjusted:ee}=e;this.state.courseId$.pipe(te(1),L(wt=>this.courseService.add(wt,i,n,d,g,S,ee)),Ke(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.state.reload(),this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}navigateBack(){this.state.courseId$.pipe(te(1)).subscribe(e=>void this.router.navigate(["events",e,"tests"]))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-add"]],decls:6,vars:6,consts:[[1,"bkd-container","bkd-container-limited"],[3,"save","saving"]],template:function(n,i){n&1&&(a(0,"h1"),l(1),p(2,"translate"),s(),a(3,"div",0)(4,"bkd-tests-edit-form",1),p(5,"async"),E("save",function(g){return i.save(g)}),s()()),n&2&&(r(),f(c(2,2,"tests.add-title")),r(3),m("saving",c(5,4,i.saving$)))},dependencies:[Tt,K,P],encapsulation:2})}}return t})();var Li=(()=>{class t{constructor(){this.activeModal=h(st)}get canDeleteTest(){return(this.test?.Results?.filter(n=>n.GradeId!==null||n.GradeValue!==null||n.Points!==null)||[]).length===0}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-delete"]],inputs:{test:"test"},decls:13,vars:10,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click","hidden"],[1,"px-2"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"],[1,"px-3"]],template:function(n,i){n&1&&(a(0,"div",0)(1,"p",1),l(2),p(3,"translate"),s()(),a(4,"div",2)(5,"button",3),E("click",function(){return i.activeModal.dismiss()}),a(6,"span",4),l(7),p(8,"translate"),s()(),a(9,"button",5),E("click",function(){return i.activeModal.close(i.canDeleteTest?i.test:null)}),a(10,"span",6),l(11),p(12,"translate"),s()()()),n&2&&(r(2),y(" ",c(3,4,i.canDeleteTest?"tests.form.confirm":"tests.form.delete-not-allowed")," "),r(3),m("hidden",!i.canDeleteTest),r(2),y(" ",c(8,6,"tests.dialog.no")," "),r(4),y(" ",c(12,8,i.canDeleteTest?"tests.dialog.yes":"tests.dialog.ok")," "))},dependencies:[P],encapsulation:2})}}return t})();var $s=t=>({test:t});function Fs(t,o){t&1&&C(0,"bkd-spinner")}function Gs(t,o){if(t&1){let e=O();a(0,"div",1)(1,"h1"),l(2),p(3,"translate"),s(),a(4,"button",2),E("click",function(){T(e);let i=u(),d=k(0);return w(i.openDeleteModal(d))}),a(5,"i",3),l(6,"delete"),s()()(),a(7,"bkd-tests-edit-form",4),E("save",function(i){T(e);let d=u();return w(d.save(i))}),s()}if(t&2){u();let e=k(0),n=k(2);r(2),y(" ",F(3,3,"tests.edit-title",$(6,$s,e.Designation))," "),r(5),m("test",e)("saving",n)}}var Di=(()=>{class t{constructor(){this.state=h(Q),this.courseService=h(ye),this.route=h(ve),this.toastService=h(at),this.translate=h(ne),this.router=h(Oe),this.modalService=h(ct),this.saving$=new z(!1),this.testId$=this.route.paramMap.pipe(x(e=>Number(e.get("testId"))),Z()),this.test$=q([this.state.tests$,this.testId$]).pipe(x(([e,n])=>e.find(i=>i.Id===n)))}openDeleteModal(e){let n=this.modalService.open(Li);n.componentInstance.test=e,n.result.then(i=>{i&&this.courseService.delete(e.CourseId,e.Id).subscribe(this.onDeleteSuccess.bind(this))},()=>{})}save(e){this.saving$.next(!0);let{designation:n,date:i,weight:d,isPointGrading:g,maxPoints:S,maxPointsAdjusted:ee}=e;q([this.state.courseId$,this.testId$]).pipe(te(1),L(([wt,Zi])=>this.courseService.update(wt,Zi,n,i,d,g,S,ee)),Ke(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.state.reload(),this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}onDeleteSuccess(e){this.toastService.success(this.translate.instant("tests.form.delete-success")),this.state.deleteTest(e),this.navigateBack()}navigateBack(){this.state.courseId$.pipe(te(1)).subscribe(e=>void this.router.navigate(["events",e,"tests"]))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-edit"]],decls:8,vars:9,consts:[[1,"bkd-container","bkd-container-limited"],[1,"d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-primary","btn-icon",3,"click"],[1,"material-icons"],[3,"save","test","saving"]],template:function(n,i){if(n&1&&(D(0),p(1,"async"),D(2),p(3,"async"),a(4,"div",0),b(5,Fs,1,0,"bkd-spinner"),p(6,"async"),b(7,Gs,8,8),s()),n&2){let d=R(c(1,1,i.test$));r(2),R(c(3,4,i.saving$)),r(3),v(c(6,7,i.state.loading$)?5:d?7:-1)}},dependencies:[Tt,me,K,P],encapsulation:2})}}return t})();var Bs=()=>["/events"],Rs=t=>({count:t});function Vs(t,o){if(t&1&&(a(0,"div",7),l(1),p(2,"translate"),s()),t&2){let e=u();r(),y(" ",F(2,1,e.course.ParticipatingStudents.length===1?"courses.registration":"courses.registrations",$(4,Rs,e.course.ParticipatingStudents.length))," ")}}var $i=(()=>{class t{constructor(){this.reportsService=h(Re),this.course$=new z(null),this.reports$=this.course$.pipe(x(e=>e?.Id),Z(),L(e=>e?this.reportsService.getCourseTestsReports(e):j([])),Ye([]))}ngOnChanges(e){e.course&&this.course$.next(e.course.currentValue)}getDesignation(){return vt(this.course)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-header"]],inputs:{course:"course"},features:[Me],decls:12,vars:7,consts:[[3,"link"],[1,"d-flex"],["routerLink","add",1,"edit","btn","btn-primary","btn-icon","ms-2"],[1,"material-icons"],[1,"ms-2",3,"reports"],["id","excel-import"],[1,"d-flex","flex-column","header"],[1,"additional-info"]],template:function(n,i){n&1&&(a(0,"bkd-backlink",0)(1,"div",1)(2,"a",2)(3,"i",3),l(4,"add"),s()(),C(5,"bkd-reports-link",4),p(6,"async"),C(7,"div",5),s()(),a(8,"div",6)(9,"h1"),l(10),s(),b(11,Vs,3,6,"div",7),s()),n&2&&(m("link",fe(6,Bs)),r(5),m("reports",c(6,4,i.reports$)),r(5),f(i.getDesignation()),r(),v(i.course.ParticipatingStudents?11:-1))},dependencies:[Ee,X,Be,K,P],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem;border-bottom:1px solid #dee2e6}h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"]})}}return t})();var As=t=>({designation:t}),Fi=(()=>{class t{constructor(){this.activeModal=h(st)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-publish"]],inputs:{test:"test"},decls:11,vars:12,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"]],template:function(n,i){n&1&&(a(0,"div",0)(1,"p",1),l(2),p(3,"translate"),s()(),a(4,"div",2)(5,"button",3),E("click",function(){return i.activeModal.dismiss()}),l(6),p(7,"translate"),s(),a(8,"button",4),E("click",function(){return i.activeModal.close(!0)}),l(9),p(10,"translate"),s()()),n&2&&(r(2),y(" ",F(3,3,i.test.IsPublished?"tests.publishing.unpublish":"tests.publishing.publish",$(10,As,i.test.Designation))," "),r(4),y(" ",c(7,6,"tests.publishing.cancel")," "),r(3),y(" ",c(10,8,"tests.publishing.confirm")," "))},dependencies:[P],encapsulation:2})}}return t})();function Hs(t,o){if(t&1&&(a(0,"span",1),l(1),s()),t&2){let e=u();r(),f(e.calculatePointsAverage(e.test))}}var Gi=(()=>{class t{constructor(){this.locale=h(Jt)}calculatePointsAverage(e){return this.safeAverage(e,2,lt)}calculateGradeAverage(e){return this.safeAverage(e,3,pt)}safeAverage(e,n,i){try{return jn(i(e),this.locale,n)}catch{return An}}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-average-grades"]],inputs:{test:"test"},decls:4,vars:2,consts:[[1,"d-flex","flex-row","w-100"],["data-testid","average-points",1,"mr-2","mr-md-3","average-points"],["data-testid","average-grade"]],template:function(n,i){n&1&&(a(0,"div",0),b(1,Hs,2,1,"span",1),a(2,"span",2),l(3),s()()),n&2&&(r(),v(i.test.IsPointGrading?1:-1),r(2),f(i.calculateGradeAverage(i.test)))},styles:[".average-points[_ngcontent-%COMP%]{min-width:4.5em}@media (min-width: 576px){.average-points[_ngcontent-%COMP%]{min-width:6em}}"]})}}return t})();var Bi=(()=>{class t{constructor(){this.disabled=!1,this.width="127px",this.gradeIdSelected=new ie}onGradeChange(e){this.gradeId?.valueOf()!==void 0&&this.gradeIdSelected.emit({id:this.gradeId?.valueOf(),selectedGradeId:e})}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-grade-select"]],inputs:{options:"options",valueId:"valueId",gradeId:"gradeId",disabled:"disabled",width:"width"},outputs:{gradeIdSelected:"gradeIdSelected"},decls:1,vars:5,consts:[["data-testid","grade-select",3,"valueChange","options","allowEmpty","value","disabled","width"]],template:function(n,i){n&1&&(a(0,"bkd-select",0),E("valueChange",function(g){return i.onGradeChange(g)}),s()),n&2&&m("options",i.options)("allowEmpty",!0)("value",i.valueId)("disabled",i.disabled)("width",i.width)},dependencies:[Pe],encapsulation:2})}}return t})();var js=t=>({maxPoints:t});function Ns(t,o){if(t&1&&(a(0,"div",6),l(1),p(2,"translate"),s()),t&2){let e=u(2);r(),y(" ",F(2,1,"global.validation-errors.invalidPoints",$(4,js,e.maxPoints))," ")}}function Ws(t,o){if(t&1){let e=O();a(0,"div",3)(1,"input",5,0),E("ngModelChange",function(){T(e);let i=he(2),d=u();return w(d.onPointsChange(i.value))}),s(),b(3,Ns,3,6,"div",6),s()}if(t&2){let e=he(2),n=u();r(),Y("is-invalid",e.errors),ge("max",n.maxPoints),ge("tabindex",n.tabIndex),m("disabled",n.grade.test.IsPublished||n.hasFinalGrade)("ngModel",n.grade.kind==="grade"?n.grade.result.Points:null),r(2),v(e.errors?3:-1)}}var Us=1250,Ri=(()=>{class t{constructor(){this.state=h(Q),this.hasFinalGrade=!1,this.maxPoints=0,this.pointsSubject$=new se,this.gradeSubject$=new se,this.gradingScaleDisabledSubject$=new z(!0),this.gradingScaleDisabled$=this.gradingScaleDisabledSubject$.asObservable(),this.destroy$=new se}ngOnInit(){this.gradingScaleDisabledSubject$.next(this.isGradingScaleDisabled()),this.maxPoints=Ti(this.grade),this.initSave(this.pointsSubject$.pipe(be(this.isValid.bind(this)),x(e=>({studentId:this.student.Id,testId:this.grade.test.Id,points:e?Number(e):null})))),this.initSave(this.gradeSubject$.pipe(x(e=>({studentId:this.student.Id,testId:this.grade.test.Id,gradeId:e}))))}ngOnChanges(){this.gradingScaleDisabledSubject$.next(this.isGradingScaleDisabled())}ngOnDestroy(){this.destroy$.next()}onPointsChange(e){this.pointsSubject$.next(e),this.gradingScaleDisabledSubject$.next(!(e===null||e===""))}onGradeChange(e){this.gradeSubject$.next(e)}isValid(e){return e===""||e===null?!0:isNaN(Number(e))?!1:!(Number(e)<0||Number(e)>this.maxPoints)}initSave(e){e.pipe(Bt(n=>this.state.optimisticallyUpdateGrade(n).pipe(x(i=>({params:n,originalResult:i})))),Rt(Us),Se(this.destroy$)).subscribe(({params:n,originalResult:i})=>this.state.saveGrade(n,i))}isGradingScaleDisabled(){return this.grade.test.IsPublished||this.hasFinalGrade||this.grade.test.IsPointGrading&&this.grade.kind==="grade"&&this.grade.result.Points!=null}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-grade"]],inputs:{grade:"grade",student:"student",tabIndex:"tabIndex",gradeOptions:"gradeOptions",hasFinalGrade:"hasFinalGrade"},features:[Me],decls:5,vars:8,consts:[["points","ngModel"],[1,"d-flex","flex-column","w-100"],[1,"d-flex","flex-row"],[1,"point-input-container","me-2","me-md-3"],["data-testid","grade-select",1,"grade-select",3,"valueChange","options","allowEmpty","value","disabled","tabindex"],["type","number","step","0.01","min","0","data-testid","point-input",1,"form-control",3,"ngModelChange","max","disabled","tabindex","ngModel"],["data-testid","validation-error-message",1,"invalid-feedback"]],template:function(n,i){n&1&&(a(0,"div",1)(1,"div",2),b(2,Ws,4,7,"div",3),a(3,"bkd-select",4),p(4,"async"),E("valueChange",function(g){return i.onGradeChange(g)}),s()()()),n&2&&(r(2),v(i.grade.test.IsPointGrading?2:-1),r(),m("options",i.gradeOptions)("allowEmpty",!0)("value",i.grade.kind==="grade"?i.grade.result.GradeId:null)("disabled",c(4,6,i.gradingScaleDisabled$))("tabindex",i.tabIndex))},dependencies:[De,et,nt,tt,rt,it,rn,Pe,K,P],styles:[".point-input-container[_ngcontent-%COMP%]{width:4em}[_nghost-%COMP%]     select{width:127px}@media (min-width: 576px){.point-input-container[_ngcontent-%COMP%]{width:5em}}"]})}}return t})();var Vi=(t,o)=>({"btn-primary":t,"btn-outline-secondary":o}),Ai=(()=>{class t{constructor(){this.filter=Dt,this.filterChange=new ie}showOnlyMine(){this.filterChange.next(H(B({},this.filter),{onlyMine:!0}))}showAll(){this.filterChange.next(H(B({},this.filter),{onlyMine:!1}))}onHidePublishedChange(e){let n=(e.target&&e.target instanceof HTMLInputElement&&e.target?.checked)??!1;this.filterChange.next(H(B({},this.filter),{hidePublished:n}))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-table-filter"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},decls:13,vars:18,consts:[[1,"only-mine-buttons"],["type","button",1,"btn","desktop",3,"click","ngClass"],["type","button",1,"btn","ms-2","desktop",3,"click","ngClass"],[1,"hide-published"],[1,"form-check"],["id","hide-published","type","checkbox",1,"form-check-input",3,"change","checked"],["for","hide-published",1,"form-check-label"]],template:function(n,i){n&1&&(a(0,"div",0)(1,"button",1),E("click",function(){return i.showAll()}),l(2),p(3,"translate"),s(),a(4,"button",2),E("click",function(){return i.showOnlyMine()}),l(5),p(6,"translate"),s()(),a(7,"div",3)(8,"div",4)(9,"input",5),E("change",function(g){return i.onHidePublishedChange(g)}),s(),a(10,"label",6),l(11),p(12,"translate"),s()()()),n&2&&(r(),m("ngClass",Et(12,Vi,!i.filter.onlyMine,i.filter.onlyMine)),r(),y(" ",c(3,6,"tests.all-tests")," "),r(2),m("ngClass",Et(15,Vi,i.filter.onlyMine,!i.filter.onlyMine)),r(),y(" ",c(6,8,"tests.owned-tests")," "),r(4),m("checked",i.filter.hidePublished),r(2),y(" ",c(12,10,"tests.hide-published")," "))},dependencies:[Ce,De,P],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:100%}.only-mine-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;height:3.625rem}.hide-published[_ngcontent-%COMP%]{display:flex;align-items:center;height:2.375rem;margin-bottom:1rem}.hide-published[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:300}.hide-published[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]{margin-bottom:0}"]})}}return t})();var Hi=(()=>{class t{constructor(){this.translate=h(ne)}transform(e){return`${e.Weight} (${e.WeightPercent}%)${this.getPoints(e)}`}getPoints(e){return e.IsPointGrading?`, ${e.MaxPointsAdjusted??e.MaxPoints} ${this.translate.instant("tests.summary.points")}`:""}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275pipe=qt({name:"testSummaryShort",type:t,pure:!0})}}return t})();var zs=["*"],ji=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-preserve-line-height"]],ngContentSelectors:zs,decls:3,vars:0,template:function(n,i){n&1&&(Kt(),a(0,"div"),Yt(1),l(2,"\xA0"),s())},encapsulation:2})}}return t})();var qs=t=>[t,"edit"];function Ks(t,o){t&1&&(a(0,"i",9),l(1,"edit"),s())}function Ys(t,o){if(t&1&&(a(0,"div",5)(1,"div",7)(2,"bkd-preserve-line-height"),l(3),p(4,"date"),s(),a(5,"a",8),b(6,Ks,2,0,"i",9),s()(),a(7,"bkd-preserve-line-height"),l(8),p(9,"testSummaryShort"),s(),a(10,"bkd-preserve-line-height"),l(11),s()()),t&2){let e=u();r(3),f(F(4,5,e.test.Date,"dd.MM.yyyy")),r(2),m("routerLink",$(10,qs,e.test.Id)),r(),v(e.test.IsOwner&&e.test.IsPublished===!1?6:-1),r(2),y(" ",c(9,8,e.test)," "),r(3),f(e.test.Owner)}}function Qs(t,o){if(t&1){let e=O();a(0,"div",6)(1,"a",10),p(2,"translate"),E("click",function(){T(e);let i=u();return w(i.unpublishTest())}),a(3,"i",11),l(4,"lock"),s(),a(5,"span"),l(6),p(7,"translate"),s()(),a(8,"bkd-caret",12),E("click",function(){T(e);let i=u();return w(i.emitToggleHeader())}),s()()}if(t&2){let e=u();r(),ge("title",c(2,3,"tests.edit")),r(5),f(c(7,5,"tests.published")),r(2),m("expanded",e.expanded)}}function Zs(t,o){if(t&1){let e=O();a(0,"div",6)(1,"a",13),p(2,"translate"),E("click",function(){T(e);let i=u();return w(i.publishTest())}),a(3,"i",11),l(4,"lock_open"),s(),a(5,"span"),l(6),p(7,"translate"),s()(),a(8,"bkd-caret",12),E("click",function(){T(e);let i=u();return w(i.emitToggleHeader())}),s()()}if(t&2){let e=u();r(),ge("title",c(2,3,"tests.publish")),r(5),f(c(7,5,"tests.not-published")),r(2),m("expanded",e.expanded)}}var Ni=(()=>{class t{constructor(){this.toggleHeader=new ie,this.publish=new ie,this.unpublish=new ie}emitToggleHeader(){this.toggleHeader.emit(!this.expanded)}publishTest(){this.publish.emit(this.test)}unpublishTest(){this.unpublish.emit(this.test)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-test-table-test-header"]],inputs:{test:"test",expanded:"expanded"},outputs:{toggleHeader:"toggleHeader",publish:"publish",unpublish:"unpublish"},decls:9,vars:5,consts:[[1,"d-flex","flex-column","h-100","justify-content-between"],["role","button",1,"test-designation","d-flex","flex-row","my-3","align-items-end","justify-content-between",3,"click"],[3,"ngClass"],[1,"align-self-start",3,"expanded"],[1,"d-flex","flex-column"],[1,"d-flex","flex-column","mb-3"],[1,"d-flex","align-items-center","justify-content-between","test-status"],[1,"d-flex","flex-row","justify-content-between"],[1,"btn","btn-link","p-0","edit",3,"routerLink"],[1,"material-icons"],[1,"d-flex","btn","btn-link","ps-0","edit",3,"click","title"],[1,"material-icons","me-1"],[1,"expand-mobile",3,"click","expanded"],[1,"d-flex","btn","btn-link","ps-0",3,"click","title"]],template:function(n,i){n&1&&(a(0,"div",0)(1,"div",1),E("click",function(){return i.emitToggleHeader()}),a(2,"div",2),l(3),s(),C(4,"bkd-caret",3),s(),a(5,"div",4),b(6,Ys,12,12,"div",5)(7,Qs,9,7,"div",6)(8,Zs,9,7,"div",6),s()()),n&2&&(r(2),m("ngClass",i.expanded?"expanded":"collapsed"),r(),y(" ",i.test.Designation," "),r(),m("expanded",i.expanded),r(2),v(i.expanded?6:-1),r(),v(i.test.IsPublished?7:8))},dependencies:[Ce,On,ji,X,Te,P,Hi],styles:["[_nghost-%COMP%]{font-weight:300}.collapsed[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.test-designation[_ngcontent-%COMP%]{display:none!important}.test-status[_ngcontent-%COMP%]{order:-1;padding-bottom:1rem}.test-status[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.test-status[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#000}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.edit[_ngcontent-%COMP%]{color:#00000080;text-decoration:none}@media (min-width: 811px){.test-designation[_ngcontent-%COMP%]{display:inherit!important}.test-status[_ngcontent-%COMP%]{order:initial}.expand-mobile[_ngcontent-%COMP%]{display:none!important}}"]})}}return t})();var Js=["bkdTestsTableHeader",""],$t=(t,o)=>o.Id,Xs=t=>({"test-point-grading":t}),ea=t=>({selected:t});function ta(t,o){if(t&1){let e=O();a(0,"th",3)(1,"bkd-test-table-test-header",12),E("toggleHeader",function(i){T(e);let d=u();return w(d.state.toggleHeader(i))})("publish",function(i){T(e);let d=u();return w(d.publish.emit(i))})("unpublish",function(i){T(e);let d=u();return w(d.unpublish.emit(i))}),s()()}if(t&2){let e=o.$implicit,n=u(),i=k(4);m("ngClass",e.Id===(n.selectedTest==null?null:n.selectedTest.Id)?"selected":""),r(),m("test",e)("expanded",i)}}function na(t,o){if(t&1){let e=O();a(0,"th",4)(1,"bkd-test-table-test-header",12),E("toggleHeader",function(i){T(e);let d=u();return w(d.state.toggleHeader(i))})("publish",function(i){T(e);let d=u();return w(d.publish.emit(i))})("unpublish",function(i){T(e);let d=u();return w(d.unpublish.emit(i))}),s()()}if(t&2){let e=o.$implicit,n=u(),i=k(4);m("ngClass",e.Id===(n.selectedTest==null?null:n.selectedTest.Id)?"selected":""),r(),m("test",e)("expanded",i)}}function ia(t,o){t&1&&(a(0,"div",14),l(1),p(2,"translate"),s()),t&2&&(r(),y(" ",c(2,1,"tests.points")," "))}function ra(t,o){if(t&1){let e=O();a(0,"th",11)(1,"div",13),b(2,ia,3,3,"div",14),a(3,"bkd-sortable-header",8),p(4,"translate"),U("sortCriteriaChange",function(i){T(e);let d=u();return N(d.state.sortCriteria,i)||(d.state.sortCriteria=i),w(i)}),s()()()}if(t&2){let e=o.$implicit,n=u();m("ngClass",e.Id===(n.selectedTest==null?null:n.selectedTest.Id)?"selected":""),r(2),v(e.IsPointGrading?2:-1),r(),m("label",c(4,5,"tests.grade"))("sortKey","Test-"+e.Id),W("sortCriteria",n.state.sortCriteria)}}var Wi=(()=>{class t extends _t{constructor(){super(...arguments),this.state=h(Q),this.publish=new ie,this.unpublish=new ie}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=Qe(t)))(i||t)}})()}static{this.\u0275cmp=_({type:t,selectors:[["thead","bkdTestsTableHeader",""]],inputs:{selectedTest:"selectedTest"},outputs:{publish:"publish",unpublish:"unpublish"},features:[Ze],attrs:Js,decls:27,vars:29,consts:[[1,"header-collapsible"],["colspan","3",1,"desktop","sticky"],[3,"filterChange","filter"],["container","body",1,"test-grade","grade","test-info-desktop",3,"ngClass"],["container","body","colspan","3",1,"test-grade","header-mobile","test-info-mobile",3,"ngClass"],[1,"filler"],[3,"ngClass"],[1,"sticky","student-name"],[3,"sortCriteriaChange","label","sortKey","sortCriteria"],[1,"sticky","student-grade","desktop",3,"ngClass"],[1,"border-end","sticky","student-average","desktop"],["container","body",1,"test-grade",3,"ngClass"],[3,"toggleHeader","publish","unpublish","test","expanded"],[1,"d-flex"],[1,"point-column-title","me-2","me-md-3"]],template:function(n,i){if(n&1){let d=O();D(0),p(1,"async"),D(2),p(3,"async"),D(4),p(5,"async"),a(6,"tr",0)(7,"th",1)(8,"bkd-tests-table-filter",2),E("filterChange",function(S){return T(d),w(i.state.setFilter(S))}),s()(),V(9,ta,2,3,"th",3,$t),V(11,na,2,3,"th",4,$t),C(13,"th",5),s(),a(14,"tr",6)(15,"th",7)(16,"bkd-sortable-header",8),p(17,"translate"),U("sortCriteriaChange",function(S){return T(d),N(i.state.sortCriteria,S)||(i.state.sortCriteria=S),w(S)}),s()(),a(18,"th",9)(19,"bkd-sortable-header",8),p(20,"translate"),U("sortCriteriaChange",function(S){return T(d),N(i.state.sortCriteria,S)||(i.state.sortCriteria=S),w(S)}),s()(),a(21,"th",10)(22,"bkd-sortable-header",8),p(23,"translate"),U("sortCriteriaChange",function(S){return T(d),N(i.state.sortCriteria,S)||(i.state.sortCriteria=S),w(S)}),s()(),V(24,ra,5,7,"th",11,$t),C(26,"th",5),s()}if(n&2){let d=c(1,12,i.state.filteredTests$),g=c(3,14,i.state.filter$);r(4),R(c(5,16,i.state.expandedHeader$)),r(4),m("filter",g),r(),A(d),r(2),A(d),r(3),m("ngClass",$(25,Xs,i.selectedTest==null?null:i.selectedTest.IsPointGrading)),r(2),m("label",c(17,19,"tests.student.name"))("sortKey","FullName"),W("sortCriteria",i.state.sortCriteria),r(2),m("ngClass",$(27,ea,i.selectedTest===void 0)),r(),m("label",c(20,21,"tests.grade"))("sortKey","FinalGrade"),W("sortCriteria",i.state.sortCriteria),r(3),m("label",c(23,23,"tests.mean"))("sortKey","TestsMean"),W("sortCriteria",i.state.sortCriteria),r(2),A(d)}},dependencies:[K,Ce,P,Ai,Ni,Ae],styles:["[_nghost-%COMP%]{--spacer: 16px;--point-input-size: 4em;--grade-input-size: 127px;--points-grade-gap: 1rem;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-average-column-width: 120px;--test-grade-column-width: calc( var(--spacer) + var(--point-input-size) + var(--points-grade-gap) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--student-average-column-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) );--test-columns-offset: calc( var(--student-average-column-offset) + var(--student-average-column-width) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}@media (max-width: 767.98px){[_nghost-%COMP%]{--points-grade-gap: calc(.5 * var(--spacer))}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (min-width: 576px){[_nghost-%COMP%]{--point-input-size: 5em}}tr[_ngcontent-%COMP%]:not(.header-collapsible)   th.test-grade[_ngcontent-%COMP%], td.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}@media (max-width: 810px){tr[_ngcontent-%COMP%]:not(.header-collapsible):not(.test-point-grading)   th.test-grade[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]:not(.test-point-grading)   th.student-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.test-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.student-grade[_ngcontent-%COMP%]{width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));min-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));max-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer))}}th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}th.test-grade[_ngcontent-%COMP%]   .point-column-title[_ngcontent-%COMP%]{width:var(--point-input-size)}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-average[_ngcontent-%COMP%], .test-grade[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex;width:100%}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.test-grade[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}.student-average[_ngcontent-%COMP%]{width:var(--student-average-column-width);min-width:var(--student-average-column-width);max-width:var(--student-average-column-width)}.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}th.sticky.student-average[_ngcontent-%COMP%], td.sticky.student-average[_ngcontent-%COMP%]{left:var(--student-average-column-offset)}}@media (max-width: 1200px){[_nghost-%COMP%]{--student-average-column-width: 1px}.student-average[_ngcontent-%COMP%]{padding:0;overflow:hidden}}@media (min-width: 1201px){.student-average-inline[_ngcontent-%COMP%]{display:none}}.sticky[_nghost-%COMP%]{position:fixed;top:0;left:0;z-index:1000;display:none}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;vertical-align:top}.header-collapsible[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:0 1rem}tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:none!important}@media (min-width: 811px){.sticky.shown[_nghost-%COMP%]{display:table-header-group}tr[_ngcontent-%COMP%]   th.test-info-mobile[_ngcontent-%COMP%]{display:none!important}tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:table-cell!important}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;padding-top:.25rem;padding-bottom:.25rem;border-top:initial}.sticky[_nghost-%COMP%]{margin-left:var(--test-columns-offset)}.sticky[_nghost-%COMP%]   th.sticky[_ngcontent-%COMP%]{position:fixed}}"],changeDetection:0})}}return t})();var sa=(t,o)=>o.student.Id,aa=(t,o)=>o.Id,oa=(t,o)=>o.id,da=t=>({"test-point-grading":t}),Ui=t=>({selected:t}),la=t=>["student",t,"grades"],pa=t=>({"visible-on-mobile":t});function ca(t,o){if(t&1&&(a(0,"div"),l(1),s()),t&2){let e=u().$implicit;r(),y(" ",e.finalGrade.finalGradeValue," ")}}function ma(t,o){if(t&1){let e=O();a(0,"bkd-grade-select",19),p(1,"async"),p(2,"async"),E("gradeIdSelected",function(i){T(e);let d=u(2);return w(d.state.overwriteFinalGrade(i))}),s()}if(t&2){let e,n,i=u().$implicit,d=u();m("options",c(1,4,d.state.gradingOptionsForCourse$()))("valueId",(e=i.finalGrade.gradeId)!==null&&e!==void 0?e:null)("gradeId",(n=i.finalGrade.gradingId)!==null&&n!==void 0?n:null)("disabled",c(2,6,d.isEditFinalGradesAllowed(i))===!1)}}function ua(t,o){if(t&1&&(D(0),a(1,"td",11),C(2,"bkd-grade",20),p(3,"async"),s()),t&2){let e=o.$implicit,n=o.$index,i=u(),d=i.$implicit,g=i.$index,S=u(),ee=e.grade;r(),m("ngClass",S.selectedTest!==void 0&&ee.test.Id===S.selectedTest.Id?"selected":""),r(),m("grade",ee)("gradeOptions",c(3,6,S.state.gradingOptionsForTest$(ee.test)))("student",d.student)("hasFinalGrade",!!d.finalGrade.finalGradeValue)("tabIndex",(1+n)*1e3+g)}}function ha(t,o){if(t&1&&(a(0,"tr")(1,"td",6)(2,"a",15)(3,"div"),l(4),s(),a(5,"div",8),l(6),p(7,"translate"),p(8,"decimalOrDash"),s()()(),a(9,"td",16),b(10,ca,2,1,"div")(11,ma,3,8,"bkd-grade-select",17),s(),a(12,"td",18),l(13),p(14,"decimalOrDash"),s(),V(15,ua,4,8,"td",11,oa),C(17,"td",12),s()),t&2){let e=o.$implicit,n=u();r(2),m("routerLink",$(15,la,e.student.Id)),r(2),f(e.student.FullName),r(2),We(" ",c(7,7,"tests.mean"),": ",F(8,9,e.finalGrade.average,"1-3")," "),r(3),m("ngClass",$(17,Ui,n.selectedTest===void 0)),r(),v(e.finalGrade.finalGradeValue?10:11),r(3),y(" ",F(14,12,e.finalGrade.average,"1-3")," "),r(2),A(n.getGrades(e))}}function ga(t,o){if(t&1&&(a(0,"td",11),C(1,"bkd-average-grades",21),s()),t&2){let e=o.$implicit,n=u();m("ngClass",e.Id===(n.selectedTest==null?null:n.selectedTest.Id)||e.Id===(n.selectedTest==null?null:n.selectedTest.Id)?"selected":""),r(),m("test",e)}}function fa(t,o){if(t&1){let e=O();a(0,"button",22),E("click",function(){T(e);let i=u();return w(i.setAverageAsFinalGrade())}),l(1),p(2,"translate"),s()}if(t&2){let e=u(),n=k(2);m("ngClass",$(4,pa,!n||!e.selectedTest)),r(),y(" ",c(2,2,"tests.set-final-grade")," ")}}var zi=(()=>{class t{constructor(){this.state=h(Q),this.modalService=h(ct),this.destroy$=new se,this.sticky=Ut(je)}ngOnInit(){this.state.sortCriteria.set({primarySortKey:"FullName",ascending:!0}),q([this.state.filteredTests$,this.state.expandedHeader$]).pipe(Se(this.destroy$)).subscribe(()=>this.sticky()?.refresh())}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setAverageAsFinalGrade(){this.state.course$.pipe(te(1)).subscribe(e=>this.state.setAveragesAsFinalGrades({CourseIds:[e.Id]}))}isEditFinalGradesAllowed(e){return this.state.course$.pipe(x(n=>!!(Ct(n)?.value&&e.finalGrade?.canGrade)))}getGrades(e){return e.grades.flatMap(n=>({id:`${e.student.Id}-${n.test.Id}`,grade:n}))}publish(e){let n=this.openModal(e);this.onCloseModal(n,()=>this.state.publish(e))}unpublish(e){let n=this.openModal(e);this.onCloseModal(n,()=>this.state.unpublish(e))}calculatePointsAverage(e){return this.safeAverage(e,lt)}calculateGradeAverage(e){return this.safeAverage(e,pt)}safeAverage(e,n){try{return n(e).toString()}catch{return"\u2013"}}openModal(e){let n=this.modalService.open(Fi);return n.componentInstance.test=e,n}onCloseModal(e,n){e.result.then(i=>{i&&n()},()=>{})}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-table"]],viewQuery:function(n,i){n&1&&Qt(i.sticky,je,5),n&2&&Zt()},inputs:{selectedTest:"selectedTest"},features:[le([He])],decls:40,vars:45,consts:[["inlineHeader",""],["stickyHeader",""],[1,"table-responsive-wrapper"],["bkdTableHeaderSticky","",1,"table","table-hover","h-100",3,"ngClass","inlineHeader","stickyHeader"],["bkdTestsTableHeader","",3,"publish","unpublish","selectedTest"],["bkdTestsTableHeader","",3,"publish","unpublish","sticky","selectedTest"],[1,"sticky","student-name"],[1,"d-flex","flex-column"],[1,"student-average-inline"],[1,"desktop","sticky","student-grade",3,"ngClass"],[1,"desktop","border-end","sticky","student-average"],[1,"test-grade",3,"ngClass"],[1,"filler"],[1,"action-buttons"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"ngClass"],[3,"routerLink"],[1,"sticky","student-grade",3,"ngClass"],[3,"options","valueId","gradeId","disabled"],[1,"border-end","sticky","student-average"],[3,"gradeIdSelected","options","valueId","gradeId","disabled"],[3,"grade","gradeOptions","student","hasFinalGrade","tabIndex"],[3,"test"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"click","ngClass"]],template:function(n,i){if(n&1){let d=O();D(0),p(1,"async"),D(2),p(3,"async"),D(4),p(5,"async"),a(6,"div",2)(7,"table",3)(8,"thead",4,0),E("publish",function(S){return T(d),w(i.publish(S))})("unpublish",function(S){return T(d),w(i.unpublish(S))}),s(),a(10,"thead",5,1),E("publish",function(S){return T(d),w(i.publish(S))})("unpublish",function(S){return T(d),w(i.unpublish(S))}),s(),a(12,"tbody"),V(13,ha,18,19,"tr",null,sa),a(15,"tr")(16,"td",6)(17,"div",7)(18,"div"),l(19),p(20,"translate"),s(),a(21,"div",8),l(22),p(23,"translate"),p(24,"async"),p(25,"decimalOrDash"),s()()(),a(26,"td",9),l(27),p(28,"async"),p(29,"decimalOrDash"),s(),a(30,"td",10),l(31),p(32,"async"),p(33,"decimalOrDash"),s(),V(34,ga,2,2,"td",11,aa),C(36,"td",12),s()()(),a(37,"div",13),b(38,fa,3,6,"button",14),p(39,"async"),s()()}if(n&2){let d=he(9),g=he(11),S=c(1,13,i.state.filteredTests$);r(2),R(c(3,15,i.state.hasTests$));let ee=c(5,18,i.state.studentGrades$);r(5),m("ngClass",$(41,da,i.selectedTest==null?null:i.selectedTest.IsPointGrading))("inlineHeader",d)("stickyHeader",g),r(),m("selectedTest",i.selectedTest),r(2),m("sticky",!0)("selectedTest",i.selectedTest),r(3),A(ee),r(6),f(c(20,20,"tests.average")),r(3),We(" ",c(23,22,"tests.mean"),": ",F(25,26,c(24,24,i.state.meanOfStudentGradesForCourse$),"1-3")," "),r(4),m("ngClass",$(43,Ui,i.selectedTest===void 0)),r(),y(" ",F(29,31,c(28,29,i.state.meanOfFinalGradesForCourse$),"1-3")," "),r(4),y(" ",F(33,36,c(32,34,i.state.meanOfStudentGradesForCourse$),"1-3")," "),r(3),A(S),r(4),v(c(39,39,i.state.canSetFinalGrade$)?38:-1)}},dependencies:[Ce,X,Bi,Ri,Gi,K,P,Hn,je,Wi],styles:["[_nghost-%COMP%]{--spacer: 16px;--point-input-size: 4em;--grade-input-size: 127px;--points-grade-gap: 1rem;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-average-column-width: 120px;--test-grade-column-width: calc( var(--spacer) + var(--point-input-size) + var(--points-grade-gap) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--student-average-column-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) );--test-columns-offset: calc( var(--student-average-column-offset) + var(--student-average-column-width) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}@media (max-width: 767.98px){[_nghost-%COMP%]{--points-grade-gap: calc(.5 * var(--spacer))}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (min-width: 576px){[_nghost-%COMP%]{--point-input-size: 5em}}tr[_ngcontent-%COMP%]:not(.header-collapsible)   th.test-grade[_ngcontent-%COMP%], td.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}@media (max-width: 810px){tr[_ngcontent-%COMP%]:not(.header-collapsible):not(.test-point-grading)   th.test-grade[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]:not(.test-point-grading)   th.student-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.test-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.student-grade[_ngcontent-%COMP%]{width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));min-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));max-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer))}}th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}th.test-grade[_ngcontent-%COMP%]   .point-column-title[_ngcontent-%COMP%]{width:var(--point-input-size)}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-average[_ngcontent-%COMP%], .test-grade[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex;width:100%}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.test-grade[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}.student-average[_ngcontent-%COMP%]{width:var(--student-average-column-width);min-width:var(--student-average-column-width);max-width:var(--student-average-column-width)}.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}th.sticky.student-average[_ngcontent-%COMP%], td.sticky.student-average[_ngcontent-%COMP%]{left:var(--student-average-column-offset)}}@media (max-width: 1200px){[_nghost-%COMP%]{--student-average-column-width: 1px}.student-average[_ngcontent-%COMP%]{padding:0;overflow:hidden}}@media (min-width: 1201px){.student-average-inline[_ngcontent-%COMP%]{display:none}}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child{text-decoration:underline}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}.student-average-inline[_ngcontent-%COMP%]{color:#4e4e4ef2;font-size:.875rem;line-height:1}@media (min-width: 811px){.table-responsive-wrapper[_ngcontent-%COMP%]{display:block;overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.action-buttons[_ngcontent-%COMP%]{position:sticky;left:0}}@media (max-width: 810px){.apply-average-button[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]})}}return t})();var Ca=()=>[],va=t=>({"visible-on-mobile":t});function _a(t,o){t&1&&C(0,"bkd-spinner")}function ya(t,o){if(t&1){let e=O();a(0,"bkd-select",4),E("valueChange",function(i){T(e);let d=u(2);return w(i&&d.testSelected(i))}),s(),C(1,"bkd-tests-table",5)}if(t&2){u(2);let e=k(6),n=k(8),i=k(10);m("options",e)("value",n)("allowEmpty",!1),r(),m("selectedTest",i)}}function ba(t,o){t&1&&(a(0,"p",2),l(1),p(2,"translate"),s()),t&2&&(r(),f(c(2,1,"tests.no-tests")))}function Sa(t,o){if(t&1&&(a(0,"a",3),p(1,"async"),a(2,"i",6),l(3,"arrow_right_alt"),s(),a(4,"span",7),l(5),p(6,"translate"),s()()),t&2){let e=u(2),n=k(4),i=k(10);ge("href",c(1,3,e.buildLinkToRatingOverview()),de),m("ngClass",$(7,va,!n||!i)),r(5),f(c(6,5,"tests.link-to-rating-overview"))}}function xa(t,o){if(t&1&&(C(0,"bkd-tests-header",1),b(1,ya,2,4)(2,ba,3,3,"p",2)(3,Sa,7,9,"a",3),p(4,"async")),t&2){let e=u(),n=k(0),i=k(2);m("course",n),r(),v(i.length>0?1:2),r(2),v(c(4,3,e.state.canSetFinalGrade$)?3:-1)}}var qi=(()=>{class t{constructor(){this.settings=h(_e),this.state=h(Q),this.translate=h(ne),this.selectTest$=new se,this.testOptions$=this.state.tests$.pipe(x(e=>[{Key:-1,Value:this.translate.instant("tests.grade")},...e.map(n=>({Key:n.Id,Value:n.Designation}))]),Z()),this.selectedTestId$=qe(this.selectTest$,this.state.tests$.pipe(te(1),x(e=>e[0]?.Id))).pipe(Z()),this.selectedTest$=this.selectedTestId$.pipe(L(e=>this.state.tests$.pipe(x(n=>n.find(i=>i.Id===e)))),Z())}testSelected(e){this.selectTest$.next(e)}buildLinkToRatingOverview(){return this.state.course$.pipe(te(1),x(e=>this.settings.eventlist.evaluation.replace(":id",String(e.Id))))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-list"]],decls:16,vars:22,consts:[[1,"bkd-container"],[3,"course"],[1,"mt-3","px-3"],[1,"rating-overview","d-flex","justify-content-end","pe-3","border-top","pt-3",3,"ngClass","href"],["width","100%",1,"tests-dropdown",3,"valueChange","options","value","allowEmpty"],[3,"selectedTest"],[1,"material-icons","fw-bold"],[1,"ps-1"]],template:function(n,i){if(n&1&&(D(0),p(1,"async"),D(2),p(3,"async"),D(4),p(5,"async"),D(6),p(7,"async"),D(8),p(9,"async"),D(10),p(11,"async"),a(12,"div",0),b(13,_a,1,0,"bkd-spinner"),p(14,"async"),b(15,xa,5,5),s()),n&2){let d;R(c(1,1,i.state.course$)),r(2),R((d=c(3,4,i.state.tests$))!==null&&d!==void 0?d:fe(21,Ca)),r(2),R(c(5,7,i.state.hasTests$)),r(2),R(c(7,10,i.testOptions$)),r(2),R(c(9,13,i.selectedTestId$)),r(2),R(c(11,16,i.selectedTest$)),r(3),v(c(14,19,i.state.loading$)?13:15)}},dependencies:[$i,Pe,zi,Ce,me,K,P],styles:[".tests-dropdown[_ngcontent-%COMP%]{display:block;padding:1rem 0}@media (min-width: 811px){.tests-dropdown[_ngcontent-%COMP%]{display:none}}a.rating-overview[_ngcontent-%COMP%]{text-decoration:none}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}@media (max-width: 810px){a.rating-overview[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]})}}return t})();var Ki=(()=>{class t{constructor(){this.state=h(Q),this.route=h(ve),this.courseId$=this.route.paramMap.pipe(x(e=>Number(e.get("id"))),Z()),this.destroy$=new se}ngOnInit(){this.courseId$.pipe(Se(this.destroy$)).subscribe(e=>this.state.setCourseId(e))}ngOnDestroy(){this.destroy$.next()}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests"]],features:[le([Q])],decls:1,vars:0,template:function(n,i){n&1&&C(0,"router-outlet")},dependencies:[Ie],encapsulation:2})}}return t})();var Yi=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-current-list"]],decls:4,vars:5,consts:[[3,"withStudyCourses","withRatings"]],template:function(n,i){n&1&&(a(0,"h1"),l(1),p(2,"translate"),s(),C(3,"bkd-events-list",0)),n&2&&(r(),f(c(2,3,"events.current.title")),r(2),m("withStudyCourses",!0)("withRatings",!1))},dependencies:[xt,P],encapsulation:2,changeDetection:0})}}return t})();var _0=[{path:"",component:ei,children:[{path:"current",children:[{path:"",component:Yi},Qi(":id")]},{path:"",component:_i},{path:":id",component:Ki,children:[{path:"tests",children:[{path:"",component:qi},{path:":testId/edit",component:Di},{path:"add",component:Oi},mt]},{path:"evaluation",children:[{path:"",component:ai},mt]},Qi("students")]}]}];function Qi(t){return{path:t,component:fi,children:[{path:"",component:hi},{path:"study-course-student/:id",component:gi},mt]}}export{Zn as a,_0 as b,Qi as c};
