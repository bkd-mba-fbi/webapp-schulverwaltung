import{a as ye,b as ge,c as Ee}from"./chunk-VCK2SXI5.js";import{a as fe}from"./chunk-VTECG2ZE.js";import{a as xe}from"./chunk-GPFQRPOC.js";import{a as ve}from"./chunk-SWW2IZXB.js";import"./chunk-QNGDMYF2.js";import"./chunk-5FFJJJZ5.js";import"./chunk-VMOOBKG2.js";import{b as se,e as N}from"./chunk-VF44T6U3.js";import"./chunk-A4TCTMIL.js";import"./chunk-Y4QYVF5K.js";import"./chunk-TCEEBBQP.js";import{a as Ce}from"./chunk-EAS6YCPS.js";import{a as be,b as he,c as Se}from"./chunk-LQFIH3S3.js";import{f as me}from"./chunk-4QTA7R6W.js";import{d as _e}from"./chunk-VNNH2VUZ.js";import"./chunk-HLEZ4C3Q.js";import"./chunk-5ZOEDVCI.js";import{L as le,P as ce}from"./chunk-G2L3C6GE.js";import"./chunk-2FCCHX6W.js";import{a as de,b as ue}from"./chunk-KCOBA4SV.js";import{b as pe}from"./chunk-GWJDWK72.js";import{u as re}from"./chunk-7TIAFCYF.js";import"./chunk-LXT7D3OU.js";import{$a as r,Ab as j,Bb as M,Bc as ae,Cb as S,Db as Q,Eb as A,F as U,Fb as Y,Gb as H,Kb as s,La as f,Lb as l,M as G,P as O,Pa as K,Qa as v,R as X,Rd as D,Sd as V,Va as b,X as z,Ya as F,Za as w,Zb as Z,_ as E,_a as o,aa as x,ab as k,bc as ee,eb as I,ec as te,ed as oe,gb as h,hb as p,ia as L,ja as P,n as q,qa as J,rb as m,sb as y,tb as C,xb as R,ya as a,yb as B,yc as ie,za as _,zb as $,zc as ne}from"./chunk-TTJNYD2F.js";var ke=(()=>{class e{constructor(t,i,n){this.studentsService=t,this.educationalEventsService=i,this.studyClassesService=n,this.filter={student:null,educationalEvent:null,studyClass:null},this.filterChange=new J,this.classesHttpFilter={params:{fields:"IsActive","filter.IsActive":"=true"}}}show(){this.filterChange.emit(this.filter)}static{this.\u0275fac=function(i){return new(i||e)(_(me),_(Ee),_(xe))}}static{this.\u0275cmp=x({type:e,selectors:[["bkd-evaluate-absences-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},standalone:!0,features:[A],decls:20,vars:19,consts:[[1,"row","g-3","align-items-end"],[1,"col-sm-12","col-md"],[1,"form-label"],[3,"valueChange","typeaheadService","value"],[3,"valueChange","typeaheadService","value","additionalHttpParams"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"div",1)(2,"label",2),m(3),s(4,"translate"),r(),o(5,"bkd-typeahead",3),$("valueChange",function(d){return B(n.filter.student,d)||(n.filter.student=d),d}),r()(),o(6,"div",1)(7,"label",2),m(8),s(9,"translate"),r(),o(10,"bkd-typeahead",3),$("valueChange",function(d){return B(n.filter.educationalEvent,d)||(n.filter.educationalEvent=d),d}),r()(),o(11,"div",1)(12,"label",2),m(13),s(14,"translate"),r(),o(15,"bkd-typeahead",4),$("valueChange",function(d){return B(n.filter.studyClass,d)||(n.filter.studyClass=d),d}),r()(),o(16,"div",5)(17,"button",6),h("click",function(){return n.show()}),m(18),s(19,"translate"),r()()()),i&2&&(a(3),y(l(4,11,"evaluate-absences.header.student")),a(2),v("typeaheadService",n.studentsService),R("value",n.filter.student),a(3),y(l(9,13,"evaluate-absences.header.module-instance")),a(2),v("typeaheadService",n.educationalEventsService),R("value",n.filter.educationalEvent),a(3),y(l(14,15,"evaluate-absences.header.study-class")),a(2),v("typeaheadService",n.studyClassesService),R("value",n.filter.studyClass),v("additionalHttpParams",n.classesHttpFilter),a(3),C(" ",l(19,17,"evaluate-absences.header.show")," "))},dependencies:[fe,V,D],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1rem 1rem 1rem 0;border-bottom:1px solid #dee2e6}"],changeDetection:0})}}return e})();var g=(()=>{class e extends he{constructor(t,i,n,u,d){super(t,i,d,n,"/evaluate-absences"),this.lessonPresenceService=u,this.queryParamsString$.pipe(X(this.destroy$)).subscribe(T=>this.confirmBackLinkParams={returnparams:T})}updateAfterConfirm(){this.resetEntries()}getInitialFilter(){return{student:null,educationalEvent:null,studyClass:null}}isValidFilter(t){return!!(t.student||t.educationalEvent||t.studyClass)}getInitialSorting(){return{key:"StudentFullName",ascending:!0}}loadEntries(t,i,n){return this.loadingService.load(this.lessonPresenceService.getStatistics(t,i,n),be)}buildParamsFromFilter(t){return ye(t)}static{this.\u0275fac=function(i){return new(i||e)(E(Z),E(ue),E(oe),E(N),E(Se))}}static{this.\u0275prov=z({token:e,factory:e.\u0275fac})}}return e})();var Te=(e,c)=>c.key,we=(e,c)=>c.StudentRef.Id,Re=()=>[],Be=e=>["student",e,"absences"],$e=e=>({returnparams:e});function je(e,c){e&1&&k(0,"bkd-spinner")}function Me(e,c){if(e&1){let t=I();o(0,"th",9),h("click",function(){let n=L(t).$implicit,u=p(4);return P(u.state.sortService.toggleSorting(n.key))}),o(1,"div",10)(2,"div",11),s(3,"translate"),m(4),s(5,"translate"),r(),o(6,"div",12),m(7),s(8,"async"),r()()()}if(e&2){let t=c.$implicit,i=p(4);v("ngClass",t.label),a(2),v("ngbTooltip",l(3,4,"evaluate-absences.list.header."+t.label)),a(2),C(" ",l(5,6,"evaluate-absences.list.header."+t.label)," "),a(3),C(" ",l(8,8,i.state.sortService.getSortingChar$(t.key))," ")}}function De(e,c){if(e&1&&(o(0,"a",13),s(1,"async"),m(2),r()),e&2){let t=p().$implicit,i=p().$implicit,n=p(5);v("routerLink",H(5,Be,i.StudentRef.Id))("queryParams",H(7,$e,l(1,3,n.profileReturnParams$))),a(2),C(" ",i[t.key]," ")}}function Ve(e,c){if(e&1&&m(0),e&2){let t=p().$implicit,i=p().$implicit;C(" ",i[t.key]," ")}}function Ne(e,c){if(e&1&&(o(0,"td"),s(1,"translate"),f(2,De,3,9,"a",13)(3,Ve,1,1),r()),e&2){let t=c.$implicit;K("data-label",l(1,2,"evaluate-absences.list.header."+t.label)),a(2),b(t.key==="StudentFullName"?2:3)}}function Oe(e,c){if(e&1&&(o(0,"tr"),F(1,Ne,4,4,"td",null,Te),r()),e&2){let t=p(5);a(),w(t.columns)}}function He(e,c){if(e&1&&(o(0,"tbody"),F(1,Oe,3,0,"tr",null,we),r()),e&2){p(4);let t=S(0);a(),w(t)}}function We(e,c){e&1&&k(0,"bkd-spinner",7)}function qe(e,c){if(e&1){let t=I();o(0,"button",14),h("click",function(){L(t);let n=p(4);return P(n.state.nextPage())}),m(1),s(2,"translate"),r()}e&2&&(a(),C(" ",l(2,1,"global.pagination.load-more")," "))}function Ue(e,c){if(e&1){let t=I();o(0,"div",2)(1,"div",3),k(2,"bkd-reports-link",4),s(3,"async"),r(),o(4,"table",5),h("scrolled",function(){L(t);let n=p(3);return P(n.onScroll())}),o(5,"thead")(6,"tr"),F(7,Me,9,10,"th",6,Te),r()(),f(9,He,3,0,"tbody"),r(),f(10,We,1,0,"bkd-spinner",7)(11,qe,3,3,"button",8),r()}if(e&2){let t,i=p(3),n=S(0),u=S(2),d=S(4);a(2),v("reports",(t=l(3,4,i.reports$))!==null&&t!==void 0?t:Y(6,Re)),a(5),w(i.columns),a(2),b(n&&n.length>0?9:-1),a(),b(d?10:-1),a(),b(u&&!d?11:-1)}}function Ge(e,c){e&1&&(o(0,"p",1),m(1),s(2,"translate"),r()),e&2&&(a(),C(" ",l(2,1,"evaluate-absences.no-entries")," "))}function Xe(e,c){if(e&1&&f(0,Ue,12,7,"div",2)(1,Ge,3,3,"p",1),e&2){p(2);let t=S(0),i=S(4);b(t&&t.length>0||i?0:1)}}function ze(e,c){if(e&1&&(f(0,je,1,0,"bkd-spinner"),s(1,"async"),f(2,Xe,2,1)),e&2){let t=p();b(l(1,1,t.state.loading$)?0:2)}}function Je(e,c){e&1&&(o(0,"p",1),m(1),s(2,"translate"),r()),e&2&&(a(),y(l(2,1,"evaluate-absences.no-filter")))}var Le=(()=>{class e{constructor(t,i,n,u,d,T){this.state=t,this.scrollPosition=i,this.route=n,this.presenceTypesService=u,this.reportsService=d,this.lessonPresencesService=T,this.reports$=this.loadReports(),this.columns=[{key:"StudentFullName",label:"student"},{key:"TotalAbsences",label:"total"},{key:"TotalAbsencesValidExcuse",label:"valid-excuse"},{key:"TotalAbsencesWithoutExcuse",label:"without-excuse"},{key:"TotalAbsencesUnconfirmed",label:"unconfirmed"},{key:"TotalAbsencesUnchecked",label:"unchecked"},{key:"TotalIncidents",label:"incident"}],this.filterFromParams$=this.route.queryParams.pipe(q(Ke)),this.profileReturnParams$=this.state.queryParamsString$}ngOnInit(){this.filterFromParams$.pipe(U(1)).subscribe(t=>this.state.setFilter(t)),this.presenceTypesService.halfDayActive$.subscribe(t=>{t&&(this.columns=[...this.columns,{key:"TotalHalfDays",label:"halfday"}])})}ngAfterViewInit(){this.scrollPosition.restore()}onScroll(){this.state.nextPage()}loadReports(){return this.state.validFilter$.pipe(O(t=>this.lessonPresencesService.getLessonRefs(t)),O(t=>t.length>0?this.reportsService.getEvaluateAbsencesReports(this.getReportRecordIds(t)):[]),G(1))}getReportRecordIds(t){return t.map(i=>`${i.LessonRef.Id}_${i.RegistrationRef.Id}`)}static{this.\u0275fac=function(i){return new(i||e)(_(g),_(Ce),_(ie),_(ce),_(_e),_(N))}}static{this.\u0275cmp=x({type:e,selectors:[["bkd-evaluate-absences-list"]],standalone:!0,features:[A],decls:14,vars:18,consts:[[3,"filterChange","filter"],[1,"mt-3"],[1,"py-3"],[1,"buttons"],[1,"mb-2",3,"reports"],["infiniteScroll","",1,"table","table-striped","table-fixed",3,"scrolled"],["scope","col",3,"ngClass"],[1,"inline"],["type","button",1,"btn","btn-outline-secondary","btn-sm","d-block","mx-auto"],["scope","col",3,"click","ngClass"],[1,"d-flex"],[1,"column-title",3,"ngbTooltip"],[1,"sort-direction"],[1,"student",3,"routerLink","queryParams"],["type","button",1,"btn","btn-outline-secondary","btn-sm","d-block","mx-auto",3,"click"]],template:function(i,n){if(i&1){let u=I();j(0),s(1,"async"),j(2),s(3,"async"),j(4),s(5,"async"),o(6,"h1"),m(7),s(8,"translate"),r(),o(9,"bkd-evaluate-absences-header",0),s(10,"async"),h("filterChange",function(T){return L(u),P(n.state.setFilter(T))}),r(),f(11,ze,3,3),s(12,"async"),f(13,Je,3,3,"p",1)}i&2&&(M(l(1,3,n.state.entries$)),a(2),M(l(3,6,n.state.hasMore$)),a(2),M(l(5,9,n.state.loadingPage$)),a(3),y(l(8,12,"evaluate-absences.title")),a(2),v("filter",l(10,14,n.filterFromParams$)),a(2),b(l(12,16,n.state.isFilterValid$)?11:13))},dependencies:[ke,de,ge,ee,re,ae,pe,te,V,D],styles:["th[_ngcontent-%COMP%]{cursor:pointer}th.student[_ngcontent-%COMP%]{width:30%}.column-title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"],changeDetection:0})}}return e})();function Ke(e){return{student:e.student?Number(e.student):null,educationalEvent:e.educationalEvent?Number(e.educationalEvent):null,studyClass:e.studyClass?Number(e.studyClass):null}}var Pe=(()=>{class e{constructor(t){this.state=t}static{this.\u0275fac=function(i){return new(i||e)(_(g))}}static{this.\u0275cmp=x({type:e,selectors:[["bkd-evaluate-absences"]],standalone:!0,features:[Q([g,{provide:se,useExisting:g},le]),A],decls:1,vars:0,template:function(i,n){i&1&&k(0,"router-outlet")},dependencies:[ne],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}}return e})();var Mt=[{path:"",component:Pe,children:[{path:"",component:Le,data:{restoreScrollPositionFrom:["/evaluate-absences/student/:id"]}},ve]}];export{Mt as EVALUATE_ABSENCES_ROUTES};
