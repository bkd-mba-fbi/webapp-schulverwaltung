import{a as si}from"./chunk-3V5HHMRH.js";import{a as oi,b as li}from"./chunk-ZK2M6PDV.js";import{a as ci}from"./chunk-VFMGCCGG.js";import{a as ai}from"./chunk-RC3HL7KB.js";import"./chunk-KLXFX6SJ.js";import{a as et,b as Wt,c as zt,d as Kt,e as Yt,f as Ue,g as qe,h as Jt,i as Qt,j as Xt,k as Zt,l as ei,m as ye,o as ti,p as pe,s as ni,u as We}from"./chunk-QHPTZGVN.js";import"./chunk-HHGALFFJ.js";import"./chunk-2FIH3FGB.js";import"./chunk-MVTCHCDH.js";import{a as Ht}from"./chunk-Y4QYVF5K.js";import"./chunk-WN7VWSJW.js";import{a as di}from"./chunk-TNMAZX5O.js";import{a as pi}from"./chunk-2IXEFCAH.js";import"./chunk-X2BR3YJG.js";import{a as qt,d as ii}from"./chunk-LO5XSJLW.js";import"./chunk-DMYOU5OM.js";import"./chunk-RWNJF4OZ.js";import{P as Vt,Y as ri,t as At}from"./chunk-GI4AZI25.js";import{a as xe,c as Lt,e as be}from"./chunk-Q5U6YZUT.js";import{a as Ut,b as He}from"./chunk-N6FFLIGM.js";import{a as Z,b as Nt,c as Ce}from"./chunk-33NXTXD7.js";import{f as Gt,g as Ot,i as $t,j as Ft,p as Ae,u as Ne}from"./chunk-FTRAQKUW.js";import{a as Ve}from"./chunk-3AROKYRB.js";import{$ as C,$a as u,$c as _e,A as ot,Ab as xt,Ad as Rt,B as dt,Bb as l,C as lt,Cb as p,Cd as Dt,Db as G,E as ee,Fb as re,G as W,Ga as f,Gd as X,Hb as bt,Hd as P,I as Ge,Ia as c,Id as w,J as pt,Ja as se,Jd as jt,L as z,N as ct,O as D,Q as ce,Rb as le,Sa as o,Sb as ge,Ta as d,Tb as B,Ua as E,Va as K,W as me,Wa as Y,Wb as V,Wc as he,Xb as Oe,Ya as O,Z as A,Zc as Be,_a as _,a as R,ab as gt,ad as Re,b as j,bb as ft,bd as yt,ca as mt,cb as oe,e as te,ec as Ct,ed as St,f as L,fd as It,g as Xe,ga as ue,gd as De,ha as S,hd as Tt,ia as I,ib as q,jb as m,jd as Et,k as U,ka as ut,kb as x,kd as kt,l as st,lb as h,m as b,mb as Ze,n as ie,od as je,pc as fe,pd as Le,qc as $e,qd as Pt,ra as ne,rc as Fe,rd as wt,sb as de,sc as ae,sd as ve,ta as ke,tb as y,td as Mt,ua as s,ub as ht,v as Me,va as v,vb as M,w as Ee,wb as Pe,xb as _t,zb as vt,zd as Bt}from"./chunk-T7QWSMKM.js";var qi=t=>[t,"tests"];function Wi(t,n){if(t&1&&(o(0,"span"),m(1),l(2,"date"),E(3,"wbr"),m(4),l(5,"date"),d()),t&2){let r=u();s(),h("",G(2,2,r.event.dateFrom,"dd.MM.yyyy"),"\u2013"),s(3),x(G(5,5,r.event.dateTo,"dd.MM.yyyy"))}}function zi(t,n){if(t&1&&(o(0,"a",10)(1,"i",11),m(2,"arrow_right_alt"),d(),o(3,"span",12),m(4),d()()),t&2){let r=u(2);c("routerLink",M(2,qi,r.event.id)),s(4),x(r.event.evaluationText)}}function Ki(t,n){if(t&1&&(o(0,"a",13)(1,"i",11),m(2,"arrow_right_alt"),d(),o(3,"span",12),m(4),d()()),t&2){let r=u(2);c("href",r.event.evaluationLink,ke),s(4),h("",r.event.evaluationText," ")}}function Yi(t,n){if(t&1&&(o(0,"div",7),f(1,zi,5,4,"a",8)(2,Ki,5,2,"a",9),d()),t&2){let r=u();s(),c("ngIf",!r.event.evaluationLink),s(),c("ngIf",r.event.evaluationLink)}}var mi=(()=>{let n=class n{constructor(){this.withRatings=!0}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=C({type:n,selectors:[["bkd-events-list-entry"]],inputs:{event:"event",withRatings:"withRatings"},standalone:!0,features:[y],decls:11,vars:8,consts:[[1,"designation"],[3,"href"],[1,"date"],[4,"ngIf"],[1,"registrations"],[1,"registrations-label"],["class","rating",4,"ngIf"],[1,"rating"],["class","d-flex",3,"routerLink",4,"ngIf"],["class","d-flex",3,"href",4,"ngIf"],[1,"d-flex",3,"routerLink"],[1,"material-icons"],[1,"ps-1"],[1,"d-flex",3,"href"]],template:function(i,a){i&1&&(o(0,"div",0)(1,"a",1),m(2),d()(),o(3,"div",2),f(4,Wi,6,8,"span",3),d(),o(5,"div",4),m(6),o(7,"span",5),m(8),l(9,"translate"),d()(),f(10,Yi,3,2,"div",6)),i&2&&(s(),c("href",a.event.detailLink,ke),s(),x(a.event.designation),s(2),c("ngIf",a.event.dateFrom&&a.event.dateTo),s(2),h(" ",a.event.studentCount," "),s(2),x(p(9,6,a.event.studentCount===1?"events.registration":"events.registrations")),s(2),c("ngIf",a.withRatings&&a.event.evaluationText))},dependencies:[B,ae,Oe,w,P],styles:['[_nghost-%COMP%]{display:grid;padding:1rem;border-bottom:1px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}.designation[_ngcontent-%COMP%]{grid-area:designation;padding-right:1rem}.date[_ngcontent-%COMP%]{grid-area:date;padding-right:1rem}.registrations[_ngcontent-%COMP%]{grid-area:registrations;padding-right:1rem}.rating[_ngcontent-%COMP%]{grid-area:rating}.rating[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.registrations-label[_ngcontent-%COMP%]{display:none}@media (max-width: 575.98px){.registrations-label[_ngcontent-%COMP%]{display:inline}.designation[_ngcontent-%COMP%], .date[_ngcontent-%COMP%], .registrations[_ngcontent-%COMP%]{padding-right:0}[_nghost-%COMP%]{grid-template-areas:"designation" "date" "registrations" "rating";grid-template-columns:1fr}}']});let t=n;return t})();var Ji=10300,Qi=10260,Xi=10250,Zi=14030,en=10350;function ze(t){let{HasEvaluationStarted:n,EvaluationUntil:r,HasTestGrading:e}=t.EvaluationStatusRef;if(n===!0&&(t.StatusId===Zi||t.StatusId===en))return{value:Q.Rating};if(n===!0&&e===!1){if(r)return{value:Q.RatingUntil};if(t.StatusId===Ji)return{value:Q.IntermediateRating}}return n===!1&&e===!0&&t.StatusId!==Qi&&t.StatusId!==Xi?{value:Q.Tests}:n===!0&&e===!0?r?{value:Q.Tests,label:Q.RatingUntil}:{value:Q.Tests,label:Q.IntermediateRating}:null}function ui(t){return t.EvaluationStatusRef.HasEvaluationStarted===!0}function gi(t){return t.EvaluationStatusRef.HasReviewOfEvaluationStarted===!0&&!!t.FinalGrades?.length}function Ke(t){let n=t.Classes?t.Classes.map(r=>r.Number).join(", "):null;return n?t.Designation+", "+n:t.Designation}var Q=function(t){return t.Rating="rating",t.RatingUntil="rating-until",t.IntermediateRating="intermediate-rating",t.Tests="add-tests",t}(Q||{}),Se=(()=>{let n=class n{constructor(e,i,a,g,k,T){this.coursesRestService=e,this.eventsRestService=i,this.studyClassRestService=a,this.loadingService=g,this.translate=k,this.settings=T,this.loading$=this.loadingService.loading$,this.searchSubject$=new L(""),this.search$=this.searchSubject$.asObservable(),this.roles$=new L(null),this.isClassTeacher$=this.roles$.pipe(b(F=>Ht(F,"ClassTeacherRole")),z(1)),this.withStudyCourses$=new L(!1),this.unratedCourses$=this.roles$.pipe(D(this.loadUnratedCourses.bind(this)),z(1)),this.studyCourses$=this.withStudyCourses$.pipe(D(this.loadStudyCourses.bind(this)),z(1)),this.formativeAssessments$=this.isClassTeacher$.pipe(D(this.loadFormativeAssessments.bind(this)),z(1)),this.studyClasses$=this.isClassTeacher$.pipe(D(this.loadStudyClasses.bind(this)),z(1)),this.events$=this.getEvents().pipe(z(1)),this.filteredEvents$=ie([this.events$,this.search$]).pipe(b(be(oi)))}setSearch(e){this.searchSubject$.next(e)}setRoles(e){this.roles$.next(e)}setWithStudyCourses(e){this.withStudyCourses$.next(e)}getEntries(e=!1){return this.filteredEvents$.pipe(b(i=>e?i.filter(a=>a.evaluationText):i))}getEvents(){return this.loadingService.load(ie([this.unratedCourses$,this.studyCourses$,this.formativeAssessments$,this.studyClasses$]),{stopOnFirstValue:!0}).pipe(b(be(this.createAndSortEvents.bind(this))))}loadUnratedCourses(e){return this.coursesRestService.getExpandedCourses(e).pipe(b(i=>i.filter(a=>!gi(a))))}loadStudyCourses(e){return e?this.eventsRestService.getStudyCourseEvents():U([])}loadFormativeAssessments(e){return e?this.studyClassRestService.getActiveFormativeAssessments():U([])}loadStudyClasses(e){return e?this.studyClassRestService.getActive():U([])}createAndSortEvents(e,i,a,g){let k=g.filter(T=>!a.map(F=>F.Id).includes(T.Id));return[...this.createFromCourses(e),...this.createFromStudyCourses(i),...this.createFromAssessments(a),...this.createFromStudyClasses(k)].sort((T,F)=>T.designation.localeCompare(F.designation))}createFromCourses(e){return e.map(i=>{let a=ze(i);return{id:i.Id,designation:Ke(i),detailLink:this.buildLink(i.Id,"eventdetail"),studentCount:i.AttendanceRef.StudentCount||0,dateFrom:i.DateFrom,dateTo:i.DateTo,state:a?.value||null,evaluationText:this.getEvaluationText(a,i.EvaluationStatusRef.EvaluationUntil),evaluationLink:this.getEvaluationLink(a?.value,i)}})}createFromStudyCourses(e){return e.map(i=>({id:i.Id,designation:i.Designation,detailLink:this.buildLink(i.Id,"eventdetail"),studentCount:i.StudentCount,state:null}))}createFromAssessments(e){return this.createFromStudyClasses(e).map(a=>j(R({},a),{state:Q.Rating,evaluationText:this.translate.instant("events.state.rating"),evaluationLink:this.buildLink(a.id,"evaluation")}))}createFromStudyClasses(e){return e.map(i=>({id:i.Id,designation:i.Number,detailLink:this.buildLink(i.Id,"eventdetail"),studentCount:i.StudentCount,state:null}))}getEvaluationText(e,i){let a=e?.label||e?.value;return a?this.translate.instant(`events.state.${a}`)+(a===Q.RatingUntil?` ${i?At(i,"dd.MM.yyyy"):""}`:""):""}getEvaluationLink(e,i){return e&&e!==Q.Tests?this.buildLink(i.Id,"evaluation"):null}buildLink(e,i){return(this.settings.eventlist[i]??"").replace(":id",String(e))}};n.\u0275fac=function(i){return new(i||n)(A(pe),A(si),A(ci),A(He),A(X),A(he))},n.\u0275prov=me({token:n,factory:n.\u0275fac,providedIn:"root"});let t=n;return t})();var rn=t=>({events:t});function an(t,n){t&1&&(o(0,"div",12),m(1),l(2,"translate"),d()),t&2&&(s(),h(" ",p(2,1,"events.rating")," "))}function sn(t,n){if(t&1&&E(0,"bkd-events-list-entry",13),t&2){let r=n.$implicit,e=u(4);c("event",r)("withRatings",e.withRatings)}}function on(t,n){if(t&1&&(K(0),o(1,"div",6)(2,"div",7),m(3),l(4,"translate"),d(),o(5,"div",8),m(6),l(7,"translate"),d(),o(8,"div",9),m(9),l(10,"translate"),d(),f(11,an,3,3,"div",10),d(),f(12,sn,1,2,"bkd-events-list-entry",11),Y()),t&2){let r=u(2).bkdLet,e=u();s(3),x(p(4,5,"events.designation")),s(3),x(p(7,7,"events.date")),s(3),h(" ",p(10,9,"events.registrations")," "),s(2),c("ngIf",e.withRatings),s(),c("ngForOf",r.events)}}function dn(t,n){t&1&&(o(0,"p",14),m(1),l(2,"translate"),d()),t&2&&(s(),x(p(2,1,"events.no-events")))}function ln(t,n){if(t&1&&(K(0),f(1,on,13,11,"ng-container",5)(2,dn,3,3,"ng-template",null,1,re),Y()),t&2){let r=q(3),e=u().bkdLet;s(),c("ngIf",(e.events==null?null:e.events.length)>0)("ngIfElse",r)}}function pn(t,n){t&1&&E(0,"bkd-spinner")}function cn(t,n){if(t&1){let r=O();o(0,"div",3)(1,"bkd-resettable-input",4),l(2,"async"),l(3,"translate"),l(4,"translate"),_("valueChange",function(i){S(r);let a=u();return I(a.state.setSearch(i))}),d(),f(5,ln,4,2,"ng-container",5),l(6,"async"),f(7,pn,1,0,"ng-template",null,0,re),d()}if(t&2){let r=n.bkdLet,e=q(8),i=u();s(),c("value",p(2,6,i.state.search$))("placeholder",p(3,8,"events.search-by"))("label",p(4,10,"events.search"))("disabled",!r.events),s(4),c("ngIf",p(6,12,i.state.loading$)===!1)("ngIfElse",e)}}var Ye=(()=>{let n=class n{constructor(e,i){this.state=e,this.storage=i,this.withStudyCourses=!1,this.withRatings=!0,this.state.setRoles(this.storage.getPayload()?.roles??null)}ngOnChanges(e){e.withStudyCourses&&this.state.setWithStudyCourses(e.withStudyCourses.currentValue)}};n.\u0275fac=function(i){return new(i||n)(v(Se),v(jt))},n.\u0275cmp=C({type:n,selectors:[["bkd-events-list"]],inputs:{withStudyCourses:"withStudyCourses",withRatings:"withRatings"},standalone:!0,features:[ue,y],decls:2,vars:5,consts:[["loading",""],["noEvents",""],["class","bkd-container",4,"bkdLet"],[1,"bkd-container"],[1,"d-flex","search",3,"valueChange","value","placeholder","label","disabled"],[4,"ngIf","ngIfElse"],[1,"event-header"],[1,"designation"],[1,"date"],[1,"registrations"],["class","rating",4,"ngIf"],[3,"event","withRatings",4,"ngFor","ngForOf"],[1,"rating"],[3,"event","withRatings"],[1,"mt-3"]],template:function(i,a){i&1&&(f(0,cn,9,14,"div",2),l(1,"async")),i&2&&c("bkdLet",M(3,rn,p(1,1,a.state.getEntries(a.withRatings))))},dependencies:[Z,li,B,ge,Ce,V,w,P,mi],styles:['.search[_ngcontent-%COMP%]{max-width:500px}.event-header[_ngcontent-%COMP%]{display:grid;padding:1rem;border-bottom:2px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}@media (max-width: 575.98px){.event-header[_ngcontent-%COMP%]{display:none}}']});let t=n;return t})();var fi=(()=>{let n=class n{constructor(){}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=C({type:n,selectors:[["bkd-events-current"]],standalone:!0,features:[y],decls:4,vars:5,consts:[[3,"withStudyCourses","withRatings"]],template:function(i,a){i&1&&(o(0,"h1"),m(1),l(2,"translate"),d(),E(3,"bkd-events-list",0)),i&2&&(s(),x(p(2,3,"events.current.title")),s(2),c("withStudyCourses",!0)("withRatings",!1))},dependencies:[Ye,w,P]});let t=n;return t})();var hi=(()=>{let n=class n{constructor(){}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=C({type:n,selectors:[["bkd-events-tests"]],standalone:!0,features:[y],decls:4,vars:4,consts:[[3,"withRatings"]],template:function(i,a){i&1&&(o(0,"h1"),m(1),l(2,"translate"),d(),E(3,"bkd-events-list",0)),i&2&&(s(),x(p(2,2,"events.title")),s(2),c("withRatings",!0))},dependencies:[Ye,w,P]});let t=n;return t})();var _i=(()=>{let n=class n{constructor(){}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=C({type:n,selectors:[["bkd-events"]],standalone:!0,features:[de([Se,Vt]),y],decls:1,vars:0,template:function(i,a){i&1&&E(0,"router-outlet")},dependencies:[$e]});let t=n;return t})();function vi(t){return n=>{let r=Number(n.value);return r<=t?{greaterThan:{value:r,greaterThanValue:t}}:null}}function it(t){return t.map(({finalGrade:n})=>n).filter(mn)}function mn(t){return t!==null}function Ci(t,n,r,e){return t?.map(i=>({student:i,finalGrade:gn(i,r,e),grades:un(i,n)}))}function un(t,n){return n.map(r=>{if(r.Results===void 0||r.Results?.length===0)return{kind:"no-result",test:r};let e=r.Results?.find(i=>i.StudentId===t.Id);return e!==void 0?{kind:"grade",result:e,test:r}:{kind:"no-result",test:r}})}function gn(t,n,r){let e=n.find(a=>a.StudentId===t.Id),i=r.find(a=>a.StudentId===t.Id);return e?{id:e.Id,average:fn(e),finalGradeId:e.GradeId,freeHandGrade:i?Number(i.Grade):null,canGrade:e.CanGrade}:null}function fn(t){return t.AverageTestResult===0?null:t.AverageTestResult}var yi=({key:t,ascending:n})=>(r,e)=>{let i=n?1:-1;switch(t){case"FullName":return i*r.student.FullName.localeCompare(e.student.FullName);case"FinalGrade":return!r.finalGrade?.finalGradeId||!e.finalGrade?.finalGradeId?i*-1:i*xi(r.finalGrade.finalGradeId,e.finalGrade.finalGradeId);case"TestsMean":return!r.finalGrade?.average||!e.finalGrade?.average?i*-1:i*xi(r.finalGrade.average,e.finalGrade.average)}return i*hn(t,r,e)},hn=(t,n,r)=>{let e=n.grades.filter(bi).find(a=>a.test.Id===t.Id),i=r.grades.filter(bi).find(a=>a.test.Id===t.Id);return t.IsPointGrading&&e?.result.GradeId===i?.result.GradeId?(e?.result.Points??0)-(i?.result.Points??0):((e?.result.GradeId??Number.POSITIVE_INFINITY)-(i?.result.GradeId??Number.POSITIVE_INFINITY))*-1};function xi(t,n){return t===n?0:t<n?-1:1}function bi(t){return t.kind==="grade"}function Si(t){return(t?.test?.MaxPointsAdjusted||t?.test?.MaxPoints)??0}function Ii(t){let n=t.map(r=>r.average).filter(r=>r!=null&&r!==0).map(Number);return et(n)}function Ti(t,n){let r=t.map(i=>i.freeHandGrade).filter(i=>!!i),e=t.map(i=>i.finalGradeId).filter(i=>i!==null).map(i=>n.find(a=>a.Key===i)).filter(i=>i!==void 0).map(i=>i?.Value).filter(i=>i!==void 0).map(Number).filter(i=>!isNaN(i));return et([...e,...r])}function nt(t,n){return[...n.filter(r=>r.Id!==t?.Id),t].filter(r=>r!=null)}function Ei({id:t,selectedGradeId:n},r){return r.map(e=>e.Id!==t?e:j(R({},e),{GradeId:n}))}function ki(t,n){switch(n.type){case"reset":return n.payload;case"updateResult":return t?j(R({},t),{Tests:zt(n.payload.testResult,t.Tests||[],n.payload.ignore),Gradings:n.payload.grading?nt(n.payload.grading,t.Gradings||[]):t.Gradings}):null;case"deleteResult":return t?j(R({},t),{Tests:Kt(n.payload.testId,n.payload.studentId,t.Tests||[]),Gradings:n.payload.grading?nt(n.payload.grading,t.Gradings||[]):t.Gradings||[]}):null;case"toggle-test-state":return t?j(R({},t),{Tests:Yt(n.payload,t.Tests||[])}):null;case"final-grade-overwritten":return t?j(R({},t),{Gradings:Ei({id:n.payload.id,selectedGradeId:n.payload.selectedGradeId},t.Gradings||[])}):null;case"replace-grades":return t?j(R({},t),{Gradings:n.payload}):null;case"delete-test":return t?j(R({},t),{Tests:Jt(n.payload,t.Tests||[])}):null;default:return t}}var Pi=(()=>{let n=class n extends Nt{constructor(e,i){super(e,i,ti,"Gradings")}updateGrade(e,i){return this.http.put(`${this.baseUrl}/${e}`,{GradeId:i}).pipe(b(()=>e))}};n.\u0275fac=function(i){return new(i||n)(A(Ct),A(he))},n.\u0275prov=me({token:n,factory:n.\u0275fac,providedIn:"root"});let t=n;return t})();var rt={onlyMine:!1,hidePublished:!1},J=(()=>{let n=class n{constructor(e,i,a,g,k){this.coursesRestService=e,this.gradingScalesRestService=i,this.gradingsRestService=a,this.loadingService=g,this.sortService=k,this.action$=new Xe(1),this.loading$=this.loadingService.loading$,this._courseId$=new Xe(1),this.courseId$=this._courseId$.asObservable(),this.fetchedCourse$=this._courseId$.pipe(D(T=>this.loadingService.load(this.coursesRestService.getExpandedCourse(T))),z(1)),this.course$=Me(this.action$,this.fetchedCourse$.pipe(Ee(Ne),b(T=>({type:"reset",payload:T})))).pipe(pt(ki,null),Ee(Ne),z(1)),this.tests$=this.course$.pipe(b(T=>T.Tests||[]),b(Qt)),this.hasTests$=this.tests$.pipe(b(T=>T.length>0)),this.filterSubject$=new L(rt),this.filter$=this.filterSubject$.asObservable(),this.expandedHeader$=new L(!1),this.filteredTests$=ie([this.tests$,this.filter$]).pipe(b(([T,F])=>T.filter(H=>(!F.onlyMine||H.IsOwner)&&(!F.hidePublished||!H.IsPublished)))),this.sorting$=this.sortService.sorting$,this.studentGrades$=ie([this.course$,this.filteredTests$,this.sorting$]).pipe(b(be(this.toStudentGrades.bind(this)))),this.canSetFinalGrade$=this.course$.pipe(b(ui)),this.gradingScaleIds$=this.course$.pipe(b(T=>Rt([...(T.Tests??[]).map(F=>F.GradingScaleId),T.GradingScaleId]).filter(Ne)),W(Bt),z(1)),this.gradingScales$=this.gradingScaleIds$.pipe(D(T=>this.gradingScalesRestService.getGradingScales(T)),z(1)),this.UNDEFINED_GRADINGSCALE_ID=-1,this.gradingScalesOptions$=this.gradingScales$.pipe(b(T=>T.map(F=>{let H=F?.Id||this.UNDEFINED_GRADINGSCALE_ID,Te=F?.Grades.map(we=>({Key:we.Id,Value:we.Designation}))||[];return{id:H,options:Te}}).reduce((F,H)=>j(R({},F),{[H.id]:H.options}),{})),z(1)),this.meanOfStudentGradesForCourse$=this.studentGrades$.pipe(b(T=>Ii(it(T)))),this.meanOfFinalGradesForCourse$=ie([this.gradingScalesOptions$,this.studentGrades$]).pipe(D(be(this.meanOfOverwrittenGradesForCourse.bind(this))))}setCourseId(e){this._courseId$.next(e)}setFilter(e){this.filterSubject$.next(e)}gradingOptionsForTest$(e){return this.gradingOptions$(e.GradingScaleId)}gradingOptionsForCourse$(){return this.course$.pipe(D(e=>this.gradingOptions$(e.GradingScaleId)))}toStudentGrades(e,i=[],a){return Ci(e.ParticipatingStudents??[],i,e.Gradings??[],e.FinalGrades??[]).sort(yi(a))}setSorting(e){this.sortService.setSorting(e)}getSortingChar$(e){return this.sortService.getSortingChar$(e)}sortBy(e){this.sortService.toggleSorting(e)}toggleHeader(e){this.expandedHeader$.next(e)}optimisticallyUpdateGrade(e){return this.course$.pipe(ee(1),b(i=>{let{originalResult:a,updatedResult:g}=this.buildOptimisticResultUpdate(i,e);return this.updateTestResult(g,null),a}))}saveGrade(e,i){this.course$.pipe(ee(1),D(a=>this.coursesRestService.updateTestResult(a.Id,e).pipe(ot(g=>(i&&this.updateTestResult(R({},i),null),st(()=>g)))))).subscribe(({testResult:a,grading:g})=>this.updateOrDeleteTestResult(e.testId,e.studentId,a,g,"gradeId"in e?"grade":"points"))}publish(e){this.coursesRestService.publishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}unpublish(e){this.coursesRestService.unpublishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}deleteTest(e){this.action$.next({type:"delete-test",payload:e})}overwriteFinalGrade({id:e,selectedGradeId:i}){this.gradingsRestService.updateGrade(e,i).subscribe(()=>{this.action$.next({type:"final-grade-overwritten",payload:{id:e,selectedGradeId:i}})})}setAveragesAsFinalGrades(e){this.coursesRestService.setAverageAsFinalGrade(e).subscribe(i=>this.action$.next({type:"replace-grades",payload:i.Gradings}))}buildOptimisticResultUpdate(e,i){let a=Wt(e,i.testId,i.studentId),g=a?R({},a):{Id:"",TestId:i.testId,StudentId:i.studentId,CourseRegistrationId:0,GradeId:null,GradeValue:null,GradeDesignation:null,Points:null};return g.GradeId="gradeId"in i?i.gradeId:a?.GradeId??null,g.Points="points"in i?i.points:a?.Points??null,{originalResult:a,updatedResult:g}}updateOrDeleteTestResult(e,i,a,g,k){a?this.updateTestResult(a,g,k):this.deleteTestResult(e,i,g)}updateTestResult(e,i,a){this.action$.next({type:"updateResult",payload:{testResult:e,grading:i??null,ignore:a}})}deleteTestResult(e,i,a){this.action$.next({type:"deleteResult",payload:{testId:e,studentId:i,grading:a}})}toggleTestPublishedState(e){this.action$.next({type:"toggle-test-state",payload:e})}gradingOptions$(e){return e===null?U(null):this.gradingScalesOptions$.pipe(b(i=>i[e]),z(1))}meanOfOverwrittenGradesForCourse(e,i){return this.course$.pipe(b(a=>{if(a.GradingScaleId===null||e[a.GradingScaleId]===void 0)return null;let g=e[a.GradingScaleId];return Ti(it(i),g)}))}};n.\u0275fac=function(i){return new(i||n)(A(pe),A(ni),A(Pi),A(He),A(pi))},n.\u0275prov=me({token:n,factory:n.\u0275fac});let t=n;return t})();var xn=t=>({formGroup:t}),bn=t=>["/events",t,"tests"];function Cn(t,n){if(t&1&&(o(0,"div",31),m(1),l(2,"translate"),d()),t&2){let r=n.$implicit;s(),h(" ",G(2,1,"global.validation-errors."+r.error,r.params)," ")}}function yn(t,n){if(t&1&&(o(0,"div",31),m(1),l(2,"translate"),d()),t&2){let r=n.$implicit;s(),h(" ",G(2,1,"global.validation-errors."+r.error,r.params)," ")}}function Sn(t,n){if(t&1&&(o(0,"div",31),m(1),l(2,"translate"),d()),t&2){let r=n.$implicit;s(),h(" ",G(2,1,"global.validation-errors."+r.error,r.params)," ")}}function In(t,n){if(t&1&&(o(0,"div",31),m(1),l(2,"translate"),d()),t&2){let r=n.$implicit;s(),h(" ",G(2,1,"global.validation-errors."+r.error,r.params)," ")}}function Tn(t,n){if(t&1&&(o(0,"div",31),m(1),l(2,"translate"),d()),t&2){let r=n.$implicit;s(),h(" ",G(2,1,"global.validation-errors."+r.error,r.params)," ")}}function En(t,n){if(t&1&&(K(0),o(1,"div",32)(2,"div",33)(3,"div",17)(4,"label",34),m(5),l(6,"translate"),d(),o(7,"div",35),E(8,"input",36),l(9,"async"),f(10,In,3,4,"div",8),l(11,"async"),d()()(),o(12,"div",33)(13,"div",17)(14,"label",37),m(15),l(16,"translate"),d(),o(17,"div",35),E(18,"input",38),l(19,"async"),f(20,Tn,3,4,"div",8),l(21,"async"),d()()()(),o(22,"div",39),ut(),o(23,"math")(24,"mi"),m(25),l(26,"translate"),d(),o(27,"mo"),m(28,"="),d(),o(29,"mfrac")(30,"mrow")(31,"mi"),m(32),l(33,"translate"),d(),o(34,"mo"),m(35,"\xD7"),d(),o(36,"mn"),m(37,"5"),d()(),o(38,"mi"),m(39),l(40,"translate"),d()(),o(41,"mo"),m(42,"+"),d(),o(43,"mn"),m(44,"1"),d()()(),Y()),t&2){let r,e,i=u(3);s(5),x(p(6,11,"tests.form.max-points")),s(3),se("is-invalid",((r=p(9,13,i.maxPointsErrors$))==null?null:r.length)||!1),s(2),c("ngForOf",p(11,15,i.maxPointsErrors$)),s(5),x(p(16,17,"tests.form.max-points-adjusted")),s(3),se("is-invalid",((e=p(19,19,i.maxPointsAdjustedErrors$))==null?null:e.length)||!1),s(2),c("ngForOf",p(21,21,i.maxPointsAdjustedErrors$)),s(5),h(" ",p(26,23,"tests.form.math.grade")," "),s(7),h(" ",p(33,25,"tests.form.math.points")," "),s(7),x(p(40,27,"tests.form.math.max-points"))}}function kn(t,n){t&1&&(o(0,"div",40)(1,"span",41),m(2,"Loading..."),d()())}function Pn(t,n){if(t&1){let r=O();o(0,"form",3),_("ngSubmit",function(){S(r);let i=u(2);return I(i.onSubmit())}),o(1,"div",4)(2,"div",5)(3,"label",6),m(4),l(5,"translate"),d(),E(6,"input",7),l(7,"async"),l(8,"translate"),f(9,Cn,3,4,"div",8),l(10,"async"),d(),o(11,"div",9)(12,"label",10),m(13),l(14,"translate"),d(),o(15,"div",11)(16,"span",12)(17,"i",13),m(18,"calendar_today"),d()(),o(19,"input",14,0),l(21,"async"),l(22,"translate"),_("click",function(){S(r);let i=q(20);return I(i.toggle())}),d(),f(23,yn,3,4,"div",8),l(24,"async"),d()()(),o(25,"div",15)(26,"label",16),m(27),l(28,"translate"),d(),o(29,"div",5)(30,"div",17)(31,"label",18),m(32),l(33,"translate"),d(),o(34,"div",19),E(35,"input",20),l(36,"async"),f(37,Sn,3,4,"div",8),l(38,"async"),d()()()(),o(39,"div")(40,"label",16),m(41),l(42,"translate"),d(),o(43,"div",21),E(44,"input",22),o(45,"label",23),m(46),l(47,"translate"),d()(),o(48,"div",21),E(49,"input",24),o(50,"label",25),m(51),l(52,"translate"),d()(),f(53,En,45,29,"ng-container",26),d(),o(54,"div",27)(55,"button",28),l(56,"async"),m(57),l(58,"translate"),d(),o(59,"button",29),m(60),l(61,"translate"),f(62,kn,3,0,"div",30),d()()()}if(t&2){let r,e,i,a=u().bkdLet,g=u();c("formGroup",a.formGroup),s(4),x(p(5,29,"tests.form.designation")),s(2),se("is-invalid",((r=p(7,31,g.designationErrors$))==null?null:r.length)||!1),c("placeholder",p(8,33,"tests.form.designation-placeholder")),s(3),c("ngForOf",p(10,35,g.designationErrors$)),s(4),x(p(14,37,"tests.form.date")),s(3),c("id",g.componentId),s(3),se("is-invalid",((e=p(21,39,g.dateErrors$))==null?null:e.length)||!1),c("placeholder",p(22,41,"shared.date-select.default-placeholder")),s(4),c("ngForOf",p(24,43,g.dateErrors$)),s(4),x(p(28,45,"tests.form.weight")),s(5),x(p(33,47,"tests.form.factor")),s(3),se("is-invalid",((i=p(36,49,g.weightErrors$))==null?null:i.length)||!1),s(2),c("ngForOf",p(38,51,g.weightErrors$)),s(4),x(p(42,53,"tests.form.grading-type")),s(3),c("value",!1),s(2),x(p(47,55,"tests.form.grades")),s(3),c("value",!0),s(2),x(p(52,57,"tests.form.points")),s(2),c("ngIf",a.formGroup.get("isPointGrading").value),s(2),c("disabled",g.saving)("routerLink",M(65,bn,p(56,59,g.courseId$))),s(2),h(" ",p(58,61,"tests.form.cancel")," "),s(2),c("disabled",g.saving),s(),h(" ",p(61,63,"tests.form.save")," "),s(2),c("ngIf",g.saving)}}function wn(t,n){if(t&1&&(K(0),f(1,Pn,63,67,"form",2),Y()),t&2){let r=n.bkdLet;s(),c("ngIf",r.formGroup)}}var Je=(()=>{let n=class n{constructor(e,i,a){this.fb=e,this.translate=i,this.testStateService=a,this.test=null,this.saving=!1,this.save=new ne,this.componentId=Dt("bkd-tests-edit-form"),this.formGroup=this.createFormGroup(),this.submitted$=new L(!1),this.destroy$=new te,this.designationErrors$=xe(U(this.formGroup),this.submitted$,"designation"),this.dateErrors$=xe(U(this.formGroup),this.submitted$,"date"),this.maxPointsErrors$=xe(U(this.formGroup),this.submitted$,"maxPoints"),this.maxPointsAdjustedErrors$=xe(U(this.formGroup),this.submitted$,"maxPointsAdjusted"),this.weightErrors$=xe(U(this.formGroup),this.submitted$,"weight"),this.courseId$=this.testStateService.courseId$}ngOnInit(){this.test&&this.setInitialValues(this.test),Lt(U(this.formGroup),"isPointGrading").pipe(ce(this.destroy$)).subscribe(this.togglePointFieldsDisability.bind(this))}ngOnDestroy(){this.destroy$.next()}onSubmit(){this.submitted$.next(!0),this.formGroup.valid&&this.save.emit(this.formGroup.value)}createFormGroup(){return this.fb.group({designation:["",_e.required],date:[null,_e.required],weight:[1,_e.compose([_e.required,vi(0)])],isPointGrading:[!1],maxPoints:[{value:null,disabled:!0},_e.required],maxPointsAdjusted:[{value:null,disabled:!0},null]})}setInitialValues(e){this.formGroup.patchValue({designation:e.Designation,date:e.Date,weight:e.Weight,isPointGrading:e.IsPointGrading,maxPoints:e.MaxPoints,maxPointsAdjusted:e.MaxPointsAdjusted}),e.Results&&e.Results.length>0&&(this.formGroup.get("isPointGrading")?.disable(),this.formGroup.get("maxPoints")?.disable(),this.formGroup.get("maxPointsAdjusted")?.disable()),this.togglePointFieldsDisability()}togglePointFieldsDisability(){let e=this.formGroup.get("maxPoints"),i=this.formGroup.get("maxPointsAdjusted");this.formGroup.get("isPointGrading")?.value?(e?.enable(),i?.enable()):(e?.reset({value:this.test?.MaxPoints,disabled:!0}),i?.reset({value:this.test?.MaxPointsAdjusted,disabled:!0}))}};n.\u0275fac=function(i){return new(i||n)(v(wt),v(X),v(J))},n.\u0275cmp=C({type:n,selectors:[["bkd-tests-edit-form"]],inputs:{test:"test",saving:"saving"},outputs:{save:"save"},standalone:!0,features:[de([{provide:Gt,useClass:Ft},{provide:Ot,useClass:di}]),y],decls:1,vars:3,consts:[["dp","ngbDatepicker"],[4,"bkdLet"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"row","g-3","mb-3"],[1,"col-md-6"],["for","designation",1,"form-label"],["id","designation","name","designation","type","text","formControlName","designation","required","",1,"form-control",3,"placeholder"],["class","invalid-feedback",4,"ngFor","ngForOf"],[1,"col-md-6","mb-3"],["for","date",1,"form-label"],[1,"input-group"],[1,"input-group-text",3,"id"],[1,"material-icons"],["id","date","name","date","type","text","ngbDatepicker","","formControlName","date","required","",1,"form-control",3,"click","placeholder"],[1,"row","mb-3"],[1,"form-label"],[1,"row"],["for","factor",1,"form-label","col-3","col-sm-2"],[1,"col-9","col-sm-10"],["id","factor","name","factor","type","number","formControlName","weight","step","0.05","min","0","required","",1,"form-control"],[1,"form-check"],["type","radio","formControlName","isPointGrading","id","type-grades",1,"form-check-input",3,"value"],["for","type-grades",1,"form-check-label"],["type","radio","formControlName","isPointGrading","id","type-points",1,"form-check-input",3,"value"],["for","type-points",1,"form-check-label"],[4,"ngIf"],[1,"d-flex","justify-content-end","mt-4"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","routerLink"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"invalid-feedback"],[1,"row","ms-4","mb-3","g-3"],[1,"col-sm-6","col-md-4"],["for","max-points",1,"ms-2","col-4","col-form-label"],[1,"col-6"],["type","number","name","maxPoints","id","max-points","formControlName","maxPoints","step","0.01","min","0","max","999","required","",1,"form-control"],["for","max-points-adjusted",1,"ms-2","col-4","col-form-label"],["type","number","name","maxPointsAdjusted","id","max-points-adjusted","formControlName","maxPointsAdjusted","step","0.01","min","0","max","999",1,"form-control"],[1,"ms-4","ps-3","py-3"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"visually-hidden"]],template:function(i,a){i&1&&f(0,wn,2,1,"ng-container",1),i&2&&c("bkdLet",M(1,xn,a.formGroup))},dependencies:[Z,B,ve,It,Be,De,Tt,Re,yt,Pt,Le,je,Mt,Et,kt,ge,$t,ae,V,w,P],styles:["#factor[_ngcontent-%COMP%], #max-points[_ngcontent-%COMP%], #max-points-adjusted[_ngcontent-%COMP%]{width:5em}"]});let t=n;return t})();var Gn=(t,n)=>({courseId:t,saving:n});function On(t,n){if(t&1){let r=O();o(0,"div",1)(1,"bkd-tests-edit-form",2),_("save",function(i){S(r);let a=u();return I(a.save(i))}),d()()}if(t&2){let r=n.bkdLet;s(),c("saving",r.saving)}}var Mi=(()=>{let n=class n{constructor(e,i,a,g,k){this.route=e,this.courseService=i,this.toastService=a,this.translate=g,this.router=k,this.saving$=new L(!1),this.courseId$=this.route.paramMap.pipe(b(T=>Number(T.get("id"))),W())}save(e){this.saving$.next(!0);let{designation:i,date:a,weight:g,isPointGrading:k,maxPoints:T,maxPointsAdjusted:F}=e;this.courseId$.pipe(D(H=>this.courseService.add(H,a,i,g,k,T,F)),Ge(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}navigateBack(){this.courseId$.subscribe(e=>this.router.navigate(["events",e,"tests"]))}};n.\u0275fac=function(i){return new(i||n)(v(fe),v(pe),v(Ve),v(X),v(Fe))},n.\u0275cmp=C({type:n,selectors:[["bkd-tests-add"]],standalone:!0,features:[y],decls:6,vars:11,consts:[["class","bkd-container bkd-container-limited",4,"bkdLet"],[1,"bkd-container","bkd-container-limited"],[3,"save","saving"]],template:function(i,a){i&1&&(o(0,"h1"),m(1),l(2,"translate"),d(),f(3,On,2,1,"div",0),l(4,"async"),l(5,"async")),i&2&&(s(),x(p(2,2,"tests.add-title")),s(2),c("bkdLet",Pe(8,Gn,p(4,4,a.courseId$),p(5,6,a.saving$))))},dependencies:[Z,Je,V,w,P]});let t=n;return t})();var Gi=(()=>{let n=class n{constructor(e){this.activeModal=e}get canDeleteTest(){return(this.test?.Results?.filter(i=>i.GradeId!==null||i.GradeValue!==null||i.Points!==null)||[]).length===0}};n.\u0275fac=function(i){return new(i||n)(v(Ae))},n.\u0275cmp=C({type:n,selectors:[["bkd-tests-delete"]],inputs:{test:"test"},standalone:!0,features:[y],decls:13,vars:10,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click","hidden"],[1,"px-2"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"],[1,"px-3"]],template:function(i,a){i&1&&(o(0,"div",0)(1,"p",1),m(2),l(3,"translate"),d()(),o(4,"div",2)(5,"button",3),_("click",function(){return a.activeModal.dismiss()}),o(6,"span",4),m(7),l(8,"translate"),d()(),o(9,"button",5),_("click",function(){return a.activeModal.close(a.canDeleteTest?a.test:null)}),o(10,"span",6),m(11),l(12,"translate"),d()()()),i&2&&(s(2),h(" ",p(3,4,a.canDeleteTest?"tests.form.confirm":"tests.form.delete-not-allowed")," "),s(3),c("hidden",!a.canDeleteTest),s(2),h(" ",p(8,6,"tests.dialog.no")," "),s(4),h(" ",p(12,8,a.canDeleteTest?"tests.dialog.yes":"tests.dialog.ok")," "))},dependencies:[w,P]});let t=n;return t})();var Bn=(t,n,r)=>({courseId:t,test:n,saving:r}),Rn=t=>({test:t});function Dn(t,n){if(t&1){let r=O();K(0),o(1,"div",4)(2,"h1"),m(3),l(4,"translate"),d(),o(5,"button",5),_("click",function(){S(r);let i=u().bkdLet,a=u();return I(a.openDeleteModal(i.test))}),o(6,"i",6),m(7,"delete"),d()()(),o(8,"bkd-tests-edit-form",7),_("save",function(i){S(r);let a=u(2);return I(a.save(i))}),d(),Y()}if(t&2){let r=u().bkdLet;s(3),h(" ",G(4,3,"tests.edit-title",M(6,Rn,r.test.Designation))," "),s(5),c("test",r.test)("saving",r.saving)}}function jn(t,n){t&1&&E(0,"bkd-spinner")}function Ln(t,n){if(t&1&&(o(0,"div",2),f(1,Dn,9,8,"ng-container",3),l(2,"async"),f(3,jn,1,0,"ng-template",null,0,re),d()),t&2){let r=q(4),e=u();s(),c("ngIf",p(2,2,e.state.loading$)===!1)("ngIfElse",r)}}var Oi=(()=>{let n=class n{constructor(e,i,a,g,k,T,F){this.state=e,this.courseService=i,this.route=a,this.toastService=g,this.translate=k,this.router=T,this.modalService=F,this.saving$=new L(!1),this.testId$=this.route.paramMap.pipe(b(H=>Number(H.get("testId"))),W()),this.test$=ie([this.state.tests$,this.testId$]).pipe(b(([H,Te])=>H.find(we=>we.Id===Te)))}openDeleteModal(e){let i=this.modalService.open(Gi);i.componentInstance.test=e,i.result.then(a=>{a&&this.courseService.delete(e.CourseId,e.Id).subscribe(this.onDeleteSuccess.bind(this))},()=>{})}save(e){this.saving$.next(!0);let{designation:i,date:a,weight:g,isPointGrading:k,maxPoints:T,maxPointsAdjusted:F}=e;ie([this.state.courseId$,this.testId$]).pipe(ee(1),D(([H,Te])=>this.courseService.update(H,Te,i,a,g,k,T,F)),Ge(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}onDeleteSuccess(e){this.toastService.success(this.translate.instant("tests.form.delete-success")),this.state.deleteTest(e),this.navigateBack()}navigateBack(){this.state.courseId$.pipe(ee(1)).subscribe(e=>this.router.navigate(["events",e,"tests"]))}};n.\u0275fac=function(i){return new(i||n)(v(J),v(pe),v(fe),v(Ve),v(X),v(Fe),v(We))},n.\u0275cmp=C({type:n,selectors:[["bkd-tests-edit"]],standalone:!0,features:[y],decls:4,vars:11,consts:[["loading",""],["class","bkd-container bkd-container-limited",4,"bkdLet"],[1,"bkd-container","bkd-container-limited"],[4,"ngIf","ngIfElse"],[1,"d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-primary","btn-icon",3,"click"],[1,"material-icons"],[3,"save","test","saving"]],template:function(i,a){i&1&&(f(0,Ln,5,4,"div",1),l(1,"async"),l(2,"async"),l(3,"async")),i&2&&c("bkdLet",_t(7,Bn,p(1,1,a.state.courseId$),p(2,3,a.test$),p(3,5,a.saving$)))},dependencies:[Z,B,Je,Ce,V,w,P]});let t=n;return t})();var An=t=>({designation:t}),$i=(()=>{let n=class n{constructor(e){this.activeModal=e}};n.\u0275fac=function(i){return new(i||n)(v(Ae))},n.\u0275cmp=C({type:n,selectors:[["bkd-publish-test"]],inputs:{test:"test"},standalone:!0,features:[y],decls:11,vars:12,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"]],template:function(i,a){i&1&&(o(0,"div",0)(1,"p",1),m(2),l(3,"translate"),d()(),o(4,"div",2)(5,"button",3),_("click",function(){return a.activeModal.dismiss()}),m(6),l(7,"translate"),d(),o(8,"button",4),_("click",function(){return a.activeModal.close(!0)}),m(9),l(10,"translate"),d()()),i&2&&(s(2),h(" ",G(3,3,a.test.IsPublished?"tests.publishing.unpublish":"tests.publishing.publish",M(10,An,a.test.Designation))," "),s(4),h(" ",p(7,6,"tests.publishing.cancel")," "),s(3),h(" ",p(10,8,"tests.publishing.confirm")," "))},dependencies:[w,P],encapsulation:2});let t=n;return t})();var Vn=t=>({maxPoints:t});function Nn(t,n){if(t&1&&(o(0,"div",8),m(1),l(2,"translate"),d()),t&2){let r=u(2);s(),h(" ",G(2,1,"global.validation-errors.invalidPoints",M(4,Vn,r.maxPoints))," ")}}function Hn(t,n){if(t&1){let r=O();o(0,"div",5)(1,"input",6,0),_("ngModelChange",function(){S(r);let i=q(2),a=u();return I(a.onPointsChange(i.value))}),d(),f(3,Nn,3,6,"div",7),d()}if(t&2){let r=q(2),e=u();s(),se("is-invalid",r.errors),oe("max",e.maxPoints),oe("tabindex",e.tabIndex),c("disabled",e.grade.test.IsPublished)("ngModel",e.grade.kind==="grade"?e.grade.result.Points:null),s(2),c("ngIf",r.errors)}}var Un=1250,Fi=(()=>{let n=class n{constructor(e){this.state=e,this.maxPoints=0,this.pointsSubject$=new te,this.gradeSubject$=new te,this.gradingScaleDisabledSubject$=new L(!0),this.gradingScaleDisabled$=this.gradingScaleDisabledSubject$.asObservable(),this.destroy$=new te}ngOnInit(){this.gradingScaleDisabledSubject$.next(this.disableGradingScale()),this.maxPoints=Si(this.grade),this.initSave(this.pointsSubject$.pipe(Ee(this.isValid.bind(this)),b(e=>({studentId:this.student.Id,testId:this.grade.test.Id,points:e?Number(e):null})))),this.initSave(this.gradeSubject$.pipe(b(e=>({studentId:this.student.Id,testId:this.grade.test.Id,gradeId:e}))))}ngOnChanges(){this.gradingScaleDisabledSubject$.next(this.disableGradingScale())}ngOnDestroy(){this.destroy$.next()}onPointsChange(e){this.pointsSubject$.next(e),this.gradingScaleDisabledSubject$.next(!(e===null||e===""))}onGradeChange(e){this.gradeSubject$.next(e)}isValid(e){return e===""||e===null?!0:isNaN(Number(e))?!1:!(Number(e)<0||Number(e)>this.maxPoints)}initSave(e){e.pipe(dt(i=>this.state.optimisticallyUpdateGrade(i).pipe(b(a=>({params:i,originalResult:a})))),lt(Un),ce(this.destroy$)).subscribe(({params:i,originalResult:a})=>this.state.saveGrade(i,a))}disableGradingScale(){return this.grade.test.IsPublished?!0:this.grade.kind==="no-result"?!1:this.grade.result.Points!=null&&this.grade.test.IsPointGrading}};n.\u0275fac=function(i){return new(i||n)(v(J))},n.\u0275cmp=C({type:n,selectors:[["bkd-grade"]],inputs:{grade:"grade",student:"student",tabIndex:"tabIndex",gradeOptions:"gradeOptions"},standalone:!0,features:[ue,y],decls:5,vars:8,consts:[["points","ngModel"],[1,"d-flex","flex-column","w-100"],[1,"d-flex","flex-row"],["class","point-input-container me-2 me-md-3",4,"ngIf"],["data-testid","grade-select",1,"grade-select",3,"valueChange","options","allowEmpty","value","disabled","tabindex"],[1,"point-input-container","me-2","me-md-3"],["type","number","step","0.01","min","0","data-testid","point-input",1,"form-control",3,"ngModelChange","max","disabled","tabindex","ngModel"],["class","invalid-feedback","data-testid","validation-error-message",4,"ngIf"],["data-testid","validation-error-message",1,"invalid-feedback"]],template:function(i,a){i&1&&(o(0,"div",1)(1,"div",2),f(2,Hn,4,7,"div",3),o(3,"bkd-select",4),l(4,"async"),_("valueChange",function(k){return a.onGradeChange(k)}),d()()()),i&2&&(s(2),c("ngIf",a.grade.test.IsPointGrading),s(),c("options",a.gradeOptions)("allowEmpty",!0)("value",a.grade.kind==="grade"?a.grade.result.GradeId:null)("disabled",p(4,6,a.gradingScaleDisabled$))("tabindex",a.tabIndex))},dependencies:[B,ve,Be,De,Re,Le,je,St,ye,V,w,P],styles:[".point-input-container[_ngcontent-%COMP%]{width:4em}[_nghost-%COMP%]     select{min-width:13ch}@media (min-width: 576px){.point-input-container[_ngcontent-%COMP%]{width:5em}}"]});let t=n;return t})();function qn(t,n){if(t&1&&(o(0,"span",3),m(1),d()),t&2){let r=u();s(),x(r.calculatePointsAverage(r.test))}}var Bi=(()=>{let n=class n{constructor(e){this.locale=e}calculatePointsAverage(e){return this.safeAverage(e,2,Ue)}calculateGradeAverage(e){return this.safeAverage(e,3,qe)}safeAverage(e,i,a){try{return ei(a(e),this.locale,i)}catch{return Xt}}};n.\u0275fac=function(i){return new(i||n)(v(bt))},n.\u0275cmp=C({type:n,selectors:[["bkd-average-grades"]],inputs:{test:"test"},standalone:!0,features:[y],decls:4,vars:2,consts:[[1,"d-flex","flex-row","w-100"],["class","mr-2 mr-md-3 average-points","data-testid","average-points",4,"ngIf"],["data-testid","average-grade"],["data-testid","average-points",1,"mr-2","mr-md-3","average-points"]],template:function(i,a){i&1&&(o(0,"div",0),f(1,qn,2,1,"span",1),o(2,"span",2),m(3),d()()),i&2&&(s(),c("ngIf",a.test.IsPointGrading),s(2),x(a.calculateGradeAverage(a.test)))},dependencies:[B],styles:[".average-points[_ngcontent-%COMP%]{min-width:4.5em}@media (min-width: 576px){.average-points[_ngcontent-%COMP%]{min-width:6em}}"]});let t=n;return t})();var Ri=(()=>{let n=class n{constructor(){this.disabled=!1,this.gradeIdSelected=new ne}onGradeChange(e){this.gradeId?.valueOf()!==void 0&&this.gradeIdSelected.emit({id:this.gradeId?.valueOf(),selectedGradeId:e})}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=C({type:n,selectors:[["bkd-grade-select"]],inputs:{options:"options",valueId:"valueId",gradeId:"gradeId",disabled:"disabled"},outputs:{gradeIdSelected:"gradeIdSelected"},standalone:!0,features:[y],decls:1,vars:4,consts:[["data-testid","grade-select",3,"valueChange","options","allowEmpty","value","disabled"]],template:function(i,a){i&1&&(o(0,"bkd-select",0),_("valueChange",function(k){return a.onGradeChange(k)}),d()),i&2&&c("options",a.options)("allowEmpty",!0)("value",a.valueId)("disabled",a.disabled)},dependencies:[ye],styles:["[_nghost-%COMP%]     select{min-width:13ch}"]});let t=n;return t})();var Di=(t,n)=>({"btn-primary":t,"btn-outline-secondary":n}),ji=(()=>{let n=class n{constructor(){this.filter=rt,this.filterChange=new ne}showOnlyMine(){this.filterChange.next(j(R({},this.filter),{onlyMine:!0}))}showAll(){this.filterChange.next(j(R({},this.filter),{onlyMine:!1}))}onHidePublishedChange(e){let i=(e.target&&e.target instanceof HTMLInputElement&&e.target?.checked)??!1;this.filterChange.next(j(R({},this.filter),{hidePublished:i}))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=C({type:n,selectors:[["bkd-test-table-filter"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},standalone:!0,features:[y],decls:13,vars:18,consts:[[1,"only-mine-buttons"],["type","button",1,"btn","desktop",3,"click","ngClass"],["type","button",1,"btn","ms-2","desktop",3,"click","ngClass"],[1,"hide-published"],[1,"form-check"],["id","hide-published","type","checkbox",1,"form-check-input",3,"change","checked"],["for","hide-published",1,"form-check-label"]],template:function(i,a){i&1&&(o(0,"div",0)(1,"button",1),_("click",function(){return a.showAll()}),m(2),l(3,"translate"),d(),o(4,"button",2),_("click",function(){return a.showOnlyMine()}),m(5),l(6,"translate"),d()(),o(7,"div",3)(8,"div",4)(9,"input",5),_("change",function(k){return a.onHidePublishedChange(k)}),d(),o(10,"label",6),m(11),l(12,"translate"),d()()()),i&2&&(s(),c("ngClass",Pe(12,Di,!a.filter.onlyMine,a.filter.onlyMine)),s(),h(" ",p(3,6,"tests.all-tests")," "),s(2),c("ngClass",Pe(15,Di,a.filter.onlyMine,!a.filter.onlyMine)),s(),h(" ",p(6,8,"tests.owned-tests")," "),s(4),c("checked",a.filter.hidePublished),s(2),h(" ",p(12,10,"tests.hide-published")," "))},dependencies:[le,ve,w,P],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:100%}.only-mine-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;height:3.625rem}.hide-published[_ngcontent-%COMP%]{display:flex;align-items:center;height:2.375rem;margin-bottom:1rem}.hide-published[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:300}.hide-published[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]{margin-bottom:0}"]});let t=n;return t})();var Wn=["*"],Li=(()=>{let n=class n{};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=C({type:n,selectors:[["bkd-preserve-line-height"]],standalone:!0,features:[y],ngContentSelectors:Wn,decls:3,vars:0,template:function(i,a){i&1&&(gt(),o(0,"div"),ft(1),m(2,"\xA0"),d())},encapsulation:2});let t=n;return t})();var Ai=(()=>{let n=class n{constructor(e){this.translate=e}transform(e){return`${e.Weight} (${e.WeightPercent}%)${this.getPoints(e)}`}getPoints(e){return e.IsPointGrading?`, ${e.MaxPointsAdjusted??e.MaxPoints} ${this.translate.instant("tests.summary.points")}`:""}};n.\u0275fac=function(i){return new(i||n)(v(X,16))},n.\u0275pipe=mt({name:"testSummaryShort",type:n,pure:!0,standalone:!0});let t=n;return t})();var zn=t=>[t,"edit"];function Kn(t,n){t&1&&(o(0,"i",12),m(1,"edit"),d())}function Yn(t,n){if(t&1&&(o(0,"div",8)(1,"div",9)(2,"bkd-preserve-line-height"),m(3),l(4,"date"),d(),o(5,"a",10),f(6,Kn,2,0,"i",11),d()(),o(7,"bkd-preserve-line-height"),m(8),l(9,"testSummaryShort"),d(),o(10,"bkd-preserve-line-height"),m(11),d()()),t&2){let r=u();s(3),x(G(4,5,r.test.Date,"dd.MM.yyyy")),s(2),c("routerLink",M(10,zn,r.test.Id)),s(),c("ngIf",r.test.IsOwner&&r.test.IsPublished===!1),s(2),h(" ",p(9,8,r.test)," "),s(3),x(r.test.Owner)}}function Jn(t,n){if(t&1){let r=O();o(0,"div",13)(1,"a",14),l(2,"translate"),_("click",function(){S(r);let i=u();return I(i.unpublishTest())}),o(3,"i",15),m(4,"lock"),d(),o(5,"span"),m(6),l(7,"translate"),d()(),o(8,"bkd-caret",16),_("click",function(){S(r);let i=u();return I(i.toggleHeader())}),d()()}if(t&2){let r=u();s(),oe("title",p(2,3,"tests.edit")),s(5),x(p(7,5,"tests.published")),s(2),c("expanded",r.expanded)}}function Qn(t,n){if(t&1){let r=O();o(0,"div",13)(1,"a",17),l(2,"translate"),_("click",function(){S(r);let i=u();return I(i.publishTest())}),o(3,"i",15),m(4,"lock_open"),d(),o(5,"span"),m(6),l(7,"translate"),d()(),o(8,"bkd-caret",16),_("click",function(){S(r);let i=u();return I(i.toggleHeader())}),d()()}if(t&2){let r=u();s(),oe("title",p(2,3,"tests.publish")),s(5),x(p(7,5,"tests.not-published")),s(2),c("expanded",r.expanded)}}var Vi=(()=>{let n=class n{constructor(){this.toggle=new ne,this.publish=new ne,this.unpublish=new ne}toggleHeader(){this.toggle.emit(!this.expanded)}publishTest(){this.publish.emit(this.test)}unpublishTest(){this.unpublish.emit(this.test)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=C({type:n,selectors:[["bkd-test-table-header"]],inputs:{test:"test",expanded:"expanded"},outputs:{toggle:"toggle",publish:"publish",unpublish:"unpublish"},standalone:!0,features:[y],decls:10,vars:6,consts:[["notPublished",""],[1,"d-flex","flex-column","h-100","justify-content-between"],["role","button",1,"test-designation","d-flex","flex-row","my-3","align-items-end","justify-content-between",3,"click"],[3,"ngClass"],[1,"align-self-start",3,"expanded"],[1,"d-flex","flex-column"],["class","d-flex flex-column mb-3",4,"ngIf"],["class","d-flex align-items-center justify-content-between test-status",4,"ngIf","ngIfElse"],[1,"d-flex","flex-column","mb-3"],[1,"d-flex","flex-row","justify-content-between"],[1,"btn","btn-link","p-0","edit",3,"routerLink"],["class","material-icons",4,"ngIf"],[1,"material-icons"],[1,"d-flex","align-items-center","justify-content-between","test-status"],[1,"d-flex","btn","btn-link","ps-0","edit",3,"click","title"],[1,"material-icons","me-1"],[1,"expand-mobile",3,"click","expanded"],[1,"d-flex","btn","btn-link","ps-0",3,"click","title"]],template:function(i,a){if(i&1){let g=O();o(0,"div",1)(1,"div",2),_("click",function(){return S(g),I(a.toggleHeader())}),o(2,"div",3),m(3),d(),E(4,"bkd-caret",4),d(),o(5,"div",5),f(6,Yn,12,12,"div",6)(7,Jn,9,7,"div",7)(8,Qn,9,7,"ng-template",null,0,re),d()()}if(i&2){let g=q(9);s(2),c("ngClass",a.expanded?"expanded":"collapsed"),s(),h(" ",a.test.Designation," "),s(),c("expanded",a.expanded),s(2),c("ngIf",a.expanded),s(),c("ngIf",a.test.IsPublished)("ngIfElse",g)}},dependencies:[le,qt,B,Li,ae,Oe,w,P,Ai],styles:["[_nghost-%COMP%]{font-weight:300}.collapsed[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.test-designation[_ngcontent-%COMP%]{display:none!important}.test-status[_ngcontent-%COMP%]{order:-1;padding-bottom:1rem}.test-status[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.test-status[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#000}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.edit[_ngcontent-%COMP%]{color:#00000080;text-decoration:none}@media (min-width: 750px){.test-designation[_ngcontent-%COMP%]{display:inherit!important}.test-status[_ngcontent-%COMP%]{order:initial}.expand-mobile[_ngcontent-%COMP%]{display:none!important}}"]});let t=n;return t})();var Xn=(t,n,r,e,i)=>({tests:t,hasTests:n,studentGrades:r,filter:e,expanded:i}),at=t=>({selected:t}),Zn=t=>["student",t,"grades"],er=t=>({"visible-on-mobile":t});function tr(t,n){if(t&1){let r=O();o(0,"th",24)(1,"bkd-test-table-header",25),_("toggle",function(i){S(r);let a=u(2);return I(a.state.toggleHeader(i))})("publish",function(i){S(r);let a=u(2);return I(a.publish(i))})("unpublish",function(i){S(r);let a=u(2);return I(a.unpublish(i))}),d()()}if(t&2){let r=n.$implicit,e=u().bkdLet,i=u();c("ngClass",r.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),s(),c("test",r)("expanded",e.expanded)}}function ir(t,n){if(t&1){let r=O();o(0,"th",26)(1,"bkd-test-table-header",25),_("toggle",function(i){S(r);let a=u(2);return I(a.state.toggleHeader(i))})("publish",function(i){S(r);let a=u(2);return I(a.publish(i))})("unpublish",function(i){S(r);let a=u(2);return I(a.unpublish(i))}),d()()}if(t&2){let r=n.$implicit,e=u().bkdLet,i=u();c("ngClass",r.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),s(),c("test",r)("expanded",e.expanded)}}function nr(t,n){if(t&1){let r=O();o(0,"div",30)(1,"span",29),_("click",function(){S(r);let i=u().$implicit,a=u(2);return I(a.state.sortBy(i))}),m(2),l(3,"translate"),d()()}t&2&&(s(2),h("",p(3,1,"tests.points")," "))}function rr(t,n){if(t&1){let r=O();o(0,"th",27)(1,"div",10),f(2,nr,4,3,"div",28),o(3,"div",11)(4,"span",29),_("click",function(){let i=S(r).$implicit,a=u(2);return I(a.state.sortBy(i))}),m(5),l(6,"translate"),d()(),o(7,"div",12),m(8),l(9,"async"),d()()()}if(t&2){let r=n.$implicit,e=u(2);c("ngClass",r.Id===(e.selectedTest==null?null:e.selectedTest.Id)?"selected":""),s(2),c("ngIf",r.IsPointGrading),s(3),x(p(6,4,"tests.grade")),s(3),h(" ",p(9,6,e.state.getSortingChar$(r))," ")}}function ar(t,n){if(t&1){let r=O();o(0,"bkd-grade-select",38),l(1,"async"),l(2,"async"),_("gradeIdSelected",function(i){S(r);let a=u(3);return I(a.state.overwriteFinalGrade(i))}),d()}if(t&2){let r=u().$implicit,e=u(2);c("options",p(1,4,e.state.gradingOptionsForCourse$()))("valueId",r.finalGrade.finalGradeId)("gradeId",r.finalGrade.id)("disabled",p(2,6,e.isEditFinalGradesAllowed(r))===!1)}}function sr(t,n){if(t&1&&(o(0,"div"),m(1),d()),t&2){let r=u().$implicit;s(),h(" ",r.finalGrade.freeHandGrade," ")}}function or(t,n){if(t&1&&(o(0,"td",39),E(1,"bkd-grade",40),l(2,"async"),d()),t&2){let r=n.$implicit,e=n.index,i=u(),a=i.$implicit,g=i.index,k=u(2);c("ngClass",k.selectedTest!==void 0&&r.test.Id===k.selectedTest.Id?"selected":""),s(),c("grade",r)("gradeOptions",p(2,5,k.state.gradingOptionsForTest$(r.test)))("student",a.student)("tabIndex",(1+e)*1e3+g)}}function dr(t,n){if(t&1&&(o(0,"tr")(1,"td",31)(2,"a",32)(3,"span"),m(4),d(),o(5,"span",19),m(6),l(7,"translate"),l(8,"decimalOrDash"),d()()(),o(9,"td",33),f(10,ar,3,8,"bkd-grade-select",34)(11,sr,2,1,"div",35),d(),o(12,"td",36),m(13),l(14,"decimalOrDash"),d(),f(15,or,3,7,"td",37),d()),t&2){let r=n.$implicit,e=u(2);s(2),c("routerLink",M(18,Zn,r.student.Id)),s(2),x(r.student.FullName),s(2),Ze(" ",p(7,10,"tests.mean"),": ",G(8,12,r.finalGrade==null?null:r.finalGrade.average,"1-3")," "),s(3),c("ngClass",M(20,at,e.selectedTest===void 0)),s(),c("ngIf",r.finalGrade&&!r.finalGrade.freeHandGrade),s(),c("ngIf",r.finalGrade&&r.finalGrade.freeHandGrade),s(2),h(" ",G(14,15,r.finalGrade==null?null:r.finalGrade.average,"1-3")," "),s(2),c("ngForOf",r.grades)("ngForTrackBy",e.trackGradeOf(r.student))}}function lr(t,n){if(t&1&&(o(0,"td",39),E(1,"bkd-average-grades",41),d()),t&2){let r=n.$implicit,e=u(2);c("ngClass",r.Id===(e.selectedTest==null?null:e.selectedTest.Id)||r.Id===(e.selectedTest==null?null:e.selectedTest.Id)?"selected":""),s(),c("test",r)}}function pr(t,n){if(t&1){let r=O();o(0,"button",42),_("click",function(){S(r);let i=u(2);return I(i.setAverageAsFinalGrade())}),m(1),l(2,"translate"),d()}if(t&2){let r=u().bkdLet,e=u();c("ngClass",M(4,er,!r.hasTests||!e.selectedTest)),s(),h(" ",p(2,2,"tests.set-final-grade")," ")}}function cr(t,n){if(t&1){let r=O();K(0),o(1,"div",1)(2,"table",2)(3,"thead",3)(4,"tr",4)(5,"th",5)(6,"bkd-test-table-filter",6),_("filterChange",function(i){S(r);let a=u();return I(a.state.setFilter(i))}),d()(),f(7,tr,2,3,"th",7)(8,ir,2,3,"th",8),d(),o(9,"tr")(10,"th",9),_("click",function(){S(r);let i=u();return I(i.state.sortBy("FullName"))}),o(11,"div",10)(12,"div",11),m(13),l(14,"translate"),d(),o(15,"div",12),m(16),l(17,"async"),d()()(),o(18,"th",13),_("click",function(){S(r);let i=u();return I(i.state.sortBy("FinalGrade"))}),o(19,"div",10)(20,"div",11),m(21),l(22,"translate"),d(),o(23,"div",12),m(24),l(25,"async"),d()()(),o(26,"th",14),_("click",function(){S(r);let i=u();return I(i.state.sortBy("TestsMean"))}),o(27,"div",10)(28,"div",11),m(29),l(30,"translate"),d(),o(31,"div",12),m(32),l(33,"async"),d()()(),f(34,rr,10,8,"th",15),d()(),o(35,"tbody"),f(36,dr,16,22,"tr",16),o(37,"tr")(38,"td",17)(39,"div",18)(40,"div"),m(41),l(42,"translate"),d(),o(43,"div",19),m(44),l(45,"translate"),l(46,"async"),l(47,"decimalOrDash"),d()()(),o(48,"td",20),m(49),l(50,"async"),l(51,"decimalOrDash"),d(),o(52,"td",21),m(53),l(54,"async"),l(55,"decimalOrDash"),d(),f(56,lr,2,2,"td",22),d()()(),f(57,pr,3,6,"button",23),l(58,"async"),d(),Y()}if(t&2){let r=n.bkdLet,e=u();s(6),c("filter",r.filter),s(),c("ngForOf",r.tests),s(),c("ngForOf",r.tests),s(5),h(" ",p(14,21,"tests.student.name")," "),s(3),h(" ",p(17,23,e.state.getSortingChar$("FullName"))," "),s(2),c("ngClass",M(54,at,e.selectedTest===void 0)),s(3),h(" ",p(22,25,"tests.grade")," "),s(3),h(" ",p(25,27,e.state.getSortingChar$("FinalGrade"))," "),s(5),h(" ",p(30,29,"tests.mean")," "),s(3),h(" ",p(33,31,e.state.getSortingChar$("TestsMean"))," "),s(2),c("ngForOf",r.tests),s(2),c("ngForOf",r.studentGrades)("ngForTrackBy",e.trackStudentGrade),s(5),x(p(42,33,"tests.average")),s(3),Ze(" ",p(45,35,"tests.mean"),": ",G(47,39,p(46,37,e.state.meanOfStudentGradesForCourse$),"1-3")," "),s(4),c("ngClass",M(56,at,e.selectedTest===void 0)),s(),h(" ",G(51,44,p(50,42,e.state.meanOfFinalGradesForCourse$),"1-3")," "),s(4),h(" ",G(55,49,p(54,47,e.state.meanOfStudentGradesForCourse$),"1-3")," "),s(3),c("ngForOf",r.tests),s(),c("ngIf",p(58,52,e.state.canSetFinalGrade$))}}var Ni=(()=>{let n=class n{constructor(e,i){this.state=e,this.modalService=i}ngOnInit(){this.state.setSorting({key:"FullName",ascending:!0})}setAverageAsFinalGrade(){this.state.course$.pipe(ee(1)).subscribe(e=>this.state.setAveragesAsFinalGrades({CourseIds:[e.Id]}))}isEditFinalGradesAllowed(e){return this.state.course$.pipe(b(i=>!!(ze(i)?.value&&e.finalGrade?.canGrade)))}publish(e){let i=this.openModal(e);this.onCloseModal(i,()=>this.state.publish(e))}unpublish(e){let i=this.openModal(e);this.onCloseModal(i,()=>this.state.unpublish(e))}trackStudentGrade(e){return e}trackGradeOf(e){return function(i,a){return`${e.Id}_${a.test.Id}`}}calculatePointsAverage(e){return this.safeAverage(e,Ue)}calculateGradeAverage(e){return this.safeAverage(e,qe)}safeAverage(e,i){try{return i(e).toString()}catch{return"\u2013"}}openModal(e){let i=this.modalService.open($i);return i.componentInstance.test=e,i}onCloseModal(e,i){e.result.then(a=>{a&&i()},()=>{})}};n.\u0275fac=function(i){return new(i||n)(v(J),v(We))},n.\u0275cmp=C({type:n,selectors:[["bkd-test-edit-grades"]],inputs:{selectedTest:"selectedTest"},standalone:!0,features:[de([Se]),y],decls:6,vars:17,consts:[[4,"bkdLet"],[1,"table-responsive-wrapper"],[1,"table","table-hover","h-100"],[1,"h-100"],[1,"h-100","header-collapsible"],["colspan","3",1,"desktop","sticky"],[3,"filterChange","filter"],["container","body","class","grade h-100 test-info-desktop",3,"ngClass",4,"ngFor","ngForOf"],["container","body","class","grade h-100 header-mobile test-info-mobile","colspan","3",3,"ngClass",4,"ngFor","ngForOf"],[1,"primary-column-width","sticky",3,"click"],[1,"d-flex"],[1,"column-title"],[1,"sort-direction","ms-1"],[1,"secondary-column-width","sticky","sticky-col-2","desktop",3,"click","ngClass"],[1,"secondary-column-width","border-end","sticky","sticky-col-3","desktop",3,"click"],["container","body","class","grade h-100",3,"ngClass",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"sticky"],[1,"d-flex","flex-column"],[1,"mobile","mean"],[1,"desktop","sticky","sticky","sticky-col-2",3,"ngClass"],[1,"desktop","border-end","sticky","sticky-col-3"],["class","grade",3,"ngClass",4,"ngFor","ngForOf"],["data-testId","apply-average-button","class","apply-average-button btn btn-primary m-3","type","button",3,"ngClass","click",4,"ngIf"],["container","body",1,"grade","h-100","test-info-desktop",3,"ngClass"],[3,"toggle","publish","unpublish","test","expanded"],["container","body","colspan","3",1,"grade","h-100","header-mobile","test-info-mobile",3,"ngClass"],["container","body",1,"grade","h-100",3,"ngClass"],["class","column-title me-3 point-input-container",4,"ngIf"],[3,"click"],[1,"column-title","me-3","point-input-container"],[1,"primary-column-width","sticky","name"],[3,"routerLink"],[1,"grade","sticky","sticky-col-2",3,"ngClass"],[3,"options","valueId","gradeId","disabled","gradeIdSelected",4,"ngIf"],[4,"ngIf"],[1,"grade","border-end","sticky","sticky-col-3"],["class","grade",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[3,"gradeIdSelected","options","valueId","gradeId","disabled"],[1,"grade",3,"ngClass"],[3,"grade","gradeOptions","student","tabIndex"],[3,"test"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"click","ngClass"]],template:function(i,a){i&1&&(f(0,cr,59,58,"ng-container",0),l(1,"async"),l(2,"async"),l(3,"async"),l(4,"async"),l(5,"async")),i&2&&c("bkdLet",vt(11,Xn,p(1,1,a.state.filteredTests$),p(2,3,a.state.hasTests$),p(3,5,a.state.studentGrades$),p(4,7,a.state.filter$),p(5,9,a.state.expandedHeader$)))},dependencies:[Z,le,ge,ji,Vi,B,ae,Ri,Fi,Bi,V,w,P,Zt],styles:[".filter-hover[_ngcontent-%COMP%]:hover{background-color:#dedede}table[_ngcontent-%COMP%]   th.grade.selected[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td.grade.selected[_ngcontent-%COMP%]{display:table-cell!important}table[_ngcontent-%COMP%]   th.grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td.grade[_ngcontent-%COMP%], .desktop[_ngcontent-%COMP%]{display:none!important}.desktop.selected[_ngcontent-%COMP%]{display:table-cell!important}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;vertical-align:top}.header-collapsible[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:0 1rem}.mobile[_ngcontent-%COMP%]{display:block!important}.mean[_ngcontent-%COMP%]{color:#4e4e4ef2;font-size:.875rem;line-height:1}td.name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}td.name[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{text-decoration:underline}td.name[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:none!important}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem}table[_ngcontent-%COMP%]   td.name[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td.average[_ngcontent-%COMP%]{max-width:18ch;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-right:0}.point-input-container[_ngcontent-%COMP%]{width:5em}@media (min-width: 576px){.table-responsive-wrapper[_ngcontent-%COMP%]{display:block;overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th.test-info-mobile[_ngcontent-%COMP%]{display:none!important}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   th.grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td.grade[_ngcontent-%COMP%], .desktop[_ngcontent-%COMP%]{display:table-cell!important}table[_ngcontent-%COMP%]   td.name[_ngcontent-%COMP%]{max-width:auto;overflow:visible}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;padding-top:.25rem;padding-bottom:.25rem;border-top:initial;min-width:100px;max-width:100px}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th.grade[_ngcontent-%COMP%]{min-width:300px;max-width:300px}.mobile[_ngcontent-%COMP%]{display:none!important}.primary-column-width[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-width:300px;max-width:300px}.secondary-column-width[_ngcontent-%COMP%]{min-width:100px;max-width:100px}table[_ngcontent-%COMP%]   .sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}table[_ngcontent-%COMP%]   .sticky.sticky-col-2[_ngcontent-%COMP%]{left:300px}table[_ngcontent-%COMP%]   .sticky.sticky-col-3[_ngcontent-%COMP%]{left:452px}}@media (max-width: 575.98px){.apply-average-button[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]});let t=n;return t})();var mr=()=>["/events"],ur=t=>({count:t});function gr(t,n){if(t&1&&(o(0,"div",8),m(1),l(2,"translate"),d()),t&2){let r=u();s(),h(" ",G(2,1,r.course.ParticipatingStudents.length===1?"courses.registration":"courses.registrations",M(4,ur,r.course.ParticipatingStudents.length))," ")}}var Hi=(()=>{let n=class n{constructor(e){this.reportsService=e,this.course$=new L(null),this.reports$=this.course$.pipe(b(i=>i?.Id),W(),D(i=>i?this.reportsService.getCourseReports(i):U([])),ct([]))}ngOnChanges(e){e.course&&this.course$.next(e.course.currentValue)}getDesignation(){return Ke(this.course)}};n.\u0275fac=function(i){return new(i||n)(v(ii))},n.\u0275cmp=C({type:n,selectors:[["bkd-tests-header"]],inputs:{course:"course"},standalone:!0,features:[ue,y],decls:12,vars:7,consts:[[3,"link"],[1,"d-flex"],["routerLink","add",1,"edit","btn","btn-primary","btn-icon","ms-2"],[1,"material-icons"],[1,"ms-2",3,"reports"],["id","excel-import"],[1,"d-flex","flex-column","header"],["class","additional-info",4,"ngIf"],[1,"additional-info"]],template:function(i,a){i&1&&(o(0,"bkd-backlink",0)(1,"div",1)(2,"a",2)(3,"i",3),m(4,"add"),d()(),E(5,"bkd-reports-link",4),l(6,"async"),E(7,"div",5),d()(),o(8,"div",6)(9,"h1"),m(10),d(),f(11,gr,3,6,"div",7),d()),i&2&&(c("link",ht(6,mr)),s(5),c("reports",p(6,4,a.reports$)),s(5),x(a.getDesignation()),s(),c("ngIf",a.course.ParticipatingStudents))},dependencies:[ri,ae,Ut,B,V,w,P],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem;border-bottom:1px solid #dee2e6}h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"]});let t=n;return t})();var fr=(t,n,r,e,i,a)=>({course:t,tests:n,hasTests:r,testOptions:e,selectedTestId:i,selectedTest:a}),hr=t=>({"visible-on-mobile":t});function _r(t,n){if(t&1){let r=O();K(0),o(1,"bkd-select",7),_("valueChange",function(i){S(r);let a=u(3);return I(i&&a.testSelected(i))}),d(),E(2,"bkd-test-edit-grades",8),Y()}if(t&2){let r=u(2).bkdLet;s(),c("options",r.testOptions)("value",r.selectedTestId)("allowEmpty",!1),s(),c("selectedTest",r.selectedTest)}}function vr(t,n){if(t&1&&(o(0,"a",9),l(1,"async"),o(2,"i",10),m(3,"arrow_right_alt"),d(),o(4,"span",11),m(5),l(6,"translate"),d()()),t&2){let r=u(2).bkdLet,e=u();oe("href",p(1,3,e.buildLinkToRatingOverview()),ke),c("ngClass",M(7,hr,!r.hasTests||!r.selectedTest)),s(5),x(p(6,5,"tests.link-to-rating-overview"))}}function xr(t,n){if(t&1&&(K(0),E(1,"bkd-tests-header",5),f(2,_r,3,4,"ng-container",4)(3,vr,7,9,"a",6),l(4,"async"),Y()),t&2){let r=u().bkdLet,e=u(),i=q(9);s(),c("course",r.course),s(),c("ngIf",r.tests.length>0)("ngIfElse",i),s(),c("ngIf",p(4,4,e.state.canSetFinalGrade$))}}function br(t,n){if(t&1&&(K(0),f(1,xr,5,6,"ng-container",4),l(2,"async"),Y()),t&2){let r=u(),e=q(11);s(),c("ngIf",p(2,2,r.state.loading$)===!1)("ngIfElse",e)}}function Cr(t,n){t&1&&(o(0,"p",12),m(1),l(2,"translate"),d()),t&2&&(s(),x(p(2,1,"tests.no-tests")))}function yr(t,n){t&1&&E(0,"bkd-spinner")}var Ui=(()=>{let n=class n{constructor(e,i,a){this.settings=e,this.state=i,this.translate=a,this.selectTest$=new te,this.testOptions$=this.state.tests$.pipe(b(g=>[{Key:-1,Value:this.translate.instant("tests.grade")},...g.map(k=>({Key:k.Id,Value:k.Designation}))]),W()),this.selectedTestId$=Me(this.selectTest$,this.state.tests$.pipe(ee(1),b(g=>g[0]?.Id))).pipe(W()),this.selectedTest$=this.selectedTestId$.pipe(D(g=>this.state.tests$.pipe(b(k=>k.find(T=>T.Id===g)))),W())}testSelected(e){this.selectTest$.next(e)}buildLinkToRatingOverview(){return this.state.course$.pipe(ee(1),b(e=>this.settings.eventlist.evaluation.replace(":id",String(e.Id))))}};n.\u0275fac=function(i){return new(i||n)(v(he),v(J),v(X))},n.\u0275cmp=C({type:n,selectors:[["bkd-tests-list"]],standalone:!0,features:[y],decls:12,vars:20,consts:[["noTests",""],["loading",""],[1,"bkd-container"],[4,"bkdLet"],[4,"ngIf","ngIfElse"],[3,"course"],["class","rating-overview d-flex justify-content-end pe-3 border-top pt-3",3,"ngClass","href",4,"ngIf"],[1,"tests-dropdown",3,"valueChange","options","value","allowEmpty"],[3,"selectedTest"],[1,"rating-overview","d-flex","justify-content-end","pe-3","border-top","pt-3",3,"ngClass","href"],[1,"material-icons","fw-bold"],[1,"ps-1"],[1,"mt-3","px-3"]],template:function(i,a){i&1&&(o(0,"div",2),f(1,br,3,4,"ng-container",3),l(2,"async"),l(3,"async"),l(4,"async"),l(5,"async"),l(6,"async"),l(7,"async"),f(8,Cr,3,3,"ng-template",null,0,re)(10,yr,1,0,"ng-template",null,1,re),d()),i&2&&(s(),c("bkdLet",xt(13,fr,p(2,1,a.state.course$),p(3,3,a.state.tests$),p(4,5,a.state.hasTests$),p(5,7,a.testOptions$),p(6,9,a.selectedTestId$),p(7,11,a.selectedTest$))))},dependencies:[Z,B,Hi,ye,Ni,le,Ce,V,w,P],styles:[".tests-dropdown[_ngcontent-%COMP%]{display:block;padding:1rem 0}@media (min-width: 576px){.tests-dropdown[_ngcontent-%COMP%]{display:none}}a.rating-overview[_ngcontent-%COMP%]{text-decoration:none}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}@media (max-width: 575.98px){a.rating-overview[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]});let t=n;return t})();var Qe=(()=>{let n=class n{constructor(e,i){this.state=e,this.route=i,this.courseId$=this.route.paramMap.pipe(b(a=>Number(a.get("id"))),W()),this.destroy$=new te}ngOnInit(){this.courseId$.pipe(ce(this.destroy$)).subscribe(e=>this.state.setCourseId(e))}ngOnDestroy(){this.destroy$.next()}};n.\u0275fac=function(i){return new(i||n)(v(J),v(fe))},n.\u0275cmp=C({type:n,selectors:[["bkd-tests"]],standalone:!0,features:[de([J]),y],decls:1,vars:0,template:function(i,a){i&1&&E(0,"router-outlet")},dependencies:[$e]});let t=n;return t})();var Xo=[{path:"",component:_i,children:[{path:"",component:hi},{path:"current",component:fi},{path:":id",component:Qe,children:[{path:"tests",component:Ui}]},{path:":id/tests/:testId/edit",component:Qe,children:[{path:"",component:Oi}]},{path:":id/tests/add",component:Qe,children:[{path:"",component:Mi}]},{path:":id/tests",children:[ai]}]}];export{Xo as EVENTS_ROUTES};
