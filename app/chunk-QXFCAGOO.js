import{a as Fe,b as Re}from"./chunk-OLKZTOFS.js";import{a as Ne}from"./chunk-ULG2PTMU.js";import{a as V}from"./chunk-D5RVOUSN.js";import{c as Pe,d as $e,e as Te}from"./chunk-6O7JHME5.js";import{A as Oe,B as C,C as q,D as Le,F as Ie,G as De,H as Be,a as fe,f as _e,t as xe,u as ke,v as Ae}from"./chunk-CC2ZY7RA.js";import"./chunk-I6B7SZW4.js";import"./chunk-JQMOLUIY.js";import{a as Ee}from"./chunk-42VZKNAZ.js";import"./chunk-Y4QYVF5K.js";import"./chunk-QENSBOG3.js";import"./chunk-QGDSASTQ.js";import"./chunk-2QS7YZBA.js";import"./chunk-7PYQWJKW.js";import"./chunk-YHCR7GAG.js";import{d as Me}from"./chunk-FVPRCQLC.js";import{i as we}from"./chunk-YNODG5RP.js";import"./chunk-SNNR7FJ6.js";import"./chunk-EFJ6WEH7.js";import"./chunk-HVLHLZKP.js";import{e as ve,f as Se}from"./chunk-DQAQYQ7K.js";import"./chunk-LYDHS67M.js";import{q as ue,r as ge,s as be,t as he}from"./chunk-ZXUJZ6KS.js";import{Ae as ye,Cc as l,Dc as d,Ec as L,G as X,Gb as U,H as Z,Hb as te,Ib as K,Kb as ne,Lb as W,Mb as Y,Nb as h,Ob as a,Pb as c,Q as v,Qb as S,Ub as M,Wb as E,Xb as f,_ as I,ba as D,da as j,db as o,ec as ie,fd as de,gc as se,ic as g,id as R,j as A,ja as ee,jc as x,jd as me,k as J,kc as T,lc as re,o as Q,oa as p,ob as $,oc as oe,pc as ce,qc as ae,rc as F,sc as H,tc as B,ua as O,v as m,va as P,w as _,wc as le,xc as w,yc as N,zc as pe,ze as Ce}from"./chunk-GP622B77.js";var Ve=["name","date"],He=["studentFullName","studyClassNumber"],k=(()=>{let n=class n{constructor(){this.translate=p(Ce),this.lessonPresencesService=p(Te),this.selectionService=p(C),this.sortService=p(Be),this.loadingService=p(Ee),this.loading$=this.loadingService.loading$,this.search$=new J(""),this.updateUnconfirmedAbsences$=new A,this.unconfirmedAbsences$=X(this.loadUnconfirmedAbsences(),this.updateUnconfirmedAbsences$).pipe(I(1)),this.entries$=this.unconfirmedAbsences$.pipe(m(xe),I(1)),this.sortCriteria=this.sortService.sortCriteria,this.sortedEntries$=_([this.entries$,this.sortService.sortCriteria$]).pipe(m(q(ke))),this.filteredEntries$=_([this.sortedEntries$,this.search$]).pipe(m(([e,t])=>Fe(e,He,t)),I(1)),this.currentDetail=null,this.sortService.sortCriteria.set({primarySortKey:"date",ascending:!1})}getUnconfirmedAbsences(e,t){return this.entries$.pipe(m(s=>{let u=s.find(y=>y.dateString===e&&y.studentId===t);return u?u.absences:[]}))}getAllUnconfirmedAbsencesForStudent(e){return this.entries$.pipe(m(t=>t.filter(s=>s.studentId===e).reduce((s,u)=>s.concat(u.absences),[])))}get confirmBackLink(){return this.currentDetail?["/open-absences/detail",this.currentDetail.personId,this.currentDetail.date]:["/open-absences"]}updateAfterConfirm(){_([this.unconfirmedAbsences$.pipe(v(1)),this.selectionService.selectedIds$.pipe(v(1))]).pipe(m(q(Ae))).subscribe(e=>{this.selectionService.clear(),this.updateUnconfirmedAbsences$.next(e)})}buildMailToString(e,t){let s=e.Email,u=this.translate.instant("open-absences.detail.mail.subject"),y=t.map(Ye=>Oe(Ye)).join("%0D%0A"),b=`${this.translate.instant("open-absences.detail.mail.body")}%0D%0A${y}`;return b.length>=1600&&(b=`${b.substring(0,1500)}%0D%0A${this.translate.instant("open-absences.detail.mail.bodyToLargeForEmailTo")}`),`${s}?subject=${u}&body=${b}`}loadUnconfirmedAbsences(){return this.loadingService.load(this.lessonPresencesService.getListOfUnconfirmed())}};n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=ee({token:n,factory:n.\u0275fac});let i=n;return i})();var qe=()=>["/open-absences"],je=(()=>{let n=class n{constructor(){this.router=p(be),this.route=p(ue),this.openAbsencesService=p(k),this.presenceTypesService=p(_e),this.personService=p(Me),this.selectionService=p(C),this.scrollPosition=p(V),this.absences$=this.route.paramMap.pipe(D(this.getAbsencesForParams.bind(this))),this.hasAbsences$=this.absences$.pipe(m(ve(1))),this.studentFullName$=this.absences$.pipe(m(e=>e[0]&&e[0].StudentFullName||null)),this.allSelected$=_([this.absences$,this.selectionService.selection$]).pipe(m(([e,t])=>e.length===t.length)),this.studentEmail$=this.absences$.pipe(m(e=>e[0]&&e[0].StudentRef.Id||null),D(e=>e?this.personService.getByIdWithEmailInfos(e):Q)),this.allUnconfirmedAbsencesForStudent$=this.route.paramMap.pipe(D(this.getAbsencesForStudentParam.bind(this))),this.mailTo$=_([this.studentEmail$,this.allUnconfirmedAbsencesForStudent$]).pipe(m(([e,t])=>this.openAbsencesService.buildMailToString(e,t))),this.destroy$=new A}ngOnInit(){this.selectionService.clearNonLessonPresences(),this.route.paramMap.pipe(j(this.destroy$)).subscribe(e=>this.openAbsencesService.currentDetail={date:String(e.get("date")),personId:Number(e.get("personId"))}),this.hasAbsences$.pipe(j(this.destroy$),Z(fe(Se))).subscribe(()=>void this.router.navigate(["/open-absences"]))}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}toggleAll(e){e?this.absences$.pipe(v(1)).subscribe(t=>this.selectionService.clear(t)):this.selectionService.clear()}onRowClick(e,t){e.target!==t&&t.click()}getPresenceTypeDesignation(e){return this.presenceTypesService.displayedTypes$.pipe(m(t=>e.TypeRef.Id&&t.find(s=>s.Id===e.TypeRef.Id)?.Designation||null))}getAbsencesForParams(e){return this.openAbsencesService.getUnconfirmedAbsences(String(e.get("date")),Number(e.get("personId")))}getAbsencesForStudentParam(e){return this.openAbsencesService.getAllUnconfirmedAbsencesForStudent(Number(e.get("personId")))}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=$({type:n,selectors:[["bkd-open-absences-detail"]],decls:6,vars:10,consts:[[3,"link"],[3,"absences$","selectionService","confirmLink","displayEmail","mailTo$"]],template:function(t,s){t&1&&(a(0,"div"),S(1,"bkd-backlink",0),a(2,"h1"),g(3),l(4,"async"),c()(),S(5,"bkd-student-dossier-absences",1)),t&2&&(o(),h("link",w(9,qe)),o(2),x(d(4,7,s.studentFullName$)),o(2),h("absences$",s.absences$)("selectionService",s.selectionService)("confirmLink","/open-absences/confirm")("displayEmail",!0)("mailTo$",s.mailTo$))},dependencies:[De,Ie,R],styles:['.content[_ngcontent-%COMP%]{padding-left:1rem;padding-right:1rem}.back[_ngcontent-%COMP%]{color:#000;text-decoration:none}.back[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]:active   span[_ngcontent-%COMP%]{text-decoration:underline}.absence-entry[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox lesson-class time teacher" "checkbox presence-type date days-ago";grid-template-columns:min-content 2fr 1fr 2fr}.checkbox[_ngcontent-%COMP%]{grid-area:checkbox;margin:0;padding:.6rem .5rem 0 0}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.all[_ngcontent-%COMP%]{grid-area:all}.lesson-class[_ngcontent-%COMP%]{grid-area:lesson-class;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.time[_ngcontent-%COMP%]{grid-area:time}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.presence-type[_ngcontent-%COMP%]{color:#adb5bd;grid-area:presence-type}.date[_ngcontent-%COMP%]{grid-area:date}.days-ago[_ngcontent-%COMP%]{color:#adb5bd;grid-area:days-ago}.date-days-ago[_ngcontent-%COMP%]{grid-area:date-days-ago;display:none}@media (max-width: 750px){.content[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.absence-entry[_ngcontent-%COMP%]{grid-template-areas:"checkbox lesson-class" "checkbox teacher" "checkbox date-days-ago" "checkbox time" "checkbox presence-type";grid-template-columns:min-content 1fr}.date-days-ago[_ngcontent-%COMP%]{display:block}.date[_ngcontent-%COMP%], .days-ago[_ngcontent-%COMP%]{display:none}}'],changeDetection:0});let i=n;return i})();var Ue=()=>[],G=i=>({count:i}),ze=(i,n)=>["detail",i,n],Ge=(i,n)=>n.id;function Je(i,n){if(i&1&&(a(0,"div",2)(1,"div",5),g(2),l(3,"translate"),c(),a(4,"a",6)(5,"i",7),g(6,"edit"),c()()()),i&2){f();let r=B(0);o(2),T(" ",L(3,3,"open-absences.selected",N(6,G,r.length))," "),o(2),se("disabled",r.length===0)}}function Qe(i,n){i&1&&S(0,"bkd-spinner")}function Xe(i,n){i&1&&(a(0,"p",3),g(1),l(2,"translate"),c()),i&2&&(o(),x(d(2,1,"open-absences.noEntries")))}function Ze(i,n){if(i&1){let r=M();a(0,"bkd-sortable-header",12),l(1,"translate"),ae("sortCriteriaChange",function(t){O(r);let s=f(2);return ce(s.openAbsencesService.sortCriteria,t)||(s.openAbsencesService.sortCriteria=t),P(t)}),c()}if(i&2){let r=n.$implicit,e=f(2);h("ngClass",r)("label",d(1,4,"open-absences.list.header."+r))("sortKey",r),oe("sortCriteria",e.openAbsencesService.sortCriteria)}}function et(i,n){if(i&1){let r=M();a(0,"div")(1,"div",13)(2,"div",14),E("click",function(t){O(r);let s=ie(4),u=f(2);return P(u.onCheckboxCellClick(t,s))}),a(3,"input",10,0),l(5,"async"),E("change",function(){let t=O(r).$implicit,s=f(2);return P(s.selectionService.toggle(t))}),c()(),a(6,"div",15)(7,"a",16),g(8),c()(),a(9,"div",17),g(10),c(),a(11,"div",18),g(12),l(13,"translate"),c(),a(14,"div",19),g(15),l(16,"translate"),c(),a(17,"div",20),g(18),l(19,"bkdDaysDifference"),c(),a(20,"div",21),g(21),l(22,"date"),c()()()}if(i&2){let r=n.$implicit,e=f(2);o(3),h("checked",d(5,9,e.selectionService.isSelected$(r))),o(4),h("routerLink",pe(22,ze,r.studentId,r.dateString)),o(),x(r.studentFullName),o(2),T(" ",r.studyClassNumber," "),o(2),T(" ",L(13,11,e.getLessonsCountKey(r),N(25,G,r.lessonsCount))," "),o(3),re(" ",r.studyClassNumber,", ",L(16,14,e.getLessonsCountKey(r),N(27,G,r.lessonsCount))," "),o(3),T(" ",d(19,17,r.date)," "),o(3),x(L(22,19,r.date,"dd.MM.yyyy"))}}function tt(i,n){if(i&1){let r=M();a(0,"div",4)(1,"div",8)(2,"div",9)(3,"input",10),E("change",function(t){O(r);let s=f();return P(s.onToggleAll(t.currentTarget==null?null:t.currentTarget.checked))}),c()(),W(4,Ze,2,6,"bkd-sortable-header",11,ne),c(),W(6,et,23,29,"div",null,Ge),c()}if(i&2){let r=f(),e=B(0),t=B(2);o(3),h("checked",e.length===t.length),o(),Y(r.sortKeys),o(2),Y(t)}}var Ke=(()=>{let n=class n{constructor(){this.openAbsencesService=p(k),this.selectionService=p(C),this.scrollPosition=p(V),this.sortKeys=Ve,this.destroy$=new A}ngOnInit(){this.openAbsencesService.currentDetail=null,this.selectionService.clearNonOpenAbsencesEntries()}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}onToggleAll(e){this.openAbsencesService.filteredEntries$.pipe(v(1)).subscribe(t=>{this.selectionService.clear(e?t:null)})}onCheckboxCellClick(e,t){e.target!==t&&t.click()}getLessonsCountKey(e){return`open-absences.list.content.lessonsCount.${e.lessonsCount===1?"singular":"plural"}`}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=$({type:n,selectors:[["bkd-open-absences-list"]],decls:20,vars:26,consts:[["checkbox",""],[1,"d-flex","header-search",3,"valueChange","value","placeholder","label"],[1,"d-flex","align-items-center","justify-content-between","mt-1"],[1,"mt-3"],[1,"content"],[1,"selection-count","ps-1"],["routerLink","/open-absences/confirm",1,"edit","btn","btn-primary","btn-edit","mt-1","mb-2"],[1,"material-icons"],[1,"absence-header"],[1,"checkbox"],["type","checkbox",1,"form-check-input",3,"change","checked"],[3,"ngClass","label","sortKey","sortCriteria"],[3,"sortCriteriaChange","ngClass","label","sortKey","sortCriteria"],[1,"absence-entry"],[1,"checkbox",3,"click"],[1,"name","pe-2"],[3,"routerLink"],[1,"study-class"],[1,"lessons-count"],[1,"study-class-lessons-count"],[1,"days-ago"],[1,"date"]],template:function(t,s){if(t&1){let u=M();F(0),l(1,"async"),F(2),l(3,"async"),F(4),l(5,"async"),a(6,"h1"),g(7),l(8,"translate"),c(),a(9,"div")(10,"div")(11,"bkd-resettable-input",1),l(12,"async"),l(13,"translate"),l(14,"translate"),E("valueChange",function(b){return O(u),P(s.openAbsencesService.search$.next(b))}),c(),U(15,Je,7,8,"div",2),c(),U(16,Qe,1,0,"bkd-spinner"),l(17,"async"),te(18,Xe,3,3,"p",3)(19,tt,8,1,"div",4),c()}if(t&2){let u;H(d(1,6,s.selectionService.selection$)??w(24,Ue)),o(2);let y=H(d(3,9,s.openAbsencesService.filteredEntries$)??w(25,Ue)),b=(((u=d(5,12,s.openAbsencesService.sortedEntries$))==null?null:u.length)??0)===0||y.length===0;o(5),x(d(8,14,"open-absences.title")),o(4),h("value",d(12,16,s.openAbsencesService.search$))("placeholder",d(13,18,"open-absences.search-by-name-or-class"))("label",d(14,20,"open-absences.search")),o(4),K(b?-1:15),o(),K(d(17,22,s.openAbsencesService.loading$)?16:b?18:19)}},dependencies:[Re,he,we,R,me,ye,Le,Ne,de],styles:['.header-search[_ngcontent-%COMP%]{max-width:500px}.absence-header[_ngcontent-%COMP%]{cursor:pointer;padding:1rem;display:grid;grid-template-areas:"checkbox name date";grid-template-columns:min-content 5fr 1fr;border-top:1px solid #dee2e6;border-bottom:2px solid #dee2e6;align-items:center}.absence-entry[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox name study-class lessons-count days-ago date";grid-template-columns:min-content 2fr 1fr 1fr 1fr 1fr;align-items:center}.checkbox[_ngcontent-%COMP%]{align-self:start;grid-area:checkbox;margin:0;padding:.3rem 1rem 0 0}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.name[_ngcontent-%COMP%]{grid-area:name;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.lessons-count[_ngcontent-%COMP%]{grid-area:lessons-count}.study-class[_ngcontent-%COMP%]{grid-area:study-class}.study-class-lessons-count[_ngcontent-%COMP%]{grid-area:study-class-lessons-count;display:none}.days-ago[_ngcontent-%COMP%]{color:#6c757d;grid-area:days-ago}.date[_ngcontent-%COMP%]{grid-area:date}@media (max-width: 750px){.content[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.absence-header[_ngcontent-%COMP%]{grid-template-areas:"checkbox name date";grid-template-columns:min-content 3fr 2fr}.absence-entry[_ngcontent-%COMP%]{grid-template-areas:"checkbox name date" "checkbox study-class-lessons-count days-ago";grid-template-columns:min-content 3fr 2fr}.study-class-lessons-count[_ngcontent-%COMP%]{display:block}.study-class[_ngcontent-%COMP%], .lessons-count[_ngcontent-%COMP%]{display:none}.days-ago[_ngcontent-%COMP%], .study-class-lessons-count[_ngcontent-%COMP%]{font-size:.875rem;color:#adb5bd}}'],changeDetection:0});let i=n;return i})();var We=(()=>{let n=class n{constructor(){}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=$({type:n,selectors:[["bkd-open-absences"]],features:[le([k,C,{provide:Pe,useExisting:k}])],decls:1,vars:0,template:function(t,s){t&1&&S(0,"router-outlet")},dependencies:[ge],encapsulation:2,changeDetection:0});let i=n;return i})();var rn=[{path:"",component:We,children:[{path:"",component:Ke,data:{restoreScrollPositionFrom:["/open-absences/detail/:personId/:date","/open-absences/confirm"]}},{path:"detail/:personId/:date",component:je,data:{restoreScrollPositionFrom:["/open-absences/confirm"]}},{path:"confirm",component:$e}]}];export{rn as OPEN_ABSENCES_ROUTES};
