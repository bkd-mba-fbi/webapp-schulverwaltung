import{a as _t}from"./chunk-Y4QYVF5K.js";import{a as Tt}from"./chunk-OFB4XAK2.js";import{b as Gt,c as Pt,d as Dt}from"./chunk-WACRWBCS.js";import{b as wt}from"./chunk-YD3RJIHU.js";import{a as oe}from"./chunk-KK2SHN2W.js";import{A as Te,a as It,b as St,c as bt,d as vt,e as Ct,p as xt,q as yt,u as ye}from"./chunk-AP373D4K.js";import{$b as rt,$c as at,Ab as $,Bb as Ye,Cb as Se,Cc as c,D as Ee,Dc as s,Ec as M,Fd as ae,Gb as m,Gd as q,H as Xe,Ha as T,Hb as I,Hc as G,Ib as W,Ic as v,Id as xe,Jb as Ze,Jc as be,Jd as F,K as Je,Kd as j,Lc as Oe,M as $e,Ma as P,Mb as et,Na as Re,P as y,Pc as a,R as Me,Ra as _,Ua as ee,Ub as tt,Uc as se,Va as te,Wa as p,Wc as st,X as O,Xa as l,Xb as it,Ya as ie,Yc as K,Zb as N,_ as C,_b as nt,a as V,aa as D,ab as ne,b as H,bd as Fe,c as We,cb as k,cd as ve,da as Q,db as S,f as fe,fd as ot,g as B,gb as Ie,gc as re,gd as dt,h as le,ha as L,ia as Y,id as lt,ja as Z,kd as pt,l as De,m as Ke,mb as ce,n as f,nb as u,nd as ct,o as pe,ob as R,od as ut,pb as b,pd as mt,qa as Qe,qd as gt,rd as ft,s as he,ud as Ce,vd as ht,w as qe,wa as o,wb as ue,x as ze,xa as E,xb as me,yb as U}from"./chunk-IFJN5CDK.js";var ai=(t,r)=>r.Key,oi=t=>({width:t});function di(t,r){if(t&1&&(p(0,"option",1),u(1),m(2,"translate"),l()),t&2){let e=S();P("ngValue",null),o(),b(" ",I(2,2,e.emptyLabel)," ")}}function li(t,r){if(t&1&&(p(0,"option",1),u(1),l()),t&2){let e=r.$implicit;P("ngValue",e),o(),b(" ",e.Value," ")}}var Et=(()=>{class t{constructor(){this.options=[],this.allowEmpty=!0,this.emptyLabel="",this.value=null,this.disabled=!1,this.tabindex=0,this.width="auto",this.valueChange=new Qe,this.options$=new B([]),this.rawValue$=new B(null),this.value$=pe([this.rawValue$,this.options$]).pipe(f(([e,i])=>i&&i.find(n=>n.Key===e)||null))}ngOnChanges(e){e.value&&this.rawValue$.next(e.value.currentValue),e.options&&this.options$.next(e.options.currentValue)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=D({type:t,selectors:[["bkd-select"]],inputs:{options:"options",allowEmpty:"allowEmpty",emptyLabel:"emptyLabel",value:"value",disabled:"disabled",tabindex:"tabindex",width:"width"},outputs:{valueChange:"valueChange"},standalone:!0,features:[L,$],decls:6,vars:9,consts:[[1,"form-select",3,"ngModelChange","tabindex","ngStyle","disabled","ngModel"],[3,"ngValue"]],template:function(i,n){i&1&&(p(0,"select",0),m(1,"async"),k("ngModelChange",function(x){return n.valueChange.emit(x&&x.Key)}),T(2,di,3,4,"option",1),ee(3,li,2,2,"option",1,ai),u(5,` >
`),l()),i&2&&(Ie("tabindex",n.tabindex),P("ngStyle",Se(7,oi,n.width))("disabled",n.disabled)("ngModel",I(1,5,n.value$)),o(2),_(n.allowEmpty?2:-1),o(),te(n.options))},dependencies:[Ce,ut,mt,ct,ve,dt,N,it,j,F],changeDetection:0})}}return t})();var $t=v({Id:s,Designation:c,StudentCount:s,Number:c});var je=v({Id:c,TestId:s,CourseRegistrationId:s,GradeId:a(s),GradeValue:a(s),GradeDesignation:a(c),Points:a(s),StudentId:s});var Mt=v({Id:s,CourseId:s,Date:se,Designation:c,Weight:s,WeightPercent:s,IsPointGrading:M,MaxPoints:a(s),MaxPointsAdjusted:a(s),IsPublished:M,IsOwner:M,Owner:a(c),GradingScaleId:a(s),Results:a(G(je))});var Rt=v({Id:s}),Ot=be({HRef:a(c)}),pi=be({HasEvaluationStarted:M,EvaluationUntil:a(se),HasReviewOfEvaluationStarted:M,HasTestGrading:M,Id:s}),ci=Oe([Rt,Ot,pi]),ui=be({Id:s,StudentCount:s}),mi=Oe([Rt,Ot,ui]),gi=v({Grade:c,AverageTestResult:s,Id:s,StudentId:s}),Ae=v({AverageTestResult:s,CanGrade:M,EventId:s,GradeId:a(s),GradeValue:a(s),Id:s,StudentId:s}),de=v({HRef:c,Id:s,Number:c,Designation:c,DateFrom:a(se),DateTo:a(se),StatusId:s,GradingScaleId:a(s),FinalGrades:a(G(gi)),Gradings:a(G(Ae)),Tests:a(G(Mt)),EvaluationStatusRef:ci,AttendanceRef:mi,ParticipatingStudents:a(G(Pt)),Classes:a(G($t))}),Ft=v({TestResults:G(je),Gradings:G(Ae)}),jt=v({Gradings:G(Ae)});var _e=(()=>{class t extends oe{constructor(e,i){super(e,i,de,"Courses"),this.statusCodec=v(st(this.codec.props,["Id","StatusId","EvaluationStatusRef"]))}getNumberOfCoursesForRating(){return this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef&fields=Id,StatusId,EvaluationStatusRef&filter.StatusId=;10300;10240`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe(y(q(this.statusCodec)),f(e=>e.filter(i=>i.EvaluationStatusRef.HasEvaluationStarted===!0)),f(e=>e.length))}getExpandedCourses(e){return _t(e,"TeacherRole")?this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef,AttendanceRef,Classes,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe(y(q(de))):De([])}getExpandedCourse(e){return this.http.get(`${this.baseUrl}/${e}?expand=ParticipatingStudents,EvaluationStatusRef,Tests,Gradings,FinalGrades,Classes`).pipe(y(ae(de)))}getExpandedCoursesForDossier(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades,EvaluationStatusRef,ParticipatingStudents,Classes&filter.StatusId=;${this.settings.eventlist.statusfilter}`).pipe(y(q(de)))}getExpandedCoursesForStudent(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"StudentRole"}}).pipe(y(q(de)))}add(e,i,n,d,x,A,g){let h={Tests:[{Date:i,Designation:n,Weight:d,IsPointGrading:x,MaxPoints:A,MaxPointsAdjusted:g}]};return this.http.put(`${this.baseUrl}/${e}/Tests/New`,h).pipe(f(()=>{}))}update(e,i,n,d,x,A,g,h){let J={Tests:[{Id:i,Designation:n,Date:d,Weight:x,IsPointGrading:A,MaxPoints:g,MaxPointsAdjusted:h}]};return this.http.put(`${this.baseUrl}/${e}/Tests/Update`,J).pipe(f(()=>{}))}delete(e,i){let n={TestIds:[i]};return this.http.put(`${this.baseUrl}/${e}/Tests/Delete`,n).pipe(f(()=>i))}updateTestResult(e,i){let h=i,{studentId:n,testId:d}=h,x=We(h,["studentId","testId"]),A={StudentIds:[n],TestId:d},g="gradeId"in x?H(V({},A),{GradeId:x.gradeId}):H(V({},A),{Points:x.points});return this.http.put(`${this.baseUrl}/${e}/SetTestResult`,g).pipe(y(ae(Ft)),y(({TestResults:J,Gradings:Ue})=>J.length<=1&&Ue.length===1?De({courseId:e,testResult:J[0]??null,grading:Ue[0]}):Ke(()=>new Error("`TestResults` or `Gradings` does not contain a single value"))))}setAverageAsFinalGrade(e){return this.http.put(`${this.baseUrl}/SetAverageTestResult`,e).pipe(y(ae(jt)))}publishTest(e){let i={TestIds:[e]};return this.http.put(`${this.baseUrl}/PublishTest`,i).pipe(f(()=>e))}unpublishTest(e){let i={TestIds:[e]};return this.http.put(`${this.baseUrl}/UnpublishTest`,i).pipe(f(()=>e))}static{this.\u0275fac=function(i){return new(i||t)(C(re),C(K))}}static{this.\u0275prov=O({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function kt(t){return t.length===0?0:Be(t.map(({value:r,weight:e})=>r*e))/Be(t.map(({weight:r})=>r))}function ke(t){return t.length===0?0:Number(Be(t)/t.length)}function Be(t){return t.reduce(fi,0)}function fi(t,r){return t+r}function Tn(t,r,e){return t?t.Tests?.reduce((i,n)=>i||n.Id===r&&n.Results?.find(d=>d.TestId===r&&d.StudentId===e)||null,null)??null:null}function _n(t,r,e){return r.map(i=>i.Id===t.TestId?Ve(t,i,e):i)}function Gn(t,r,e){return e.map(i=>i.Id===t?hi(r,i):i)}function Pn(t,r){return r.map(e=>e.Id===t?H(V({},e),{IsPublished:!e.IsPublished}):e)}function wn(t){let r=Si(t);if(r.length===0)throw new Error("unable to calculate averages without results");return ke(r)}function Ne(t){return t.MaxPointsAdjusted||t.MaxPoints}function Dn(t){let r=Ii(t);if(r.length===0)throw new Error("unable to calculate averages without results");return ke(r)}function X(t,r){return r.Results?.find(e=>e.StudentId===t)}function En(t,r){return r===null?null:r.filter(e=>e.Id!==t)}function Ve(t,r,e){let i=e&&r.Results?.find(d=>d.TestId===t.TestId&&d.StudentId===t.StudentId),n=r.Results?.filter(d=>!(d.TestId===t.TestId&&d.StudentId===t.StudentId))||[];return i&&e==="grade"?t.GradeId=i.GradeId:i&&e==="points"&&(t.Points=i.Points),H(V({},r),{Results:[...n,t]})}function Vt(t){return t.slice().sort((r,e)=>e.Date.getTime()-r.Date.getTime())}function Ge(t,r){return r?.find(e=>e.Id===t.GradingScaleId)||null}function hi(t,r){return H(V({},r),{Results:r.Results?.filter(e=>e.StudentId!==t)||[]})}function Ii(t){return t.Results?.filter(r=>r.GradeDesignation!==null).map(r=>Number(r.GradeDesignation)).filter(r=>!isNaN(r))||[]}function Si(t){return t.Results?.map(r=>r.Points!==null?r.Points:Nt).filter(r=>r>Nt)||[]}var Nt=-1;var He=v({Id:c,SubscriptionId:s,VssId:s,EventId:s,DropdownItems:a(G(Tt)),IdPerson:s,ShowAsRadioButtons:M,Value:a(c)}),Ht=v({Id:s,CurrentWorkProgressId:a(c||a(s)),EventId:a(s),PersonId:a(s),Status:c,StatusId:a(s),IsOkay:a(M),IsQueued:a(M),EventDesignation:a(c),EventInformation:a(c||s),EventNotes:a(c||s),CheckPersonalInformation:a(M),CorrespondencePersonId:a(s),CorrespondenceAddressTypeId:a(c||s),Billing1PersonId:a(s),Billing1AddressTypeId:a(c||s),Billing2PersonId:a(c||s),Billing2AddressTypeId:a(c||s),KindOfPaymentId1:a(c||s),KindOfPaymentEmail1:a(c||s),KindOfPaymentId2:a(c||s),KindOfPaymentEmail2:a(c||s),IdObject:a(s),IdSubscription:a(s),IdStatus:a(s),AnsweredQuestions:a(c||s),Messages:a(c||s),SubscriptionDetails:a(G(He)),HRef:a(c)});var Lt=(()=>{class t extends oe{constructor(e,i){super(e,i,He,"Subscriptions")}getIdSubscriptionsByStudentAndCourse(e,i){return this.http.get(`${this.settings.apiUrl}/Subscriptions/?filter.PersonId==${e}&filter.EventId=;${i}`).pipe(y(q(Ht)))}static{this.\u0275fac=function(i){return new(i||t)(C(re),C(K))}}static{this.\u0275prov=O({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var vi=v({Id:s,Designation:c}),Le=v({Id:s,Grades:G(vi)});var Ut=(()=>{class t extends oe{constructor(e,i){super(e,i,Le,"GradingScales")}getGradingScale(e){return this.http.get(`${this.baseUrl}/${e}`).pipe(y(ae(Le)))}getGradingScales(e){return he(e.map(this.getGradingScale.bind(this)))}static{this.\u0275fac=function(i){return new(i||t)(C(re),C(K))}}static{this.\u0275prov=O({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Pe=(()=>{class t{constructor(e,i,n,d,x,A){this.coursesRestService=e,this.subscriptionRestService=i,this.reportsService=n,this.loadingService=d,this.gradingScalesRestService=x,this.settings=A,this.studentId$=new le(1),this.initialStudentCourses$=this.studentId$.pipe(Xe(),y(this.loadCourses.bind(this)),f(g=>g.sort((h,J)=>h.Designation.localeCompare(J.Designation))),$e(1)),this.action$=new le(1),this.studentCourses$=qe(this.action$,this.initialStudentCourses$.pipe(f(g=>({type:"initializeCourses",payload:g})))).pipe(Je(this.coursesReducer.bind(this),[]),$e(1)),this.loading$=this.loadingService.loading$,this.studentCourseIds$=this.studentCourses$.pipe(f(g=>g.flatMap(h=>h.Id))),this.idSubscriptions$=pe([this.studentId$,this.studentCourseIds$]).pipe(y(([g,h])=>this.subscriptionRestService.getIdSubscriptionsByStudentAndCourse(g,h))),this.ids$=this.idSubscriptions$.pipe(f(g=>g.map(h=>h.Id))),this.testReports$=this.ids$.pipe(f(g=>this.reportsService.getTeacherSubscriptionReports(g))),this.tests$=this.studentCourses$.pipe(f(g=>g.flatMap(h=>h.Tests).filter(ye))),this.gradingScaleIdsFromTests$=this.tests$.pipe(f(g=>[...g.map(h=>h.GradingScaleId)].filter(ye).filter(Te))),this.gradingScaleIdsFromCourses$=this.studentCourses$.pipe(f(g=>g.flatMap(h=>h.GradingScaleId).filter(ye).filter(Te))),this.gradingScaleIds$=pe([this.gradingScaleIdsFromCourses$,this.gradingScaleIdsFromTests$]).pipe(f(([g,h])=>g.concat(h).filter(Te))),this.gradingScales$=this.gradingScaleIds$.pipe(y(g=>he(g.map(h=>this.gradingScalesRestService.getGradingScale(h)))))}setStudentId(e){this.studentId$.next(e)}getFinalGradeForStudent(e,i){return e?.FinalGrades?.find(n=>n.StudentId===i)}getGradingForStudent(e,i){return e?.Gradings?.find(n=>n.StudentId===i)}getGradingScaleOfCourse(e,i){return i?.find(n=>n.Id===e.GradingScaleId)}getGradesForStudent(e,i,n){return e.Tests?.flatMap(d=>({value:Number(Ge(d,n)?.Grades.find(A=>A.Id===X(i,d)?.GradeId)?.Designation),weight:d.Weight})).filter(({value:d})=>!!d)||[]}updateStudentCourses(e){this.action$.next({type:"updateCourses",payload:e})}loadCourses(e){return this.loadingService.load(this.coursesRestService.getExpandedCoursesForDossier().pipe(f(i=>i.filter(n=>n.ParticipatingStudents?.find(d=>d.Id===e)))))}coursesReducer(e,i){switch(i.type){case"initializeCourses":return i.payload;case"updateCourses":return this.updateCourses([...e],i.payload);default:return e}}updateCourses(e,i){return e.map(n=>H(V({},n),{Tests:n.Tests!==null?n.Tests.map(d=>d.Id===i.Id?i:d):null}))}static{this.\u0275fac=function(i){return new(i||t)(C(_e),C(Lt),C(Dt),C(wt),C(Ut),C(K))}}static{this.\u0275prov=O({token:t,factory:t.\u0275fac})}}return t})();var Kt=(()=>{class t{constructor(){}get inIframe(){return window.parent!==window}get window(){return this.inIframe?window.parent:null}get document(){return this.window?.document.documentElement??null}querySelector(e){return this.window?.document?.querySelector("bkd-portal")?.shadowRoot?.querySelector(e)??null}getIframeElement(){return this.querySelector("bkd-content")?.shadowRoot?.querySelector("iframe")??null}getIframeTop(){return this.getIframeElement()?.offsetTop??0}getIFrameBottom(){let e=this.getIframeElement();return e?e.offsetTop+e.offsetHeight:0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=O({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var qt=(()=>{class t{constructor(e,i){this.modal=e,this.portal=i}open(...e){let i=this.modal.open(...e);return this.applyPortalOffsetAndMaxHeight(i),this.disablePortalScrolling(i),i}get activeInstances(){return this.modal.activeInstances}dismissAll(...e){return this.modal.dismissAll(...e)}hasOpenModals(...e){return this.modal.hasOpenModals(...e)}applyPortalOffsetAndMaxHeight(e){let i=this.getModalWindowElement(e);if(!i){console.warn("Trying to apply portal offset to <ngb-modal-window>, but element is not present!");return}this.portal.window&&(i.style.top=`${this.getModalIframeOffset()}px`,i.style.maxHeight=`${this.getModalHeight()}px`)}disablePortalScrolling(e){if(this.portal.window&&this.portal.document){let i=this.portal.window.innerWidth-this.portal.document.clientWidth;this.portal.document.style.paddingRight=`${i}px`,this.portal.document.style.overflow="hidden"}e.hidden.subscribe(()=>{this.portal.document&&(this.portal.document.style.paddingRight="0px",this.portal.document.style.overflow="auto")})}getModalWindowElement(e){return e._windowCmptRef?.instance?._elRef?.nativeElement??null}getModalIframeOffset(){return Math.max(this.getViewportTop()-this.portal.getIframeTop(),0)}getModalTop(){return Math.max(this.getViewportTop(),this.portal.getIframeTop())}getModalBottom(){return Math.min(this.getViewportBottom(),this.portal.getIFrameBottom())}getModalHeight(){return this.getModalBottom()-this.getModalTop()}getViewportTop(){return this.portal.window?.scrollY??0}getViewportBottom(){return this.getViewportTop()+this.getViewportHeight()}getViewportHeight(){return this.portal.window?.innerHeight??0}static{this.\u0275fac=function(i){return new(i||t)(C(yt),C(Kt))}}static{this.\u0275prov=O({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function we(t,r,e){return r?r.Grade:_i(t,e)||t?.GradeValue}function _i(t,r){return r?.Grades.find(e=>e.Id===t?.GradeId)?.Designation}var Gi="1-3",Xt="\u2013",Jt=(()=>{class t{constructor(e){this.locale=e}transform(e,i,n){let d=Number(e??null);return isNaN(d)?Xt:Pi(Number(e??null),n??this.locale,i)}static{this.\u0275fac=function(i){return new(i||t)(E(et,16))}}static{this.\u0275pipe=Q({name:"decimalOrDash",type:t,pure:!0,standalone:!0})}}return t})();function Pi(t,r,e){return t===0?Xt:tt(t,r,`1.${wi(e)}`)}function wi(t){return t?String(t).includes("-")?String(t):`${t}-${t}`:Gi}var Qt=(()=>{class t{constructor(){}getGradeForStudent(){return we(this.grading,this.finalGrade,this.gradingScale)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=D({type:t,selectors:[["bkd-dossier-grades-final-grade"]],inputs:{finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},standalone:!0,features:[$],decls:14,vars:11,consts:[[1,"final-entry"],["data-testid","final-grade"],["data-testid","average-test-results"]],template:function(i,n){i&1&&(p(0,"div",0)(1,"div"),u(2),m(3,"translate"),l(),p(4,"div",1)(5,"span"),u(6),l()(),p(7,"div"),u(8),m(9,"translate"),l(),p(10,"div",2)(11,"span"),u(12),m(13,"decimalOrDash"),l()()()),i&2&&(o(2),R(I(3,4,"dossier.grade")),o(4),R(n.getGradeForStudent()||"\u2013"),o(2),R(I(9,6,"dossier.average")),o(4),R(W(13,8,n.average,"1-3")))},dependencies:[j,F,Jt],styles:[".final-entry[_ngcontent-%COMP%]{padding:1rem;display:grid;grid-template-columns:repeat(2,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}"]})}}return t})();var Yt=(()=>{class t{constructor(e){this.translate=e}transform(e,i,n,d="tests.points"){return e.IsPointGrading&&(e.IsPublished||n)?`${X(i,e)?.Points||"\u2013"} / ${e.MaxPointsAdjusted||e.MaxPoints} ${this.translate.instant(d)}`:""}static{this.\u0275fac=function(i){return new(i||t)(E(xe,16))}}static{this.\u0275pipe=Q({name:"bkdTestPoints",type:t,pure:!0,standalone:!0})}}return t})();var Zt=(()=>{class t{constructor(e){this.translate=e}transform(e){return`${this.translate.instant("tests.factor")} ${e.Weight} (${e.WeightPercent}%)`}static{this.\u0275fac=function(i){return new(i||t)(E(xe,16))}}static{this.\u0275pipe=Q({name:"bkdTestWeight",type:t,pure:!0,standalone:!0})}}return t})();var Di=t=>({maxPoints:t});function Ei(t,r){if(t&1&&(p(0,"div",13),u(1),m(2,"translate"),l()),t&2){let e=S(2);o(),b(" ",W(2,1,"global.validation-errors.invalidPoints",Se(4,Di,e.maxPoints))," ")}}function $i(t,r){if(t&1){let e=ne();p(0,"div",3)(1,"label",11),u(2),m(3,"translate"),l(),p(4,"div",6)(5,"input",12,0),k("input",function(){Y(e);let n=ce(6),d=S();return Z(d.onPointsChange(n.value))}),l()(),T(7,Ei,3,6,"div",13),l()}if(t&2){let e=S();o(2),R(I(3,8,"dossier.dialog.points")),o(2),Re("is-invalid",e.pointsInput.errors),o(),Re("is-invalid",e.pointsInput.errors),Ie("max",e.maxPoints),P("formControl",e.pointsInput),o(2),_(e.pointsInput.errors?7:-1)}}var ei=500,ti=(()=>{class t{constructor(e,i){this.activeModal=e,this.courseService=i,this.maxPoints=0,this.gradeSubject$=new fe,this.pointsSubject$=new fe,this.closeButtonDisabled$=new B(!1),this.gradingScaleDisabled$=new B(!0),this.grade$=this.gradeSubject$.pipe(Ee(ei)),this.points$=this.pointsSubject$.pipe(Ee(ei),ze(this.isValid.bind(this)),f(Number)),this.destroy$=new fe}ngOnInit(){this.maxPoints=Ne(this.test),this.pointsInput=new ot({value:this.points,disabled:!1},[Fe.min(0),Fe.pattern("[0-9]+([\\.][0-9]+)?"),this.maxPointValidator()]),this.gradingScaleDisabled$.next(this.test.IsPointGrading&&this.points>0),this.points$.pipe(Me(this.destroy$)).subscribe(e=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,points:e})),this.grade$.pipe(Me(this.destroy$)).subscribe(e=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,gradeId:e}))}onGradeChange(e){this.gradeSubject$.next(e)}onPointsChange(e){this.pointsSubject$.next(e),this.gradingScaleDisabled$.next(e.length>0)}updateTestResult(e){this.closeButtonDisabled$.next(!0),this.courseService.updateTestResult(this.test.CourseId,e).subscribe(({testResult:i})=>{this.gradeId=i?.GradeId??null,this.updatedTestResult=i,this.closeButtonDisabled$.next(!1)})}isValid(e){return e===""||isNaN(Number(e))?!1:!(Number(e)<0||Number(e)>this.maxPoints)}maxPointValidator(){return e=>Number(e.value)>Ne(this.test)?{customMax:!0}:null}static{this.\u0275fac=function(i){return new(i||t)(E(xt),E(_e))}}static{this.\u0275cmp=D({type:t,selectors:[["bkd-dossier-grades-edit"]],inputs:{test:"test",gradeId:"gradeId",gradeOptions:"gradeOptions",points:"points",studentId:"studentId"},standalone:!0,features:[$],decls:19,vars:20,consts:[["pointInput",""],[1,"modal-body"],[1,"mb-4"],[1,"form-group","row"],[1,"form-group","row","mt-2"],["for","grade",1,"col-6","col-form-label"],[1,"col-6"],["id","grade",3,"valueChange","options","value","allowEmpty","disabled"],[1,"text-muted","mt-4"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["for","points",1,"col-6","col-form-label"],["id","points","type","number","step","0.01","min","0",1,"form-control",3,"input","max","formControl"],["data-testid","validation-error-message",1,"invalid-feedback","col-6","offset-6"]],template:function(i,n){i&1&&(p(0,"div",1)(1,"p",2),u(2),l(),T(3,$i,8,10,"div",3),p(4,"div",4)(5,"label",5),u(6),m(7,"translate"),l(),p(8,"div",6)(9,"bkd-select",7),m(10,"async"),k("valueChange",function(x){return x&&n.onGradeChange(x)}),l()()(),p(11,"p",8),u(12),m(13,"translate"),l()(),p(14,"div",9)(15,"button",10),m(16,"async"),k("click",function(){return n.activeModal.close(n.updatedTestResult)}),u(17),m(18,"translate"),l()()),i&2&&(o(2),R(n.test.Designation),o(),_(n.test.IsPointGrading?3:-1),o(3),R(I(7,10,"dossier.dialog.grade")),o(3),P("options",n.gradeOptions)("value",n.gradeId)("allowEmpty",!1)("disabled",I(10,12,n.gradingScaleDisabled$)),o(3),b(" ",I(13,14,n.test.IsPointGrading?"dossier.dialog.hint.points":"dossier.dialog.hint.grade")," "),o(3),P("disabled",I(16,16,n.closeButtonDisabled$)),o(2),b(" ",I(18,18,"dossier.dialog.close")," "))},dependencies:[Ce,at,lt,ve,ft,gt,ht,pt,Et,N,j,F]})}}return t})();function Mi(t,r){if(t&1){let e=ne();p(0,"a",10),k("click",function(){Y(e);let n=S(2),d=U(0);return Z(n.editGrading(d))}),p(1,"i",11),u(2,"edit"),l(),p(3,"span",5),u(4),l()()}if(t&2){S(2);let e=U(2);o(4),R(e)}}function Ri(t,r){if(t&1&&(p(0,"span",5),u(1),l()),t&2){S(2);let e=U(2);o(),R(e)}}function Oi(t,r){if(t&1&&(p(0,"div",9),u(1),m(2,"translate"),l()),t&2){S(2);let e=U(0);o(),b(" ",I(2,1,e.IsPublished?"tests.published":"tests.not-published")," ")}}function Fi(t,r){if(t&1&&(p(0,"div",0)(1,"div",1),u(2),l(),p(3,"div",2),u(4),m(5,"date"),l(),p(6,"div",3),T(7,Mi,5,1,"a",4)(8,Ri,2,1,"span",5),l(),p(9,"div",6),u(10),m(11,"bkdTestWeight"),l(),p(12,"div",7)(13,"span"),u(14),m(15,"bkdTestPoints"),l()(),p(16,"div",8),u(17),l(),T(18,Oi,3,3,"div",9),l()),t&2){let e=S(),i=U(0);o(2),b(" ",i.Designation," "),o(2),b(" ",W(5,7,i.Date,"dd.MM.yyyy")," "),o(3),_(e.isEditable&&i.IsOwner?7:8),o(3),b(" ",I(11,10,i)," "),o(4),R(Ze(15,12,i,e.studentId,e.isEditable,"dossier.points")),o(3),b(" ",i.Owner," "),o(),_(e.isEditable?18:-1)}}var ii=(()=>{class t{constructor(e,i){this.gradeService=e,this.modalService=i,this.test$=new le(1),this.grading$=this.test$.pipe(f(this.getGrading.bind(this)))}ngOnChanges(e){e.test&&this.test$.next(this.test)}editGrading(e){let i=this.modalService.open(ti,{backdrop:"static"});i.componentInstance.test=e,i.componentInstance.gradeId=this.getGradeId(e),i.componentInstance.gradeOptions=t.mapToOptions(this.gradingScale),i.componentInstance.studentId=this.studentId,i.componentInstance.points=this.getPoints(e),i.result.then(n=>{n&&this.updateStudentGrade(n,e)},()=>{})}updateStudentGrade(e,i){let n=Ve(e,i);this.gradeService.updateStudentCourses(n)}getGrading(e){return this.gradingScale?.Grades.find(i=>i.Id===this.getGradeId(e))?.Designation||"\u2013"}getGradeId(e){return X(this.studentId,e)?.GradeId||null}getPoints(e){return X(this.studentId,e)?.Points||null}static mapToOptions(e){return e?.Grades.map(i=>({Key:i.Id,Value:i.Designation}))||null}static{this.\u0275fac=function(i){return new(i||t)(E(Pe),E(qt))}}static{this.\u0275cmp=D({type:t,selectors:[["bkd-dossier-single-test"]],inputs:{test:"test",studentId:"studentId",gradingScale:"gradingScale",isEditable:"isEditable"},standalone:!0,features:[L,$],decls:5,vars:7,consts:[[1,"test-entry"],["data-testid","test-designation",1,"designation"],["data-testid","test-date",1,"date"],[1,"grade"],["aria-label","edit grade",1,"btn","btn-link"],["data-testid","test-grade"],["data-testid","test-factor",1,"factor"],["data-testid","test-points",1,"points"],["data-testid","test-teacher",1,"teacher"],["data-testid","test-status",1,"state"],["aria-label","edit grade",1,"btn","btn-link",3,"click"],["data-testid","test-grade-edit-icon",1,"material-icons"]],template:function(i,n){if(i&1&&(ue(0),m(1,"async"),ue(2),m(3,"async"),T(4,Fi,19,17,"div",0)),i&2){let d=me(I(1,1,n.test$));o(2),me(I(3,4,n.grading$)),o(2),_(d?4:-1)}},dependencies:[N,nt,j,F,Yt,Zt],styles:['.test-entry[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1rem;display:grid;grid-template-areas:"designation designation grade factor" "date date points ." "teacher teacher . ." "state state . .";grid-template-columns:repeat(4,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}.designation[_ngcontent-%COMP%]{grid-area:designation}.date[_ngcontent-%COMP%]{grid-area:date}.grade[_ngcontent-%COMP%]{grid-area:grade}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;color:#000;padding:0;text-decoration:none}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.grade[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:-1em;color:#00000080}.points[_ngcontent-%COMP%]{grid-area:points;color:#00000080}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.state[_ngcontent-%COMP%]{grid-area:state}@media (max-width: 575.98px){.test-entry[_ngcontent-%COMP%]{grid-template-areas:"designation designation" "date grade" "factor points" "teacher teacher" "state state";grid-template-columns:repeat(2,1fr)}}']})}}return t})();var ji=(t,r)=>r.Id,Ai=()=>[];function Bi(t,r){if(t&1&&ie(0,"bkd-dossier-single-test",2),t&2){let e=r.$implicit,i=S(2);P("test",e)("studentId",i.studentId)("gradingScale",i.getGradingScaleOfTest(e))("isEditable",i.isEditable)}}function ki(t,r){if(t&1&&(p(0,"div"),ie(1,"bkd-dossier-grades-final-grade",1),ee(2,Bi,1,4,"bkd-dossier-single-test",2,ji),l()),t&2){let e=S(),i=U(0);o(),P("finalGrade",e.decoratedCourse.finalGrade)("grading",e.decoratedCourse.grading)("gradingScale",e.decoratedCourse.gradingScale)("average",e.decoratedCourse.average),o(),te(i)}}function Ni(t,r){t&1&&(p(0,"p",0),u(1),m(2,"translate"),l()),t&2&&(o(),b(" ",I(2,1,"dossier.no-tests")," "))}var ni=(()=>{class t{ngOnChanges(e){e.decoratedCourse&&this.sortedTests$.next(this.sortedTests())}constructor(){this.sortedTests$=new B([])}sortedTests(){return this.decoratedCourse.course.Tests?Vt(this.decoratedCourse.course.Tests):[]}getGradingScaleOfTest(e){return Ge(e,this.gradingScales)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=D({type:t,selectors:[["bkd-dossier-course-tests"]],inputs:{studentId:"studentId",decoratedCourse:"decoratedCourse",gradingScales:"gradingScales",isEditable:"isEditable"},standalone:!0,features:[L,$],decls:4,vars:5,consts:[["data-testid","message-no-tests",1,"p-3"],[3,"finalGrade","grading","gradingScale","average"],[3,"test","studentId","gradingScale","isEditable"]],template:function(i,n){if(i&1&&(ue(0),m(1,"async"),T(2,ki,4,4,"div")(3,Ni,3,3,"p",0)),i&2){let d,x=me((d=I(1,1,n.sortedTests$))!==null&&d!==void 0?d:Ye(4,Ai));o(2),_(x.length>0?2:3)}},dependencies:[Qt,ii,N,j,F]})}}return t})();function Vi(t,r){if(t&1&&(p(0,"span",0),u(1),l()),t&2){let e=S();o(),b(" (",e.grade,")")}}function Hi(t,r){if(t&1&&(p(0,"span",1),u(1),m(2,"number"),l()),t&2){let e=S();o(),b(" (",W(2,1,e.average,"1.1-3"),")")}}var ri=(()=>{class t{constructor(){}get grade(){return this.getGradeForStudent()}getGradeForStudent(){return we(this.grading,this.finalGrade,this.gradingScale)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=D({type:t,selectors:[["bkd-dossier-grades-course-header"]],inputs:{designation:"designation",finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},standalone:!0,features:[$],decls:3,vars:3,consts:[["data-testId","grade",1,"grade"],["data-testId","average",1,"average"]],template:function(i,n){i&1&&(u(0),T(1,Vi,2,1,"span",0)(2,Hi,3,4,"span",1)),i&2&&(b("",n.designation,`
`),o(),_(n.grade?1:-1),o(),_(!n.grade&&n.average?2:-1))},dependencies:[rt],styles:[".average[_ngcontent-%COMP%]{color:#00000080}"]})}}return t})();var Li=(t,r)=>r.course.Id;function Ui(t,r){if(t&1&&ie(0,"bkd-dossier-course-tests",9),t&2){let e=S().$implicit,i=S(2);P("decoratedCourse",e)("studentId",i.studentId)("gradingScales",i.gradingScales)("isEditable",i.isEditable)}}function Wi(t,r){if(t&1){let e=ne();p(0,"div")(1,"div",2)(2,"div",3,0)(4,"div",4)(5,"bkd-student-dossier-entry-header",5),k("click",function(){Y(e);let n=ce(3);return Z(n.toggle())}),ie(6,"bkd-dossier-grades-course-header",6),l()(),p(7,"div",7)(8,"div",8),T(9,Ui,1,4,"ng-template"),l()()()()()}if(t&2){let e=r.$implicit,i=ce(3);o(5),P("opened",!i.collapsed),o(),P("designation",e.course.Designation)("finalGrade",e.finalGrade)("grading",e.grading)("gradingScale",e.gradingScale)("average",e.average)}}function Ki(t,r){if(t&1&&(ee(0,Wi,10,6,"div",null,Li),m(2,"async")),t&2){let e=S();te(I(2,0,e.decoratedCoursesSubject$))}}function qi(t,r){t&1&&(p(0,"p",1),u(1),m(2,"translate"),l()),t&2&&(o(),b(" ",I(2,1,"dossier.no-courses")," "))}var Wr=(()=>{class t{constructor(e){this.dossierGradesService=e,this.isEditable=!0,this.decoratedCoursesSubject$=new B([])}ngOnChanges(){this.decoratedCoursesSubject$.next(this.decorateCourses())}decorateCourses(){return this.courses.map(e=>{let i=this.dossierGradesService.getFinalGradeForStudent(e,this.studentId),n=this.dossierGradesService.getGradesForStudent(e,this.studentId,this.gradingScales);return{course:e,finalGrade:i,grading:this.dossierGradesService.getGradingForStudent(e,this.studentId),gradingScale:this.dossierGradesService.getGradingScaleOfCourse(e,this.gradingScales),average:i?.AverageTestResult||kt(n)}})}static{this.\u0275fac=function(i){return new(i||t)(E(Pe))}}static{this.\u0275cmp=D({type:t,selectors:[["bkd-dossier-grades-view"]],inputs:{courses:"courses",studentId:"studentId",gradingScales:"gradingScales",isEditable:"isEditable"},standalone:!0,features:[L,$],decls:2,vars:1,consts:[["courses","ngbAccordionItem"],["data-testid","message-no-courses",1,"py-3"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],[3,"designation","finalGrade","grading","gradingScale","average"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[3,"decoratedCourse","studentId","gradingScales","isEditable"]],template:function(i,n){i&1&&T(0,Ki,3,2)(1,qi,3,3,"p",1),i&2&&_(n.courses.length>0?0:1)},dependencies:[Ct,vt,bt,Gt,ri,St,It,ni,N,j,F]})}}return t})();export{ke as a,Tn as b,_n as c,Gn as d,Pn as e,wn as f,Dn as g,En as h,Vt as i,Xt as j,Jt as k,Pi as l,Et as m,$t as n,Ae as o,_e as p,He as q,Lt as r,Ut as s,Pe as t,Kt as u,qt as v,Wr as w};
