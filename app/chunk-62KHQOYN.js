import{a as je,b as Be}from"./chunk-ZK2M6PDV.js";import{b as xe,d as Me,e as Ee}from"./chunk-2FIH3FGB.js";import{b as De}from"./chunk-MVTCHCDH.js";import"./chunk-Y4QYVF5K.js";import"./chunk-WN7VWSJW.js";import{a as K}from"./chunk-TK3HGFHH.js";import{H as ke,I as Ae,J as Oe,O as $e,P as C,T as Pe,V as Ie,X as we,Y as Le,a as fe}from"./chunk-GI4AZI25.js";import{e as U}from"./chunk-Q5U6YZUT.js";import{b as Fe}from"./chunk-N6FFLIGM.js";import{a as Se,c as Te}from"./chunk-33NXTXD7.js";import{x as ye,y as Ce}from"./chunk-FTRAQKUW.js";import"./chunk-3AROKYRB.js";import{$ as P,$a as u,Bb as p,Cb as l,Db as F,E as _,Fb as J,Ga as v,Gd as he,Hd as _e,Ia as g,Id as ve,Ja as ie,L,O as j,Q as Y,Sa as c,Sb as pe,Ta as a,Tb as le,Ua as x,Va as G,W as ne,Wa as H,Wb as V,Xb as de,Ya as B,Z as D,_a as I,e as $,f as W,ha as M,ia as E,ib as N,j as Z,jb as d,kb as y,lb as T,m,mb as se,n as S,pc as me,qc as ge,rc as ue,sb as re,sc as be,tb as w,ua as o,ub as oe,v as ee,va as h,vb as R,w as te,wb as ce,xb as ae}from"./chunk-T7QWSMKM.js";var k=(()=>{let i=class i{constructor(e,t,r,b){this.lessonPresencesService=e,this.selectionService=t,this.loadingService=r,this.translate=b,this.loading$=this.loadingService.loading$,this.search$=new W(""),this.updateUnconfirmedAbsences$=new $,this.unconfirmedAbsences$=ee(this.loadUnconfirmedAbsences(),this.updateUnconfirmedAbsences$).pipe(L(1)),this.entries$=this.unconfirmedAbsences$.pipe(m(ke),L(1)),this.sortCriteriaSubject$=new W({primarySortKey:"date",ascending:!1}),this.sortCriteria$=this.sortCriteriaSubject$.asObservable(),this.sortedEntries$=S([this.entries$,this.sortCriteria$]).pipe(m(U(Ae))),this.filteredEntries$=S([this.sortedEntries$,this.search$]).pipe(m(U(je)),L(1)),this.currentDetail=null}getUnconfirmedAbsences(e,t){return this.entries$.pipe(m(r=>{let b=r.find(A=>A.dateString===e&&A.studentId===t);return b?b.absences:[]}))}getAllUnconfirmedAbsencesForStudent(e){return this.entries$.pipe(m(t=>t.filter(r=>r.studentId===e).reduce((r,b)=>r.concat(b.absences),[])))}toggleSort(e){this.sortCriteriaSubject$.pipe(_(1)).subscribe(t=>{t.primarySortKey===e?this.sortCriteriaSubject$.next({primarySortKey:e,ascending:!t.ascending}):this.sortCriteriaSubject$.next({primarySortKey:e,ascending:e==="name"})})}get confirmBackLink(){return this.currentDetail?["/open-absences/detail",this.currentDetail.personId,this.currentDetail.date]:["/open-absences"]}updateAfterConfirm(){S([this.unconfirmedAbsences$.pipe(_(1)),this.selectionService.selectedIds$.pipe(_(1))]).pipe(m(U(Oe))).subscribe(e=>{this.selectionService.clear(),this.updateUnconfirmedAbsences$.next(e)})}buildMailToString(e,t){let r=e.Email,b=this.translate.instant("open-absences.detail.mail.subject"),A=t.map(q=>$e(q)).join("%0D%0A"),O=`${this.translate.instant("open-absences.detail.mail.body")}%0D%0A${A}`;return O.length>=1600&&(O=`${O.substring(0,1500)}%0D%0A${this.translate.instant("open-absences.detail.mail.bodyToLargeForEmailTo")}`),`${r}?subject=${b}&body=${O}`}loadUnconfirmedAbsences(){return this.loadingService.load(this.lessonPresencesService.getListOfUnconfirmed())}};i.\u0275fac=function(t){return new(t||i)(D(Ee),D(C),D(Fe),D(he))},i.\u0275prov=ne({token:i,factory:i.\u0275fac});let n=i;return n})();var We=()=>["/open-absences"],Ve=(()=>{let i=class i{constructor(e,t,r,b,A,O,q){this.router=e,this.route=t,this.openAbsencesService=r,this.presenceTypesService=b,this.personService=A,this.selectionService=O,this.scrollPosition=q,this.absences$=this.route.paramMap.pipe(j(this.getAbsencesForParams.bind(this))),this.hasAbsences$=this.absences$.pipe(m(ye(1))),this.studentFullName$=this.absences$.pipe(m(f=>f[0]&&f[0].StudentFullName||null)),this.allSelected$=S([this.absences$,this.selectionService.selection$]).pipe(m(([f,z])=>f.length===z.length)),this.studentEmail$=this.absences$.pipe(m(f=>f[0]&&f[0].StudentRef.Id||null),j(f=>f?this.personService.getByIdWithEmailInfos(f):Z)),this.allUnconfirmedAbsencesForStudent$=this.route.paramMap.pipe(j(this.getAbsencesForStudentParam.bind(this))),this.mailTo$=S([this.studentEmail$,this.allUnconfirmedAbsencesForStudent$]).pipe(m(([f,z])=>this.openAbsencesService.buildMailToString(f,z))),this.destroy$=new $}ngOnInit(){this.selectionService.clearNonLessonPresences(),this.route.paramMap.pipe(Y(this.destroy$)).subscribe(e=>this.openAbsencesService.currentDetail={date:String(e.get("date")),personId:Number(e.get("personId"))}),this.hasAbsences$.pipe(Y(this.destroy$),te(fe(Ce))).subscribe(()=>this.router.navigate(["/open-absences"]))}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}toggleAll(e){e?this.absences$.pipe(_(1)).subscribe(t=>this.selectionService.clear(t)):this.selectionService.clear()}onRowClick(e,t){e.target!==t&&t.click()}getPresenceTypeDesignation(e){return this.presenceTypesService.displayedTypes$.pipe(m(t=>e.TypeRef.Id&&t.find(r=>r.Id===e.TypeRef.Id)?.Designation||null))}getAbsencesForParams(e){return this.openAbsencesService.getUnconfirmedAbsences(String(e.get("date")),Number(e.get("personId")))}getAbsencesForStudentParam(e){return this.openAbsencesService.getAllUnconfirmedAbsencesForStudent(Number(e.get("personId")))}};i.\u0275fac=function(t){return new(t||i)(h(ue),h(me),h(k),h(Pe),h(De),h(C),h(K))},i.\u0275cmp=P({type:i,selectors:[["bkd-open-absences-detail"]],standalone:!0,features:[w],decls:6,vars:10,consts:[[3,"link"],[3,"absences$","selectionService","confirmLink","displayEmail","mailTo$"]],template:function(t,r){t&1&&(c(0,"div"),x(1,"bkd-backlink",0),c(2,"h1"),d(3),p(4,"async"),a()(),x(5,"bkd-student-dossier-absences",1)),t&2&&(o(),g("link",oe(9,We)),o(2),y(l(4,7,r.studentFullName$)),o(2),g("absences$",r.absences$)("selectionService",r.selectionService)("confirmLink","/open-absences/confirm")("displayEmail",!0)("mailTo$",r.mailTo$))},dependencies:[Le,we,V],styles:['.content[_ngcontent-%COMP%]{padding-left:1rem;padding-right:1rem}.back[_ngcontent-%COMP%]{color:#000;text-decoration:none}.back[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]:active   span[_ngcontent-%COMP%]{text-decoration:underline}.absence-entry[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox lesson-class time teacher" "checkbox presence-type date days-ago";grid-template-columns:min-content 2fr 1fr 2fr}.checkbox[_ngcontent-%COMP%]{grid-area:checkbox;margin:0;padding:.6rem .5rem 0 0}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.all[_ngcontent-%COMP%]{grid-area:all}.lesson-class[_ngcontent-%COMP%]{grid-area:lesson-class;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.time[_ngcontent-%COMP%]{grid-area:time}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.presence-type[_ngcontent-%COMP%]{color:#adb5bd;grid-area:presence-type}.date[_ngcontent-%COMP%]{grid-area:date}.days-ago[_ngcontent-%COMP%]{color:#adb5bd;grid-area:days-ago}.date-days-ago[_ngcontent-%COMP%]{grid-area:date-days-ago;display:none}@media (max-width: 750px){.content[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.absence-entry[_ngcontent-%COMP%]{grid-template-areas:"checkbox lesson-class" "checkbox teacher" "checkbox date-days-ago" "checkbox time" "checkbox presence-type";grid-template-columns:min-content 1fr}.date-days-ago[_ngcontent-%COMP%]{display:block}.date[_ngcontent-%COMP%], .days-ago[_ngcontent-%COMP%]{display:none}}'],changeDetection:0});let n=i;return n})();var Ye=(n,i,s)=>({selection:n,entries:i,sortCriteria:s}),X=n=>({count:n}),Ge=(n,i)=>["detail",n,i];function He(n,i){if(n&1){let s=B();c(0,"div",16),I("click",function(){let t=M(s).$implicit,r=u(4);return E(r.openAbsencesService.toggleSort(t))}),d(1),p(2,"translate"),c(3,"span",17),d(4),a()()}if(n&2){let s=i.$implicit,e=u(3).bkdLet,t=u();g("className",s),o(),T(" ",l(2,3,"open-absences.list.header."+s)," "),o(3),y(t.getSortDirectionCharacter(e.sortCriteria,s))}}function Je(n,i){if(n&1){let s=B();c(0,"div")(1,"div",18)(2,"div",19),I("click",function(t){M(s);let r=N(4),b=u(4);return E(b.onCheckboxCellClick(t,r))}),c(3,"input",13,2),p(5,"async"),I("change",function(){let t=M(s).$implicit,r=u(4);return E(r.selectionService.toggle(t))}),a()(),c(6,"div",20)(7,"a",21),d(8),a()(),c(9,"div",22),d(10),a(),c(11,"div",23),d(12),p(13,"translate"),a(),c(14,"div",24),d(15),p(16,"translate"),a(),c(17,"div",25),d(18),p(19,"bkdDaysDifference"),a(),c(20,"div",26),d(21),p(22,"date"),a()()()}if(n&2){let s=i.$implicit,e=u(4);o(3),g("checked",l(5,9,e.selectionService.isSelected$(s))),o(4),g("routerLink",ce(22,Ge,s.studentId,s.dateString)),o(),y(s.studentFullName),o(2),T(" ",s.studyClassNumber," "),o(2),T(" ",F(13,11,e.getLessonsCountKey(s),R(25,X,s.lessonsCount))," "),o(3),se(" ",s.studyClassNumber,", ",F(16,14,e.getLessonsCountKey(s),R(27,X,s.lessonsCount))," "),o(3),T(" ",l(19,17,s.date)," "),o(3),y(F(22,19,s.date,"dd.MM.yyyy"))}}function Qe(n,i){if(n&1){let s=B();G(0),c(1,"div")(2,"bkd-resettable-input",5),p(3,"async"),p(4,"translate"),p(5,"translate"),I("valueChange",function(t){M(s);let r=u(3);return E(r.openAbsencesService.search$.next(t))}),a(),c(6,"div",6)(7,"div",7),d(8),p(9,"translate"),a(),c(10,"a",8)(11,"i",9),d(12,"edit"),a()()()(),c(13,"div",10)(14,"div",11)(15,"div",12)(16,"input",13),I("change",function(t){M(s);let r=u(3);return E(r.onToggleAll(t.currentTarget==null?null:t.currentTarget.checked))}),a()(),v(17,He,5,5,"div",14),a(),v(18,Je,23,29,"div",15),a(),H()}if(n&2){let s=u(2).bkdLet,e=u();o(2),g("value",l(3,9,e.openAbsencesService.search$))("placeholder",l(4,11,"open-absences.search-by-name-or-class"))("label",l(5,13,"open-absences.search")),o(6),T(" ",F(9,15,"open-absences.selected",R(18,X,s.selection.length))," "),o(2),ie("disabled",s.selection.length===0),o(6),g("checked",s.selection.length===s.entries.length),o(),g("ngForOf",e.primarySortKeys),o(),g("ngForOf",s.entries)}}function Xe(n,i){n&1&&(c(0,"p",27),d(1),p(2,"translate"),a()),n&2&&(o(),y(l(2,1,"open-absences.noEntries")))}function Ze(n,i){if(n&1&&(G(0),v(1,Qe,19,20,"ng-container",4),p(2,"async"),v(3,Xe,3,3,"ng-template",null,1,J),H()),n&2){let s,e=N(4),t=u().bkdLet,r=u();o(),g("ngIf",((s=(s=l(2,2,r.openAbsencesService.sortedEntries$))==null?null:s.length)!==null&&s!==void 0?s:0)>0||(t.entries==null?null:t.entries.length)>0)("ngIfElse",e)}}function et(n,i){n&1&&x(0,"bkd-spinner")}function tt(n,i){if(n&1&&(c(0,"div"),v(1,Ze,5,4,"ng-container",4),p(2,"async"),v(3,et,1,0,"ng-template",null,0,J),a()),n&2){let s=N(4),e=u();o(),g("ngIf",l(2,2,e.openAbsencesService.loading$)===!1)("ngIfElse",s)}}var Ue=(()=>{let i=class i{constructor(e,t,r){this.openAbsencesService=e,this.selectionService=t,this.scrollPosition=r,this.primarySortKeys=["name","date"],this.destroy$=new $}ngOnInit(){this.openAbsencesService.currentDetail=null,this.selectionService.clearNonOpenAbsencesEntries()}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}onToggleAll(e){this.openAbsencesService.filteredEntries$.pipe(_(1)).subscribe(t=>{this.selectionService.clear(e?t:null)})}onCheckboxCellClick(e,t){e.target!==t&&t.click()}getSortDirectionCharacter(e,t){return e.primarySortKey!==t?"":e.ascending?"\u2193":"\u2191"}getLessonsCountKey(e){return`open-absences.list.content.lessonsCount.${e.lessonsCount===1?"singular":"plural"}`}};i.\u0275fac=function(t){return new(t||i)(h(k),h(C),h(K))},i.\u0275cmp=P({type:i,selectors:[["bkd-open-absences-list"]],standalone:!0,features:[w],decls:7,vars:14,consts:[["loading",""],["noEntries",""],["checkbox",""],[4,"bkdLet"],[4,"ngIf","ngIfElse"],[1,"d-flex","header-search",3,"valueChange","value","placeholder","label"],[1,"d-flex","align-items-center","justify-content-between","mt-1"],[1,"selection-count","ps-1"],["routerLink","/open-absences/confirm",1,"edit","btn","btn-primary","btn-edit","mt-1","mb-2"],[1,"material-icons"],[1,"content"],[1,"absence-header"],[1,"checkbox"],["type","checkbox",1,"form-check-input",3,"change","checked"],[3,"className","click",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"click","className"],[1,"sort-direction"],[1,"absence-entry"],[1,"checkbox",3,"click"],[1,"name","pe-2"],[3,"routerLink"],[1,"study-class"],[1,"lessons-count"],[1,"study-class-lessons-count"],[1,"days-ago"],[1,"date"],[1,"mt-3"]],template:function(t,r){t&1&&(c(0,"h1"),d(1),p(2,"translate"),a(),v(3,tt,5,4,"div",3),p(4,"async"),p(5,"async"),p(6,"async")),t&2&&(o(),y(l(2,2,"open-absences.title")),o(2),g("bkdLet",ae(10,Ye,l(4,4,r.selectionService.selection$),l(5,6,r.openAbsencesService.filteredEntries$),l(6,8,r.openAbsencesService.sortCriteria$))))},dependencies:[Se,le,Be,be,pe,Te,V,de,ve,_e,Ie],styles:['.header-search[_ngcontent-%COMP%]{max-width:500px}.absence-header[_ngcontent-%COMP%]{cursor:pointer;padding:1rem;display:grid;grid-template-areas:"checkbox name date";grid-template-columns:min-content 5fr 1fr;border-top:1px solid #dee2e6;border-bottom:2px solid #dee2e6;align-items:center}.absence-entry[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox name study-class lessons-count days-ago date";grid-template-columns:min-content 2fr 1fr 1fr 1fr 1fr;align-items:center}.checkbox[_ngcontent-%COMP%]{align-self:start;grid-area:checkbox;margin:0;padding:.3rem 1rem 0 0}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.name[_ngcontent-%COMP%]{grid-area:name;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.lessons-count[_ngcontent-%COMP%]{grid-area:lessons-count}.study-class[_ngcontent-%COMP%]{grid-area:study-class}.study-class-lessons-count[_ngcontent-%COMP%]{grid-area:study-class-lessons-count;display:none}.days-ago[_ngcontent-%COMP%]{color:#6c757d;grid-area:days-ago}.date[_ngcontent-%COMP%]{grid-area:date}@media (max-width: 750px){.content[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.absence-header[_ngcontent-%COMP%]{grid-template-areas:"checkbox name date";grid-template-columns:min-content 3fr 2fr}.absence-entry[_ngcontent-%COMP%]{grid-template-areas:"checkbox name date" "checkbox study-class-lessons-count days-ago";grid-template-columns:min-content 3fr 2fr}.study-class-lessons-count[_ngcontent-%COMP%]{display:block}.study-class[_ngcontent-%COMP%], .lessons-count[_ngcontent-%COMP%]{display:none}.days-ago[_ngcontent-%COMP%], .study-class-lessons-count[_ngcontent-%COMP%]{font-size:.875rem;color:#adb5bd}}'],changeDetection:0});let n=i;return n})();var Ke=(()=>{let i=class i{constructor(){}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=P({type:i,selectors:[["bkd-open-absences"]],standalone:!0,features:[re([k,C,{provide:xe,useExisting:k}]),w],decls:1,vars:0,template:function(t,r){t&1&&x(0,"router-outlet")},dependencies:[ge],changeDetection:0});let n=i;return n})();var Rt=[{path:"",component:Ke,children:[{path:"",component:Ue,data:{restoreScrollPositionFrom:["/open-absences/detail/:personId/:date","/open-absences/confirm"]}},{path:"detail/:personId/:date",component:Ve,data:{restoreScrollPositionFrom:["/open-absences/confirm"]}},{path:"confirm",component:Me}]}];export{Rt as OPEN_ABSENCES_ROUTES};
