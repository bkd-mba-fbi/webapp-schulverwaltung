import{a as Tt}from"./chunk-Y4QYVF5K.js";import{a as yt}from"./chunk-WN7VWSJW.js";import{b as _t,c as Gt,d as Pt}from"./chunk-LO5XSJLW.js";import{b as Et}from"./chunk-N6FFLIGM.js";import{a as Te,b as de}from"./chunk-33NXTXD7.js";import{A as ye,a as ht,b as It,c as bt,d as St,e as vt,p as xt,q as Ct,u as Ce}from"./chunk-FTRAQKUW.js";import{$ as D,$a as v,$c as Fe,Ac as c,Bb as g,Bc as a,C as we,Cb as b,Cc as M,Db as K,Dd as oe,Eb as Ze,Ed as Q,Fb as ne,Fc as E,G as ze,Ga as y,Gc as C,Gd as xe,Hb as et,Hc as be,Hd as F,Ia as m,Id as k,J as Xe,Ja as Re,Jc as Oe,L as $e,Nc as o,O as G,Pb as tt,Q as Me,Sa as p,Sb as re,Sc as ae,Ta as l,Tb as O,Ua as te,Uc as rt,Va as fe,W as N,Wa as he,Wb as H,Wc as q,Xb as it,Ya as ie,Yb as nt,Z as _,Zc as st,_a as A,a as L,ad as Se,b as U,c as We,ca as Y,cb as Ie,dd as at,e as me,ec as se,ed as ot,f as B,g as pe,ga as W,gd as dt,ha as Z,ia as ee,ib as V,id as lt,jb as u,k as De,kb as P,l as Ke,lb as x,ld as pt,m as I,md as ct,n as ce,nd as ut,od as mt,pd as gt,r as ge,ra as Je,sd as ve,tb as $,td as ft,ua as d,v as qe,va as w,vb as Ye,w as Qe}from"./chunk-T7QWSMKM.js";function ri(i,t){if(i&1&&(p(0,"option",3),u(1),g(2,"translate"),l()),i&2){let r=v();m("ngValue",null),d(),x(" ",b(2,2,r.emptyLabel)," ")}}function si(i,t){if(i&1&&(p(0,"option",3),u(1),l()),i&2){let r=t.$implicit;m("ngValue",r),d(),x(" ",r.Value," ")}}var Dt=(()=>{let t=class t{constructor(){this.options=[],this.allowEmpty=!0,this.emptyLabel="",this.value=null,this.disabled=!1,this.tabindex=0,this.valueChange=new Je,this.options$=new B([]),this.rawValue$=new B(null),this.value$=ce([this.rawValue$,this.options$]).pipe(I(([e,n])=>n&&n.find(s=>s.Key===e)||null))}ngOnChanges(e){e.value&&this.rawValue$.next(e.value.currentValue),e.options&&this.options$.next(e.options.currentValue)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=D({type:t,selectors:[["bkd-select"]],inputs:{options:"options",allowEmpty:"allowEmpty",emptyLabel:"emptyLabel",value:"value",disabled:"disabled",tabindex:"tabindex"},outputs:{valueChange:"valueChange"},standalone:!0,features:[W,$],decls:5,vars:7,consts:[[1,"form-select",3,"ngModelChange","tabindex","disabled","ngModel"],[3,"ngValue",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"]],template:function(n,s){n&1&&(p(0,"select",0),g(1,"async"),A("ngModelChange",function(T){return s.valueChange.emit(T&&T.Key)}),y(2,ri,3,4,"option",1)(3,si,2,2,"option",2),u(4,` >
`),l()),n&2&&(Ie("tabindex",s.tabindex),m("disabled",s.disabled)("ngModel",b(1,5,s.value$)),d(2),m("ngIf",s.allowEmpty),d(),m("ngForOf",s.options))},dependencies:[ve,ct,ut,pt,Se,ot,O,re,H,k,F],changeDetection:0});let i=t;return i})();var wt=C({Id:a,Designation:c,StudentCount:a,Number:c});var ke=C({Id:c,TestId:a,CourseRegistrationId:a,GradeId:o(a),GradeValue:o(a),GradeDesignation:o(c),Points:o(a),StudentId:a});var $t=C({Id:a,CourseId:a,Date:ae,Designation:c,Weight:a,WeightPercent:a,IsPointGrading:M,MaxPoints:o(a),MaxPointsAdjusted:o(a),IsPublished:M,IsOwner:M,Owner:o(c),GradingScaleId:o(a),Results:o(E(ke))});var Mt=C({Id:a}),Rt=be({HRef:o(c)}),ai=be({HasEvaluationStarted:M,EvaluationUntil:o(ae),HasReviewOfEvaluationStarted:M,HasTestGrading:M,Id:a}),oi=Oe([Mt,Rt,ai]),di=be({Id:a,StudentCount:a}),li=Oe([Mt,Rt,di]),pi=C({Grade:c,AverageTestResult:a,Id:a,StudentId:a}),je=C({AverageTestResult:a,CanGrade:M,EventId:a,GradeId:o(a),GradeValue:o(a),Id:a,StudentId:a}),le=C({HRef:c,Id:a,Number:c,Designation:c,DateFrom:o(ae),DateTo:o(ae),StatusId:a,GradingScaleId:o(a),FinalGrades:o(E(pi)),Gradings:o(E(je)),Tests:o(E($t)),EvaluationStatusRef:oi,AttendanceRef:li,ParticipatingStudents:o(E(Gt)),Classes:o(E(wt))}),Ot=C({TestResults:E(ke),Gradings:E(je)}),Ft=C({Gradings:E(je)});var _e=(()=>{let t=class t extends de{constructor(e,n){super(e,n,le,"Courses"),this.statusCodec=C(rt(this.codec.props,["Id","StatusId","EvaluationStatusRef"]))}getNumberOfCoursesForRating(){return this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef&fields=Id,StatusId,EvaluationStatusRef&filter.StatusId=;10300;10240`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe(G(Q(this.statusCodec)),I(e=>e.filter(n=>n.EvaluationStatusRef.HasEvaluationStarted===!0)),I(e=>e.length))}getExpandedCourses(e){return Tt(e,"TeacherRole")?this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef,AttendanceRef,Classes,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe(G(Q(le))):De([])}getExpandedCourse(e){return this.http.get(`${this.baseUrl}/${e}?expand=ParticipatingStudents,EvaluationStatusRef,Tests,Gradings,FinalGrades,Classes`).pipe(G(oe(le)))}getExpandedCoursesForDossier(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades,EvaluationStatusRef,ParticipatingStudents,Classes&filter.StatusId=;${this.settings.eventlist.statusfilter}`).pipe(G(Q(le)))}getExpandedCoursesForStudent(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"StudentRole"}}).pipe(G(Q(le)))}add(e,n,s,f,T,j,h){let S={Tests:[{Date:n,Designation:s,Weight:f,IsPointGrading:T,MaxPoints:j,MaxPointsAdjusted:h}]};return this.http.put(`${this.baseUrl}/${e}/Tests/New`,S).pipe(I(()=>{}))}update(e,n,s,f,T,j,h,S){let J={Tests:[{Id:n,Designation:s,Date:f,Weight:T,IsPointGrading:j,MaxPoints:h,MaxPointsAdjusted:S}]};return this.http.put(`${this.baseUrl}/${e}/Tests/Update`,J).pipe(I(()=>{}))}delete(e,n){let s={TestIds:[n]};return this.http.put(`${this.baseUrl}/${e}/Tests/Delete`,s).pipe(I(()=>n))}updateTestResult(e,n){let S=n,{studentId:s,testId:f}=S,T=We(S,["studentId","testId"]),j={StudentIds:[s],TestId:f},h="gradeId"in T?U(L({},j),{GradeId:T.gradeId}):U(L({},j),{Points:T.points});return this.http.put(`${this.baseUrl}/${e}/SetTestResult`,h).pipe(G(oe(Ot)),G(({TestResults:J,Gradings:Ue})=>J.length<=1&&Ue.length===1?De({courseId:e,testResult:J[0]??null,grading:Ue[0]}):Ke(()=>new Error("`TestResults` or `Gradings` does not contain a single value"))))}setAverageAsFinalGrade(e){return this.http.put(`${this.baseUrl}/SetAverageTestResult`,e).pipe(G(oe(Ft)))}publishTest(e){let n={TestIds:[e]};return this.http.put(`${this.baseUrl}/PublishTest`,n).pipe(I(()=>e))}unpublishTest(e){let n={TestIds:[e]};return this.http.put(`${this.baseUrl}/UnpublishTest`,n).pipe(I(()=>e))}};t.\u0275fac=function(n){return new(n||t)(_(se),_(q))},t.\u0275prov=N({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();function Bt(i){return i.length===0?0:Be(i.map(({value:t,weight:r})=>t*r))/Be(i.map(({weight:t})=>t))}function Ne(i){return i.length===0?0:Number(Be(i)/i.length)}function Be(i){return i.reduce(ci,0)}function ci(i,t){return i+t}function In(i,t,r){return i?i.Tests?.reduce((e,n)=>e||n.Id===t&&n.Results?.find(s=>s.TestId===t&&s.StudentId===r)||null,null)??null:null}function bn(i,t,r){return t.map(e=>e.Id===i.TestId?Ve(i,e,r):e)}function Sn(i,t,r){return r.map(e=>e.Id===i?ui(t,e):e)}function vn(i,t){return t.map(r=>r.Id===i?U(L({},r),{IsPublished:!r.IsPublished}):r)}function xn(i){let t=gi(i);if(t.length===0)throw new Error("unable to calculate averages without results");return Ne(t)}function Ae(i){return i.MaxPointsAdjusted||i.MaxPoints}function Cn(i){let t=mi(i);if(t.length===0)throw new Error("unable to calculate averages without results");return Ne(t)}function X(i,t){return t.Results?.find(r=>r.StudentId===i)}function yn(i,t){return t===null?null:t.filter(r=>r.Id!==i)}function Ve(i,t,r){let e=r&&t.Results?.find(s=>s.TestId===i.TestId&&s.StudentId===i.StudentId),n=t.Results?.filter(s=>!(s.TestId===i.TestId&&s.StudentId===i.StudentId))||[];return e&&r==="grade"?i.GradeId=e.GradeId:e&&r==="points"&&(i.Points=e.Points),U(L({},t),{Results:[...n,i]})}function At(i){return i.slice().sort((t,r)=>r.Date.getTime()-t.Date.getTime())}function Ge(i,t){return t?.find(r=>r.Id===i.GradingScaleId)||null}function ui(i,t){return U(L({},t),{Results:t.Results?.filter(r=>r.StudentId!==i)||[]})}function mi(i){return i.Results?.filter(t=>t.GradeDesignation!==null).map(t=>Number(t.GradeDesignation)).filter(t=>!isNaN(t))||[]}function gi(i){return i.Results?.map(t=>t.Points!==null?t.Points:Nt).filter(t=>t>Nt)||[]}var Nt=-1;var He=C({Id:c,SubscriptionId:a,VssId:a,EventId:a,DropdownItems:o(E(yt)),IdPerson:a,ShowAsRadioButtons:M,Value:o(c)}),Vt=C({Id:a,CurrentWorkProgressId:o(c||o(a)),EventId:o(a),PersonId:o(a),Status:c,StatusId:o(a),IsOkay:o(M),IsQueued:o(M),EventDesignation:o(c),EventInformation:o(c||a),EventNotes:o(c||a),CheckPersonalInformation:o(M),CorrespondencePersonId:o(a),CorrespondenceAddressTypeId:o(c||a),Billing1PersonId:o(a),Billing1AddressTypeId:o(c||a),Billing2PersonId:o(c||a),Billing2AddressTypeId:o(c||a),KindOfPaymentId1:o(c||a),KindOfPaymentEmail1:o(c||a),KindOfPaymentId2:o(c||a),KindOfPaymentEmail2:o(c||a),IdObject:o(a),IdSubscription:o(a),IdStatus:o(a),AnsweredQuestions:o(c||a),Messages:o(c||a),SubscriptionDetails:o(E(He)),HRef:o(c)});var Ht=(()=>{let t=class t extends de{constructor(e,n){super(e,n,He,"Subscriptions")}getIdSubscriptionsByStudentAndCourse(e,n){return this.http.get(`${this.settings.apiUrl}/Subscriptions/?filter.PersonId==${e}&filter.EventId=;${n}`).pipe(G(Q(Vt)))}};t.\u0275fac=function(n){return new(n||t)(_(se),_(q))},t.\u0275prov=N({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();var hi=C({Id:a,Designation:c}),Le=C({Id:a,Grades:E(hi)});var Lt=(()=>{let t=class t extends de{constructor(e,n){super(e,n,Le,"GradingScales")}getGradingScale(e){return this.http.get(`${this.baseUrl}/${e}`).pipe(G(oe(Le)))}getGradingScales(e){return ge(e.map(this.getGradingScale.bind(this)))}};t.\u0275fac=function(n){return new(n||t)(_(se),_(q))},t.\u0275prov=N({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();var Ee=(()=>{let t=class t{constructor(e,n,s,f,T,j){this.coursesRestService=e,this.subscriptionRestService=n,this.reportsService=s,this.loadingService=f,this.gradingScalesRestService=T,this.settings=j,this.studentId$=new pe(1),this.initialStudentCourses$=this.studentId$.pipe(ze(),G(this.loadCourses.bind(this)),I(h=>h.sort((S,J)=>S.Designation.localeCompare(J.Designation))),$e(1)),this.action$=new pe(1),this.studentCourses$=qe(this.action$,this.initialStudentCourses$.pipe(I(h=>({type:"initializeCourses",payload:h})))).pipe(Xe(this.coursesReducer.bind(this),[]),$e(1)),this.loading$=this.loadingService.loading$,this.studentCourseIds$=this.studentCourses$.pipe(I(h=>h.flatMap(S=>S.Id))),this.idSubscriptions$=ce([this.studentId$,this.studentCourseIds$]).pipe(G(([h,S])=>this.subscriptionRestService.getIdSubscriptionsByStudentAndCourse(h,S))),this.ids$=this.idSubscriptions$.pipe(I(h=>h.map(S=>S.Id))),this.testReports$=this.ids$.pipe(I(h=>this.reportsService.getTeacherSubscriptionReports(h))),this.tests$=this.studentCourses$.pipe(I(h=>h.flatMap(S=>S.Tests).filter(Ce))),this.gradingScaleIdsFromTests$=this.tests$.pipe(I(h=>[...h.map(S=>S.GradingScaleId)].filter(Ce).filter(ye))),this.gradingScaleIdsFromCourses$=this.studentCourses$.pipe(I(h=>h.flatMap(S=>S.GradingScaleId).filter(Ce).filter(ye))),this.gradingScaleIds$=ce([this.gradingScaleIdsFromCourses$,this.gradingScaleIdsFromTests$]).pipe(I(([h,S])=>h.concat(S).filter(ye))),this.gradingScales$=this.gradingScaleIds$.pipe(G(h=>ge(h.map(S=>this.gradingScalesRestService.getGradingScale(S)))))}setStudentId(e){this.studentId$.next(e)}getFinalGradeForStudent(e,n){return e?.FinalGrades?.find(s=>s.StudentId===n)}getGradingForStudent(e,n){return e?.Gradings?.find(s=>s.StudentId===n)}getGradingScaleOfCourse(e,n){return n?.find(s=>s.Id===e.GradingScaleId)}getGradesForStudent(e,n,s){return e.Tests?.flatMap(f=>({value:Number(Ge(f,s)?.Grades.find(j=>j.Id===X(n,f)?.GradeId)?.Designation),weight:f.Weight})).filter(({value:f})=>!!f)||[]}updateStudentCourses(e){this.action$.next({type:"updateCourses",payload:e})}loadCourses(e){return this.loadingService.load(this.coursesRestService.getExpandedCoursesForDossier().pipe(I(n=>n.filter(s=>s.ParticipatingStudents?.find(f=>f.Id===e)))))}coursesReducer(e,n){switch(n.type){case"initializeCourses":return n.payload;case"updateCourses":return this.updateCourses([...e],n.payload);default:return e}}updateCourses(e,n){return e.map(s=>U(L({},s),{Tests:s.Tests!==null?s.Tests.map(f=>f.Id===n.Id?n:f):null}))}};t.\u0275fac=function(n){return new(n||t)(_(_e),_(Ht),_(Pt),_(Et),_(Lt),_(q))},t.\u0275prov=N({token:t,factory:t.\u0275fac});let i=t;return i})();var Wt=(()=>{let t=class t{constructor(e){this.modal=e}open(...e){let n=this.modal.open(...e);return this.applyPortalOffsetAndMaxHeight(n),this.disablePortalScrolling(n),n}get activeInstances(){return this.modal.activeInstances}dismissAll(...e){return this.modal.dismissAll(...e)}hasOpenModals(...e){return this.modal.hasOpenModals(...e)}applyPortalOffsetAndMaxHeight(e){let n=this.getModalWindowElement(e);if(!n){console.warn("Trying to apply portal offset to <ngb-modal-window>, but element is not present!");return}this.portalWindow&&(n.style.top=`${this.getModalIframeOffset()}px`,n.style.maxHeight=`${this.getModalHeight()}px`)}disablePortalScrolling(e){if(this.portalWindow&&this.portalDocument){let n=this.portalWindow.innerWidth-this.portalDocument.clientWidth;this.portalDocument.style.paddingRight=`${n}px`,this.portalDocument.style.overflow="hidden"}e.hidden.subscribe(()=>{this.portalDocument&&(this.portalDocument.style.paddingRight="0px",this.portalDocument.style.overflow="auto")})}getModalWindowElement(e){return e._windowCmptRef?.instance?._elRef?.nativeElement??null}getModalIframeOffset(){return Math.max(this.getViewportTop()-this.getIframeTop(),0)}getIframeTop(){return this.portalQuerySelector("bkd-content")?.shadowRoot?.querySelector("iframe")?.offsetTop??0}getIFrameBottom(){let e=this.portalQuerySelector("bkd-content")?.shadowRoot?.querySelector("iframe");return e?e.offsetTop+e.offsetHeight:0}getModalTop(){return Math.max(this.getViewportTop(),this.getIframeTop())}getModalBottom(){return Math.min(this.getViewportBottom(),this.getIFrameBottom())}getModalHeight(){return this.getModalBottom()-this.getModalTop()}getViewportTop(){return this.portalWindow?.scrollY??0}getViewportBottom(){return this.getViewportTop()+this.getViewportHeight()}getViewportHeight(){return this.portalWindow?.innerHeight??0}portalQuerySelector(e){return this.portalWindow?.document?.querySelector("bkd-portal")?.shadowRoot?.querySelector(e)??null}get portalDocument(){return this.portalWindow?.document.documentElement??null}get portalWindow(){return window.parent===window?null:window.parent}};t.\u0275fac=function(n){return new(n||t)(_(Ct))},t.\u0275prov=N({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();function Pe(i,t,r){return t?t.Grade:vi(i,r)||i?.GradeValue}function vi(i,t){return t?.Grades.find(r=>r.Id===i?.GradeId)?.Designation}var xi="1-3",qt="\u2013",Qt=(()=>{let t=class t{constructor(e){this.locale=e}transform(e,n,s){let f=Number(e??null);return isNaN(f)?qt:Ci(Number(e??null),s??this.locale,n)}};t.\u0275fac=function(n){return new(n||t)(w(et,16))},t.\u0275pipe=Y({name:"decimalOrDash",type:t,pure:!0,standalone:!0});let i=t;return i})();function Ci(i,t,r){return i===0?qt:tt(i,t,`1.${yi(r)}`)}function yi(i){return i?String(i).includes("-")?String(i):`${i}-${i}`:xi}var zt=(()=>{let t=class t{constructor(){}getGradeForStudent(){return Pe(this.grading,this.finalGrade,this.gradingScale)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=D({type:t,selectors:[["bkd-dossier-grades-final-grade"]],inputs:{finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},standalone:!0,features:[$],decls:14,vars:11,consts:[[1,"final-entry"],["data-testid","final-grade"],["data-testid","average-test-results"]],template:function(n,s){n&1&&(p(0,"div",0)(1,"div"),u(2),g(3,"translate"),l(),p(4,"div",1)(5,"span"),u(6),l()(),p(7,"div"),u(8),g(9,"translate"),l(),p(10,"div",2)(11,"span"),u(12),g(13,"decimalOrDash"),l()()()),n&2&&(d(2),P(b(3,4,"dossier.grade")),d(4),P(s.getGradeForStudent()||"\u2013"),d(2),P(b(9,6,"dossier.average")),d(4),P(K(13,8,s.average,"1-3")))},dependencies:[k,F,Qt],styles:[".final-entry[_ngcontent-%COMP%]{padding:1rem;display:grid;grid-template-columns:repeat(2,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}"]});let i=t;return i})();var Xt=(()=>{let t=class t{constructor(e){this.translate=e}transform(e,n,s,f="tests.points"){return e.IsPointGrading&&(e.IsPublished||s)?`${X(n,e)?.Points||"\u2013"} / ${e.MaxPointsAdjusted||e.MaxPoints} ${this.translate.instant(f)}`:""}};t.\u0275fac=function(n){return new(n||t)(w(xe,16))},t.\u0275pipe=Y({name:"bkdTestPoints",type:t,pure:!0,standalone:!0});let i=t;return i})();var Jt=(()=>{let t=class t{constructor(e){this.translate=e}transform(e){return`${this.translate.instant("tests.factor")} ${e.Weight} (${e.WeightPercent}%)`}};t.\u0275fac=function(n){return new(n||t)(w(xe,16))},t.\u0275pipe=Y({name:"bkdTestWeight",type:t,pure:!0,standalone:!0});let i=t;return i})();var Ti=i=>({maxPoints:i});function _i(i,t){if(i&1&&(p(0,"div",15),u(1),g(2,"translate"),l()),i&2){let r=v(2);d(),x(" ",K(2,1,"global.validation-errors.invalidPoints",Ye(4,Ti,r.maxPoints))," ")}}function Gi(i,t){if(i&1){let r=ie();p(0,"div",11)(1,"label",12),u(2),g(3,"translate"),l(),p(4,"div",6)(5,"input",13,0),A("input",function(){Z(r);let n=V(6),s=v();return ee(s.onPointsChange(n.value))}),l()(),y(7,_i,3,6,"div",14),l()}if(i&2){let r=v();d(2),P(b(3,8,"dossier.dialog.points")),d(2),Re("is-invalid",r.pointsInput.errors),d(),Re("is-invalid",r.pointsInput.errors),Ie("max",r.maxPoints),m("formControl",r.pointsInput),d(2),m("ngIf",r.pointsInput.errors)}}var Yt=500,Zt=(()=>{let t=class t{constructor(e,n){this.activeModal=e,this.courseService=n,this.maxPoints=0,this.gradeSubject$=new me,this.pointsSubject$=new me,this.closeButtonDisabled$=new B(!1),this.gradingScaleDisabled$=new B(!0),this.grade$=this.gradeSubject$.pipe(we(Yt)),this.points$=this.pointsSubject$.pipe(we(Yt),Qe(this.isValid.bind(this)),I(Number)),this.destroy$=new me}ngOnInit(){this.maxPoints=Ae(this.test),this.pointsInput=new at({value:this.points,disabled:!1},[Fe.min(0),Fe.pattern("[0-9]+([\\.][0-9]+)?"),this.maxPointValidator()]),this.gradingScaleDisabled$.next(this.test.IsPointGrading&&this.points>0),this.points$.pipe(Me(this.destroy$)).subscribe(e=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,points:e})),this.grade$.pipe(Me(this.destroy$)).subscribe(e=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,gradeId:e}))}onGradeChange(e){this.gradeSubject$.next(e)}onPointsChange(e){this.pointsSubject$.next(e),this.gradingScaleDisabled$.next(e.length>0)}updateTestResult(e){this.closeButtonDisabled$.next(!0),this.courseService.updateTestResult(this.test.CourseId,e).subscribe(({testResult:n})=>{this.gradeId=n?.GradeId??null,this.updatedTestResult=n,this.closeButtonDisabled$.next(!1)})}isValid(e){return e===""||isNaN(Number(e))?!1:!(Number(e)<0||Number(e)>this.maxPoints)}maxPointValidator(){return e=>Number(e.value)>Ae(this.test)?{customMax:!0}:null}};t.\u0275fac=function(n){return new(n||t)(w(xt),w(_e))},t.\u0275cmp=D({type:t,selectors:[["bkd-dossier-grades-edit"]],inputs:{test:"test",gradeId:"gradeId",gradeOptions:"gradeOptions",points:"points",studentId:"studentId"},standalone:!0,features:[$],decls:19,vars:20,consts:[["pointInput",""],[1,"modal-body"],[1,"mb-4"],["class","form-group row",4,"ngIf"],[1,"form-group","row","mt-2"],["for","grade",1,"col-6","col-form-label"],[1,"col-6"],["id","grade",3,"valueChange","options","value","allowEmpty","disabled"],[1,"text-muted","mt-4"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"form-group","row"],["for","points",1,"col-6","col-form-label"],["id","points","type","number","step","0.01","min","0",1,"form-control",3,"input","max","formControl"],["class","invalid-feedback col-6 offset-6","data-testid","validation-error-message",4,"ngIf"],["data-testid","validation-error-message",1,"invalid-feedback","col-6","offset-6"]],template:function(n,s){n&1&&(p(0,"div",1)(1,"p",2),u(2),l(),y(3,Gi,8,10,"div",3),p(4,"div",4)(5,"label",5),u(6),g(7,"translate"),l(),p(8,"div",6)(9,"bkd-select",7),g(10,"async"),A("valueChange",function(T){return T&&s.onGradeChange(T)}),l()()(),p(11,"p",8),u(12),g(13,"translate"),l()(),p(14,"div",9)(15,"button",10),g(16,"async"),A("click",function(){return s.activeModal.close(s.updatedTestResult)}),u(17),g(18,"translate"),l()()),n&2&&(d(2),P(s.test.Designation),d(),m("ngIf",s.test.IsPointGrading),d(3),P(b(7,10,"dossier.dialog.grade")),d(3),m("options",s.gradeOptions)("value",s.gradeId)("allowEmpty",!1)("disabled",b(10,12,s.gradingScaleDisabled$)),d(3),x(" ",b(13,14,s.test.IsPointGrading?"dossier.dialog.hint.points":"dossier.dialog.hint.grade")," "),d(3),m("disabled",b(16,16,s.closeButtonDisabled$)),d(2),x(" ",b(18,18,"dossier.dialog.close")," "))},dependencies:[O,ve,st,dt,Se,gt,mt,ft,lt,Dt,H,k,F]});let i=t;return i})();function Ei(i,t){if(i&1){let r=ie();p(0,"a",11),A("click",function(){Z(r);let n=v().bkdLet,s=v();return ee(s.editGrading(n))}),p(1,"i",12),u(2,"edit"),l(),p(3,"span",13),u(4),g(5,"async"),l()()}if(i&2){let r=v(2);d(4),P(b(5,1,r.grading$))}}function Pi(i,t){if(i&1&&(p(0,"span",13),u(1),g(2,"async"),l()),i&2){let r=v(2);d(),P(b(2,1,r.grading$))}}function Di(i,t){if(i&1&&(p(0,"div",14),u(1),g(2,"translate"),l()),i&2){let r=v().bkdLet;d(),x(" ",b(2,1,r.IsPublished?"tests.published":"tests.not-published")," ")}}function wi(i,t){if(i&1&&(p(0,"div",2)(1,"div",3),u(2),l(),p(3,"div",4),u(4),g(5,"date"),l(),p(6,"div",5),y(7,Ei,6,3,"a",6)(8,Pi,3,3,"ng-template",null,0,ne),l(),p(10,"div",7),u(11),g(12,"bkdTestWeight"),l(),p(13,"div",8)(14,"span"),u(15),g(16,"bkdTestPoints"),l()(),p(17,"div",9),u(18),l(),y(19,Di,3,3,"div",10),l()),i&2){let r=t.bkdLet,e=V(9),n=v();d(2),x(" ",r.Designation," "),d(2),x(" ",K(5,8,r.Date,"dd.MM.yyyy")," "),d(3),m("ngIf",n.isEditable&&r.IsOwner)("ngIfElse",e),d(4),x(" ",b(12,11,r)," "),d(4),P(Ze(16,13,r,n.studentId,n.isEditable,"dossier.points")),d(3),x(" ",r.Owner," "),d(),m("ngIf",n.isEditable)}}var ei=(()=>{let t=class t{constructor(e,n){this.gradeService=e,this.modalService=n,this.test$=new pe(1),this.grading$=this.test$.pipe(I(this.getGrading.bind(this)))}ngOnChanges(e){e.test&&this.test$.next(this.test)}editGrading(e){let n=this.modalService.open(Zt,{backdrop:"static"});n.componentInstance.test=e,n.componentInstance.gradeId=this.getGradeId(e),n.componentInstance.gradeOptions=t.mapToOptions(this.gradingScale),n.componentInstance.studentId=this.studentId,n.componentInstance.points=this.getPoints(e),n.result.then(s=>{s&&this.updateStudentGrade(s,e)},()=>{})}updateStudentGrade(e,n){let s=Ve(e,n);this.gradeService.updateStudentCourses(s)}getGrading(e){return this.gradingScale?.Grades.find(n=>n.Id===this.getGradeId(e))?.Designation||"\u2013"}getGradeId(e){return X(this.studentId,e)?.GradeId||null}getPoints(e){return X(this.studentId,e)?.Points||null}static mapToOptions(e){return e?.Grades.map(n=>({Key:n.Id,Value:n.Designation}))||null}};t.\u0275fac=function(n){return new(n||t)(w(Ee),w(Wt))},t.\u0275cmp=D({type:t,selectors:[["bkd-dossier-single-test"]],inputs:{test:"test",studentId:"studentId",gradingScale:"gradingScale",isEditable:"isEditable"},standalone:!0,features:[W,$],decls:2,vars:3,consts:[["notEditable",""],["class","test-entry",4,"bkdLet"],[1,"test-entry"],["data-testid","test-designation",1,"designation"],["data-testid","test-date",1,"date"],[1,"grade"],["class","btn btn-link","aria-label","edit grade",3,"click",4,"ngIf","ngIfElse"],["data-testid","test-factor",1,"factor"],["data-testid","test-points",1,"points"],["data-testid","test-teacher",1,"teacher"],["class","state","data-testid","test-status",4,"ngIf"],["aria-label","edit grade",1,"btn","btn-link",3,"click"],["data-testid","test-grade-edit-icon",1,"material-icons"],["data-testid","test-grade"],["data-testid","test-status",1,"state"]],template:function(n,s){n&1&&(y(0,wi,20,18,"div",1),g(1,"async")),n&2&&m("bkdLet",b(1,1,s.test$))},dependencies:[Te,O,H,it,k,F,Xt,Jt],styles:['.test-entry[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1rem;display:grid;grid-template-areas:"designation designation grade factor" "date date points ." "teacher teacher . ." "state state . .";grid-template-columns:repeat(4,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}.designation[_ngcontent-%COMP%]{grid-area:designation}.date[_ngcontent-%COMP%]{grid-area:date}.grade[_ngcontent-%COMP%]{grid-area:grade}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;color:#000;padding:0;text-decoration:none}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.grade[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:-1em;color:#00000080}.points[_ngcontent-%COMP%]{grid-area:points;color:#00000080}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.state[_ngcontent-%COMP%]{grid-area:state}@media (max-width: 575.98px){.test-entry[_ngcontent-%COMP%]{grid-template-areas:"designation designation" "date grade" "factor points" "teacher teacher" "state state";grid-template-columns:repeat(2,1fr)}}']});let i=t;return i})();function $i(i,t){if(i&1&&te(0,"bkd-dossier-single-test",5),i&2){let r=t.$implicit,e=v(3);m("test",r)("studentId",e.studentId)("gradingScale",e.getGradingScaleOfTest(r))("isEditable",e.isEditable)}}function Mi(i,t){if(i&1&&(p(0,"div"),te(1,"bkd-dossier-grades-final-grade",3),y(2,$i,1,4,"bkd-dossier-single-test",4),l()),i&2){let r=v().bkdLet,e=v();d(),m("finalGrade",e.decoratedCourse.finalGrade)("grading",e.decoratedCourse.grading)("gradingScale",e.decoratedCourse.gradingScale)("average",e.decoratedCourse.average),d(),m("ngForOf",r)}}function Ri(i,t){i&1&&(p(0,"p",6),u(1),g(2,"translate"),l()),i&2&&(d(),x(" ",b(2,1,"dossier.no-tests")," "))}function Oi(i,t){if(i&1&&(fe(0),y(1,Mi,3,5,"div",2)(2,Ri,3,3,"ng-template",null,0,ne),he()),i&2){let r=t.bkdLet,e=V(3);d(),m("ngIf",r.length>0)("ngIfElse",e)}}var ti=(()=>{let t=class t{ngOnChanges(e){e.decoratedCourse&&this.sortedTests$.next(this.sortedTests())}constructor(){this.sortedTests$=new B([])}sortedTests(){return this.decoratedCourse.course.Tests?At(this.decoratedCourse.course.Tests):[]}getGradingScaleOfTest(e){return Ge(e,this.gradingScales)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=D({type:t,selectors:[["bkd-dossier-course-tests"]],inputs:{studentId:"studentId",decoratedCourse:"decoratedCourse",gradingScales:"gradingScales",isEditable:"isEditable"},standalone:!0,features:[W,$],decls:2,vars:3,consts:[["noTests",""],[4,"bkdLet"],[4,"ngIf","ngIfElse"],[3,"finalGrade","grading","gradingScale","average"],[3,"test","studentId","gradingScale","isEditable",4,"ngFor","ngForOf"],[3,"test","studentId","gradingScale","isEditable"],["data-testid","message-no-tests",1,"p-3"]],template:function(n,s){n&1&&(y(0,Oi,4,2,"ng-container",1),g(1,"async")),n&2&&m("bkdLet",b(1,1,s.sortedTests$))},dependencies:[Te,O,zt,re,ei,H,k,F]});let i=t;return i})();function Fi(i,t){if(i&1&&(p(0,"span",2),u(1),l()),i&2){let r=v();d(),x(" (",r.grade,")")}}function ki(i,t){if(i&1&&(p(0,"span",3),u(1),g(2,"number"),l()),i&2){let r=v();d(),x(" (",K(2,1,r.average,"1.1-3"),")")}}var ii=(()=>{let t=class t{constructor(){}get grade(){return this.getGradeForStudent()}getGradeForStudent(){return Pe(this.grading,this.finalGrade,this.gradingScale)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=D({type:t,selectors:[["bkd-dossier-grades-course-header"]],inputs:{designation:"designation",finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},standalone:!0,features:[$],decls:3,vars:3,consts:[["class","grade","data-testId","grade",4,"ngIf"],["class","average","data-testId","average",4,"ngIf"],["data-testId","grade",1,"grade"],["data-testId","average",1,"average"]],template:function(n,s){n&1&&(u(0),y(1,Fi,2,1,"span",0)(2,ki,3,4,"span",1)),n&2&&(P(s.designation),d(),m("ngIf",s.grade),d(),m("ngIf",!s.grade&&s.average))},dependencies:[O,nt],styles:[".average[_ngcontent-%COMP%]{color:#00000080}"]});let i=t;return i})();function ji(i,t){if(i&1&&te(0,"bkd-dossier-course-tests",11),i&2){let r=v().$implicit,e=v(2);m("decoratedCourse",r)("studentId",e.studentId)("gradingScales",e.gradingScales)("isEditable",e.isEditable)}}function Bi(i,t){if(i&1){let r=ie();p(0,"div")(1,"div",4)(2,"div",5,1)(4,"div",6)(5,"bkd-student-dossier-entry-header",7),A("click",function(){Z(r);let n=V(3);return ee(n.toggle())}),te(6,"bkd-dossier-grades-course-header",8),l()(),p(7,"div",9)(8,"div",10),y(9,ji,1,4,"ng-template"),l()()()()()}if(i&2){let r=t.$implicit,e=V(3);d(5),m("opened",!e.collapsed),d(),m("designation",r.course.Designation)("finalGrade",r.finalGrade)("grading",r.grading)("gradingScale",r.gradingScale)("average",r.average)}}function Ni(i,t){if(i&1&&(fe(0),y(1,Bi,10,6,"div",3),g(2,"async"),he()),i&2){let r=v();d(),m("ngForOf",b(2,2,r.decoratedCoursesSubject$))("ngForTrackBy",r.trackByCourseId)}}function Ai(i,t){i&1&&(p(0,"p",12),u(1),g(2,"translate"),l()),i&2&&(d(),x(" ",b(2,1,"dossier.no-courses")," "))}var Ar=(()=>{let t=class t{constructor(e){this.dossierGradeService=e,this.isEditable=!0,this.decoratedCoursesSubject$=new B([])}ngOnChanges(){this.decoratedCoursesSubject$.next(this.decorateCourses())}trackByCourseId(e,n){return n.course.Id}decorateCourses(){return this.courses?.map(e=>{let n=this.dossierGradeService.getFinalGradeForStudent(e,this.studentId),s=this.dossierGradeService.getGradesForStudent(e,this.studentId,this.gradingScales);return{course:e,finalGrade:n,grading:this.dossierGradeService.getGradingForStudent(e,this.studentId),gradingScale:this.dossierGradeService.getGradingScaleOfCourse(e,this.gradingScales),average:n?.AverageTestResult||Bt(s)}})}};t.\u0275fac=function(n){return new(n||t)(w(Ee))},t.\u0275cmp=D({type:t,selectors:[["bkd-dossier-grades-view"]],inputs:{courses:"courses",studentId:"studentId",gradingScales:"gradingScales",isEditable:"isEditable"},standalone:!0,features:[W,$],decls:3,vars:2,consts:[["noCourses",""],["courses","ngbAccordionItem"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf","ngForTrackBy"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],[3,"designation","finalGrade","grading","gradingScale","average"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[3,"decoratedCourse","studentId","gradingScales","isEditable"],["data-testid","message-no-courses",1,"py-3"]],template:function(n,s){if(n&1&&y(0,Ni,3,4,"ng-container",2)(1,Ai,3,3,"ng-template",null,0,ne),n&2){let f,T=V(2);m("ngIf",((f=s.courses==null?null:s.courses.length)!==null&&f!==void 0?f:0)>0)("ngIfElse",T)}},dependencies:[O,re,vt,St,bt,_t,ii,It,ht,ti,H,k,F]});let i=t;return i})();export{Ne as a,In as b,bn as c,Sn as d,vn as e,xn as f,Cn as g,yn as h,At as i,qt as j,Qt as k,Ci as l,Dt as m,wt as n,je as o,_e as p,He as q,Ht as r,Lt as s,Ee as t,Wt as u,Ar as v};
