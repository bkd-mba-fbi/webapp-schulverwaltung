import{a as _t,c as Gt,d as Pt}from"./chunk-46SLORKT.js";import{a as yt}from"./chunk-R3WE23RA.js";import{a as Tt}from"./chunk-Y4QYVF5K.js";import{e as we,p as Fe}from"./chunk-QPPZNX2W.js";import{a as Dt,c as $t}from"./chunk-5LWQSVPQ.js";import{a as be}from"./chunk-GXDMQ7LQ.js";import{a as Y,b as se}from"./chunk-3F6JOQLC.js";import{c as Ct,d as St,e as bt,f as It,g as vt,r as xt}from"./chunk-LJEFSGQD.js";import{b as Ie,h as ve}from"./chunk-DQAQYQ7K.js";import{d as nt,h as ce,x as ge,z as fe}from"./chunk-U63TE7M4.js";import{$b as F,$d as he,Ac as pe,Ad as o,Bd as T,C as He,Cb as v,Cd as ue,Ec as u,Ed as P,Fc as h,Fd as b,G as We,Ga as qe,Gc as V,Gd as me,H as Xe,Hc as Qe,Ib as y,Id as rt,Jd as Re,Kb as Ee,Kc as Ye,O as Pe,Ob as x,Od as c,Pd as st,Rb as z,S as Ke,Sb as q,Tb as l,Ub as d,Ud as A,Vb as J,Y as ze,Yd as at,Zb as Q,_ as De,_d as Me,a as R,ac as C,b as M,ba as _,bd as Ze,c as Le,ce as ot,da as $e,dc as le,dd as et,de as dt,fd as O,fe as lt,gd as tt,he as pt,id as it,j as de,ja as H,jb as s,k as w,l as ee,lc as ie,le as ct,mc as p,me as ut,nc as D,ne as mt,oc as S,oe as gt,pa as g,pe as ft,q as Ge,r as Ue,te as Ce,ue as ht,v as f,va as k,vc as ne,w as te,wa as W,wb as G,wc as re,we as Se,xa as X,xc as B,xe as $,zb as K,zc as Je,zd as m}from"./chunk-D6CA3SC5.js";var Et=b({Id:o,AddressLine1:c(m),AddressLine2:st(m),Birthdate:c(A),DisplayEmail:c(m),FirstName:m,FullName:m,Gender:rt([ue("M"),ue("F"),ue("X")]),IsActive:T,LastName:m,Location:c(m),PersonId:o,PhoneMobile:c(m),PhonePrivate:c(m),PostalCode:c(m),RegistrationDate:A,RegistrationId:o});var Rt=b({Id:o,Designation:m,StudentCount:o,Number:m});var Oe=b({Id:m,TestId:o,CourseRegistrationId:o,GradeId:c(o),GradeValue:c(o),GradeDesignation:c(m),Points:c(o),StudentId:o});var Mt=b({Id:o,CourseId:o,Date:A,Designation:m,Weight:o,WeightPercent:o,IsPointGrading:T,MaxPoints:c(o),MaxPointsAdjusted:c(o),IsPublished:T,IsOwner:T,Owner:c(m),GradingScaleId:c(o),Results:c(P(Oe))});var wt=b({Id:o}),Ft=me({HRef:c(m)}),ii=me({HasEvaluationStarted:T,EvaluationUntil:c(A),HasReviewOfEvaluationStarted:T,HasTestGrading:T,Id:o}),ni=Re([wt,Ft,ii]),ri=me({Id:o,StudentCount:o}),si=Re([wt,Ft,ri]),ai=b({Grade:m,AverageTestResult:o,Id:o,StudentId:o}),Ae=b({AverageTestResult:o,CanGrade:T,EventId:o,GradeId:c(o),GradeValue:c(o),Id:o,StudentId:o}),j=b({HRef:m,Id:o,Number:m,Designation:m,DateFrom:c(A),DateTo:c(A),StatusId:o,GradingScaleId:c(o),FinalGrades:c(P(ai)),Gradings:c(P(Ae)),Tests:c(P(Mt)),EvaluationStatusRef:ni,AttendanceRef:si,Participants:c(P(Et)),ParticipatingStudents:c(P(_t)),Classes:c(P(Rt))}),Ot=b(ge(j.props,["Id","Designation","GradingScaleId","Classes","AttendanceRef"])),At=b({TestResults:P(Oe),Gradings:P(Ae)}),Nt=b({Gradings:P(Ae)});var xe=(()=>{class t extends be{constructor(){let e=g(ce),i=g(fe);super(e,i,j,"Courses"),this.statusCodec=b(ge(this.codec.props,["Id","StatusId","EvaluationStatusRef"]))}getNumberOfCoursesForRating(){return this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef&fields=Id,StatusId,EvaluationStatusRef&filter.StatusId=;10300;10240`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe(_(se(this.statusCodec)),f(e=>e.filter(i=>i.EvaluationStatusRef.HasEvaluationStarted===!0)),f(e=>e.length))}getExpandedCourses(e){return Tt(e,"TeacherRole")?this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef,AttendanceRef,Classes,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe(_(se(j))):Ge([])}getExpandedCourse(e){return this.http.get(`${this.baseUrl}/${e}?expand=ParticipatingStudents,EvaluationStatusRef,Tests,Gradings,FinalGrades,Classes`).pipe(_(Y(j)))}getExpandedCourseWithParticipants(e){return this.http.get(`${this.baseUrl}/${e}?expand=Participants,Classes,AttendanceRef`).pipe(_(Y(j)))}getExpandedCoursesForDossier(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades,EvaluationStatusRef,ParticipatingStudents,Classes&filter.StatusId=;${this.settings.eventlist.statusfilter}`).pipe(_(se(j)))}getExpandedCoursesForStudent(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"StudentRole"}}).pipe(_(se(j)))}getCourseWithStudentCount(e,i={}){let n=new nt().set("fields","Id,Designation,GradingScaleId").set("expand","Classes,AttendanceRef");return this.http.get(`${this.baseUrl}/${e}`,M(R({},i),{params:n})).pipe(_(Y(Ot)))}add(e,i,n,a,I,N,Z){let U={Tests:[{Date:Fe(we(i),"yyyy-MM-dd'T'HH:mm:ss"),Designation:n,Weight:a,IsPointGrading:I,MaxPoints:N,MaxPointsAdjusted:Z}]};return this.http.put(`${this.baseUrl}/${e}/Tests/New`,U).pipe(f(()=>{}))}update(e,i,n,a,I,N,Z,U){let oe={Tests:[{Id:i,Designation:n,Date:Fe(we(a),"yyyy-MM-dd'T'HH:mm:ss"),Weight:I,IsPointGrading:N,MaxPoints:Z,MaxPointsAdjusted:U}]};return this.http.put(`${this.baseUrl}/${e}/Tests/Update`,oe).pipe(f(()=>{}))}delete(e,i){let n={TestIds:[i]};return this.http.put(`${this.baseUrl}/${e}/Tests/Delete`,n).pipe(f(()=>i))}updateTestResult(e,i){let U=i,{studentId:n,testId:a}=U,I=Le(U,["studentId","testId"]),N={StudentIds:[n],TestId:a},Z="gradeId"in I?M(R({},N),{GradeId:I.gradeId}):M(R({},N),{Points:I.points});return this.http.put(`${this.baseUrl}/${e}/SetTestResult`,Z).pipe(_(Y(At)),_(({TestResults:oe,Gradings:je})=>oe.length<=1&&je.length===1?Ge({courseId:e,testResult:oe[0]??null,grading:je[0]}):Ue(()=>new Error("`TestResults` or `Gradings` does not contain a single value"))))}setAverageAsFinalGrade(e){return this.http.put(`${this.baseUrl}/SetAverageTestResult`,e).pipe(_(Y(Nt)))}publishTest(e){let i={TestIds:[e]};return this.http.put(`${this.baseUrl}/PublishTest`,i).pipe(f(()=>e))}unpublishTest(e){let i={TestIds:[e]};return this.http.put(`${this.baseUrl}/UnpublishTest`,i).pipe(f(()=>e))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=H({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function kt(t){return t.length===0?0:Ne(t.map(({value:r,weight:e})=>r*e))/Ne(t.map(({weight:r})=>r))}function ke(t){return t.length===0?0:Number(Ne(t)/t.length)}function Ne(t){return t.reduce(oi,0)}function oi(t,r){return t+r}function gn(t,r,e){return t?t.Tests?.reduce((i,n)=>i||n.Id===r&&n.Results?.find(a=>a.TestId===r&&a.StudentId===e)||null,null)??null:null}function fn(t,r,e){return r.map(i=>i.Id===t.TestId?Ve(t,i,e):i)}function hn(t,r,e){return e.map(i=>i.Id===t?di(r,i):i)}function Cn(t,r){return r.map(e=>e.Id===t?M(R({},e),{IsPublished:!e.IsPublished}):e)}function Sn(t){let r=pi(t);if(r.length===0)throw new Error("unable to calculate averages without results");return ke(r)}function Be(t){return t.MaxPointsAdjusted||t.MaxPoints}function bn(t){let r=li(t);if(r.length===0)throw new Error("unable to calculate averages without results");return ke(r)}function L(t,r){return r.Results?.find(e=>e.StudentId===t)}function In(t,r){return r===null?null:r.filter(e=>e.Id!==t)}function Ve(t,r,e){let i=e&&r.Results?.find(a=>a.TestId===t.TestId&&a.StudentId===t.StudentId),n=r.Results?.filter(a=>!(a.TestId===t.TestId&&a.StudentId===t.StudentId))||[];return i&&e==="grade"?t.GradeId=i.GradeId:i&&e==="points"&&(t.Points=i.Points),M(R({},r),{Results:[...n,t]})}function Vt(t){return t.slice().sort((r,e)=>e.Date.getTime()-r.Date.getTime())}function _e(t,r){return r?.find(e=>e.Id===t.GradingScaleId)||null}function di(t,r){return M(R({},r),{Results:r.Results?.filter(e=>e.StudentId!==t)||[]})}function li(t){return t.Results?.filter(r=>r.GradeDesignation!==null).map(r=>Number(r.GradeDesignation)).filter(r=>!isNaN(r))||[]}function pi(t){return t.Results?.map(r=>r.Points!==null?r.Points:Bt).filter(r=>r>Bt)||[]}var Bt=-1;var ci=b({Id:o,Designation:m,Value:o,Sufficient:T,Sort:c(m)}),jt=b({Id:o,CommentsAllowed:T,RisingGrades:T,Grades:P(ci)});var Lt=(()=>{class t extends be{constructor(){let e=g(ce),i=g(fe);super(e,i,jt,"GradingScales")}getListForIds(e){return He(e.map(i=>this.get(i)))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=H({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Ut="studentDossierGrades",ye=(()=>{class t{constructor(){this.coursesRestService=g(xe),this.subscriptionRestService=g(Dt),this.reportsService=g(Pt),this.loadingService=g(yt),this.gradingScalesRestService=g(Lt),this.studentId$=new ee(1),this.initialStudentCourses$=this.studentId$.pipe(Ke(),_(this.loadCourses.bind(this)),f(e=>e.sort((i,n)=>i.Designation.localeCompare(n.Designation))),De(1)),this.action$=new ee(1),this.studentCourses$=We(this.action$,this.initialStudentCourses$.pipe(f(e=>({type:"initializeCourses",payload:e})))).pipe(ze(this.coursesReducer.bind(this),[]),De(1)),this.loading$=this.loadingService.loading(Ut),this.studentCourseIds$=this.studentCourses$.pipe(f(e=>e.flatMap(i=>i.Id))),this.subscriptionIds$=te([this.studentId$,this.studentCourseIds$]).pipe(_(([e,i])=>this.subscriptionRestService.getSubscriptionIdsByStudentAndCourse(e,i))),this.testReports$=this.subscriptionIds$.pipe(f(e=>this.reportsService.getTeacherSubscriptionGradesReports(e))),this.tests$=this.studentCourses$.pipe(f(e=>e.flatMap(i=>i.Tests).filter(Ie))),this.gradingScaleIdsFromTests$=this.tests$.pipe(f(e=>[...e.map(i=>i.GradingScaleId)].filter(Ie).filter(ve))),this.gradingScaleIdsFromCourses$=this.studentCourses$.pipe(f(e=>e.flatMap(i=>i.GradingScaleId).filter(Ie).filter(ve))),this.gradingScaleIds$=te([this.gradingScaleIdsFromCourses$,this.gradingScaleIdsFromTests$]).pipe(f(([e,i])=>e.concat(i).filter(ve))),this.gradingScales$=this.gradingScaleIds$.pipe(_(e=>this.gradingScalesRestService.getListForIds(e)))}setStudentId(e){this.studentId$.next(e)}getFinalGradeForStudent(e,i){return e?.FinalGrades?.find(n=>n.StudentId===i)}getGradingForStudent(e,i){return e?.Gradings?.find(n=>n.StudentId===i)}getGradingScaleOfCourse(e,i){return i?.find(n=>n.Id===e.GradingScaleId)}getGradesForStudent(e,i,n){return e.Tests?.flatMap(a=>({value:Number(_e(a,n)?.Grades.find(N=>N.Id===L(i,a)?.GradeId)?.Designation),weight:a.Weight})).filter(({value:a})=>!!a)||[]}updateStudentCourses(e){this.action$.next({type:"updateCourses",payload:e})}loadCourses(e){return this.loadingService.load(this.coursesRestService.getExpandedCoursesForDossier().pipe(f(i=>i.filter(n=>n.ParticipatingStudents?.find(a=>a.Id===e)))),{context:Ut})}coursesReducer(e,i){switch(i.type){case"initializeCourses":return i.payload;case"updateCourses":return this.updateCourses([...e],i.payload);default:return e}}updateCourses(e,i){return e.map(n=>M(R({},n),{Tests:n.Tests!==null?n.Tests.map(a=>a.Id===i.Id?i:a):null}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=H({token:t,factory:t.\u0275fac})}}return t})();var mi=t=>({width:t}),gi=(t,r)=>r.Key;function fi(t,r){if(t&1&&(l(0,"option",1),p(1),u(2,"translate"),d()),t&2){let e=C();y("ngValue",null),s(),S(" ",h(2,2,e.emptyLabel)," ")}}function hi(t,r){if(t&1&&(l(0,"option",1),p(1),d()),t&2){let e=r.$implicit;y("ngValue",e),s(),S(" ",e.Value," ")}}var Ht=(()=>{class t{constructor(){this.options=[],this.allowEmpty=!0,this.emptyLabel="",this.value=null,this.disabled=!1,this.tabindex=0,this.width="auto",this.valueChange=new qe,this.options$=new w([]),this.rawValue$=new w(null),this.value$=te([this.rawValue$,this.options$]).pipe(f(([e,i])=>i&&i.find(n=>n.Key===e)||null))}ngOnChanges(e){e.value&&this.rawValue$.next(e.value.currentValue),e.options&&this.options$.next(e.options.currentValue)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=G({type:t,selectors:[["bkd-select"]],inputs:{options:"options",allowEmpty:"allowEmpty",emptyLabel:"emptyLabel",value:"value",disabled:"disabled",tabindex:"tabindex",width:"width"},outputs:{valueChange:"valueChange"},features:[k],decls:6,vars:9,consts:[[1,"form-select",3,"ngModelChange","tabindex","ngStyle","disabled","ngModel"],[3,"ngValue"]],template:function(i,n){i&1&&(l(0,"select",0),u(1,"async"),F("ngModelChange",function(I){return n.valueChange.emit(I&&I.Key)}),v(2,fi,3,4,"option",1),z(3,hi,2,2,"option",1,gi),p(5,` >
`),d()),i&2&&(le("tabindex",n.tabindex),y("ngStyle",pe(7,mi,n.width))("disabled",n.disabled)("ngModel",h(1,5,n.value$)),s(2),x(n.allowEmpty?2:-1),s(),q(n.options))},dependencies:[Ce,ut,mt,ct,he,dt,O,et,$],encapsulation:2,changeDetection:0})}}return t})();function Te(t,r,e){return r?r.Grade:Ci(t,e)||t?.GradeValue}function Ci(t,r){return r?.Grades.find(e=>e.Id===t?.GradeId)?.Designation}var Si="1-3",Xt="\u2013",Kt=(()=>{class t{constructor(){this.locale=g(Ye)}transform(e,i,n){let a=Number(e??null);return isNaN(a)?Xt:bi(Number(e??null),n??this.locale,i)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275pipe=K({name:"decimalOrDash",type:t,pure:!0})}}return t})();function bi(t,r,e){return t===0?Xt:Ze(t,r,`1.${Ii(e)}`)}function Ii(t){return t?String(t).includes("-")?String(t):`${t}-${t}`:Si}var zt=(()=>{class t{constructor(){}getGradeForStudent(){return Te(this.grading,this.finalGrade,this.gradingScale)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=G({type:t,selectors:[["bkd-dossier-grades-final-grade"]],inputs:{finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},decls:14,vars:11,consts:[[1,"final-entry"],["data-testid","final-grade"],["data-testid","average-test-results"]],template:function(i,n){i&1&&(l(0,"div",0)(1,"div"),p(2),u(3,"translate"),d(),l(4,"div",1)(5,"span"),p(6),d()(),l(7,"div"),p(8),u(9,"translate"),d(),l(10,"div",2)(11,"span"),p(12),u(13,"decimalOrDash"),d()()()),i&2&&(s(2),D(h(3,4,"dossier.grade")),s(4),D(n.getGradeForStudent()||"\u2013"),s(2),D(h(9,6,"dossier.average")),s(4),D(V(13,8,n.average,"1-3")))},dependencies:[$,Kt],styles:[".final-entry[_ngcontent-%COMP%]{padding:1rem;display:grid;grid-template-columns:repeat(2,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}"]})}}return t})();var qt=(()=>{class t{constructor(){this.translate=g(Se)}transform(e,i,n,a="tests.points"){return e.IsPointGrading&&(e.IsPublished||n)?`${L(i,e)?.Points||"\u2013"} / ${e.MaxPointsAdjusted||e.MaxPoints} ${this.translate.instant(a)}`:""}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275pipe=K({name:"bkdTestPoints",type:t,pure:!0})}}return t})();var Jt=(()=>{class t{constructor(){this.translate=g(Se)}transform(e){return`${this.translate.instant("tests.factor")} ${e.Weight} (${e.WeightPercent}%)`}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275pipe=K({name:"bkdTestWeight",type:t,pure:!0})}}return t})();var vi=t=>({maxPoints:t});function xi(t,r){if(t&1&&(l(0,"div",13),p(1),u(2,"translate"),d()),t&2){let e=C(2);s(),S(" ",V(2,1,"global.validation-errors.invalidPoints",pe(4,vi,e.maxPoints))," ")}}function _i(t,r){if(t&1){let e=Q();l(0,"div",3)(1,"label",11),p(2),u(3,"translate"),d(),l(4,"div",6)(5,"input",12,0),F("input",function(){W(e);let n=ie(6),a=C();return X(a.onPointsChange(n.value))}),d()(),v(7,xi,3,6,"div",13),d()}if(t&2){let e=C();s(2),D(h(3,8,"dossier.dialog.points")),s(2),Ee("is-invalid",e.pointsInput.errors),s(),Ee("is-invalid",e.pointsInput.errors),le("max",e.maxPoints),y("formControl",e.pointsInput),s(2),x(e.pointsInput.errors?7:-1)}}var Qt=500,Yt=(()=>{class t{constructor(){this.activeModal=g(xt),this.courseService=g(xe),this.maxPoints=0,this.gradeSubject$=new de,this.pointsSubject$=new de,this.closeButtonDisabled$=new w(!1),this.gradingScaleDisabled$=new w(!0),this.grade$=this.gradeSubject$.pipe(Pe(Qt)),this.points$=this.pointsSubject$.pipe(Pe(Qt),Xe(this.isValid.bind(this)),f(Number)),this.destroy$=new de}ngOnInit(){this.maxPoints=Be(this.test),this.pointsInput=new ot({value:this.points,disabled:!1},[Me.min(0),Me.pattern("[0-9]+([\\.][0-9]+)?"),this.maxPointValidator()]),this.gradingScaleDisabled$.next(this.test.IsPointGrading&&this.points>0),this.points$.pipe($e(this.destroy$)).subscribe(e=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,points:e})),this.grade$.pipe($e(this.destroy$)).subscribe(e=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,gradeId:e}))}onGradeChange(e){this.gradeSubject$.next(e)}onPointsChange(e){this.pointsSubject$.next(e),this.gradingScaleDisabled$.next(e.length>0)}updateTestResult(e){this.closeButtonDisabled$.next(!0),this.courseService.updateTestResult(this.test.CourseId,e).subscribe(({testResult:i})=>{this.gradeId=i?.GradeId??null,this.updatedTestResult=i,this.closeButtonDisabled$.next(!1)})}isValid(e){return e===""||isNaN(Number(e))?!1:!(Number(e)<0||Number(e)>this.maxPoints)}maxPointValidator(){return e=>Number(e.value)>Be(this.test)?{customMax:!0}:null}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=G({type:t,selectors:[["bkd-dossier-grades-edit"]],inputs:{test:"test",gradeId:"gradeId",gradeOptions:"gradeOptions",points:"points",studentId:"studentId"},decls:19,vars:20,consts:[["pointInput",""],[1,"modal-body"],[1,"mb-4"],[1,"form-group","row"],[1,"form-group","row","mt-2"],["for","grade",1,"col-6","col-form-label"],[1,"col-6"],["id","grade",3,"valueChange","options","value","allowEmpty","disabled"],[1,"text-muted","mt-4"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["for","points",1,"col-6","col-form-label"],["id","points","type","number","step","0.01","min","0",1,"form-control",3,"input","max","formControl"],["data-testid","validation-error-message",1,"invalid-feedback","col-6","offset-6"]],template:function(i,n){i&1&&(l(0,"div",1)(1,"p",2),p(2),d(),v(3,_i,8,10,"div",3),l(4,"div",4)(5,"label",5),p(6),u(7,"translate"),d(),l(8,"div",6)(9,"bkd-select",7),u(10,"async"),F("valueChange",function(I){return I&&n.onGradeChange(I)}),d()()(),l(11,"p",8),p(12),u(13,"translate"),d()(),l(14,"div",9)(15,"button",10),u(16,"async"),F("click",function(){return n.activeModal.close(n.updatedTestResult)}),p(17),u(18,"translate"),d()()),i&2&&(s(2),D(n.test.Designation),s(),x(n.test.IsPointGrading?3:-1),s(3),D(h(7,10,"dossier.dialog.grade")),s(3),y("options",n.gradeOptions)("value",n.gradeId)("allowEmpty",!1)("disabled",h(10,12,n.gradingScaleDisabled$)),s(3),S(" ",h(13,14,n.test.IsPointGrading?"dossier.dialog.hint.points":"dossier.dialog.hint.grade")," "),s(3),y("disabled",h(16,16,n.closeButtonDisabled$)),s(2),S(" ",h(18,18,"dossier.dialog.close")," "))},dependencies:[Ce,at,lt,he,ft,gt,ht,pt,Ht,O,$],encapsulation:2})}}return t})();function yi(t,r){if(t&1){let e=Q();l(0,"a",10),F("click",function(){W(e);let n=C(2),a=B(0);return X(n.editGrading(a))}),l(1,"i",11),p(2,"edit"),d(),l(3,"span",5),p(4),d()()}if(t&2){C(2);let e=B(2);s(4),D(e)}}function Ti(t,r){if(t&1&&(l(0,"span",5),p(1),d()),t&2){C(2);let e=B(2);s(),D(e)}}function Gi(t,r){if(t&1&&(l(0,"div",9),p(1),u(2,"translate"),d()),t&2){C(2);let e=B(0);s(),S(" ",h(2,1,e.IsPublished?"tests.published":"tests.not-published")," ")}}function Pi(t,r){if(t&1&&(l(0,"div",0)(1,"div",1),p(2),d(),l(3,"div",2),p(4),u(5,"date"),d(),l(6,"div",3),v(7,yi,5,1,"a",4)(8,Ti,2,1,"span",5),d(),l(9,"div",6),p(10),u(11,"bkdTestWeight"),d(),l(12,"div",7)(13,"span"),p(14),u(15,"bkdTestPoints"),d()(),l(16,"div",8),p(17),d(),v(18,Gi,3,3,"div",9),d()),t&2){let e=C(),i=B(0);s(2),S(" ",i.Designation," "),s(2),S(" ",V(5,7,i.Date,"dd.MM.yyyy")," "),s(3),x(e.isEditable&&i.IsOwner?7:8),s(3),S(" ",h(11,10,i)," "),s(4),D(Qe(15,12,i,e.studentId,e.isEditable,"dossier.points")),s(3),S(" ",i.Owner," "),s(),x(e.isEditable?18:-1)}}var Zt=(()=>{class t{constructor(){this.gradeService=g(ye),this.modalService=g($t),this.test$=new ee(1),this.grading$=this.test$.pipe(f(this.getGrading.bind(this)))}ngOnChanges(e){e.test&&this.test$.next(this.test)}editGrading(e){let i=this.modalService.open(Yt,{backdrop:"static"});i.componentInstance.test=e,i.componentInstance.gradeId=this.getGradeId(e),i.componentInstance.gradeOptions=t.mapToOptions(this.gradingScale),i.componentInstance.studentId=this.studentId,i.componentInstance.points=this.getPoints(e),i.result.then(n=>{n&&this.updateStudentGrade(n,e)},()=>{})}updateStudentGrade(e,i){let n=Ve(e,i);this.gradeService.updateStudentCourses(n)}getGrading(e){return this.gradingScale?.Grades.find(i=>i.Id===this.getGradeId(e))?.Designation||"\u2013"}getGradeId(e){return L(this.studentId,e)?.GradeId||null}getPoints(e){return L(this.studentId,e)?.Points||null}static mapToOptions(e){return e?.Grades.map(i=>({Key:i.Id,Value:i.Designation}))||null}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=G({type:t,selectors:[["bkd-dossier-single-test"]],inputs:{test:"test",studentId:"studentId",gradingScale:"gradingScale",isEditable:"isEditable"},features:[k],decls:5,vars:7,consts:[[1,"test-entry"],["data-testid","test-designation",1,"designation"],["data-testid","test-date",1,"date"],[1,"grade"],["aria-label","edit grade",1,"btn","btn-link"],["data-testid","test-grade"],["data-testid","test-factor",1,"factor"],["data-testid","test-points",1,"points"],["data-testid","test-teacher",1,"teacher"],["data-testid","test-status",1,"state"],["aria-label","edit grade",1,"btn","btn-link",3,"click"],["data-testid","test-grade-edit-icon",1,"material-icons"]],template:function(i,n){if(i&1&&(ne(0),u(1,"async"),ne(2),u(3,"async"),v(4,Pi,19,17,"div",0)),i&2){let a=re(h(1,1,n.test$));s(2),re(h(3,4,n.grading$)),s(2),x(a?4:-1)}},dependencies:[O,tt,$,qt,Jt],styles:['.test-entry[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1rem;display:grid;grid-template-areas:"designation designation grade factor" "date date points ." "teacher teacher . ." "state state . .";grid-template-columns:repeat(4,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}.designation[_ngcontent-%COMP%]{grid-area:designation}.date[_ngcontent-%COMP%]{grid-area:date}.grade[_ngcontent-%COMP%]{grid-area:grade}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;color:#000;padding:0;text-decoration:none}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.grade[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:-1em;color:#00000080}.points[_ngcontent-%COMP%]{grid-area:points;color:#00000080}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.state[_ngcontent-%COMP%]{grid-area:state}@media (max-width: 575.98px){.test-entry[_ngcontent-%COMP%]{grid-template-areas:"designation designation" "date grade" "factor points" "teacher teacher" "state state";grid-template-columns:repeat(2,1fr)}}']})}}return t})();var Di=()=>[],$i=(t,r)=>r.Id;function Ei(t,r){if(t&1&&J(0,"bkd-dossier-single-test",2),t&2){let e=r.$implicit,i=C(2);y("test",e)("studentId",i.studentId)("gradingScale",i.getGradingScaleOfTest(e))("isEditable",i.isEditable)}}function Ri(t,r){if(t&1&&(l(0,"div"),J(1,"bkd-dossier-grades-final-grade",1),z(2,Ei,1,4,"bkd-dossier-single-test",2,$i),d()),t&2){let e=C(),i=B(0);s(),y("finalGrade",e.decoratedCourse.finalGrade)("grading",e.decoratedCourse.grading)("gradingScale",e.decoratedCourse.gradingScale)("average",e.decoratedCourse.average),s(),q(i)}}function Mi(t,r){t&1&&(l(0,"p",0),p(1),u(2,"translate"),d()),t&2&&(s(),S(" ",h(2,1,"dossier.no-tests")," "))}var ei=(()=>{class t{ngOnChanges(e){e.decoratedCourse&&this.sortedTests$.next(this.sortedTests())}constructor(){this.sortedTests$=new w([])}sortedTests(){return this.decoratedCourse.course.Tests?Vt(this.decoratedCourse.course.Tests):[]}getGradingScaleOfTest(e){return _e(e,this.gradingScales)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=G({type:t,selectors:[["bkd-dossier-course-tests"]],inputs:{studentId:"studentId",decoratedCourse:"decoratedCourse",gradingScales:"gradingScales",isEditable:"isEditable"},features:[k],decls:4,vars:5,consts:[["data-testid","message-no-tests",1,"p-3"],[3,"finalGrade","grading","gradingScale","average"],[3,"test","studentId","gradingScale","isEditable"]],template:function(i,n){if(i&1&&(ne(0),u(1,"async"),v(2,Ri,4,4,"div")(3,Mi,3,3,"p",0)),i&2){let a,I=re((a=h(1,1,n.sortedTests$))!==null&&a!==void 0?a:Je(4,Di));s(2),x(I.length>0?2:3)}},dependencies:[zt,Zt,O,$],encapsulation:2})}}return t})();function wi(t,r){if(t&1&&(l(0,"span",0),p(1),d()),t&2){let e=C();s(),S(" (",e.grade,")")}}function Fi(t,r){if(t&1&&(l(0,"span",1),p(1),u(2,"number"),d()),t&2){let e=C();s(),S(" (",V(2,1,e.average,"1.1-3"),")")}}var ti=(()=>{class t{constructor(){}get grade(){return this.getGradeForStudent()}getGradeForStudent(){return Te(this.grading,this.finalGrade,this.gradingScale)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=G({type:t,selectors:[["bkd-dossier-grades-course-header"]],inputs:{designation:"designation",finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},decls:3,vars:3,consts:[["data-testId","grade",1,"grade"],["data-testId","average",1,"average"]],template:function(i,n){i&1&&(p(0),v(1,wi,2,1,"span",0)(2,Fi,3,4,"span",1)),i&2&&(S("",n.designation,`
`),s(),x(n.grade?1:-1),s(),x(!n.grade&&n.average?2:-1))},dependencies:[it],styles:[".average[_ngcontent-%COMP%]{color:#00000080}"]})}}return t})();var Oi=(t,r)=>r.course.Id;function Ai(t,r){if(t&1&&J(0,"bkd-dossier-course-tests",9),t&2){let e=C().$implicit,i=C(2);y("decoratedCourse",e)("studentId",i.studentId)("gradingScales",i.gradingScales)("isEditable",i.isEditable)}}function Ni(t,r){if(t&1){let e=Q();l(0,"div")(1,"div",2)(2,"div",3,0)(4,"div",4)(5,"bkd-student-dossier-entry-header",5),F("click",function(){W(e);let n=ie(3);return X(n.toggle())}),J(6,"bkd-dossier-grades-course-header",6),d()(),l(7,"div",7)(8,"div",8),v(9,Ai,1,4,"ng-template"),d()()()()()}if(t&2){let e=r.$implicit,i=ie(3);s(5),y("opened",!i.collapsed),s(),y("designation",e.course.Designation)("finalGrade",e.finalGrade)("grading",e.grading)("gradingScale",e.gradingScale)("average",e.average)}}function ki(t,r){if(t&1&&(z(0,Ni,10,6,"div",null,Oi),u(2,"async")),t&2){let e=C();q(h(2,0,e.decoratedCoursesSubject$))}}function Bi(t,r){t&1&&(l(0,"p",1),p(1),u(2,"translate"),d()),t&2&&(s(),S(" ",h(2,1,"dossier.no-courses")," "))}var us=(()=>{class t{constructor(){this.dossierGradesService=g(ye),this.isEditable=!0,this.decoratedCoursesSubject$=new w([])}ngOnChanges(){this.decoratedCoursesSubject$.next(this.decorateCourses())}decorateCourses(){return this.courses.map(e=>{let i=this.dossierGradesService.getFinalGradeForStudent(e,this.studentId),n=this.dossierGradesService.getGradesForStudent(e,this.studentId,this.gradingScales);return{course:e,finalGrade:i,grading:this.dossierGradesService.getGradingForStudent(e,this.studentId),gradingScale:this.dossierGradesService.getGradingScaleOfCourse(e,this.gradingScales),average:i?.AverageTestResult||kt(n)}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=G({type:t,selectors:[["bkd-dossier-grades-view"]],inputs:{courses:"courses",studentId:"studentId",gradingScales:"gradingScales",isEditable:"isEditable"},features:[k],decls:2,vars:1,consts:[["courses","ngbAccordionItem"],["data-testid","message-no-courses",1,"py-3"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],[3,"designation","finalGrade","grading","gradingScale","average"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[3,"decoratedCourse","studentId","gradingScales","isEditable"]],template:function(i,n){i&1&&v(0,ki,3,2)(1,Bi,3,3,"p",1),i&2&&x(n.courses.length>0?0:1)},dependencies:[vt,It,bt,Gt,ti,St,Ct,ei,O,$],encapsulation:2})}}return t})();export{ke as a,gn as b,fn as c,hn as d,Cn as e,Sn as f,bn as g,In as h,Vt as i,Rt as j,Ae as k,xe as l,Lt as m,ye as n,Xt as o,Kt as p,bi as q,Ht as r,us as s};
