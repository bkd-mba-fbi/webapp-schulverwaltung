import{b as Fe}from"./chunk-VMXYNWQX.js";import{b as Te}from"./chunk-Y4QYVF5K.js";import"./chunk-TCEEBBQP.js";import{b as ke}from"./chunk-GWJDWK72.js";import{a as _e}from"./chunk-LXT7D3OU.js";import{$a as s,Ab as K,Bb as W,Bd as ve,Cb as q,Cd as E,Db as ae,Dd as be,Eb as g,H as J,J as B,Kb as d,Kd as Ce,La as b,Lb as m,M as L,Md as Se,N as Q,P as $,Pa as x,Qa as f,Qd as Me,R as I,Ra as U,Rb as re,Rd as P,Sd as G,Td as xe,U as A,Va as C,W as X,X as Z,Xa as te,Ya as T,Za as k,_ as V,_a as r,a as D,aa as u,ab as y,b as R,ec as le,ed as pe,f as z,fd as de,g as H,gb as ie,gd as me,hb as F,kd as O,l as j,ld as ue,n as M,od as fe,pd as he,qa as ee,rb as h,sb as S,tb as N,td as ge,ud as ye,w as Y,xb as ne,ya as o,yb as oe,za as v,zb as se,zc as ce}from"./chunk-TTJNYD2F.js";var Ne=(()=>{class t{constructor(){this.id=null,this.label=null,this.disabled=!1,this.value=!1,this.valueChange=new ee,this.fallbackId=Se("bkd-switch")}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=u({type:t,selectors:[["bkd-switch"]],inputs:{id:"id",label:"label",disabled:"disabled",value:"value"},outputs:{valueChange:"valueChange"},standalone:!0,features:[g],decls:3,vars:5,consts:[["type","checkbox",3,"ngModelChange","disabled","ngModel"]],template:function(i,n){if(i&1&&(r(0,"input",0),ie("ngModelChange",function(l){return n.valueChange.emit(l)}),s(),r(1,"label"),h(2),s()),i&2){let a,l;f("disabled",n.disabled)("ngModel",n.value),x("id",(a=n.id)!==null&&a!==void 0?a:n.fallbackId),o(),x("for",(l=n.id)!==null&&l!==void 0?l:n.fallbackId),o(),S(n.label)}},dependencies:[E,me,O,fe],styles:['input[_ngcontent-%COMP%]{opacity:0;position:absolute}label[_ngcontent-%COMP%]{cursor:pointer;text-indent:-9999px;width:36px;height:18px;border:1px solid rgb(0,0,0);background:#fff;display:block;border-radius:18px;position:relative}label[_ngcontent-%COMP%]:after{content:"";position:absolute;top:1px;left:1px;width:14px;height:14px;background:#000;border-radius:14px;transition:.3s}input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{border-color:#000;background:#000}input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 1px);transform:translate(-100%);background:#fff}input[_ngcontent-%COMP%]:focus + label[_ngcontent-%COMP%]{box-shadow:0 0 0 .25rem #4e4e4e40}input[_ngcontent-%COMP%]:disabled + label[_ngcontent-%COMP%]{cursor:default;background:#fff;border-color:#dedede}input[_ngcontent-%COMP%]:disabled + label[_ngcontent-%COMP%]:after{background:#dedede}label[_ngcontent-%COMP%]:active:after{width:18.2px}'],changeDetection:0})}}return t})();function Re(t,p){if(t&1&&(r(0,"div"),h(1),s()),t&2){let e=p.$implicit;o(),N(" ",e," ")}}function je(t,p){if(t&1&&(r(0,"div",3),T(1,Re,2,1,"div",null,te),s()),t&2){let e=F();o(),k(e.descriptionLines)}}var we=(()=>{class t{constructor(e){this.cd=e,this.id="",this.label="",this.description=null,this.disabled=!1,this.onChange=i=>{},this.onTouched=()=>{},this._value=!1}get value(){return this._value}set value(e){this._value=e,this.onChange(e)}get descriptionLines(){return this.description?this.description.split(`
`):[]}writeValue(e){this._value=e}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled=e,this.cd.markForCheck()}static{this.\u0275fac=function(i){return new(i||t)(v(re))}}static{this.\u0275cmp=u({type:t,selectors:[["bkd-my-settings-notifications-toggle"]],inputs:{id:"id",label:"label",description:"description",disabled:"disabled"},standalone:!0,features:[ae([{provide:de,useExisting:X(()=>t),multi:!0}]),g],decls:5,vars:6,consts:[[1,"d-flex","align-items-center"],[1,"flex-fill"],[3,"valueChange","id","value","disabled"],[1,"form-text"]],template:function(i,n){i&1&&(r(0,"div",0)(1,"label",1),h(2),s(),r(3,"bkd-switch",2),se("valueChange",function(l){return oe(n.value,l)||(n.value=l),l}),s()(),b(4,je,3,0,"div",3)),i&2&&(o(),x("for",n.id),o(),N(" ",n.label," "),o(),f("id",n.id),ne("value",n.value),f("disabled",n.disabled),o(),C(n.description?4:-1))},dependencies:[Ne],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}}return t})();var $e=(()=>{class t{constructor(e,i){this.settings=e,this.storage=i,this.currentRoles=null}getNotificationTypes(){return this.getNotificationTypeKeys().map(e=>{if(!(e in this.settings.notificationTypes))throw new Error(`Key '${e}' is missing in 'notificationTypes' setting`);return{key:e,text:this.settings.notificationTypes[e]}})}getNotificationTypeKeys(){return Ce(this.settings.notificationTypesAssignments.reduce((e,{roles:i,types:n})=>this.hasAnyRole(i)?[...e,...n]:e,[]))}hasAnyRole(e){return this.currentRoles===null&&(this.currentRoles=Te(this.storage.getPayload()?.roles)),this.currentRoles.some(i=>e.includes(i))}static{this.\u0275fac=function(i){return new(i||t)(V(pe),V(xe))}}static{this.\u0275prov=Z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Ie=(t,p)=>p.key;function Ae(t,p){t&1&&(r(0,"div",2),y(1,"bkd-spinner",5),s())}function Ve(t,p){if(t&1&&(y(0,"bkd-my-settings-notifications-toggle",7),d(1,"async"),d(2,"async")),t&2){let e=p.$implicit,i=p.$index;U("mt-4",i>0),f("id","notification-channels-"+e.key)("label",m(1,6,e.label))("description",m(2,8,e.description))("formControlName",e.key)}}function Ue(t,p){if(t&1&&(r(0,"form",3),T(1,Ve,3,10,"bkd-my-settings-notifications-toggle",6,Ie),s()),t&2){let e=F(),i=q(0);f("formGroup",i),o(),k(e.channelsSettings)}}function Ke(t,p){if(t&1&&(y(0,"bkd-my-settings-notifications-toggle",7),d(1,"async"),d(2,"async")),t&2){let e=p.$implicit,i=p.$index;U("mt-4",i>0),f("id","notification-types-"+e.key)("label",m(1,6,e.label))("description",m(2,8,e.description))("formControlName",e.key)}}function We(t,p){if(t&1&&(r(0,"form",3),T(1,Ke,3,10,"bkd-my-settings-notifications-toggle",6,Ie),s()),t&2){let e=F(),i=q(2);f("formGroup",i),o(),k(e.typesSettings)}}var Oe=(()=>{class t{constructor(e,i,n,a,l){this.userSettings=e,this.formBuilder=i,this.toastService=n,this.translate=a,this.notificationTypes=l,this.channelsSettings=[{key:"gui",label:this.translate.get("my-settings.notifications.gui")},{key:"mail",label:this.translate.get("my-settings.notifications.mail")},{key:"phoneMobile",label:this.translate.get("my-settings.notifications.phoneMobile")}],this.typesSettings=this.notificationTypes.getNotificationTypes().map(c=>{let{label:_,description:Ge}=this.translate.currentLang==="fr-CH"?c.text.fr:c.text.de;return{key:c.key,label:j(_),description:j(Ge)}}),this.channelsValue$=this.userSettings.getNotificationChannels(),this.typesValue$=this.userSettings.getNotificationTypesInactive().pipe(M(this.typesArrayToRecord.bind(this))),this.channelsFormGroup$=this.channelsValue$.pipe(M(c=>this.createFormGroup(this.channelsSettings,c)),L(1)),this.allChannelsInactive$=Y(this.channelsValue$,this.channelsFormGroup$.pipe($(c=>c.valueChanges))).pipe(M(c=>Object.values(c).every(_=>!_)),J()),this.typesFormGroup$=this.typesValue$.pipe(A(this.allChannelsInactive$),M(([c,_])=>this.createFormGroup(this.typesSettings,c,!0,_)),L(1)),this.saving$=new H(!1),this.destroy$=new z}ngOnInit(){this.userSettings.refetch(),this.allChannelsInactive$.pipe(Q(1),A(this.typesFormGroup$),I(this.destroy$)).subscribe(([e,i])=>{Object.values(i.controls).forEach(n=>e?n.disable():n.enable())}),this.channelsFormGroup$.pipe(I(this.destroy$),$(e=>e.valueChanges)).subscribe(this.saveChannels.bind(this)),this.typesFormGroup$.pipe(I(this.destroy$),$(e=>e.valueChanges)).subscribe(this.saveTypes.bind(this))}ngOnDestroy(){this.destroy$.next()}createFormGroup(e,i,n=!1,a=!1){return this.formBuilder.group(e.reduce((l,{key:c})=>R(D({},l),{[c]:[{value:i[c]??n,disabled:a}]}),{}))}saveChannels(e){this.saving$.next(!0),this.userSettings.saveNotificationChannels(e).pipe(B(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}saveTypes(e){this.saving$.next(!0),this.userSettings.saveNotificationTypesInactive(this.typesRecordToArray(e)).pipe(B(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("my-settings.notifications.save-success"))}typesArrayToRecord(e){return this.typesSettings.reduce((n,{key:a})=>R(D({},n),{[a]:!e.includes(a)}),{})}typesRecordToArray(e){return Object.keys(e).reduce((n,a)=>e[a]?n:[...n,a],[])}static{this.\u0275fac=function(i){return new(i||t)(v(Fe),v(ve),v(_e),v(Me),v($e))}}static{this.\u0275cmp=u({type:t,selectors:[["bkd-my-settings-notifications"]],standalone:!0,features:[g],decls:17,vars:17,consts:[[1,"pb-4"],[1,"m-0","pb-3","d-flex","align-items-stretch"],[1,"position-relative"],[3,"formGroup"],[1,"mt-4","form-text"],[1,"position-absolute","inline","small","d-inline-block","ms-2"],[3,"id","label","description","formControlName","mt-4"],[3,"id","label","description","formControlName"]],template:function(i,n){if(i&1&&(K(0),d(1,"async"),K(2),d(3,"async"),r(4,"div",0)(5,"h2",1)(6,"span"),h(7),d(8,"translate"),s(),b(9,Ae,2,0,"div",2),d(10,"async"),s(),b(11,Ue,3,1,"form",3),r(12,"p",4),h(13),d(14,"translate"),s(),y(15,"hr"),b(16,We,3,1,"form",3),s()),i&2){let a=W(m(1,5,n.channelsFormGroup$));o(2);let l=W(m(3,8,n.typesFormGroup$));o(5),S(m(8,11,"my-settings.notifications.title")),o(2),C(m(10,13,n.saving$)?9:-1),o(2),C(a?11:-1),o(2),N(" ",m(14,15,"my-settings.notifications.privacy-hint")," "),o(3),C(l?16:-1)}},dependencies:[ke,E,he,O,ue,be,ge,ye,we,le,G,P],styles:[".checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important}"],changeDetection:0})}}return t})();var Ee=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=u({type:t,selectors:[["bkd-my-settings-show"]],standalone:!0,features:[g],decls:5,vars:3,consts:[[1,"bkd-container","bkd-container-limited"]],template:function(i,n){i&1&&(r(0,"div",0)(1,"h1"),h(2),d(3,"translate"),s(),y(4,"bkd-my-settings-notifications"),s()),i&2&&(o(2),S(m(3,1,"my-settings.title")))},dependencies:[Oe,G,P]})}}return t})();var Pe=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=u({type:t,selectors:[["bkd-my-settings"]],standalone:!0,features:[g],decls:1,vars:0,template:function(i,n){i&1&&y(0,"router-outlet")},dependencies:[ce],changeDetection:0})}}return t})();var wt=[{path:"",component:Pe,children:[{path:"",component:Ee}]}];export{wt as MY_SETTINGS_ROUTES};
