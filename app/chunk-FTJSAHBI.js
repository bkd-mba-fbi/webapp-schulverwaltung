import{a as ge,b as fe,c as he,d as Ce,e as Se,f as Me,h as Fe,i as Ae}from"./chunk-XWISOVKN.js";import{e as we}from"./chunk-6LRQCBUO.js";import{a as Oe}from"./chunk-Y4QYVF5K.js";import{e as Nt,p as kt}from"./chunk-JE6RMKPQ.js";import{A as De,c as ve,e as Ft,f as bt,i as be,j as Ie,l as xe,n as _e,r as ye,s as Te,t as Ge,u as Ee,v as Pe,z as It}from"./chunk-M3VKTN3S.js";import{a as Ne}from"./chunk-XVIZZVBV.js";import{a as $e,c as ke}from"./chunk-RRZAXW2T.js";import{a as _t}from"./chunk-QWYAXZZX.js";import{a as et,b as dt}from"./chunk-WNZFLLQC.js";import{b as yt}from"./chunk-GH7I4V3C.js";import{A as vt,H as At,O as Re,f as ce,i as ft,y as St}from"./chunk-RYYQAFJB.js";import{$b as tt,$d as l,A as Jt,Ab as ie,Ac as at,Ba as ee,Bc as ot,Cc as L,Dc as mt,E as Qt,F as Yt,Gc as re,Hb as x,Hc as gt,Ja as V,Jb as _,Lc as p,M as Dt,Mb as Q,Mc as g,Md as c,Nb as Y,Nc as U,Nd as a,Ob as T,Oc as se,Od as G,Pb as S,Pd as ht,Q as $t,Qb as h,Rb as Z,Rc as ae,Rd as P,Sb as v,Sd as I,Tb as b,Td as Ct,V as Zt,Vd as ue,Wd as Ot,X,Y as Rt,Z as te,_ as y,a as R,aa as Mt,ae as me,b as M,bc as j,c as zt,cc as ne,dc as f,fb as s,fe as N,h as ct,ha as K,i as F,ie as xt,j as nt,je as w,ma as m,nc as st,o as rt,p as qt,pc as wt,pd as oe,rc as d,rd as de,sa as z,sc as $,t as u,ta as q,tc as C,td as A,u as ut,ub as E,ud as le,wd as pe,xb as J}from"./chunk-CHBP6U4G.js";var Be=I({Id:a,AddressLine1:l(c),AddressLine2:me(c),Birthdate:l(N),DisplayEmail:l(c),FirstName:c,FullName:c,Gender:ue([ht("M"),ht("F"),ht("X")]),IsActive:G,LastName:c,Location:l(c),PersonId:a,PhoneMobile:l(c),PhonePrivate:l(c),PostalCode:l(c),RegistrationDate:N,RegistrationId:a});var Ve=I({Id:a,Designation:c,StudentCount:a,Number:c});var Bt=I({Id:c,TestId:a,CourseRegistrationId:a,GradeId:l(a),GradeValue:l(a),GradeDesignation:l(c),Points:l(a),StudentId:a});var je=I({Id:a,CourseId:a,Date:N,Designation:c,Weight:a,WeightPercent:a,IsPointGrading:G,MaxPoints:l(a),MaxPointsAdjusted:l(a),IsPublished:G,IsOwner:G,Owner:l(c),GradingScaleId:l(a),Results:l(P(Bt))});var Le=I({Id:a}),Ue=Ct({HRef:l(c)}),pi=Ct({HasEvaluationStarted:G,EvaluationUntil:l(N),HasReviewOfEvaluationStarted:G,HasTestGrading:G,Id:a}),ci=Ot([Le,Ue,pi]),ui=Ct({Id:a,StudentCount:a}),mi=Ot([Le,Ue,ui]),gi=I({Grade:c,AverageTestResult:a,Id:a,StudentId:a}),Vt=I({AverageTestResult:a,CanGrade:G,EventId:a,GradeId:l(a),GradeValue:l(a),Id:a,StudentId:a}),H=I({HRef:c,Id:a,Number:c,Designation:c,DateFrom:l(N),DateTo:l(N),StatusId:a,GradingScaleId:l(a),FinalGrades:l(P(gi)),Gradings:l(P(Vt)),Tests:l(P(je)),EvaluationStatusRef:ci,AttendanceRef:mi,Participants:l(P(Be)),ParticipatingStudents:l(P(Me)),Classes:l(P(Ve))}),He=I(St(H.props,["Id","Designation","GradingScaleId","Classes","AttendanceRef","EvaluationStatusRef"])),We=I({TestResults:P(Bt),Gradings:P(Vt)}),Xe=I({Gradings:P(Vt)});var Tt=(()=>{class e extends _t{constructor(){let t=m(ft),i=m(vt);super(t,i,H,"Courses"),this.statusCodec=I(St(this.codec.props,["Id","StatusId","EvaluationStatusRef"]))}getNumberOfCoursesForRating(){return this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef&fields=Id,StatusId,EvaluationStatusRef&filter.StatusId=;10300;10240`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe(y(dt(this.statusCodec)),u(t=>t.filter(i=>i.EvaluationStatusRef.HasEvaluationStarted===!0)),u(t=>t.length))}getCourses(t){return Oe(t,"TeacherRole")?this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef,AttendanceRef,Classes,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe(y(dt(H))):rt([])}getCoursesForDossier(t){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades,EvaluationStatusRef,ParticipatingStudents,Classes&filter.StatusId=;${this.settings.eventlist.statusfilter}&filter.Id=;${t.join(";")}`).pipe(y(dt(H)))}getCoursesForMyGrades(t){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}&filter.Id=;${t.join(";")}`,{headers:{"X-Role-Restriction":"StudentRole"}}).pipe(y(dt(H)))}getCourseWithTests(t){return this.http.get(`${this.baseUrl}/${t}?expand=Participants,EvaluationStatusRef,Tests,Gradings,FinalGrades,Classes`).pipe(y(et(H)),u(i=>M(R({},i),{Participants:i.Participants?.filter(n=>n.IsActive)??null})))}getCourseWithParticipants(t){return this.http.get(`${this.baseUrl}/${t}?expand=Participants,Classes,AttendanceRef`).pipe(y(et(H)),u(i=>M(R({},i),{Participants:i.Participants?.filter(n=>n.IsActive)??null})))}getCourseWithEvaluation(t,i={}){let n=new ce().set("fields","Id,Designation,GradingScaleId").set("expand","Classes,AttendanceRef,EvaluationStatusRef");return this.http.get(`${this.baseUrl}/${t}`,M(R({},i),{params:n})).pipe(y(et(He)))}add(t,i,n,o,D,B,it){let W={Tests:[{Date:kt(Nt(i),"yyyy-MM-dd'T'HH:mm:ss"),Designation:n,Weight:o,IsPointGrading:D,MaxPoints:B,MaxPointsAdjusted:it}]};return this.http.put(`${this.baseUrl}/${t}/Tests/New`,W).pipe(u(()=>{}))}update(t,i,n,o,D,B,it,W){let pt={Tests:[{Id:i,Designation:n,Date:kt(Nt(o),"yyyy-MM-dd'T'HH:mm:ss"),Weight:D,IsPointGrading:B,MaxPoints:it,MaxPointsAdjusted:W}]};return this.http.put(`${this.baseUrl}/${t}/Tests/Update`,pt).pipe(u(()=>{}))}delete(t,i){let n={TestIds:[i]};return this.http.put(`${this.baseUrl}/${t}/Tests/Delete`,n).pipe(u(()=>i))}updateTestResult(t,i){let W=i,{studentId:n,testId:o}=W,D=zt(W,["studentId","testId"]),B={StudentIds:[n],TestId:o},it="gradeId"in D?M(R({},B),{GradeId:D.gradeId}):M(R({},B),{Points:D.points});return this.http.put(`${this.baseUrl}/${t}/SetTestResult`,it).pipe(y(et(We)),y(({TestResults:pt,Gradings:Kt})=>pt.length<=1&&Kt.length===1?rt({courseId:t,testResult:pt[0]??null,grading:Kt[0]}):qt(()=>new Error("`TestResults` or `Gradings` does not contain a single value"))))}setAverageAsFinalGrade(t){return this.http.put(`${this.baseUrl}/SetAverageTestResult`,t).pipe(y(et(Xe)))}publishTest(t){let i={TestIds:[t]};return this.http.put(`${this.baseUrl}/PublishTest`,i).pipe(u(()=>t))}unpublishTest(t){let i={TestIds:[t]};return this.http.put(`${this.baseUrl}/UnpublishTest`,i).pipe(u(()=>t))}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=K({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Ke(e){return e.length===0?0:jt(e.map(({value:r,weight:t})=>r*t))/jt(e.map(({weight:r})=>r))}function Lt(e){return e.length===0?0:Number(jt(e)/e.length)}function jt(e){return e.reduce(fi,0)}function fi(e,r){return e+r}function In(e,r,t){return e?e.Tests?.reduce((i,n)=>i||n.Id===r&&n.Results?.find(o=>o.TestId===r&&o.StudentId===t)||null,null)??null:null}function xn(e,r,t){return r.map(i=>i.Id===e.TestId?Ht(e,i,t):i)}function _n(e,r,t){return t.map(i=>i.Id===e?Wt(r,i):i)}function yn(e,r){return r.map(t=>t.Id===e?M(R({},t),{IsPublished:!t.IsPublished}):t)}function Tn(e){let r=Ci(e);if(r.length===0)throw new Error("unable to calculate averages without results");return Lt(r)}function Ut(e){return e.MaxPointsAdjusted||e.MaxPoints}function Gn(e){let r=hi(e);if(r.length===0)throw new Error("unable to calculate averages without results");return Lt(r)}function k(e,r){return r.Results?.find(t=>t.StudentId===e)}function En(e,r){return r===null?null:r.filter(t=>t.Id!==e)}function Ht(e,r,t){let i=t&&r.Results?.find(o=>o.TestId===e.TestId&&o.StudentId===e.StudentId),n=r.Results?.filter(o=>!(o.TestId===e.TestId&&o.StudentId===e.StudentId))||[];return i&&t==="grade"?e.GradeId=i.GradeId:i&&t==="points"&&(e.Points=i.Points),M(R({},r),{Results:[...n,e]})}function qe(e){return e.slice().sort((r,t)=>t.Date.getTime()-r.Date.getTime())}function Gt(e,r){return r?.find(t=>t.Id===e.GradingScaleId)||null}function Wt(e,r){return M(R({},r),{Results:r.Results?.filter(t=>t.StudentId!==e)||[]})}function hi(e){return e.Results?.filter(r=>r.GradeDesignation!==null).map(r=>Number(r.GradeDesignation)).filter(r=>!isNaN(r))||[]}function Ci(e){return e.Results?.map(r=>r.Points!==null?r.Points:ze).filter(r=>r>ze)||[]}var ze=-1;var Si=I({Id:a,Designation:c,Value:a,Sufficient:G,Sort:l(c)}),Je=I({Id:a,CommentsAllowed:G,RisingGrades:G,Grades:P(Si)});var Qe=(()=>{class e extends _t{constructor(){let t=m(ft),i=m(vt);super(t,i,Je,"GradingScales")}getListForIds(t){return Jt(t.map(i=>this.get(i)))}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=K({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var Xt="studentDossierGrades",Et=(()=>{class e{constructor(){this.coursesRestService=m(Tt),this.subscriptionRestService=m(Ne),this.reportsService=m(Ae),this.loadingService=m(we),this.gradingScalesRestService=m(Qe),this.studentId$=new nt(1),this.subscriptionAndEventsIds$=this.studentId$.pipe(y(this.loadSubscriptionAndEventIds.bind(this)),X(1)),this.subscriptionIds$=this.subscriptionAndEventsIds$.pipe(u(t=>t.subscriptionIds)),this.eventIds$=this.subscriptionAndEventsIds$.pipe(u(t=>t.eventIds)),this.initialStudentCourses$=this.eventIds$.pipe($t(At),y(t=>this.loadCourses(t)),u(t=>[...t].sort((i,n)=>i.Designation.localeCompare(n.Designation))),te([]),X(1)),this.action$=new nt(1),this.studentCourses$=Qt(this.action$,this.initialStudentCourses$.pipe(u(t=>({type:"initializeCourses",payload:t})))).pipe(Zt(this.coursesReducer.bind(this),[]),X(1)),this.loading$=this.loadingService.loading(Xt),this.testReports$=this.subscriptionIds$.pipe(u(t=>t.length>0?this.reportsService.getTeacherSubscriptionGradesReports(t):[])),this.tests$=this.studentCourses$.pipe(u(t=>t.flatMap(i=>i.Tests).filter(yt))),this.gradingScaleIds$=ut([this.tests$.pipe(u(t=>[...t.map(i=>i.GradingScaleId)]),Rt(1)),this.studentCourses$.pipe(u(t=>t.map(i=>i.GradingScaleId)),Rt(1))]).pipe(u(([t,i])=>Re([...t,...i]).filter(yt)),$t(At),X(1)),this.gradingScales$=this.gradingScaleIds$.pipe(y(t=>this.gradingScalesRestService.getListForIds(t)),X(1))}setStudentId(t){this.studentId$.next(t)}getFinalGradeForStudent(t,i){return t?.FinalGrades?.find(n=>n.StudentId===i)}getGradingForStudent(t,i){return t?.Gradings?.find(n=>n.StudentId===i)}getGradingScaleOfCourse(t,i){return i?.find(n=>n.Id===t.GradingScaleId)}getGradesForStudent(t,i,n){return t.Tests?.flatMap(o=>({value:Number(Gt(o,n)?.Grades.find(B=>B.Id===k(i,o)?.GradeId)?.Designation),weight:o.Weight})).filter(({value:o})=>!!o)||[]}updateStudentCourses(t){this.action$.next({type:"updateCourses",payload:t})}loadCourses(t){return t.length===0?rt([]):this.loadingService.load(this.coursesRestService.getCoursesForDossier(t),{context:Xt})}loadSubscriptionAndEventIds(t){return this.loadingService.load(this.subscriptionRestService.getSubscriptionsByStudent(t).pipe(u(i=>({subscriptionIds:i.map(n=>n.Id),eventIds:i.map(n=>n.EventId).filter(yt)}))),{context:Xt})}coursesReducer(t,i){switch(i.type){case"initializeCourses":return i.payload;case"updateCourses":return this.updateCourses([...t],i.payload);default:return t}}updateCourses(t,i){return t.map(n=>M(R({},n),{Tests:n.Tests!==null?n.Tests.map(o=>o.Id===i.Id?i:o):null}))}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=K({token:e,factory:e.\u0275fac})}}return e})();var bi=e=>({width:e}),Ii=(e,r)=>r.Key;function xi(e,r){if(e&1&&(S(0,"option",1),d(1),p(2,"translate"),h()),e&2){let t=f();T("ngValue",null),s(),C(" ",g(2,2,t.emptyLabel)," ")}}function _i(e,r){if(e&1&&(S(0,"option",1),d(1),h()),e&2){let t=r.$implicit;T("ngValue",t),s(),C(" ",t.Value," ")}}var Ye=(()=>{class e{constructor(){this.options=[],this.allowEmpty=!0,this.emptyLabel="",this.value=null,this.disabled=!1,this.tabindex=0,this.width="auto",this.valueChange=new ee,this.options$=new F([]),this.rawValue$=new F(null),this.value$=ut([this.rawValue$,this.options$]).pipe(u(([t,i])=>i&&i.find(n=>n.Key===t)||null))}ngOnChanges(t){t.value&&this.rawValue$.next(t.value.currentValue),t.options&&this.options$.next(t.options.currentValue)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=E({type:e,selectors:[["bkd-select"]],inputs:{options:"options",allowEmpty:"allowEmpty",emptyLabel:"emptyLabel",value:"value",disabled:"disabled",tabindex:"tabindex",width:"width"},outputs:{valueChange:"valueChange"},features:[V],decls:6,vars:10,consts:[[1,"form-select",3,"ngModelChange","tabindex","ngStyle","disabled","ngModel"],[3,"ngValue"]],template:function(i,n){i&1&&(S(0,"select",0),p(1,"async"),j("ngModelChange",function(D){return n.valueChange.emit(D&&D.Key)}),x(2,xi,3,4,"option",1),Q(3,_i,2,2,"option",1,Ii),d(5,` >
`),h()),i&2&&(T("tabindex",mt(n.tabindex))("ngStyle",gt(8,bi,n.width))("disabled",n.disabled)("ngModel",g(1,6,n.value$)),s(2),_(n.allowEmpty?2:-1),s(),Y(n.options))},dependencies:[It,Te,Ge,ye,bt,Ie,de,A,w],encapsulation:2,changeDetection:0})}}return e})();function Pt(e,r,t){return r?r.Grade:yi(e,t)||e?.GradeValue}function yi(e,r){return r?.Grades.find(t=>t.Id===e?.GradeId)?.Designation}var Ti="1-3",ti="\u2013",ei=(()=>{class e{constructor(){this.locale=m(ae)}transform(t,i,n){let o=Number(t??null);return isNaN(o)?ti:Gi(Number(t??null),n??this.locale,i)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275pipe=J({name:"decimalOrDash",type:e,pure:!0})}}return e})();function Gi(e,r,t){return e===0?ti:oe(e,r,`1.${Ei(t)}`)}function Ei(e){return e?String(e).includes("-")?String(e):`${e}-${e}`:Ti}var ii=(()=>{class e{constructor(){}getGradeForStudent(){return Pt(this.grading,this.finalGrade,this.gradingScale)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=E({type:e,selectors:[["bkd-dossier-grades-final-grade"]],inputs:{finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},decls:14,vars:11,consts:[[1,"final-entry"],["data-testid","final-grade"],["data-testid","average-test-results"]],template:function(i,n){i&1&&(v(0,"div",0)(1,"div"),d(2),p(3,"translate"),b(),v(4,"div",1)(5,"span"),d(6),b()(),v(7,"div"),d(8),p(9,"translate"),b(),v(10,"div",2)(11,"span"),d(12),p(13,"decimalOrDash"),b()()()),i&2&&(s(2),$(g(3,4,"dossier.grade")),s(4),$(n.getGradeForStudent()||"\u2013"),s(2),$(g(9,6,"dossier.average")),s(4),$(U(13,8,n.average,"1-3")))},dependencies:[w,ei],styles:[".final-entry[_ngcontent-%COMP%]{padding:1rem;display:grid;grid-template-columns:repeat(2,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}"]})}}return e})();var ni=(()=>{class e{constructor(){this.translate=m(xt)}transform(t,i,n,o="tests.points"){return t.IsPointGrading&&(t.IsPublished||n)?`${k(i,t)?.Points||"\u2013"} / ${t.MaxPointsAdjusted||t.MaxPoints} ${this.translate.instant(o)}`:""}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275pipe=J({name:"bkdTestPoints",type:e,pure:!0})}}return e})();var ri=(()=>{class e{constructor(){this.translate=m(xt)}transform(t){return`${this.translate.instant("tests.factor")} ${t.Weight} (${t.WeightPercent}%)`}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275pipe=J({name:"bkdTestWeight",type:e,pure:!0})}}return e})();var Pi=e=>({maxPoints:e});function Di(e,r){if(e&1&&(S(0,"div",13),d(1),p(2,"translate"),h()),e&2){let t=f(2);s(),C(" ",U(2,1,"global.validation-errors.invalidPoints",gt(4,Pi,t.maxPoints))," ")}}function $i(e,r){if(e&1){let t=tt();S(0,"div",3)(1,"label",11),d(2),p(3,"translate"),h(),S(4,"div",6)(5,"input",12,0),j("input",function(){z(t);let n=st(6),o=f();return q(o.onPointsChange(n.value))}),h()(),x(7,Di,3,6,"div",13),h()}if(e&2){let t=f();s(2),$(g(3,9,"dossier.dialog.points")),s(2),wt("is-invalid",t.pointsInput.errors),s(),wt("is-invalid",t.pointsInput.errors),T("max",mt(t.maxPoints))("formControl",t.pointsInput),s(2),_(t.pointsInput.errors?7:-1)}}var si=500,ai=(()=>{class e{constructor(){this.activeModal=m($e),this.courseService=m(Tt),this.maxPoints=0,this.gradeSubject$=new ct,this.pointsSubject$=new ct,this.closeButtonDisabled$=new F(!1),this.gradingScaleDisabled$=new F(!0),this.grade$=this.gradeSubject$.pipe(Dt(si)),this.points$=this.pointsSubject$.pipe(Dt(si),Yt(this.isValid.bind(this)),u(Number)),this.destroy$=new ct}ngOnInit(){this.maxPoints=Ut(this.test),this.updatedTestResult=k(this.studentId,this.test)??null,this.pointsInput=new be({value:this.points,disabled:!1},[Ft.min(0),Ft.pattern("[0-9]+([\\.][0-9]+)?"),this.maxPointValidator()]),this.gradingScaleDisabled$.next(this.test.IsPointGrading&&this.points>0),this.points$.pipe(Mt(this.destroy$)).subscribe(t=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,points:t})),this.grade$.pipe(Mt(this.destroy$)).subscribe(t=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,gradeId:t}))}onGradeChange(t){this.gradeSubject$.next(t)}onPointsChange(t){this.pointsSubject$.next(t),this.gradingScaleDisabled$.next(t.length>0)}updateTestResult(t){this.closeButtonDisabled$.next(!0),this.courseService.updateTestResult(this.test.CourseId,t).subscribe(({testResult:i})=>{this.gradeId=i?.GradeId??null,this.updatedTestResult=i,this.closeButtonDisabled$.next(!1)})}isValid(t){return t===""||isNaN(Number(t))?!1:!(Number(t)<0||Number(t)>this.maxPoints)}maxPointValidator(){return t=>Number(t.value)>Ut(this.test)?{customMax:!0}:null}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=E({type:e,selectors:[["bkd-dossier-grades-edit"]],inputs:{test:"test",gradeId:"gradeId",gradeOptions:"gradeOptions",points:"points",studentId:"studentId"},decls:19,vars:20,consts:[["pointInput",""],[1,"modal-body"],[1,"mb-4"],[1,"form-group","row"],[1,"form-group","row","mt-2"],["for","grade",1,"col-6","col-form-label"],[1,"col-6"],["id","grade",3,"valueChange","options","value","allowEmpty","disabled"],[1,"text-muted","mt-4"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["for","points",1,"col-6","col-form-label"],["id","points","type","number","step","0.01","min","0",1,"form-control",3,"input","max","formControl"],["data-testid","validation-error-message",1,"invalid-feedback","col-6","offset-6"]],template:function(i,n){i&1&&(S(0,"div",1)(1,"p",2),d(2),h(),x(3,$i,8,11,"div",3),S(4,"div",4)(5,"label",5),d(6),p(7,"translate"),h(),S(8,"div",6)(9,"bkd-select",7),p(10,"async"),j("valueChange",function(D){return n.onGradeChange(D)}),h()()(),S(11,"p",8),d(12),p(13,"translate"),h()(),S(14,"div",9)(15,"button",10),p(16,"async"),j("click",function(){return n.activeModal.close(n.updatedTestResult)}),d(17),p(18,"translate"),h()()),i&2&&(s(2),$(n.test.Designation),s(),_(n.test.IsPointGrading?3:-1),s(3),$(g(7,10,"dossier.dialog.grade")),s(3),T("options",n.gradeOptions)("value",n.gradeId)("allowEmpty",!0)("disabled",g(10,12,n.gradingScaleDisabled$)),s(3),C(" ",g(13,14,n.test.IsPointGrading?"dossier.dialog.hint.points":"dossier.dialog.hint.grade")," "),s(3),T("disabled",g(16,16,n.closeButtonDisabled$)),s(2),C(" ",g(18,18,"dossier.dialog.close")," "))},dependencies:[It,ve,xe,bt,Pe,Ee,De,_e,Ye,A,w],encapsulation:2})}}return e})();function Ri(e,r){if(e&1){let t=tt();v(0,"a",10),ne("click",function(){z(t);let n=f(2),o=L(0);return q(n.editGrading(o))}),v(1,"i",11),d(2,"edit"),b(),v(3,"span",5),d(4),b()()}if(e&2){f(2);let t=L(2);s(4),$(t)}}function Mi(e,r){if(e&1&&(v(0,"span",5),d(1),b()),e&2){f(2);let t=L(2);s(),$(t)}}function wi(e,r){if(e&1&&(v(0,"div",9),d(1),p(2,"translate"),b()),e&2){f(2);let t=L(0);s(),C(" ",g(2,1,t.IsPublished?"tests.published":"tests.not-published")," ")}}function Oi(e,r){if(e&1&&(v(0,"div",0)(1,"div",1),d(2),b(),v(3,"div",2),d(4),p(5,"date"),b(),v(6,"div",3),x(7,Ri,5,1,"a",4)(8,Mi,2,1,"span",5),b(),v(9,"div",6),d(10),p(11,"bkdTestWeight"),b(),v(12,"div",7)(13,"span"),d(14),p(15,"bkdTestPoints"),b()(),v(16,"div",8),d(17),b(),x(18,wi,3,3,"div",9),b()),e&2){let t=f(),i=L(0);s(2),C(" ",i.Designation," "),s(2),C(" ",U(5,7,i.Date,"dd.MM.yyyy")," "),s(3),_(t.isEditable&&i.IsOwner?7:8),s(3),C(" ",g(11,10,i)," "),s(4),$(se(15,12,i,t.studentId,t.isEditable,"dossier.points")),s(3),C(" ",i.Owner," "),s(),_(t.isEditable?18:-1)}}var oi=(()=>{class e{constructor(){this.gradeService=m(Et),this.modalService=m(ke),this.test$=new nt(1),this.grading$=this.test$.pipe(u(this.getGrading.bind(this)))}ngOnChanges(t){t.test&&this.test$.next(this.test)}editGrading(t){let i=this.modalService.open(ai,{backdrop:"static"});i.componentInstance.test=t,i.componentInstance.gradeId=this.getGradeId(t),i.componentInstance.gradeOptions=e.mapToOptions(this.gradingScale),i.componentInstance.studentId=this.studentId,i.componentInstance.points=this.getPoints(t),i.result.then(n=>this.updateStudentGrade(n,t),()=>{})}updateStudentGrade(t,i){let n=t?Ht(t,i):Wt(this.studentId,i);this.gradeService.updateStudentCourses(n)}getGrading(t){return this.gradingScale?.Grades.find(i=>i.Id===this.getGradeId(t))?.Designation||"\u2013"}getGradeId(t){return k(this.studentId,t)?.GradeId||null}getPoints(t){return k(this.studentId,t)?.Points||null}static mapToOptions(t){return t?.Grades.map(i=>({Key:i.Id,Value:i.Designation}))||null}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=E({type:e,selectors:[["bkd-dossier-single-test"]],inputs:{test:"test",studentId:"studentId",gradingScale:"gradingScale",isEditable:"isEditable"},features:[V],decls:5,vars:7,consts:[[1,"test-entry"],["data-testid","test-designation",1,"designation"],["data-testid","test-date",1,"date"],[1,"grade"],["aria-label","edit grade",1,"btn","btn-link"],["data-testid","test-grade"],["data-testid","test-factor",1,"factor"],["data-testid","test-points",1,"points"],["data-testid","test-teacher",1,"teacher"],["data-testid","test-status",1,"state"],["aria-label","edit grade",1,"btn","btn-link",3,"click"],["data-testid","test-grade-edit-icon",1,"material-icons"]],template:function(i,n){if(i&1&&(at(0),p(1,"async"),at(2),p(3,"async"),x(4,Oi,19,17,"div",0)),i&2){let o=ot(g(1,1,n.test$));s(2),ot(g(3,4,n.grading$)),s(2),_(o?4:-1)}},dependencies:[A,le,w,ni,ri],styles:['.test-entry[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1rem;display:grid;grid-template-areas:"designation designation grade factor" "date date points ." "teacher teacher . ." "state state . .";grid-template-columns:repeat(4,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}.designation[_ngcontent-%COMP%]{grid-area:designation}.date[_ngcontent-%COMP%]{grid-area:date}.grade[_ngcontent-%COMP%]{grid-area:grade}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;color:#000;padding:0;text-decoration:none}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.grade[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:-1em;color:#00000080}.points[_ngcontent-%COMP%]{grid-area:points;color:#00000080}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.state[_ngcontent-%COMP%]{grid-area:state}@media(max-width:575.98px){.test-entry[_ngcontent-%COMP%]{grid-template-areas:"designation designation" "date grade" "factor points" "teacher teacher" "state state";grid-template-columns:repeat(2,1fr)}}']})}}return e})();var Fi=()=>[],Ai=(e,r)=>r.Id;function Ni(e,r){if(e&1&&Z(0,"bkd-dossier-single-test",2),e&2){let t=r.$implicit,i=f(2);T("test",t)("studentId",i.studentId)("gradingScale",i.getGradingScaleOfTest(t))("isEditable",i.isEditable)}}function ki(e,r){if(e&1&&(S(0,"div"),Z(1,"bkd-dossier-grades-final-grade",1),Q(2,Ni,1,4,"bkd-dossier-single-test",2,Ai),h()),e&2){let t=f(),i=L(0);s(),T("finalGrade",t.decoratedCourse.finalGrade)("grading",t.decoratedCourse.grading)("gradingScale",t.decoratedCourse.gradingScale)("average",t.decoratedCourse.average),s(),Y(i)}}function Bi(e,r){e&1&&(S(0,"p",0),d(1),p(2,"translate"),h()),e&2&&(s(),C(" ",g(2,1,"dossier.no-tests")," "))}var di=(()=>{class e{ngOnChanges(t){t.decoratedCourse&&this.sortedTests$.next(this.sortedTests())}constructor(){this.sortedTests$=new F([])}sortedTests(){return this.decoratedCourse.course.Tests?qe(this.decoratedCourse.course.Tests):[]}getGradingScaleOfTest(t){return Gt(t,this.gradingScales)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=E({type:e,selectors:[["bkd-dossier-course-tests"]],inputs:{studentId:"studentId",decoratedCourse:"decoratedCourse",gradingScales:"gradingScales",isEditable:"isEditable"},features:[V],decls:4,vars:5,consts:[["data-testid","message-no-tests",1,"p-3"],[3,"finalGrade","grading","gradingScale","average"],[3,"test","studentId","gradingScale","isEditable"]],template:function(i,n){if(i&1&&(at(0),p(1,"async"),x(2,ki,4,4,"div")(3,Bi,3,3,"p",0)),i&2){let o=ot(g(1,1,n.sortedTests$)??re(4,Fi));s(2),_(o.length>0?2:3)}},dependencies:[ii,oi,A,w],encapsulation:2})}}return e})();function Vi(e,r){if(e&1&&(v(0,"span",0),d(1),b()),e&2){let t=f();s(),C(" (",t.grade,")")}}function ji(e,r){if(e&1&&(v(0,"span",1),d(1),p(2,"number"),b()),e&2){let t=f();s(),C(" (",U(2,1,t.average,"1.1-3"),")")}}var li=(()=>{class e{constructor(){}get grade(){return this.getGradeForStudent()}getGradeForStudent(){return Pt(this.grading,this.finalGrade,this.gradingScale)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=E({type:e,selectors:[["bkd-dossier-grades-course-header"]],inputs:{designation:"designation",finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},decls:3,vars:3,consts:[["data-testId","grade",1,"grade"],["data-testId","average",1,"average"]],template:function(i,n){i&1&&(d(0),x(1,Vi,2,1,"span",0),x(2,ji,3,4,"span",1)),i&2&&(C("",n.designation,`
`),s(),_(n.grade?1:-1),s(),_(!n.grade&&n.average?2:-1))},dependencies:[pe],styles:[".average[_ngcontent-%COMP%]{color:#00000080}"]})}}return e})();var Li=(e,r)=>r.course.Id;function Ui(e,r){if(e&1&&Z(0,"bkd-dossier-course-tests",9),e&2){let t=f().$implicit,i=f(2);T("decoratedCourse",t)("studentId",i.studentId)("gradingScales",i.gradingScales)("isEditable",i.isEditable)}}function Hi(e,r){if(e&1){let t=tt();S(0,"div")(1,"div",2)(2,"div",3,0)(4,"div",4)(5,"bkd-student-dossier-entry-header",5),j("click",function(){z(t);let n=st(3);return q(n.toggle())}),Z(6,"bkd-dossier-grades-course-header",6),h()(),S(7,"div",7)(8,"div",8),ie(9,Ui,1,4,"ng-template"),h()()()()()}if(e&2){let t=r.$implicit,i=st(3);s(5),T("opened",!i.collapsed),s(),T("designation",t.course.Designation)("finalGrade",t.finalGrade)("grading",t.grading)("gradingScale",t.gradingScale)("average",t.average)}}function Wi(e,r){if(e&1&&(Q(0,Hi,10,6,"div",null,Li),p(2,"async")),e&2){let t=f();Y(g(2,0,t.decoratedCoursesSubject$))}}function Xi(e,r){e&1&&(S(0,"p",1),d(1),p(2,"translate"),h()),e&2&&(s(),C(" ",g(2,1,"dossier.no-courses")," "))}var bs=(()=>{class e{constructor(){this.dossierGradesService=m(Et),this.isEditable=!0,this.decoratedCoursesSubject$=new F([])}ngOnChanges(){this.decoratedCoursesSubject$.next(this.decorateCourses())}decorateCourses(){return this.courses.map(t=>{let i=this.dossierGradesService.getFinalGradeForStudent(t,this.studentId),n=this.dossierGradesService.getGradesForStudent(t,this.studentId,this.gradingScales);return{course:t,finalGrade:i,grading:this.dossierGradesService.getGradingForStudent(t,this.studentId),gradingScale:this.dossierGradesService.getGradingScaleOfCourse(t,this.gradingScales),average:i?.AverageTestResult||Ke(n)}})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=E({type:e,selectors:[["bkd-dossier-grades-view"]],inputs:{courses:"courses",studentId:"studentId",gradingScales:"gradingScales",isEditable:"isEditable"},features:[V],decls:2,vars:1,consts:[["courses","ngbAccordionItem"],["data-testid","message-no-courses",1,"py-3"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],[3,"designation","finalGrade","grading","gradingScale","average"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[3,"decoratedCourse","studentId","gradingScales","isEditable"]],template:function(i,n){i&1&&x(0,Wi,3,2)(1,Xi,3,3,"p",1),i&2&&_(n.courses.length>0?0:1)},dependencies:[Se,Ce,he,Fe,li,fe,ge,di,A,w],encapsulation:2})}}return e})();export{Lt as a,In as b,xn as c,_n as d,yn as e,Tn as f,Gn as g,En as h,qe as i,Ve as j,Vt as k,Tt as l,Qe as m,Et as n,ti as o,ei as p,Gi as q,Ye as r,bs as s};
