"use strict";(self.webpackChunkwebapp_schulverwaltung=self.webpackChunkwebapp_schulverwaltung||[]).push([[685],{7685:(ge,g,i)=>{i.r(g),i.d(g,{EvaluateAbsencesModule:()=>de});var h=i(8393),b=i(6486),r=i(1523),y=i(9592),A=i(7398),x=i(8180),p=i(4664),C=i(7081),e=i(5879),Z=i(9773),E=i(4141),v=i(6051),L=i(2388),u=i(6814),T=i(3005),m=i(7575),F=i(1608);let _=(()=>{class t extends v.f{constructor(n,s,a,l,c){super(n,s,c,a,"/evaluate-absences"),this.lessonPresenceService=l,this.queryParamsString$.pipe((0,Z.R)(this.destroy$)).subscribe(d=>this.confirmBackLinkParams={returnparams:d})}getInitialFilter(){return{student:null,educationalEvent:null,studyClass:null}}isValidFilter(n){return!!(n.student||n.educationalEvent||n.studyClass)}getInitialSorting(){return{key:"StudentFullName",ascending:!0}}loadEntries(n,s,a){return this.loadingService.load(this.lessonPresenceService.getStatistics(n,s,a),v.O)}buildParamsFromFilter(n){return(0,L.i)(n)}static#e=this.\u0275fac=function(s){return new(s||t)(e.LFG(u.Ye),e.LFG(T.b),e.LFG(E.L6),e.LFG(m.q),e.LFG(F.K))};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})();var S=i(412),P=i(905),I=i(4814),$=i(6283),J=i(253),N=i(6567),Y=i(9754),z=i(59),O=i(3779),M=i(9245),Q=i(9018),U=i(2015),f=i(9515);let R=(()=>{class t{constructor(n,s,a){this.studentsService=n,this.educationalEventsService=s,this.studyClassesService=a,this.filter={student:null,educationalEvent:null,studyClass:null},this.filterChange=new e.vpe,this.classesHttpFilter={params:{fields:"IsActive","filter.IsActive":"=true"}}}show(){this.filterChange.emit(this.filter)}static#e=this.\u0275fac=function(s){return new(s||t)(e.Y36(O.l),e.Y36(M.$),e.Y36(Q.R))};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["erz-evaluate-absences-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},decls:20,vars:19,consts:[[1,"row","g-3","align-items-end"],[1,"col-sm-12","col-md"],[1,"form-label"],[3,"typeaheadService","value","valueChange"],[3,"typeaheadService","value","additionalHttpParams","valueChange"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(s,a){1&s&&(e.TgZ(0,"div",0)(1,"div",1)(2,"label",2),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"erz-typeahead",3),e.NdJ("valueChange",function(c){return a.filter.student=c}),e.qZA()(),e.TgZ(6,"div",1)(7,"label",2),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"erz-typeahead",3),e.NdJ("valueChange",function(c){return a.filter.educationalEvent=c}),e.qZA()(),e.TgZ(11,"div",1)(12,"label",2),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"erz-typeahead",4),e.NdJ("valueChange",function(c){return a.filter.studyClass=c}),e.qZA()(),e.TgZ(16,"div",5)(17,"button",6),e.NdJ("click",function(){return a.show()}),e._uU(18),e.ALo(19,"translate"),e.qZA()()()),2&s&&(e.xp6(3),e.Oqu(e.lcZ(4,11,"evaluate-absences.header.student")),e.xp6(2),e.Q6J("typeaheadService",a.studentsService)("value",a.filter.student),e.xp6(3),e.Oqu(e.lcZ(9,13,"evaluate-absences.header.module-instance")),e.xp6(2),e.Q6J("typeaheadService",a.educationalEventsService)("value",a.filter.educationalEvent),e.xp6(3),e.Oqu(e.lcZ(14,15,"evaluate-absences.header.study-class")),e.xp6(2),e.Q6J("typeaheadService",a.studyClassesService)("value",a.filter.studyClass)("additionalHttpParams",a.classesHttpFilter),e.xp6(3),e.hij(" ",e.lcZ(19,17,"evaluate-absences.header.show")," "))},dependencies:[U.t,f.X$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1rem 1rem 1rem 0;border-bottom:1px solid #dee2e6}"],changeDetection:0})}return t})();function k(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"th",15),e.NdJ("click",function(){const l=e.CHM(n).$implicit,c=e.oxw(5);return e.KtG(c.state.sortService.toggleSorting(l.key))}),e.TgZ(1,"div",16)(2,"div",17),e.ALo(3,"translate"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"div",18),e._uU(7),e.ALo(8,"async"),e.qZA()()()}if(2&t){const n=o.$implicit,s=e.oxw(5);e.Q6J("ngClass",n.label),e.xp6(2),e.Q6J("ngbTooltip",e.lcZ(3,4,"evaluate-absences.list.header."+n.label)),e.xp6(2),e.hij(" ",e.lcZ(5,6,"evaluate-absences.list.header."+n.label)," "),e.xp6(3),e.hij(" ",e.lcZ(8,8,s.state.sortService.getSortingChar$(n))," ")}}const H=function(t){return["student",t,"absences"]},w=function(t){return{returnparams:t}};function j(t,o){if(1&t&&(e.TgZ(0,"a",22),e.ALo(1,"async"),e._uU(2),e.qZA()),2&t){const n=e.oxw().$implicit,s=e.oxw().$implicit,a=e.oxw(6);e.Q6J("routerLink",e.VKq(5,H,s.StudentRef.Id))("queryParams",e.VKq(7,w,e.lcZ(1,3,a.profileReturnParams$))),e.xp6(2),e.hij(" ",s[n.key]," ")}}function B(t,o){if(1&t&&e._uU(0),2&t){const n=e.oxw().$implicit,s=e.oxw().$implicit;e.hij(" ",s[n.key]," ")}}function G(t,o){if(1&t&&(e.TgZ(0,"td"),e.ALo(1,"translate"),e.YNc(2,j,3,9,"a",20),e.YNc(3,B,1,1,"ng-template",null,21,e.W1O),e.qZA()),2&t){const n=o.$implicit,s=e.MAs(4);e.uIk("data-label",e.lcZ(1,3,"evaluate-absences.list.header."+n.label)),e.xp6(2),e.Q6J("ngIf","StudentFullName"===n.key)("ngIfElse",s)}}function D(t,o){if(1&t&&(e.TgZ(0,"tr"),e.YNc(1,G,5,5,"td",19),e.qZA()),2&t){const n=e.oxw(6);e.xp6(1),e.Q6J("ngForOf",n.columns)}}function K(t,o){if(1&t&&(e.TgZ(0,"tbody"),e.YNc(1,D,2,1,"tr",19),e.qZA()),2&t){const n=e.oxw(4).erzLet;e.xp6(1),e.Q6J("ngForOf",n.entries)}}function q(t,o){1&t&&e._UZ(0,"erz-spinner",23)}function X(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"button",24),e.NdJ("click",function(){e.CHM(n);const a=e.oxw(5);return e.KtG(a.state.nextPage())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"global.pagination.load-more")," "))}const W=function(){return[]};function V(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"div",7)(1,"div",8),e._UZ(2,"erz-reports-link",9),e.ALo(3,"async"),e.qZA(),e.TgZ(4,"table",10),e.NdJ("scrolled",function(){e.CHM(n);const a=e.oxw(4);return e.KtG(a.onScroll())}),e.TgZ(5,"thead")(6,"tr"),e.YNc(7,k,9,10,"th",11),e.qZA()(),e.YNc(8,K,2,1,"tbody",12),e.qZA(),e.YNc(9,q,1,0,"erz-spinner",13),e.YNc(10,X,3,3,"button",14),e.qZA()}if(2&t){const n=e.oxw(3).erzLet,s=e.oxw();let a;e.xp6(2),e.Q6J("reports",null!==(a=e.lcZ(3,5,s.reports$))&&void 0!==a?a:e.DdM(7,W)),e.xp6(5),e.Q6J("ngForOf",s.columns),e.xp6(1),e.Q6J("ngIf",n.entries&&n.entries.length>0),e.xp6(1),e.Q6J("ngIf",n.loadingPage),e.xp6(1),e.Q6J("ngIf",n.hasMore&&!n.loadingPage)}}function ee(t,o){1&t&&(e.TgZ(0,"p",25),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"evaluate-absences.no-entries")," "))}function te(t,o){if(1&t&&(e.ynx(0),e.YNc(1,V,11,8,"div",5),e.YNc(2,ee,3,3,"ng-template",null,6,e.W1O),e.BQk()),2&t){const n=e.MAs(3),s=e.oxw(2).erzLet;e.xp6(1),e.Q6J("ngIf",s.entries&&s.entries.length>0||s.loadingPage)("ngIfElse",n)}}function ne(t,o){1&t&&e._UZ(0,"erz-spinner")}function se(t,o){if(1&t&&(e.ynx(0),e.YNc(1,te,4,2,"ng-container",2),e.ALo(2,"async"),e.YNc(3,ne,1,0,"ng-template",null,4,e.W1O),e.BQk()),2&t){const n=e.MAs(4),s=e.oxw(2);e.xp6(1),e.Q6J("ngIf",!1===e.lcZ(2,2,s.state.loading$))("ngIfElse",n)}}function ae(t,o){1&t&&(e.TgZ(0,"p",25),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"evaluate-absences.no-filter")))}function ie(t,o){if(1&t){const n=e.EpF();e.ynx(0),e.TgZ(1,"erz-evaluate-absences-header",1),e.NdJ("filterChange",function(a){e.CHM(n);const l=e.oxw();return e.KtG(l.state.setFilter(a))}),e.ALo(2,"async"),e.qZA(),e.YNc(3,se,5,4,"ng-container",2),e.ALo(4,"async"),e.YNc(5,ae,3,3,"ng-template",null,3,e.W1O),e.BQk()}if(2&t){const n=e.MAs(6),s=e.oxw();e.xp6(1),e.Q6J("filter",e.lcZ(2,3,s.filterFromParams$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,5,s.state.isFilterValid$))("ngIfElse",n)}}const oe=function(t,o,n){return{entries:t,hasMore:o,loadingPage:n}};let le=(()=>{class t{constructor(n,s,a,l,c,d){this.state=n,this.scrollPosition=s,this.route=a,this.presenceTypesService=l,this.reportsService=c,this.lessonPresencesService=d,this.reports$=this.loadReports(),this.columns=[{key:"StudentFullName",label:"student"},{key:"TotalAbsences",label:"total"},{key:"TotalAbsencesValidExcuse",label:"valid-excuse"},{key:"TotalAbsencesWithoutExcuse",label:"without-excuse"},{key:"TotalAbsencesUnconfirmed",label:"unconfirmed"},{key:"TotalAbsencesUnchecked",label:"unchecked"},{key:"TotalIncidents",label:"incident"}],this.filterFromParams$=this.route.queryParams.pipe((0,A.U)(ce)),this.profileReturnParams$=this.state.queryParamsString$}ngOnInit(){this.filterFromParams$.pipe((0,x.q)(1)).subscribe(n=>this.state.setFilter(n)),this.presenceTypesService.halfDayActive$.subscribe(n=>{n&&(this.columns=[...this.columns,{key:"TotalHalfDays",label:"halfday"}])})}ngAfterViewInit(){this.scrollPosition.restore()}onScroll(){this.state.nextPage()}loadReports(){return this.state.validFilter$.pipe((0,p.w)(n=>this.lessonPresencesService.getLessonRefs(n)),(0,p.w)(n=>n.length>0?this.reportsService.getEvaluateAbsencesReports(this.getReportRecordIds(n)):[]),(0,C.d)(1))}getReportRecordIds(n){return n.map(s=>`${s.LessonRef.Id}_${s.RegistrationRef.Id}`)}static#e=this.\u0275fac=function(s){return new(s||t)(e.Y36(_),e.Y36(S.X),e.Y36(r.gz),e.Y36(P.c),e.Y36(I.F),e.Y36(m.q))};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["erz-evaluate-absences-list"]],decls:7,vars:14,consts:[[4,"erzLet"],[3,"filter","filterChange"],[4,"ngIf","ngIfElse"],["noFilter",""],["loading",""],["class","py-3",4,"ngIf","ngIfElse"],["noEntries",""],[1,"py-3"],[1,"buttons"],[1,"mb-2",3,"reports"],["infiniteScroll","",1,"table","table-striped","table-fixed",3,"scrolled"],["scope","col",3,"ngClass","click",4,"ngFor","ngForOf"],[4,"ngIf"],["class","inline",4,"ngIf"],["type","button","class","btn btn-outline-secondary btn-sm d-block mx-auto",3,"click",4,"ngIf"],["scope","col",3,"ngClass","click"],[1,"d-flex"],[1,"column-title",3,"ngbTooltip"],[1,"sort-direction"],[4,"ngFor","ngForOf"],["class","student",3,"routerLink","queryParams",4,"ngIf","ngIfElse"],["noLink",""],[1,"student",3,"routerLink","queryParams"],[1,"inline"],["type","button",1,"btn","btn-outline-secondary","btn-sm","d-block","mx-auto",3,"click"],[1,"mt-3"]],template:function(s,a){1&s&&(e.TgZ(0,"h1"),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.YNc(3,ie,7,7,"ng-container",0),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async")),2&s&&(e.xp6(1),e.Oqu(e.lcZ(2,2,"evaluate-absences.title")),e.xp6(2),e.Q6J("erzLet",e.kEZ(10,oe,e.lcZ(4,4,a.state.entries$),e.lcZ(5,6,a.state.hasMore$),e.lcZ(6,8,a.state.loadingPage$))))},dependencies:[u.mk,u.sg,u.O5,$.Ry,J._L,r.rH,N.e,Y.D,z.O,R,u.Ov,f.X$],styles:["th[_ngcontent-%COMP%]{cursor:pointer}th.student[_ngcontent-%COMP%]{width:30%}.column-title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"],changeDetection:0})}return t})();function ce(t){return{student:t.student?Number(t.student):null,educationalEvent:t.educationalEvent?Number(t.educationalEvent):null,studyClass:t.studyClass?Number(t.studyClass):null}}var re=i(6163);const ue=[{path:"",component:(()=>{class t{constructor(n){this.state=n}static#e=this.\u0275fac=function(s){return new(s||t)(e.Y36(_))};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["erz-evaluate-absences"]],features:[e._Bn([_,{provide:re.m,useExisting:_}])],decls:1,vars:0,template:function(s,a){1&s&&e._UZ(0,"router-outlet")},dependencies:[r.lC],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}return t})(),children:[{path:"",component:le,data:{restoreScrollPositionFrom:["/evaluate-absences/student/:id"]}},y.H]}];let _e=(()=>{class t{static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275mod=e.oAB({type:t});static#n=this.\u0275inj=e.cJS({imports:[r.Bz.forChild(ue),r.Bz]})}return t})(),de=(()=>{class t{static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275mod=e.oAB({type:t});static#n=this.\u0275inj=e.cJS({providers:[h.o],imports:[b.m,_e]})}return t})()}}]);