import{a as Ie,b as Be,c as we,d as Ee,e as Fe}from"./chunk-GCWE54XA.js";import{p as O,w as Ve}from"./chunk-DJNW6R6G.js";import{d as De,e as Te}from"./chunk-FMUJPUYQ.js";import{c as ee}from"./chunk-JGKXAFYO.js";import{a as $e}from"./chunk-A7EOJZ46.js";import{D as ke,G as Le,H as Me,f as X}from"./chunk-KQORGECX.js";import{j as Pe}from"./chunk-SL67CYEF.js";import{h as Z}from"./chunk-HQSONWXM.js";import{c as W,d as Y,e as z,f as J,g as K}from"./chunk-RXRYDGZR.js";import{a as Se}from"./chunk-F4XODHS2.js";import{$ as f,$a as j,Bc as Ce,Cc as ve,Eb as x,Ec as xe,Fb as g,Fc as ge,Gb as v,Hb as Q,Ia as D,Ib as ie,Jb as se,L as pe,M as le,Nb as d,O as ne,Ob as m,P as B,Pa as c,Pb as be,R as q,Rd as Ae,Sa as p,Sd as M,Ta as me,X as U,Xa as b,Ya as ue,_a as N,a as E,ab as r,b as V,bb as a,cb as h,ea as A,f as H,fa as k,g as re,gb as F,gc as L,h as te,hc as he,hd as ye,ib as $,jb as l,k as ae,kb as fe,l as ce,lb as _e,n as T,o as de,ub as C,vb as u,wb as G,xb as _,ya as i}from"./chunk-NEW5VGRB.js";var P=(()=>{class e{constructor(){this.profileService=f(Ie),this.route=f(Ce),this.currentDossier$=new re("addresses"),this.studentId$=this.route.paramMap.pipe(T(t=>Number(t.get("id")))),this.profile$=this.studentId$.pipe(B(t=>this.profileService.getProfile(t)),le(1)),this.returnParams$=this.route.queryParams.pipe(T(({returnparams:t})=>t)),this.backlinkQueryParams$=this.returnParams$.pipe(T($e)),this.loading$=this.profileService.loading$}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=U({token:e,factory:e.\u0275fac})}}return e})();var oe=(()=>{class e{constructor(){this.settings=f(ye),this.lessonPresencesService=f(Te),this.presenceTypesService=f(X),this.toastService=f(Se),this.translate=f(Ae),this.studentId$=new te(1),this.checkableAbsences$=this.getAbsences(this.loadCheckableAbsences.bind(this)),this.openAbsences$=this.getAbsences(this.loadOpenAbsences.bind(this)),this.excusedAbsences$=this.getAbsences(this.loadExcusedAbsences.bind(this)),this.unexcusedAbsences$=this.getAbsences(this.loadUnexcusedAbsences.bind(this)),this.incidents$=this.getAbsences(this.loadIncidents.bind(this)),this.halfDays$=this.getAbsences(this.loadHalfDays.bind(this)),this.counts$=this.getCounts()}setStudentId(t){this.studentId$.next(t)}getAbsences(t){return this.studentId$.pipe(B(t),ne(null),pe({connector:()=>new te(1)}))}getCounts(){return this.studentId$.pipe(B(t=>de([this.loadStatistics(t).pipe(ne(null)),this.openAbsences$.pipe(T(n=>n?.length??null)),this.checkableAbsences$.pipe(T(n=>n?.length??null))])),T(([t,n,s])=>({openAbsences:n,checkableAbsences:s,excusedAbsences:t?.TotalAbsencesValidExcuse??null,unexcusedAbsences:t?.TotalAbsencesWithoutExcuse??null,incidents:t?.TotalIncidents??null,halfDays:t?.TotalHalfDays??null})))}loadStatistics(t){return this.lessonPresencesService.getStatistics({student:t,educationalEvent:null,studyClass:null},null,0).pipe(B(({entries:n})=>n.length>0?ce(n[0]):(this.toastService.error(this.translate.instant("global.rest-errors.notfound-message"),this.translate.instant("global.rest-errors.notfound-title")),ae)))}loadOpenAbsences(t){return this.lessonPresencesService.getListOfUnconfirmed(this.getBaseParams(t))}loadCheckableAbsences(t){return this.lessonPresencesService.getList({params:V(E({},this.getBaseParams(t)),{"filter.ConfirmationStateId":`=${this.settings.checkableAbsenceStateId}`})})}loadExcusedAbsences(t){return this.lessonPresencesService.getList({params:V(E({},this.getBaseParams(t)),{"filter.ConfirmationStateId":`=${this.settings.excusedAbsenceStateId}`})})}loadUnexcusedAbsences(t){return this.lessonPresencesService.getList({params:V(E({},this.getBaseParams(t)),{"filter.ConfirmationStateId":`=${this.settings.unexcusedAbsenceStateId}`})})}loadIncidents(t){return this.presenceTypesService.incidentTypes$.pipe(T(n=>V(E({},this.getBaseParams(t)),{"filter.TypeRef":`;${n.map(s=>s.Id).join(";")}`})),B(n=>this.lessonPresencesService.getList({params:n})))}loadHalfDays(t){return this.lessonPresencesService.getList({params:V(E({},this.getBaseParams(t)),{"filter.TypeRef":`=${this.settings.halfDayPresenceTypeId}`})})}getBaseParams(t){return{sort:"LessonDateTimeFrom.asc","filter.StudentRef":`=${t}`}}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=U({token:e,factory:e.\u0275fac})}}return e})();function Ue(e,o){if(e&1&&u(0),e&2){l();let t=v(0);_(" (",t==null?null:t.checkableAbsences,") ")}}function Qe(e,o){if(e&1&&h(0,"bkd-student-dossier-absences",13),e&2){let t=l();p("absences$",t.absencesService.checkableAbsences$)}}function We(e,o){if(e&1&&u(0),e&2){l();let t=v(0);_(" (",t==null?null:t.openAbsences,") ")}}function Ye(e,o){if(e&1&&h(0,"bkd-student-dossier-absences",14),e&2){let t=l();p("absences$",t.absencesService.openAbsences$)("selectionService",t.absencesSelectionService)}}function ze(e,o){if(e&1&&u(0),e&2){l();let t=v(0);_(" (",t==null?null:t.excusedAbsences,") ")}}function Je(e,o){if(e&1&&h(0,"bkd-student-dossier-absences",13),e&2){let t=l();p("absences$",t.absencesService.excusedAbsences$)}}function Ke(e,o){if(e&1&&u(0),e&2){l();let t=v(0);_(" (",t==null?null:t.unexcusedAbsences,") ")}}function Xe(e,o){if(e&1&&h(0,"bkd-student-dossier-absences",15),e&2){let t=l();p("absences$",t.absencesService.unexcusedAbsences$)("displayPresenceType",!1)}}function Ze(e,o){if(e&1&&u(0),e&2){l();let t=v(0);_(" (",t==null?null:t.incidents,") ")}}function et(e,o){if(e&1&&h(0,"bkd-student-dossier-absences",13),e&2){let t=l();p("absences$",t.absencesService.incidents$)}}function tt(e,o){if(e&1&&u(0),e&2){l(2);let t=v(0);_(" (",t==null?null:t.halfDays,") ")}}function nt(e,o){if(e&1&&h(0,"bkd-student-dossier-absences",15),e&2){let t=l(2);p("absences$",t.absencesService.halfDays$)("displayPresenceType",!1)}}function it(e,o){if(e&1){let t=F();r(0,"div",12,5)(2,"div",8)(3,"bkd-student-dossier-entry-header",9),$("click",function(){A(t);let s=C(1);return k(s.toggle())}),u(4),d(5,"translate"),c(6,tt,1,1),a()(),r(7,"div",10)(8,"div",11),c(9,nt,1,2,"ng-template"),a()()()}if(e&2){let t=C(1);l();let n=v(0);i(3),p("opened",!t.collapsed),i(),_(" ",m(5,3,"shared.profile.half-days")," "),i(2),b((n==null?null:n.halfDays)!==null?6:-1)}}var Re=(()=>{class e{constructor(){this.state=f(P),this.presenceTypesService=f(X),this.absencesService=f(oe),this.absencesSelectionService=f(ke),this.halfDayActive$=this.presenceTypesService.halfDayActive$,this.destroy$=new H,this.state.currentDossier$.next("absences")}ngOnInit(){this.state.studentId$.pipe(q(this.destroy$)).subscribe(t=>this.absencesService.setStudentId(t))}ngOnDestroy(){this.destroy$.next()}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=D({type:e,selectors:[["bkd-dossier-absences"]],features:[Q([oe])],decls:55,vars:31,consts:[["checkableAbsences","ngbAccordionItem"],["openAbsences","ngbAccordionItem"],["excusedAbsences","ngbAccordionItem"],["unexcusedAbsences","ngbAccordionItem"],["incidents","ngbAccordionItem"],["halfDays","ngbAccordionItem"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],["ngbAccordionItem","","id","half-days"],[3,"absences$"],[3,"absences$","selectionService"],[3,"absences$","displayPresenceType"]],template:function(n,s){if(n&1){let I=F();x(0),d(1,"async"),r(2,"div",6)(3,"div",7,0)(5,"div",8)(6,"bkd-student-dossier-entry-header",9),$("click",function(){A(I);let y=C(4);return k(y.toggle())}),u(7),d(8,"translate"),c(9,Ue,1,1),a()(),r(10,"div",10)(11,"div",11),c(12,Qe,1,1,"ng-template"),a()()(),r(13,"div",7,1)(15,"div",8)(16,"bkd-student-dossier-entry-header",9),$("click",function(){A(I);let y=C(14);return k(y.toggle())}),u(17),d(18,"translate"),c(19,We,1,1),a()(),r(20,"div",10)(21,"div",11),c(22,Ye,1,2,"ng-template"),a()()(),r(23,"div",7,2)(25,"div",8)(26,"bkd-student-dossier-entry-header",9),$("click",function(){A(I);let y=C(24);return k(y.toggle())}),u(27),d(28,"translate"),c(29,ze,1,1),a()(),r(30,"div",10)(31,"div",11),c(32,Je,1,1,"ng-template"),a()()(),r(33,"div",7,3)(35,"div",8)(36,"bkd-student-dossier-entry-header",9),$("click",function(){A(I);let y=C(34);return k(y.toggle())}),u(37),d(38,"translate"),c(39,Ke,1,1),a()(),r(40,"div",10)(41,"div",11),c(42,Xe,1,2,"ng-template"),a()()(),r(43,"div",7,4)(45,"div",8)(46,"bkd-student-dossier-entry-header",9),$("click",function(){A(I);let y=C(44);return k(y.toggle())}),u(47),d(48,"translate"),c(49,Ze,1,1),a()(),r(50,"div",10)(51,"div",11),c(52,et,1,1,"ng-template"),a()()(),c(53,it,10,5,"div",12),d(54,"async"),a()}if(n&2){let I=C(4),w=C(14),y=C(24),He=C(34),qe=C(44),S=g(m(1,16,s.absencesService.counts$));i(6),p("opened",!I.collapsed),i(),_(" ",m(8,19,"shared.profile.checkable-absences")," "),i(2),b((S==null?null:S.checkableAbsences)!==null?9:-1),i(7),p("opened",!w.collapsed),i(),_(" ",m(18,21,"shared.profile.open-absences")," "),i(2),b((S==null?null:S.openAbsences)!==null?19:-1),i(7),p("opened",!y.collapsed),i(),_(" ",m(28,23,"shared.profile.excused-absences")," "),i(2),b((S==null?null:S.excusedAbsences)!==null?29:-1),i(7),p("opened",!He.collapsed),i(),_(" ",m(38,25,"shared.profile.unexcused-absences")," "),i(2),b((S==null?null:S.unexcusedAbsences)!==null?39:-1),i(7),p("opened",!qe.collapsed),i(),_(" ",m(48,27,"shared.profile.incidents")," "),i(2),b((S==null?null:S.incidents)!==null?49:-1),i(4),b(m(54,29,s.halfDayActive$)?53:-1)}},dependencies:[K,J,z,ee,Y,W,Le,L,M],encapsulation:2,changeDetection:0})}}return e})();var st=(e,o)=>o.apprenticeshipContract.Id,ot=(e,o)=>o.Id;function rt(e,o){if(e&1&&h(0,"bkd-student-dossier-legal-representative",9),e&2){let t=o.$implicit;p("person",t)}}function at(e,o){if(e&1&&N(0,rt,1,1,"bkd-student-dossier-legal-representative",9,ot),e&2){l(3);let t=v(0);j(t.legalRepresentativePersons)}}function ct(e,o){if(e&1){let t=F();r(0,"div",4,0)(2,"div",5)(3,"bkd-student-dossier-entry-header",6),$("click",function(){A(t);let s=C(1);return k(s.toggle())}),u(4),d(5,"translate"),a()(),r(6,"div",7)(7,"div",8),c(8,at,2,0,"ng-template"),a()()()}if(e&2){let t=C(1);i(3),p("opened",!t.collapsed),i(),_(" ",m(5,2,"shared.profile.legal-representation")," ")}}function dt(e,o){if(e&1&&u(0),e&2){let t=l().$index;_(" ",t+1," ")}}function pt(e,o){if(e&1&&h(0,"bkd-student-dossier-apprenticeship-company",10),e&2){let t=l().$implicit;p("company",t)}}function lt(e,o){if(e&1){let t=F();r(0,"div",4,1)(2,"div",5)(3,"bkd-student-dossier-entry-header",6),$("click",function(){A(t);let s=C(1);return k(s.toggle())}),u(4),d(5,"translate"),c(6,dt,1,1),a()(),r(7,"div",7)(8,"div",8),c(9,pt,1,1,"ng-template"),a()()()}if(e&2){let t=C(1);l(2);let n=v(0);i(3),p("opened",!t.collapsed),i(),_(" ",m(5,3,"shared.profile.apprenticeship-company")," "),i(2),b(n.apprenticeshipCompanies.length>1?6:-1)}}function mt(e,o){if(e&1&&(h(0,"bkd-student-dossier-address",2),r(1,"div",3),c(2,ct,9,4,"div",4),N(3,lt,10,5,"div",4,st),a()),e&2){l();let t=v(0);p("student",t.student),i(2),b(t.legalRepresentativePersons.length>0?2:-1),i(),j(t.apprenticeshipCompanies)}}var Ne=(()=>{class e{constructor(){this.state=f(P),this.state.currentDossier$.next("addresses")}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=D({type:e,selectors:[["bkd-dossier-addresses"]],decls:3,vars:4,consts:[["legalRepresentatives","ngbAccordionItem"],["apprenticeshipCompanies","ngbAccordionItem"],[1,"profile-entry",3,"student"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[1,"profile-entry",3,"person"],[1,"profile-entry",3,"company"]],template:function(n,s){if(n&1&&(x(0),d(1,"async"),c(2,mt,5,2)),n&2){let I=g(m(1,1,s.state.profile$));i(2),b(I?2:-1)}},dependencies:[Be,K,J,z,ee,Y,W,Ee,we,L,M],styles:[".profile-entry[_ngcontent-%COMP%]{display:block;padding:0 1rem}"],changeDetection:0})}}return e})();function ut(e,o){e&1&&h(0,"bkd-spinner")}function ft(e,o){if(e&1&&h(0,"bkd-dossier-grades-view",0),e&2){l();let t=v(0),n=v(2),s=v(4);p("courses",t)("studentId",n)("gradingScales",s)}}var je=(()=>{class e{constructor(){this.state=f(P),this.dossierGradesService=f(O),this.destroy$=new H}ngOnInit(){this.state.currentDossier$.next("grades"),this.state.studentId$.pipe(q(this.destroy$)).subscribe(t=>this.dossierGradesService.setStudentId(t))}ngOnDestroy(){this.destroy$.next()}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=D({type:e,selectors:[["bkd-dossier-grades"]],decls:9,vars:12,consts:[[3,"courses","studentId","gradingScales"]],template:function(n,s){n&1&&(x(0),d(1,"async"),x(2),d(3,"async"),x(4),d(5,"async"),c(6,ut,1,0,"bkd-spinner"),d(7,"async"),c(8,ft,1,3,"bkd-dossier-grades-view",0)),n&2&&(g(m(1,1,s.dossierGradesService.studentCourses$)),i(2),g(m(3,4,s.state.studentId$)),i(2),g(m(5,7,s.dossierGradesService.gradingScales$)),i(2),b(m(7,10,s.dossierGradesService.loading$)?6:8))},dependencies:[Ve,Z,L],encapsulation:2})}}return e})();var _t=["*"];function bt(e,o){if(e&1&&(r(0,"div",5)(1,"span",6),u(2),d(3,"date"),a(),r(4,"span",7),u(5),a()()),e&2){let t=l();i(2),G(be(3,2,t.student.Birthdate,"dd.MM.yyyy")),i(3),_("(",t.student.Gender,")")}}var Ge=(()=>{class e{constructor(){this.link="/"}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=D({type:e,selectors:[["bkd-student-backlink"]],inputs:{link:"link",queryParams:"queryParams",studentId:"studentId",studentName:"studentName",student:"student"},ngContentSelectors:_t,decls:9,vars:5,consts:[[1,"d-flex","flex-column","w-100"],[3,"link","params"],[1,"d-flex","flex-row","align-items-start"],[1,"me-3","medium",3,"studentId"],[1,"d-flex","flex-column"],[1,"additional-info"],[1,"birthday"],[1,"gender"]],template:function(n,s){n&1&&(fe(),r(0,"div",0)(1,"bkd-backlink",1),_e(2),a(),r(3,"div",2),h(4,"bkd-avatar",3),r(5,"div",4)(6,"h1"),u(7),a(),c(8,bt,6,5,"div",5),a()()()),n&2&&(i(),p("link",s.link)("params",s.queryParams),i(3),p("studentId",s.studentId),i(3),G(s.student?s.student.FullName:s.studentName),i(),b(s.student?8:-1))},dependencies:[Me,Fe,he],styles:["[_nghost-%COMP%]{display:flex;align-items:center;width:100%}h1[_ngcontent-%COMP%]{margin:-3px 0 0;display:flex;align-items:baseline;line-height:1}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}.gender[_ngcontent-%COMP%]{margin-left:.8ch}"],changeDetection:0})}}return e})();var ht=()=>["addresses","absences","grades"],Ct=()=>[],vt=e=>({returnparams:e}),xt=e=>[e];function gt(e,o){e&1&&h(0,"bkd-spinner")}function yt(e,o){if(e&1&&h(0,"bkd-reports-link",3),e&2){let t;l(2);let n=v(4);p("reports",(t=n)!==null&&t!==void 0?t:ie(1,Ct))}}function St(e,o){if(e&1&&(r(0,"a",5),d(1,"async"),r(2,"button",6,0),u(4),d(5,"translate"),a()()),e&2){let t=o.$implicit,n=C(3),s=l(2);p("queryParams",se(9,vt,m(1,5,s.state.returnParams$)))("routerLink",se(11,xt,t)),i(2),me("btn-outline-secondary",!n.isActive),i(2),_(" ",m(5,7,"dossier."+t)," ")}}function At(e,o){e&1&&(r(0,"div"),h(1,"router-outlet"),a())}function kt(e,o){e&1&&(r(0,"p"),u(1),d(2,"translate"),a()),e&2&&(i(),G(m(2,1,"shared.profile.no-profile")))}function Dt(e,o){if(e&1&&(r(0,"bkd-student-backlink",2),d(1,"async"),d(2,"async"),c(3,yt,1,2,"bkd-reports-link",3),a(),r(4,"div",4),N(5,St,6,13,"a",5,ue),a(),c(7,At,2,0,"div")(8,kt,3,3,"p")),e&2){let t=l(),n=v(0),s=v(2);p("link","../..")("queryParams",m(1,6,t.state.backlinkQueryParams$))("studentId",m(2,8,t.state.studentId$))("student",n&&n.student),i(3),b(s==="grades"?3:-1),i(2),j(ie(10,ht)),i(2),b(n?7:8)}}var Oe=(()=>{class e{constructor(){this.state=f(P),this.dossierGradesService=f(O),this.state.currentDossier$.next("addresses")}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=D({type:e,selectors:[["bkd-student-dossier"]],features:[Q([P,O])],decls:10,vars:12,consts:[["rla","routerLinkActive"],[1,"bkd-container","bkd-container-limited"],[1,"mb-2",3,"link","queryParams","studentId","student"],[1,"ms-2",3,"reports"],[1,"d-flex","flex-row","py-3","flex-wrap"],[1,"me-1","mt-1","me-sm-2",3,"queryParams","routerLink"],["data-test-id","dossier-section-button","type","button","routerLinkActive","btn-primary",1,"btn","btn-outline-secondary"]],template:function(n,s){n&1&&(x(0),d(1,"async"),x(2),d(3,"async"),x(4),d(5,"async"),r(6,"div",1),c(7,gt,1,0,"bkd-spinner"),d(8,"async"),c(9,Dt,9,11),a()),n&2&&(g(m(1,1,s.state.profile$)),i(2),g(m(3,4,s.state.currentDossier$)),i(2),g(m(5,7,s.dossierGradesService.testReports$)),i(3),b(m(8,10,s.state.loading$)?7:9))},dependencies:[Ge,Pe,xe,ge,ve,Z,L,M],encapsulation:2,changeDetection:0})}}return e})();var Jn={path:"student/:id",children:[{path:"",component:Oe,children:[{path:"addresses",component:Ne},{path:"absences",component:Re},{path:"grades",component:je}]},{path:"absences/confirm",component:De}]};export{Jn as a};
