import{a as Wt}from"./chunk-2I5WPMJK.js";import{a as Gt}from"./chunk-SIGO6MIP.js";import{a as Vt,b as Ht,c as qt}from"./chunk-LQFIH3S3.js";import{f as je,g as Oe}from"./chunk-4QTA7R6W.js";import{b as Bt,d as Ot}from"./chunk-VNNH2VUZ.js";import"./chunk-HLEZ4C3Q.js";import"./chunk-5ZOEDVCI.js";import{a as Ut}from"./chunk-EAS6YCPS.js";import{H as Lt,I as Rt,J as $t,L as ue,P as J,Q as fe,R as wt,S as Ft,T as Et,U as Nt,b as Tt,g as kt,p as ge,q as Mt,t as Be,w as Ce,x as Qe}from"./chunk-G2L3C6GE.js";import{a as It,l as be}from"./chunk-2FCCHX6W.js";import{a as Pt,b as jt}from"./chunk-KCOBA4SV.js";import{b as Dt}from"./chunk-GWJDWK72.js";import{c as yt,d as _t,e as ht,f as vt,g as gt,h as Ct,i as St,l as xt,w as ne,y as At}from"./chunk-7TIAFCYF.js";import{a as de}from"./chunk-LXT7D3OU.js";import{$a as c,Ab as H,Ac as ce,Bb as ee,Bc as ke,Bd as pe,Cb as F,Cd as De,Db as re,Dd as Ee,Eb as L,Ed as ie,F as j,Fb as te,Gb as ae,Ia as xe,J as Xe,Kb as r,Kd as le,L as Je,La as h,Lb as l,M as O,Mb as P,O as Ze,P as R,Qa as b,Qd as me,R as et,Ra as oe,Rd as D,Sd as E,Ta as nt,Td as U,Va as C,Vc as Ke,X as se,Xa as Ae,Ya as z,Za as Y,Zb as lt,_ as N,_a as a,a as qe,aa as I,ab as S,bc as Ie,dd as ft,eb as V,ec as X,ed as q,f as Se,fc as dt,g as Ue,gb as g,h as We,hb as _,hd as Me,ia as T,ja as k,jc as mt,jd as bt,kd as Le,l as W,ld as Re,ma as tt,n as y,nb as st,o as x,ob as ot,pb as rt,pd as $e,qa as it,qb as $,rb as d,rd as we,sb as w,tb as f,td as Fe,ub as Z,ud as Pe,x as Q,xb as at,ya as o,yb as ct,yc as ut,za as u,zb as pt,zc as Te}from"./chunk-TTJNYD2F.js";var Ve=(()=>{class t{constructor(e,i,n,s,p,v,A,B){this.fb=e,this.router=i,this.toastService=n,this.translate=s,this.presenceTypesService=p,this.updateService=v,this.storageService=A,this.settings=B,this.formGroup=this.createFormGroup(),this.saving$=new Ue(!1),this.submitted$=new Ue(!1),this.absenceTypes$=x([this.getConfirmationTypes(),this.getHalfDayType()]).pipe(y(([K,M])=>M?[...K,M]:K)),this.absenceTypeIdErrors$=It(W(this.formGroup),this.submitted$,"absenceTypeId"),this.destroy$=new Se}ngOnInit(){this.selectedLessonIds$.pipe(j(1),Q(Ft)).subscribe(()=>this.navigateBack())}ngOnDestroy(){this.destroy$.next()}onSubmit(){if(this.submitted$.next(!0),this.formGroup.valid){let{absenceTypeId:e}=this.formGroup.value;this.save(e)}}cancel(){this.navigateBack()}getSelectedCount(){return this.selectedLessonIds$.pipe(y(e=>e.length))}getConfirmationTypes(){return this.presenceTypesService.confirmationTypes$.pipe(y(e=>e.filter(i=>i.IsAbsence&&i.Id!==this.settings.halfDayPresenceTypeId)))}getHalfDayType(){return W(null)}createFormGroup(){return this.fb.group({absenceTypeId:[null,bt.required]})}save(e){this.saving$.next(!0),this.selectedLessonIds$.pipe(j(1),R(i=>this.updateService.editLessonPresences(i,[Number(this.storageService.getPayload()?.id_person)],e)),Xe(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("my-absences.confirm.save-success")),this.navigateBack()}static{this.\u0275fac=function(i){return new(i||t)(u(pe),u(ce),u(de),u(me),u(J),u(fe),u(U),u(ft))}}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],decls:0,vars:0,template:function(i,n){},encapsulation:2})}}return t})();var _e=(()=>{class t{constructor(e,i,n){this.settings=e,this.storageService=i,this.studentsService=n,this.studentId$=new We(1),this.lessonAbsences$=this.studentId$.pipe(R(this.loadLessonAbsences.bind(this)),O(1)),this.lessonIncidents$=this.studentId$.pipe(R(this.loadLessonIncidents.bind(this)),O(1)),this.lessonPresences$=this.getLessonPresences(),this.checkableAbsences$=this.getAbsences(this.settings.checkableAbsenceStateId),this.openAbsences$=this.getAbsences(this.settings.unconfirmedAbsenceStateId),this.excusedAbsences$=this.getAbsences(this.settings.excusedAbsenceStateId),this.unexcusedAbsences$=this.getAbsences(this.settings.unexcusedAbsenceStateId),this.incidents$=this.getAbsences(null),this.openLessonAbsences$=x([this.openAbsences$.pipe(Q(ne)),this.lessonAbsences$]).pipe(y(be(this.getLessonAbsences.bind(this))),O(1)),this.checkableLessonAbsences$=x([this.checkableAbsences$.pipe(Q(ne)),this.lessonAbsences$]).pipe(y(be(this.getLessonAbsences.bind(this))),O(1)),this.excusedLessonAbsences$=x([this.excusedAbsences$.pipe(Q(ne)),this.lessonAbsences$]).pipe(y(be(this.getLessonAbsences.bind(this))),O(1)),this.unexcusedLessonAbsences$=x([this.unexcusedAbsences$.pipe(Q(ne)),this.lessonAbsences$]).pipe(y(be(this.getLessonAbsences.bind(this))),O(1)),this.incidentsLessonAbsences$=x([this.incidents$.pipe(Q(ne)),this.lessonIncidents$]).pipe(y(be(this.getLessonIncidents.bind(this))),O(1)),this.counts$=this.getCounts();let s=this.storageService.getPayload()?.id_person;s&&this.studentId$.next(Number(s))}reset(){this.studentId$.pipe(j(1)).subscribe(e=>this.studentId$.next(e))}getLessonPresences(){return this.getCached(x([this.studentId$,this.lessonAbsences$,this.lessonIncidents$]).pipe(R(([e,i,n])=>this.loadTimetableEntries(e,i,n).pipe(y(s=>this.buildLessonPresences(i,n,s)))),y($t)))}getAbsences(e){return this.getCached(this.lessonPresences$.pipe(y(i=>i?.filter(n=>n.ConfirmationStateId===e)||null)))}getLessonAbsences(e,i){let n=e.map(s=>s.LessonRef.Id);return i.filter(s=>n.includes(s.LessonRef.Id))}getLessonIncidents(e,i){let n=e.map(s=>s.LessonRef.Id);return i.filter(s=>n.includes(s.LessonRef.Id))}getCounts(){return x([this.getCount(this.checkableAbsences$),this.getCount(this.openAbsences$),this.getCount(this.excusedAbsences$),this.getCount(this.unexcusedAbsences$),this.getCount(this.incidents$)]).pipe(y(([e,i,n,s,p])=>({checkableAbsences:e,openAbsences:i,excusedAbsences:n,unexcusedAbsences:s,incidents:p,halfDays:null})))}getCached(e){return e.pipe(Ze(null),Je({connector:()=>new We(1)}))}getCount(e){return e.pipe(y(i=>i?.length??null))}loadLessonAbsences(e){return this.studentsService.getLessonAbsences(e)}loadLessonIncidents(e){return this.studentsService.getLessonIncidents(e)}loadTimetableEntries(e,i,n){return this.studentsService.getTimetableEntries(e,{"filter.Id":`;${[...i,...n].map(s=>s.LessonRef.Id).join(";")}`})}buildLessonPresences(e,i,n){return[...e,...i].map(s=>this.buildLessonPresence(s,n)).filter(ne)}buildLessonPresence(e,i){let n=i.find(s=>s.Id===e.LessonRef.Id);return n?{Id:"",LessonRef:{Id:e.LessonRef.Id,HRef:e.LessonRef.HRef?e.LessonRef.HRef:null},StudentRef:e.StudentRef,EventRef:{Id:0,HRef:null},TypeRef:e.TypeRef,RegistrationRef:{Id:0,HRef:null},StudyClassRef:{Id:0,HRef:null},ConfirmationStateId:"ConfirmationStateId"in e?e.ConfirmationStateId:null,EventDesignation:n.EventDesignation,HasStudyCourseConfirmationCode:!1,LessonDateTimeFrom:n.From,LessonDateTimeTo:n.To,Comment:null,Date:n.From,Type:e.Type,StudentFullName:e.StudentFullName,StudyClassNumber:"",TeacherInformation:n.EventManagerInformation??null}:null}static{this.\u0275fac=function(i){return new(i||t)(N(q),N(U),N(je))}}static{this.\u0275prov=se({token:t,factory:t.\u0275fac})}}return t})();var di=(t,m)=>m.Id,mi=t=>({count:t}),ui=t=>({"border-top pt-3":t});function fi(t,m){if(t&1&&(a(0,"div",13),d(1),r(2,"translate"),c()),t&2){let e=m.$implicit;o(),f(" ",P(2,1,"global.validation-errors."+e.error,e.params)," ")}}function bi(t,m){if(t&1&&(z(0,fi,3,4,"div",13,Ae),r(2,"async")),t&2){let e=_(2);Y(l(2,0,e.absenceTypeIdErrors$))}}function yi(t,m){if(t&1&&(a(0,"div",5),S(1,"input",11),r(2,"async"),a(3,"label",12),d(4),c(),h(5,bi,3,2),r(6,"async"),c()),t&2){let e,i,n=m.$implicit,s=m.$index,p=_();b("ngClass",ae(12,ui,n.IsHalfDay)),o(),oe("is-invalid",((e=(e=l(2,8,p.absenceTypeIdErrors$))==null?null:e.length)!==null&&e!==void 0?e:0)>0),b("id","absence-type-"+s)("value",n.Id),o(2),b("for","absence-type-"+s),o(),f(" ",n.Designation," "),o(),C(((i=(i=l(6,10,p.absenceTypes$))==null?null:i.length)!==null&&i!==void 0?i:0)-1===s?5:-1)}}function _i(t,m){t&1&&(a(0,"div",10)(1,"span",14),d(2,"Loading..."),c()())}var Xt=(()=>{class t extends Ve{constructor(e,i,n,s,p,v,A,B,K,M){super(e,i,n,s,p,v,A,B),this.myAbsencesService=K,this.selectionService=M,this.titleKey="my-absences.confirm.title",this.selectedLessonIds$=this.selectionService.selectedIds$.pipe(y(He=>le(ie(He.map(Ge=>Ge.lessonIds))))),this.confirmationStateId=this.settings.unconfirmedAbsencesRefreshTime}onSaveSuccess(){this.selectionService.clear(),this.myAbsencesService.reset(),super.onSaveSuccess()}navigateBack(){this.router.navigate(["/my-absences"])}static{this.\u0275fac=function(i){return new(i||t)(u(pe),u(ce),u(de),u(me),u(J),u(fe),u(U),u(q),u(_e),u(ue))}}static{this.\u0275cmp=I({type:t,selectors:[["bkd-my-absences-confirm"]],standalone:!0,features:[xe,L],decls:32,vars:39,consts:[[1,"bkd-container","bkd-container-limited"],[1,"mb-3","pb-3","border-bottom"],[3,"ngSubmit","formGroup"],[1,"form-group","mb-3","border-bottom"],[1,"form-label"],[1,"form-check","my-3",3,"ngClass"],[1,"remark"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],["type","radio","formControlName","absenceTypeId",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],[1,"invalid-feedback","mt-4"],[1,"visually-hidden"]],template:function(i,n){if(i&1){let s=V();a(0,"div",0)(1,"h1"),d(2),r(3,"translate"),c(),a(4,"div",1),H(5),r(6,"async"),d(7),r(8,"translate"),c(),a(9,"form",2),g("ngSubmit",function(){return T(s),k(n.onSubmit())}),a(10,"div",3)(11,"label",4),d(12),r(13,"translate"),r(14,"addSpace"),c(),z(15,yi,7,14,"div",5,di),r(17,"async"),c(),a(18,"div",6),d(19),r(20,"translate"),c(),a(21,"div",7)(22,"button",8),r(23,"async"),g("click",function(){return T(s),k(n.cancel())}),d(24),r(25,"translate"),c(),a(26,"button",9),r(27,"async"),d(28),r(29,"translate"),h(30,_i,3,0,"div",10),r(31,"async"),c()()()()}if(i&2){o(2),w(l(3,11,n.titleKey));let s=l(6,13,n.getSelectedCount());o(5),f(" ",P(8,15,s===1?"my-absences.confirm.lesson-selected":"my-absences.confirm.lessons-selected",ae(37,mi,s))," "),o(2),b("formGroup",n.formGroup),o(3),Z("",l(13,18,"my-absences.confirm.choose-presence-type"),"",P(14,20,":",":"),""),o(3),Y(l(17,23,n.absenceTypes$)),o(4),f(" ",l(20,25,"my-absences.confirm.remark")," "),o(3),b("disabled",l(23,27,n.saving$)),o(2),f(" ",l(25,29,"my-absences.confirm.cancel")," "),o(2),b("disabled",l(27,31,n.saving$)),o(2),f(" ",l(29,33,"my-absences.confirm.save")," "),o(2),C(l(31,35,n.saving$)?30:-1)}},dependencies:[De,$e,Me,we,Le,Re,Ee,Fe,Pe,Ie,X,E,D,Oe],changeDetection:0})}}return t})();var he=(()=>{class t extends Ht{get preventAbsencesAfterStart(){if(this._preventAbsencesAfterStart==null){let e=this.storageService.getPayload()?.instance_id,i=this.settings.preventStudentAbsenceAfterLessonStart;this._preventAbsencesAfterStart=e?i.includes(e):!1}return this._preventAbsencesAfterStart}constructor(e,i,n,s,p,v){super(e,i,v,n,"/my-absences/report"),this.studentsService=s,this.storageService=p}getInitialFilter(){return{dateFrom:null,dateTo:null}}isValidFilter(e){return!!(e.dateFrom||e.dateTo)}loadEntries(e,i,n){let s=this.buildRequestParamsFromFilter(e).set("sort","From.asc");return this.loadingService.load(this.loadTimetableEntries(s).pipe(y(p=>this.filterAbsencesAfterLessonStart(p)),R(p=>x([W(p),this.loadLessonAbsences(p),this.loadLessonDispensations(p)])),y(([p,v,A])=>this.buildLessonPresences(p,v,A)),y(p=>({offset:0,total:p.length,entries:p}))),Vt)}filterAbsencesAfterLessonStart(e){return this.preventAbsencesAfterStart?e.filter(i=>i.From.getTime()>=new Date().getTime()):e}buildParamsFromFilter(e){let{dateFrom:i,dateTo:n}=e,s={};return i&&(s.dateFrom=ge(i,"yyyy-MM-dd")),n&&(s.dateTo=ge(n,"yyyy-MM-dd")),s}buildRequestParamsFromFilter(e){let i=new mt;return e.dateFrom&&(i=i.set("filter.From",`>${ge(Mt(e.dateFrom,1),"yyyy-MM-dd")}`)),e.dateTo&&(i=i.set("filter.To",`<${ge(Tt(e.dateTo,1),"yyyy-MM-dd")}`)),i}get studentId(){let e=this.storageService.getPayload()?.id_person;if(e==null)throw new Error("No student id available");return Number(e)}loadTimetableEntries(e){return this.studentsService.getTimetableEntries(this.studentId,e)}loadLessonAbsences(e){return e.length>0?this.studentsService.getLessonAbsences(this.studentId,{"filter.Id":`;${e.map(i=>i.Id).join(";")}`}):W([])}loadLessonDispensations(e){return e.length>0?this.studentsService.getLessonDispensations(this.studentId,{"filter.Id":`;${e.map(i=>i.Id).join(";")}`}):W([])}buildLessonPresences(e,i,n){return e.map(s=>this.buildLessonPresence(s,i,n))}buildLessonPresence(e,i,n){let s=i.find(A=>A.LessonRef.Id===e.Id),p=n.find(A=>A.LessonRef.Id===e.Id),v=this.buildLessonPresenceTypeRef(s,p);return{Id:"",LessonRef:{Id:e.Id,HRef:null},StudentRef:(s||p)?.StudentRef||{Id:this.studentId,HRef:null},EventRef:{Id:0,HRef:null},TypeRef:v,RegistrationRef:{Id:0,HRef:null},StudyClassRef:{Id:0,HRef:null},ConfirmationStateId:s?.ConfirmationStateId||p&&this.settings.excusedAbsenceStateId||null,EventDesignation:e.EventDesignation||"",HasStudyCourseConfirmationCode:!1,LessonDateTimeFrom:e.From||new Date,LessonDateTimeTo:e.To||new Date,Comment:null,Date:e.From||new Date,Type:(s||p)?.Type||null,StudentFullName:(s||p)?.StudentFullName||"",StudyClassNumber:"",TeacherInformation:e.EventManagerInformation??null}}buildLessonPresenceTypeRef(e,i){return e?qe({},e.TypeRef):i?qe({},i.TypeRef):{Id:null,HRef:null}}static{this.\u0275fac=function(i){return new(i||t)(N(lt),N(jt),N(q),N(je),N(U),N(qt))}}static{this.\u0275prov=se({token:t,factory:t.\u0275fac})}}return t})();var ve=(()=>{class t extends Lt{constructor(){super(...arguments),this.selectedIds$=this.selection$.pipe(y(Rt))}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=tt(t)))(n||t)}})()}static{this.\u0275prov=se({token:t,factory:t.\u0275fac})}}return t})();var hi=(t,m)=>m.Id,vi=t=>({count:t}),gi=t=>({"border-top pt-3":t});function Ci(t,m){if(t&1&&(a(0,"div",13),d(1),r(2,"translate"),c()),t&2){let e=m.$implicit;o(),f(" ",P(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Si(t,m){if(t&1&&(z(0,Ci,3,4,"div",13,Ae),r(2,"async")),t&2){let e=_(2);Y(l(2,0,e.absenceTypeIdErrors$))}}function xi(t,m){if(t&1&&(a(0,"div",5),S(1,"input",11),r(2,"async"),a(3,"label",12),d(4),c(),h(5,Si,3,2),r(6,"async"),c()),t&2){let e,i,n=m.$implicit,s=m.$index,p=_();b("ngClass",ae(12,gi,n.IsHalfDay)),o(),oe("is-invalid",((e=(e=l(2,8,p.absenceTypeIdErrors$))==null?null:e.length)!==null&&e!==void 0?e:0)>0),b("id","absence-type-"+s)("value",n.Id),o(2),b("for","absence-type-"+s),o(),f(" ",n.Designation," "),o(),C(((i=(i=l(6,10,p.absenceTypes$))==null?null:i.length)!==null&&i!==void 0?i:0)-1===s?5:-1)}}function Ai(t,m){t&1&&(a(0,"div",10)(1,"span",14),d(2,"Loading..."),c()())}var ei=(()=>{class t extends Ve{constructor(e,i,n,s,p,v,A,B,K,M){super(e,i,n,s,p,v,A,B),this.state=K,this.selectionService=M,this.titleKey="my-absences.report.title",this.selectedLessonIds$=this.selectionService.selectedIds$.pipe(y(He=>le(ie(He.map(Ge=>Ge.lessonIds))))),this.confirmationStateId=this.settings.checkableAbsenceStateId}getHalfDayType(){return this.presenceTypesService.getPresenceType(this.settings.halfDayPresenceTypeId).pipe(y(e=>e.Active?e:null))}onSaveSuccess(){this.selectionService.clear(),this.state.resetEntries(),super.onSaveSuccess()}navigateBack(){this.state.queryParams$.pipe(j(1)).subscribe(e=>{this.router.navigate(["/my-absences/report"],{queryParams:e})})}static{this.\u0275fac=function(i){return new(i||t)(u(pe),u(ce),u(de),u(me),u(J),u(fe),u(U),u(q),u(he),u(ve))}}static{this.\u0275cmp=I({type:t,selectors:[["bkd-my-absences-confirm"]],standalone:!0,features:[xe,L],decls:32,vars:39,consts:[[1,"bkd-container","bkd-container-limited"],[1,"mb-3","pb-3","border-bottom"],[3,"ngSubmit","formGroup"],[1,"form-group","mb-3","border-bottom"],[1,"form-label"],[1,"form-check","my-3",3,"ngClass"],[1,"remark"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],["type","radio","formControlName","absenceTypeId",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],[1,"invalid-feedback","mt-4"],[1,"visually-hidden"]],template:function(i,n){if(i&1){let s=V();a(0,"div",0)(1,"h1"),d(2),r(3,"translate"),c(),a(4,"div",1),H(5),r(6,"async"),d(7),r(8,"translate"),c(),a(9,"form",2),g("ngSubmit",function(){return T(s),k(n.onSubmit())}),a(10,"div",3)(11,"label",4),d(12),r(13,"translate"),r(14,"addSpace"),c(),z(15,xi,7,14,"div",5,hi),r(17,"async"),c(),a(18,"div",6),d(19),r(20,"translate"),c(),a(21,"div",7)(22,"button",8),r(23,"async"),g("click",function(){return T(s),k(n.cancel())}),d(24),r(25,"translate"),c(),a(26,"button",9),r(27,"async"),d(28),r(29,"translate"),h(30,Ai,3,0,"div",10),r(31,"async"),c()()()()}if(i&2){o(2),w(l(3,11,n.titleKey));let s=l(6,13,n.getSelectedCount());o(5),f(" ",P(8,15,s===1?"my-absences.confirm.lesson-selected":"my-absences.confirm.lessons-selected",ae(37,vi,s))," "),o(2),b("formGroup",n.formGroup),o(3),Z("",l(13,18,"my-absences.confirm.choose-presence-type"),"",P(14,20,":",":"),""),o(3),Y(l(17,23,n.absenceTypes$)),o(4),f(" ",l(20,25,"my-absences.confirm.remark")," "),o(3),b("disabled",l(23,27,n.saving$)),o(2),f(" ",l(25,29,"my-absences.confirm.cancel")," "),o(2),b("disabled",l(27,31,n.saving$)),o(2),f(" ",l(29,33,"my-absences.confirm.save")," "),o(2),C(l(31,35,n.saving$)?30:-1)}},dependencies:[De,$e,Me,we,Le,Re,Ee,Fe,Pe,Ie,X,E,D,Oe],changeDetection:0})}}return t})();var Ii=()=>["/my-absences"],ii=(()=>{class t{constructor(){this.filter={dateFrom:null,dateTo:null},this.filterChange=new it,this.minDate={year:new Date().getFullYear(),month:new Date().getMonth()+1,day:new Date().getDate()}}updateDateFrom(e){this.filter.dateFrom=e,e&&(this.filter.dateTo=e)}show(){this.filterChange.emit({dateFrom:ti(this.filter.dateFrom),dateTo:ti(this.filter.dateTo)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=I({type:t,selectors:[["bkd-my-absences-report-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},standalone:!0,features:[re([{provide:Ct,useClass:xt},{provide:St,useClass:Gt}]),L],decls:19,vars:18,consts:[[3,"link"],[1,"filters"],[1,"form-group"],[1,"form-label"],[3,"valueChange","minDate","value"],[1,"buttons"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(i,n){i&1&&(S(0,"bkd-backlink",0),a(1,"h1"),d(2),r(3,"translate"),c(),a(4,"div",1)(5,"div",2)(6,"label",3),d(7),r(8,"translate"),c(),a(9,"bkd-date-select",4),g("valueChange",function(p){return n.updateDateFrom(p)}),c()(),a(10,"div",2)(11,"label",3),d(12),r(13,"translate"),c(),a(14,"bkd-date-select",4),pt("valueChange",function(p){return ct(n.filter.dateTo,p)||(n.filter.dateTo=p),p}),c()(),a(15,"div",5)(16,"button",6),g("click",function(){return n.show()}),d(17),r(18,"translate"),c()()()),i&2&&(b("link",te(17,Ii)),o(2),w(l(3,9,"my-absences.report.title")),o(5),w(l(8,11,"my-absences.report.header.date-from")),o(2),b("minDate",n.minDate)("value",n.filter.dateFrom),o(3),w(l(13,13,"my-absences.report.header.date-to")),o(2),b("minDate",n.minDate),at("value",n.filter.dateTo),o(3),f(" ",l(18,15,"my-absences.report.header.show")," "))},dependencies:[Nt,Wt,E,D],styles:["[_nghost-%COMP%]{display:block;padding-bottom:1rem;border-bottom:1px solid #dee2e6}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.form-group[_ngcontent-%COMP%]{flex:1;min-width:20rem;max-width:40rem;margin-right:1rem;margin-bottom:.5rem}.buttons[_ngcontent-%COMP%]{flex:none;margin-top:1.625rem;margin-right:0}@media (max-width: 575.98px){[_nghost-%COMP%]{padding-bottom:0}.buttons[_ngcontent-%COMP%]{width:100%;margin-top:1rem;margin-bottom:1rem}}"],changeDetection:0})}}return t})();function ti(t){return t?kt(t):null}var Ti=(t,m)=>m.Id;function ki(t,m){t&1&&S(0,"bkd-spinner")}function Mi(t,m){if(t&1){let e=V();a(0,"div",8)(1,"input",9,2),r(3,"async"),g("change",function(){T(e);let n=_().$implicit,s=_(5);return k(s.selectionService.toggle(n))}),c()()}if(t&2){let e=_().$implicit,i=_(5);o(),b("checked",l(3,1,i.selectionService.isSelected$(e)))}}function Li(t,m){if(t&1&&(a(0,"div")(1,"i",13),d(2),c()()),t&2){_();let e=F(2);nt("checkbox presence-category ",e.category,""),o(2),w(e.icon)}}function Ri(t,m){if(t&1&&d(0),t&2){let e=_().$implicit;f(" , ",e.StudyClassNumber," ")}}function $i(t,m){if(t&1&&(a(0,"div",20),d(1),c()),t&2){_();let e=F(15);o(),f(" ",e," ")}}function wi(t,m){if(t&1){let e=V();a(0,"div",15,1),g("click",function(n){T(e);let s=$(1),p=_(5);return k(p.onRowClick(n,s))}),H(2),r(3,"async"),h(4,Mi,4,3,"div",8)(5,Li,3,4,"div",16),a(6,"div",17),d(7),h(8,Ri,1,1),c(),a(9,"div",18),d(10),r(11,"date"),r(12,"date"),c(),a(13,"div",19),d(14),c(),H(15),r(16,"async"),h(17,$i,2,1,"div",20),a(18,"div",21),d(19),r(20,"date"),c(),a(21,"div",22),d(22),r(23,"bkdDaysDifference"),c(),a(24,"div",23),d(25),r(26,"date"),r(27,"bkdDaysDifference"),c()()}if(t&2){let e=m.$implicit,i=_(5);o(2);let n=ee(l(3,11,i.getPresenceCategory(e)));o(2),C(n?5:4),o(3),f(" ",e.EventDesignation," "),o(),C(e.StudyClassNumber?8:-1),o(2),Z(" ",P(11,14,e.LessonDateTimeFrom,"HH:mm"),"\u2013",P(12,17,e.LessonDateTimeTo,"HH:mm")," "),o(4),f(" ",e.TeacherInformation," "),o();let s=ee(l(16,20,i.getPresenceTypeDesignation(e)));o(2),C(s?17:-1),o(2),f(" ",P(20,23,e.LessonDateTimeFrom,"dd.MM.yyyy")," "),o(3),f(" ",l(23,26,e.LessonDateTimeFrom)," "),o(3),Z(" ",P(26,28,e.LessonDateTimeFrom,"dd.MM.yyyy"),", ",l(27,31,e.LessonDateTimeFrom)," ")}}function Fi(t,m){if(t&1){let e=V();a(0,"div")(1,"div",7,0),g("click",function(n){T(e);let s=$(2),p=_(4);return k(p.onRowClick(n,s))}),a(3,"div",8)(4,"input",9),r(5,"async"),g("change",function(n){T(e);let s=_(4);return k(s.toggleAll(n.target==null?null:n.target.checked))}),c()(),a(6,"div",10),d(7),r(8,"translate"),c(),a(9,"div",11)(10,"a",12),r(11,"async"),a(12,"i",13),d(13,"edit"),c()()()(),z(14,wi,28,33,"div",14,Ti),c()}if(t&2){let e,i=_(4),n=F(0);o(4),b("checked",l(5,4,i.allSelected$)),o(3),f(" ",l(8,6,"my-absences.report.list.all")," "),o(3),oe("disabled",((e=l(11,8,i.selectionService.selection$))==null?null:e.length)===0),o(4),Y(n)}}function Pi(t,m){t&1&&S(0,"bkd-spinner",6)}function Di(t,m){if(t&1&&(a(0,"div",5),h(1,Fi,16,10,"div")(2,Pi,1,0,"bkd-spinner",6),c()),t&2){_(3);let e=F(0),i=F(2);o(),C(e&&e.length>0?1:-1),o(),C(i?2:-1)}}function Ei(t,m){t&1&&(a(0,"p",4),d(1),r(2,"translate"),c()),t&2&&(o(),f(" ",l(2,1,"my-absences.report.no-entries")," "))}function Bi(t,m){if(t&1&&h(0,Di,3,2,"div",5)(1,Ei,3,3,"p",4),t&2){_(2);let e=F(0),i=F(2);C(e&&e.length>0||i?0:1)}}function ji(t,m){if(t&1&&(h(0,ki,1,0,"bkd-spinner"),r(1,"async"),h(2,Bi,2,1)),t&2){let e=_();C(l(1,1,e.state.loading$)?0:2)}}function Oi(t,m){t&1&&(a(0,"p",4),d(1),r(2,"translate"),c()),t&2&&(o(),w(l(2,1,"my-absences.report.no-filter")))}var ni=(()=>{class t{constructor(e,i,n,s,p,v){this.state=e,this.selectionService=i,this.route=n,this.scrollPosition=s,this.presenceTypesService=p,this.settings=v,this.filterFromParams$=this.route.queryParams.pipe(y(Ni)),this.allSelected$=x([this.selectionService.selection$,this.state.entries$.pipe(R(A=>x(A.map(B=>this.getPresenceType(B)))))]).pipe(y(([A,B])=>A.length>0&&A.length===B.filter(At(Be)).length)),this.destroy$=new Se}ngOnInit(){this.filterFromParams$.pipe(j(1)).subscribe(e=>this.state.setFilter(e)),this.state.validFilter$.pipe(et(this.destroy$)).subscribe(()=>this.selectionService.clear())}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}getPresenceCategory(e){return this.getPresenceType(e).pipe(y(i=>Be(i)?e.ConfirmationStateId===this.settings.checkableAbsenceStateId?{category:Ce.Unapproved,icon:Qe(Ce.Unapproved)}:{category:Ce.Absent,icon:Qe(Ce.Absent)}:null))}getPresenceTypeDesignation(e){return this.presenceTypesService.displayedTypes$.pipe(y(i=>e.TypeRef.Id&&i.find(n=>n.Id===e.TypeRef.Id)?.Designation||null))}toggleAll(e){x([this.state.entries$.pipe(j(1)),this.presenceTypesService.presenceTypes$.pipe(j(1))]).subscribe(([i,n])=>{let s=n.filter(p=>Be(p)).map(p=>p.Id);this.selectionService.clear(e?i.filter(p=>p.TypeRef.Id==null||!s.includes(p.TypeRef.Id)):null)})}onRowClick(e,i){let n=i.querySelector('input[type="checkbox"]');n&&e.target!==n&&!e.target.closest(".buttons")&&n.click()}getPresenceType(e){return this.presenceTypesService.presenceTypes$.pipe(y(i=>e.TypeRef.Id&&i.find(n=>n.Id===e.TypeRef.Id)||null))}static{this.\u0275fac=function(i){return new(i||t)(u(he),u(ve),u(ut),u(Ut),u(J),u(q))}}static{this.\u0275cmp=I({type:t,selectors:[["bkd-my-absences-report-list"]],standalone:!0,features:[L],decls:9,vars:12,consts:[["all",""],["row",""],["checkbox",""],[3,"filterChange","filter"],[1,"mt-3"],[1,"py-3"],[1,"inline"],[1,"entries-all",3,"click"],[1,"checkbox"],["type","checkbox",1,"form-check-input",3,"change","checked"],[1,"all"],[1,"buttons"],["routerLink","confirm",1,"edit","btn","btn-primary","btn-icon","me-2"],[1,"material-icons"],[1,"entry"],[1,"entry",3,"click"],[3,"class"],[1,"lesson-class"],[1,"time","pe-2"],[1,"teacher"],[1,"presence-type"],[1,"date"],[1,"days-ago"],[1,"date-days-ago"]],template:function(i,n){if(i&1){let s=V();H(0),r(1,"async"),H(2),r(3,"async"),a(4,"bkd-my-absences-report-header",3),r(5,"async"),g("filterChange",function(v){return T(s),k(n.state.setFilter(v))}),c(),h(6,ji,3,3),r(7,"async"),h(8,Oi,3,3,"p",4)}i&2&&(ee(l(1,2,n.state.entries$)),o(2),ee(l(3,5,n.state.loadingPage$)),o(2),b("filter",l(5,8,n.filterFromParams$)),o(2),C(l(7,10,n.state.isFilterValid$)?6:8))},dependencies:[ii,ke,Dt,X,dt,E,D,wt],styles:['.entries-all[_ngcontent-%COMP%]{padding:0 0 .5rem 1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox all buttons";grid-template-columns:min-content 1fr min-content}.entry[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox lesson-class time teacher" "checkbox presence-type date days-ago";grid-template-columns:min-content 2fr 1fr 2fr}.entry[_ngcontent-%COMP%]:first-child{padding-top:0}.entries-all[_ngcontent-%COMP%] + .entry[_ngcontent-%COMP%]{padding-top:1rem}.presence-category.absent[_ngcontent-%COMP%]{color:#ea161f}.presence-category.unapproved[_ngcontent-%COMP%]{color:#ffa814}.checkbox[_ngcontent-%COMP%]{grid-area:checkbox;margin:0;padding:.3rem 1rem 0 0}.presence-category[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{display:block;font-size:16px}.entries-all[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{padding-top:.2rem}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.all[_ngcontent-%COMP%]{grid-area:all}.buttons[_ngcontent-%COMP%]{grid-area:buttons;display:flex}.lesson-class[_ngcontent-%COMP%]{grid-area:lesson-class;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.time[_ngcontent-%COMP%]{grid-area:time}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.presence-type[_ngcontent-%COMP%]{color:#adb5bd;grid-area:presence-type}.date[_ngcontent-%COMP%]{grid-area:date}.days-ago[_ngcontent-%COMP%]{color:#adb5bd;grid-area:days-ago}.date-days-ago[_ngcontent-%COMP%]{grid-area:date-days-ago;display:none}@media (max-width: 750px){.entry[_ngcontent-%COMP%]{grid-template-areas:"checkbox lesson-class" "checkbox teacher" "checkbox date-days-ago" "checkbox time" "checkbox presence-type";grid-template-columns:min-content 1fr}.date-days-ago[_ngcontent-%COMP%]{display:block}.date[_ngcontent-%COMP%], .days-ago[_ngcontent-%COMP%]{display:none}}'],changeDetection:0})}}return t})();function Ni(t){return{dateFrom:t.dateFrom?Ke(t.dateFrom):null,dateTo:t.dateTo?Ke(t.dateTo):null}}var si=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=I({type:t,selectors:[["bkd-my-absences-report"]],standalone:!0,features:[re([he,ve]),L],decls:1,vars:0,template:function(i,n){i&1&&S(0,"router-outlet")},dependencies:[Te],changeDetection:0})}}return t})();var Vi=["link"],Hi=()=>["/my-absences/report"],oi=(()=>{class t{onClick(){this.link.nativeElement.click()}constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=I({type:t,selectors:[["bkd-my-absences-report-link"]],viewQuery:function(i,n){if(i&1&&st(Vi,5),i&2){let s;ot(s=rt())&&(n.link=s.first)}},hostBindings:function(i,n){i&1&&g("click",function(p){return n.onClick(p)})},standalone:!0,features:[L],decls:8,vars:5,consts:[["link",""],[1,"m-0"],[1,"btn","btn-link","p-0",3,"routerLink"],[1,"d-flex","align-items-center"],[1,"material-icons"]],template:function(i,n){i&1&&(a(0,"h5",1),d(1),r(2,"translate"),c(),a(3,"a",2,0)(5,"div",3)(6,"i",4),d(7,"keyboard_arrow_right"),c()()()),i&2&&(o(),f(" ",l(2,2,"my-absences.report.title"),`
`),o(2),b("routerLink",te(4,Hi)))},dependencies:[ke,E,D],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1rem;cursor:pointer}.btn[_ngcontent-%COMP%]{color:#000;text-decoration:none}"],changeDetection:0})}}return t})();var ri=()=>[];function Gi(t,m){}function qi(t,m){if(t&1&&d(0),t&2){_();let e=F(0);f(" (",e==null?null:e.checkableAbsences,") ")}}function Ui(t,m){if(t&1&&S(0,"bkd-student-dossier-absences",15),t&2){let e=_();b("absences$",e.myAbsencesService.checkableAbsences$)}}function Wi(t,m){if(t&1&&d(0),t&2){_();let e=F(0);f(" (",e==null?null:e.openAbsences,") ")}}function Ki(t,m){if(t&1&&(S(0,"bkd-student-dossier-absences",16),r(1,"translate"),r(2,"async")),t&2){let e,i=_();b("absences$",i.myAbsencesService.openAbsences$)("selectionService",i.absencesSelectionService)("defaultAbsenceSelectionMessage",l(1,4,"my-absences.show.default-absence-selection-message"))("reports",(e=l(2,6,i.openAbsencesReports$))!==null&&e!==void 0?e:te(8,ri))}}function Qi(t,m){if(t&1&&d(0),t&2){_();let e=F(0);f(" (",e==null?null:e.excusedAbsences,") ")}}function zi(t,m){if(t&1&&S(0,"bkd-student-dossier-absences",15),t&2){let e=_();b("absences$",e.myAbsencesService.excusedAbsences$)}}function Yi(t,m){if(t&1&&d(0),t&2){_();let e=F(0);f(" (",e==null?null:e.unexcusedAbsences,") ")}}function Xi(t,m){if(t&1&&S(0,"bkd-student-dossier-absences",17),t&2){let e=_();b("absences$",e.myAbsencesService.unexcusedAbsences$)("displayPresenceType",!1)}}function Ji(t,m){if(t&1&&d(0),t&2){_();let e=F(0);f(" (",e==null?null:e.incidents,") ")}}function Zi(t,m){if(t&1&&S(0,"bkd-student-dossier-absences",15),t&2){let e=_();b("absences$",e.myAbsencesService.incidents$)}}var ai=(()=>{class t{constructor(e,i,n){this.reportsService=e,this.myAbsencesService=i,this.absencesSelectionService=n,this.openAbsencesReports$=this.loadOpenAbsencesReports(),this.allAbsencesReports$=this.loadAllAbsencesReports()}loadOpenAbsencesReports(){return x([this.absencesSelectionService.selectedWithoutPresenceType$,this.absencesSelectionService.selectedIds$]).pipe(R(([e,i])=>e.length===0&&i.length>0?this.getOpenAbsencesRecordIds(le(ie(i.map(n=>n.lessonIds)))):W([])),R(e=>this.reportsService.getStudentConfirmationReports(e)),O(1))}loadAllAbsencesReports(){return x([this.myAbsencesService.openLessonAbsences$,this.myAbsencesService.checkableLessonAbsences$,this.myAbsencesService.excusedLessonAbsences$,this.myAbsencesService.unexcusedLessonAbsences$,this.myAbsencesService.incidentsLessonAbsences$]).pipe(y(e=>this.getAllAbsencesRecordIds(ie(e))),R(e=>this.reportsService.getMyAbsencesReports(e)),O(1))}getAllAbsencesRecordIds(e){return e.map(i=>`${i.LessonRef.Id}_${i.RegistrationId}`)}getOpenAbsencesRecordIds(e){return this.myAbsencesService.openLessonAbsences$.pipe(y(i=>i.filter(n=>e.includes(n.LessonRef.Id)).map(n=>`${n.LessonRef.Id}_${n.RegistrationId}`)))}static{this.\u0275fac=function(i){return new(i||t)(u(Ot),u(_e),u(ue))}}static{this.\u0275cmp=I({type:t,selectors:[["bkd-my-absences-show"]],standalone:!0,features:[L],decls:70,vars:38,consts:[["checkableAbsences","ngbAccordionItem"],["openAbsences","ngbAccordionItem"],["excusedAbsences","ngbAccordionItem"],["unexcusedAbsences","ngbAccordionItem"],["incidents","ngbAccordionItem"],[1,"bkd-container","bkd-container-limited"],[1,"d-flex","justify-content-between","border-bottom","header"],[1,"ps-3"],[3,"reports"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[3,"click","opened"],[3,"absences$"],[3,"absences$","selectionService","defaultAbsenceSelectionMessage","reports"],[3,"absences$","displayPresenceType"]],template:function(i,n){if(i&1){let s=V();H(0),r(1,"async"),a(2,"div",5)(3,"h1"),d(4),r(5,"translate"),c(),a(6,"div",6)(7,"div"),d(8),r(9,"translate"),c(),a(10,"div",7),S(11,"bkd-reports-link",8),r(12,"async"),c()(),a(13,"div",9)(14,"div",10)(15,"div",11),S(16,"bkd-my-absences-report-link"),c(),a(17,"div",12)(18,"div",13),h(19,Gi,0,0,"ng-template"),c()()(),a(20,"div",10,0)(22,"div",11)(23,"bkd-student-dossier-entry-header",14),g("click",function(){T(s);let v=$(21);return k(v.toggle())}),d(24),r(25,"translate"),h(26,qi,1,1),c()(),a(27,"div",12)(28,"div",13),h(29,Ui,1,1,"ng-template"),c()()(),a(30,"div",10,1)(32,"div",11)(33,"bkd-student-dossier-entry-header",14),g("click",function(){T(s);let v=$(31);return k(v.toggle())}),d(34),r(35,"translate"),h(36,Wi,1,1),c()(),a(37,"div",12)(38,"div",13),h(39,Ki,3,9,"ng-template"),c()()(),a(40,"div",10,2)(42,"div",11)(43,"bkd-student-dossier-entry-header",14),g("click",function(){T(s);let v=$(41);return k(v.toggle())}),d(44),r(45,"translate"),h(46,Qi,1,1),c()(),a(47,"div",12)(48,"div",13),h(49,zi,1,1,"ng-template"),c()()(),a(50,"div",10,3)(52,"div",11)(53,"bkd-student-dossier-entry-header",14),g("click",function(){T(s);let v=$(51);return k(v.toggle())}),d(54),r(55,"translate"),h(56,Yi,1,1),c()(),a(57,"div",12)(58,"div",13),h(59,Xi,1,2,"ng-template"),c()()(),a(60,"div",10,4)(62,"div",11)(63,"bkd-student-dossier-entry-header",14),g("click",function(){T(s);let v=$(61);return k(v.toggle())}),d(64),r(65,"translate"),h(66,Ji,1,1),c()(),a(67,"div",12)(68,"div",13),h(69,Zi,1,1,"ng-template"),c()()()()()}if(i&2){let s,p=$(21),v=$(31),A=$(41),B=$(51),K=$(61),M=ee(l(1,18,n.myAbsencesService.counts$));o(4),w(l(5,21,"my-absences.title")),o(4),w(l(9,23,"my-absences.description")),o(3),b("reports",(s=l(12,25,n.allAbsencesReports$))!==null&&s!==void 0?s:te(37,ri)),o(12),b("opened",!p.collapsed),o(),f(" ",l(25,27,"shared.profile.checkable-absences")," "),o(2),C((M==null?null:M.checkableAbsences)!==null?26:-1),o(7),b("opened",!v.collapsed),o(),f(" ",l(35,29,"shared.profile.open-absences")," "),o(2),C((M==null?null:M.openAbsences)!==null?36:-1),o(7),b("opened",!A.collapsed),o(),f(" ",l(45,31,"shared.profile.excused-absences")," "),o(2),C((M==null?null:M.excusedAbsences)!==null?46:-1),o(7),b("opened",!B.collapsed),o(),f(" ",l(55,33,"shared.profile.unexcused-absences")," "),o(2),C((M==null?null:M.unexcusedAbsences)!==null?56:-1),o(7),b("opened",!K.collapsed),o(),f(" ",l(65,35,"shared.profile.incidents")," "),o(2),C((M==null?null:M.incidents)!==null?66:-1)}},dependencies:[Pt,gt,vt,ht,oi,_t,yt,Bt,Et,X,E,D],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem}"],changeDetection:0})}}return t})();var ci=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=I({type:t,selectors:[["bkd-my-absences"]],standalone:!0,features:[re([_e,ue]),L],decls:1,vars:0,template:function(i,n){i&1&&S(0,"router-outlet")},dependencies:[Te],changeDetection:0})}}return t})();var Qs=[{path:"",component:ci,children:[{path:"",component:ai},{path:"confirm",component:Xt},{path:"report",component:si,children:[{path:"",component:ni,data:{restoreScrollPositionFrom:["/my-absences/report/confirm"]}},{path:"confirm",component:ei}]}]}];export{Qs as MY_ABSENCES_ROUTES};
