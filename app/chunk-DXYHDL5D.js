import{b as v}from"./chunk-DMYOU5OM.js";import{e as P}from"./chunk-Q5U6YZUT.js";import{B as d,C as f,E as m,G as u,J as l,L as h,Q as b,W as F,e as a,f as c,m as i,n as $,v as n,w as g,wa as S,xd as x,zd as y}from"./chunk-T7QWSMKM.js";var q="page",M=(()=>{let r=class r{constructor(e,s,E,R,I){this.location=e,this.loadingService=s,this.sortService=E,this.settings=R,this.loading$=this.loadingService.loading$,this.loadingPage$=this.loadingService.loading(q),this.sorting$=this.sortService.sorting$,this.filter$=new c(this.getInitialFilter()),this.isFilterValid$=this.filter$.pipe(i(this.isValidFilter.bind(this))),this.validFilter$=this.filter$.pipe(g(this.isValidFilter.bind(this)),u(y),h(1)),this.resetEntries$=new a,this.nextPage$=new a,this.page$=n(this.nextPage$.pipe(i(()=>"next")),n(this.resetEntries$,this.validFilter$,this.sorting$).pipe(i(()=>"reset"))).pipe(l((t,p)=>p==="next"?t+1:0,0)),this.offset$=this.page$.pipe(i(t=>t*this.settings.paginationLimit)),this.pageResult$=$([this.validFilter$,this.sorting$,this.offset$]).pipe(f(10),d(P(this.loadEntries.bind(this))),h(1)),this.entries$=n(n(this.resetEntries$,this.validFilter$,this.sorting$).pipe(i(()=>({action:"reset"}))),this.pageResult$.pipe(i(t=>t.offset===0?{action:"reset",entries:t.entries}:{action:"append",entries:t.entries}))).pipe(l(this.entriesActionReducer.bind(this),[]),h(1)),this.total$=this.pageResult$.pipe(i(({total:t})=>t)),this.hasMore$=this.pageResult$.pipe(i(({offset:t,total:p})=>t<p-this.settings.paginationLimit)),this.queryParams$=this.filter$.pipe(i(this.buildParamsFromFilter.bind(this))),this.queryParamsString$=this.queryParams$.pipe(i(v)),this.destroy$=new a,this.queryParamsString$.pipe(b(this.destroy$)).subscribe(t=>this.location.replaceState(I,t)),this.sortService.setSorting(this.getInitialSorting())}ngOnDestroy(){this.destroy$.next()}setFilter(e){this.filter$.next(x(e))}nextPage(){this.hasMore$.pipe(m(1)).subscribe(e=>{e&&this.nextPage$.next()})}resetEntries(){this.resetEntries$.next()}getInitialSorting(){return null}entriesActionReducer(e,s){switch(s.action){case"append":return[...e,...s.entries];case"reset":return s.entries?s.entries:[];default:return e}}};r.\u0275fac=function(s){S()},r.\u0275prov=F({token:r,factory:r.\u0275fac});let o=r;return o})();export{q as a,M as b};
