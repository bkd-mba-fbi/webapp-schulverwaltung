import{a as _e}from"./chunk-Y4QYVF5K.js";import{a as Te}from"./chunk-HII3S2DL.js";import{b as Ge,c as Ee,d as Pe}from"./chunk-RFO4NYUO.js";import{b as we}from"./chunk-FTDG26ID.js";import{a as _t,b as dt}from"./chunk-SOHFFTKU.js";import{A as Tt,a as Ie,b as be,c as Se,d as ve,e as xe,p as Ce,q as ye,u as yt}from"./chunk-C56YGDXA.js";import{$,$a as v,$c as vt,Ab as g,Ac as a,Bb as b,Bc as R,C as Dt,Cb as K,Cd as ot,Db as Zt,Dd as z,Eb as nt,Ec as E,Fc as C,Fd as Ct,G as Jt,Ga as T,Gb as te,Gc as St,Gd as k,Hd as j,Ia as m,Ic as Ot,J as Qt,Ja as Ft,L as Mt,Mc as o,O as G,Ob as ee,Q as Rt,Rb as rt,Rc as at,Sa as p,Sb as O,Ta as l,Tb as ie,Tc as se,Ua as et,Va as ft,Vb as H,Vc as q,W as F,Wa as ht,Wb as ne,Xb as re,Ya as it,Yc as ae,Z as y,_a as A,_c as kt,a as L,b as U,c as Kt,ca as Y,cb as It,cd as oe,dc as st,dd as de,e as mt,f as N,fd as le,g as pt,ga as W,ha as Z,hd as pe,ia as tt,ib as V,jb as u,k as $t,kb as w,kd as ce,l as qt,lb as x,ld as ue,m as I,md as me,n as ct,nd as ge,od as fe,r as gt,ra as Yt,rd as xt,sd as he,tb as M,ua as d,v as zt,va as D,vb as bt,w as Xt,zc as c}from"./chunk-XTHSYQMN.js";var ai=i=>({width:i});function oi(i,e){if(i&1&&(p(0,"option",3),u(1),g(2,"translate"),l()),i&2){let r=v();m("ngValue",null),d(),x(" ",b(2,2,r.emptyLabel)," ")}}function di(i,e){if(i&1&&(p(0,"option",3),u(1),l()),i&2){let r=e.$implicit;m("ngValue",r),d(),x(" ",r.Value," ")}}var $e=(()=>{let e=class e{constructor(){this.options=[],this.allowEmpty=!0,this.emptyLabel="",this.value=null,this.disabled=!1,this.tabindex=0,this.width="auto",this.valueChange=new Yt,this.options$=new N([]),this.rawValue$=new N(null),this.value$=ct([this.rawValue$,this.options$]).pipe(I(([t,n])=>n&&n.find(s=>s.Key===t)||null))}ngOnChanges(t){t.value&&this.rawValue$.next(t.value.currentValue),t.options&&this.options$.next(t.options.currentValue)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=$({type:e,selectors:[["bkd-select"]],inputs:{options:"options",allowEmpty:"allowEmpty",emptyLabel:"emptyLabel",value:"value",disabled:"disabled",tabindex:"tabindex",width:"width"},outputs:{valueChange:"valueChange"},standalone:!0,features:[W,M],decls:5,vars:10,consts:[[1,"form-select",3,"ngModelChange","tabindex","ngStyle","disabled","ngModel"],[3,"ngValue",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"]],template:function(n,s){n&1&&(p(0,"select",0),g(1,"async"),A("ngModelChange",function(_){return s.valueChange.emit(_&&_.Key)}),T(2,oi,3,4,"option",1)(3,di,2,2,"option",2),u(4,` >
`),l()),n&2&&(It("tabindex",s.tabindex),m("ngStyle",bt(8,ai,s.width))("disabled",s.disabled)("ngModel",b(1,6,s.value$)),d(2),m("ngIf",s.allowEmpty),d(),m("ngForOf",s.options))},dependencies:[xt,ue,me,ce,vt,de,O,rt,H,ie,j,k],changeDetection:0});let i=e;return i})();var De=C({Id:a,Designation:c,StudentCount:a,Number:c});var jt=C({Id:c,TestId:a,CourseRegistrationId:a,GradeId:o(a),GradeValue:o(a),GradeDesignation:o(c),Points:o(a),StudentId:a});var Me=C({Id:a,CourseId:a,Date:at,Designation:c,Weight:a,WeightPercent:a,IsPointGrading:R,MaxPoints:o(a),MaxPointsAdjusted:o(a),IsPublished:R,IsOwner:R,Owner:o(c),GradingScaleId:o(a),Results:o(E(jt))});var Re=C({Id:a}),Fe=St({HRef:o(c)}),li=St({HasEvaluationStarted:R,EvaluationUntil:o(at),HasReviewOfEvaluationStarted:R,HasTestGrading:R,Id:a}),pi=Ot([Re,Fe,li]),ci=St({Id:a,StudentCount:a}),ui=Ot([Re,Fe,ci]),mi=C({Grade:c,AverageTestResult:a,Id:a,StudentId:a}),Bt=C({AverageTestResult:a,CanGrade:R,EventId:a,GradeId:o(a),GradeValue:o(a),Id:a,StudentId:a}),lt=C({HRef:c,Id:a,Number:c,Designation:c,DateFrom:o(at),DateTo:o(at),StatusId:a,GradingScaleId:o(a),FinalGrades:o(E(mi)),Gradings:o(E(Bt)),Tests:o(E(Me)),EvaluationStatusRef:pi,AttendanceRef:ui,ParticipatingStudents:o(E(Ee)),Classes:o(E(De))}),Oe=C({TestResults:E(jt),Gradings:E(Bt)}),ke=C({Gradings:E(Bt)});var Gt=(()=>{let e=class e extends dt{constructor(t,n){super(t,n,lt,"Courses"),this.statusCodec=C(se(this.codec.props,["Id","StatusId","EvaluationStatusRef"]))}getNumberOfCoursesForRating(){return this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef&fields=Id,StatusId,EvaluationStatusRef&filter.StatusId=;10300;10240`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe(G(z(this.statusCodec)),I(t=>t.filter(n=>n.EvaluationStatusRef.HasEvaluationStarted===!0)),I(t=>t.length))}getExpandedCourses(t){return _e(t,"TeacherRole")?this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef,AttendanceRef,Classes,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe(G(z(lt))):$t([])}getExpandedCourse(t){return this.http.get(`${this.baseUrl}/${t}?expand=ParticipatingStudents,EvaluationStatusRef,Tests,Gradings,FinalGrades,Classes`).pipe(G(ot(lt)))}getExpandedCoursesForDossier(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades,EvaluationStatusRef,ParticipatingStudents,Classes&filter.StatusId=;${this.settings.eventlist.statusfilter}`).pipe(G(z(lt)))}getExpandedCoursesForStudent(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"StudentRole"}}).pipe(G(z(lt)))}add(t,n,s,f,_,B,h){let S={Tests:[{Date:n,Designation:s,Weight:f,IsPointGrading:_,MaxPoints:B,MaxPointsAdjusted:h}]};return this.http.put(`${this.baseUrl}/${t}/Tests/New`,S).pipe(I(()=>{}))}update(t,n,s,f,_,B,h,S){let Q={Tests:[{Id:n,Designation:s,Date:f,Weight:_,IsPointGrading:B,MaxPoints:h,MaxPointsAdjusted:S}]};return this.http.put(`${this.baseUrl}/${t}/Tests/Update`,Q).pipe(I(()=>{}))}delete(t,n){let s={TestIds:[n]};return this.http.put(`${this.baseUrl}/${t}/Tests/Delete`,s).pipe(I(()=>n))}updateTestResult(t,n){let S=n,{studentId:s,testId:f}=S,_=Kt(S,["studentId","testId"]),B={StudentIds:[s],TestId:f},h="gradeId"in _?U(L({},B),{GradeId:_.gradeId}):U(L({},B),{Points:_.points});return this.http.put(`${this.baseUrl}/${t}/SetTestResult`,h).pipe(G(ot(Oe)),G(({TestResults:Q,Gradings:Wt})=>Q.length<=1&&Wt.length===1?$t({courseId:t,testResult:Q[0]??null,grading:Wt[0]}):qt(()=>new Error("`TestResults` or `Gradings` does not contain a single value"))))}setAverageAsFinalGrade(t){return this.http.put(`${this.baseUrl}/SetAverageTestResult`,t).pipe(G(ot(ke)))}publishTest(t){let n={TestIds:[t]};return this.http.put(`${this.baseUrl}/PublishTest`,n).pipe(I(()=>t))}unpublishTest(t){let n={TestIds:[t]};return this.http.put(`${this.baseUrl}/UnpublishTest`,n).pipe(I(()=>t))}};e.\u0275fac=function(n){return new(n||e)(y(st),y(q))},e.\u0275prov=F({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();function Ne(i){return i.length===0?0:Nt(i.map(({value:e,weight:r})=>e*r))/Nt(i.map(({weight:e})=>e))}function At(i){return i.length===0?0:Number(Nt(i)/i.length)}function Nt(i){return i.reduce(gi,0)}function gi(i,e){return i+e}function xn(i,e,r){return i?i.Tests?.reduce((t,n)=>t||n.Id===e&&n.Results?.find(s=>s.TestId===e&&s.StudentId===r)||null,null)??null:null}function Cn(i,e,r){return e.map(t=>t.Id===i.TestId?Ht(i,t,r):t)}function yn(i,e,r){return r.map(t=>t.Id===i?fi(e,t):t)}function Tn(i,e){return e.map(r=>r.Id===i?U(L({},r),{IsPublished:!r.IsPublished}):r)}function _n(i){let e=Ii(i);if(e.length===0)throw new Error("unable to calculate averages without results");return At(e)}function Vt(i){return i.MaxPointsAdjusted||i.MaxPoints}function Gn(i){let e=hi(i);if(e.length===0)throw new Error("unable to calculate averages without results");return At(e)}function J(i,e){return e.Results?.find(r=>r.StudentId===i)}function En(i,e){return e===null?null:e.filter(r=>r.Id!==i)}function Ht(i,e,r){let t=r&&e.Results?.find(s=>s.TestId===i.TestId&&s.StudentId===i.StudentId),n=e.Results?.filter(s=>!(s.TestId===i.TestId&&s.StudentId===i.StudentId))||[];return t&&r==="grade"?i.GradeId=t.GradeId:t&&r==="points"&&(i.Points=t.Points),U(L({},e),{Results:[...n,i]})}function Ve(i){return i.slice().sort((e,r)=>r.Date.getTime()-e.Date.getTime())}function Et(i,e){return e?.find(r=>r.Id===i.GradingScaleId)||null}function fi(i,e){return U(L({},e),{Results:e.Results?.filter(r=>r.StudentId!==i)||[]})}function hi(i){return i.Results?.filter(e=>e.GradeDesignation!==null).map(e=>Number(e.GradeDesignation)).filter(e=>!isNaN(e))||[]}function Ii(i){return i.Results?.map(e=>e.Points!==null?e.Points:Ae).filter(e=>e>Ae)||[]}var Ae=-1;var Lt=C({Id:c,SubscriptionId:a,VssId:a,EventId:a,DropdownItems:o(E(Te)),IdPerson:a,ShowAsRadioButtons:R,Value:o(c)}),He=C({Id:a,CurrentWorkProgressId:o(c||o(a)),EventId:o(a),PersonId:o(a),Status:c,StatusId:o(a),IsOkay:o(R),IsQueued:o(R),EventDesignation:o(c),EventInformation:o(c||a),EventNotes:o(c||a),CheckPersonalInformation:o(R),CorrespondencePersonId:o(a),CorrespondenceAddressTypeId:o(c||a),Billing1PersonId:o(a),Billing1AddressTypeId:o(c||a),Billing2PersonId:o(c||a),Billing2AddressTypeId:o(c||a),KindOfPaymentId1:o(c||a),KindOfPaymentEmail1:o(c||a),KindOfPaymentId2:o(c||a),KindOfPaymentEmail2:o(c||a),IdObject:o(a),IdSubscription:o(a),IdStatus:o(a),AnsweredQuestions:o(c||a),Messages:o(c||a),SubscriptionDetails:o(E(Lt)),HRef:o(c)});var Le=(()=>{let e=class e extends dt{constructor(t,n){super(t,n,Lt,"Subscriptions")}getIdSubscriptionsByStudentAndCourse(t,n){return this.http.get(`${this.settings.apiUrl}/Subscriptions/?filter.PersonId==${t}&filter.EventId=;${n}`).pipe(G(z(He)))}};e.\u0275fac=function(n){return new(n||e)(y(st),y(q))},e.\u0275prov=F({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Si=C({Id:a,Designation:c}),Ut=C({Id:a,Grades:E(Si)});var Ue=(()=>{let e=class e extends dt{constructor(t,n){super(t,n,Ut,"GradingScales")}getGradingScale(t){return this.http.get(`${this.baseUrl}/${t}`).pipe(G(ot(Ut)))}getGradingScales(t){return gt(t.map(this.getGradingScale.bind(this)))}};e.\u0275fac=function(n){return new(n||e)(y(st),y(q))},e.\u0275prov=F({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var wt=(()=>{let e=class e{constructor(t,n,s,f,_,B){this.coursesRestService=t,this.subscriptionRestService=n,this.reportsService=s,this.loadingService=f,this.gradingScalesRestService=_,this.settings=B,this.studentId$=new pt(1),this.initialStudentCourses$=this.studentId$.pipe(Jt(),G(this.loadCourses.bind(this)),I(h=>h.sort((S,Q)=>S.Designation.localeCompare(Q.Designation))),Mt(1)),this.action$=new pt(1),this.studentCourses$=zt(this.action$,this.initialStudentCourses$.pipe(I(h=>({type:"initializeCourses",payload:h})))).pipe(Qt(this.coursesReducer.bind(this),[]),Mt(1)),this.loading$=this.loadingService.loading$,this.studentCourseIds$=this.studentCourses$.pipe(I(h=>h.flatMap(S=>S.Id))),this.idSubscriptions$=ct([this.studentId$,this.studentCourseIds$]).pipe(G(([h,S])=>this.subscriptionRestService.getIdSubscriptionsByStudentAndCourse(h,S))),this.ids$=this.idSubscriptions$.pipe(I(h=>h.map(S=>S.Id))),this.testReports$=this.ids$.pipe(I(h=>this.reportsService.getTeacherSubscriptionReports(h))),this.tests$=this.studentCourses$.pipe(I(h=>h.flatMap(S=>S.Tests).filter(yt))),this.gradingScaleIdsFromTests$=this.tests$.pipe(I(h=>[...h.map(S=>S.GradingScaleId)].filter(yt).filter(Tt))),this.gradingScaleIdsFromCourses$=this.studentCourses$.pipe(I(h=>h.flatMap(S=>S.GradingScaleId).filter(yt).filter(Tt))),this.gradingScaleIds$=ct([this.gradingScaleIdsFromCourses$,this.gradingScaleIdsFromTests$]).pipe(I(([h,S])=>h.concat(S).filter(Tt))),this.gradingScales$=this.gradingScaleIds$.pipe(G(h=>gt(h.map(S=>this.gradingScalesRestService.getGradingScale(S)))))}setStudentId(t){this.studentId$.next(t)}getFinalGradeForStudent(t,n){return t?.FinalGrades?.find(s=>s.StudentId===n)}getGradingForStudent(t,n){return t?.Gradings?.find(s=>s.StudentId===n)}getGradingScaleOfCourse(t,n){return n?.find(s=>s.Id===t.GradingScaleId)}getGradesForStudent(t,n,s){return t.Tests?.flatMap(f=>({value:Number(Et(f,s)?.Grades.find(B=>B.Id===J(n,f)?.GradeId)?.Designation),weight:f.Weight})).filter(({value:f})=>!!f)||[]}updateStudentCourses(t){this.action$.next({type:"updateCourses",payload:t})}loadCourses(t){return this.loadingService.load(this.coursesRestService.getExpandedCoursesForDossier().pipe(I(n=>n.filter(s=>s.ParticipatingStudents?.find(f=>f.Id===t)))))}coursesReducer(t,n){switch(n.type){case"initializeCourses":return n.payload;case"updateCourses":return this.updateCourses([...t],n.payload);default:return t}}updateCourses(t,n){return t.map(s=>U(L({},s),{Tests:s.Tests!==null?s.Tests.map(f=>f.Id===n.Id?n:f):null}))}};e.\u0275fac=function(n){return new(n||e)(y(Gt),y(Le),y(Pe),y(we),y(Ue),y(q))},e.\u0275prov=F({token:e,factory:e.\u0275fac});let i=e;return i})();var Ke=(()=>{let e=class e{constructor(){}get inIframe(){return window.parent!==window}get window(){return this.inIframe?window.parent:null}get document(){return this.window?.document.documentElement??null}querySelector(t){return this.window?.document?.querySelector("bkd-portal")?.shadowRoot?.querySelector(t)??null}getIframeElement(){return this.querySelector("bkd-content")?.shadowRoot?.querySelector("iframe")??null}getIframeTop(){return this.getIframeElement()?.offsetTop??0}getIFrameBottom(){let t=this.getIframeElement();return t?t.offsetTop+t.offsetHeight:0}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=F({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var qe=(()=>{let e=class e{constructor(t,n){this.modal=t,this.portal=n}open(...t){let n=this.modal.open(...t);return this.applyPortalOffsetAndMaxHeight(n),this.disablePortalScrolling(n),n}get activeInstances(){return this.modal.activeInstances}dismissAll(...t){return this.modal.dismissAll(...t)}hasOpenModals(...t){return this.modal.hasOpenModals(...t)}applyPortalOffsetAndMaxHeight(t){let n=this.getModalWindowElement(t);if(!n){console.warn("Trying to apply portal offset to <ngb-modal-window>, but element is not present!");return}this.portal.window&&(n.style.top=`${this.getModalIframeOffset()}px`,n.style.maxHeight=`${this.getModalHeight()}px`)}disablePortalScrolling(t){if(this.portal.window&&this.portal.document){let n=this.portal.window.innerWidth-this.portal.document.clientWidth;this.portal.document.style.paddingRight=`${n}px`,this.portal.document.style.overflow="hidden"}t.hidden.subscribe(()=>{this.portal.document&&(this.portal.document.style.paddingRight="0px",this.portal.document.style.overflow="auto")})}getModalWindowElement(t){return t._windowCmptRef?.instance?._elRef?.nativeElement??null}getModalIframeOffset(){return Math.max(this.getViewportTop()-this.portal.getIframeTop(),0)}getModalTop(){return Math.max(this.getViewportTop(),this.portal.getIframeTop())}getModalBottom(){return Math.min(this.getViewportBottom(),this.portal.getIFrameBottom())}getModalHeight(){return this.getModalBottom()-this.getModalTop()}getViewportTop(){return this.portal.window?.scrollY??0}getViewportBottom(){return this.getViewportTop()+this.getViewportHeight()}getViewportHeight(){return this.portal.window?.innerHeight??0}};e.\u0275fac=function(n){return new(n||e)(y(ye),y(Ke))},e.\u0275prov=F({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();function Pt(i,e,r){return e?e.Grade:Ti(i,r)||i?.GradeValue}function Ti(i,e){return e?.Grades.find(r=>r.Id===i?.GradeId)?.Designation}var _i="1-3",Xe="\u2013",Je=(()=>{let e=class e{constructor(t){this.locale=t}transform(t,n,s){let f=Number(t??null);return isNaN(f)?Xe:Gi(Number(t??null),s??this.locale,n)}};e.\u0275fac=function(n){return new(n||e)(D(te,16))},e.\u0275pipe=Y({name:"decimalOrDash",type:e,pure:!0,standalone:!0});let i=e;return i})();function Gi(i,e,r){return i===0?Xe:ee(i,e,`1.${Ei(r)}`)}function Ei(i){return i?String(i).includes("-")?String(i):`${i}-${i}`:_i}var Qe=(()=>{let e=class e{constructor(){}getGradeForStudent(){return Pt(this.grading,this.finalGrade,this.gradingScale)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=$({type:e,selectors:[["bkd-dossier-grades-final-grade"]],inputs:{finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},standalone:!0,features:[M],decls:14,vars:11,consts:[[1,"final-entry"],["data-testid","final-grade"],["data-testid","average-test-results"]],template:function(n,s){n&1&&(p(0,"div",0)(1,"div"),u(2),g(3,"translate"),l(),p(4,"div",1)(5,"span"),u(6),l()(),p(7,"div"),u(8),g(9,"translate"),l(),p(10,"div",2)(11,"span"),u(12),g(13,"decimalOrDash"),l()()()),n&2&&(d(2),w(b(3,4,"dossier.grade")),d(4),w(s.getGradeForStudent()||"\u2013"),d(2),w(b(9,6,"dossier.average")),d(4),w(K(13,8,s.average,"1-3")))},dependencies:[j,k,Je],styles:[".final-entry[_ngcontent-%COMP%]{padding:1rem;display:grid;grid-template-columns:repeat(2,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}"]});let i=e;return i})();var Ye=(()=>{let e=class e{constructor(t){this.translate=t}transform(t,n,s,f="tests.points"){return t.IsPointGrading&&(t.IsPublished||s)?`${J(n,t)?.Points||"\u2013"} / ${t.MaxPointsAdjusted||t.MaxPoints} ${this.translate.instant(f)}`:""}};e.\u0275fac=function(n){return new(n||e)(D(Ct,16))},e.\u0275pipe=Y({name:"bkdTestPoints",type:e,pure:!0,standalone:!0});let i=e;return i})();var Ze=(()=>{let e=class e{constructor(t){this.translate=t}transform(t){return`${this.translate.instant("tests.factor")} ${t.Weight} (${t.WeightPercent}%)`}};e.\u0275fac=function(n){return new(n||e)(D(Ct,16))},e.\u0275pipe=Y({name:"bkdTestWeight",type:e,pure:!0,standalone:!0});let i=e;return i})();var wi=i=>({maxPoints:i});function Pi(i,e){if(i&1&&(p(0,"div",15),u(1),g(2,"translate"),l()),i&2){let r=v(2);d(),x(" ",K(2,1,"global.validation-errors.invalidPoints",bt(4,wi,r.maxPoints))," ")}}function $i(i,e){if(i&1){let r=it();p(0,"div",11)(1,"label",12),u(2),g(3,"translate"),l(),p(4,"div",6)(5,"input",13,0),A("input",function(){Z(r);let n=V(6),s=v();return tt(s.onPointsChange(n.value))}),l()(),T(7,Pi,3,6,"div",14),l()}if(i&2){let r=v();d(2),w(b(3,8,"dossier.dialog.points")),d(2),Ft("is-invalid",r.pointsInput.errors),d(),Ft("is-invalid",r.pointsInput.errors),It("max",r.maxPoints),m("formControl",r.pointsInput),d(2),m("ngIf",r.pointsInput.errors)}}var ti=500,ei=(()=>{let e=class e{constructor(t,n){this.activeModal=t,this.courseService=n,this.maxPoints=0,this.gradeSubject$=new mt,this.pointsSubject$=new mt,this.closeButtonDisabled$=new N(!1),this.gradingScaleDisabled$=new N(!0),this.grade$=this.gradeSubject$.pipe(Dt(ti)),this.points$=this.pointsSubject$.pipe(Dt(ti),Xt(this.isValid.bind(this)),I(Number)),this.destroy$=new mt}ngOnInit(){this.maxPoints=Vt(this.test),this.pointsInput=new oe({value:this.points,disabled:!1},[kt.min(0),kt.pattern("[0-9]+([\\.][0-9]+)?"),this.maxPointValidator()]),this.gradingScaleDisabled$.next(this.test.IsPointGrading&&this.points>0),this.points$.pipe(Rt(this.destroy$)).subscribe(t=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,points:t})),this.grade$.pipe(Rt(this.destroy$)).subscribe(t=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,gradeId:t}))}onGradeChange(t){this.gradeSubject$.next(t)}onPointsChange(t){this.pointsSubject$.next(t),this.gradingScaleDisabled$.next(t.length>0)}updateTestResult(t){this.closeButtonDisabled$.next(!0),this.courseService.updateTestResult(this.test.CourseId,t).subscribe(({testResult:n})=>{this.gradeId=n?.GradeId??null,this.updatedTestResult=n,this.closeButtonDisabled$.next(!1)})}isValid(t){return t===""||isNaN(Number(t))?!1:!(Number(t)<0||Number(t)>this.maxPoints)}maxPointValidator(){return t=>Number(t.value)>Vt(this.test)?{customMax:!0}:null}};e.\u0275fac=function(n){return new(n||e)(D(Ce),D(Gt))},e.\u0275cmp=$({type:e,selectors:[["bkd-dossier-grades-edit"]],inputs:{test:"test",gradeId:"gradeId",gradeOptions:"gradeOptions",points:"points",studentId:"studentId"},standalone:!0,features:[M],decls:19,vars:20,consts:[["pointInput",""],[1,"modal-body"],[1,"mb-4"],["class","form-group row",4,"ngIf"],[1,"form-group","row","mt-2"],["for","grade",1,"col-6","col-form-label"],[1,"col-6"],["id","grade",3,"valueChange","options","value","allowEmpty","disabled"],[1,"text-muted","mt-4"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"form-group","row"],["for","points",1,"col-6","col-form-label"],["id","points","type","number","step","0.01","min","0",1,"form-control",3,"input","max","formControl"],["class","invalid-feedback col-6 offset-6","data-testid","validation-error-message",4,"ngIf"],["data-testid","validation-error-message",1,"invalid-feedback","col-6","offset-6"]],template:function(n,s){n&1&&(p(0,"div",1)(1,"p",2),u(2),l(),T(3,$i,8,10,"div",3),p(4,"div",4)(5,"label",5),u(6),g(7,"translate"),l(),p(8,"div",6)(9,"bkd-select",7),g(10,"async"),A("valueChange",function(_){return _&&s.onGradeChange(_)}),l()()(),p(11,"p",8),u(12),g(13,"translate"),l()(),p(14,"div",9)(15,"button",10),g(16,"async"),A("click",function(){return s.activeModal.close(s.updatedTestResult)}),u(17),g(18,"translate"),l()()),n&2&&(d(2),w(s.test.Designation),d(),m("ngIf",s.test.IsPointGrading),d(3),w(b(7,10,"dossier.dialog.grade")),d(3),m("options",s.gradeOptions)("value",s.gradeId)("allowEmpty",!1)("disabled",b(10,12,s.gradingScaleDisabled$)),d(3),x(" ",b(13,14,s.test.IsPointGrading?"dossier.dialog.hint.points":"dossier.dialog.hint.grade")," "),d(3),m("disabled",b(16,16,s.closeButtonDisabled$)),d(2),x(" ",b(18,18,"dossier.dialog.close")," "))},dependencies:[O,xt,ae,le,vt,fe,ge,he,pe,$e,H,j,k]});let i=e;return i})();function Di(i,e){if(i&1){let r=it();p(0,"a",11),A("click",function(){Z(r);let n=v().bkdLet,s=v();return tt(s.editGrading(n))}),p(1,"i",12),u(2,"edit"),l(),p(3,"span",13),u(4),g(5,"async"),l()()}if(i&2){let r=v(2);d(4),w(b(5,1,r.grading$))}}function Mi(i,e){if(i&1&&(p(0,"span",13),u(1),g(2,"async"),l()),i&2){let r=v(2);d(),w(b(2,1,r.grading$))}}function Ri(i,e){if(i&1&&(p(0,"div",14),u(1),g(2,"translate"),l()),i&2){let r=v().bkdLet;d(),x(" ",b(2,1,r.IsPublished?"tests.published":"tests.not-published")," ")}}function Fi(i,e){if(i&1&&(p(0,"div",2)(1,"div",3),u(2),l(),p(3,"div",4),u(4),g(5,"date"),l(),p(6,"div",5),T(7,Di,6,3,"a",6)(8,Mi,3,3,"ng-template",null,0,nt),l(),p(10,"div",7),u(11),g(12,"bkdTestWeight"),l(),p(13,"div",8)(14,"span"),u(15),g(16,"bkdTestPoints"),l()(),p(17,"div",9),u(18),l(),T(19,Ri,3,3,"div",10),l()),i&2){let r=e.bkdLet,t=V(9),n=v();d(2),x(" ",r.Designation," "),d(2),x(" ",K(5,8,r.Date,"dd.MM.yyyy")," "),d(3),m("ngIf",n.isEditable&&r.IsOwner)("ngIfElse",t),d(4),x(" ",b(12,11,r)," "),d(4),w(Zt(16,13,r,n.studentId,n.isEditable,"dossier.points")),d(3),x(" ",r.Owner," "),d(),m("ngIf",n.isEditable)}}var ii=(()=>{let e=class e{constructor(t,n){this.gradeService=t,this.modalService=n,this.test$=new pt(1),this.grading$=this.test$.pipe(I(this.getGrading.bind(this)))}ngOnChanges(t){t.test&&this.test$.next(this.test)}editGrading(t){let n=this.modalService.open(ei,{backdrop:"static"});n.componentInstance.test=t,n.componentInstance.gradeId=this.getGradeId(t),n.componentInstance.gradeOptions=e.mapToOptions(this.gradingScale),n.componentInstance.studentId=this.studentId,n.componentInstance.points=this.getPoints(t),n.result.then(s=>{s&&this.updateStudentGrade(s,t)},()=>{})}updateStudentGrade(t,n){let s=Ht(t,n);this.gradeService.updateStudentCourses(s)}getGrading(t){return this.gradingScale?.Grades.find(n=>n.Id===this.getGradeId(t))?.Designation||"\u2013"}getGradeId(t){return J(this.studentId,t)?.GradeId||null}getPoints(t){return J(this.studentId,t)?.Points||null}static mapToOptions(t){return t?.Grades.map(n=>({Key:n.Id,Value:n.Designation}))||null}};e.\u0275fac=function(n){return new(n||e)(D(wt),D(qe))},e.\u0275cmp=$({type:e,selectors:[["bkd-dossier-single-test"]],inputs:{test:"test",studentId:"studentId",gradingScale:"gradingScale",isEditable:"isEditable"},standalone:!0,features:[W,M],decls:2,vars:3,consts:[["notEditable",""],["class","test-entry",4,"bkdLet"],[1,"test-entry"],["data-testid","test-designation",1,"designation"],["data-testid","test-date",1,"date"],[1,"grade"],["class","btn btn-link","aria-label","edit grade",3,"click",4,"ngIf","ngIfElse"],["data-testid","test-factor",1,"factor"],["data-testid","test-points",1,"points"],["data-testid","test-teacher",1,"teacher"],["class","state","data-testid","test-status",4,"ngIf"],["aria-label","edit grade",1,"btn","btn-link",3,"click"],["data-testid","test-grade-edit-icon",1,"material-icons"],["data-testid","test-grade"],["data-testid","test-status",1,"state"]],template:function(n,s){n&1&&(T(0,Fi,20,18,"div",1),g(1,"async")),n&2&&m("bkdLet",b(1,1,s.test$))},dependencies:[_t,O,H,ne,j,k,Ye,Ze],styles:['.test-entry[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1rem;display:grid;grid-template-areas:"designation designation grade factor" "date date points ." "teacher teacher . ." "state state . .";grid-template-columns:repeat(4,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}.designation[_ngcontent-%COMP%]{grid-area:designation}.date[_ngcontent-%COMP%]{grid-area:date}.grade[_ngcontent-%COMP%]{grid-area:grade}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;color:#000;padding:0;text-decoration:none}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.grade[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:-1em;color:#00000080}.points[_ngcontent-%COMP%]{grid-area:points;color:#00000080}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.state[_ngcontent-%COMP%]{grid-area:state}@media (max-width: 575.98px){.test-entry[_ngcontent-%COMP%]{grid-template-areas:"designation designation" "date grade" "factor points" "teacher teacher" "state state";grid-template-columns:repeat(2,1fr)}}']});let i=e;return i})();function Oi(i,e){if(i&1&&et(0,"bkd-dossier-single-test",5),i&2){let r=e.$implicit,t=v(3);m("test",r)("studentId",t.studentId)("gradingScale",t.getGradingScaleOfTest(r))("isEditable",t.isEditable)}}function ki(i,e){if(i&1&&(p(0,"div"),et(1,"bkd-dossier-grades-final-grade",3),T(2,Oi,1,4,"bkd-dossier-single-test",4),l()),i&2){let r=v().bkdLet,t=v();d(),m("finalGrade",t.decoratedCourse.finalGrade)("grading",t.decoratedCourse.grading)("gradingScale",t.decoratedCourse.gradingScale)("average",t.decoratedCourse.average),d(),m("ngForOf",r)}}function ji(i,e){i&1&&(p(0,"p",6),u(1),g(2,"translate"),l()),i&2&&(d(),x(" ",b(2,1,"dossier.no-tests")," "))}function Bi(i,e){if(i&1&&(ft(0),T(1,ki,3,5,"div",2)(2,ji,3,3,"ng-template",null,0,nt),ht()),i&2){let r=e.bkdLet,t=V(3);d(),m("ngIf",r.length>0)("ngIfElse",t)}}var ni=(()=>{let e=class e{ngOnChanges(t){t.decoratedCourse&&this.sortedTests$.next(this.sortedTests())}constructor(){this.sortedTests$=new N([])}sortedTests(){return this.decoratedCourse.course.Tests?Ve(this.decoratedCourse.course.Tests):[]}getGradingScaleOfTest(t){return Et(t,this.gradingScales)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=$({type:e,selectors:[["bkd-dossier-course-tests"]],inputs:{studentId:"studentId",decoratedCourse:"decoratedCourse",gradingScales:"gradingScales",isEditable:"isEditable"},standalone:!0,features:[W,M],decls:2,vars:3,consts:[["noTests",""],[4,"bkdLet"],[4,"ngIf","ngIfElse"],[3,"finalGrade","grading","gradingScale","average"],[3,"test","studentId","gradingScale","isEditable",4,"ngFor","ngForOf"],[3,"test","studentId","gradingScale","isEditable"],["data-testid","message-no-tests",1,"p-3"]],template:function(n,s){n&1&&(T(0,Bi,4,2,"ng-container",1),g(1,"async")),n&2&&m("bkdLet",b(1,1,s.sortedTests$))},dependencies:[_t,O,Qe,rt,ii,H,j,k]});let i=e;return i})();function Ni(i,e){if(i&1&&(p(0,"span",2),u(1),l()),i&2){let r=v();d(),x(" (",r.grade,")")}}function Ai(i,e){if(i&1&&(p(0,"span",3),u(1),g(2,"number"),l()),i&2){let r=v();d(),x(" (",K(2,1,r.average,"1.1-3"),")")}}var ri=(()=>{let e=class e{constructor(){}get grade(){return this.getGradeForStudent()}getGradeForStudent(){return Pt(this.grading,this.finalGrade,this.gradingScale)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=$({type:e,selectors:[["bkd-dossier-grades-course-header"]],inputs:{designation:"designation",finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},standalone:!0,features:[M],decls:3,vars:3,consts:[["class","grade","data-testId","grade",4,"ngIf"],["class","average","data-testId","average",4,"ngIf"],["data-testId","grade",1,"grade"],["data-testId","average",1,"average"]],template:function(n,s){n&1&&(u(0),T(1,Ni,2,1,"span",0)(2,Ai,3,4,"span",1)),n&2&&(w(s.designation),d(),m("ngIf",s.grade),d(),m("ngIf",!s.grade&&s.average))},dependencies:[O,re],styles:[".average[_ngcontent-%COMP%]{color:#00000080}"]});let i=e;return i})();function Vi(i,e){if(i&1&&et(0,"bkd-dossier-course-tests",11),i&2){let r=v().$implicit,t=v(2);m("decoratedCourse",r)("studentId",t.studentId)("gradingScales",t.gradingScales)("isEditable",t.isEditable)}}function Hi(i,e){if(i&1){let r=it();p(0,"div")(1,"div",4)(2,"div",5,1)(4,"div",6)(5,"bkd-student-dossier-entry-header",7),A("click",function(){Z(r);let n=V(3);return tt(n.toggle())}),et(6,"bkd-dossier-grades-course-header",8),l()(),p(7,"div",9)(8,"div",10),T(9,Vi,1,4,"ng-template"),l()()()()()}if(i&2){let r=e.$implicit,t=V(3);d(5),m("opened",!t.collapsed),d(),m("designation",r.course.Designation)("finalGrade",r.finalGrade)("grading",r.grading)("gradingScale",r.gradingScale)("average",r.average)}}function Li(i,e){if(i&1&&(ft(0),T(1,Hi,10,6,"div",3),g(2,"async"),ht()),i&2){let r=v();d(),m("ngForOf",b(2,2,r.decoratedCoursesSubject$))("ngForTrackBy",r.trackByCourseId)}}function Ui(i,e){i&1&&(p(0,"p",12),u(1),g(2,"translate"),l()),i&2&&(d(),x(" ",b(2,1,"dossier.no-courses")," "))}var Ur=(()=>{let e=class e{constructor(t){this.dossierGradeService=t,this.isEditable=!0,this.decoratedCoursesSubject$=new N([])}ngOnChanges(){this.decoratedCoursesSubject$.next(this.decorateCourses())}trackByCourseId(t,n){return n.course.Id}decorateCourses(){return this.courses?.map(t=>{let n=this.dossierGradeService.getFinalGradeForStudent(t,this.studentId),s=this.dossierGradeService.getGradesForStudent(t,this.studentId,this.gradingScales);return{course:t,finalGrade:n,grading:this.dossierGradeService.getGradingForStudent(t,this.studentId),gradingScale:this.dossierGradeService.getGradingScaleOfCourse(t,this.gradingScales),average:n?.AverageTestResult||Ne(s)}})}};e.\u0275fac=function(n){return new(n||e)(D(wt))},e.\u0275cmp=$({type:e,selectors:[["bkd-dossier-grades-view"]],inputs:{courses:"courses",studentId:"studentId",gradingScales:"gradingScales",isEditable:"isEditable"},standalone:!0,features:[W,M],decls:3,vars:2,consts:[["noCourses",""],["courses","ngbAccordionItem"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf","ngForTrackBy"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],[3,"designation","finalGrade","grading","gradingScale","average"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[3,"decoratedCourse","studentId","gradingScales","isEditable"],["data-testid","message-no-courses",1,"py-3"]],template:function(n,s){if(n&1&&T(0,Li,3,4,"ng-container",2)(1,Ui,3,3,"ng-template",null,0,nt),n&2){let f,_=V(2);m("ngIf",((f=s.courses==null?null:s.courses.length)!==null&&f!==void 0?f:0)>0)("ngIfElse",_)}},dependencies:[O,rt,xe,ve,Se,Ge,ri,be,Ie,ni,H,j,k]});let i=e;return i})();export{At as a,xn as b,Cn as c,yn as d,Tn as e,_n as f,Gn as g,En as h,Ve as i,Xe as j,Je as k,Gi as l,$e as m,De as n,Bt as o,Gt as p,Lt as q,Le as r,Ue as s,wt as t,Ke as u,qe as v,Ur as w};
