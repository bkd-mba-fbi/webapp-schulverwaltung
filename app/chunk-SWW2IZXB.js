import{a as Fe,b as Me,c as Ve,d as Re,e as Ne}from"./chunk-QNGDMYF2.js";import{t as N,w as Ge}from"./chunk-5FFJJJZ5.js";import{d as Le,e as Be}from"./chunk-VF44T6U3.js";import{b as ie}from"./chunk-VNNH2VUZ.js";import{a as je}from"./chunk-HLEZ4C3Q.js";import{L as Pe,P as te,T as Ee,U as Oe}from"./chunk-G2L3C6GE.js";import{a as we}from"./chunk-KCOBA4SV.js";import{b as ne}from"./chunk-GWJDWK72.js";import{c as J,d as K,e as X,f as Z,g as ee}from"./chunk-7TIAFCYF.js";import{a as $e}from"./chunk-LXT7D3OU.js";import{$a as a,Ab as g,Bb as y,Bc as ke,Cb as v,Cc as De,Db as z,Eb as T,Fb as ce,Gb as de,Kb as d,L as _e,La as c,Lb as m,M as be,Mb as ge,O as ae,P as j,Qa as p,Qd as Te,R as W,Ra as he,Rd as R,Sd as G,Va as _,Wa as ve,X as Y,Ya as H,Za as q,_ as B,_a as r,a as F,aa as k,ab as b,b as M,eb as V,ec as E,ed as Ie,f as Q,fc as ye,g as le,gb as $,h as re,hb as l,ia as D,ib as Ce,ja as I,jb as xe,k as me,l as ue,n as L,o as fe,qb as h,rb as u,sb as U,tb as f,ya as i,yc as Se,za as x,zc as Ae}from"./chunk-TTJNYD2F.js";var se=(()=>{class e{constructor(t,n,s,C,w){this.settings=t,this.lessonPresencesService=n,this.presenceTypesService=s,this.toastService=C,this.translate=w,this.studentId$=new re(1),this.checkableAbsences$=this.getAbsences(this.loadCheckableAbsences.bind(this)),this.openAbsences$=this.getAbsences(this.loadOpenAbsences.bind(this)),this.excusedAbsences$=this.getAbsences(this.loadExcusedAbsences.bind(this)),this.unexcusedAbsences$=this.getAbsences(this.loadUnexcusedAbsences.bind(this)),this.incidents$=this.getAbsences(this.loadIncidents.bind(this)),this.halfDays$=this.getAbsences(this.loadHalfDays.bind(this)),this.counts$=this.getCounts()}setStudentId(t){this.studentId$.next(t)}getAbsences(t){return this.studentId$.pipe(j(t),ae(null),_e({connector:()=>new re(1)}))}getCounts(){return this.studentId$.pipe(j(t=>fe([this.loadStatistics(t).pipe(ae(null)),this.openAbsences$.pipe(L(n=>n?.length??null)),this.checkableAbsences$.pipe(L(n=>n?.length??null))])),L(([t,n,s])=>({openAbsences:n,checkableAbsences:s,excusedAbsences:t?.TotalAbsencesValidExcuse??null,unexcusedAbsences:t?.TotalAbsencesWithoutExcuse??null,incidents:t?.TotalIncidents??null,halfDays:t?.TotalHalfDays??null})))}loadStatistics(t){return this.lessonPresencesService.getStatistics({student:t,educationalEvent:null,studyClass:null},null,0).pipe(j(({entries:n})=>n.length>0?ue(n[0]):(this.toastService.error(this.translate.instant("global.rest-errors.notfound-message"),this.translate.instant("global.rest-errors.notfound-title")),me)))}loadOpenAbsences(t){return this.lessonPresencesService.getListOfUnconfirmed(this.getBaseParams(t))}loadCheckableAbsences(t){return this.lessonPresencesService.getList({params:M(F({},this.getBaseParams(t)),{"filter.ConfirmationStateId":`=${this.settings.checkableAbsenceStateId}`})})}loadExcusedAbsences(t){return this.lessonPresencesService.getList({params:M(F({},this.getBaseParams(t)),{"filter.ConfirmationStateId":`=${this.settings.excusedAbsenceStateId}`})})}loadUnexcusedAbsences(t){return this.lessonPresencesService.getList({params:M(F({},this.getBaseParams(t)),{"filter.ConfirmationStateId":`=${this.settings.unexcusedAbsenceStateId}`})})}loadIncidents(t){return this.presenceTypesService.incidentTypes$.pipe(L(n=>M(F({},this.getBaseParams(t)),{"filter.TypeRef":`;${n.map(s=>s.Id).join(";")}`})),j(n=>this.lessonPresencesService.getList({params:n})))}loadHalfDays(t){return this.lessonPresencesService.getList({params:M(F({},this.getBaseParams(t)),{"filter.TypeRef":`=${this.settings.halfDayPresenceTypeId}`})})}getBaseParams(t){return{sort:"LessonDateTimeFrom.asc","filter.StudentRef":`=${t}`}}static{this.\u0275fac=function(n){return new(n||e)(B(Ie),B(Be),B(te),B($e),B(Te))}}static{this.\u0275prov=Y({token:e,factory:e.\u0275fac})}}return e})();var P=(()=>{class e{constructor(t,n){this.profileService=t,this.route=n,this.currentDossier$=new le("addresses"),this.studentId$=this.route.paramMap.pipe(L(s=>Number(s.get("id")))),this.profile$=this.studentId$.pipe(j(s=>this.profileService.getProfile(s)),be(1)),this.returnParams$=this.route.queryParams.pipe(L(({returnparams:s})=>s)),this.backlinkQueryParams$=this.returnParams$.pipe(L(je)),this.loading$=this.profileService.loading$}static{this.\u0275fac=function(n){return new(n||e)(B(Fe),B(Se))}}static{this.\u0275prov=Y({token:e,factory:e.\u0275fac})}}return e})();function Xe(e,o){if(e&1&&u(0),e&2){l();let t=v(0);f(" (",t==null?null:t.checkableAbsences,") ")}}function Ze(e,o){if(e&1&&b(0,"bkd-student-dossier-absences",13),e&2){let t=l();p("absences$",t.absencesService.checkableAbsences$)}}function et(e,o){if(e&1&&u(0),e&2){l();let t=v(0);f(" (",t==null?null:t.openAbsences,") ")}}function tt(e,o){if(e&1&&b(0,"bkd-student-dossier-absences",14),e&2){let t=l();p("absences$",t.absencesService.openAbsences$)("selectionService",t.absencesSelectionService)}}function nt(e,o){if(e&1&&u(0),e&2){l();let t=v(0);f(" (",t==null?null:t.excusedAbsences,") ")}}function it(e,o){if(e&1&&b(0,"bkd-student-dossier-absences",13),e&2){let t=l();p("absences$",t.absencesService.excusedAbsences$)}}function st(e,o){if(e&1&&u(0),e&2){l();let t=v(0);f(" (",t==null?null:t.unexcusedAbsences,") ")}}function ot(e,o){if(e&1&&b(0,"bkd-student-dossier-absences",15),e&2){let t=l();p("absences$",t.absencesService.unexcusedAbsences$)("displayPresenceType",!1)}}function rt(e,o){if(e&1&&u(0),e&2){l();let t=v(0);f(" (",t==null?null:t.incidents,") ")}}function at(e,o){if(e&1&&b(0,"bkd-student-dossier-absences",13),e&2){let t=l();p("absences$",t.absencesService.incidents$)}}function ct(e,o){if(e&1&&u(0),e&2){l(2);let t=v(0);f(" (",t==null?null:t.halfDays,") ")}}function dt(e,o){if(e&1&&b(0,"bkd-student-dossier-absences",15),e&2){let t=l(2);p("absences$",t.absencesService.halfDays$)("displayPresenceType",!1)}}function pt(e,o){if(e&1){let t=V();r(0,"div",12,5)(2,"div",8)(3,"bkd-student-dossier-entry-header",9),$("click",function(){D(t);let s=h(1);return I(s.toggle())}),u(4),d(5,"translate"),c(6,ct,1,1),a()(),r(7,"div",10)(8,"div",11),c(9,dt,1,2,"ng-template"),a()()()}if(e&2){let t=h(1);l();let n=v(0);i(3),p("opened",!t.collapsed),i(),f(" ",m(5,3,"shared.profile.half-days")," "),i(2),_((n==null?null:n.halfDays)!==null?6:-1)}}var He=(()=>{class e{constructor(t,n,s,C){this.state=t,this.presenceTypesService=n,this.absencesService=s,this.absencesSelectionService=C,this.halfDayActive$=this.presenceTypesService.halfDayActive$,this.destroy$=new Q,this.state.currentDossier$.next("absences")}ngOnInit(){this.state.studentId$.pipe(W(this.destroy$)).subscribe(t=>this.absencesService.setStudentId(t))}ngOnDestroy(){this.destroy$.next()}static{this.\u0275fac=function(n){return new(n||e)(x(P),x(te),x(se),x(Pe))}}static{this.\u0275cmp=k({type:e,selectors:[["bkd-dossier-absences"]],standalone:!0,features:[z([se]),T],decls:55,vars:31,consts:[["checkableAbsences","ngbAccordionItem"],["openAbsences","ngbAccordionItem"],["excusedAbsences","ngbAccordionItem"],["unexcusedAbsences","ngbAccordionItem"],["incidents","ngbAccordionItem"],["halfDays","ngbAccordionItem"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],["ngbAccordionItem","","id","half-days"],[3,"absences$"],[3,"absences$","selectionService"],[3,"absences$","displayPresenceType"]],template:function(n,s){if(n&1){let C=V();g(0),d(1,"async"),r(2,"div",6)(3,"div",7,0)(5,"div",8)(6,"bkd-student-dossier-entry-header",9),$("click",function(){D(C);let S=h(4);return I(S.toggle())}),u(7),d(8,"translate"),c(9,Xe,1,1),a()(),r(10,"div",10)(11,"div",11),c(12,Ze,1,1,"ng-template"),a()()(),r(13,"div",7,1)(15,"div",8)(16,"bkd-student-dossier-entry-header",9),$("click",function(){D(C);let S=h(14);return I(S.toggle())}),u(17),d(18,"translate"),c(19,et,1,1),a()(),r(20,"div",10)(21,"div",11),c(22,tt,1,2,"ng-template"),a()()(),r(23,"div",7,2)(25,"div",8)(26,"bkd-student-dossier-entry-header",9),$("click",function(){D(C);let S=h(24);return I(S.toggle())}),u(27),d(28,"translate"),c(29,nt,1,1),a()(),r(30,"div",10)(31,"div",11),c(32,it,1,1,"ng-template"),a()()(),r(33,"div",7,3)(35,"div",8)(36,"bkd-student-dossier-entry-header",9),$("click",function(){D(C);let S=h(34);return I(S.toggle())}),u(37),d(38,"translate"),c(39,st,1,1),a()(),r(40,"div",10)(41,"div",11),c(42,ot,1,2,"ng-template"),a()()(),r(43,"div",7,4)(45,"div",8)(46,"bkd-student-dossier-entry-header",9),$("click",function(){D(C);let S=h(44);return I(S.toggle())}),u(47),d(48,"translate"),c(49,rt,1,1),a()(),r(50,"div",10)(51,"div",11),c(52,at,1,1,"ng-template"),a()()(),c(53,pt,10,5,"div",12),d(54,"async"),a()}if(n&2){let C=h(4),w=h(14),S=h(24),Ye=h(34),ze=h(44),A=y(m(1,16,s.absencesService.counts$));i(6),p("opened",!C.collapsed),i(),f(" ",m(8,19,"shared.profile.checkable-absences")," "),i(2),_((A==null?null:A.checkableAbsences)!==null?9:-1),i(7),p("opened",!w.collapsed),i(),f(" ",m(18,21,"shared.profile.open-absences")," "),i(2),_((A==null?null:A.openAbsences)!==null?19:-1),i(7),p("opened",!S.collapsed),i(),f(" ",m(28,23,"shared.profile.excused-absences")," "),i(2),_((A==null?null:A.excusedAbsences)!==null?29:-1),i(7),p("opened",!Ye.collapsed),i(),f(" ",m(38,25,"shared.profile.unexcused-absences")," "),i(2),_((A==null?null:A.unexcusedAbsences)!==null?39:-1),i(7),p("opened",!ze.collapsed),i(),f(" ",m(48,27,"shared.profile.incidents")," "),i(2),_((A==null?null:A.incidents)!==null?49:-1),i(4),_(m(54,29,s.halfDayActive$)?53:-1)}},dependencies:[ee,Z,X,ie,K,J,Ee,E,G,R],changeDetection:0})}}return e})();var lt=(e,o)=>o.apprenticeshipContract.Id,mt=(e,o)=>o.Id;function ut(e,o){if(e&1&&b(0,"bkd-student-dossier-legal-representative",9),e&2){let t=o.$implicit;p("person",t)}}function ft(e,o){if(e&1&&H(0,ut,1,1,"bkd-student-dossier-legal-representative",9,mt),e&2){l(3);let t=v(0);q(t.legalRepresentativePersons)}}function _t(e,o){if(e&1){let t=V();r(0,"div",4,0)(2,"div",5)(3,"bkd-student-dossier-entry-header",6),$("click",function(){D(t);let s=h(1);return I(s.toggle())}),u(4),d(5,"translate"),a()(),r(6,"div",7)(7,"div",8),c(8,ft,2,0,"ng-template"),a()()()}if(e&2){let t=h(1);i(3),p("opened",!t.collapsed),i(),f(" ",m(5,2,"shared.profile.legal-representation")," ")}}function bt(e,o){if(e&1&&u(0),e&2){let t=l().$index;f(" ",t+1," ")}}function ht(e,o){if(e&1&&b(0,"bkd-student-dossier-apprenticeship-company",10),e&2){let t=l().$implicit;p("company",t)}}function vt(e,o){if(e&1){let t=V();r(0,"div",4,1)(2,"div",5)(3,"bkd-student-dossier-entry-header",6),$("click",function(){D(t);let s=h(1);return I(s.toggle())}),u(4),d(5,"translate"),c(6,bt,1,1),a()(),r(7,"div",7)(8,"div",8),c(9,ht,1,1,"ng-template"),a()()()}if(e&2){let t=h(1);l(2);let n=v(0);i(3),p("opened",!t.collapsed),i(),f(" ",m(5,3,"shared.profile.apprenticeship-company")," "),i(2),_(n.apprenticeshipCompanies.length>1?6:-1)}}function Ct(e,o){if(e&1&&(b(0,"bkd-student-dossier-address",2),r(1,"div",3),c(2,_t,9,4,"div",4),H(3,vt,10,5,"div",4,lt),a()),e&2){l();let t=v(0);p("student",t.student),i(2),_(t.legalRepresentativePersons.length>0?2:-1),i(),q(t.apprenticeshipCompanies)}}var qe=(()=>{class e{constructor(t){this.state=t,this.state.currentDossier$.next("addresses")}static{this.\u0275fac=function(n){return new(n||e)(x(P))}}static{this.\u0275cmp=k({type:e,selectors:[["bkd-dossier-addresses"]],standalone:!0,features:[T],decls:3,vars:4,consts:[["legalRepresentatives","ngbAccordionItem"],["apprenticeshipCompanies","ngbAccordionItem"],[1,"profile-entry",3,"student"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[1,"profile-entry",3,"person"],[1,"profile-entry",3,"company"]],template:function(n,s){if(n&1&&(g(0),d(1,"async"),c(2,Ct,5,2)),n&2){let C=y(m(1,1,s.state.profile$));i(2),_(C?2:-1)}},dependencies:[Me,ee,Z,X,ie,K,J,Re,Ve,E,G,R],styles:[".profile-entry[_ngcontent-%COMP%]{display:block;padding:0 1rem}"],changeDetection:0})}}return e})();function gt(e,o){e&1&&b(0,"bkd-spinner")}function yt(e,o){if(e&1&&b(0,"bkd-dossier-grades-view",0),e&2){l();let t=v(0),n=v(2),s=v(4);p("courses",t)("studentId",n)("gradingScales",s)}}var Ue=(()=>{class e{constructor(t,n){this.state=t,this.dossierGradesService=n,this.destroy$=new Q}ngOnInit(){this.state.currentDossier$.next("grades"),this.state.studentId$.pipe(W(this.destroy$)).subscribe(t=>this.dossierGradesService.setStudentId(t))}ngOnDestroy(){this.destroy$.next()}static{this.\u0275fac=function(n){return new(n||e)(x(P),x(N))}}static{this.\u0275cmp=k({type:e,selectors:[["bkd-dossier-grades"]],standalone:!0,features:[T],decls:9,vars:12,consts:[[3,"courses","studentId","gradingScales"]],template:function(n,s){n&1&&(g(0),d(1,"async"),g(2),d(3,"async"),g(4),d(5,"async"),c(6,gt,1,0,"bkd-spinner"),d(7,"async"),c(8,yt,1,3,"bkd-dossier-grades-view",0)),n&2&&(y(m(1,1,s.dossierGradesService.studentCourses$)),i(2),y(m(3,4,s.state.studentId$)),i(2),y(m(5,7,s.dossierGradesService.gradingScales$)),i(2),_(m(7,10,s.dossierGradesService.loading$)?6:8))},dependencies:[Ge,ne,E]})}}return e})();var St=["*"];function At(e,o){if(e&1&&(r(0,"div",5)(1,"span",6),u(2),d(3,"date"),a(),r(4,"span",7),u(5),a()()),e&2){let t=l();i(2),U(ge(3,2,t.student.Birthdate,"dd.MM.yyyy")),i(3),f("(",t.student.Gender,")")}}var Qe=(()=>{class e{constructor(){this.link="/"}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=k({type:e,selectors:[["bkd-student-backlink"]],inputs:{link:"link",queryParams:"queryParams",studentId:"studentId",studentName:"studentName",student:"student"},standalone:!0,features:[T],ngContentSelectors:St,decls:9,vars:5,consts:[[1,"d-flex","flex-column","w-100"],[3,"link","params"],[1,"d-flex","flex-row","align-items-start"],[1,"me-3","medium",3,"studentId"],[1,"d-flex","flex-column"],[1,"additional-info"],[1,"birthday"],[1,"gender"]],template:function(n,s){n&1&&(Ce(),r(0,"div",0)(1,"bkd-backlink",1),xe(2),a(),r(3,"div",2),b(4,"bkd-avatar",3),r(5,"div",4)(6,"h1"),u(7),a(),c(8,At,6,5,"div",5),a()()()),n&2&&(i(),p("link",s.link)("params",s.queryParams),i(3),p("studentId",s.studentId),i(3),U(s.student?s.student.FullName:s.studentName),i(),_(s.student?8:-1))},dependencies:[Oe,Ne,ye],styles:["[_nghost-%COMP%]{display:flex;align-items:center;width:100%}h1[_ngcontent-%COMP%]{margin:-3px 0 0;display:flex;align-items:baseline;line-height:1}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}.gender[_ngcontent-%COMP%]{margin-left:.8ch}"],changeDetection:0})}}return e})();var kt=()=>["addresses","absences","grades"],Dt=()=>[],It=e=>({returnparams:e}),$t=e=>[e];function Tt(e,o){e&1&&b(0,"bkd-spinner")}function Pt(e,o){if(e&1&&b(0,"bkd-reports-link",3),e&2){let t;l(2);let n=v(4);p("reports",(t=n)!==null&&t!==void 0?t:ce(1,Dt))}}function Lt(e,o){if(e&1&&(r(0,"a",5),d(1,"async"),r(2,"button",6,0),u(4),d(5,"translate"),a()()),e&2){let t=o.$implicit,n=h(3),s=l(2);p("queryParams",de(9,It,m(1,5,s.state.returnParams$)))("routerLink",de(11,$t,t)),i(2),he("btn-outline-secondary",!n.isActive),i(2),f(" ",m(5,7,"dossier."+t)," ")}}function Bt(e,o){e&1&&(r(0,"div"),b(1,"router-outlet"),a())}function wt(e,o){e&1&&(r(0,"p"),u(1),d(2,"translate"),a()),e&2&&(i(),U(m(2,1,"shared.profile.no-profile")))}function Et(e,o){if(e&1&&(r(0,"bkd-student-backlink",2),d(1,"async"),d(2,"async"),c(3,Pt,1,2,"bkd-reports-link",3),a(),r(4,"div",4),H(5,Lt,6,13,"a",5,ve),a(),c(7,Bt,2,0,"div")(8,wt,3,3,"p")),e&2){let t=l(),n=v(0),s=v(2);p("link","../..")("queryParams",m(1,6,t.state.backlinkQueryParams$))("studentId",m(2,8,t.state.studentId$))("student",n&&n.student),i(3),_(s==="grades"?3:-1),i(2),q(ce(10,kt)),i(2),_(n?7:8)}}var We=(()=>{class e{constructor(t,n){this.state=t,this.dossierGradesService=n,this.state.currentDossier$.next("addresses")}static{this.\u0275fac=function(n){return new(n||e)(x(P),x(N))}}static{this.\u0275cmp=k({type:e,selectors:[["bkd-student-dossier"]],standalone:!0,features:[z([P,N]),T],decls:10,vars:12,consts:[["rla","routerLinkActive"],[1,"bkd-container","bkd-container-limited"],[1,"mb-2",3,"link","queryParams","studentId","student"],[1,"ms-2",3,"reports"],[1,"d-flex","flex-row","py-3","flex-wrap"],[1,"me-1","mt-1","me-sm-2",3,"queryParams","routerLink"],["data-test-id","dossier-section-button","type","button","routerLinkActive","btn-primary",1,"btn","btn-outline-secondary"]],template:function(n,s){n&1&&(g(0),d(1,"async"),g(2),d(3,"async"),g(4),d(5,"async"),r(6,"div",1),c(7,Tt,1,0,"bkd-spinner"),d(8,"async"),c(9,Et,9,11),a()),n&2&&(y(m(1,1,s.state.profile$)),i(2),y(m(3,4,s.state.currentDossier$)),i(2),y(m(5,7,s.dossierGradesService.testReports$)),i(3),_(m(8,10,s.state.loading$)?7:9))},dependencies:[Qe,we,ke,De,Ae,ne,E,G,R],changeDetection:0})}}return e})();var En={path:"student/:id",children:[{path:"",component:We,children:[{path:"addresses",component:qe},{path:"absences",component:He},{path:"grades",component:Ue}]},{path:"absences/confirm",component:Le}]};export{En as a};
