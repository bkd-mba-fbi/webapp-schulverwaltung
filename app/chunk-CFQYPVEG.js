import{a as _t,c as $t,d as Dt}from"./chunk-E3MRLVGK.js";import{a as Gt}from"./chunk-TN3HRY7Y.js";import{a as Pt}from"./chunk-Y4QYVF5K.js";import{e as Oe,p as Ae}from"./chunk-QGDSASTQ.js";import{a as Et,c as Rt}from"./chunk-DCZMTIC7.js";import{a as ve}from"./chunk-YNODG5RP.js";import{a as Z,b as ae}from"./chunk-EFJ6WEH7.js";import{c as bt,d as It,e as vt,f as xt,g as yt,r as Tt}from"./chunk-HVLHLZKP.js";import{b as xe,h as ye}from"./chunk-DQAQYQ7K.js";import{d as st,h as me,x as he,z as Ce}from"./chunk-ZXUJZ6KS.js";import{$d as dt,Ae as E,C as Xe,Cc as u,Cd as m,Dc as C,Dd as o,Ec as j,Ed as _,Fc as Ze,Fd as ge,G as Ke,Gb as v,H as pe,Ha as B,Hd as $,Ib as x,Ic as et,Id as I,Jd as fe,Lb as q,Ld as at,Mb as J,Md as we,Nb as T,O as De,Ob as l,Pb as d,Qb as Q,Rd as c,S as ze,Sd as ot,Ub as Y,Wb as O,Xb as S,Xd as N,Y as qe,_ as Ee,a as M,b as w,ba as y,be as Fe,c as He,ce as Se,da as Re,db as a,ec as ne,ed as tt,fe as lt,gc as Me,gd as it,ge as pt,ic as p,id as A,ie as ct,j as le,ja as W,jc as D,jd as nt,k as F,kc as b,ke as ut,l as te,ld as rt,oa as f,ob as P,oe as mt,pe as gt,q as $e,qe as ft,r as We,rb as z,rc as re,re as ht,sc as se,se as Ct,tc as V,ua as X,ub as Je,uc as ce,v as h,va as K,w as ie,wb as Qe,we as be,xc as Ye,xe as St,yc as ue,ze as Ie}from"./chunk-GP622B77.js";var Mt=I({Id:o,AddressLine1:c(m),AddressLine2:ot(m),Birthdate:c(N),DisplayEmail:c(m),FirstName:m,FullName:m,Gender:at([ge("M"),ge("F"),ge("X")]),IsActive:_,LastName:m,Location:c(m),PersonId:o,PhoneMobile:c(m),PhonePrivate:c(m),PostalCode:c(m),RegistrationDate:N,RegistrationId:o});var wt=I({Id:o,Designation:m,StudentCount:o,Number:m});var Ne=I({Id:m,TestId:o,CourseRegistrationId:o,GradeId:c(o),GradeValue:c(o),GradeDesignation:c(m),Points:c(o),StudentId:o});var Ft=I({Id:o,CourseId:o,Date:N,Designation:m,Weight:o,WeightPercent:o,IsPointGrading:_,MaxPoints:c(o),MaxPointsAdjusted:c(o),IsPublished:_,IsOwner:_,Owner:c(m),GradingScaleId:c(o),Results:c($(Ne))});var Ot=I({Id:o}),At=fe({HRef:c(m)}),ri=fe({HasEvaluationStarted:_,EvaluationUntil:c(N),HasReviewOfEvaluationStarted:_,HasTestGrading:_,Id:o}),si=we([Ot,At,ri]),ai=fe({Id:o,StudentCount:o}),oi=we([Ot,At,ai]),di=I({Grade:m,AverageTestResult:o,Id:o,StudentId:o}),ke=I({AverageTestResult:o,CanGrade:_,EventId:o,GradeId:c(o),GradeValue:c(o),Id:o,StudentId:o}),L=I({HRef:m,Id:o,Number:m,Designation:m,DateFrom:c(N),DateTo:c(N),StatusId:o,GradingScaleId:c(o),FinalGrades:c($(di)),Gradings:c($(ke)),Tests:c($(Ft)),EvaluationStatusRef:si,AttendanceRef:oi,Participants:c($(Mt)),ParticipatingStudents:c($(_t)),Classes:c($(wt))}),Nt=I(he(L.props,["Id","Designation","GradingScaleId","Classes","AttendanceRef"])),kt=I({TestResults:$(Ne),Gradings:$(ke)}),Bt=I({Gradings:$(ke)});var Te=(()=>{let t=class t extends ve{constructor(){let e=f(me),n=f(Ce);super(e,n,L,"Courses"),this.statusCodec=I(he(this.codec.props,["Id","StatusId","EvaluationStatusRef"]))}getNumberOfCoursesForRating(){return this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef&fields=Id,StatusId,EvaluationStatusRef&filter.StatusId=;10300;10240`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe(y(ae(this.statusCodec)),h(e=>e.filter(n=>n.EvaluationStatusRef.HasEvaluationStarted===!0)),h(e=>e.length))}getExpandedCourses(e){return Pt(e,"TeacherRole")?this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef,AttendanceRef,Classes,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe(y(ae(L))):$e([])}getExpandedCourse(e){return this.http.get(`${this.baseUrl}/${e}?expand=ParticipatingStudents,EvaluationStatusRef,Tests,Gradings,FinalGrades,Classes`).pipe(y(Z(L)))}getExpandedCourseWithParticipants(e){return this.http.get(`${this.baseUrl}/${e}?expand=Participants,Classes,AttendanceRef`).pipe(y(Z(L)))}getExpandedCoursesForDossier(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades,EvaluationStatusRef,ParticipatingStudents,Classes&filter.StatusId=;${this.settings.eventlist.statusfilter}`).pipe(y(ae(L)))}getExpandedCoursesForStudent(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"StudentRole"}}).pipe(y(ae(L)))}getCourseWithStudentCount(e,n={}){let r=new st().set("fields","Id,Designation,GradingScaleId").set("expand","Classes,AttendanceRef");return this.http.get(`${this.baseUrl}/${e}`,w(M({},n),{params:r})).pipe(y(Z(Nt)))}add(e,n,r,g,G,k,ee){let H={Tests:[{Date:Ae(Oe(n),"yyyy-MM-dd'T'HH:mm:ss"),Designation:r,Weight:g,IsPointGrading:G,MaxPoints:k,MaxPointsAdjusted:ee}]};return this.http.put(`${this.baseUrl}/${e}/Tests/New`,H).pipe(h(()=>{}))}update(e,n,r,g,G,k,ee,H){let de={Tests:[{Id:n,Designation:r,Date:Ae(Oe(g),"yyyy-MM-dd'T'HH:mm:ss"),Weight:G,IsPointGrading:k,MaxPoints:ee,MaxPointsAdjusted:H}]};return this.http.put(`${this.baseUrl}/${e}/Tests/Update`,de).pipe(h(()=>{}))}delete(e,n){let r={TestIds:[n]};return this.http.put(`${this.baseUrl}/${e}/Tests/Delete`,r).pipe(h(()=>n))}updateTestResult(e,n){let H=n,{studentId:r,testId:g}=H,G=He(H,["studentId","testId"]),k={StudentIds:[r],TestId:g},ee="gradeId"in G?w(M({},k),{GradeId:G.gradeId}):w(M({},k),{Points:G.points});return this.http.put(`${this.baseUrl}/${e}/SetTestResult`,ee).pipe(y(Z(kt)),y(({TestResults:de,Gradings:Ue})=>de.length<=1&&Ue.length===1?$e({courseId:e,testResult:de[0]??null,grading:Ue[0]}):We(()=>new Error("`TestResults` or `Gradings` does not contain a single value"))))}setAverageAsFinalGrade(e){return this.http.put(`${this.baseUrl}/SetAverageTestResult`,e).pipe(y(Z(Bt)))}publishTest(e){let n={TestIds:[e]};return this.http.put(`${this.baseUrl}/PublishTest`,n).pipe(h(()=>e))}unpublishTest(e){let n={TestIds:[e]};return this.http.put(`${this.baseUrl}/UnpublishTest`,n).pipe(h(()=>e))}};t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=W({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();function Vt(i){return i.length===0?0:Be(i.map(({value:t,weight:s})=>t*s))/Be(i.map(({weight:t})=>t))}function Ve(i){return i.length===0?0:Number(Be(i)/i.length)}function Be(i){return i.reduce(li,0)}function li(i,t){return i+t}function hn(i,t,s){return i?i.Tests?.reduce((e,n)=>e||n.Id===t&&n.Results?.find(r=>r.TestId===t&&r.StudentId===s)||null,null)??null:null}function Cn(i,t,s){return t.map(e=>e.Id===i.TestId?Le(i,e,s):e)}function Sn(i,t,s){return s.map(e=>e.Id===i?pi(t,e):e)}function bn(i,t){return t.map(s=>s.Id===i?w(M({},s),{IsPublished:!s.IsPublished}):s)}function In(i){let t=ui(i);if(t.length===0)throw new Error("unable to calculate averages without results");return Ve(t)}function je(i){return i.MaxPointsAdjusted||i.MaxPoints}function vn(i){let t=ci(i);if(t.length===0)throw new Error("unable to calculate averages without results");return Ve(t)}function U(i,t){return t.Results?.find(s=>s.StudentId===i)}function xn(i,t){return t===null?null:t.filter(s=>s.Id!==i)}function Le(i,t,s){let e=s&&t.Results?.find(r=>r.TestId===i.TestId&&r.StudentId===i.StudentId),n=t.Results?.filter(r=>!(r.TestId===i.TestId&&r.StudentId===i.StudentId))||[];return e&&s==="grade"?i.GradeId=e.GradeId:e&&s==="points"&&(i.Points=e.Points),w(M({},t),{Results:[...n,i]})}function Lt(i){return i.slice().sort((t,s)=>s.Date.getTime()-t.Date.getTime())}function _e(i,t){return t?.find(s=>s.Id===i.GradingScaleId)||null}function pi(i,t){return w(M({},t),{Results:t.Results?.filter(s=>s.StudentId!==i)||[]})}function ci(i){return i.Results?.filter(t=>t.GradeDesignation!==null).map(t=>Number(t.GradeDesignation)).filter(t=>!isNaN(t))||[]}function ui(i){return i.Results?.map(t=>t.Points!==null?t.Points:jt).filter(t=>t>jt)||[]}var jt=-1;var mi=I({Id:o,Designation:m,Value:o,Sufficient:_,Sort:c(m)}),Ut=I({Id:o,CommentsAllowed:_,RisingGrades:_,Grades:$(mi)});var Ht=(()=>{let t=class t extends ve{constructor(){let e=f(me),n=f(Ce);super(e,n,Ut,"GradingScales")}getListForIds(e){return Xe(e.map(n=>this.get(n)))}};t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=W({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();var Wt="studentDossierGrades",Ge=(()=>{let t=class t{constructor(){this.coursesRestService=f(Te),this.subscriptionRestService=f(Et),this.reportsService=f(Dt),this.loadingService=f(Gt),this.gradingScalesRestService=f(Ht),this.studentId$=new te(1),this.initialStudentCourses$=this.studentId$.pipe(ze(),y(this.loadCourses.bind(this)),h(e=>e.sort((n,r)=>n.Designation.localeCompare(r.Designation))),Ee(1)),this.action$=new te(1),this.studentCourses$=Ke(this.action$,this.initialStudentCourses$.pipe(h(e=>({type:"initializeCourses",payload:e})))).pipe(qe(this.coursesReducer.bind(this),[]),Ee(1)),this.loading$=this.loadingService.loading(Wt),this.studentCourseIds$=this.studentCourses$.pipe(h(e=>e.flatMap(n=>n.Id))),this.subscriptionIds$=ie([this.studentId$,this.studentCourseIds$]).pipe(pe(([e,n])=>n.length>0),y(([e,n])=>this.subscriptionRestService.getSubscriptionIdsByStudentAndCourse(e,n))),this.testReports$=this.subscriptionIds$.pipe(h(e=>this.reportsService.getTeacherSubscriptionGradesReports(e))),this.tests$=this.studentCourses$.pipe(h(e=>e.flatMap(n=>n.Tests).filter(xe))),this.gradingScaleIdsFromTests$=this.tests$.pipe(h(e=>[...e.map(n=>n.GradingScaleId)].filter(xe).filter(ye))),this.gradingScaleIdsFromCourses$=this.studentCourses$.pipe(h(e=>e.flatMap(n=>n.GradingScaleId).filter(xe).filter(ye))),this.gradingScaleIds$=ie([this.gradingScaleIdsFromCourses$,this.gradingScaleIdsFromTests$]).pipe(h(([e,n])=>e.concat(n).filter(ye))),this.gradingScales$=this.gradingScaleIds$.pipe(y(e=>this.gradingScalesRestService.getListForIds(e)))}setStudentId(e){this.studentId$.next(e)}getFinalGradeForStudent(e,n){return e?.FinalGrades?.find(r=>r.StudentId===n)}getGradingForStudent(e,n){return e?.Gradings?.find(r=>r.StudentId===n)}getGradingScaleOfCourse(e,n){return n?.find(r=>r.Id===e.GradingScaleId)}getGradesForStudent(e,n,r){return e.Tests?.flatMap(g=>({value:Number(_e(g,r)?.Grades.find(k=>k.Id===U(n,g)?.GradeId)?.Designation),weight:g.Weight})).filter(({value:g})=>!!g)||[]}updateStudentCourses(e){this.action$.next({type:"updateCourses",payload:e})}loadCourses(e){return this.loadingService.load(this.coursesRestService.getExpandedCoursesForDossier().pipe(h(n=>n.filter(r=>r.ParticipatingStudents?.find(g=>g.Id===e)))),{context:Wt})}coursesReducer(e,n){switch(n.type){case"initializeCourses":return n.payload;case"updateCourses":return this.updateCourses([...e],n.payload);default:return e}}updateCourses(e,n){return e.map(r=>w(M({},r),{Tests:r.Tests!==null?r.Tests.map(g=>g.Id===n.Id?n:g):null}))}};t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=W({token:t,factory:t.\u0275fac});let i=t;return i})();var fi=i=>({width:i}),hi=(i,t)=>t.Key;function Ci(i,t){if(i&1&&(l(0,"option",1),p(1),u(2,"translate"),d()),i&2){let s=S();T("ngValue",null),a(),b(" ",C(2,2,s.emptyLabel)," ")}}function Si(i,t){if(i&1&&(l(0,"option",1),p(1),d()),i&2){let s=t.$implicit;T("ngValue",s),a(),b(" ",s.Value," ")}}var Xt=(()=>{let t=class t{constructor(){this.options=[],this.allowEmpty=!0,this.emptyLabel="",this.value=null,this.disabled=!1,this.tabindex=0,this.width="auto",this.valueChange=new Qe,this.options$=new F([]),this.rawValue$=new F(null),this.value$=ie([this.rawValue$,this.options$]).pipe(h(([e,n])=>n&&n.find(r=>r.Key===e)||null))}ngOnChanges(e){e.value&&this.rawValue$.next(e.value.currentValue),e.options&&this.options$.next(e.options.currentValue)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=P({type:t,selectors:[["bkd-select"]],inputs:{options:"options",allowEmpty:"allowEmpty",emptyLabel:"emptyLabel",value:"value",disabled:"disabled",tabindex:"tabindex",width:"width"},outputs:{valueChange:"valueChange"},features:[B],decls:6,vars:10,consts:[[1,"form-select",3,"ngModelChange","tabindex","ngStyle","disabled","ngModel"],[3,"ngValue"]],template:function(n,r){n&1&&(l(0,"select",0),u(1,"async"),O("ngModelChange",function(G){return r.valueChange.emit(G&&G.Key)}),v(2,Ci,3,4,"option",1),q(3,Si,2,2,"option",1,hi),p(5,` >
`),d()),n&2&&(T("tabindex",ce(r.tabindex))("ngStyle",ue(8,fi,r.width))("disabled",r.disabled)("ngModel",C(1,6,r.value$)),a(2),x(r.allowEmpty?2:-1),a(),J(r.options))},dependencies:[be,gt,ft,mt,Se,pt,A,it,E],encapsulation:2,changeDetection:0});let i=t;return i})();function Pe(i,t,s){return t?t.Grade:bi(i,s)||i?.GradeValue}function bi(i,t){return t?.Grades.find(s=>s.Id===i?.GradeId)?.Designation}var Ii="1-3",zt="\u2013",qt=(()=>{let t=class t{constructor(){this.locale=f(et)}transform(e,n,r){let g=Number(e??null);return isNaN(g)?zt:vi(Number(e??null),r??this.locale,n)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275pipe=z({name:"decimalOrDash",type:t,pure:!0});let i=t;return i})();function vi(i,t,s){return i===0?zt:tt(i,t,`1.${xi(s)}`)}function xi(i){return i?String(i).includes("-")?String(i):`${i}-${i}`:Ii}var Jt=(()=>{let t=class t{constructor(){}getGradeForStudent(){return Pe(this.grading,this.finalGrade,this.gradingScale)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=P({type:t,selectors:[["bkd-dossier-grades-final-grade"]],inputs:{finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},decls:14,vars:11,consts:[[1,"final-entry"],["data-testid","final-grade"],["data-testid","average-test-results"]],template:function(n,r){n&1&&(l(0,"div",0)(1,"div"),p(2),u(3,"translate"),d(),l(4,"div",1)(5,"span"),p(6),d()(),l(7,"div"),p(8),u(9,"translate"),d(),l(10,"div",2)(11,"span"),p(12),u(13,"decimalOrDash"),d()()()),n&2&&(a(2),D(C(3,4,"dossier.grade")),a(4),D(r.getGradeForStudent()||"\u2013"),a(2),D(C(9,6,"dossier.average")),a(4),D(j(13,8,r.average,"1-3")))},dependencies:[E,qt],styles:[".final-entry[_ngcontent-%COMP%]{padding:1rem;display:grid;grid-template-columns:repeat(2,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}"]});let i=t;return i})();var Qt=(()=>{let t=class t{constructor(){this.translate=f(Ie)}transform(e,n,r,g="tests.points"){return e.IsPointGrading&&(e.IsPublished||r)?`${U(n,e)?.Points||"\u2013"} / ${e.MaxPointsAdjusted||e.MaxPoints} ${this.translate.instant(g)}`:""}};t.\u0275fac=function(n){return new(n||t)},t.\u0275pipe=z({name:"bkdTestPoints",type:t,pure:!0});let i=t;return i})();var Yt=(()=>{let t=class t{constructor(){this.translate=f(Ie)}transform(e){return`${this.translate.instant("tests.factor")} ${e.Weight} (${e.WeightPercent}%)`}};t.\u0275fac=function(n){return new(n||t)},t.\u0275pipe=z({name:"bkdTestWeight",type:t,pure:!0});let i=t;return i})();var yi=i=>({maxPoints:i});function Ti(i,t){if(i&1&&(l(0,"div",13),p(1),u(2,"translate"),d()),i&2){let s=S(2);a(),b(" ",j(2,1,"global.validation-errors.invalidPoints",ue(4,yi,s.maxPoints))," ")}}function _i(i,t){if(i&1){let s=Y();l(0,"div",3)(1,"label",11),p(2),u(3,"translate"),d(),l(4,"div",6)(5,"input",12,0),O("input",function(){X(s);let n=ne(6),r=S();return K(r.onPointsChange(n.value))}),d()(),v(7,Ti,3,6,"div",13),d()}if(i&2){let s=S();a(2),D(C(3,9,"dossier.dialog.points")),a(2),Me("is-invalid",s.pointsInput.errors),a(),Me("is-invalid",s.pointsInput.errors),T("max",ce(s.maxPoints))("formControl",s.pointsInput),a(2),x(s.pointsInput.errors?7:-1)}}var Zt=500,ei=(()=>{let t=class t{constructor(){this.activeModal=f(Tt),this.courseService=f(Te),this.maxPoints=0,this.gradeSubject$=new le,this.pointsSubject$=new le,this.closeButtonDisabled$=new F(!1),this.gradingScaleDisabled$=new F(!0),this.grade$=this.gradeSubject$.pipe(De(Zt)),this.points$=this.pointsSubject$.pipe(De(Zt),pe(this.isValid.bind(this)),h(Number)),this.destroy$=new le}ngOnInit(){this.maxPoints=je(this.test),this.pointsInput=new lt({value:this.points,disabled:!1},[Fe.min(0),Fe.pattern("[0-9]+([\\.][0-9]+)?"),this.maxPointValidator()]),this.gradingScaleDisabled$.next(this.test.IsPointGrading&&this.points>0),this.points$.pipe(Re(this.destroy$)).subscribe(e=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,points:e})),this.grade$.pipe(Re(this.destroy$)).subscribe(e=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,gradeId:e}))}onGradeChange(e){this.gradeSubject$.next(e)}onPointsChange(e){this.pointsSubject$.next(e),this.gradingScaleDisabled$.next(e.length>0)}updateTestResult(e){this.closeButtonDisabled$.next(!0),this.courseService.updateTestResult(this.test.CourseId,e).subscribe(({testResult:n})=>{this.gradeId=n?.GradeId??null,this.updatedTestResult=n,this.closeButtonDisabled$.next(!1)})}isValid(e){return e===""||isNaN(Number(e))?!1:!(Number(e)<0||Number(e)>this.maxPoints)}maxPointValidator(){return e=>Number(e.value)>je(this.test)?{customMax:!0}:null}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=P({type:t,selectors:[["bkd-dossier-grades-edit"]],inputs:{test:"test",gradeId:"gradeId",gradeOptions:"gradeOptions",points:"points",studentId:"studentId"},decls:19,vars:20,consts:[["pointInput",""],[1,"modal-body"],[1,"mb-4"],[1,"form-group","row"],[1,"form-group","row","mt-2"],["for","grade",1,"col-6","col-form-label"],[1,"col-6"],["id","grade",3,"valueChange","options","value","allowEmpty","disabled"],[1,"text-muted","mt-4"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["for","points",1,"col-6","col-form-label"],["id","points","type","number","step","0.01","min","0",1,"form-control",3,"input","max","formControl"],["data-testid","validation-error-message",1,"invalid-feedback","col-6","offset-6"]],template:function(n,r){n&1&&(l(0,"div",1)(1,"p",2),p(2),d(),v(3,_i,8,11,"div",3),l(4,"div",4)(5,"label",5),p(6),u(7,"translate"),d(),l(8,"div",6)(9,"bkd-select",7),u(10,"async"),O("valueChange",function(G){return G&&r.onGradeChange(G)}),d()()(),l(11,"p",8),p(12),u(13,"translate"),d()(),l(14,"div",9)(15,"button",10),u(16,"async"),O("click",function(){return r.activeModal.close(r.updatedTestResult)}),p(17),u(18,"translate"),d()()),n&2&&(a(2),D(r.test.Designation),a(),x(r.test.IsPointGrading?3:-1),a(3),D(C(7,10,"dossier.dialog.grade")),a(3),T("options",r.gradeOptions)("value",r.gradeId)("allowEmpty",!1)("disabled",C(10,12,r.gradingScaleDisabled$)),a(3),b(" ",C(13,14,r.test.IsPointGrading?"dossier.dialog.hint.points":"dossier.dialog.hint.grade")," "),a(3),T("disabled",C(16,16,r.closeButtonDisabled$)),a(2),b(" ",C(18,18,"dossier.dialog.close")," "))},dependencies:[be,dt,ct,Se,Ct,ht,St,ut,Xt,A,E],encapsulation:2});let i=t;return i})();function Gi(i,t){if(i&1){let s=Y();l(0,"a",10),O("click",function(){X(s);let n=S(2),r=V(0);return K(n.editGrading(r))}),l(1,"i",11),p(2,"edit"),d(),l(3,"span",5),p(4),d()()}if(i&2){S(2);let s=V(2);a(4),D(s)}}function Pi(i,t){if(i&1&&(l(0,"span",5),p(1),d()),i&2){S(2);let s=V(2);a(),D(s)}}function $i(i,t){if(i&1&&(l(0,"div",9),p(1),u(2,"translate"),d()),i&2){S(2);let s=V(0);a(),b(" ",C(2,1,s.IsPublished?"tests.published":"tests.not-published")," ")}}function Di(i,t){if(i&1&&(l(0,"div",0)(1,"div",1),p(2),d(),l(3,"div",2),p(4),u(5,"date"),d(),l(6,"div",3),v(7,Gi,5,1,"a",4)(8,Pi,2,1,"span",5),d(),l(9,"div",6),p(10),u(11,"bkdTestWeight"),d(),l(12,"div",7)(13,"span"),p(14),u(15,"bkdTestPoints"),d()(),l(16,"div",8),p(17),d(),v(18,$i,3,3,"div",9),d()),i&2){let s=S(),e=V(0);a(2),b(" ",e.Designation," "),a(2),b(" ",j(5,7,e.Date,"dd.MM.yyyy")," "),a(3),x(s.isEditable&&e.IsOwner?7:8),a(3),b(" ",C(11,10,e)," "),a(4),D(Ze(15,12,e,s.studentId,s.isEditable,"dossier.points")),a(3),b(" ",e.Owner," "),a(),x(s.isEditable?18:-1)}}var ti=(()=>{let t=class t{constructor(){this.gradeService=f(Ge),this.modalService=f(Rt),this.test$=new te(1),this.grading$=this.test$.pipe(h(this.getGrading.bind(this)))}ngOnChanges(e){e.test&&this.test$.next(this.test)}editGrading(e){let n=this.modalService.open(ei,{backdrop:"static"});n.componentInstance.test=e,n.componentInstance.gradeId=this.getGradeId(e),n.componentInstance.gradeOptions=t.mapToOptions(this.gradingScale),n.componentInstance.studentId=this.studentId,n.componentInstance.points=this.getPoints(e),n.result.then(r=>{r&&this.updateStudentGrade(r,e)},()=>{})}updateStudentGrade(e,n){let r=Le(e,n);this.gradeService.updateStudentCourses(r)}getGrading(e){return this.gradingScale?.Grades.find(n=>n.Id===this.getGradeId(e))?.Designation||"\u2013"}getGradeId(e){return U(this.studentId,e)?.GradeId||null}getPoints(e){return U(this.studentId,e)?.Points||null}static mapToOptions(e){return e?.Grades.map(n=>({Key:n.Id,Value:n.Designation}))||null}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=P({type:t,selectors:[["bkd-dossier-single-test"]],inputs:{test:"test",studentId:"studentId",gradingScale:"gradingScale",isEditable:"isEditable"},features:[B],decls:5,vars:7,consts:[[1,"test-entry"],["data-testid","test-designation",1,"designation"],["data-testid","test-date",1,"date"],[1,"grade"],["aria-label","edit grade",1,"btn","btn-link"],["data-testid","test-grade"],["data-testid","test-factor",1,"factor"],["data-testid","test-points",1,"points"],["data-testid","test-teacher",1,"teacher"],["data-testid","test-status",1,"state"],["aria-label","edit grade",1,"btn","btn-link",3,"click"],["data-testid","test-grade-edit-icon",1,"material-icons"]],template:function(n,r){if(n&1&&(re(0),u(1,"async"),re(2),u(3,"async"),v(4,Di,19,17,"div",0)),n&2){let g=se(C(1,1,r.test$));a(2),se(C(3,4,r.grading$)),a(2),x(g?4:-1)}},dependencies:[A,nt,E,Qt,Yt],styles:['.test-entry[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1rem;display:grid;grid-template-areas:"designation designation grade factor" "date date points ." "teacher teacher . ." "state state . .";grid-template-columns:repeat(4,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}.designation[_ngcontent-%COMP%]{grid-area:designation}.date[_ngcontent-%COMP%]{grid-area:date}.grade[_ngcontent-%COMP%]{grid-area:grade}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;color:#000;padding:0;text-decoration:none}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.grade[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:-1em;color:#00000080}.points[_ngcontent-%COMP%]{grid-area:points;color:#00000080}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.state[_ngcontent-%COMP%]{grid-area:state}@media (max-width: 575.98px){.test-entry[_ngcontent-%COMP%]{grid-template-areas:"designation designation" "date grade" "factor points" "teacher teacher" "state state";grid-template-columns:repeat(2,1fr)}}']});let i=t;return i})();var Ei=()=>[],Ri=(i,t)=>t.Id;function Mi(i,t){if(i&1&&Q(0,"bkd-dossier-single-test",2),i&2){let s=t.$implicit,e=S(2);T("test",s)("studentId",e.studentId)("gradingScale",e.getGradingScaleOfTest(s))("isEditable",e.isEditable)}}function wi(i,t){if(i&1&&(l(0,"div"),Q(1,"bkd-dossier-grades-final-grade",1),q(2,Mi,1,4,"bkd-dossier-single-test",2,Ri),d()),i&2){let s=S(),e=V(0);a(),T("finalGrade",s.decoratedCourse.finalGrade)("grading",s.decoratedCourse.grading)("gradingScale",s.decoratedCourse.gradingScale)("average",s.decoratedCourse.average),a(),J(e)}}function Fi(i,t){i&1&&(l(0,"p",0),p(1),u(2,"translate"),d()),i&2&&(a(),b(" ",C(2,1,"dossier.no-tests")," "))}var ii=(()=>{let t=class t{ngOnChanges(e){e.decoratedCourse&&this.sortedTests$.next(this.sortedTests())}constructor(){this.sortedTests$=new F([])}sortedTests(){return this.decoratedCourse.course.Tests?Lt(this.decoratedCourse.course.Tests):[]}getGradingScaleOfTest(e){return _e(e,this.gradingScales)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=P({type:t,selectors:[["bkd-dossier-course-tests"]],inputs:{studentId:"studentId",decoratedCourse:"decoratedCourse",gradingScales:"gradingScales",isEditable:"isEditable"},features:[B],decls:4,vars:5,consts:[["data-testid","message-no-tests",1,"p-3"],[3,"finalGrade","grading","gradingScale","average"],[3,"test","studentId","gradingScale","isEditable"]],template:function(n,r){if(n&1&&(re(0),u(1,"async"),v(2,wi,4,4,"div")(3,Fi,3,3,"p",0)),n&2){let g=se(C(1,1,r.sortedTests$)??Ye(4,Ei));a(2),x(g.length>0?2:3)}},dependencies:[Jt,ti,A,E],encapsulation:2});let i=t;return i})();function Oi(i,t){if(i&1&&(l(0,"span",0),p(1),d()),i&2){let s=S();a(),b(" (",s.grade,")")}}function Ai(i,t){if(i&1&&(l(0,"span",1),p(1),u(2,"number"),d()),i&2){let s=S();a(),b(" (",j(2,1,s.average,"1.1-3"),")")}}var ni=(()=>{let t=class t{constructor(){}get grade(){return this.getGradeForStudent()}getGradeForStudent(){return Pe(this.grading,this.finalGrade,this.gradingScale)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=P({type:t,selectors:[["bkd-dossier-grades-course-header"]],inputs:{designation:"designation",finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},decls:3,vars:3,consts:[["data-testId","grade",1,"grade"],["data-testId","average",1,"average"]],template:function(n,r){n&1&&(p(0),v(1,Oi,2,1,"span",0),v(2,Ai,3,4,"span",1)),n&2&&(b("",r.designation,`
`),a(),x(r.grade?1:-1),a(),x(!r.grade&&r.average?2:-1))},dependencies:[rt],styles:[".average[_ngcontent-%COMP%]{color:#00000080}"]});let i=t;return i})();var Ni=(i,t)=>t.course.Id;function ki(i,t){if(i&1&&Q(0,"bkd-dossier-course-tests",9),i&2){let s=S().$implicit,e=S(2);T("decoratedCourse",s)("studentId",e.studentId)("gradingScales",e.gradingScales)("isEditable",e.isEditable)}}function Bi(i,t){if(i&1){let s=Y();l(0,"div")(1,"div",2)(2,"div",3,0)(4,"div",4)(5,"bkd-student-dossier-entry-header",5),O("click",function(){X(s);let n=ne(3);return K(n.toggle())}),Q(6,"bkd-dossier-grades-course-header",6),d()(),l(7,"div",7)(8,"div",8),Je(9,ki,1,4,"ng-template"),d()()()()()}if(i&2){let s=t.$implicit,e=ne(3);a(5),T("opened",!e.collapsed),a(),T("designation",s.course.Designation)("finalGrade",s.finalGrade)("grading",s.grading)("gradingScale",s.gradingScale)("average",s.average)}}function Vi(i,t){if(i&1&&(q(0,Bi,10,6,"div",null,Ni),u(2,"async")),i&2){let s=S();J(C(2,0,s.decoratedCoursesSubject$))}}function ji(i,t){i&1&&(l(0,"p",1),p(1),u(2,"translate"),d()),i&2&&(a(),b(" ",C(2,1,"dossier.no-courses")," "))}var gs=(()=>{let t=class t{constructor(){this.dossierGradesService=f(Ge),this.isEditable=!0,this.decoratedCoursesSubject$=new F([])}ngOnChanges(){this.decoratedCoursesSubject$.next(this.decorateCourses())}decorateCourses(){return this.courses.map(e=>{let n=this.dossierGradesService.getFinalGradeForStudent(e,this.studentId),r=this.dossierGradesService.getGradesForStudent(e,this.studentId,this.gradingScales);return{course:e,finalGrade:n,grading:this.dossierGradesService.getGradingForStudent(e,this.studentId),gradingScale:this.dossierGradesService.getGradingScaleOfCourse(e,this.gradingScales),average:n?.AverageTestResult||Vt(r)}})}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=P({type:t,selectors:[["bkd-dossier-grades-view"]],inputs:{courses:"courses",studentId:"studentId",gradingScales:"gradingScales",isEditable:"isEditable"},features:[B],decls:2,vars:1,consts:[["courses","ngbAccordionItem"],["data-testid","message-no-courses",1,"py-3"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],[3,"designation","finalGrade","grading","gradingScale","average"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[3,"decoratedCourse","studentId","gradingScales","isEditable"]],template:function(n,r){n&1&&v(0,Vi,3,2)(1,ji,3,3,"p",1),n&2&&x(r.courses.length>0?0:1)},dependencies:[yt,xt,vt,$t,ni,It,bt,ii,A,E],encapsulation:2});let i=t;return i})();export{Ve as a,hn as b,Cn as c,Sn as d,bn as e,In as f,vn as g,xn as h,Lt as i,wt as j,ke as k,Te as l,Ht as m,Ge as n,zt as o,qt as p,vi as q,Xt as r,gs as s};
