import{b as x}from"./chunk-MIRGHONI.js";import{l as P}from"./chunk-NL5E3FC5.js";import{Bd as F,C as g,D as d,F as f,H as m,K as p,M as h,R as u,X as b,f as a,g as l,n as i,o as c,w as r,x as $,ya as S,zd as y}from"./chunk-IFJN5CDK.js";var I="page",T=(()=>{class n{constructor(e,s,v,E,R){this.location=e,this.loadingService=s,this.sortService=v,this.settings=E,this.loading$=this.loadingService.loading$,this.loadingPage$=this.loadingService.loading(I),this.sorting$=this.sortService.sorting$,this.filter$=new l(this.getInitialFilter()),this.isFilterValid$=this.filter$.pipe(i(this.isValidFilter.bind(this))),this.validFilter$=this.filter$.pipe($(this.isValidFilter.bind(this)),m(F),h(1)),this.resetEntries$=new a,this.nextPage$=new a,this.page$=r(this.nextPage$.pipe(i(()=>"next")),r(this.resetEntries$,this.validFilter$,this.sorting$).pipe(i(()=>"reset"))).pipe(p((t,o)=>o==="next"?t+1:0,0)),this.offset$=this.page$.pipe(i(t=>t*this.settings.paginationLimit)),this.pageResult$=c([this.validFilter$,this.sorting$,this.offset$]).pipe(d(10),g(P(this.loadEntries.bind(this))),h(1)),this.entries$=r(r(this.resetEntries$,this.validFilter$,this.sorting$).pipe(i(()=>({action:"reset"}))),this.pageResult$.pipe(i(t=>t.offset===0?{action:"reset",entries:t.entries}:{action:"append",entries:t.entries}))).pipe(p(this.entriesActionReducer.bind(this),[]),h(1)),this.total$=this.pageResult$.pipe(i(({total:t})=>t)),this.hasMore$=this.pageResult$.pipe(i(({offset:t,total:o})=>t<o-this.settings.paginationLimit)),this.queryParams$=this.filter$.pipe(i(this.buildParamsFromFilter.bind(this))),this.queryParamsString$=this.queryParams$.pipe(i(x)),this.destroy$=new a,this.queryParamsString$.pipe(u(this.destroy$)).subscribe(t=>this.location.replaceState(R,t)),this.sortService.setSorting(this.getInitialSorting())}ngOnDestroy(){this.destroy$.next()}setFilter(e){this.filter$.next(y(e))}nextPage(){this.hasMore$.pipe(f(1)).subscribe(e=>{e&&this.nextPage$.next()})}resetEntries(){this.resetEntries$.next()}getInitialSorting(){return null}entriesActionReducer(e,s){switch(s.action){case"append":return[...e,...s.entries];case"reset":return s.entries?s.entries:[];default:return e}}static{this.\u0275fac=function(s){S()}}static{this.\u0275prov=b({token:n,factory:n.\u0275fac})}}return n})();export{I as a,T as b};
