import{a as ct,b as ut,c as mt,d as gt,e as ft,f as Pt,h as Rt,i as Mt}from"./chunk-XWISOVKN.js";import{e as Dt}from"./chunk-6LRQCBUO.js";import{a as $t}from"./chunk-Y4QYVF5K.js";import{e as Ae,p as Ne}from"./chunk-JE6RMKPQ.js";import{A as Gt,c as ht,e as Oe,f as be,i as Ct,j as St,l as bt,n as vt,r as It,s as xt,t as _t,u as yt,v as Tt,z as ve}from"./chunk-M3VKTN3S.js";import{a as Et,b as wt,d as Ft}from"./chunk-S6U5TJNW.js";import{a as xe}from"./chunk-QWYAXZZX.js";import{a as ee,b as oe}from"./chunk-WNZFLLQC.js";import{b as _e,h as ye}from"./chunk-DQAQYQ7K.js";import{A as Se,f as dt,i as ge,y as Ce}from"./chunk-RYYQAFJB.js";import{$b as Z,$d as l,A as ze,Ab as Ze,Ac as se,Ba as Ye,Bc as ae,Cc as j,Dc as ue,E as qe,F as ce,Gc as tt,Hb as x,Hc as me,Ja as B,Jb as _,Lc as p,M as $e,Mb as J,Mc as g,Md as c,Nb as Q,Nc as L,Nd as a,Ob as T,Oc as it,Od as G,Pb as S,Pd as fe,Q as Je,Qb as h,Rb as Y,Rc as nt,Rd as P,Sb as b,Sd as I,Tb as v,Td as he,V as Qe,Vd as lt,Wd as Fe,X as Re,_ as y,a as w,aa as Me,ae as pt,b as F,bc as V,c as Xe,cc as et,dc as f,fb as s,fe as N,h as pe,ha as X,i as O,ie as Ie,j as ie,je as R,ma as u,nc as re,o as De,p as Ke,pc as we,pd as rt,rc as d,rd as st,sa as K,sc as $,t as m,ta as z,tc as C,td as A,u as ne,ub as E,ud as at,wd as ot,xb as q}from"./chunk-CHBP6U4G.js";var Ot=I({Id:a,AddressLine1:l(c),AddressLine2:pt(c),Birthdate:l(N),DisplayEmail:l(c),FirstName:c,FullName:c,Gender:lt([fe("M"),fe("F"),fe("X")]),IsActive:G,LastName:c,Location:l(c),PersonId:a,PhoneMobile:l(c),PhonePrivate:l(c),PostalCode:l(c),RegistrationDate:N,RegistrationId:a});var At=I({Id:a,Designation:c,StudentCount:a,Number:c});var ke=I({Id:c,TestId:a,CourseRegistrationId:a,GradeId:l(a),GradeValue:l(a),GradeDesignation:l(c),Points:l(a),StudentId:a});var Nt=I({Id:a,CourseId:a,Date:N,Designation:c,Weight:a,WeightPercent:a,IsPointGrading:G,MaxPoints:l(a),MaxPointsAdjusted:l(a),IsPublished:G,IsOwner:G,Owner:l(c),GradingScaleId:l(a),Results:l(P(ke))});var kt=I({Id:a}),Bt=he({HRef:l(c)}),oi=he({HasEvaluationStarted:G,EvaluationUntil:l(N),HasReviewOfEvaluationStarted:G,HasTestGrading:G,Id:a}),di=Fe([kt,Bt,oi]),li=he({Id:a,StudentCount:a}),pi=Fe([kt,Bt,li]),ci=I({Grade:c,AverageTestResult:a,Id:a,StudentId:a}),Be=I({AverageTestResult:a,CanGrade:G,EventId:a,GradeId:l(a),GradeValue:l(a),Id:a,StudentId:a}),U=I({HRef:c,Id:a,Number:c,Designation:c,DateFrom:l(N),DateTo:l(N),StatusId:a,GradingScaleId:l(a),FinalGrades:l(P(ci)),Gradings:l(P(Be)),Tests:l(P(Nt)),EvaluationStatusRef:di,AttendanceRef:pi,Participants:l(P(Ot)),ParticipatingStudents:l(P(Pt)),Classes:l(P(At))}),Vt=I(Ce(U.props,["Id","Designation","GradingScaleId","Classes","AttendanceRef","EvaluationStatusRef"])),jt=I({TestResults:P(ke),Gradings:P(Be)}),Lt=I({Gradings:P(Be)});var Te=(()=>{class t extends xe{constructor(){let e=u(ge),i=u(Se);super(e,i,U,"Courses"),this.statusCodec=I(Ce(this.codec.props,["Id","StatusId","EvaluationStatusRef"]))}getNumberOfCoursesForRating(){return this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef&fields=Id,StatusId,EvaluationStatusRef&filter.StatusId=;10300;10240`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe(y(oe(this.statusCodec)),m(e=>e.filter(i=>i.EvaluationStatusRef.HasEvaluationStarted===!0)),m(e=>e.length))}getExpandedCourses(e){return $t(e,"TeacherRole")?this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef,AttendanceRef,Classes,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe(y(oe(U))):De([])}getExpandedCourse(e){return this.http.get(`${this.baseUrl}/${e}?expand=ParticipatingStudents,EvaluationStatusRef,Tests,Gradings,FinalGrades,Classes`).pipe(y(ee(U)))}getExpandedCourseWithParticipants(e){return this.http.get(`${this.baseUrl}/${e}?expand=Participants,Classes,AttendanceRef`).pipe(y(ee(U)))}getExpandedCoursesForDossier(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades,EvaluationStatusRef,ParticipatingStudents,Classes&filter.StatusId=;${this.settings.eventlist.statusfilter}`).pipe(y(oe(U)))}getExpandedCoursesForStudent(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"StudentRole"}}).pipe(y(oe(U)))}getCourseWithStudentCount(e,i={}){let n=new dt().set("fields","Id,Designation,GradingScaleId").set("expand","Classes,AttendanceRef,EvaluationStatusRef");return this.http.get(`${this.baseUrl}/${e}`,F(w({},i),{params:n})).pipe(y(ee(Vt)))}add(e,i,n,o,D,k,te){let W={Tests:[{Date:Ne(Ae(i),"yyyy-MM-dd'T'HH:mm:ss"),Designation:n,Weight:o,IsPointGrading:D,MaxPoints:k,MaxPointsAdjusted:te}]};return this.http.put(`${this.baseUrl}/${e}/Tests/New`,W).pipe(m(()=>{}))}update(e,i,n,o,D,k,te,W){let le={Tests:[{Id:i,Designation:n,Date:Ne(Ae(o),"yyyy-MM-dd'T'HH:mm:ss"),Weight:D,IsPointGrading:k,MaxPoints:te,MaxPointsAdjusted:W}]};return this.http.put(`${this.baseUrl}/${e}/Tests/Update`,le).pipe(m(()=>{}))}delete(e,i){let n={TestIds:[i]};return this.http.put(`${this.baseUrl}/${e}/Tests/Delete`,n).pipe(m(()=>i))}updateTestResult(e,i){let W=i,{studentId:n,testId:o}=W,D=Xe(W,["studentId","testId"]),k={StudentIds:[n],TestId:o},te="gradeId"in D?F(w({},k),{GradeId:D.gradeId}):F(w({},k),{Points:D.points});return this.http.put(`${this.baseUrl}/${e}/SetTestResult`,te).pipe(y(ee(jt)),y(({TestResults:le,Gradings:We})=>le.length<=1&&We.length===1?De({courseId:e,testResult:le[0]??null,grading:We[0]}):Ke(()=>new Error("`TestResults` or `Gradings` does not contain a single value"))))}setAverageAsFinalGrade(e){return this.http.put(`${this.baseUrl}/SetAverageTestResult`,e).pipe(y(ee(Lt)))}publishTest(e){let i={TestIds:[e]};return this.http.put(`${this.baseUrl}/PublishTest`,i).pipe(m(()=>e))}unpublishTest(e){let i={TestIds:[e]};return this.http.put(`${this.baseUrl}/UnpublishTest`,i).pipe(m(()=>e))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Ut(t){return t.length===0?0:Ve(t.map(({value:r,weight:e})=>r*e))/Ve(t.map(({weight:r})=>r))}function je(t){return t.length===0?0:Number(Ve(t)/t.length)}function Ve(t){return t.reduce(ui,0)}function ui(t,r){return t+r}function Sn(t,r,e){return t?t.Tests?.reduce((i,n)=>i||n.Id===r&&n.Results?.find(o=>o.TestId===r&&o.StudentId===e)||null,null)??null:null}function bn(t,r,e){return r.map(i=>i.Id===t.TestId?Ue(t,i,e):i)}function vn(t,r,e){return e.map(i=>i.Id===t?He(r,i):i)}function In(t,r){return r.map(e=>e.Id===t?F(w({},e),{IsPublished:!e.IsPublished}):e)}function xn(t){let r=gi(t);if(r.length===0)throw new Error("unable to calculate averages without results");return je(r)}function Le(t){return t.MaxPointsAdjusted||t.MaxPoints}function _n(t){let r=mi(t);if(r.length===0)throw new Error("unable to calculate averages without results");return je(r)}function H(t,r){return r.Results?.find(e=>e.StudentId===t)}function yn(t,r){return r===null?null:r.filter(e=>e.Id!==t)}function Ue(t,r,e){let i=e&&r.Results?.find(o=>o.TestId===t.TestId&&o.StudentId===t.StudentId),n=r.Results?.filter(o=>!(o.TestId===t.TestId&&o.StudentId===t.StudentId))||[];return i&&e==="grade"?t.GradeId=i.GradeId:i&&e==="points"&&(t.Points=i.Points),F(w({},r),{Results:[...n,t]})}function Wt(t){return t.slice().sort((r,e)=>e.Date.getTime()-r.Date.getTime())}function Ge(t,r){return r?.find(e=>e.Id===t.GradingScaleId)||null}function He(t,r){return F(w({},r),{Results:r.Results?.filter(e=>e.StudentId!==t)||[]})}function mi(t){return t.Results?.filter(r=>r.GradeDesignation!==null).map(r=>Number(r.GradeDesignation)).filter(r=>!isNaN(r))||[]}function gi(t){return t.Results?.map(r=>r.Points!==null?r.Points:Ht).filter(r=>r>Ht)||[]}var Ht=-1;var fi=I({Id:a,Designation:c,Value:a,Sufficient:G,Sort:l(c)}),Xt=I({Id:a,CommentsAllowed:G,RisingGrades:G,Grades:P(fi)});var Kt=(()=>{class t extends xe{constructor(){let e=u(ge),i=u(Se);super(e,i,Xt,"GradingScales")}getListForIds(e){return ze(e.map(i=>this.get(i)))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var zt="studentDossierGrades",Ee=(()=>{class t{constructor(){this.coursesRestService=u(Te),this.subscriptionRestService=u(wt),this.reportsService=u(Mt),this.loadingService=u(Dt),this.gradingScalesRestService=u(Kt),this.studentId$=new ie(1),this.initialStudentCourses$=this.studentId$.pipe(Je(),y(this.loadCourses.bind(this)),m(e=>e.sort((i,n)=>i.Designation.localeCompare(n.Designation))),Re(1)),this.action$=new ie(1),this.studentCourses$=qe(this.action$,this.initialStudentCourses$.pipe(m(e=>({type:"initializeCourses",payload:e})))).pipe(Qe(this.coursesReducer.bind(this),[]),Re(1)),this.loading$=this.loadingService.loading(zt),this.studentCourseIds$=this.studentCourses$.pipe(m(e=>e.flatMap(i=>i.Id))),this.subscriptionIds$=ne([this.studentId$,this.studentCourseIds$]).pipe(ce(([e,i])=>i.length>0),y(([e,i])=>this.subscriptionRestService.getSubscriptionIdsByStudentAndCourse(e,i))),this.testReports$=this.subscriptionIds$.pipe(m(e=>this.reportsService.getTeacherSubscriptionGradesReports(e))),this.tests$=this.studentCourses$.pipe(m(e=>e.flatMap(i=>i.Tests).filter(_e))),this.gradingScaleIdsFromTests$=this.tests$.pipe(m(e=>[...e.map(i=>i.GradingScaleId)].filter(_e).filter(ye))),this.gradingScaleIdsFromCourses$=this.studentCourses$.pipe(m(e=>e.flatMap(i=>i.GradingScaleId).filter(_e).filter(ye))),this.gradingScaleIds$=ne([this.gradingScaleIdsFromCourses$,this.gradingScaleIdsFromTests$]).pipe(m(([e,i])=>e.concat(i).filter(ye))),this.gradingScales$=this.gradingScaleIds$.pipe(y(e=>this.gradingScalesRestService.getListForIds(e)))}setStudentId(e){this.studentId$.next(e)}getFinalGradeForStudent(e,i){return e?.FinalGrades?.find(n=>n.StudentId===i)}getGradingForStudent(e,i){return e?.Gradings?.find(n=>n.StudentId===i)}getGradingScaleOfCourse(e,i){return i?.find(n=>n.Id===e.GradingScaleId)}getGradesForStudent(e,i,n){return e.Tests?.flatMap(o=>({value:Number(Ge(o,n)?.Grades.find(k=>k.Id===H(i,o)?.GradeId)?.Designation),weight:o.Weight})).filter(({value:o})=>!!o)||[]}updateStudentCourses(e){this.action$.next({type:"updateCourses",payload:e})}loadCourses(e){return this.loadingService.load(this.coursesRestService.getExpandedCoursesForDossier().pipe(m(i=>i.filter(n=>n.ParticipatingStudents?.find(o=>o.Id===e)))),{context:zt})}coursesReducer(e,i){switch(i.type){case"initializeCourses":return i.payload;case"updateCourses":return this.updateCourses([...e],i.payload);default:return e}}updateCourses(e,i){return e.map(n=>F(w({},n),{Tests:n.Tests!==null?n.Tests.map(o=>o.Id===i.Id?i:o):null}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac})}}return t})();var Ci=t=>({width:t}),Si=(t,r)=>r.Key;function bi(t,r){if(t&1&&(S(0,"option",1),d(1),p(2,"translate"),h()),t&2){let e=f();T("ngValue",null),s(),C(" ",g(2,2,e.emptyLabel)," ")}}function vi(t,r){if(t&1&&(S(0,"option",1),d(1),h()),t&2){let e=r.$implicit;T("ngValue",e),s(),C(" ",e.Value," ")}}var qt=(()=>{class t{constructor(){this.options=[],this.allowEmpty=!0,this.emptyLabel="",this.value=null,this.disabled=!1,this.tabindex=0,this.width="auto",this.valueChange=new Ye,this.options$=new O([]),this.rawValue$=new O(null),this.value$=ne([this.rawValue$,this.options$]).pipe(m(([e,i])=>i&&i.find(n=>n.Key===e)||null))}ngOnChanges(e){e.value&&this.rawValue$.next(e.value.currentValue),e.options&&this.options$.next(e.options.currentValue)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=E({type:t,selectors:[["bkd-select"]],inputs:{options:"options",allowEmpty:"allowEmpty",emptyLabel:"emptyLabel",value:"value",disabled:"disabled",tabindex:"tabindex",width:"width"},outputs:{valueChange:"valueChange"},features:[B],decls:6,vars:10,consts:[[1,"form-select",3,"ngModelChange","tabindex","ngStyle","disabled","ngModel"],[3,"ngValue"]],template:function(i,n){i&1&&(S(0,"select",0),p(1,"async"),V("ngModelChange",function(D){return n.valueChange.emit(D&&D.Key)}),x(2,bi,3,4,"option",1),J(3,vi,2,2,"option",1,Si),d(5,` >
`),h()),i&2&&(T("tabindex",ue(n.tabindex))("ngStyle",me(8,Ci,n.width))("disabled",n.disabled)("ngModel",g(1,6,n.value$)),s(2),_(n.allowEmpty?2:-1),s(),Q(n.options))},dependencies:[ve,xt,_t,It,be,St,st,A,R],encapsulation:2,changeDetection:0})}}return t})();function Pe(t,r,e){return r?r.Grade:Ii(t,e)||t?.GradeValue}function Ii(t,r){return r?.Grades.find(e=>e.Id===t?.GradeId)?.Designation}var xi="1-3",Qt="\u2013",Yt=(()=>{class t{constructor(){this.locale=u(nt)}transform(e,i,n){let o=Number(e??null);return isNaN(o)?Qt:_i(Number(e??null),n??this.locale,i)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275pipe=q({name:"decimalOrDash",type:t,pure:!0})}}return t})();function _i(t,r,e){return t===0?Qt:rt(t,r,`1.${yi(e)}`)}function yi(t){return t?String(t).includes("-")?String(t):`${t}-${t}`:xi}var Zt=(()=>{class t{constructor(){}getGradeForStudent(){return Pe(this.grading,this.finalGrade,this.gradingScale)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=E({type:t,selectors:[["bkd-dossier-grades-final-grade"]],inputs:{finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},decls:14,vars:11,consts:[[1,"final-entry"],["data-testid","final-grade"],["data-testid","average-test-results"]],template:function(i,n){i&1&&(b(0,"div",0)(1,"div"),d(2),p(3,"translate"),v(),b(4,"div",1)(5,"span"),d(6),v()(),b(7,"div"),d(8),p(9,"translate"),v(),b(10,"div",2)(11,"span"),d(12),p(13,"decimalOrDash"),v()()()),i&2&&(s(2),$(g(3,4,"dossier.grade")),s(4),$(n.getGradeForStudent()||"\u2013"),s(2),$(g(9,6,"dossier.average")),s(4),$(L(13,8,n.average,"1-3")))},dependencies:[R,Yt],styles:[".final-entry[_ngcontent-%COMP%]{padding:1rem;display:grid;grid-template-columns:repeat(2,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}"]})}}return t})();var ei=(()=>{class t{constructor(){this.translate=u(Ie)}transform(e,i,n,o="tests.points"){return e.IsPointGrading&&(e.IsPublished||n)?`${H(i,e)?.Points||"\u2013"} / ${e.MaxPointsAdjusted||e.MaxPoints} ${this.translate.instant(o)}`:""}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275pipe=q({name:"bkdTestPoints",type:t,pure:!0})}}return t})();var ti=(()=>{class t{constructor(){this.translate=u(Ie)}transform(e){return`${this.translate.instant("tests.factor")} ${e.Weight} (${e.WeightPercent}%)`}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275pipe=q({name:"bkdTestWeight",type:t,pure:!0})}}return t})();var Ti=t=>({maxPoints:t});function Gi(t,r){if(t&1&&(S(0,"div",13),d(1),p(2,"translate"),h()),t&2){let e=f(2);s(),C(" ",L(2,1,"global.validation-errors.invalidPoints",me(4,Ti,e.maxPoints))," ")}}function Ei(t,r){if(t&1){let e=Z();S(0,"div",3)(1,"label",11),d(2),p(3,"translate"),h(),S(4,"div",6)(5,"input",12,0),V("input",function(){K(e);let n=re(6),o=f();return z(o.onPointsChange(n.value))}),h()(),x(7,Gi,3,6,"div",13),h()}if(t&2){let e=f();s(2),$(g(3,9,"dossier.dialog.points")),s(2),we("is-invalid",e.pointsInput.errors),s(),we("is-invalid",e.pointsInput.errors),T("max",ue(e.maxPoints))("formControl",e.pointsInput),s(2),_(e.pointsInput.errors?7:-1)}}var ii=500,ni=(()=>{class t{constructor(){this.activeModal=u(Et),this.courseService=u(Te),this.maxPoints=0,this.gradeSubject$=new pe,this.pointsSubject$=new pe,this.closeButtonDisabled$=new O(!1),this.gradingScaleDisabled$=new O(!0),this.grade$=this.gradeSubject$.pipe($e(ii)),this.points$=this.pointsSubject$.pipe($e(ii),ce(this.isValid.bind(this)),m(Number)),this.destroy$=new pe}ngOnInit(){this.maxPoints=Le(this.test),this.pointsInput=new Ct({value:this.points,disabled:!1},[Oe.min(0),Oe.pattern("[0-9]+([\\.][0-9]+)?"),this.maxPointValidator()]),this.gradingScaleDisabled$.next(this.test.IsPointGrading&&this.points>0),this.points$.pipe(Me(this.destroy$)).subscribe(e=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,points:e})),this.grade$.pipe(Me(this.destroy$)).subscribe(e=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,gradeId:e}))}onGradeChange(e){this.gradeSubject$.next(e)}onPointsChange(e){this.pointsSubject$.next(e),this.gradingScaleDisabled$.next(e.length>0)}updateTestResult(e){this.closeButtonDisabled$.next(!0),this.courseService.updateTestResult(this.test.CourseId,e).subscribe(({testResult:i})=>{this.gradeId=i?.GradeId??null,this.updatedTestResult=i,this.closeButtonDisabled$.next(!1)})}isValid(e){return e===""||isNaN(Number(e))?!1:!(Number(e)<0||Number(e)>this.maxPoints)}maxPointValidator(){return e=>Number(e.value)>Le(this.test)?{customMax:!0}:null}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=E({type:t,selectors:[["bkd-dossier-grades-edit"]],inputs:{test:"test",gradeId:"gradeId",gradeOptions:"gradeOptions",points:"points",studentId:"studentId"},decls:19,vars:20,consts:[["pointInput",""],[1,"modal-body"],[1,"mb-4"],[1,"form-group","row"],[1,"form-group","row","mt-2"],["for","grade",1,"col-6","col-form-label"],[1,"col-6"],["id","grade",3,"valueChange","options","value","allowEmpty","disabled"],[1,"text-muted","mt-4"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["for","points",1,"col-6","col-form-label"],["id","points","type","number","step","0.01","min","0",1,"form-control",3,"input","max","formControl"],["data-testid","validation-error-message",1,"invalid-feedback","col-6","offset-6"]],template:function(i,n){i&1&&(S(0,"div",1)(1,"p",2),d(2),h(),x(3,Ei,8,11,"div",3),S(4,"div",4)(5,"label",5),d(6),p(7,"translate"),h(),S(8,"div",6)(9,"bkd-select",7),p(10,"async"),V("valueChange",function(D){return n.onGradeChange(D)}),h()()(),S(11,"p",8),d(12),p(13,"translate"),h()(),S(14,"div",9)(15,"button",10),p(16,"async"),V("click",function(){return n.activeModal.close(n.updatedTestResult)}),d(17),p(18,"translate"),h()()),i&2&&(s(2),$(n.test.Designation),s(),_(n.test.IsPointGrading?3:-1),s(3),$(g(7,10,"dossier.dialog.grade")),s(3),T("options",n.gradeOptions)("value",n.gradeId)("allowEmpty",!0)("disabled",g(10,12,n.gradingScaleDisabled$)),s(3),C(" ",g(13,14,n.test.IsPointGrading?"dossier.dialog.hint.points":"dossier.dialog.hint.grade")," "),s(3),T("disabled",g(16,16,n.closeButtonDisabled$)),s(2),C(" ",g(18,18,"dossier.dialog.close")," "))},dependencies:[ve,ht,bt,be,Tt,yt,Gt,vt,qt,A,R],encapsulation:2})}}return t})();function Pi(t,r){if(t&1){let e=Z();b(0,"a",10),et("click",function(){K(e);let n=f(2),o=j(0);return z(n.editGrading(o))}),b(1,"i",11),d(2,"edit"),v(),b(3,"span",5),d(4),v()()}if(t&2){f(2);let e=j(2);s(4),$(e)}}function Di(t,r){if(t&1&&(b(0,"span",5),d(1),v()),t&2){f(2);let e=j(2);s(),$(e)}}function $i(t,r){if(t&1&&(b(0,"div",9),d(1),p(2,"translate"),v()),t&2){f(2);let e=j(0);s(),C(" ",g(2,1,e.IsPublished?"tests.published":"tests.not-published")," ")}}function Ri(t,r){if(t&1&&(b(0,"div",0)(1,"div",1),d(2),v(),b(3,"div",2),d(4),p(5,"date"),v(),b(6,"div",3),x(7,Pi,5,1,"a",4)(8,Di,2,1,"span",5),v(),b(9,"div",6),d(10),p(11,"bkdTestWeight"),v(),b(12,"div",7)(13,"span"),d(14),p(15,"bkdTestPoints"),v()(),b(16,"div",8),d(17),v(),x(18,$i,3,3,"div",9),v()),t&2){let e=f(),i=j(0);s(2),C(" ",i.Designation," "),s(2),C(" ",L(5,7,i.Date,"dd.MM.yyyy")," "),s(3),_(e.isEditable&&i.IsOwner?7:8),s(3),C(" ",g(11,10,i)," "),s(4),$(it(15,12,i,e.studentId,e.isEditable,"dossier.points")),s(3),C(" ",i.Owner," "),s(),_(e.isEditable?18:-1)}}var ri=(()=>{class t{constructor(){this.gradeService=u(Ee),this.modalService=u(Ft),this.test$=new ie(1),this.grading$=this.test$.pipe(m(this.getGrading.bind(this)))}ngOnChanges(e){e.test&&this.test$.next(this.test)}editGrading(e){let i=this.modalService.open(ni,{backdrop:"static"});i.componentInstance.test=e,i.componentInstance.gradeId=this.getGradeId(e),i.componentInstance.gradeOptions=t.mapToOptions(this.gradingScale),i.componentInstance.studentId=this.studentId,i.componentInstance.points=this.getPoints(e),i.result.then(n=>this.updateStudentGrade(n,e),()=>{})}updateStudentGrade(e,i){let n=e?Ue(e,i):He(this.studentId,i);this.gradeService.updateStudentCourses(n)}getGrading(e){return this.gradingScale?.Grades.find(i=>i.Id===this.getGradeId(e))?.Designation||"\u2013"}getGradeId(e){return H(this.studentId,e)?.GradeId||null}getPoints(e){return H(this.studentId,e)?.Points||null}static mapToOptions(e){return e?.Grades.map(i=>({Key:i.Id,Value:i.Designation}))||null}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=E({type:t,selectors:[["bkd-dossier-single-test"]],inputs:{test:"test",studentId:"studentId",gradingScale:"gradingScale",isEditable:"isEditable"},features:[B],decls:5,vars:7,consts:[[1,"test-entry"],["data-testid","test-designation",1,"designation"],["data-testid","test-date",1,"date"],[1,"grade"],["aria-label","edit grade",1,"btn","btn-link"],["data-testid","test-grade"],["data-testid","test-factor",1,"factor"],["data-testid","test-points",1,"points"],["data-testid","test-teacher",1,"teacher"],["data-testid","test-status",1,"state"],["aria-label","edit grade",1,"btn","btn-link",3,"click"],["data-testid","test-grade-edit-icon",1,"material-icons"]],template:function(i,n){if(i&1&&(se(0),p(1,"async"),se(2),p(3,"async"),x(4,Ri,19,17,"div",0)),i&2){let o=ae(g(1,1,n.test$));s(2),ae(g(3,4,n.grading$)),s(2),_(o?4:-1)}},dependencies:[A,at,R,ei,ti],styles:['.test-entry[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1rem;display:grid;grid-template-areas:"designation designation grade factor" "date date points ." "teacher teacher . ." "state state . .";grid-template-columns:repeat(4,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}.designation[_ngcontent-%COMP%]{grid-area:designation}.date[_ngcontent-%COMP%]{grid-area:date}.grade[_ngcontent-%COMP%]{grid-area:grade}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;color:#000;padding:0;text-decoration:none}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.grade[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:-1em;color:#00000080}.points[_ngcontent-%COMP%]{grid-area:points;color:#00000080}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.state[_ngcontent-%COMP%]{grid-area:state}@media(max-width:575.98px){.test-entry[_ngcontent-%COMP%]{grid-template-areas:"designation designation" "date grade" "factor points" "teacher teacher" "state state";grid-template-columns:repeat(2,1fr)}}']})}}return t})();var Mi=()=>[],wi=(t,r)=>r.Id;function Fi(t,r){if(t&1&&Y(0,"bkd-dossier-single-test",2),t&2){let e=r.$implicit,i=f(2);T("test",e)("studentId",i.studentId)("gradingScale",i.getGradingScaleOfTest(e))("isEditable",i.isEditable)}}function Oi(t,r){if(t&1&&(S(0,"div"),Y(1,"bkd-dossier-grades-final-grade",1),J(2,Fi,1,4,"bkd-dossier-single-test",2,wi),h()),t&2){let e=f(),i=j(0);s(),T("finalGrade",e.decoratedCourse.finalGrade)("grading",e.decoratedCourse.grading)("gradingScale",e.decoratedCourse.gradingScale)("average",e.decoratedCourse.average),s(),Q(i)}}function Ai(t,r){t&1&&(S(0,"p",0),d(1),p(2,"translate"),h()),t&2&&(s(),C(" ",g(2,1,"dossier.no-tests")," "))}var si=(()=>{class t{ngOnChanges(e){e.decoratedCourse&&this.sortedTests$.next(this.sortedTests())}constructor(){this.sortedTests$=new O([])}sortedTests(){return this.decoratedCourse.course.Tests?Wt(this.decoratedCourse.course.Tests):[]}getGradingScaleOfTest(e){return Ge(e,this.gradingScales)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=E({type:t,selectors:[["bkd-dossier-course-tests"]],inputs:{studentId:"studentId",decoratedCourse:"decoratedCourse",gradingScales:"gradingScales",isEditable:"isEditable"},features:[B],decls:4,vars:5,consts:[["data-testid","message-no-tests",1,"p-3"],[3,"finalGrade","grading","gradingScale","average"],[3,"test","studentId","gradingScale","isEditable"]],template:function(i,n){if(i&1&&(se(0),p(1,"async"),x(2,Oi,4,4,"div")(3,Ai,3,3,"p",0)),i&2){let o=ae(g(1,1,n.sortedTests$)??tt(4,Mi));s(2),_(o.length>0?2:3)}},dependencies:[Zt,ri,A,R],encapsulation:2})}}return t})();function Ni(t,r){if(t&1&&(b(0,"span",0),d(1),v()),t&2){let e=f();s(),C(" (",e.grade,")")}}function ki(t,r){if(t&1&&(b(0,"span",1),d(1),p(2,"number"),v()),t&2){let e=f();s(),C(" (",L(2,1,e.average,"1.1-3"),")")}}var ai=(()=>{class t{constructor(){}get grade(){return this.getGradeForStudent()}getGradeForStudent(){return Pe(this.grading,this.finalGrade,this.gradingScale)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=E({type:t,selectors:[["bkd-dossier-grades-course-header"]],inputs:{designation:"designation",finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},decls:3,vars:3,consts:[["data-testId","grade",1,"grade"],["data-testId","average",1,"average"]],template:function(i,n){i&1&&(d(0),x(1,Ni,2,1,"span",0),x(2,ki,3,4,"span",1)),i&2&&(C("",n.designation,`
`),s(),_(n.grade?1:-1),s(),_(!n.grade&&n.average?2:-1))},dependencies:[ot],styles:[".average[_ngcontent-%COMP%]{color:#00000080}"]})}}return t})();var Bi=(t,r)=>r.course.Id;function Vi(t,r){if(t&1&&Y(0,"bkd-dossier-course-tests",9),t&2){let e=f().$implicit,i=f(2);T("decoratedCourse",e)("studentId",i.studentId)("gradingScales",i.gradingScales)("isEditable",i.isEditable)}}function ji(t,r){if(t&1){let e=Z();S(0,"div")(1,"div",2)(2,"div",3,0)(4,"div",4)(5,"bkd-student-dossier-entry-header",5),V("click",function(){K(e);let n=re(3);return z(n.toggle())}),Y(6,"bkd-dossier-grades-course-header",6),h()(),S(7,"div",7)(8,"div",8),Ze(9,Vi,1,4,"ng-template"),h()()()()()}if(t&2){let e=r.$implicit,i=re(3);s(5),T("opened",!i.collapsed),s(),T("designation",e.course.Designation)("finalGrade",e.finalGrade)("grading",e.grading)("gradingScale",e.gradingScale)("average",e.average)}}function Li(t,r){if(t&1&&(J(0,ji,10,6,"div",null,Bi),p(2,"async")),t&2){let e=f();Q(g(2,0,e.decoratedCoursesSubject$))}}function Ui(t,r){t&1&&(S(0,"p",1),d(1),p(2,"translate"),h()),t&2&&(s(),C(" ",g(2,1,"dossier.no-courses")," "))}var hs=(()=>{class t{constructor(){this.dossierGradesService=u(Ee),this.isEditable=!0,this.decoratedCoursesSubject$=new O([])}ngOnChanges(){this.decoratedCoursesSubject$.next(this.decorateCourses())}decorateCourses(){return this.courses.map(e=>{let i=this.dossierGradesService.getFinalGradeForStudent(e,this.studentId),n=this.dossierGradesService.getGradesForStudent(e,this.studentId,this.gradingScales);return{course:e,finalGrade:i,grading:this.dossierGradesService.getGradingForStudent(e,this.studentId),gradingScale:this.dossierGradesService.getGradingScaleOfCourse(e,this.gradingScales),average:i?.AverageTestResult||Ut(n)}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=E({type:t,selectors:[["bkd-dossier-grades-view"]],inputs:{courses:"courses",studentId:"studentId",gradingScales:"gradingScales",isEditable:"isEditable"},features:[B],decls:2,vars:1,consts:[["courses","ngbAccordionItem"],["data-testid","message-no-courses",1,"py-3"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],[3,"designation","finalGrade","grading","gradingScale","average"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[3,"decoratedCourse","studentId","gradingScales","isEditable"]],template:function(i,n){i&1&&x(0,Li,3,2)(1,Ui,3,3,"p",1),i&2&&_(n.courses.length>0?0:1)},dependencies:[ft,gt,mt,Rt,ai,ut,ct,si,A,R],encapsulation:2})}}return t})();export{je as a,Sn as b,bn as c,vn as d,In as e,xn as f,_n as g,yn as h,Wt as i,At as j,Be as k,Te as l,Kt as m,Ee as n,Qt as o,Yt as p,_i as q,qt as r,hs as s};
