import{a as pn}from"./chunk-BKTGOUCG.js";import{a as wt,b as Pt}from"./chunk-CCDY54FV.js";import{b as ln}from"./chunk-VRFSXFDV.js";import{a as Ue}from"./chunk-FQBR3T7I.js";import{a as Tt}from"./chunk-YFBKC7VA.js";import{a as Et}from"./chunk-IJZS4264.js";import{a as St}from"./chunk-M2DB57R7.js";import{e as an}from"./chunk-XD4PX4UG.js";import{a as Ui,b as qi}from"./chunk-OYJYQUTM.js";import{a as Qe,b as Qi,c as Zi,d as Xi,e as Ji,f as Ct,g as vt,h as en,i as tn,k as nn,l as ue,m as _t,o as rn,p as yt,q as sn,r as Pe}from"./chunk-ZWPZOVU4.js";import{b as Yi,d as je}from"./chunk-P7JC2I6A.js";import{a as ji,d as Wi}from"./chunk-5L5SCKR3.js";import{e as Ki}from"./chunk-3BBOO4BP.js";import{B as Ni,C as He,G as ke,H as cn}from"./chunk-7TZCSZPA.js";import{a as Ae,c as Ai}from"./chunk-7W3EW4UP.js";import{a as Ce,b as Ne}from"./chunk-IMP5HGLH.js";import{a as zi}from"./chunk-Y4QYVF5K.js";import{p as Hi}from"./chunk-Z5YYJRVI.js";import{a as Be}from"./chunk-C3RVM24A.js";import{a as xt,b as dn}from"./chunk-QCPZH5HC.js";import{a as We,b as on,c as bt}from"./chunk-5GLVE7RK.js";import{a as Ut}from"./chunk-JMNFY6XV.js";import{a as gt}from"./chunk-YHCR7GAG.js";import{d as ft}from"./chunk-4WXTXOKX.js";import{a as Ve,b as Wt,i as me}from"./chunk-SOGFQEFY.js";import{a as Ri,b as Bi}from"./chunk-SOLW4RXC.js";import{a as $e,b as q,h as Mi,i as Oi,k as Di,l as Li,r as mt}from"./chunk-RRRRFXAU.js";import{a as Vi,b as ce}from"./chunk-DQAQYQ7K.js";import{a as ht}from"./chunk-SYSZVEDF.js";import{F as Fi,G as jt,H as $i,I as ut,J as Gi,b as yi,d as At,f as we,q as se,r as Ee,s as Le,t as Z,z as oe}from"./chunk-4BL3T57C.js";import{$b as g,Aa as nt,Ac as Vt,Bb as x,Ca as oi,Cd as Ht,Dc as l,Dd as ot,Ec as c,Fa as de,Fc as F,G as tt,H as _e,Hb as m,Ja as O,Jb as K,Jc as fi,Ka as ai,L as Jt,Ma as ye,Md as Nt,N as ei,Nb as _,O as ti,Ob as ci,Pb as Oe,Pc as L,Q as ne,Qb as B,Qc as Ci,Rb as V,Rc as vi,S as ee,Sb as d,Tb as a,U as it,Ub as f,Wd as at,Y as ii,Yb as D,Yd as Ge,Zd as dt,_ as te,_b as k,_d as bi,a as A,aa as Ie,ac as mi,b as N,ba as M,bc as ui,be as Si,cc as xe,cd as fe,ce as xi,da as be,dc as Ke,de as lt,ee as Ti,fb as Se,fd as Q,gd as Te,ge as wi,hb as r,ic as hi,ie as Ei,j as pe,ja as ie,jc as gi,jd as _i,k as Y,kc as ge,l as Bt,lc as p,mc as C,me as pt,nc as y,ne as ct,oc as Ye,oe as Pi,pa as u,pb as di,q as R,qe as ki,r as Xt,rb as he,rc as W,re as Re,sc as j,se as Ii,ta as ni,tc as U,ua as ri,ub as v,uc as $,ue as ae,v as S,va as Me,vc as H,ve as E,w as z,wa as T,wb as li,wc as P,xa as w,xb as pi,xc as re,xd as st,yb as rt,yc as De,yd as Fe,za as si,zc as G}from"./chunk-6Q2MWA3P.js";var Sr=10300,xr=10260,Tr=10250,wr=14030,Er=10350;function kt(t){let{HasEvaluationStarted:o,EvaluationUntil:e,HasTestGrading:i}=t.EvaluationStatusRef;if(o===!0&&(t.StatusId===wr||t.StatusId===Er))return{value:le.Rating};if(o===!0&&i===!1){if(e)return{value:le.RatingUntil};if(t.StatusId===Sr)return{value:le.IntermediateRating}}return o===!1&&i===!0&&t.StatusId!==xr&&t.StatusId!==Tr?{value:le.Tests}:o===!0&&i===!0?e?{value:le.Tests,label:le.RatingUntil}:{value:le.Tests,label:le.IntermediateRating}:null}function mn(t){return t.EvaluationStatusRef.HasEvaluationStarted===!0}function un(t){return t.EvaluationStatusRef.HasReviewOfEvaluationStarted===!0&&!!t.FinalGrades?.length}function It(t){let o=t.Classes?t.Classes.map(e=>e.Number).join(", "):null;return o?t.Designation+", "+o:t.Designation}function hn(t,o){return t?(o.Leadership??"").split(",").some(e=>e.trim()===t.fullname):!1}function gn(t,o){let e=new URLSearchParams({returnlink:o});return o.startsWith("/dashboard")?`/dashboard/students/${t}?${e}`:o.startsWith("/events/current")?`/events/current/${t}?${e}`:`/events/${t}/students?${e}`}function fn(t){let o=t.ParticipatingStudents?.map(e=>({id:e.Id,name:e.FullName,email:e.DisplayEmail??void 0}))??[];return{eventId:t.Id,eventDesignation:t.Designation,studyClasses:(t.Classes??[]).map(e=>e.Designation).sort(),entries:o}}function qt(t,o){return N(A({},t),{entries:t.entries.map(e=>{let i=o.find(s=>s.StudentId===e.id),n=i?[i.CompanyName,i.CompanyNameAddition].filter(Boolean).join(" \u2013 "):void 0;return N(A({},e),{company:n})})})}function zt(t,o,e,{eventDesignation:i,emailFallback:n}={}){return{eventId:t,eventDesignation:i??e[0]?.EventDesignation??"",studyClasses:[],entries:o.map(s=>{let h=e.find(b=>b.PersonId===s.Id);return{id:s.Id,subscriptionId:h?.Id,name:s.FullName,email:(n?s.DisplayEmail??s.Email:s.DisplayEmail)??void 0,status:h?.Status,registrationDate:h?.RegistrationDate??void 0}})}}function Cn(t,o){return N(A({},t),{entries:t.entries.map(e=>N(A({},e),{studyClass:o.find(i=>i.StudentRef.Id===e.id)?.StudyClassNumber}))})}var le=function(t){return t.Rating="rating",t.RatingUntil="rating-until",t.IntermediateRating="intermediate-rating",t.Tests="add-tests",t}(le||{}),qe=(()=>{class t{constructor(){this.coursesRestService=u(ue),this.eventsRestService=u(xt),this.studyClassRestService=u(Tt),this.subscriptionsRestService=u(We),this.loadingService=u(Ce),this.storageService=u(Be),this.translate=u(ae),this.router=u(Le),this.settings=u(oe),this.loading$=this.loadingService.loading$,this.searchFields$=new Y(["designation"]),this.searchSubject$=new Y(""),this.search$=this.searchSubject$.asObservable(),this.roles$=new Y(null),this.isClassTeacher$=this.roles$.pipe(S(e=>zi(e,"ClassTeacherRole")),te(1)),this.withStudyCourses$=new Y(!1),this.unratedCourses$=this.roles$.pipe(M(this.loadUnratedCourses.bind(this)),te(1)),this.studyCourses$=this.withStudyCourses$.pipe(M(this.loadStudyCourses.bind(this)),te(1)),this.formativeAssessments$=this.isClassTeacher$.pipe(M(this.loadFormativeAssessments.bind(this)),te(1)),this.studyClasses$=this.isClassTeacher$.pipe(M(this.loadStudyClasses.bind(this)),te(1)),this.events$=this.getEvents().pipe(te(1)),this.filteredEvents$=z([this.events$,this.searchFields$,this.search$]).pipe(S(He(wt)))}setSearch(e){this.searchSubject$.next(e)}setRoles(e){this.roles$.next(e)}setWithStudyCourses(e){this.withStudyCourses$.next(e)}setSearchFields(e){this.searchFields$.next(e)}getEntries(e=!1){return this.filteredEvents$.pipe(S(i=>e?i.filter(n=>n.evaluationText):i))}getEvents(){return this.loadingService.load(z([this.unratedCourses$,this.studyCourses$,this.formativeAssessments$,this.studyClasses$]),{stopOnFirstValue:!0}).pipe(S(He(this.createAndSortEvents.bind(this))))}loadUnratedCourses(e){return this.coursesRestService.getExpandedCourses(e).pipe(S(i=>i.filter(n=>!un(n))))}loadStudyCourses(e){if(!e)return R([]);let i=this.storageService.getPayload();return this.eventsRestService.getStudyCourseEvents().pipe(S(n=>n.filter(s=>hn(i,s))),M(n=>this.subscriptionsRestService.getSubscriptionCountsByEvents(n.map(s=>s.Id)).pipe(S(s=>n.map(h=>N(A({},h),{StudentCount:s[h.Id]??0}))))))}loadFormativeAssessments(e){return e?this.studyClassRestService.getActiveFormativeAssessments():R([])}loadStudyClasses(e){return e?this.studyClassRestService.getActive():R([])}createAndSortEvents(e,i,n,s){let h=s.filter(b=>!n.map(X=>X.Id).includes(b.Id));return[...this.createFromCourses(e),...this.createFromStudyCourses(i),...this.createFromAssessments(n),...this.createFromStudyClasses(h)].sort((b,X)=>b.designation.localeCompare(X.designation))}createFromCourses(e){return e.map(i=>{let n=kt(i);return{id:i.Id,designation:It(i),detailLink:this.buildStudentsLink(i.Id),studentCount:i.AttendanceRef.StudentCount||0,dateFrom:i.DateFrom,dateTo:i.DateTo,state:n?.value||null,evaluationText:this.getEvaluationText(n,i.EvaluationStatusRef.EvaluationUntil),evaluationLink:n?.value&&n?.value!==le.Tests?["/events",i.Id,"evaluation"]:["/events",i.Id,"tests"]}})}createFromStudyCourses(e){return e.map(i=>({id:i.Id,designation:i.Designation,detailLink:this.buildStudentsLink(i.Id),studentCount:i.StudentCount,state:null}))}createFromAssessments(e){return this.createFromStudyClasses(e).map(n=>N(A({},n),{state:le.Rating,evaluationText:this.translate.instant("events.state.rating"),evaluationLink:["/events",n.id,"evaluation"]}))}createFromStudyClasses(e){return e.map(i=>({id:i.Id,designation:i.Number,detailLink:this.buildStudentsLink(i.Id),studentCount:i.StudentCount,state:null}))}getEvaluationText(e,i){let n=e?.label||e?.value;return n?this.translate.instant(`events.state.${n}`)+(n===le.RatingUntil?` ${i?Hi(i,"dd.MM.yyyy"):""}`:""):""}buildStudentsLink(e){return gn(e,this.router.url)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=ie({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var vn=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events"]],features:[re([qe,Ni])],decls:1,vars:0,template:function(i,n){i&1&&f(0,"router-outlet")},dependencies:[Ee],encapsulation:2})}}return t})();var _n=ot({adAsColumns:Ht(Fe),adAsCriteria:Ht(Fe)});var yn=(()=>{class t{constructor(){this.settings=u(oe),this.resourcePath="Configurations",this.http=u(we)}getSubscriptionDetailsDisplay(){return this.http.get(`${this.baseUrl}/Grading`).pipe(M(Ri(_n)))}get baseUrl(){return`${this.settings.apiUrl}/${this.resourcePath}`}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=ie({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var bn=ot({Id:st,IdPerson:Fe,PersonFullname:st,IdGrade:Nt(Fe),GradeValue:Nt(st)});var Sn=(()=>{class t extends Ve{constructor(){let e=u(we),i=u(oe);super(e,i,bn,"GradingItems")}getListForEvent(e){let i=new yi().set("idEvent",e);return this.getList({params:i})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=ie({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Tn(t){return(o,e)=>{let i=0;switch(t.primarySortKey){case"name":i=xn(o,e);break;case"grade":i=kr(o,e),i===0&&(i=xn(o,e));break;default:throw new gt(t.primarySortKey,"Unhandled sort criteria")}return t.ascending?i:-i}}function xn(t,o){return t.gradingItem.PersonFullname.localeCompare(o.gradingItem.PersonFullname)}function kr(t,o){return(t.grade?.Sort??"-").localeCompare(o.grade?.Sort??"-")*-1}var Ir={primarySortKey:"name",ascending:!0},wn="events-evaluation",Mt=(()=>{class t{constructor(){this.route=u(se),this.loadingService=u(Ce),this.coursesService=u(ue),this.studyClassesService=u(Tt),this.gradingItemsService=u(Sn),this.gradingScalesService=u(_t),this.configurationsService=u(yn),this.subscriptionDetailsService=u(dn),this.eventId$=this.route.parent?.params.pipe(S(e=>{let i=e.id;return i?Number(i):null}))??R(null),this.sortCriteria=ye(Ir),this.loading=q(this.loadingService.loading(wn),{requireSync:!0}),this.noEvaluation=L(()=>!this.gradingScale()&&this.columns().length===0&&this.entries().every(({criteria:e})=>e.length===0)),this.event=q(this.eventId$.pipe(M(this.loadEvaluationEvent.bind(this))),{initialValue:null}),this.columns=L(()=>this.collectColumns(this.columnSubscriptionDetails())),this.entries=L(()=>this.sortEntries(this.unsortedEntries(),this.sortCriteria())),this.gradingItems=q(this.eventId$.pipe(M(this.loadGradingItems.bind(this)),Ie([])),{initialValue:[]}),this.gradingScale=q($e(this.event).pipe(M(e=>this.loadGradingScale(e?.gradingScaleId??null))),{initialValue:null}),this.subscriptionDetailsDisplay=q(this.loadSubscriptionDetailsDisplay(),{initialValue:null}),this.subscriptionDetails=q(this.eventId$.pipe(M(this.loadSubscriptionDetails.bind(this))),{initialValue:[]}),this.columnSubscriptionDetails=L(()=>this.filterColumns(this.subscriptionDetails(),this.subscriptionDetailsDisplay())),this.criteriaSubscriptionDetails=L(()=>this.filterCriteria(this.subscriptionDetails(),this.subscriptionDetailsDisplay())),this.unsortedEntries=L(()=>this.collectEntries(this.gradingItems(),this.gradingScale(),this.columns(),this.columnSubscriptionDetails(),this.criteriaSubscriptionDetails()))}loadEvaluationEvent(e){return e===null?R(null):this.loadingService.load(z([this.loadCourse(e),this.loadStudyClass(e)]).pipe(S(([i,n])=>i??n)),wn)}loadCourse(e){let i=new At().set(Ut,{disableErrorHandlingForStatus:[404]});return this.coursesService.getCourseWithStudentCount(e,{context:i}).pipe(Wt(),S(n=>n?this.buildEvaluationEventFromCourse(n):null))}loadStudyClass(e){let i=new At().set(Ut,{disableErrorHandlingForStatus:[404]});return this.studyClassesService.get(e,{context:i}).pipe(Wt(),S(n=>n?this.buildEvaluationEventFromStudyClass(n):null))}buildEvaluationEventFromCourse(e){let i=e.Classes?.map(s=>s.Number)??[],n=i.length>0?`${e.Designation}, ${i.join(", ")}`:e.Designation;return{id:e.Id,designation:n,type:"course",studentCount:e.AttendanceRef.StudentCount??0,gradingScaleId:e.GradingScaleId}}buildEvaluationEventFromStudyClass(e){return{id:e.Id,designation:e.Designation,type:"study-class",studentCount:e.StudentCount,gradingScaleId:null}}loadGradingItems(e){return e?this.gradingItemsService.getListForEvent(e):R([])}loadGradingScale(e){return e?this.gradingScalesService.get(e):R(null)}loadSubscriptionDetailsDisplay(){return this.configurationsService.getSubscriptionDetailsDisplay()}loadSubscriptionDetails(e){return e?this.subscriptionDetailsService.getListForEvent(e):R([])}filterColumns(e,i){if(!i)return[];let n=i.adAsColumns,s=e.filter(h=>n.includes(Number(h.VssId)));return jt(s,h=>h.Sort)}filterCriteria(e,i){if(!i)return[];let n=i.adAsCriteria,s=e.filter(h=>n.includes(Number(h.VssId)));return jt(s,h=>h.Sort)}collectColumns(e){return ut(e,i=>i.VssId).map(i=>({vssId:i.VssId,title:i.VssDesignation,tooltip:i.Tooltip,sort:i.Sort}))}collectEntries(e,i,n,s,h){return e.map(b=>this.buildEntry(b,i,n,s,h))}buildEntry(e,i,n,s,h){let b=s.filter(ve=>ve.IdPerson===e.IdPerson),X=h.filter(ve=>ve.IdPerson===e.IdPerson);return{gradingItem:e,grade:this.findGrade(e,i),columns:n.map(({vssId:ve})=>b.find(Rt=>Rt.VssId===ve)??null),criteria:X}}findGrade(e,i){let n=i?.Grades??[];return e.IdGrade?n.find(s=>s.Id===e.IdGrade)??null:null}sortEntries(e,i){return[...e].sort(Tn(i))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=ie({token:t,factory:t.\u0275fac})}}return t})();var Mr=t=>({count:t}),En=(()=>{class t{constructor(){this.reportsService=u(je),this.route=u(se),this.event=O.required(),this.reports=q($e(this.event).pipe(S(e=>e.id),ee(),M(e=>e?this.reportsService.getEvaluationReports(e):R([])),Ie([]))),this.returnlink=this.route.snapshot.queryParamMap.get("returnlink")??"/events"}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-evaluation-header"]],inputs:{event:[1,"event"]},decls:11,vars:9,consts:[[3,"link"],[1,"d-flex"],[1,"ms-2",3,"reports"],["id","excel-import"],[1,"d-flex","flex-column","header"],[1,"additional-info"]],template:function(i,n){if(i&1&&(d(0,"bkd-backlink",0)(1,"div",1),f(2,"bkd-reports-link",2)(3,"div",3),a()(),d(4,"div",4)(5,"h1"),p(6),a(),d(7,"div",5),$(8),p(9),l(10,"translate"),a()()),i&2){m("link",n.returnlink),r(2),m("reports",n.reports()),r(4),C(n.event().designation);let s=n.event().studentCount;r(3),y(" ",F(10,4,s===1?"courses.registration":"courses.registrations",G(7,Mr,s))," ")}},dependencies:[ke,E,Ne],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem;border-bottom:1px solid #dee2e6}h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"],changeDetection:0})}}return t})();var Or=576,ze=(()=>{class t{constructor(){this.portal=u(on),this.inlineHeader=O.required(),this.stickyHeader=O.required(),this.handleWindowScroll=()=>{this.updateStickyVisibility(),this.updateStickyTopOffset()},this.handleWindowResize=()=>{this.updateStickyWidth(),this.updateStickyVisibility(),this.updateStickyTopOffset()},this.handleTableScroll=()=>{this.updateStickyLeftOffset()}}ngAfterViewInit(){this.handleWindowScroll(),this.handleTableScroll(),this.handleWindowResize(),this.window.addEventListener("scroll",this.handleWindowScroll),this.getTableScrollContainer()?.addEventListener("scroll",this.handleTableScroll),this.window.addEventListener("resize",this.handleWindowResize)}ngOnDestroy(){this.window.removeEventListener("scroll",this.handleWindowScroll),this.getTableScrollContainer()?.removeEventListener("scroll",this.handleTableScroll),this.window.removeEventListener("resize",this.handleWindowResize)}refresh(){setTimeout(()=>this.updateStickyWidth())}get window(){return this.portal.window??window}getTableScrollContainer(){return document.querySelector(".table-responsive-wrapper")??null}updateStickyVisibility(){if(this.isSmallBreakpointDown())return;let e=this.inlineHeader().getTop()+this.getIframeScrollY();this.stickyHeader().shown.set(this.getScrollTop()>e)}updateStickyTopOffset(){this.isSmallBreakpointDown()||this.stickyHeader().setTopOffset(this.portal.inIframe?this.getScrollTop():0)}updateStickyLeftOffset(){this.isSmallBreakpointDown()||this.stickyHeader().setLeftOffset(this.inlineHeader().getLeft())}updateStickyWidth(){this.isSmallBreakpointDown()||(this.stickyHeader().setWidth(this.inlineHeader().getWidth()),this.stickyHeader().setColumnWidths(this.inlineHeader().getColumnWidths()),this.stickyHeader().setStickyColumnHeights(this.inlineHeader().getStickyColumnsHeights()))}getScrollTop(){return this.window.scrollY-this.portal.getIframeTop()}getIframeScrollY(){return window.scrollY}isSmallBreakpointDown(){return window.innerWidth<Or}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=li({type:t,selectors:[["","bkdTableHeaderSticky",""]],inputs:{inlineHeader:[1,"inlineHeader"],stickyHeader:[1,"stickyHeader"]}})}}return t})();var Ot=(()=>{class t{get stickyClass(){return this.sticky()}constructor(){this.element=u(ai),this.sticky=O(!1),this.shown=ye(!1),vi(this.updateShownClass.bind(this))}getTop(){return this.element.nativeElement.getBoundingClientRect().top}getLeft(){return this.element.nativeElement.getBoundingClientRect().left}setTopOffset(e){this.element.nativeElement.style.top=`${e}px`}setLeftOffset(e){this.element.nativeElement.style.left=`${e}px`}getWidth(){return this.element.nativeElement.getBoundingClientRect().width}setWidth(e){this.element.nativeElement.style.width=`${e}px`}getColumnWidths(){return this.getRowsAndColumns().map(e=>e.map(i=>i.getBoundingClientRect().width))}setColumnWidths(e){let i=this.getRowsAndColumns();if(i.length!==e.length||!i.every((n,s)=>n.length===e[s].length))throw new Error("Given column widths do not match number of header rows/columns");i.forEach((n,s)=>n.forEach((h,b)=>{h.style.width=`${e[s][b]}px`,h.style.minWidth=`${e[s][b]}px`}))}getStickyColumnsHeights(){return this.getRowsAndColumns(".sticky").map(e=>e.map(i=>i.getBoundingClientRect().height))}setStickyColumnHeights(e){let i=this.getRowsAndColumns(".sticky");if(i.length!==e.length||!i.every((n,s)=>n.length===e[s].length))throw new Error("Given column heights do not match number of sticky header columns");i.forEach((n,s)=>n.forEach((h,b)=>{h.style.height=`${e[s][b]}px`})),this.getRows().forEach((n,s)=>{let h=e[s].reduce((b,X)=>Math.max(b,X),0);n.style.height=`${h}px`})}updateShownClass(){let e=this.element.nativeElement.classList;this.shown()?e.add("shown"):e.remove("shown")}getRowsAndColumns(e){return this.getRows().map(i=>Array.from(i.querySelectorAll(`th:not(.header-mobile)${e??""}`)))}getRows(){return Array.from(this.element.nativeElement.querySelectorAll("tr"))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["ng-component"]],hostVars:2,hostBindings:function(i,n){i&2&&K("sticky",n.stickyClass)},inputs:{sticky:[1,"sticky"]},decls:0,vars:0,template:function(i,n){},encapsulation:2})}}return t})();var Dr=["bkdEvaluationTableHeader",""],Lr=(t,o)=>o.vssId;function Fr(t,o){if(t&1){let e=D();d(0,"th",5)(1,"bkd-sortable-header",1),l(2,"translate"),U("sortCriteriaChange",function(n){T(e);let s=g();return j(s.sortCriteria,n)||(s.sortCriteria=n),w(n)}),a()()}if(t&2){let e=g();K("selected",e.gradeColumnSelected()),r(),m("label",c(2,5,"evaluation.columns.grade"))("sortKey","grade"),W("sortCriteria",e.sortCriteria)}}function $r(t,o){if(t&1&&(d(0,"th",6),p(1),a()),t&2){let e=o.$implicit,i=g();K("selected",i.isColumnSelected(e)),m("title",e.tooltip),r(),y(" ",e.title," ")}}var Pn=(()=>{class t extends Ot{constructor(){super(...arguments),this.columns=O.required(),this.sortCriteria=he.required(),this.selectedColumn=O.required(),this.eventType=O.required(),this.gradeColumnSelected=L(()=>this.selectedColumn()===Ze)}isColumnSelected(e){return this.getColumnKey(e)===this.selectedColumn()}getColumnKey(e){return Je.includes(e.vssId)?Xe:e.vssId}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=nt(t)))(n||t)}})()}static{this.\u0275cmp=v({type:t,selectors:[["thead","bkdEvaluationTableHeader",""]],inputs:{columns:[1,"columns"],sortCriteria:[1,"sortCriteria"],selectedColumn:[1,"selectedColumn"],eventType:[1,"eventType"]},outputs:{sortCriteria:"sortCriteriaChange"},features:[rt],attrs:Dr,decls:8,vars:8,consts:[[1,"sticky","student-name"],[3,"sortCriteriaChange","label","sortKey","sortCriteria"],[1,"border-end","sticky","student-grade","desktop",3,"selected"],[1,"subscription-detail",3,"selected","title"],[1,"filler"],[1,"border-end","sticky","student-grade","desktop"],[1,"subscription-detail",3,"title"]],template:function(i,n){i&1&&(d(0,"tr")(1,"th",0)(2,"bkd-sortable-header",1),l(3,"translate"),U("sortCriteriaChange",function(h){return j(n.sortCriteria,h)||(n.sortCriteria=h),h}),a()(),x(4,Fr,3,7,"th",2),B(5,$r,2,4,"th",3,Lr),f(7,"th",4),a()),i&2&&(r(),K("border-end",n.eventType()==="study-class"),r(),m("label",c(3,6,"evaluation.columns.name"))("sortKey","name"),W("sortCriteria",n.sortCriteria),r(2),_(n.eventType()==="course"?4:-1),r(),V(n.columns()))},dependencies:[E,Ue],styles:["[_nghost-%COMP%]{--spacer: 16px;--grade-input-size: 127px;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--subscription-detail-columns-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (max-width: 810px){th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%]{width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));min-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));max-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer))}}th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .subscription-detail[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%], tfoot[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.student-grade[_ngcontent-%COMP%], .subscription-detail[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}}.sticky[_nghost-%COMP%]{position:fixed;top:0;left:0;z-index:1000;display:none}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;vertical-align:top}@media (min-width: 811px){.sticky.shown[_nghost-%COMP%]{display:table-header-group}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;padding-top:.25rem;padding-bottom:.25rem;border-top:initial}.sticky[_nghost-%COMP%]{margin-left:var(--subscription-detail-columns-offset)}.sticky[_nghost-%COMP%]   th.sticky[_ngcontent-%COMP%]{position:fixed}}"],changeDetection:0})}}return t})();var Gr=(t,o)=>o.gradingItem.Id,Rr=(t,o)=>o.vssId,Br=t=>["student",t,"grades"];function Vr(t,o){if(t&1&&(d(0,"td",12),p(1),a()),t&2){let e=g().$implicit,i=g();K("selected",i.gradeColumnSelected()),r(),y(" ",e.grade==null?null:e.grade.Designation," ")}}function Ar(t,o){if(t&1&&f(0,"bkd-subscription-detail-field",14),t&2){let e=g().$implicit;m("detail",e)("hideLabel",!0)("layout","horizontal")}}function Hr(t,o){if(t&1&&(d(0,"td",13),x(1,Ar,1,3,"bkd-subscription-detail-field",14),a()),t&2){let e=o.$implicit,i=g(2);K("selected",i.isColumnSelected(e)),r(),_(e?1:-1)}}function Nr(t,o){if(t&1&&(d(0,"tr")(1,"td",6)(2,"a",11)(3,"div"),p(4),a()()(),x(5,Vr,2,3,"td",7),B(6,Hr,2,3,"td",8,ci),f(8,"td",9),a()),t&2){let e=o.$implicit,i=g();r(),K("border-end",i.eventType()==="study-class"),r(),m("routerLink",G(5,Br,e.gradingItem.IdPerson)),r(2),C(e.gradingItem.PersonFullname),r(),_(i.eventType()==="course"?5:-1),r(),V(e.columns)}}function jr(t,o){if(t&1&&(d(0,"td",12),p(1),l(2,"decimalOrDash"),a()),t&2){let e=g();K("selected",e.gradeColumnSelected()),r(),y(" ",F(2,3,e.gradesAverage(),"1-3")," ")}}function Wr(t,o){if(t&1&&f(0,"td",13),t&2){let e=o.$implicit,i=g();K("selected",i.isColumnSelected(e))}}var kn=(()=>{class t{constructor(){this.sortCriteria=he.required(),this.selectedColumn=O.required(),this.columns=O.required(),this.entries=O.required(),this.eventType=O.required(),this.gradeColumnSelected=L(()=>this.selectedColumn()===Ze),this.gradesAverage=L(()=>this.getGradesAverage(this.entries()))}isColumnSelected(e){return e?this.getColumnKey(e)===this.selectedColumn():!1}getColumnKey(e){let i="VssId"in e?e.VssId:e.vssId;return Je.includes(i)?Xe:i}getGradesAverage(e){let i=e.map(({grade:n})=>n?.Value).filter(n=>n!=null&&n!==0);return Qe(i)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-evaluation-table"]],inputs:{sortCriteria:[1,"sortCriteria"],selectedColumn:[1,"selectedColumn"],columns:[1,"columns"],entries:[1,"entries"],eventType:[1,"eventType"]},outputs:{sortCriteria:"sortCriteriaChange"},decls:19,vars:15,consts:[["inlineHeader",""],["stickyHeader",""],[1,"table-responsive-wrapper"],["bkdTableHeaderSticky","",1,"table","table-hover","h-100",3,"inlineHeader","stickyHeader"],["bkdEvaluationTableHeader","",3,"sortCriteriaChange","columns","sortCriteria","selectedColumn","eventType"],["bkdEvaluationTableHeader","",3,"sortCriteriaChange","sticky","columns","sortCriteria","selectedColumn","eventType"],[1,"sticky","student-name"],[1,"border-end","sticky","student-grade",3,"selected"],[1,"subscription-detail",3,"selected"],[1,"filler"],[1,"action-buttons"],[3,"routerLink"],[1,"border-end","sticky","student-grade"],[1,"subscription-detail"],[3,"detail","hideLabel","layout"]],template:function(i,n){if(i&1){let s=D();d(0,"div",2)(1,"table",3)(2,"thead",4,0),U("sortCriteriaChange",function(b){return T(s),j(n.sortCriteria,b)||(n.sortCriteria=b),w(b)}),a(),d(4,"thead",5,1),U("sortCriteriaChange",function(b){return T(s),j(n.sortCriteria,b)||(n.sortCriteria=b),w(b)}),a(),d(6,"tbody"),B(7,Nr,9,7,"tr",null,Gr),a(),d(9,"tfoot")(10,"tr")(11,"td",6),p(12),l(13,"translate"),a(),x(14,jr,3,6,"td",7),B(15,Wr,1,2,"td",8,Rr),f(17,"td",9),a()()(),f(18,"div",10),a()}if(i&2){let s=ge(3),h=ge(5);r(),m("inlineHeader",s)("stickyHeader",h),r(),m("columns",n.columns()),W("sortCriteria",n.sortCriteria),m("selectedColumn",n.selectedColumn())("eventType",n.eventType()),r(2),m("sticky",!0)("columns",n.columns()),W("sortCriteria",n.sortCriteria),m("selectedColumn",n.selectedColumn())("eventType",n.eventType()),r(3),V(n.entries()),r(5),y(" ",c(13,13,"evaluation.average")," "),r(2),_(n.eventType()==="course"?14:-1),r(),V(n.columns())}},dependencies:[Z,E,Pn,ze,yt,pn],styles:["[_nghost-%COMP%]{--spacer: 16px;--grade-input-size: 127px;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--subscription-detail-columns-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (max-width: 810px){th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%]{width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));min-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));max-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer))}}th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .subscription-detail[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%], tfoot[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.student-grade[_ngcontent-%COMP%], .subscription-detail[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child{text-decoration:underline}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}@media (min-width: 811px){.table-responsive-wrapper[_ngcontent-%COMP%]{display:block;overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.action-buttons[_ngcontent-%COMP%]{position:sticky;left:0}}"],changeDetection:0})}}return t})();function Ur(t,o){t&1&&f(0,"bkd-spinner")}function qr(t,o){t&1&&(d(0,"p",1),p(1),l(2,"translate"),a()),t&2&&(r(),C(c(2,1,"evaluation.no-event")))}function zr(t,o){t&1&&(d(0,"p",1),p(1),l(2,"translate"),a()),t&2&&(r(),C(c(2,1,"evaluation.no-items")))}function Kr(t,o){t&1&&(d(0,"p",1),p(1),l(2,"translate"),a()),t&2&&(r(),C(c(2,1,"evaluation.no-evaluation")))}function Yr(t,o){if(t&1){let e=D();d(0,"bkd-select",5),U("valueChange",function(n){T(e),g(4);let s=P(1);return j(s,n),w(n)}),a()}if(t&2){let e=g(4),i=P(1);m("options",e.columnOptions()),W("value",i),m("allowEmpty",!1)}}function Qr(t,o){if(t&1){let e=D();x(0,Yr,1,3,"bkd-select",3),d(1,"bkd-evaluation-table",4),U("sortCriteriaChange",function(n){T(e);let s=g(3);return j(s.state.sortCriteria,n)||(s.state.sortCriteria=n),w(n)}),a()}if(t&2){g();let e=P(1),i=g(2),n=P(0),s=P(1);_(i.columnOptions().length>1?0:-1),r(),W("sortCriteria",i.state.sortCriteria),m("columns",i.state.columns())("entries",e)("selectedColumn",s())("eventType",n.type)}}function Zr(t,o){if(t&1&&(f(0,"bkd-evaluation-header",2),$(1),x(2,zr,3,3,"p",1)(3,Kr,3,3,"p",1)(4,Qr,2,6)),t&2){let e=g(2),i=P(0);m("event",i),r();let n=H(e.state.entries());r(),_(n.length===0?2:e.state.noEvaluation()?3:4)}}function Xr(t,o){if(t&1&&x(0,Zr,5,3),t&2){g();let e=P(0);_(e?0:-1)}}var Ze=-1,Xe=-2,Je=[3710,3720],In=(()=>{class t{constructor(){this.state=u(Mt),this.translate=u(ae),this.columnOptions=L(()=>{let e={Key:Ze,Value:this.translate.instant("evaluation.columns.grade")},i={Key:Xe,Value:this.translate.instant("evaluation.columns.absences")},n=ut(this.state.columns().map(({vssId:s,title:h})=>Je.includes(s)?i:{Key:s,Value:h}),s=>s.Key);return[this.state.event()?.type==="course"?e:null,...n].filter(ce)}),this.selectedColumn=L(()=>{let e=this.columnOptions(),i=e.length?Number(e[0].Key):null;return ye(i)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-evaluation-list"]],decls:6,vars:3,consts:[[1,"bkd-container"],[1,"mt-3","px-3"],[3,"event"],["width","100%",1,"columns-dropdown",3,"options","value","allowEmpty"],[3,"sortCriteriaChange","sortCriteria","columns","entries","selectedColumn","eventType"],["width","100%",1,"columns-dropdown",3,"valueChange","options","value","allowEmpty"]],template:function(i,n){if(i&1&&($(0)(1),d(2,"div",0),x(3,Ur,1,0,"bkd-spinner")(4,qr,3,3,"p",1)(5,Xr,1,1),a()),i&2){let s=H(n.state.event());r(),H(n.selectedColumn()),r(2),_(n.state.loading()?3:s?5:4)}},dependencies:[E,En,kn,me,Pe],styles:[".columns-dropdown[_ngcontent-%COMP%]{display:block;padding:1rem 0}@media (min-width: 811px){.columns-dropdown[_ngcontent-%COMP%]{display:none}}"],changeDetection:0})}}return t})();var Mn=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-evaluation"]],features:[re([Mt])],decls:1,vars:0,template:function(i,n){i&1&&f(0,"router-outlet")},dependencies:[Ee],encapsulation:2,changeDetection:0})}}return t})();var On=(()=>{class t extends Ve{constructor(){let e=u(we),i=u(oe);super(e,i,Ui,"ApprenticeshipContracts")}getCompaniesForStudents(e){if(e.length===0)return R([]);let i=new Date,n={"filter.StudentId":`;${e.join(";")}`,"filter.ApprenticeshipDateFrom":`<${i.toISOString()}`,"filter.ApprenticeshipDateTo":`>${i.toISOString()}`,fields:"Id,StudentId,CompanyName,CompanyNameAddition"};return this.http.get(`${this.baseUrl}/`,{params:n}).pipe(M(Bi(qi)))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=ie({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Dn(t,o,e){o||ri(t);let i=o??u(oi);return e?ni(i,e):i}function et(t,o){let e=Dn(et,o?.injector),i;return L(()=>(i||(i=Ci(()=>q(t,N(A({},o),{injector:e})))),i()))}var Dt=1;var Ln=10,Lt=(()=>{class t{constructor(){this.route=u(se),this.loadingService=u(Ce),this.eventsService=u(xt),this.coursesService=u(ue),this.subscriptionsService=u(We),this.personsService=u(ft),this.apprenticeshipContractsService=u(On),this.lessonPresencesService=u(Ki),this.reportsService=u(je),this.eventId$=z([this.route.paramMap,this.route.parent?.paramMap??R(null)]).pipe(S(([e,i])=>Number(e.get("id")||i?.get("id"))),ee()),this.eventSummary$=this.eventId$.pipe(M(this.loadEventSummary.bind(this)),te(1)),this.eventSummary=et(this.eventSummary$,{initialValue:null}),this.eventTypeId=L(()=>this.eventSummary()?.EventTypeId??null),this.studentEntries=et(this.loadStudentEntries(),{initialValue:null}),this.isStudyCourse=L(()=>this.eventTypeId()===Dt),this.loading=q(this.loadingService.loading(Et)),this.title=L(()=>this.getTitle(this.studentEntries())),this.multipleStudyClasses=L(()=>(this.studentEntries()?.studyClasses?.length??0)>1),this.searchTerm=ye(""),this.sortCriteria=ye({primarySortKey:"registrationDate",ascending:!1}),this.entries=L(()=>this.studentEntries()?.entries??[]),this.sortedEntries=L(()=>this.sortStudentEntries(this.entries(),this.sortCriteria())),this.filteredEntries=L(()=>wt(this.sortedEntries(),["name","status","company","studyClass"],this.searchTerm())),this.mailtoLink=L(()=>this.getMailtoLink(this.eventTypeId(),this.entries())),this.reports=et(this.eventSummary$.pipe(_e(ce)).pipe(M(this.loadReports.bind(this))),{initialValue:[]})}loadEventSummary(e){return this.loadingService.load(this.eventsService.getEventSummary(e),Et)}loadStudentEntries(){return this.eventSummary$.pipe(M(e=>{let i=()=>{if(!e)return R(null);switch(e.EventTypeId){case Dt:return this.loadStudyCourseStudents(e);case Ln:return this.loadStudyClassStudents(e.Id);default:return this.loadCourseStudents(e.Id)}};return this.loadingService.load(i(),Et)}))}loadStudyCourseStudents({Id:e,Designation:i}){return this.subscriptionsService.getSubscriptionsByCourse(e).pipe(M(n=>this.personsService.getSummaries(n.map(({PersonId:s})=>s).filter(ce)).pipe(S(s=>zt(e,s,n,{eventDesignation:i})))))}loadStudyClassStudents(e){return this.subscriptionsService.getSubscriptionsByCourse(e,{"filter.IsOkay":"=1"}).pipe(M(i=>{let n=i.map(({PersonId:s})=>s).filter(ce);return z([this.personsService.getSummaries(n),this.apprenticeshipContractsService.getCompaniesForStudents(n)]).pipe(S(([s,h])=>{let b=zt(e,s,i,{emailFallback:!0});return qt(b,h)}))}))}loadCourseStudents(e){return this.coursesService.getExpandedCourseWithParticipants(e).pipe(S(fn),M(i=>z([this.apprenticeshipContractsService.getCompaniesForStudents(i.entries.map(({id:n})=>n)),this.lessonPresencesService.getLessonStudyClassesByEvent(e)]).pipe(S(([n,s])=>{let h=qt(i,n);return Cn(h,s)}))))}getTitle(e){if(!e||!e.eventDesignation)return null;let{eventDesignation:i,studyClasses:n}=e;return[i,...n].join(", ")}getMailtoLink(e,i){if(e===null||e===Dt)return null;let n=i.map(s=>s.email).filter(Boolean);return n.length>0?`mailto:${n.join(";")}`:null}loadReports({Id:e,EventTypeId:i}){switch(i){case null:case Dt:return R([]);case Ln:return this.reportsService.getStudyClassStudentsReports(e);default:return this.reportsService.getCourseStudentsReports(e)}}sortStudentEntries(e,i){return[...e].sort(Jr(i))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=ie({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Jr(t){return(o,e)=>{switch(t.primarySortKey){case"registrationDate":return es(o,e,t.ascending);case"name":return Fn(o,e,t.ascending);default:throw new gt(t.primarySortKey,"Unhandled sort criteria")}}}function es(t,o,e){let i=t.registrationDate?new Date(t.registrationDate).getTime():0,n=o.registrationDate?new Date(o.registrationDate).getTime():0,s=e?i-n:n-i;return s===0?Fn(t,o,!0):s}function Fn(t,o,e){return e?t.name.localeCompare(o.name):o.name.localeCompare(t.name)}var $n=(()=>{class t{constructor(){this.entry=O.required(),this.multipleStudyClasses=O(!1),this.returnLink=O(null),this.link=L(()=>["student",this.entry().id,"contact"]),this.linkParams=L(()=>{let e=this.returnLink();return e?{returnparams:new URLSearchParams({returnlink:e}).toString()}:{}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-students-course-entry"]],inputs:{entry:[1,"entry"],multipleStudyClasses:[1,"multipleStudyClasses"],returnLink:[1,"returnLink"]},decls:7,vars:10,consts:[[1,"avatar","large",3,"studentId","link","linkParams"],[1,"name",3,"title","routerLink","queryParams"],[1,"study-class"],[1,"company",3,"title"]],template:function(i,n){i&1&&(f(0,"bkd-avatar",0),d(1,"a",1),p(2),a(),d(3,"div",2),p(4),a(),d(5,"div",3),p(6),a()),i&2&&(m("studentId",n.entry().id)("link",n.link())("linkParams",n.linkParams()),r(),m("title",n.entry().name)("routerLink",n.link())("queryParams",n.linkParams()),r(),C(n.entry().name),r(2),y(" ",n.multipleStudyClasses()?n.entry().studyClass:"",`
`),r(),m("title",n.entry().company),r(),C(n.entry().company))},dependencies:[Z,an],styles:['[_nghost-%COMP%]{display:grid;grid-template-columns:min-content 1fr;grid-template-rows:min-content min-content 1fr;grid-template-areas:"avatar name" "avatar study-class" "avatar company";padding:2rem 1rem}.avatar[_ngcontent-%COMP%]{grid-area:avatar;margin-right:1.5rem}.name[_ngcontent-%COMP%]{grid-area:name}.study-class[_ngcontent-%COMP%]{grid-area:study-class;font-size:.875rem}.company[_ngcontent-%COMP%]{grid-area:company;align-content:end;padding-bottom:1.5rem}.name[_ngcontent-%COMP%], .company[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}'],changeDetection:0})}}return t})();var ts=t=>({count:t});function is(t,o){if(t&1&&(d(0,"div",0),p(1),l(2,"translate"),a()),t&2){g();let e=P(2);r(),y(" ",F(2,1,e===1?"events-students.registration":"events-students.registrations",G(4,ts,e))," ")}}var Ft=(()=>{class t{constructor(){this.title=O.required(),this.count=O(null),this.searchTerm=he()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-students-header"]],inputs:{title:[1,"title"],count:[1,"count"],searchTerm:[1,"searchTerm"]},outputs:{searchTerm:"searchTermChange"},decls:7,vars:10,consts:[[1,"additional-info"],[1,"search",3,"valueChange","value","placeholder","label"]],template:function(i,n){if(i&1){let s=D();d(0,"h1"),p(1),a(),$(2),x(3,is,3,6,"div",0),d(4,"bkd-resettable-input",1),l(5,"translate"),l(6,"translate"),k("valueChange",function(b){return T(s),w(n.searchTerm.set(b))}),a()}if(i&2){r(),C(n.title()),r();let s=H(n.count());r(),_(s!==null?3:-1),r(),m("value",n.searchTerm())("placeholder",c(5,6,"events-students.search-placeholder"))("label",c(6,8,"events-students.search"))}},dependencies:[E,Pt],styles:["h1[_ngcontent-%COMP%]{margin-bottom:0}.search[_ngcontent-%COMP%]{margin-top:1rem;display:flex;max-width:300px}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"],changeDetection:0})}}return t})();var ns=(t,o)=>o.id;function rs(t,o){t&1&&(d(0,"p"),p(1),l(2,"translate"),a()),t&2&&(r(),C(c(2,1,"events-students.no-entries")))}function ss(t,o){if(t&1&&f(0,"bkd-events-students-course-entry",2),t&2){let e=o.$implicit,i=g();m("entry",e)("multipleStudyClasses",i.multipleStudyClasses())("returnLink",i.returnLink())}}var Gn=(()=>{class t{constructor(){this.title=O.required(),this.count=O.required(),this.entries=O.required(),this.multipleStudyClasses=O(!1),this.returnLink=O(null),this.searchTerm=he()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-students-course-list"]],inputs:{title:[1,"title"],count:[1,"count"],entries:[1,"entries"],multipleStudyClasses:[1,"multipleStudyClasses"],returnLink:[1,"returnLink"],searchTerm:[1,"searchTerm"]},outputs:{searchTerm:"searchTermChange"},decls:5,vars:4,consts:[[3,"searchTermChange","title","count","searchTerm"],[1,"list"],[3,"entry","multipleStudyClasses","returnLink"]],template:function(i,n){i&1&&(d(0,"bkd-events-students-header",0),U("searchTermChange",function(h){return j(n.searchTerm,h)||(n.searchTerm=h),h}),a(),d(1,"section",1),x(2,rs,3,3,"p"),B(3,ss,1,3,"bkd-events-students-course-entry",2,ns),a()),i&2&&(m("title",n.title())("count",n.count()),W("searchTerm",n.searchTerm),r(2),_(n.entries().length===0?2:-1),r(),V(n.entries()))},dependencies:[E,Ft,$n],styles:["[_nghost-%COMP%]{display:block;overflow:hidden}section.list[_ngcontent-%COMP%]{width:calc(100% + 1px);margin-top:1rem;display:grid;grid-template-columns:repeat(auto-fill,minmax(400px,1fr))}bkd-events-students-course-entry[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;border-right:1px solid #dee2e6}"],changeDetection:0})}}return t})();var Rn=(()=>{class t{constructor(){this.entry=O.required(),this.returnLink=O(null),this.link=L(()=>["study-course-student",this.entry().id]),this.linkParams=L(()=>{let e=this.returnLink();return e?{returnparams:new URLSearchParams({returnlink:e}).toString()}:{}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-students-study-course-entry"]],inputs:{entry:[1,"entry"],returnLink:[1,"returnLink"]},decls:7,vars:8,consts:[[1,"name",3,"routerLink","queryParams"],[1,"status"],[1,"registration-date"]],template:function(i,n){i&1&&(d(0,"a",0),p(1),a(),d(2,"div",1),p(3),a(),d(4,"div",2),p(5),l(6,"date"),a()),i&2&&(m("routerLink",n.link())("queryParams",n.linkParams()),r(),C(n.entry().name),r(2),C(n.entry().status),r(2),y(" ",F(6,5,n.entry().registrationDate,"dd.MM.yyyy"),`
`))},dependencies:[Z,_i,Te],styles:['[_nghost-%COMP%]{display:grid;align-items:center;grid-template-areas:"name status registration-date";grid-template-columns:2fr 1fr 1fr;border-bottom:1px solid #dee2e6}.name[_ngcontent-%COMP%], .status[_ngcontent-%COMP%], .registration-date[_ngcontent-%COMP%]{padding:1rem}.name[_ngcontent-%COMP%]{grid-area:name;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.status[_ngcontent-%COMP%]{grid-area:status;padding-left:0}.registration-date[_ngcontent-%COMP%]{grid-area:registration-date}@media (max-width: 750px){[_nghost-%COMP%]{grid-template-areas:"name registration-date" "status registration-date";grid-template-columns:2fr 1fr;align-items:start}.name[_ngcontent-%COMP%]{padding-bottom:0}.status[_ngcontent-%COMP%]{padding-top:0;padding-left:1rem;font-size:.875rem}}'],changeDetection:0})}}return t})();var os=(t,o)=>o.id;function as(t,o){if(t&1){let e=D();d(0,"div",2)(1,"bkd-sortable-header",4),l(2,"translate"),U("sortCriteriaChange",function(n){T(e);let s=g();return j(s.sortCriteria,n)||(s.sortCriteria=n),w(n)}),a(),d(3,"bkd-sortable-header",5),l(4,"translate"),U("sortCriteriaChange",function(n){T(e);let s=g();return j(s.sortCriteria,n)||(s.sortCriteria=n),w(n)}),a()()}if(t&2){let e=g();r(),m("label",c(2,6,"events-students.list.header.name"))("sortKey","name"),W("sortCriteria",e.sortCriteria),r(2),m("label",c(4,8,"events-students.list.header.registration-date"))("sortKey","registrationDate"),W("sortCriteria",e.sortCriteria)}}function ds(t,o){t&1&&(d(0,"p"),p(1),l(2,"translate"),a()),t&2&&(r(),C(c(2,1,"events-students.no-entries")))}function ls(t,o){if(t&1&&f(0,"bkd-events-students-study-course-entry",3),t&2){let e=o.$implicit,i=g();m("entry",e)("returnLink",i.returnLink())}}var Bn=(()=>{class t{constructor(){this.title=O.required(),this.count=O.required(),this.entries=O.required(),this.returnLink=O(null),this.sortCriteria=he.required(),this.searchTerm=he()}updateSortCriteria(e){this.sortCriteria.set(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-students-study-course-list"]],inputs:{title:[1,"title"],count:[1,"count"],entries:[1,"entries"],returnLink:[1,"returnLink"],sortCriteria:[1,"sortCriteria"],searchTerm:[1,"searchTerm"]},outputs:{sortCriteria:"sortCriteriaChange",searchTerm:"searchTermChange"},features:[re([])],decls:6,vars:4,consts:[[3,"searchTermChange","title","count","searchTerm"],[1,"list"],[1,"list-header"],[3,"entry","returnLink"],[1,"name",3,"sortCriteriaChange","label","sortKey","sortCriteria"],[1,"registration-date",3,"sortCriteriaChange","label","sortKey","sortCriteria"]],template:function(i,n){i&1&&(d(0,"bkd-events-students-header",0),U("searchTermChange",function(h){return j(n.searchTerm,h)||(n.searchTerm=h),h}),a(),d(1,"section",1),x(2,as,5,10,"div",2)(3,ds,3,3,"p"),B(4,ls,1,2,"bkd-events-students-study-course-entry",3,os),a()),i&2&&(m("title",n.title())("count",n.count()),W("searchTerm",n.searchTerm),r(2),_(n.entries().length>0?2:3),r(2),V(n.entries()))},dependencies:[E,Ft,Rn,Ue],styles:[".list-header[_ngcontent-%COMP%]{cursor:pointer;display:grid;grid-template-columns:3fr 1fr;align-items:center;border-bottom:2px solid #dee2e6}.name[_ngcontent-%COMP%], .registration-date[_ngcontent-%COMP%]{padding:1rem}.name[_ngcontent-%COMP%]{flex:3}.registration-date[_ngcontent-%COMP%]{flex:1}@media (max-width: 750px){.list-header[_ngcontent-%COMP%]{grid-template-columns:2fr 1fr}.name[_ngcontent-%COMP%]{flex:2}.registration-date[_ngcontent-%COMP%]{flex:1;white-space:nowrap}}"],changeDetection:0})}}return t})();var ps=t=>[t];function cs(t,o){if(t&1&&(d(0,"a",4)(1,"i",6),p(2,"mail"),a()()),t&2){let e=g(2);m("href",e.state.mailtoLink(),Se)}}function ms(t,o){if(t&1&&(d(0,"bkd-backlink",0)(1,"div",3),x(2,cs,3,1,"a",4),f(3,"bkd-reports-link",5),a()()),t&2){let e=g(),i=P(0);m("link",G(3,ps,i)),r(2),_(e.state.mailtoLink()?2:-1),r(),m("reports",e.state.reports())}}function us(t,o){t&1&&f(0,"bkd-spinner")}function hs(t,o){t&1&&(d(0,"p"),p(1),l(2,"translate"),a()),t&2&&(r(),C(c(2,1,"events-students.no-entries")))}function gs(t,o){if(t&1){let e=D();d(0,"bkd-events-students-study-course-list",7),U("sortCriteriaChange",function(n){T(e);let s=g();return j(s.state.sortCriteria,n)||(s.state.sortCriteria=n),w(n)})("searchTermChange",function(n){T(e);let s=g();return j(s.state.searchTerm,n)||(s.state.searchTerm=n),w(n)}),a()}if(t&2){let e=g();m("title",e.state.title())("count",e.state.entries().length)("entries",e.state.filteredEntries())("returnLink",e.returnLink()),W("sortCriteria",e.state.sortCriteria)("searchTerm",e.state.searchTerm)}}function fs(t,o){if(t&1){let e=D();d(0,"bkd-events-students-course-list",8),U("searchTermChange",function(n){T(e);let s=g();return j(s.state.searchTerm,n)||(s.state.searchTerm=n),w(n)}),a()}if(t&2){let e=g();m("title",e.state.title())("count",e.state.entries().length)("entries",e.state.filteredEntries())("multipleStudyClasses",e.state.multipleStudyClasses())("returnLink",e.returnLink()),W("searchTerm",e.state.searchTerm)}}var Vn=(()=>{class t{constructor(){this.state=u(Lt),this.route=u(se),this.returnLink=q(this.route.queryParams.pipe(S(({returnlink:e})=>e?decodeURIComponent(e):null)))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-students-list"]],decls:6,vars:3,consts:[[3,"link"],[3,"title","count","entries","returnLink","sortCriteria","searchTerm"],[3,"title","count","entries","multipleStudyClasses","returnLink","searchTerm"],[1,"d-flex"],["target","_blank",1,"mail","btn","btn-primary","btn-icon","me-2",3,"href"],[1,"ms-2",3,"reports"],[1,"material-icons"],[3,"sortCriteriaChange","searchTermChange","title","count","entries","returnLink","sortCriteria","searchTerm"],[3,"searchTermChange","title","count","entries","multipleStudyClasses","returnLink","searchTerm"]],template:function(i,n){if(i&1&&($(0),x(1,ms,4,5,"bkd-backlink",0)(2,us,1,0,"bkd-spinner")(3,hs,3,3,"p")(4,gs,1,6,"bkd-events-students-study-course-list",1)(5,fs,1,6,"bkd-events-students-course-list",2)),i&2){let s=H(n.returnLink());r(),_(s?1:-1),r(),_(n.state.loading()?2:n.state.entries().length===0?3:n.state.isStudyCourse()?4:5)}},dependencies:[E,me,ke,Ne,Gn,Bn],encapsulation:2,changeDetection:0})}}return t})();var Cs=(t,o)=>o.id;function vs(t,o){if(t&1&&(p(0),l(1,"date")),t&2){g(2);let e=P(2);y(" ",F(1,1,e.Birthdate,"dd.MM.yyyy")," ")}}function _s(t,o){if(t&1&&p(0),t&2){g(2);let e=P(2);y(" (",e.Gender,") ")}}function ys(t,o){if(t&1&&(p(0),f(1,"br")),t&2){g(2);let e=P(2);y(" ",e.AddressLine1,"")}}function bs(t,o){if(t&1&&(p(0),f(1,"br")),t&2){g(2);let e=P(2);y(" ",e.AddressLine2,"")}}function Ss(t,o){if(t&1&&(p(0),f(1,"br")),t&2){g(2);let e=P(2);Ye(" ",e.Zip," ",e.Location,"")}}function xs(t,o){if(t&1&&(d(0,"a",4),p(1),a(),f(2,"br")),t&2){g(2);let e=P(2);Ke("href","tel:",e.PhonePrivate,"",Se),r(),C(e.PhonePrivate)}}function Ts(t,o){if(t&1&&(d(0,"a",4),p(1),a(),f(2,"br")),t&2){g(2);let e=P(2);Ke("href","tel:",e.PhoneMobile,"",Se),r(),C(e.PhoneMobile)}}function ws(t,o){if(t&1&&(d(0,"a",4),p(1),a(),f(2,"br")),t&2){g(2);let e=P(2);Ke("href","mailto:",e.Email,"",Se),r(),y(" ",e.Email," ")}}function Es(t,o){if(t&1&&(d(0,"a",4),p(1),a(),f(2,"br")),t&2){g(2);let e=P(2);Ke("href","mailto:",e.Email2,"",Se),r(),y(" ",e.Email2," ")}}function Ps(t,o){if(t&1&&(d(0,"h1"),p(1),a(),d(2,"span",3),x(3,vs,2,4)(4,_s,1,1),a(),d(5,"address"),x(6,ys,2,1)(7,bs,2,1)(8,Ss,2,2)(9,xs,3,3)(10,Ts,3,3)(11,ws,3,3)(12,Es,3,3),a()),t&2){g();let e=P(2);r(),C(e.FullName),r(2),_(e.Birthdate?3:-1),r(),_(e.Gender?4:-1),r(2),_(e.AddressLine1?6:-1),r(),_(e.AddressLine2?7:-1),r(),_(e.Zip&&e.Location?8:-1),r(),_(e.PhonePrivate?9:-1),r(),_(e.PhoneMobile?10:-1),r(),_(e.Email?11:-1),r(),_(e.Email2?12:-1)}}function ks(t,o){if(t&1&&(d(0,"div",2),p(1),l(2,"translate"),d(3,"span",5),p(4),a()()),t&2){g();let e=P(4);r(),y(" ",c(2,2,"events-students.study-course-detail.status"),": "),r(3),C(e)}}function Is(t,o){if(t&1&&(d(0,"div",6)(1,"h2"),p(2),a()()),t&2){let e=g().$implicit;r(2),C(e.label)}}function Ms(t,o){if(t&1&&(d(0,"a",7),p(1),a()),t&2){let e=g(2).$implicit;xe("href",e.file,Se),r(),C(e.value)}}function Os(t,o){if(t&1&&p(0),t&2){let e=g(2).$implicit;y(" ",e.value," ")}}function Ds(t,o){if(t&1&&(d(0,"div",6)(1,"div"),p(2),a(),x(3,Ms,2,2,"a",7)(4,Os,1,1),a()),t&2){let e=g().$implicit;r(2),C(e.label),r(),_(e.file!==null?3:4)}}function Ls(t,o){if(t&1&&x(0,Is,3,1,"div",6)(1,Ds,5,2,"div",6),t&2){let e=o.$implicit;_(e.heading?0:e.value?1:-1)}}function Fs(t,o){t&1&&f(0,"bkd-spinner")}var An=(()=>{class t{constructor(){this.settings=u(oe),this.route=u(se),this.personsService=u(ft),this.subscriptionsService=u(We),this.storageService=u(Be),this.loadingService=u(Ce),this.eventId$=this.route.parent?.paramMap.pipe(S(e=>Number(e.get("id"))))??R(0),this.personId$=this.route.paramMap.pipe(S(e=>Number(e.get("id")))),this.person=q(this.personId$.pipe(M(e=>this.personsService.get(e))),{initialValue:null}),this.subscription=q(this.loadSubscription()),this.subscriptionId=L(()=>this.subscription()?.Id??null),this.subscriptionDetails=q(this.loadSubscriptionDetails(),{initialValue:[]}),this.backLink=q(this.route.queryParams.pipe(S(({returnparams:e})=>e),S(ji))),this.loading=q(this.loadingService.loading$,{initialValue:!0})}loadSubscription(){return this.loadingService.load(z([this.eventId$,this.personId$]).pipe(M(([e,i])=>this.subscriptionsService.getSubscriptionsByCourse(e,{"filter.PersonId":`=${i}`})),S(e=>e[0]??null)),{stopOnFirstValue:!0})}loadSubscriptionDetails(){return this.loadingService.load($e(this.subscriptionId).pipe(_e(ce),M(e=>this.subscriptionsService.getSubscriptionDetailsById(e)),S(e=>e.map(i=>this.toSubscriptionDetailsEntry(i)))),{stopOnFirstValue:!0})}toSubscriptionDetailsEntry(e){let i=e.Value??"";return i=this.normalizeSubscriptionDetailsDropdownValue(e,i)??"",{id:e.Id,label:e.VssDesignation,value:i,file:this.buildFileUrl(e),heading:e.VssStyle==="HE"}}normalizeSubscriptionDetailsDropdownValue(e,i){return e.DropdownItems&&e.VssStyle!=="CB"?e.DropdownItems.find(n=>String(n.Key)===i)?.Value??i:i}buildFileUrl(e){if(e.VssStyle==="PD"||e.VssStyle==="PF"||e.VssStyle==="DA"){let i=this.storageService.getAccessToken()||"";return`${this.settings.apiUrl}/Files/SubscriptionDetails/${e.Id}?token=${i}`}return null}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-students-study-course-detail"]],decls:9,vars:6,consts:[[1,"bkd-container","bkd-container-limited"],["link","../..",3,"params"],[1,"status"],[1,"additional-info"],[3,"href"],[1,"ms-2"],[1,"detail"],["target","_blank",3,"href"]],template:function(i,n){if(i&1&&(d(0,"div",0),f(1,"bkd-backlink",1),$(2),x(3,Ps,13,10),$(4),x(5,ks,5,4,"div",2),B(6,Ls,2,1,null,null,Cs),x(8,Fs,1,0,"bkd-spinner"),a()),i&2){let s;r(),m("params",n.backLink()),r();let h=H(n.person());r(),_(h?3:-1),r();let b=H((s=n.subscription())==null?null:s.Status);r(),_(b?5:-1),r(),V(n.subscriptionDetails()),r(2),_(n.loading()?8:-1)}},dependencies:[E,Te,ke,me],styles:["h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}address[_ngcontent-%COMP%]{margin:1rem 0}.status[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem 0;border-top:1px solid #dee2e6;border-bottom:1px solid #dee2e6}.detail[_ngcontent-%COMP%]{max-width:70ch;padding-top:1rem}.detail[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.detail[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-weight:400;color:#00000080}"],changeDetection:0})}}return t})();var Hn=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-students"]],features:[re([Lt])],decls:1,vars:0,template:function(i,n){i&1&&f(0,"router-outlet")},dependencies:[Ee],encapsulation:2,changeDetection:0})}}return t})();function $s(t,o){if(t&1&&(d(0,"span"),p(1),l(2,"date"),f(3,"wbr"),p(4),l(5,"date"),a()),t&2){let e=g();r(),y("",F(2,2,e.event().dateFrom,"dd.MM.yyyy"),"\u2013"),r(3),C(F(5,5,e.event().dateTo,"dd.MM.yyyy"))}}function Gs(t,o){if(t&1&&(d(0,"div",5)(1,"a",6)(2,"i",7),p(3,"arrow_right_alt"),a(),d(4,"span",8),p(5),a()()()),t&2){let e=g();r(),m("routerLink",e.event().evaluationLink),r(4),y("",e.event().evaluationText," ")}}var Nn=(()=>{class t{constructor(){this.event=O.required(),this.withRatings=O(!0),this.link=L(()=>Wi(this.event().detailLink))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-list-entry"]],inputs:{event:[1,"event"],withRatings:[1,"withRatings"]},decls:11,vars:9,consts:[[1,"designation"],[3,"routerLink","queryParams"],[1,"date"],[1,"registrations"],[1,"registrations-label"],[1,"rating"],[1,"d-flex",3,"routerLink"],[1,"material-icons"],[1,"ps-1"]],template:function(i,n){i&1&&(d(0,"div",0)(1,"a",1),p(2),a()(),d(3,"div",2),x(4,$s,6,8,"span"),a(),d(5,"div",3),p(6),d(7,"span",4),p(8),l(9,"translate"),a()(),x(10,Gs,6,2,"div",5)),i&2&&(r(),m("routerLink",n.link().link)("queryParams",n.link().params),r(),C(n.event().designation),r(2),_(n.event().dateFrom&&n.event().dateTo?4:-1),r(2),y(" ",n.event().studentCount," "),r(2),C(c(9,7,n.event().studentCount===1?"events.registration":"events.registrations")),r(2),_(n.withRatings()&&n.event().evaluationText?10:-1))},dependencies:[Z,Te,E],styles:['[_nghost-%COMP%]{display:grid;padding:1rem;border-bottom:1px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}.designation[_ngcontent-%COMP%]{grid-area:designation;padding-right:1rem}.date[_ngcontent-%COMP%]{grid-area:date;padding-right:1rem}.registrations[_ngcontent-%COMP%]{grid-area:registrations;padding-right:1rem}.rating[_ngcontent-%COMP%]{grid-area:rating}.rating[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.registrations-label[_ngcontent-%COMP%]{display:none}@media (max-width: 575.98px){.registrations-label[_ngcontent-%COMP%]{display:inline}.designation[_ngcontent-%COMP%], .date[_ngcontent-%COMP%], .registrations[_ngcontent-%COMP%]{padding-right:0}[_nghost-%COMP%]{grid-template-areas:"designation" "date" "registrations" "rating";grid-template-columns:1fr}}']})}}return t})();var Rs=(t,o)=>o.id,Bs=()=>[];function Vs(t,o){t&1&&f(0,"bkd-spinner")}function As(t,o){t&1&&(d(0,"div",7),p(1),l(2,"translate"),a()),t&2&&(r(),y(" ",c(2,1,"events.rating")," "))}function Hs(t,o){if(t&1&&f(0,"bkd-events-list-entry",8),t&2){let e=o.$implicit,i=g(3);m("event",e)("withRatings",i.withRatings)}}function Ns(t,o){if(t&1&&(d(0,"div",3)(1,"div",4),p(2),l(3,"translate"),a(),d(4,"div",5),p(5),l(6,"translate"),a(),d(7,"div",6),p(8),l(9,"translate"),a(),x(10,As,3,3,"div",7),a(),B(11,Hs,1,2,"bkd-events-list-entry",8,Rs)),t&2){let e=g(2),i=P(0);r(2),C(c(3,4,"events.designation")),r(3),C(c(6,6,"events.date")),r(3),y(" ",c(9,8,"events.registrations")," "),r(2),_(e.withRatings?10:-1),r(),V(i)}}function js(t,o){t&1&&(d(0,"p",2),p(1),l(2,"translate"),a()),t&2&&(r(),C(c(2,1,"events.no-events")))}function Ws(t,o){if(t&1&&x(0,Ns,13,10)(1,js,3,3,"p",2),t&2){g();let e=P(0);_(e.length>0?0:1)}}var jn=["designation"],Us=[...jn,"evaluationText"],$t=(()=>{class t{constructor(){this.state=u(qe),this.storage=u(Be),this.withStudyCourses=!1,this.withRatings=!0,this.state.setRoles(this.storage.getPayload()?.roles??null)}ngOnChanges(e){e.withStudyCourses&&this.state.setWithStudyCourses(e.withStudyCourses.currentValue),e.withRatings&&this.state.setSearchFields(e.withRatings.currentValue?Us:jn)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-list"]],inputs:{withStudyCourses:"withStudyCourses",withRatings:"withRatings"},features:[Me],decls:10,vars:17,consts:[[1,"bkd-container"],[1,"d-flex","search",3,"valueChange","value","placeholder","label","disabled"],[1,"mt-3"],[1,"event-header"],[1,"designation"],[1,"date"],[1,"registrations"],[1,"rating"],[3,"event","withRatings"]],template:function(i,n){if(i&1){let s=D();$(0),l(1,"async"),d(2,"div",0)(3,"bkd-resettable-input",1),l(4,"async"),l(5,"translate"),l(6,"translate"),k("valueChange",function(b){return T(s),w(n.state.setSearch(b))}),a(),x(7,Vs,1,0,"bkd-spinner"),l(8,"async"),x(9,Ws,2,1),a()}if(i&2){let s,h=H((s=c(1,5,n.state.getEntries(n.withRatings)))!==null&&s!==void 0?s:De(16,Bs));r(3),m("value",c(4,8,n.state.search$))("placeholder",c(5,10,"events.search-by"))("label",c(6,12,"events.search"))("disabled",!h),r(4),_(c(8,14,n.state.loading$)?7:9)}},dependencies:[Pt,me,Q,E,Nn],styles:['.search[_ngcontent-%COMP%]{max-width:500px}.event-header[_ngcontent-%COMP%]{display:grid;padding:1rem;border-bottom:2px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr;font-weight:500}@media (max-width: 575.98px){.event-header[_ngcontent-%COMP%]{display:none}}']})}}return t})();var Wn=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-tests"]],decls:4,vars:4,consts:[[3,"withRatings"]],template:function(i,n){i&1&&(d(0,"h1"),p(1),l(2,"translate"),a(),f(3,"bkd-events-list",0)),i&2&&(r(),C(c(2,2,"events.title")),r(2),m("withRatings",!0))},dependencies:[$t,E],encapsulation:2})}}return t})();function Kt(t){return t.map(({finalGrade:o})=>o).filter(qs)}function qs(t){return t!==null}function zn(t,o,e,i){return t?.map(n=>({student:n,finalGrade:Ks(n,e,i),grades:zs(n,o)}))}function zs(t,o){return o.map(e=>{if(e.Results===void 0||e.Results?.length===0)return{kind:"no-result",test:e};let i=e.Results?.find(n=>n.StudentId===t.Id);return i!==void 0?{kind:"grade",result:i,test:e}:{kind:"no-result",test:e}})}function Ks(t,o,e){let i=o.find(s=>s.StudentId===t.Id);if(i)return{gradingId:i.Id,gradeId:i.GradeId??void 0,average:i.AverageTestResult||void 0,canGrade:i.CanGrade};let n=e.find(s=>s.StudentId===t.Id);if(n)return{finalGradeValue:n.Grade,average:n.AverageTestResult||void 0,canGrade:!1};throw new Error(`Student ${t.FullName} has neither a grading and nor a final grade, this should not happen`)}var Kn=({primarySortKey:t,ascending:o},e)=>{let i=o?1:-1,n=null;if(t.startsWith("Test-")){let s=Number(t.replace("Test-",""));n=e.find(h=>h.Id===s)??null}return(s,h)=>{switch(t){case"FullName":return i*s.student.FullName.localeCompare(h.student.FullName);case"FinalGrade":return!s.finalGrade?.gradeId||!h.finalGrade?.gradeId?i*-1:i*Un(s.finalGrade.gradeId,h.finalGrade.gradeId);case"TestsMean":return!s.finalGrade?.average||!h.finalGrade?.average?i*-1:i*Un(s.finalGrade.average,h.finalGrade.average);default:return t.startsWith("Test-")&&n?i*Ys(n,s,h):0}}},Ys=(t,o,e)=>{let i=o.grades.filter(qn).find(s=>s.test.Id===t.Id),n=e.grades.filter(qn).find(s=>s.test.Id===t.Id);return t.IsPointGrading&&i?.result.GradeId===n?.result.GradeId?(i?.result.Points??0)-(n?.result.Points??0):((i?.result.GradeId??Number.POSITIVE_INFINITY)-(n?.result.GradeId??Number.POSITIVE_INFINITY))*-1};function Un(t,o){return t===o?0:t<o?-1:1}function qn(t){return t.kind==="grade"}function Yn(t){return(t?.test?.MaxPointsAdjusted||t?.test?.MaxPoints)??0}function Qn(t){let o=t.map(e=>e.average).filter(e=>e!=null&&e!==0).map(Number);return Qe(o)}function Zn(t,o){return Qe(t.map(e=>Qs(e,o)).filter(Vi))}function Qs({gradeId:t,finalGradeValue:o},e){let i;t?i=e.find(h=>h.Key===t)?.Value:i=o;let n=Number(i);return isNaN(n)?0:n}var Xn=(()=>{class t extends Ve{constructor(){let e=u(we),i=u(oe);super(e,i,nn,"Gradings")}updateGrade(e,i){return this.http.put(`${this.baseUrl}/${e}`,{GradeId:i}).pipe(S(()=>e))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=ie({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Yt(t,o){return[...o.filter(e=>e.Id!==t?.Id),t].filter(e=>e!=null)}function Jn({id:t,selectedGradeId:o},e){return e.map(i=>i.Id!==t?i:N(A({},i),{GradeId:o}))}function er(t,o){switch(o.type){case"reset":return o.payload;case"updateResult":return t?N(A({},t),{Tests:Zi(o.payload.testResult,t.Tests||[],o.payload.ignore),Gradings:o.payload.grading?Yt(o.payload.grading,t.Gradings||[]):t.Gradings}):null;case"deleteResult":return t?N(A({},t),{Tests:Xi(o.payload.testId,o.payload.studentId,t.Tests||[]),Gradings:o.payload.grading?Yt(o.payload.grading,t.Gradings||[]):t.Gradings||[]}):null;case"toggle-test-state":return t?N(A({},t),{Tests:Ji(o.payload,t.Tests||[])}):null;case"final-grade-overwritten":return t?N(A({},t),{Gradings:Jn({id:o.payload.id,selectedGradeId:o.payload.selectedGradeId},t.Gradings||[])}):null;case"replace-grades":return t?N(A({},t),{Gradings:o.payload}):null;case"delete-test":return t?N(A({},t),{Tests:en(o.payload,t.Tests||[])}):null;default:return t}}var Qt={onlyMine:!1,hidePublished:!1},J=(()=>{class t{constructor(){this.coursesRestService=u(ue),this.gradingScalesRestService=u(_t),this.gradingsRestService=u(Xn),this.loadingService=u(Ce),this.sortService=u(cn),this.action$=new Bt(1),this.loading$=this.loadingService.loading$,this._courseId$=new Bt(1),this.courseId$=this._courseId$.asObservable(),this.fetchedCourse$=this._courseId$.pipe(M(e=>this.loadingService.load(this.coursesRestService.getExpandedCourse(e))),te(1)),this.course$=tt(this.action$,this.fetchedCourse$.pipe(_e(ce),S(e=>({type:"reset",payload:e})))).pipe(ii(er,null),_e(ce),te(1)),this.tests$=this.course$.pipe(S(e=>e.Tests||[]),S(tn)),this.hasTests$=this.tests$.pipe(S(e=>e.length>0)),this.filterSubject$=new Y(Qt),this.filter$=this.filterSubject$.asObservable(),this.expandedHeaderSubject$=new Y(!1),this.expandedHeader$=this.expandedHeaderSubject$.asObservable(),this.filteredTests$=z([this.tests$,this.filter$]).pipe(S(([e,i])=>e.filter(n=>(!i.onlyMine||n.IsOwner)&&(!i.hidePublished||!n.IsPublished)))),this.sortCriteria$=this.sortService.sortCriteria$,this.sortCriteria=this.sortService.sortCriteria,this.studentGrades$=z([this.course$,this.filteredTests$,this.sortCriteria$]).pipe(S(He(this.toStudentGrades.bind(this)))),this.canSetFinalGrade$=this.course$.pipe(S(mn)),this.gradingScaleIds$=this.course$.pipe(S(e=>$i([...(e.Tests??[]).map(i=>i.GradingScaleId),e.GradingScaleId]).filter(ce)),ee(Fi),te(1)),this.gradingScales$=this.gradingScaleIds$.pipe(M(e=>this.gradingScalesRestService.getListForIds(e)),te(1)),this.UNDEFINED_GRADINGSCALE_ID=-1,this.gradingScalesOptions$=this.gradingScales$.pipe(S(e=>e.map(i=>{let n=i?.Id||this.UNDEFINED_GRADINGSCALE_ID,s=i?.Grades.map(h=>({Key:h.Id,Value:h.Designation}))||[];return{id:n,options:s}}).reduce((i,n)=>N(A({},i),{[n.id]:n.options}),{})),te(1)),this.meanOfStudentGradesForCourse$=this.studentGrades$.pipe(S(e=>Qn(Kt(e)))),this.meanOfFinalGradesForCourse$=z([this.gradingScalesOptions$,this.studentGrades$]).pipe(M(He(this.meanOfOverwrittenGradesForCourse.bind(this))))}setCourseId(e){this._courseId$.next(e)}reload(){this._courseId$.pipe(ne(1)).subscribe(e=>{this.setCourseId(e)})}setFilter(e){this.filterSubject$.next(e)}gradingOptionsForTest$(e){return this.gradingOptions$(e.GradingScaleId)}gradingOptionsForCourse$(){return this.course$.pipe(M(e=>this.gradingOptions$(e.GradingScaleId)))}toStudentGrades(e,i=[],n){let s=zn(e.ParticipatingStudents??[],i,e.Gradings??[],e.FinalGrades??[]);return n?s.sort(Kn(n,i)):s}toggleHeader(e){this.expandedHeaderSubject$.next(e)}optimisticallyUpdateGrade(e){return this.course$.pipe(ne(1),S(i=>{let{originalResult:n,updatedResult:s}=this.buildOptimisticResultUpdate(i,e);return this.updateTestResult(s,null),n}))}saveGrade(e,i){this.course$.pipe(ne(1),M(n=>this.coursesRestService.updateTestResult(n.Id,e).pipe(Jt(s=>(i&&this.updateTestResult(A({},i),null),Xt(()=>s)))))).subscribe(({testResult:n,grading:s})=>this.updateOrDeleteTestResult(e.testId,e.studentId,n,s,"gradeId"in e?"grade":"points"))}publish(e){this.coursesRestService.publishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}unpublish(e){this.coursesRestService.unpublishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}deleteTest(e){this.action$.next({type:"delete-test",payload:e})}overwriteFinalGrade({id:e,selectedGradeId:i}){this.gradingsRestService.updateGrade(e,i).subscribe(()=>{this.action$.next({type:"final-grade-overwritten",payload:{id:e,selectedGradeId:i}})})}setAveragesAsFinalGrades(e){this.coursesRestService.setAverageAsFinalGrade(e).subscribe(i=>this.action$.next({type:"replace-grades",payload:i.Gradings}))}buildOptimisticResultUpdate(e,i){let n=Qi(e,i.testId,i.studentId),s=n?A({},n):{Id:"",TestId:i.testId,StudentId:i.studentId,CourseRegistrationId:0,GradeId:null,GradeValue:null,GradeDesignation:null,Points:null};return s.GradeId="gradeId"in i?i.gradeId:n?.GradeId??null,s.Points="points"in i?i.points:n?.Points??null,{originalResult:n,updatedResult:s}}updateOrDeleteTestResult(e,i,n,s,h){n?this.updateTestResult(n,s,h):this.deleteTestResult(e,i,s)}updateTestResult(e,i,n){this.action$.next({type:"updateResult",payload:{testResult:e,grading:i??null,ignore:n}})}deleteTestResult(e,i,n){this.action$.next({type:"deleteResult",payload:{testId:e,studentId:i,grading:n}})}toggleTestPublishedState(e){this.action$.next({type:"toggle-test-state",payload:e})}gradingOptions$(e){return e===null?R(null):this.gradingScalesOptions$.pipe(S(i=>i[e]),te(1))}meanOfOverwrittenGradesForCourse(e,i){return this.course$.pipe(S(n=>{if(n.GradingScaleId===null||e[n.GradingScaleId]===void 0)return null;let s=e[n.GradingScaleId];return Zn(Kt(i),s)}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=ie({token:t,factory:t.\u0275fac})}}return t})();function tr(t){return o=>{let e=Number(o.value);return e<=t?{greaterThan:{value:e,greaterThanValue:t}}:null}}var Xs=t=>["/events",t,"tests"];function Js(t,o){if(t&1&&(d(0,"div",7),p(1),l(2,"translate"),a()),t&2){let e=o.$implicit;r(),y(" ",F(2,1,"global.validation-errors."+e.error,e.params)," ")}}function eo(t,o){if(t&1&&(d(0,"div",7),p(1),l(2,"translate"),a()),t&2){let e=o.$implicit;r(),y(" ",F(2,1,"global.validation-errors."+e.error,e.params)," ")}}function to(t,o){if(t&1&&(d(0,"div",7),p(1),l(2,"translate"),a()),t&2){let e=o.$implicit;r(),y(" ",F(2,1,"global.validation-errors."+e.error,e.params)," ")}}function io(t,o){if(t&1&&(d(0,"div",7),p(1),l(2,"translate"),a()),t&2){let e=o.$implicit;r(),y(" ",F(2,1,"global.validation-errors."+e.error,e.params)," ")}}function no(t,o){if(t&1&&(d(0,"div",7),p(1),l(2,"translate"),a()),t&2){let e=o.$implicit;r(),y(" ",F(2,1,"global.validation-errors."+e.error,e.params)," ")}}function ro(t,o){if(t&1&&(d(0,"div",29)(1,"div",30)(2,"div",16)(3,"label",31),p(4),l(5,"translate"),a(),d(6,"div",32),f(7,"input",33),l(8,"async"),B(9,io,3,4,"div",7,Oe),l(11,"async"),a()()(),d(12,"div",30)(13,"div",16)(14,"label",34),p(15),l(16,"translate"),a(),d(17,"div",32),f(18,"input",35),l(19,"async"),B(20,no,3,4,"div",7,Oe),l(22,"async"),a()()()(),d(23,"div",36),si(),d(24,"math")(25,"mi"),p(26),l(27,"translate"),a(),d(28,"mo"),p(29,"="),a(),d(30,"mfrac")(31,"mrow")(32,"mi"),p(33),l(34,"translate"),a(),d(35,"mo"),p(36,"\xD7"),a(),d(37,"mn"),p(38,"5"),a()(),d(39,"mi"),p(40),l(41,"translate"),a()(),d(42,"mo"),p(43,"+"),a(),d(44,"mn"),p(45,"1"),a()()()),t&2){let e,i,n=g(2);r(4),C(c(5,9,"tests.form.max-points")),r(3),K("is-invalid",((e=c(8,11,n.maxPointsErrors$))==null?null:e.length)||!1),r(2),V(c(11,13,n.maxPointsErrors$)),r(6),C(c(16,15,"tests.form.max-points-adjusted")),r(3),K("is-invalid",((i=c(19,17,n.maxPointsAdjustedErrors$))==null?null:i.length)||!1),r(2),V(c(22,19,n.maxPointsAdjustedErrors$)),r(6),y(" ",c(27,21,"tests.form.math.grade")," "),r(7),y(" ",c(34,23,"tests.form.math.points")," "),r(7),C(c(41,25,"tests.form.math.max-points"))}}function so(t,o){t&1&&(d(0,"div",28)(1,"span",37),p(2,"Loading..."),a()())}function oo(t,o){if(t&1){let e=D();d(0,"form",2),k("ngSubmit",function(){T(e);let n=g();return w(n.onSubmit())}),d(1,"div",3)(2,"div",4)(3,"label",5),p(4),l(5,"translate"),a(),f(6,"input",6),l(7,"async"),l(8,"translate"),B(9,Js,3,4,"div",7,Oe),l(11,"async"),a(),d(12,"div",8)(13,"label",9),p(14),l(15,"translate"),a(),d(16,"div",10)(17,"span",11)(18,"i",12),p(19,"calendar_today"),a()(),d(20,"input",13,0),l(22,"async"),l(23,"translate"),k("click",function(){T(e);let n=ge(21);return w(n.toggle())}),a(),B(24,eo,3,4,"div",7,Oe),l(26,"async"),a()()(),d(27,"div",14)(28,"label",15),p(29),l(30,"translate"),a(),d(31,"div",4)(32,"div",16)(33,"label",17),p(34),l(35,"translate"),a(),d(36,"div",18),f(37,"input",19),l(38,"async"),B(39,to,3,4,"div",7,Oe),l(41,"async"),a()()()(),d(42,"div")(43,"label",15),p(44),l(45,"translate"),a(),d(46,"div",20),f(47,"input",21),d(48,"label",22),p(49),l(50,"translate"),a()(),d(51,"div",20),f(52,"input",23),d(53,"label",24),p(54),l(55,"translate"),a()(),x(56,ro,46,27),a(),d(57,"div",25)(58,"button",26),l(59,"async"),p(60),l(61,"translate"),a(),d(62,"button",27),p(63),l(64,"translate"),x(65,so,3,0,"div",28),a()()()}if(t&2){let e,i,n,s,h=g();m("formGroup",h.formGroup),r(4),C(c(5,26,"tests.form.designation")),r(2),K("is-invalid",((e=c(7,28,h.designationErrors$))==null?null:e.length)||!1),m("placeholder",c(8,30,"tests.form.designation-placeholder")),r(3),V(c(11,32,h.designationErrors$)),r(5),C(c(15,34,"tests.form.date")),r(3),m("id",h.componentId),r(3),K("is-invalid",((i=c(22,36,h.dateErrors$))==null?null:i.length)||!1),m("placeholder",c(23,38,"shared.date-select.default-placeholder")),r(4),V(c(26,40,h.dateErrors$)),r(5),C(c(30,42,"tests.form.weight")),r(5),C(c(35,44,"tests.form.factor")),r(3),K("is-invalid",((n=c(38,46,h.weightErrors$))==null?null:n.length)||!1),r(2),V(c(41,48,h.weightErrors$)),r(5),C(c(45,50,"tests.form.grading-type")),r(3),m("value",!1),r(2),C(c(50,52,"tests.form.grades")),r(3),m("value",!0),r(2),C(c(55,54,"tests.form.points")),r(2),_((s=h.formGroup.get("isPointGrading"))!=null&&s.value?56:-1),r(2),m("disabled",h.saving)("routerLink",G(62,Xs,c(59,56,h.courseId$))),r(2),y(" ",c(61,58,"tests.form.cancel")," "),r(2),m("disabled",h.saving),r(),y(" ",c(64,60,"tests.form.save")," "),r(2),_(h.saving?65:-1)}}var Gt=(()=>{class t{constructor(){this.fb=u(ki),this.translate=u(ae),this.testStateService=u(J),this.test=null,this.saving=!1,this.save=new de,this.componentId=Gi("bkd-tests-edit-form"),this.formGroup=this.createFormGroup(),this.submitted$=new Y(!1),this.destroy$=new pe,this.designationErrors$=Ae(R(this.formGroup),this.submitted$,"designation"),this.dateErrors$=Ae(R(this.formGroup),this.submitted$,"date"),this.maxPointsErrors$=Ae(R(this.formGroup),this.submitted$,"maxPoints"),this.maxPointsAdjustedErrors$=Ae(R(this.formGroup),this.submitted$,"maxPointsAdjusted"),this.weightErrors$=Ae(R(this.formGroup),this.submitted$,"weight"),this.courseId$=this.testStateService.courseId$}ngOnInit(){this.test&&this.setInitialValues(this.test),Ai(R(this.formGroup),"isPointGrading").pipe(be(this.destroy$)).subscribe(this.togglePointFieldsDisability.bind(this))}ngOnDestroy(){this.destroy$.next()}onSubmit(){this.submitted$.next(!0),this.formGroup.valid&&this.save.emit(this.formGroup.value)}createFormGroup(){return this.fb.group({designation:["",Ge.required],date:[null,Ge.required],weight:[1,Ge.compose([Ge.required,tr(0)])],isPointGrading:[!1],maxPoints:[{value:null,disabled:!0},Ge.required],maxPointsAdjusted:[{value:null,disabled:!0},null]})}setInitialValues(e){this.formGroup.patchValue({designation:e.Designation,date:e.Date,weight:e.Weight,isPointGrading:e.IsPointGrading,maxPoints:e.MaxPoints,maxPointsAdjusted:e.MaxPointsAdjusted}),e.Results&&e.Results.length>0&&(this.formGroup.get("isPointGrading")?.disable(),this.formGroup.get("maxPoints")?.disable(),this.formGroup.get("maxPointsAdjusted")?.disable()),this.togglePointFieldsDisability()}togglePointFieldsDisability(){let e=this.formGroup.get("maxPoints"),i=this.formGroup.get("maxPointsAdjusted");this.formGroup.get("isPointGrading")?.value?(e?.enable(),i?.enable()):(e?.reset({value:this.test?.MaxPoints,disabled:!0}),i?.reset({value:this.test?.MaxPointsAdjusted,disabled:!0}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-edit-form"]],inputs:{test:"test",saving:"saving"},outputs:{save:"save"},features:[re([{provide:Mi,useClass:Li},{provide:Oi,useClass:ln}])],decls:1,vars:1,consts:[["dp","ngbDatepicker"],[3,"formGroup"],[3,"ngSubmit","formGroup"],[1,"row","g-3","mb-3"],[1,"col-md-6"],["for","designation",1,"form-label"],["id","designation","name","designation","type","text","formControlName","designation","required","",1,"form-control",3,"placeholder"],[1,"invalid-feedback"],[1,"col-md-6","mb-3"],["for","date",1,"form-label"],[1,"input-group"],[1,"input-group-text",3,"id"],[1,"material-icons"],["id","date","name","date","type","text","ngbDatepicker","","formControlName","date","required","",1,"form-control",3,"click","placeholder"],[1,"row","mb-3"],[1,"form-label"],[1,"row"],["for","factor",1,"form-label","col-3","col-sm-2"],[1,"col-9","col-sm-10"],["id","factor","name","factor","type","number","formControlName","weight","step","0.05","min","0","required","",1,"form-control"],[1,"form-check"],["type","radio","formControlName","isPointGrading","id","type-grades",1,"form-check-input",3,"value"],["for","type-grades",1,"form-check-label"],["type","radio","formControlName","isPointGrading","id","type-points",1,"form-check-input",3,"value"],["for","type-points",1,"form-check-label"],[1,"d-flex","justify-content-end","mt-4"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","routerLink"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"row","ms-4","mb-3","g-3"],[1,"col-sm-6","col-md-4"],["for","max-points",1,"ms-2","col-4","col-form-label"],[1,"col-6"],["type","number","name","maxPoints","id","max-points","formControlName","maxPoints","step","0.01","min","0","max","999","required","",1,"form-control"],["for","max-points-adjusted",1,"ms-2","col-4","col-form-label"],["type","number","name","maxPointsAdjusted","id","max-points-adjusted","formControlName","maxPointsAdjusted","step","0.01","min","0","max","999",1,"form-control"],[1,"ms-4","ps-3","py-3"],[1,"visually-hidden"]],template:function(i,n){i&1&&x(0,oo,66,64,"form",1),i&2&&_(n.formGroup?0:-1)},dependencies:[Re,xi,at,lt,Ti,dt,bi,Pi,ct,pt,Ii,wi,Ei,Di,Z,Q,E],styles:["#factor[_ngcontent-%COMP%], #max-points[_ngcontent-%COMP%], #max-points-adjusted[_ngcontent-%COMP%]{width:5em}"]})}}return t})();var ir=(()=>{class t{constructor(){this.courseService=u(ue),this.toastService=u(ht),this.translate=u(ae),this.router=u(Le),this.state=u(J),this.saving$=new Y(!1)}save(e){this.saving$.next(!0);let{designation:i,date:n,weight:s,isPointGrading:h,maxPoints:b,maxPointsAdjusted:X}=e;this.state.courseId$.pipe(ne(1),M(ve=>this.courseService.add(ve,n,i,s,h,b,X)),it(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.state.reload(),this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}navigateBack(){this.state.courseId$.pipe(ne(1)).subscribe(e=>void this.router.navigate(["events",e,"tests"]))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-add"]],decls:6,vars:6,consts:[[1,"bkd-container","bkd-container-limited"],[3,"save","saving"]],template:function(i,n){i&1&&(d(0,"h1"),p(1),l(2,"translate"),a(),d(3,"div",0)(4,"bkd-tests-edit-form",1),l(5,"async"),k("save",function(h){return n.save(h)}),a()()),i&2&&(r(),C(c(2,2,"tests.add-title")),r(3),m("saving",c(5,4,n.saving$)))},dependencies:[Gt,Q,E],encapsulation:2})}}return t})();var nr=(()=>{class t{constructor(){this.activeModal=u(mt)}get canDeleteTest(){return(this.test?.Results?.filter(i=>i.GradeId!==null||i.GradeValue!==null||i.Points!==null)||[]).length===0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-delete"]],inputs:{test:"test"},decls:13,vars:10,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click","hidden"],[1,"px-2"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"],[1,"px-3"]],template:function(i,n){i&1&&(d(0,"div",0)(1,"p",1),p(2),l(3,"translate"),a()(),d(4,"div",2)(5,"button",3),k("click",function(){return n.activeModal.dismiss()}),d(6,"span",4),p(7),l(8,"translate"),a()(),d(9,"button",5),k("click",function(){return n.activeModal.close(n.canDeleteTest?n.test:null)}),d(10,"span",6),p(11),l(12,"translate"),a()()()),i&2&&(r(2),y(" ",c(3,4,n.canDeleteTest?"tests.form.confirm":"tests.form.delete-not-allowed")," "),r(3),m("hidden",!n.canDeleteTest),r(2),y(" ",c(8,6,"tests.dialog.no")," "),r(4),y(" ",c(12,8,n.canDeleteTest?"tests.dialog.yes":"tests.dialog.ok")," "))},dependencies:[E],encapsulation:2})}}return t})();var ao=t=>({test:t});function lo(t,o){t&1&&f(0,"bkd-spinner")}function po(t,o){if(t&1){let e=D();d(0,"div",1)(1,"h1"),p(2),l(3,"translate"),a(),d(4,"button",2),k("click",function(){T(e);let n=g(),s=P(0);return w(n.openDeleteModal(s))}),d(5,"i",3),p(6,"delete"),a()()(),d(7,"bkd-tests-edit-form",4),k("save",function(n){T(e);let s=g();return w(s.save(n))}),a()}if(t&2){g();let e=P(0),i=P(2);r(2),y(" ",F(3,3,"tests.edit-title",G(6,ao,e.Designation))," "),r(5),m("test",e)("saving",i)}}var rr=(()=>{class t{constructor(){this.state=u(J),this.courseService=u(ue),this.route=u(se),this.toastService=u(ht),this.translate=u(ae),this.router=u(Le),this.modalService=u(bt),this.saving$=new Y(!1),this.testId$=this.route.paramMap.pipe(S(e=>Number(e.get("testId"))),ee()),this.test$=z([this.state.tests$,this.testId$]).pipe(S(([e,i])=>e.find(n=>n.Id===i)))}openDeleteModal(e){let i=this.modalService.open(nr);i.componentInstance.test=e,i.result.then(n=>{n&&this.courseService.delete(e.CourseId,e.Id).subscribe(this.onDeleteSuccess.bind(this))},()=>{})}save(e){this.saving$.next(!0);let{designation:i,date:n,weight:s,isPointGrading:h,maxPoints:b,maxPointsAdjusted:X}=e;z([this.state.courseId$,this.testId$]).pipe(ne(1),M(([ve,Rt])=>this.courseService.update(ve,Rt,i,n,s,h,b,X)),it(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.state.reload(),this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}onDeleteSuccess(e){this.toastService.success(this.translate.instant("tests.form.delete-success")),this.state.deleteTest(e),this.navigateBack()}navigateBack(){this.state.courseId$.pipe(ne(1)).subscribe(e=>void this.router.navigate(["events",e,"tests"]))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-edit"]],decls:8,vars:9,consts:[[1,"bkd-container","bkd-container-limited"],[1,"d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-primary","btn-icon",3,"click"],[1,"material-icons"],[3,"save","test","saving"]],template:function(i,n){if(i&1&&($(0),l(1,"async"),$(2),l(3,"async"),d(4,"div",0),x(5,lo,1,0,"bkd-spinner"),l(6,"async"),x(7,po,8,8),a()),i&2){let s=H(c(1,1,n.test$));r(2),H(c(3,4,n.saving$)),r(3),_(c(6,7,n.state.loading$)?5:s?7:-1)}},dependencies:[Gt,me,Q,E],encapsulation:2})}}return t})();var co=()=>["/events"],mo=t=>({count:t});function uo(t,o){if(t&1&&(d(0,"div",7),p(1),l(2,"translate"),a()),t&2){let e=g();r(),y(" ",F(2,1,e.course.ParticipatingStudents.length===1?"courses.registration":"courses.registrations",G(4,mo,e.course.ParticipatingStudents.length))," ")}}var sr=(()=>{class t{constructor(){this.reportsService=u(je),this.course$=new Y(null),this.reports$=this.course$.pipe(S(e=>e?.Id),ee(),M(e=>e?this.reportsService.getCourseTestsReports(e):R([])),Ie([]))}ngOnChanges(e){e.course&&this.course$.next(e.course.currentValue)}getDesignation(){return It(this.course)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-header"]],inputs:{course:"course"},features:[Me],decls:12,vars:7,consts:[[3,"link"],[1,"d-flex"],["routerLink","add",1,"edit","btn","btn-primary","btn-icon","ms-2"],[1,"material-icons"],[1,"ms-2",3,"reports"],["id","excel-import"],[1,"d-flex","flex-column","header"],[1,"additional-info"]],template:function(i,n){i&1&&(d(0,"bkd-backlink",0)(1,"div",1)(2,"a",2)(3,"i",3),p(4,"add"),a()(),f(5,"bkd-reports-link",4),l(6,"async"),f(7,"div",5),a()(),d(8,"div",6)(9,"h1"),p(10),a(),x(11,uo,3,6,"div",7),a()),i&2&&(m("link",De(6,co)),r(5),m("reports",c(6,4,n.reports$)),r(5),C(n.getDesignation()),r(),_(n.course.ParticipatingStudents?11:-1))},dependencies:[ke,Z,Ne,Q,E],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem;border-bottom:1px solid #dee2e6}h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"]})}}return t})();var ho=t=>({designation:t}),or=(()=>{class t{constructor(){this.activeModal=u(mt)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-publish"]],inputs:{test:"test"},decls:11,vars:12,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"]],template:function(i,n){i&1&&(d(0,"div",0)(1,"p",1),p(2),l(3,"translate"),a()(),d(4,"div",2)(5,"button",3),k("click",function(){return n.activeModal.dismiss()}),p(6),l(7,"translate"),a(),d(8,"button",4),k("click",function(){return n.activeModal.close(!0)}),p(9),l(10,"translate"),a()()),i&2&&(r(2),y(" ",F(3,3,n.test.IsPublished?"tests.publishing.unpublish":"tests.publishing.publish",G(10,ho,n.test.Designation))," "),r(4),y(" ",c(7,6,"tests.publishing.cancel")," "),r(3),y(" ",c(10,8,"tests.publishing.confirm")," "))},dependencies:[E],encapsulation:2})}}return t})();function go(t,o){if(t&1&&(d(0,"span",1),p(1),a()),t&2){let e=g();r(),C(e.calculatePointsAverage(e.test))}}var ar=(()=>{class t{constructor(){this.locale=u(fi)}calculatePointsAverage(e){return this.safeAverage(e,2,Ct)}calculateGradeAverage(e){return this.safeAverage(e,3,vt)}safeAverage(e,i,n){try{return sn(n(e),this.locale,i)}catch{return rn}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-average-grades"]],inputs:{test:"test"},decls:4,vars:2,consts:[[1,"d-flex","flex-row","w-100"],["data-testid","average-points",1,"mr-2","mr-md-3","average-points"],["data-testid","average-grade"]],template:function(i,n){i&1&&(d(0,"div",0),x(1,go,2,1,"span",1),d(2,"span",2),p(3),a()()),i&2&&(r(),_(n.test.IsPointGrading?1:-1),r(2),C(n.calculateGradeAverage(n.test)))},styles:[".average-points[_ngcontent-%COMP%]{min-width:4.5em}@media (min-width: 576px){.average-points[_ngcontent-%COMP%]{min-width:6em}}"]})}}return t})();var dr=(()=>{class t{constructor(){this.disabled=!1,this.width="127px",this.gradeIdSelected=new de}onGradeChange(e){this.gradeId?.valueOf()!==void 0&&this.gradeIdSelected.emit({id:this.gradeId?.valueOf(),selectedGradeId:e})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-grade-select"]],inputs:{options:"options",valueId:"valueId",gradeId:"gradeId",disabled:"disabled",width:"width"},outputs:{gradeIdSelected:"gradeIdSelected"},decls:1,vars:5,consts:[["data-testid","grade-select",3,"valueChange","options","allowEmpty","value","disabled","width"]],template:function(i,n){i&1&&(d(0,"bkd-select",0),k("valueChange",function(h){return n.onGradeChange(h)}),a()),i&2&&m("options",n.options)("allowEmpty",!0)("value",n.valueId)("disabled",n.disabled)("width",n.width)},dependencies:[Pe],encapsulation:2})}}return t})();var fo=t=>({maxPoints:t});function Co(t,o){if(t&1&&(d(0,"div",6),p(1),l(2,"translate"),a()),t&2){let e=g(2);r(),y(" ",F(2,1,"global.validation-errors.invalidPoints",G(4,fo,e.maxPoints))," ")}}function vo(t,o){if(t&1){let e=D();d(0,"div",3)(1,"input",5,0),k("ngModelChange",function(){T(e);let n=ge(2),s=g();return w(s.onPointsChange(n.value))}),a(),x(3,Co,3,6,"div",6),a()}if(t&2){let e=ge(2),i=g();r(),K("is-invalid",e.errors),xe("max",i.maxPoints),xe("tabindex",i.tabIndex),m("disabled",i.grade.test.IsPublished||i.hasFinalGrade)("ngModel",i.grade.kind==="grade"?i.grade.result.Points:null),r(2),_(e.errors?3:-1)}}var _o=1250,lr=(()=>{class t{constructor(){this.state=u(J),this.hasFinalGrade=!1,this.maxPoints=0,this.pointsSubject$=new pe,this.gradeSubject$=new pe,this.gradingScaleDisabledSubject$=new Y(!0),this.gradingScaleDisabled$=this.gradingScaleDisabledSubject$.asObservable(),this.destroy$=new pe}ngOnInit(){this.gradingScaleDisabledSubject$.next(this.isGradingScaleDisabled()),this.maxPoints=Yn(this.grade),this.initSave(this.pointsSubject$.pipe(_e(this.isValid.bind(this)),S(e=>({studentId:this.student.Id,testId:this.grade.test.Id,points:e?Number(e):null})))),this.initSave(this.gradeSubject$.pipe(S(e=>({studentId:this.student.Id,testId:this.grade.test.Id,gradeId:e}))))}ngOnChanges(){this.gradingScaleDisabledSubject$.next(this.isGradingScaleDisabled())}ngOnDestroy(){this.destroy$.next()}onPointsChange(e){this.pointsSubject$.next(e),this.gradingScaleDisabledSubject$.next(!(e===null||e===""))}onGradeChange(e){this.gradeSubject$.next(e)}isValid(e){return e===""||e===null?!0:isNaN(Number(e))?!1:!(Number(e)<0||Number(e)>this.maxPoints)}initSave(e){e.pipe(ei(i=>this.state.optimisticallyUpdateGrade(i).pipe(S(n=>({params:i,originalResult:n})))),ti(_o),be(this.destroy$)).subscribe(({params:i,originalResult:n})=>this.state.saveGrade(i,n))}isGradingScaleDisabled(){return this.grade.test.IsPublished||this.hasFinalGrade||this.grade.test.IsPointGrading&&this.grade.kind==="grade"&&this.grade.result.Points!=null}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-grade"]],inputs:{grade:"grade",student:"student",tabIndex:"tabIndex",gradeOptions:"gradeOptions",hasFinalGrade:"hasFinalGrade"},features:[Me],decls:5,vars:8,consts:[["points","ngModel"],[1,"d-flex","flex-column","w-100"],[1,"d-flex","flex-row"],[1,"point-input-container","me-2","me-md-3"],["data-testid","grade-select",1,"grade-select",3,"valueChange","options","allowEmpty","value","disabled","tabindex"],["type","number","step","0.01","min","0","data-testid","point-input",1,"form-control",3,"ngModelChange","max","disabled","tabindex","ngModel"],["data-testid","validation-error-message",1,"invalid-feedback"]],template:function(i,n){i&1&&(d(0,"div",1)(1,"div",2),x(2,vo,4,7,"div",3),d(3,"bkd-select",4),l(4,"async"),k("valueChange",function(h){return n.onGradeChange(h)}),a()()()),i&2&&(r(2),_(n.grade.test.IsPointGrading?2:-1),r(),m("options",n.gradeOptions)("allowEmpty",!0)("value",n.grade.kind==="grade"?n.grade.result.GradeId:null)("disabled",c(4,6,n.gradingScaleDisabled$))("tabindex",n.tabIndex))},dependencies:[Re,at,lt,dt,ct,pt,Si,Pe,Q,E],styles:[".point-input-container[_ngcontent-%COMP%]{width:4em}[_nghost-%COMP%]     select{width:127px}@media (min-width: 576px){.point-input-container[_ngcontent-%COMP%]{width:5em}}"]})}}return t})();var pr=(t,o)=>({"btn-primary":t,"btn-outline-secondary":o}),cr=(()=>{class t{constructor(){this.filter=Qt,this.filterChange=new de}showOnlyMine(){this.filterChange.next(N(A({},this.filter),{onlyMine:!0}))}showAll(){this.filterChange.next(N(A({},this.filter),{onlyMine:!1}))}onHidePublishedChange(e){let i=(e.target&&e.target instanceof HTMLInputElement&&e.target?.checked)??!1;this.filterChange.next(N(A({},this.filter),{hidePublished:i}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-table-filter"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},decls:13,vars:18,consts:[[1,"only-mine-buttons"],["type","button",1,"btn","desktop",3,"click","ngClass"],["type","button",1,"btn","ms-2","desktop",3,"click","ngClass"],[1,"hide-published"],[1,"form-check"],["id","hide-published","type","checkbox",1,"form-check-input",3,"change","checked"],["for","hide-published",1,"form-check-label"]],template:function(i,n){i&1&&(d(0,"div",0)(1,"button",1),k("click",function(){return n.showAll()}),p(2),l(3,"translate"),a(),d(4,"button",2),k("click",function(){return n.showOnlyMine()}),p(5),l(6,"translate"),a()(),d(7,"div",3)(8,"div",4)(9,"input",5),k("change",function(h){return n.onHidePublishedChange(h)}),a(),d(10,"label",6),p(11),l(12,"translate"),a()()()),i&2&&(r(),m("ngClass",Vt(12,pr,!n.filter.onlyMine,n.filter.onlyMine)),r(),y(" ",c(3,6,"tests.all-tests")," "),r(2),m("ngClass",Vt(15,pr,n.filter.onlyMine,!n.filter.onlyMine)),r(),y(" ",c(6,8,"tests.owned-tests")," "),r(4),m("checked",n.filter.hidePublished),r(2),y(" ",c(12,10,"tests.hide-published")," "))},dependencies:[fe,Re,E],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:100%}.only-mine-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;height:3.625rem}.hide-published[_ngcontent-%COMP%]{display:flex;align-items:center;height:2.375rem;margin-bottom:1rem}.hide-published[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:300}.hide-published[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]{margin-bottom:0}"]})}}return t})();var mr=(()=>{class t{constructor(){this.translate=u(ae)}transform(e){return`${e.Weight} (${e.WeightPercent}%)${this.getPoints(e)}`}getPoints(e){return e.IsPointGrading?`, ${e.MaxPointsAdjusted??e.MaxPoints} ${this.translate.instant("tests.summary.points")}`:""}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275pipe=pi({name:"testSummaryShort",type:t,pure:!0})}}return t})();var yo=["*"],ur=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-preserve-line-height"]],ngContentSelectors:yo,decls:3,vars:0,template:function(i,n){i&1&&(mi(),d(0,"div"),ui(1),p(2,"\xA0"),a())},encapsulation:2})}}return t})();var bo=t=>[t,"edit"];function So(t,o){t&1&&(d(0,"i",9),p(1,"edit"),a())}function xo(t,o){if(t&1&&(d(0,"div",5)(1,"div",7)(2,"bkd-preserve-line-height"),p(3),l(4,"date"),a(),d(5,"a",8),x(6,So,2,0,"i",9),a()(),d(7,"bkd-preserve-line-height"),p(8),l(9,"testSummaryShort"),a(),d(10,"bkd-preserve-line-height"),p(11),a()()),t&2){let e=g();r(3),C(F(4,5,e.test.Date,"dd.MM.yyyy")),r(2),m("routerLink",G(10,bo,e.test.Id)),r(),_(e.test.IsOwner&&e.test.IsPublished===!1?6:-1),r(2),y(" ",c(9,8,e.test)," "),r(3),C(e.test.Owner)}}function To(t,o){if(t&1){let e=D();d(0,"div",6)(1,"a",10),l(2,"translate"),k("click",function(){T(e);let n=g();return w(n.unpublishTest())}),d(3,"i",11),p(4,"lock"),a(),d(5,"span"),p(6),l(7,"translate"),a()(),d(8,"bkd-caret",12),k("click",function(){T(e);let n=g();return w(n.emitToggleHeader())}),a()()}if(t&2){let e=g();r(),xe("title",c(2,3,"tests.edit")),r(5),C(c(7,5,"tests.published")),r(2),m("expanded",e.expanded)}}function wo(t,o){if(t&1){let e=D();d(0,"div",6)(1,"a",13),l(2,"translate"),k("click",function(){T(e);let n=g();return w(n.publishTest())}),d(3,"i",11),p(4,"lock_open"),a(),d(5,"span"),p(6),l(7,"translate"),a()(),d(8,"bkd-caret",12),k("click",function(){T(e);let n=g();return w(n.emitToggleHeader())}),a()()}if(t&2){let e=g();r(),xe("title",c(2,3,"tests.publish")),r(5),C(c(7,5,"tests.not-published")),r(2),m("expanded",e.expanded)}}var hr=(()=>{class t{constructor(){this.toggleHeader=new de,this.publish=new de,this.unpublish=new de}emitToggleHeader(){this.toggleHeader.emit(!this.expanded)}publishTest(){this.publish.emit(this.test)}unpublishTest(){this.unpublish.emit(this.test)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-test-table-test-header"]],inputs:{test:"test",expanded:"expanded"},outputs:{toggleHeader:"toggleHeader",publish:"publish",unpublish:"unpublish"},decls:9,vars:5,consts:[[1,"d-flex","flex-column","h-100","justify-content-between"],["role","button",1,"test-designation","d-flex","flex-row","my-3","align-items-end","justify-content-between",3,"click"],[3,"ngClass"],[1,"align-self-start",3,"expanded"],[1,"d-flex","flex-column"],[1,"d-flex","flex-column","mb-3"],[1,"d-flex","align-items-center","justify-content-between","test-status"],[1,"d-flex","flex-row","justify-content-between"],[1,"btn","btn-link","p-0","edit",3,"routerLink"],[1,"material-icons"],[1,"d-flex","btn","btn-link","ps-0","edit",3,"click","title"],[1,"material-icons","me-1"],[1,"expand-mobile",3,"click","expanded"],[1,"d-flex","btn","btn-link","ps-0",3,"click","title"]],template:function(i,n){i&1&&(d(0,"div",0)(1,"div",1),k("click",function(){return n.emitToggleHeader()}),d(2,"div",2),p(3),a(),f(4,"bkd-caret",3),a(),d(5,"div",4),x(6,xo,12,12,"div",5)(7,To,9,7,"div",6)(8,wo,9,7,"div",6),a()()),i&2&&(r(2),m("ngClass",n.expanded?"expanded":"collapsed"),r(),y(" ",n.test.Designation," "),r(),m("expanded",n.expanded),r(2),_(n.expanded?6:-1),r(),_(n.test.IsPublished?7:8))},dependencies:[fe,Yi,ur,Z,Te,E,mr],styles:["[_nghost-%COMP%]{font-weight:300}.collapsed[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.test-designation[_ngcontent-%COMP%]{display:none!important}.test-status[_ngcontent-%COMP%]{order:-1;padding-bottom:1rem}.test-status[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.test-status[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#000}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.edit[_ngcontent-%COMP%]{color:#00000080;text-decoration:none}@media (min-width: 811px){.test-designation[_ngcontent-%COMP%]{display:inherit!important}.test-status[_ngcontent-%COMP%]{order:initial}.expand-mobile[_ngcontent-%COMP%]{display:none!important}}"]})}}return t})();var Eo=["bkdTestsTableHeader",""],Zt=(t,o)=>o.Id,Po=t=>({"test-point-grading":t}),ko=t=>({selected:t});function Io(t,o){if(t&1){let e=D();d(0,"th",3)(1,"bkd-test-table-test-header",12),k("toggleHeader",function(n){T(e);let s=g();return w(s.state.toggleHeader(n))})("publish",function(n){T(e);let s=g();return w(s.publish.emit(n))})("unpublish",function(n){T(e);let s=g();return w(s.unpublish.emit(n))}),a()()}if(t&2){let e=o.$implicit,i=g(),n=P(4);m("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),r(),m("test",e)("expanded",n)}}function Mo(t,o){if(t&1){let e=D();d(0,"th",4)(1,"bkd-test-table-test-header",12),k("toggleHeader",function(n){T(e);let s=g();return w(s.state.toggleHeader(n))})("publish",function(n){T(e);let s=g();return w(s.publish.emit(n))})("unpublish",function(n){T(e);let s=g();return w(s.unpublish.emit(n))}),a()()}if(t&2){let e=o.$implicit,i=g(),n=P(4);m("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),r(),m("test",e)("expanded",n)}}function Oo(t,o){t&1&&(d(0,"div",14),p(1),l(2,"translate"),a()),t&2&&(r(),y(" ",c(2,1,"tests.points")," "))}function Do(t,o){if(t&1){let e=D();d(0,"th",11)(1,"div",13),x(2,Oo,3,3,"div",14),d(3,"bkd-sortable-header",8),l(4,"translate"),U("sortCriteriaChange",function(n){T(e);let s=g();return j(s.state.sortCriteria,n)||(s.state.sortCriteria=n),w(n)}),a()()()}if(t&2){let e=o.$implicit,i=g();m("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),r(2),_(e.IsPointGrading?2:-1),r(),m("label",c(4,5,"tests.grade"))("sortKey","Test-"+e.Id),W("sortCriteria",i.state.sortCriteria)}}var gr=(()=>{class t extends Ot{constructor(){super(...arguments),this.state=u(J),this.publish=new de,this.unpublish=new de}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=nt(t)))(n||t)}})()}static{this.\u0275cmp=v({type:t,selectors:[["thead","bkdTestsTableHeader",""]],inputs:{selectedTest:"selectedTest"},outputs:{publish:"publish",unpublish:"unpublish"},features:[rt],attrs:Eo,decls:27,vars:29,consts:[[1,"header-collapsible"],["colspan","3",1,"desktop","sticky"],[3,"filterChange","filter"],["container","body",1,"test-grade","grade","test-info-desktop",3,"ngClass"],["container","body","colspan","3",1,"test-grade","header-mobile","test-info-mobile",3,"ngClass"],[1,"filler"],[3,"ngClass"],[1,"sticky","student-name"],[3,"sortCriteriaChange","label","sortKey","sortCriteria"],[1,"sticky","student-grade","desktop",3,"ngClass"],[1,"border-end","sticky","student-average","desktop"],["container","body",1,"test-grade",3,"ngClass"],[3,"toggleHeader","publish","unpublish","test","expanded"],[1,"d-flex"],[1,"point-column-title","me-2","me-md-3"]],template:function(i,n){if(i&1){let s=D();$(0),l(1,"async"),$(2),l(3,"async"),$(4),l(5,"async"),d(6,"tr",0)(7,"th",1)(8,"bkd-tests-table-filter",2),k("filterChange",function(b){return T(s),w(n.state.setFilter(b))}),a()(),B(9,Io,2,3,"th",3,Zt),B(11,Mo,2,3,"th",4,Zt),f(13,"th",5),a(),d(14,"tr",6)(15,"th",7)(16,"bkd-sortable-header",8),l(17,"translate"),U("sortCriteriaChange",function(b){return T(s),j(n.state.sortCriteria,b)||(n.state.sortCriteria=b),w(b)}),a()(),d(18,"th",9)(19,"bkd-sortable-header",8),l(20,"translate"),U("sortCriteriaChange",function(b){return T(s),j(n.state.sortCriteria,b)||(n.state.sortCriteria=b),w(b)}),a()(),d(21,"th",10)(22,"bkd-sortable-header",8),l(23,"translate"),U("sortCriteriaChange",function(b){return T(s),j(n.state.sortCriteria,b)||(n.state.sortCriteria=b),w(b)}),a()(),B(24,Do,5,7,"th",11,Zt),f(26,"th",5),a()}if(i&2){let s=c(1,12,n.state.filteredTests$),h=c(3,14,n.state.filter$);r(4),H(c(5,16,n.state.expandedHeader$)),r(4),m("filter",h),r(),V(s),r(2),V(s),r(3),m("ngClass",G(25,Po,n.selectedTest==null?null:n.selectedTest.IsPointGrading)),r(2),m("label",c(17,19,"tests.student.name"))("sortKey","FullName"),W("sortCriteria",n.state.sortCriteria),r(2),m("ngClass",G(27,ko,n.selectedTest===void 0)),r(),m("label",c(20,21,"tests.grade"))("sortKey","FinalGrade"),W("sortCriteria",n.state.sortCriteria),r(3),m("label",c(23,23,"tests.mean"))("sortKey","TestsMean"),W("sortCriteria",n.state.sortCriteria),r(2),V(s)}},dependencies:[Q,fe,E,cr,hr,Ue],styles:["[_nghost-%COMP%]{--spacer: 16px;--point-input-size: 4em;--grade-input-size: 127px;--points-grade-gap: 1rem;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-average-column-width: 120px;--test-grade-column-width: calc( var(--spacer) + var(--point-input-size) + var(--points-grade-gap) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--student-average-column-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) );--test-columns-offset: calc( var(--student-average-column-offset) + var(--student-average-column-width) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}@media (max-width: 767.98px){[_nghost-%COMP%]{--points-grade-gap: calc(.5 * var(--spacer))}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (min-width: 576px){[_nghost-%COMP%]{--point-input-size: 5em}}tr[_ngcontent-%COMP%]:not(.header-collapsible)   th.test-grade[_ngcontent-%COMP%], td.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}@media (max-width: 810px){tr[_ngcontent-%COMP%]:not(.header-collapsible):not(.test-point-grading)   th.test-grade[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]:not(.test-point-grading)   th.student-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.test-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.student-grade[_ngcontent-%COMP%]{width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));min-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));max-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer))}}th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}th.test-grade[_ngcontent-%COMP%]   .point-column-title[_ngcontent-%COMP%]{width:var(--point-input-size)}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-average[_ngcontent-%COMP%], .test-grade[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex;width:100%}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.test-grade[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}.student-average[_ngcontent-%COMP%]{width:var(--student-average-column-width);min-width:var(--student-average-column-width);max-width:var(--student-average-column-width)}.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}th.sticky.student-average[_ngcontent-%COMP%], td.sticky.student-average[_ngcontent-%COMP%]{left:var(--student-average-column-offset)}}@media (max-width: 1200px){[_nghost-%COMP%]{--student-average-column-width: 1px}.student-average[_ngcontent-%COMP%]{padding:0;overflow:hidden}}@media (min-width: 1201px){.student-average-inline[_ngcontent-%COMP%]{display:none}}.sticky[_nghost-%COMP%]{position:fixed;top:0;left:0;z-index:1000;display:none}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;vertical-align:top}.header-collapsible[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:0 1rem}tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:none!important}@media (min-width: 811px){.sticky.shown[_nghost-%COMP%]{display:table-header-group}tr[_ngcontent-%COMP%]   th.test-info-mobile[_ngcontent-%COMP%]{display:none!important}tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:table-cell!important}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;padding-top:.25rem;padding-bottom:.25rem;border-top:initial}.sticky[_nghost-%COMP%]{margin-left:var(--test-columns-offset)}.sticky[_nghost-%COMP%]   th.sticky[_ngcontent-%COMP%]{position:fixed}}"],changeDetection:0})}}return t})();var Lo=(t,o)=>o.student.Id,Fo=(t,o)=>o.Id,$o=(t,o)=>o.id,Go=t=>({"test-point-grading":t}),fr=t=>({selected:t}),Ro=t=>["student",t,"grades"],Bo=t=>({"visible-on-mobile":t});function Vo(t,o){if(t&1&&(d(0,"div"),p(1),a()),t&2){let e=g().$implicit;r(),y(" ",e.finalGrade.finalGradeValue," ")}}function Ao(t,o){if(t&1){let e=D();d(0,"bkd-grade-select",19),l(1,"async"),l(2,"async"),k("gradeIdSelected",function(n){T(e);let s=g(2);return w(s.state.overwriteFinalGrade(n))}),a()}if(t&2){let e,i,n=g().$implicit,s=g();m("options",c(1,4,s.state.gradingOptionsForCourse$()))("valueId",(e=n.finalGrade.gradeId)!==null&&e!==void 0?e:null)("gradeId",(i=n.finalGrade.gradingId)!==null&&i!==void 0?i:null)("disabled",c(2,6,s.isEditFinalGradesAllowed(n))===!1)}}function Ho(t,o){if(t&1&&($(0),d(1,"td",11),f(2,"bkd-grade",20),l(3,"async"),a()),t&2){let e=o.$implicit,i=o.$index,n=g(),s=n.$implicit,h=n.$index,b=g(),X=e.grade;r(),m("ngClass",b.selectedTest!==void 0&&X.test.Id===b.selectedTest.Id?"selected":""),r(),m("grade",X)("gradeOptions",c(3,6,b.state.gradingOptionsForTest$(X.test)))("student",s.student)("hasFinalGrade",!!s.finalGrade.finalGradeValue)("tabIndex",(1+i)*1e3+h)}}function No(t,o){if(t&1&&(d(0,"tr")(1,"td",6)(2,"a",15)(3,"div"),p(4),a(),d(5,"div",8),p(6),l(7,"translate"),l(8,"decimalOrDash"),a()()(),d(9,"td",16),x(10,Vo,2,1,"div")(11,Ao,3,8,"bkd-grade-select",17),a(),d(12,"td",18),p(13),l(14,"decimalOrDash"),a(),B(15,Ho,4,8,"td",11,$o),f(17,"td",12),a()),t&2){let e=o.$implicit,i=g();r(2),m("routerLink",G(15,Ro,e.student.Id)),r(2),C(e.student.FullName),r(2),Ye(" ",c(7,7,"tests.mean"),": ",F(8,9,e.finalGrade.average,"1-3")," "),r(3),m("ngClass",G(17,fr,i.selectedTest===void 0)),r(),_(e.finalGrade.finalGradeValue?10:11),r(3),y(" ",F(14,12,e.finalGrade.average,"1-3")," "),r(2),V(i.getGrades(e))}}function jo(t,o){if(t&1&&(d(0,"td",11),f(1,"bkd-average-grades",21),a()),t&2){let e=o.$implicit,i=g();m("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)||e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),r(),m("test",e)}}function Wo(t,o){if(t&1){let e=D();d(0,"button",22),k("click",function(){T(e);let n=g();return w(n.setAverageAsFinalGrade())}),p(1),l(2,"translate"),a()}if(t&2){let e=g(),i=P(2);m("ngClass",G(4,Bo,!i||!e.selectedTest)),r(),y(" ",c(2,2,"tests.set-final-grade")," ")}}var Cr=(()=>{class t{constructor(){this.state=u(J),this.modalService=u(bt),this.destroy$=new pe,this.sticky=di(ze)}ngOnInit(){this.state.sortCriteria.set({primarySortKey:"FullName",ascending:!0}),z([this.state.filteredTests$,this.state.expandedHeader$]).pipe(be(this.destroy$)).subscribe(()=>this.sticky()?.refresh())}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setAverageAsFinalGrade(){this.state.course$.pipe(ne(1)).subscribe(e=>this.state.setAveragesAsFinalGrades({CourseIds:[e.Id]}))}isEditFinalGradesAllowed(e){return this.state.course$.pipe(S(i=>!!(kt(i)?.value&&e.finalGrade?.canGrade)))}getGrades(e){return e.grades.flatMap(i=>({id:`${e.student.Id}-${i.test.Id}`,grade:i}))}publish(e){let i=this.openModal(e);this.onCloseModal(i,()=>this.state.publish(e))}unpublish(e){let i=this.openModal(e);this.onCloseModal(i,()=>this.state.unpublish(e))}calculatePointsAverage(e){return this.safeAverage(e,Ct)}calculateGradeAverage(e){return this.safeAverage(e,vt)}safeAverage(e,i){try{return i(e).toString()}catch{return"\u2013"}}openModal(e){let i=this.modalService.open(or);return i.componentInstance.test=e,i}onCloseModal(e,i){e.result.then(n=>{n&&i()},()=>{})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-table"]],viewQuery:function(i,n){i&1&&hi(n.sticky,ze,5),i&2&&gi()},inputs:{selectedTest:"selectedTest"},features:[re([qe])],decls:40,vars:45,consts:[["inlineHeader",""],["stickyHeader",""],[1,"table-responsive-wrapper"],["bkdTableHeaderSticky","",1,"table","table-hover","h-100",3,"ngClass","inlineHeader","stickyHeader"],["bkdTestsTableHeader","",3,"publish","unpublish","selectedTest"],["bkdTestsTableHeader","",3,"publish","unpublish","sticky","selectedTest"],[1,"sticky","student-name"],[1,"d-flex","flex-column"],[1,"student-average-inline"],[1,"desktop","sticky","student-grade",3,"ngClass"],[1,"desktop","border-end","sticky","student-average"],[1,"test-grade",3,"ngClass"],[1,"filler"],[1,"action-buttons"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"ngClass"],[3,"routerLink"],[1,"sticky","student-grade",3,"ngClass"],[3,"options","valueId","gradeId","disabled"],[1,"border-end","sticky","student-average"],[3,"gradeIdSelected","options","valueId","gradeId","disabled"],[3,"grade","gradeOptions","student","hasFinalGrade","tabIndex"],[3,"test"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"click","ngClass"]],template:function(i,n){if(i&1){let s=D();$(0),l(1,"async"),$(2),l(3,"async"),$(4),l(5,"async"),d(6,"div",2)(7,"table",3)(8,"thead",4,0),k("publish",function(b){return T(s),w(n.publish(b))})("unpublish",function(b){return T(s),w(n.unpublish(b))}),a(),d(10,"thead",5,1),k("publish",function(b){return T(s),w(n.publish(b))})("unpublish",function(b){return T(s),w(n.unpublish(b))}),a(),d(12,"tbody"),B(13,No,18,19,"tr",null,Lo),d(15,"tr")(16,"td",6)(17,"div",7)(18,"div"),p(19),l(20,"translate"),a(),d(21,"div",8),p(22),l(23,"translate"),l(24,"async"),l(25,"decimalOrDash"),a()()(),d(26,"td",9),p(27),l(28,"async"),l(29,"decimalOrDash"),a(),d(30,"td",10),p(31),l(32,"async"),l(33,"decimalOrDash"),a(),B(34,jo,2,2,"td",11,Fo),f(36,"td",12),a()()(),d(37,"div",13),x(38,Wo,3,6,"button",14),l(39,"async"),a()()}if(i&2){let s=ge(9),h=ge(11),b=c(1,13,n.state.filteredTests$);r(2),H(c(3,15,n.state.hasTests$));let X=c(5,18,n.state.studentGrades$);r(5),m("ngClass",G(41,Go,n.selectedTest==null?null:n.selectedTest.IsPointGrading))("inlineHeader",s)("stickyHeader",h),r(),m("selectedTest",n.selectedTest),r(2),m("sticky",!0)("selectedTest",n.selectedTest),r(3),V(X),r(6),C(c(20,20,"tests.average")),r(3),Ye(" ",c(23,22,"tests.mean"),": ",F(25,26,c(24,24,n.state.meanOfStudentGradesForCourse$),"1-3")," "),r(4),m("ngClass",G(43,fr,n.selectedTest===void 0)),r(),y(" ",F(29,31,c(28,29,n.state.meanOfFinalGradesForCourse$),"1-3")," "),r(4),y(" ",F(33,36,c(32,34,n.state.meanOfStudentGradesForCourse$),"1-3")," "),r(3),V(b),r(4),_(c(39,39,n.state.canSetFinalGrade$)?38:-1)}},dependencies:[fe,Z,dr,lr,ar,Q,E,yt,ze,gr],styles:["[_nghost-%COMP%]{--spacer: 16px;--point-input-size: 4em;--grade-input-size: 127px;--points-grade-gap: 1rem;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-average-column-width: 120px;--test-grade-column-width: calc( var(--spacer) + var(--point-input-size) + var(--points-grade-gap) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--student-average-column-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) );--test-columns-offset: calc( var(--student-average-column-offset) + var(--student-average-column-width) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}@media (max-width: 767.98px){[_nghost-%COMP%]{--points-grade-gap: calc(.5 * var(--spacer))}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (min-width: 576px){[_nghost-%COMP%]{--point-input-size: 5em}}tr[_ngcontent-%COMP%]:not(.header-collapsible)   th.test-grade[_ngcontent-%COMP%], td.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}@media (max-width: 810px){tr[_ngcontent-%COMP%]:not(.header-collapsible):not(.test-point-grading)   th.test-grade[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]:not(.test-point-grading)   th.student-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.test-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.student-grade[_ngcontent-%COMP%]{width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));min-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));max-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer))}}th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}th.test-grade[_ngcontent-%COMP%]   .point-column-title[_ngcontent-%COMP%]{width:var(--point-input-size)}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-average[_ngcontent-%COMP%], .test-grade[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex;width:100%}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.test-grade[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}.student-average[_ngcontent-%COMP%]{width:var(--student-average-column-width);min-width:var(--student-average-column-width);max-width:var(--student-average-column-width)}.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}th.sticky.student-average[_ngcontent-%COMP%], td.sticky.student-average[_ngcontent-%COMP%]{left:var(--student-average-column-offset)}}@media (max-width: 1200px){[_nghost-%COMP%]{--student-average-column-width: 1px}.student-average[_ngcontent-%COMP%]{padding:0;overflow:hidden}}@media (min-width: 1201px){.student-average-inline[_ngcontent-%COMP%]{display:none}}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child{text-decoration:underline}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}.student-average-inline[_ngcontent-%COMP%]{color:#4e4e4ef2;font-size:.875rem;line-height:1}@media (min-width: 811px){.table-responsive-wrapper[_ngcontent-%COMP%]{display:block;overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.action-buttons[_ngcontent-%COMP%]{position:sticky;left:0}}@media (max-width: 810px){.apply-average-button[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]})}}return t})();var Uo=()=>[],qo=t=>({"visible-on-mobile":t}),zo=t=>["/events",t,"evaluation"],Ko=t=>({returnlink:t});function Yo(t,o){t&1&&f(0,"bkd-spinner")}function Qo(t,o){if(t&1){let e=D();d(0,"bkd-select",4),k("valueChange",function(n){T(e);let s=g(2);return w(n&&s.testSelected(n))}),a(),f(1,"bkd-tests-table",5)}if(t&2){g(2);let e=P(6),i=P(8),n=P(10);m("options",e)("value",i)("allowEmpty",!1),r(),m("selectedTest",n)}}function Zo(t,o){t&1&&(d(0,"p",2),p(1),l(2,"translate"),a()),t&2&&(r(),C(c(2,1,"tests.no-tests")))}function Xo(t,o){if(t&1&&(d(0,"a",3)(1,"i",6),p(2,"arrow_right_alt"),a(),d(3,"span",7),p(4),l(5,"translate"),a()()),t&2){g(2);let e=P(0),i=P(4),n=P(10);m("ngClass",G(6,qo,!i||!n))("routerLink",G(8,zo,e==null?null:e.Id))("queryParams",G(10,Ko,"/events/"+(e==null?null:e.Id)+"/tests")),r(4),C(c(5,4,"tests.link-to-rating-overview"))}}function Jo(t,o){if(t&1&&(f(0,"bkd-tests-header",1),x(1,Qo,2,4)(2,Zo,3,3,"p",2)(3,Xo,6,12,"a",3),l(4,"async")),t&2){let e=g(),i=P(0),n=P(2);m("course",i),r(),_(n.length>0?1:2),r(2),_(i&&c(4,3,e.state.canSetFinalGrade$)?3:-1)}}var vr=(()=>{class t{constructor(){this.settings=u(oe),this.state=u(J),this.translate=u(ae),this.selectTest$=new pe,this.testOptions$=this.state.tests$.pipe(S(e=>[{Key:-1,Value:this.translate.instant("tests.grade")},...e.map(i=>({Key:i.Id,Value:i.Designation}))]),ee()),this.selectedTestId$=tt(this.selectTest$,this.state.tests$.pipe(ne(1),S(e=>e[0]?.Id))).pipe(ee()),this.selectedTest$=this.selectedTestId$.pipe(M(e=>this.state.tests$.pipe(S(i=>i.find(n=>n.Id===e)))),ee())}testSelected(e){this.selectTest$.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-list"]],decls:16,vars:22,consts:[[1,"bkd-container"],[3,"course"],[1,"mt-3","px-3"],[1,"rating-overview","d-flex","justify-content-end","pe-3","border-top","pt-3",3,"ngClass","routerLink","queryParams"],["width","100%",1,"tests-dropdown",3,"valueChange","options","value","allowEmpty"],[3,"selectedTest"],[1,"material-icons","fw-bold"],[1,"ps-1"]],template:function(i,n){if(i&1&&($(0),l(1,"async"),$(2),l(3,"async"),$(4),l(5,"async"),$(6),l(7,"async"),$(8),l(9,"async"),$(10),l(11,"async"),d(12,"div",0),x(13,Yo,1,0,"bkd-spinner"),l(14,"async"),x(15,Jo,5,5),a()),i&2){let s;H(c(1,1,n.state.course$)),r(2),H((s=c(3,4,n.state.tests$))!==null&&s!==void 0?s:De(21,Uo)),r(2),H(c(5,7,n.state.hasTests$)),r(2),H(c(7,10,n.testOptions$)),r(2),H(c(9,13,n.selectedTestId$)),r(2),H(c(11,16,n.selectedTest$)),r(3),_(c(14,19,n.state.loading$)?13:15)}},dependencies:[sr,Pe,Cr,fe,me,Q,E,Z],styles:[".tests-dropdown[_ngcontent-%COMP%]{display:block;padding:1rem 0}@media (min-width: 811px){.tests-dropdown[_ngcontent-%COMP%]{display:none}}a.rating-overview[_ngcontent-%COMP%]{text-decoration:none}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}@media (max-width: 810px){a.rating-overview[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]})}}return t})();var _r=(()=>{class t{constructor(){this.state=u(J),this.route=u(se),this.courseId$=this.route.paramMap.pipe(S(e=>Number(e.get("id"))),ee()),this.destroy$=new pe}ngOnInit(){this.courseId$.pipe(be(this.destroy$)).subscribe(e=>this.state.setCourseId(e))}ngOnDestroy(){this.destroy$.next()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests"]],features:[re([J])],decls:1,vars:0,template:function(i,n){i&1&&f(0,"router-outlet")},dependencies:[Ee],encapsulation:2})}}return t})();var yr=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-current-list"]],decls:4,vars:5,consts:[[3,"withStudyCourses","withRatings"]],template:function(i,n){i&1&&(d(0,"h1"),p(1),l(2,"translate"),a(),f(3,"bkd-events-list",0)),i&2&&(r(),C(c(2,3,"events.current.title")),r(2),m("withStudyCourses",!0)("withRatings",!1))},dependencies:[$t,E],encapsulation:2,changeDetection:0})}}return t})();var Vh=[{path:"",component:vn,children:[{path:"current",children:[{path:"",component:yr},br(":id")]},{path:"",component:Wn},{path:":id",component:_r,children:[{path:"tests",children:[{path:"",component:vr},{path:":testId/edit",component:rr},{path:"add",component:ir},St]},{path:"evaluation",component:Mn,children:[{path:"",component:In},St]},br("students")]}]}];function br(t){return{path:t,component:Hn,children:[{path:"",component:Vn},{path:"study-course-student/:id",component:An},St]}}export{gn as a,Vh as b,br as c};
