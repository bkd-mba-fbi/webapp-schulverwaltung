"use strict";(self.webpackChunkwebapp_schulverwaltung=self.webpackChunkwebapp_schulverwaltung||[]).push([[970],{3970:(ce,I,a)=>{a.d(I,{H:()=>de});var G=a(5275),x=a(9610),S=a(1297),A=a(8547),p=a(7579),v=a(2722),e=a(5e3),D=a(2039),f=a(8980),h=a(1104),o=a(9808),l=a(1504),y=a(6342);function _(s,i,t){return i&&i.GradeValue?i.GradeValue:function b(s,i){var t;return null===(t=null==i?void 0:i.Grades.find(n=>n.Id===(null==s?void 0:s.GradeId)))||void 0===t?void 0:t.Value}(s,t)||(null==s?void 0:s.GradeValue)}function O(s,i){if(1&s&&(e.TgZ(0,"span",2),e._uU(1),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.hij(" (",t.grade,")")}}function $(s,i){if(1&s&&(e.TgZ(0,"span",3),e._uU(1),e.ALo(2,"number"),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.hij(" (",e.xi3(2,1,t.average,"1.0-3"),")")}}let P=(()=>{class s{constructor(){}get grade(){return this.getGradeForStudent()}get average(){var t;return null===(t=this.grading)||void 0===t?void 0:t.AverageTestResult}getGradeForStudent(){return _(this.grading,this.finalGrade,this.gradingScale)}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["erz-dossier-grades-course-header"]],inputs:{designation:"designation",finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale"},decls:3,vars:3,consts:[["class","grade","data-testId","grade",4,"ngIf"],["class","average","data-testId","average",4,"ngIf"],["data-testId","grade",1,"grade"],["data-testId","average",1,"average"]],template:function(t,n){1&t&&(e._uU(0),e.YNc(1,O,2,1,"span",0),e.YNc(2,$,3,4,"span",1)),2&t&&(e.Oqu(n.designation),e.xp6(1),e.Q6J("ngIf",n.grade),e.xp6(1),e.Q6J("ngIf",!n.grade&&n.average))},directives:[o.O5],pipes:[o.JJ],styles:[".average[_ngcontent-%COMP%]{color:#33333d80}"]}),s})();var g=a(8995);let F=(()=>{class s{constructor(){}getGradeForStudent(){return _(this.grading,this.finalGrade,this.gradingScale)}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["erz-dossier-grades-final-grade"]],inputs:{finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale"},decls:14,vars:11,consts:[[1,"final-entry"],["data-testid","final-grade"],["data-testid","average-test-results"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",1),e.TgZ(5,"span"),e._uU(6),e.qZA(),e.qZA(),e.TgZ(7,"div"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"div",2),e.TgZ(11,"span"),e._uU(12),e.ALo(13,"number"),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(2),e.Oqu(e.lcZ(3,4,"dossier.grade")),e.xp6(4),e.Oqu(n.getGradeForStudent()||"-"),e.xp6(2),e.Oqu(e.lcZ(9,6,"dossier.average")),e.xp6(4),e.Oqu(e.xi3(13,8,null==n.grading?null:n.grading.AverageTestResult,"1.0-3")))},pipes:[g.X$,o.JJ],styles:[".final-entry[_ngcontent-%COMP%]{padding:1.5rem;display:grid;grid-template-columns:repeat(2,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}"]}),s})();var U=a(4707),m=a(4004),u=a(8088),d=a(3075),T=a(1135),Z=a(8372),w=a(9300),J=a(9118),q=a(9092);const z=function(s){return{maxPoints:s}};function L(s,i){if(1&s&&(e.TgZ(0,"div",14),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&s){const t=e.oxw(2);e.xp6(1),e.hij(" ",e.xi3(2,1,"global.validation-errors.invalidPoints",e.VKq(4,z,t.maxPoints))," ")}}function N(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"div",3),e.TgZ(1,"label",10),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",5),e.TgZ(5,"input",11,12),e.NdJ("input",function(){e.CHM(t);const r=e.MAs(6);return e.oxw().onPointsChange(r.value)}),e.qZA(),e.qZA(),e.YNc(7,L,3,6,"div",13),e.qZA()}if(2&s){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,8,"dossier.points")),e.xp6(2),e.ekj("is-invalid",t.pointsInput.errors),e.xp6(1),e.ekj("is-invalid",t.pointsInput.errors),e.s9C("max",t.maxPoints),e.Q6J("formControl",t.pointsInput),e.xp6(2),e.Q6J("ngIf",t.pointsInput.errors)}}let M=(()=>{class s{constructor(t,n){this.activeModal=t,this.courseService=n,this.maxPoints=0,this.gradeSubject$=new p.x,this.pointsSubject$=new p.x,this.closeButtonDisabled$=new T.X(!1),this.gradingScaleDisabled$=new T.X(!0),this.grade$=this.gradeSubject$.pipe((0,Z.b)(500)),this.points$=this.pointsSubject$.pipe((0,Z.b)(500),(0,w.h)(this.isValid.bind(this)),(0,m.U)(Number)),this.destroy$=new p.x}ngOnInit(){this.maxPoints=(0,u.Re)(this.test),this.pointsInput=new d.NI({value:this.points,disabled:!1},[d.kI.min(0),d.kI.pattern("[0-9]+([\\.][0-9]+)?"),this.maxPointValidator()]),this.gradingScaleDisabled$.next(this.test.IsPointGrading&&this.points>0),this.grade$.pipe((0,v.R)(this.destroy$),(0,m.U)(this.buildRuequestBodyForGradeChange.bind(this))).subscribe(t=>this.updateTestResult(t)),this.points$.pipe((0,v.R)(this.destroy$),(0,m.U)(this.buildRequestBodyPointsChange.bind(this))).subscribe(t=>this.updateTestResult(t))}onGradeChange(t){this.gradeSubject$.next(t)}onPointsChange(t){this.pointsSubject$.next(t),this.gradingScaleDisabled$.next(t.length>0)}get updatedTestResult(){var t;return null===(t=this.updatedTest)||void 0===t?void 0:t.TestResults[0]}updateTestResult(t){this.closeButtonDisabled$.next(!0),this.courseService.updateTestResult(this.test.CourseId,t).subscribe(n=>{var r;this.gradeId=null===(r=n.TestResults[0])||void 0===r?void 0:r.GradeId,this.updatedTest=n,this.closeButtonDisabled$.next(!1)})}buildRuequestBodyForGradeChange(t){return{StudentIds:[this.studentId],TestId:this.test.Id,GradeId:t}}buildRequestBodyPointsChange(t){return{StudentIds:[this.studentId],TestId:this.test.Id,Points:t}}isValid(t){return""!==t&&!isNaN(Number(t))&&!(Number(t)<0||Number(t)>this.maxPoints)}maxPointValidator(){return t=>Number(t.value)>(0,u.Re)(this.test)?{customMax:!0}:null}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(l.Kz),e.Y36(J.s))},s.\u0275cmp=e.Xpm({type:s,selectors:[["erz-dossier-grades-edit"]],inputs:{test:"test",gradeId:"gradeId",gradeOptions:"gradeOptions",points:"points",studentId:"studentId"},decls:19,vars:20,consts:[[1,"modal-body"],[1,"mb-4"],["class","form-group row",4,"ngIf"],[1,"form-group","row"],["for","grade",1,"col-6","col-form-label"],[1,"col-6"],["id","grade",3,"options","value","allowEmpty","disabled","valueChange"],[1,"text-muted","mt-4"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["for","points",1,"col-6","col-form-label"],["id","points","type","number","step","0.01","min","0",1,"form-control",3,"max","formControl","input"],["pointInput",""],["class","invalid-feedback col-6 offset-6","data-testid","validation-error-message",4,"ngIf"],["data-testid","validation-error-message",1,"invalid-feedback","col-6","offset-6"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"p",1),e._uU(2),e.qZA(),e.YNc(3,N,8,10,"div",2),e.TgZ(4,"div",3),e.TgZ(5,"label",4),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"div",5),e.TgZ(9,"erz-select",6),e.NdJ("valueChange",function(c){return n.onGradeChange(c)}),e.ALo(10,"async"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(11,"p",7),e._uU(12),e.ALo(13,"translate"),e.qZA(),e.qZA(),e.TgZ(14,"div",8),e.TgZ(15,"button",9),e.NdJ("click",function(){return n.activeModal.close(n.updatedTestResult)}),e.ALo(16,"async"),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.qZA()),2&t&&(e.xp6(2),e.Oqu(n.test.Designation),e.xp6(1),e.Q6J("ngIf",n.test.IsPointGrading),e.xp6(3),e.Oqu(e.lcZ(7,10,"dossier.grade")),e.xp6(3),e.Q6J("options",n.gradeOptions)("value",n.gradeId)("allowEmpty",!1)("disabled",e.lcZ(10,12,n.gradingScaleDisabled$)),e.xp6(3),e.hij(" ",e.lcZ(13,14,n.test.IsPointGrading?"dossier.dialog.hint.points":"dossier.dialog.hint.grade")," "),e.xp6(3),e.Q6J("disabled",e.lcZ(16,16,n.closeButtonDisabled$)),e.xp6(2),e.hij(" ",e.lcZ(18,18,"dossier.dialog.close")," "))},directives:[o.O5,d.qQ,d.Fd,d.wV,d.Fj,d.JJ,d.oH,q.H],pipes:[g.X$,o.Ov],styles:[""]}),s})();var Q=a(2097),j=a(4371);function Y(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"div",2),e._uU(2),e.qZA(),e.TgZ(3,"div",3),e._uU(4),e.ALo(5,"date"),e.qZA(),e.TgZ(6,"div",4),e.TgZ(7,"a",5),e.NdJ("click",function(){const c=e.CHM(t).erzLet;return e.oxw().editGrading(c)}),e.TgZ(8,"i",6),e._uU(9,"edit"),e.qZA(),e.TgZ(10,"span",7),e._uU(11),e.ALo(12,"async"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(13,"div",8),e._uU(14),e.ALo(15,"erzTestWeight"),e.qZA(),e.TgZ(16,"div",9),e.TgZ(17,"span"),e._uU(18),e.ALo(19,"erzTestPoints"),e.qZA(),e.qZA(),e.TgZ(20,"div",10),e._uU(21),e.qZA(),e.TgZ(22,"div",11),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.qZA()}if(2&s){const t=i.erzLet,n=e.oxw();e.xp6(2),e.hij(" ",t.Designation," "),e.xp6(2),e.hij(" ",e.xi3(5,7,t.Date,"mediumDate")," "),e.xp6(7),e.Oqu(e.lcZ(12,10,n.grading$)),e.xp6(3),e.hij(" ",e.lcZ(15,12,t)," "),e.xp6(4),e.Oqu(e.xi3(19,14,t,n.studentId)),e.xp6(3),e.hij(" ",t.Owner," "),e.xp6(2),e.hij(" ",e.lcZ(24,17,t.IsPublished?"tests.published":"tests.not-published")," ")}}let E=(()=>{class s{constructor(t){this.modalService=t,this.test$=new U.t(1),this.grading$=this.test$.pipe((0,m.U)(this.getGrading.bind(this)))}ngOnInit(){this.test$.next(this.test)}editGrading(t){const n=this.modalService.open(M,{backdrop:"static"});n.componentInstance.test=t,n.componentInstance.gradeId=this.getGradeId(t),n.componentInstance.gradeOptions=this.mapToOptions(this.gradingScale),n.componentInstance.studentId=this.studentId,n.componentInstance.points=this.getPoints(t),n.result.then(r=>{r&&this.updateStudentGrade(r,t)},()=>{})}updateStudentGrade(t,n){const r=(0,u.Ps)(t,n);this.test$.next(r)}getGrading(t){var n,r;return(null===(r=null===(n=this.gradingScale)||void 0===n?void 0:n.Grades.find(c=>c.Id===this.getGradeId(t)))||void 0===r?void 0:r.Designation)||"-"}getGradeId(t){var n;return(null===(n=(0,u.W3)(this.studentId,t))||void 0===n?void 0:n.GradeId)||null}getPoints(t){var n;return(null===(n=(0,u.W3)(this.studentId,t))||void 0===n?void 0:n.Points)||null}mapToOptions(t){return(null==t?void 0:t.Grades.map(n=>({Key:n.Id,Value:n.Designation})))||null}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(l.FF))},s.\u0275cmp=e.Xpm({type:s,selectors:[["erz-dossier-single-test"]],inputs:{test:"test",studentId:"studentId",gradingScale:"gradingScale"},decls:2,vars:3,consts:[["class","test-entry",4,"erzLet"],[1,"test-entry"],["data-testid","test-designation",1,"designation"],["data-testid","test-date",1,"date"],[1,"grade"],["aria-label","edit grade",1,"btn","btn-link",3,"click"],[1,"material-icons"],["data-testid","test-grade"],["data-testid","test-factor",1,"factor"],["data-testid","test-points",1,"points"],["data-testid","test-teacher",1,"teacher"],["data-testid","test-status",1,"state"]],template:function(t,n){1&t&&(e.YNc(0,Y,25,19,"div",0),e.ALo(1,"async")),2&t&&e.Q6J("erzLet",e.lcZ(1,1,n.test$))},directives:[h.e],pipes:[o.Ov,o.uU,Q.H,j.g,g.X$],styles:['.test-entry[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1.5rem;display:grid;grid-template-areas:"designation designation grade factor" "date date points ." "teacher teacher . ." "state state . .";grid-template-columns:repeat(4,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}.designation[_ngcontent-%COMP%]{grid-area:designation}.date[_ngcontent-%COMP%]{grid-area:date}.grade[_ngcontent-%COMP%]{grid-area:grade}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;color:#33333d80;padding-left:0}.grade[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:-1em}.points[_ngcontent-%COMP%]{grid-area:points;color:#33333d80}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.state[_ngcontent-%COMP%]{grid-area:state}@media (max-width: 767.98px){.test-entry[_ngcontent-%COMP%]{grid-template-areas:"designation designation" "date grade" "factor points" "teacher teacher" "state state";grid-template-columns:repeat(2,1fr)}}']}),s})();function R(s,i){if(1&s&&e._UZ(0,"erz-dossier-single-test",4),2&s){const t=i.$implicit,n=e.oxw(2);e.Q6J("test",t)("studentId",n.studentId)("gradingScale",n.getGradingScaleOfTest(t))}}function V(s,i){if(1&s&&(e.TgZ(0,"div"),e.YNc(1,R,1,3,"erz-dossier-single-test",3),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.course.Tests)}}function H(s,i){1&s&&(e.TgZ(0,"p",5),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&s&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"dossier.no-tests")," "))}let B=(()=>{class s{constructor(t){this.dossierGradeService=t}getGradingScaleOfTest(t){return this.gradingScales.find(n=>n.Id===t.GradingScaleId)}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(f.S))},s.\u0275cmp=e.Xpm({type:s,selectors:[["erz-dossier-course-tests"]],inputs:{studentId:"studentId",course:"course",gradingScales:"gradingScales"},decls:4,vars:5,consts:[[3,"finalGrade","grading","gradingScale"],[4,"ngIf","ngIfElse"],["noTests",""],[3,"test","studentId","gradingScale",4,"ngFor","ngForOf"],[3,"test","studentId","gradingScale"],["data-testid","message-no-tests",1,"p-3"]],template:function(t,n){if(1&t&&(e._UZ(0,"erz-dossier-grades-final-grade",0),e.YNc(1,V,2,1,"div",1),e.YNc(2,H,3,3,"ng-template",null,2,e.W1O)),2&t){const r=e.MAs(3);e.Q6J("finalGrade",n.dossierGradeService.getFinalGradeForStudent(n.course,n.studentId))("grading",n.dossierGradeService.getGradingForStudent(n.course,n.studentId))("gradingScale",n.dossierGradeService.getGradingScaleOfCourse(n.course,n.gradingScales)),e.xp6(1),e.Q6J("ngIf",(null==n.course.Tests?null:n.course.Tests.length)>0)("ngIfElse",r)}},directives:[F,o.O5,o.sg,E],pipes:[g.X$],styles:[""]}),s})();function X(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"erz-student-dossier-entry-header",8),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().index;return e.MAs(2).toggle("course-"+r)}),e._UZ(1,"erz-dossier-grades-course-header",9),e.qZA()}if(2&s){const t=i.opened,n=e.oxw().$implicit,r=e.oxw(2);e.Q6J("opened",t),e.xp6(1),e.Q6J("designation",n.Designation)("finalGrade",r.dossierGradeService.getFinalGradeForStudent(n,r.studentId))("grading",r.dossierGradeService.getGradingForStudent(n,r.studentId))("gradingScale",r.dossierGradeService.getGradingScaleOfCourse(n,r.gradingScales))}}function W(s,i){if(1&s&&e._UZ(0,"erz-dossier-course-tests",10),2&s){const t=e.oxw().$implicit,n=e.oxw(2);e.Q6J("course",t)("studentId",n.studentId)("gradingScales",n.gradingScales)}}function K(s,i){if(1&s&&(e.TgZ(0,"div"),e.TgZ(1,"ngb-accordion",3,4),e.TgZ(3,"ngb-panel",5),e.YNc(4,X,2,5,"ng-template",6),e.YNc(5,W,1,3,"ng-template",7),e.qZA(),e.qZA(),e.qZA()),2&s){const t=i.index;e.xp6(3),e.Q6J("id","course-"+t)}}function k(s,i){if(1&s&&(e.ynx(0),e.YNc(1,K,6,1,"div",2),e.BQk()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.courses)}}function ee(s,i){1&s&&(e.TgZ(0,"p",11),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&s&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"dossier.no-courses")," "))}let te=(()=>{class s{constructor(t){this.dossierGradeService=t}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(f.S))},s.\u0275cmp=e.Xpm({type:s,selectors:[["erz-dossier-grades-view"]],inputs:{courses:"courses",studentId:"studentId",gradingScales:"gradingScales"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["noCourses",""],[4,"ngFor","ngForOf"],["ngb-accordion",""],["acc","ngbAccordion"],[3,"id"],["ngbPanelHeader",""],["ngbPanelContent",""],[3,"opened","click"],[3,"designation","finalGrade","grading","gradingScale"],[3,"course","studentId","gradingScales"],["data-testid","message-no-courses",1,"p-3"]],template:function(t,n){if(1&t&&(e.YNc(0,k,2,1,"ng-container",0),e.YNc(1,ee,3,3,"ng-template",null,1,e.W1O)),2&t){const r=e.MAs(2);e.Q6J("ngIf",(null==n.courses?null:n.courses.length)>0)("ngIfElse",r)}},directives:[o.O5,o.sg,l.gY,l.Gk,l.k9,y.H,P,l.gW,B],pipes:[g.X$],styles:[""]}),s})();var se=a(2925);function ne(s,i){if(1&s&&e._UZ(0,"erz-dossier-grades-view",3),2&s){const t=e.oxw().erzLet;e.Q6J("courses",t.courses)("studentId",t.studentId)("gradingScales",t.gradingScales)}}function ie(s,i){1&s&&(e.ynx(0),e._UZ(1,"erz-spinner"),e.BQk())}function re(s,i){if(1&s&&(e.ynx(0),e.YNc(1,ne,1,3,"erz-dossier-grades-view",1),e.YNc(2,ie,2,0,"ng-container",2),e.BQk()),2&s){const t=i.erzLet;e.xp6(1),e.Q6J("ngIf",!t.loading),e.xp6(1),e.Q6J("ngIf",t.loading)}}const ae=function(s,i,t,n){return{studentId:s,loading:i,courses:t,gradingScales:n}},de={path:"student/:id",children:[{path:"",component:x.H,children:[{path:"addresses",component:A.S},{path:"absences",component:S.t},{path:"grades",component:(()=>{class s{constructor(t,n){this.state=t,this.dossierGradesService=n,this.destroy$=new p.x}ngOnInit(){this.state.currentDossier$.next("grades"),this.state.studentId$.pipe((0,v.R)(this.destroy$)).subscribe(t=>this.dossierGradesService.setStudentId(t))}ngOnDestroy(){this.destroy$.next()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(D.j),e.Y36(f.S))},s.\u0275cmp=e.Xpm({type:s,selectors:[["erz-dossier-grades"]],decls:5,vars:14,consts:[[4,"erzLet"],[3,"courses","studentId","gradingScales",4,"ngIf"],[4,"ngIf"],[3,"courses","studentId","gradingScales"]],template:function(t,n){1&t&&(e.YNc(0,re,3,2,"ng-container",0),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async"),e.ALo(4,"async")),2&t&&e.Q6J("erzLet",e.l5B(9,ae,e.lcZ(1,1,n.state.studentId$),e.lcZ(2,3,n.dossierGradesService.loading$),e.lcZ(3,5,n.dossierGradesService.studentCourses$),e.lcZ(4,7,n.dossierGradesService.gradingScales$)))},directives:[h.e,o.O5,te,se.O],pipes:[o.Ov],styles:[""]}),s})()}]},{path:"absences/confirm",component:G.A}]}}}]);