import{a as Ge}from"./chunk-Y4QYVF5K.js";import{a as ye}from"./chunk-IBMTKWQE.js";import{a as _e,c as De,d as Ee}from"./chunk-KEAFOV3P.js";import{e as Rt,o as Mt}from"./chunk-U7UB7NHZ.js";import{i as Te}from"./chunk-U27XR2GA.js";import{a as it}from"./chunk-PGOJPYKB.js";import{D as vt,c as he,d as Se,e as Ie,f as be,g as ve,r as Ce,s as xe,x as bt}from"./chunk-MY5OT25Z.js";import{$ as c,$a as l,Ad as me,Bd as ge,D as Gt,Db as dt,Eb as lt,Ed as St,Fb as N,Fd as fe,H as Kt,Ha as D,Hb as Jt,Ib as gt,K as Xt,Ka as J,Lc as h,M as Dt,Mb as u,Mc as a,Nb as f,Nc as M,Oa as x,Ob as j,P as b,Pb as Yt,Qc as _,Qd as It,R as Et,Ra as T,Rb as Qt,Rc as I,Rd as P,Sa as wt,Sc as ft,Uc as Pt,Ud as L,Vd as B,Wa as y,X as w,Yc as m,Za as Y,_a as Q,_c as ne,a as $,ab as d,ac as Zt,b as R,bb as Z,c as Ut,cd as H,da as k,dc as te,ea as X,ed as re,f as ct,fa as z,fb as tt,fc as A,g as O,gc as ee,gd as U,h as st,hb as F,hc as ie,ib as S,jd as se,l as _t,lb as mt,ld as $t,m as Lt,ma as zt,md as ht,n as g,o as ot,pc as et,pd as oe,qd as ae,s as ut,sd as de,tb as at,ub as p,ud as le,vb as E,w as Wt,wb as v,x as qt,xa as s,xd as pe,yd as ce,zd as ue}from"./chunk-QCWENUND.js";var we=I({Id:a,Designation:h,StudentCount:a,Number:h});var Ot=I({Id:h,TestId:a,CourseRegistrationId:a,GradeId:m(a),GradeValue:m(a),GradeDesignation:m(h),Points:m(a),StudentId:a});var Pe=I({Id:a,CourseId:a,Date:H,Designation:h,Weight:a,WeightPercent:a,IsPointGrading:M,MaxPoints:m(a),MaxPointsAdjusted:m(a),IsPublished:M,IsOwner:M,Owner:m(h),GradingScaleId:m(a),Results:m(_(Ot))});var $e=I({Id:a}),Re=ft({HRef:m(h)}),ii=ft({HasEvaluationStarted:M,EvaluationUntil:m(H),HasReviewOfEvaluationStarted:M,HasTestGrading:M,Id:a}),ni=Pt([$e,Re,ii]),ri=ft({Id:a,StudentCount:a}),si=Pt([$e,Re,ri]),oi=I({Grade:h,AverageTestResult:a,Id:a,StudentId:a}),Ft=I({AverageTestResult:a,CanGrade:M,EventId:a,GradeId:m(a),GradeValue:m(a),Id:a,StudentId:a}),W=I({HRef:h,Id:a,Number:h,Designation:h,DateFrom:m(H),DateTo:m(H),StatusId:a,GradingScaleId:m(a),FinalGrades:m(_(oi)),Gradings:m(_(Ft)),Tests:m(_(Pe)),EvaluationStatusRef:ni,AttendanceRef:si,ParticipatingStudents:m(_(_e)),Classes:m(_(we))}),Me=I({TestResults:_(Ot),Gradings:_(Ft)}),Oe=I({Gradings:_(Ft)});var Ct=(()=>{class e extends it{constructor(){let t=c(et),i=c(U);super(t,i,W,"Courses"),this.statusCodec=I(re(this.codec.props,["Id","StatusId","EvaluationStatusRef"]))}getNumberOfCoursesForRating(){return this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef&fields=Id,StatusId,EvaluationStatusRef&filter.StatusId=;10300;10240`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe(b(B(this.statusCodec)),g(t=>t.filter(i=>i.EvaluationStatusRef.HasEvaluationStarted===!0)),g(t=>t.length))}getExpandedCourses(t){return Ge(t,"TeacherRole")?this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef,AttendanceRef,Classes,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe(b(B(W))):_t([])}getExpandedCourse(t){return this.http.get(`${this.baseUrl}/${t}?expand=ParticipatingStudents,EvaluationStatusRef,Tests,Gradings,FinalGrades,Classes`).pipe(b(L(W)))}getExpandedCourseWithParticipants(t){return this.http.get(`${this.baseUrl}/${t}?expand=ParticipatingStudents,Classes,AttendanceRef`).pipe(b(L(W)))}getExpandedCoursesForDossier(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades,EvaluationStatusRef,ParticipatingStudents,Classes&filter.StatusId=;${this.settings.eventlist.statusfilter}`).pipe(b(B(W)))}getExpandedCoursesForStudent(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"StudentRole"}}).pipe(b(B(W)))}add(t,i,n,o,C,V,rt){let K={Tests:[{Date:Mt(Rt(i),"yyyy-MM-dd'T'HH:mm:ss"),Designation:n,Weight:o,IsPointGrading:C,MaxPoints:V,MaxPointsAdjusted:rt}]};return this.http.put(`${this.baseUrl}/${t}/Tests/New`,K).pipe(g(()=>{}))}update(t,i,n,o,C,V,rt,K){let pt={Tests:[{Id:i,Designation:n,Date:Mt(Rt(o),"yyyy-MM-dd'T'HH:mm:ss"),Weight:C,IsPointGrading:V,MaxPoints:rt,MaxPointsAdjusted:K}]};return this.http.put(`${this.baseUrl}/${t}/Tests/Update`,pt).pipe(g(()=>{}))}delete(t,i){let n={TestIds:[i]};return this.http.put(`${this.baseUrl}/${t}/Tests/Delete`,n).pipe(g(()=>i))}updateTestResult(t,i){let K=i,{studentId:n,testId:o}=K,C=Ut(K,["studentId","testId"]),V={StudentIds:[n],TestId:o},rt="gradeId"in C?R($({},V),{GradeId:C.gradeId}):R($({},V),{Points:C.points});return this.http.put(`${this.baseUrl}/${t}/SetTestResult`,rt).pipe(b(L(Me)),b(({TestResults:pt,Gradings:Ht})=>pt.length<=1&&Ht.length===1?_t({courseId:t,testResult:pt[0]??null,grading:Ht[0]}):Lt(()=>new Error("`TestResults` or `Gradings` does not contain a single value"))))}setAverageAsFinalGrade(t){return this.http.put(`${this.baseUrl}/SetAverageTestResult`,t).pipe(b(L(Oe)))}publishTest(t){let i={TestIds:[t]};return this.http.put(`${this.baseUrl}/PublishTest`,i).pipe(g(()=>t))}unpublishTest(t){let i={TestIds:[t]};return this.http.put(`${this.baseUrl}/UnpublishTest`,i).pipe(g(()=>t))}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=w({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var Fe=I({Id:h,SubscriptionId:a,VssId:a,EventId:a,DropdownItems:m(_(ye)),IdPerson:a,ShowAsRadioButtons:M,Value:m(h),VssDesignation:h,VssStyle:h,VssType:h}),At=I({Id:a,EventId:m(a),PersonId:m(a),Status:h,EventDesignation:m(h),RegistrationDate:m(H)});var Ae=(()=>{class e extends it{constructor(){let t=c(et),i=c(U);super(t,i,At,"Subscriptions")}getSubscriptionIdsByStudentAndCourse(t,i){return this.http.get(`${this.baseUrl}/`,{params:{"filter.PersonId":`=${t}`,"filter.EventId":`;${i}`}}).pipe(b(B(ne)),g(n=>n.map(o=>o.Id)))}getSubscriptionCountsByEvents(t){return this.http.get(`${this.baseUrl}/`,{params:{"filter.EventId":`;${t.join(";")}`,fields:["Id","EventId"].join(",")}}).pipe(b(B(I({Id:a,EventId:a}))),g(i=>i.reduce((n,o)=>(n[o.EventId]=n[o.EventId]?n[o.EventId]+1:1,n),{})))}getSubscriptionsByCourse(t,i){return this.http.get(`${this.baseUrl}/`,{params:R($({"filter.EventId":`=${t}`},i),{fields:["Id","EventId","EventDesignation","PersonId","Status","RegistrationDate"].join(",")})}).pipe(b(B(At)))}getSubscriptionDetailsById(t){return this.http.get(`${this.baseUrl}/${t}/SubscriptionDetails`).pipe(b(B(Fe)))}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=w({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Be(e){return e.length===0?0:Bt(e.map(({value:r,weight:t})=>r*t))/Bt(e.map(({weight:r})=>r))}function Vt(e){return e.length===0?0:Number(Bt(e)/e.length)}function Bt(e){return e.reduce(ai,0)}function ai(e,r){return e+r}function Tn(e,r,t){return e?e.Tests?.reduce((i,n)=>i||n.Id===r&&n.Results?.find(o=>o.TestId===r&&o.StudentId===t)||null,null)??null:null}function _n(e,r,t){return r.map(i=>i.Id===e.TestId?Nt(e,i,t):i)}function Gn(e,r,t){return t.map(i=>i.Id===e?di(r,i):i)}function Dn(e,r){return r.map(t=>t.Id===e?R($({},t),{IsPublished:!t.IsPublished}):t)}function En(e){let r=pi(e);if(r.length===0)throw new Error("unable to calculate averages without results");return Vt(r)}function kt(e){return e.MaxPointsAdjusted||e.MaxPoints}function wn(e){let r=li(e);if(r.length===0)throw new Error("unable to calculate averages without results");return Vt(r)}function q(e,r){return r.Results?.find(t=>t.StudentId===e)}function Pn(e,r){return r===null?null:r.filter(t=>t.Id!==e)}function Nt(e,r,t){let i=t&&r.Results?.find(o=>o.TestId===e.TestId&&o.StudentId===e.StudentId),n=r.Results?.filter(o=>!(o.TestId===e.TestId&&o.StudentId===e.StudentId))||[];return i&&t==="grade"?e.GradeId=i.GradeId:i&&t==="points"&&(e.Points=i.Points),R($({},r),{Results:[...n,e]})}function ke(e){return e.slice().sort((r,t)=>t.Date.getTime()-r.Date.getTime())}function xt(e,r){return r?.find(t=>t.Id===e.GradingScaleId)||null}function di(e,r){return R($({},r),{Results:r.Results?.filter(t=>t.StudentId!==e)||[]})}function li(e){return e.Results?.filter(r=>r.GradeDesignation!==null).map(r=>Number(r.GradeDesignation)).filter(r=>!isNaN(r))||[]}function pi(e){return e.Results?.map(r=>r.Points!==null?r.Points:Ve).filter(r=>r>Ve)||[]}var Ve=-1;var ci=I({Id:a,Designation:h}),jt=I({Id:a,Grades:_(ci)});var Ne=(()=>{class e extends it{constructor(){let t=c(et),i=c(U);super(t,i,jt,"GradingScales")}getGradingScale(t){return this.http.get(`${this.baseUrl}/${t}`).pipe(b(L(jt)))}getGradingScales(t){return ut(t.map(this.getGradingScale.bind(this)))}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=w({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var je="studentDossierGrades",yt=(()=>{class e{constructor(){this.coursesRestService=c(Ct),this.subscriptionRestService=c(Ae),this.reportsService=c(Ee),this.loadingService=c(Te),this.gradingScalesRestService=c(Ne),this.settings=c(U),this.studentId$=new st(1),this.initialStudentCourses$=this.studentId$.pipe(Kt(),b(this.loadCourses.bind(this)),g(t=>t.sort((i,n)=>i.Designation.localeCompare(n.Designation))),Dt(1)),this.action$=new st(1),this.studentCourses$=Wt(this.action$,this.initialStudentCourses$.pipe(g(t=>({type:"initializeCourses",payload:t})))).pipe(Xt(this.coursesReducer.bind(this),[]),Dt(1)),this.loading$=this.loadingService.loading(je),this.studentCourseIds$=this.studentCourses$.pipe(g(t=>t.flatMap(i=>i.Id))),this.subscriptionIds$=ot([this.studentId$,this.studentCourseIds$]).pipe(b(([t,i])=>this.subscriptionRestService.getSubscriptionIdsByStudentAndCourse(t,i))),this.testReports$=this.subscriptionIds$.pipe(g(t=>this.reportsService.getTeacherSubscriptionGradesReports(t))),this.tests$=this.studentCourses$.pipe(g(t=>t.flatMap(i=>i.Tests).filter(bt))),this.gradingScaleIdsFromTests$=this.tests$.pipe(g(t=>[...t.map(i=>i.GradingScaleId)].filter(bt).filter(vt))),this.gradingScaleIdsFromCourses$=this.studentCourses$.pipe(g(t=>t.flatMap(i=>i.GradingScaleId).filter(bt).filter(vt))),this.gradingScaleIds$=ot([this.gradingScaleIdsFromCourses$,this.gradingScaleIdsFromTests$]).pipe(g(([t,i])=>t.concat(i).filter(vt))),this.gradingScales$=this.gradingScaleIds$.pipe(b(t=>ut(t.map(i=>this.gradingScalesRestService.getGradingScale(i)))))}setStudentId(t){this.studentId$.next(t)}getFinalGradeForStudent(t,i){return t?.FinalGrades?.find(n=>n.StudentId===i)}getGradingForStudent(t,i){return t?.Gradings?.find(n=>n.StudentId===i)}getGradingScaleOfCourse(t,i){return i?.find(n=>n.Id===t.GradingScaleId)}getGradesForStudent(t,i,n){return t.Tests?.flatMap(o=>({value:Number(xt(o,n)?.Grades.find(V=>V.Id===q(i,o)?.GradeId)?.Designation),weight:o.Weight})).filter(({value:o})=>!!o)||[]}updateStudentCourses(t){this.action$.next({type:"updateCourses",payload:t})}loadCourses(t){return this.loadingService.load(this.coursesRestService.getExpandedCoursesForDossier().pipe(g(i=>i.filter(n=>n.ParticipatingStudents?.find(o=>o.Id===t)))),{context:je})}coursesReducer(t,i){switch(i.type){case"initializeCourses":return i.payload;case"updateCourses":return this.updateCourses([...t],i.payload);default:return t}}updateCourses(t,i){return t.map(n=>R($({},n),{Tests:n.Tests!==null?n.Tests.map(o=>o.Id===i.Id?i:o):null}))}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=w({token:e,factory:e.\u0275fac})}}return e})();var He=(()=>{class e{constructor(){}get inIframe(){return window.parent!==window}get window(){return this.inIframe?window.parent:null}get document(){return this.window?.document.documentElement??null}querySelector(t){return this.window?.document?.querySelector("bkd-portal")?.shadowRoot?.querySelector(t)??null}getIframeElement(){return this.querySelector("bkd-content")?.shadowRoot?.querySelector("iframe")??null}getIframeTop(){return this.getIframeElement()?.offsetTop??0}getIFrameBottom(){let t=this.getIframeElement();return t?t.offsetTop+t.offsetHeight:0}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=w({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var Ue=(()=>{class e{constructor(){this.modal=c(xe),this.portal=c(He)}open(...t){let i=this.modal.open(...t);return this.applyPortalOffsetAndMaxHeight(i),this.disablePortalScrolling(i),i}get activeInstances(){return this.modal.activeInstances}dismissAll(...t){return this.modal.dismissAll(...t)}hasOpenModals(...t){return this.modal.hasOpenModals(...t)}applyPortalOffsetAndMaxHeight(t){let i=this.getModalWindowElement(t);if(!i){console.warn("Trying to apply portal offset to <ngb-modal-window>, but element is not present!");return}this.portal.window&&(i.style.top=`${this.getModalIframeOffset()}px`,i.style.maxHeight=`${this.getModalHeight()}px`)}disablePortalScrolling(t){if(this.portal.window&&this.portal.document){let i=this.portal.window.innerWidth-this.portal.document.clientWidth;this.portal.document.style.paddingRight=`${i}px`,this.portal.document.style.overflow="hidden"}t.hidden.subscribe(()=>{this.portal.document&&(this.portal.document.style.paddingRight="0px",this.portal.document.style.overflow="auto")})}getModalWindowElement(t){return t._windowCmptRef?.instance?._elRef?.nativeElement??null}getModalIframeOffset(){return Math.max(this.getViewportTop()-this.portal.getIframeTop(),0)}getModalTop(){return Math.max(this.getViewportTop(),this.portal.getIframeTop())}getModalBottom(){return Math.min(this.getViewportBottom(),this.portal.getIFrameBottom())}getModalHeight(){return this.getModalBottom()-this.getModalTop()}getViewportTop(){return this.portal.window?.scrollY??0}getViewportBottom(){return this.getViewportTop()+this.getViewportHeight()}getViewportHeight(){return this.portal.window?.innerHeight??0}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=w({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var mi=(e,r)=>r.Key,gi=e=>({width:e});function fi(e,r){if(e&1&&(l(0,"option",1),p(1),u(2,"translate"),d()),e&2){let t=S();T("ngValue",null),s(),v(" ",f(2,2,t.emptyLabel)," ")}}function hi(e,r){if(e&1&&(l(0,"option",1),p(1),d()),e&2){let t=r.$implicit;T("ngValue",t),s(),v(" ",t.Value," ")}}var Le=(()=>{class e{constructor(){this.options=[],this.allowEmpty=!0,this.emptyLabel="",this.value=null,this.disabled=!1,this.tabindex=0,this.width="auto",this.valueChange=new zt,this.options$=new O([]),this.rawValue$=new O(null),this.value$=ot([this.rawValue$,this.options$]).pipe(g(([t,i])=>i&&i.find(n=>n.Key===t)||null))}ngOnChanges(t){t.value&&this.rawValue$.next(t.value.currentValue),t.options&&this.options$.next(t.options.currentValue)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=D({type:e,selectors:[["bkd-select"]],inputs:{options:"options",allowEmpty:"allowEmpty",emptyLabel:"emptyLabel",value:"value",disabled:"disabled",tabindex:"tabindex",width:"width"},outputs:{valueChange:"valueChange"},features:[k],decls:6,vars:9,consts:[[1,"form-select",3,"ngModelChange","tabindex","ngStyle","disabled","ngModel"],[3,"ngValue"]],template:function(i,n){i&1&&(l(0,"select",0),u(1,"async"),F("ngModelChange",function(C){return n.valueChange.emit(C&&C.Key)}),x(2,fi,3,4,"option",1),Y(3,hi,2,2,"option",1,mi),p(5,` >
`),d()),i&2&&(mt("tabindex",n.tabindex),T("ngStyle",gt(7,gi,n.width))("disabled",n.disabled)("ngModel",f(1,5,n.value$)),s(2),y(n.allowEmpty?2:-1),s(),Q(n.options))},dependencies:[St,ce,ue,pe,ht,ae,A,te,P],encapsulation:2,changeDetection:0})}}return e})();function Tt(e,r,t){return r?r.Grade:Si(e,t)||e?.GradeValue}function Si(e,r){return r?.Grades.find(t=>t.Id===e?.GradeId)?.Designation}var Ii="1-3",qe="\u2013",Ke=(()=>{class e{constructor(){this.locale=c(Qt)}transform(t,i,n){let o=Number(t??null);return isNaN(o)?qe:bi(Number(t??null),n??this.locale,i)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275pipe=J({name:"decimalOrDash",type:e,pure:!0})}}return e})();function bi(e,r,t){return e===0?qe:Zt(e,r,`1.${vi(t)}`)}function vi(e){return e?String(e).includes("-")?String(e):`${e}-${e}`:Ii}var Xe=(()=>{class e{constructor(){}getGradeForStudent(){return Tt(this.grading,this.finalGrade,this.gradingScale)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=D({type:e,selectors:[["bkd-dossier-grades-final-grade"]],inputs:{finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},decls:14,vars:11,consts:[[1,"final-entry"],["data-testid","final-grade"],["data-testid","average-test-results"]],template:function(i,n){i&1&&(l(0,"div",0)(1,"div"),p(2),u(3,"translate"),d(),l(4,"div",1)(5,"span"),p(6),d()(),l(7,"div"),p(8),u(9,"translate"),d(),l(10,"div",2)(11,"span"),p(12),u(13,"decimalOrDash"),d()()()),i&2&&(s(2),E(f(3,4,"dossier.grade")),s(4),E(n.getGradeForStudent()||"\u2013"),s(2),E(f(9,6,"dossier.average")),s(4),E(j(13,8,n.average,"1-3")))},dependencies:[P,Ke],styles:[".final-entry[_ngcontent-%COMP%]{padding:1rem;display:grid;grid-template-columns:repeat(2,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}"]})}}return e})();var ze=(()=>{class e{constructor(){this.translate=c(It)}transform(t,i,n,o="tests.points"){return t.IsPointGrading&&(t.IsPublished||n)?`${q(i,t)?.Points||"\u2013"} / ${t.MaxPointsAdjusted||t.MaxPoints} ${this.translate.instant(o)}`:""}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275pipe=J({name:"bkdTestPoints",type:e,pure:!0})}}return e})();var Je=(()=>{class e{constructor(){this.translate=c(It)}transform(t){return`${this.translate.instant("tests.factor")} ${t.Weight} (${t.WeightPercent}%)`}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275pipe=J({name:"bkdTestWeight",type:e,pure:!0})}}return e})();var Ci=e=>({maxPoints:e});function xi(e,r){if(e&1&&(l(0,"div",13),p(1),u(2,"translate"),d()),e&2){let t=S(2);s(),v(" ",j(2,1,"global.validation-errors.invalidPoints",gt(4,Ci,t.maxPoints))," ")}}function yi(e,r){if(e&1){let t=tt();l(0,"div",3)(1,"label",11),p(2),u(3,"translate"),d(),l(4,"div",6)(5,"input",12,0),F("input",function(){X(t);let n=at(6),o=S();return z(o.onPointsChange(n.value))}),d()(),x(7,xi,3,6,"div",13),d()}if(e&2){let t=S();s(2),E(f(3,8,"dossier.dialog.points")),s(2),wt("is-invalid",t.pointsInput.errors),s(),wt("is-invalid",t.pointsInput.errors),mt("max",t.maxPoints),T("formControl",t.pointsInput),s(2),y(t.pointsInput.errors?7:-1)}}var Ye=500,Qe=(()=>{class e{constructor(){this.activeModal=c(Ce),this.courseService=c(Ct),this.maxPoints=0,this.gradeSubject$=new ct,this.pointsSubject$=new ct,this.closeButtonDisabled$=new O(!1),this.gradingScaleDisabled$=new O(!0),this.grade$=this.gradeSubject$.pipe(Gt(Ye)),this.points$=this.pointsSubject$.pipe(Gt(Ye),qt(this.isValid.bind(this)),g(Number)),this.destroy$=new ct}ngOnInit(){this.maxPoints=kt(this.test),this.pointsInput=new oe({value:this.points,disabled:!1},[$t.min(0),$t.pattern("[0-9]+([\\.][0-9]+)?"),this.maxPointValidator()]),this.gradingScaleDisabled$.next(this.test.IsPointGrading&&this.points>0),this.points$.pipe(Et(this.destroy$)).subscribe(t=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,points:t})),this.grade$.pipe(Et(this.destroy$)).subscribe(t=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,gradeId:t}))}onGradeChange(t){this.gradeSubject$.next(t)}onPointsChange(t){this.pointsSubject$.next(t),this.gradingScaleDisabled$.next(t.length>0)}updateTestResult(t){this.closeButtonDisabled$.next(!0),this.courseService.updateTestResult(this.test.CourseId,t).subscribe(({testResult:i})=>{this.gradeId=i?.GradeId??null,this.updatedTestResult=i,this.closeButtonDisabled$.next(!1)})}isValid(t){return t===""||isNaN(Number(t))?!1:!(Number(t)<0||Number(t)>this.maxPoints)}maxPointValidator(){return t=>Number(t.value)>kt(this.test)?{customMax:!0}:null}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=D({type:e,selectors:[["bkd-dossier-grades-edit"]],inputs:{test:"test",gradeId:"gradeId",gradeOptions:"gradeOptions",points:"points",studentId:"studentId"},decls:19,vars:20,consts:[["pointInput",""],[1,"modal-body"],[1,"mb-4"],[1,"form-group","row"],[1,"form-group","row","mt-2"],["for","grade",1,"col-6","col-form-label"],[1,"col-6"],["id","grade",3,"valueChange","options","value","allowEmpty","disabled"],[1,"text-muted","mt-4"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["for","points",1,"col-6","col-form-label"],["id","points","type","number","step","0.01","min","0",1,"form-control",3,"input","max","formControl"],["data-testid","validation-error-message",1,"invalid-feedback","col-6","offset-6"]],template:function(i,n){i&1&&(l(0,"div",1)(1,"p",2),p(2),d(),x(3,yi,8,10,"div",3),l(4,"div",4)(5,"label",5),p(6),u(7,"translate"),d(),l(8,"div",6)(9,"bkd-select",7),u(10,"async"),F("valueChange",function(C){return C&&n.onGradeChange(C)}),d()()(),l(11,"p",8),p(12),u(13,"translate"),d()(),l(14,"div",9)(15,"button",10),u(16,"async"),F("click",function(){return n.activeModal.close(n.updatedTestResult)}),p(17),u(18,"translate"),d()()),i&2&&(s(2),E(n.test.Designation),s(),y(n.test.IsPointGrading?3:-1),s(3),E(f(7,10,"dossier.dialog.grade")),s(3),T("options",n.gradeOptions)("value",n.gradeId)("allowEmpty",!1)("disabled",f(10,12,n.gradingScaleDisabled$)),s(3),v(" ",f(13,14,n.test.IsPointGrading?"dossier.dialog.hint.points":"dossier.dialog.hint.grade")," "),s(3),T("disabled",f(16,16,n.closeButtonDisabled$)),s(2),v(" ",f(18,18,"dossier.dialog.close")," "))},dependencies:[St,se,de,ht,ge,me,fe,le,Le,A,P],encapsulation:2})}}return e})();function Ti(e,r){if(e&1){let t=tt();l(0,"a",10),F("click",function(){X(t);let n=S(2),o=N(0);return z(n.editGrading(o))}),l(1,"i",11),p(2,"edit"),d(),l(3,"span",5),p(4),d()()}if(e&2){S(2);let t=N(2);s(4),E(t)}}function _i(e,r){if(e&1&&(l(0,"span",5),p(1),d()),e&2){S(2);let t=N(2);s(),E(t)}}function Gi(e,r){if(e&1&&(l(0,"div",9),p(1),u(2,"translate"),d()),e&2){S(2);let t=N(0);s(),v(" ",f(2,1,t.IsPublished?"tests.published":"tests.not-published")," ")}}function Di(e,r){if(e&1&&(l(0,"div",0)(1,"div",1),p(2),d(),l(3,"div",2),p(4),u(5,"date"),d(),l(6,"div",3),x(7,Ti,5,1,"a",4)(8,_i,2,1,"span",5),d(),l(9,"div",6),p(10),u(11,"bkdTestWeight"),d(),l(12,"div",7)(13,"span"),p(14),u(15,"bkdTestPoints"),d()(),l(16,"div",8),p(17),d(),x(18,Gi,3,3,"div",9),d()),e&2){let t=S(),i=N(0);s(2),v(" ",i.Designation," "),s(2),v(" ",j(5,7,i.Date,"dd.MM.yyyy")," "),s(3),y(t.isEditable&&i.IsOwner?7:8),s(3),v(" ",f(11,10,i)," "),s(4),E(Yt(15,12,i,t.studentId,t.isEditable,"dossier.points")),s(3),v(" ",i.Owner," "),s(),y(t.isEditable?18:-1)}}var Ze=(()=>{class e{constructor(){this.gradeService=c(yt),this.modalService=c(Ue),this.test$=new st(1),this.grading$=this.test$.pipe(g(this.getGrading.bind(this)))}ngOnChanges(t){t.test&&this.test$.next(this.test)}editGrading(t){let i=this.modalService.open(Qe,{backdrop:"static"});i.componentInstance.test=t,i.componentInstance.gradeId=this.getGradeId(t),i.componentInstance.gradeOptions=e.mapToOptions(this.gradingScale),i.componentInstance.studentId=this.studentId,i.componentInstance.points=this.getPoints(t),i.result.then(n=>{n&&this.updateStudentGrade(n,t)},()=>{})}updateStudentGrade(t,i){let n=Nt(t,i);this.gradeService.updateStudentCourses(n)}getGrading(t){return this.gradingScale?.Grades.find(i=>i.Id===this.getGradeId(t))?.Designation||"\u2013"}getGradeId(t){return q(this.studentId,t)?.GradeId||null}getPoints(t){return q(this.studentId,t)?.Points||null}static mapToOptions(t){return t?.Grades.map(i=>({Key:i.Id,Value:i.Designation}))||null}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=D({type:e,selectors:[["bkd-dossier-single-test"]],inputs:{test:"test",studentId:"studentId",gradingScale:"gradingScale",isEditable:"isEditable"},features:[k],decls:5,vars:7,consts:[[1,"test-entry"],["data-testid","test-designation",1,"designation"],["data-testid","test-date",1,"date"],[1,"grade"],["aria-label","edit grade",1,"btn","btn-link"],["data-testid","test-grade"],["data-testid","test-factor",1,"factor"],["data-testid","test-points",1,"points"],["data-testid","test-teacher",1,"teacher"],["data-testid","test-status",1,"state"],["aria-label","edit grade",1,"btn","btn-link",3,"click"],["data-testid","test-grade-edit-icon",1,"material-icons"]],template:function(i,n){if(i&1&&(dt(0),u(1,"async"),dt(2),u(3,"async"),x(4,Di,19,17,"div",0)),i&2){let o=lt(f(1,1,n.test$));s(2),lt(f(3,4,n.grading$)),s(2),y(o?4:-1)}},dependencies:[A,ee,P,ze,Je],styles:['.test-entry[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1rem;display:grid;grid-template-areas:"designation designation grade factor" "date date points ." "teacher teacher . ." "state state . .";grid-template-columns:repeat(4,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}.designation[_ngcontent-%COMP%]{grid-area:designation}.date[_ngcontent-%COMP%]{grid-area:date}.grade[_ngcontent-%COMP%]{grid-area:grade}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;color:#000;padding:0;text-decoration:none}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.grade[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:-1em;color:#00000080}.points[_ngcontent-%COMP%]{grid-area:points;color:#00000080}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.state[_ngcontent-%COMP%]{grid-area:state}@media (max-width: 575.98px){.test-entry[_ngcontent-%COMP%]{grid-template-areas:"designation designation" "date grade" "factor points" "teacher teacher" "state state";grid-template-columns:repeat(2,1fr)}}']})}}return e})();var Ei=(e,r)=>r.Id,wi=()=>[];function Pi(e,r){if(e&1&&Z(0,"bkd-dossier-single-test",2),e&2){let t=r.$implicit,i=S(2);T("test",t)("studentId",i.studentId)("gradingScale",i.getGradingScaleOfTest(t))("isEditable",i.isEditable)}}function $i(e,r){if(e&1&&(l(0,"div"),Z(1,"bkd-dossier-grades-final-grade",1),Y(2,Pi,1,4,"bkd-dossier-single-test",2,Ei),d()),e&2){let t=S(),i=N(0);s(),T("finalGrade",t.decoratedCourse.finalGrade)("grading",t.decoratedCourse.grading)("gradingScale",t.decoratedCourse.gradingScale)("average",t.decoratedCourse.average),s(),Q(i)}}function Ri(e,r){e&1&&(l(0,"p",0),p(1),u(2,"translate"),d()),e&2&&(s(),v(" ",f(2,1,"dossier.no-tests")," "))}var ti=(()=>{class e{ngOnChanges(t){t.decoratedCourse&&this.sortedTests$.next(this.sortedTests())}constructor(){this.sortedTests$=new O([])}sortedTests(){return this.decoratedCourse.course.Tests?ke(this.decoratedCourse.course.Tests):[]}getGradingScaleOfTest(t){return xt(t,this.gradingScales)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=D({type:e,selectors:[["bkd-dossier-course-tests"]],inputs:{studentId:"studentId",decoratedCourse:"decoratedCourse",gradingScales:"gradingScales",isEditable:"isEditable"},features:[k],decls:4,vars:5,consts:[["data-testid","message-no-tests",1,"p-3"],[3,"finalGrade","grading","gradingScale","average"],[3,"test","studentId","gradingScale","isEditable"]],template:function(i,n){if(i&1&&(dt(0),u(1,"async"),x(2,$i,4,4,"div")(3,Ri,3,3,"p",0)),i&2){let o,C=lt((o=f(1,1,n.sortedTests$))!==null&&o!==void 0?o:Jt(4,wi));s(2),y(C.length>0?2:3)}},dependencies:[Xe,Ze,A,P],encapsulation:2})}}return e})();function Mi(e,r){if(e&1&&(l(0,"span",0),p(1),d()),e&2){let t=S();s(),v(" (",t.grade,")")}}function Oi(e,r){if(e&1&&(l(0,"span",1),p(1),u(2,"number"),d()),e&2){let t=S();s(),v(" (",j(2,1,t.average,"1.1-3"),")")}}var ei=(()=>{class e{constructor(){}get grade(){return this.getGradeForStudent()}getGradeForStudent(){return Tt(this.grading,this.finalGrade,this.gradingScale)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=D({type:e,selectors:[["bkd-dossier-grades-course-header"]],inputs:{designation:"designation",finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},decls:3,vars:3,consts:[["data-testId","grade",1,"grade"],["data-testId","average",1,"average"]],template:function(i,n){i&1&&(p(0),x(1,Mi,2,1,"span",0)(2,Oi,3,4,"span",1)),i&2&&(v("",n.designation,`
`),s(),y(n.grade?1:-1),s(),y(!n.grade&&n.average?2:-1))},dependencies:[ie],styles:[".average[_ngcontent-%COMP%]{color:#00000080}"]})}}return e})();var Fi=(e,r)=>r.course.Id;function Ai(e,r){if(e&1&&Z(0,"bkd-dossier-course-tests",9),e&2){let t=S().$implicit,i=S(2);T("decoratedCourse",t)("studentId",i.studentId)("gradingScales",i.gradingScales)("isEditable",i.isEditable)}}function Bi(e,r){if(e&1){let t=tt();l(0,"div")(1,"div",2)(2,"div",3,0)(4,"div",4)(5,"bkd-student-dossier-entry-header",5),F("click",function(){X(t);let n=at(3);return z(n.toggle())}),Z(6,"bkd-dossier-grades-course-header",6),d()(),l(7,"div",7)(8,"div",8),x(9,Ai,1,4,"ng-template"),d()()()()()}if(e&2){let t=r.$implicit,i=at(3);s(5),T("opened",!i.collapsed),s(),T("designation",t.course.Designation)("finalGrade",t.finalGrade)("grading",t.grading)("gradingScale",t.gradingScale)("average",t.average)}}function Vi(e,r){if(e&1&&(Y(0,Bi,10,6,"div",null,Fi),u(2,"async")),e&2){let t=S();Q(f(2,0,t.decoratedCoursesSubject$))}}function ki(e,r){e&1&&(l(0,"p",1),p(1),u(2,"translate"),d()),e&2&&(s(),v(" ",f(2,1,"dossier.no-courses")," "))}var ws=(()=>{class e{constructor(){this.dossierGradesService=c(yt),this.isEditable=!0,this.decoratedCoursesSubject$=new O([])}ngOnChanges(){this.decoratedCoursesSubject$.next(this.decorateCourses())}decorateCourses(){return this.courses.map(t=>{let i=this.dossierGradesService.getFinalGradeForStudent(t,this.studentId),n=this.dossierGradesService.getGradesForStudent(t,this.studentId,this.gradingScales);return{course:t,finalGrade:i,grading:this.dossierGradesService.getGradingForStudent(t,this.studentId),gradingScale:this.dossierGradesService.getGradingScaleOfCourse(t,this.gradingScales),average:i?.AverageTestResult||Be(n)}})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=D({type:e,selectors:[["bkd-dossier-grades-view"]],inputs:{courses:"courses",studentId:"studentId",gradingScales:"gradingScales",isEditable:"isEditable"},features:[k],decls:2,vars:1,consts:[["courses","ngbAccordionItem"],["data-testid","message-no-courses",1,"py-3"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],[3,"designation","finalGrade","grading","gradingScale","average"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[3,"decoratedCourse","studentId","gradingScales","isEditable"]],template:function(i,n){i&1&&x(0,Vi,3,2)(1,ki,3,3,"p",1),i&2&&y(n.courses.length>0?0:1)},dependencies:[ve,be,Ie,De,ei,Se,he,ti,A,P],encapsulation:2})}}return e})();export{Vt as a,Tn as b,_n as c,Gn as d,Dn as e,En as f,wn as g,Pn as h,ke as i,we as j,Ft as k,Ct as l,Ne as m,Fe as n,Ae as o,yt as p,qe as q,Ke as r,bi as s,He as t,Ue as u,Le as v,ws as w};
