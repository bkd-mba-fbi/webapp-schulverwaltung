import{a as qn,b as si}from"./chunk-EBZSBVPF.js";import{a as pe,b as he}from"./chunk-OLKZTOFS.js";import{b as zn}from"./chunk-G4BBF67E.js";import{a as ue}from"./chunk-ULG2PTMU.js";import{a as ai}from"./chunk-NAZK32C7.js";import{a as wt}from"./chunk-OKVYVMVI.js";import{a as ri}from"./chunk-WJ6FCKJ3.js";import{e as Nn}from"./chunk-7TBS4XHE.js";import{a as In,b as Mn}from"./chunk-E4XBZIF7.js";import{a as xe,b as Gn,c as Fn,d as $n,e as Vn,f as ti,g as ei,h as Bn,i as Rn,k as An,l as yt,m as ii,o as Hn,p as ni,q as jn,r as xt}from"./chunk-XB5EAG3V.js";import{b as Ln,d as de}from"./chunk-HQEU7IQK.js";import{a as En,d as Pn}from"./chunk-EXHTRNRL.js";import{e as Dn}from"./chunk-6O7JHME5.js";import{B as Tn,C as Ut,G as qt,H as Un}from"./chunk-CC2ZY7RA.js";import{a as se,c as xn}from"./chunk-JQMOLUIY.js";import{a as tt,b as le}from"./chunk-42VZKNAZ.js";import{a as On}from"./chunk-Y4QYVF5K.js";import{p as wn}from"./chunk-QGDSASTQ.js";import{a as ae}from"./chunk-7PYQWJKW.js";import{a as oi,b as me}from"./chunk-Z34FWFET.js";import{a as ce,b as Wn,c as Gt}from"./chunk-Z73OPYRC.js";import{a as kn,b as ye}from"./chunk-MGLEQUF6.js";import{a as Ze}from"./chunk-YHCR7GAG.js";import{d as Je}from"./chunk-FVPRCQLC.js";import{a as oe,b as Ei,i as st}from"./chunk-YNODG5RP.js";import{a as Sn,b as Xe}from"./chunk-EFJ6WEH7.js";import{a as Ot,b as q,h as cn,i as pn,k as mn,l as un,r as Dt}from"./chunk-HVLHLZKP.js";import{a as yn,b as Lt}from"./chunk-DQAQYQ7K.js";import{a as re}from"./chunk-LYDHS67M.js";import{E as Ke,G as Ye,H as hn,I as gn,J as fn,K as vn,L as Ti,M as Cn,N as _n,O as Qe,P as bn,d as ee,f as Se,g as Xi,h as It,q as gt,r as Mt,s as kt,t as it,z as ft}from"./chunk-ZXUJZ6KS.js";import{$b as Le,$d as He,Ae as M,Cc as p,Cd as Qt,Dc as m,Dd as Wt,Ea as j,Eb as bt,Ec as W,Ed as Zi,G as Ee,Gb as C,H as Kt,Ha as Jt,Hb as Vt,Hd as wi,Ia as Oe,Ib as _,Ic as zi,Id as ie,Jb as Ni,Jc as Ki,Jd as Ji,Ka as Hi,Kb as te,Kc as x,L as Pe,Lb as B,Lc as Be,Mb as R,Mc as Yt,Md as tn,N as Ie,Nb as g,O as Me,Ob as s,Oc as Ht,Pb as l,Pc as k,Q as ut,Qb as y,Qc as Re,Rd as Ae,S as ot,Sc as pt,U as ke,Ub as D,Wb as T,Xb as h,Y as $i,Yb as Ui,Zb as qi,_ as lt,a as V,aa as Et,ab as $t,ac as Ge,b as A,ba as G,bc as Fe,be as ne,cc as $e,ce as je,d as ct,da as Pt,db as o,dc as Ve,de as We,ec as St,ee as en,fd as ht,gc as Y,gd as Yi,ge as nn,he as Ne,ic as c,id as et,ie as Ue,j as nt,ja as X,jc as S,jd as jt,je as rn,k as rt,kc as v,l as Si,lc as be,le as an,md as Qi,ne as on,oa as u,ob as b,oc as z,pc as U,q as F,qb as ji,qc as K,r as Fi,rb as Wi,rc as H,re as qe,sa as Vi,sb as De,sc as N,se as ze,ta as Bi,tc as L,te as sn,u as Ft,ua as E,uc as Bt,v as I,va as P,vc as Rt,ve as ln,w as Z,wa as Zt,wb as Ct,wc as dt,we as Nt,xa as Ri,xc as At,xe as dn,ya as yi,yc as $,za as Ai,zc as xi,ze as J}from"./chunk-GP622B77.js";var Ca=10300,_a=10260,ba=10250,Sa=14030,ya=10350;function li(e){let{HasEvaluationStarted:n,EvaluationUntil:a,HasTestGrading:t}=e.EvaluationStatusRef;if(n===!0&&(e.StatusId===Sa||e.StatusId===ya))return{value:_t.Rating};if(n===!0&&t===!1){if(a)return{value:_t.RatingUntil};if(e.StatusId===Ca)return{value:_t.IntermediateRating}}return n===!1&&t===!0&&e.StatusId!==_a&&e.StatusId!==ba?{value:_t.Tests}:n===!0&&t===!0?a?{value:_t.Tests,label:_t.RatingUntil}:{value:_t.Tests,label:_t.IntermediateRating}:null}function Kn(e){return e.EvaluationStatusRef.HasEvaluationStarted===!0}function Yn(e){return e.EvaluationStatusRef.HasReviewOfEvaluationStarted===!0&&!!e.FinalGrades?.length}function di(e){let n=e.Classes?e.Classes.map(a=>a.Number).join(", "):null;return n?e.Designation+", "+n:e.Designation}function Qn(e,n){return e?(n.Leadership??"").split(",").some(a=>a.trim()===e.fullname):!1}function ci(e,n){let a=new URLSearchParams({returnlink:n});return n.startsWith("/dashboard")?`/dashboard/students/${e}?${a}`:n.startsWith("/events/current")?`/events/current/${e}?${a}`:n.startsWith("/events/study-courses")?`/events/study-courses/${e}?${a}`:`/events/${e}/students?${a}`}function Xn(e){let n=e.Participants?.filter(a=>a.IsActive).map(a=>({id:a.PersonId,name:a.FullName,email:a.DisplayEmail??void 0}))??[];return{eventId:e.Id,eventDesignation:e.Designation,studyClasses:(e.Classes??[]).map(a=>a.Designation).sort(),entries:n}}function Pi(e,n){return A(V({},e),{entries:e.entries.map(a=>{let t=n.find(r=>r.StudentId===a.id),i=t?[t.CompanyName,t.CompanyNameAddition].filter(Boolean).join(" \u2013 "):void 0;return A(V({},a),{company:i})})})}function Ii(e,n,a,t){return{eventId:e,eventDesignation:t??a[0]?.EventDesignation??"",studyClasses:[],entries:n.map(i=>{let r=a.find(d=>d.PersonId===i.Id);return{id:i.Id,subscriptionId:r?.Id,name:i.FullName,email:i.DisplayEmail??void 0,status:r?.Status,statusId:r?.StatusId??void 0,registrationDate:r?.RegistrationDate??void 0}})}}function Zn(e,n){return A(V({},e),{entries:e.entries.map(a=>A(V({},a),{studyClass:n.find(t=>t.StudentRef.Id===a.id)?.StudyClassNumber}))})}var _t=function(e){return e.Rating="rating",e.RatingUntil="rating-until",e.IntermediateRating="intermediate-rating",e.Tests="add-tests",e}(_t||{}),ge=(()=>{let n=class n{constructor(){this.coursesRestService=u(yt),this.studyClassRestService=u(ai),this.loadingService=u(tt),this.translate=u(J),this.router=u(kt),this.loading$=this.loadingService.loading$,this.searchFields$=new rt(["designation"]),this.searchSubject$=new rt(""),this.search$=this.searchSubject$.asObservable(),this.roles$=new rt(null),this.isClassTeacher$=this.roles$.pipe(I(t=>On(t,"ClassTeacherRole")),lt(1)),this.unratedCourses$=this.roles$.pipe(G(this.loadUnratedCourses.bind(this)),lt(1)),this.formativeAssessments$=this.isClassTeacher$.pipe(G(this.loadFormativeAssessments.bind(this)),lt(1)),this.studyClasses$=this.isClassTeacher$.pipe(G(this.loadStudyClasses.bind(this)),lt(1)),this.events$=this.getEvents().pipe(lt(1)),this.filteredEvents$=Z([this.events$,this.searchFields$,this.search$]).pipe(I(Ut(pe)))}setSearch(t){this.searchSubject$.next(t)}setRoles(t){this.roles$.next(t)}setSearchFields(t){this.searchFields$.next(t)}getEntries(t=!1){return this.filteredEvents$.pipe(I(i=>t?i.filter(r=>r.evaluationText):i))}getEvents(){return this.loadingService.load(Z([this.unratedCourses$,this.formativeAssessments$,this.studyClasses$]),{stopOnFirstValue:!0}).pipe(I(Ut(this.createAndSortEvents.bind(this))))}loadUnratedCourses(t){return this.coursesRestService.getExpandedCourses(t).pipe(I(i=>i.filter(r=>!Yn(r))))}loadFormativeAssessments(t){return t?this.studyClassRestService.getActiveFormativeAssessments():F([])}loadStudyClasses(t){return t?this.studyClassRestService.getActive():F([])}createAndSortEvents(t,i,r){let d=r.filter(f=>!i.map(w=>w.Id).includes(f.Id));return[...this.createFromCourses(t),...this.createFromAssessments(i),...this.createFromStudyClasses(d)].sort((f,w)=>f.designation.localeCompare(w.designation))}createFromCourses(t){return t.map(i=>{let r=li(i);return{id:i.Id,designation:di(i),detailLink:this.buildStudentsLink(i.Id),studentCount:i.AttendanceRef.StudentCount||0,dateFrom:i.DateFrom,dateTo:i.DateTo,state:r?.value||null,evaluationText:this.getEvaluationText(r,i.EvaluationStatusRef.EvaluationUntil),evaluationLink:r?.value&&r?.value!==_t.Tests?["/events",i.Id,"evaluation"]:["/events",i.Id,"tests"]}})}createFromAssessments(t){return this.createFromStudyClasses(t).map(r=>A(V({},r),{state:_t.Rating,evaluationText:this.translate.instant("events.state.rating"),evaluationLink:["/events",r.id,"evaluation"]}))}createFromStudyClasses(t){return t.map(i=>({id:i.Id,designation:i.Number,detailLink:this.buildStudentsLink(i.Id),studentCount:i.StudentCount,state:null}))}getEvaluationText(t,i){let r=t?.label||t?.value;return r?this.translate.instant(`events.state.${r}`)+(r===_t.RatingUntil?` ${i?wn(i,"dd.MM.yyyy"):""}`:""):""}buildStudentsLink(t){return ci(t,this.router.url)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();var Jn=(()=>{let n=class n{constructor(){}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-events"]],features:[dt([ge,Tn])],decls:1,vars:0,template:function(i,r){i&1&&y(0,"router-outlet")},dependencies:[Mt],encapsulation:2});let e=n;return e})();var er=ie({adAsColumns:wi(Wt),adAsCriteria:wi(Wt)});var ir=(()=>{let n=class n{constructor(){this.settings=u(ft),this.resourcePath="Configurations",this.http=u(It)}getSubscriptionDetailsDisplay(){return this.http.get(`${this.baseUrl}/Grading`).pipe(G(Sn(er)))}get baseUrl(){return`${this.settings.apiUrl}/${this.resourcePath}`}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();var nr=ie({Id:Qt,IdPerson:Wt,PersonFullname:Qt,IdGrade:Ae(Wt),GradeValue:Ae(Qt),Comment:Ae(Qt)});var pi=(()=>{let n=class n extends oe{constructor(){let t=u(It),i=u(ft);super(t,i,nr,"GradingItems")}getListForEvent(t){let i=new ee().set("idEvent",t);return this.getList({params:i})}updateForEvent(t,i){let r=new ee().set("idEvent",t);return this.http.put(`${this.baseUrl}/`,i,{params:r})}update(t,i){let r=`${this.baseUrl}/${t}`;return this.http.put(r,i)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();function ar(e){return(n,a)=>{let t=0;switch(e.primarySortKey){case"name":t=rr(n,a);break;case"grade":t=xa(n,a),t===0&&(t=rr(n,a));break;default:throw new Ze(e.primarySortKey,"Unhandled sort criteria")}return e.ascending?t:-t}}function rr(e,n){return e.gradingItem.PersonFullname.localeCompare(n.gradingItem.PersonFullname)}function xa(e,n){return(e.grade?.Sort??"-").localeCompare(n.grade?.Sort??"-")*-1}var wa={primarySortKey:"name",ascending:!0},or="events-evaluation",vt=(()=>{let n=class n{constructor(){this.route=u(gt),this.loadingService=u(tt),this.coursesService=u(yt),this.studyClassesService=u(ai),this.gradingItemsService=u(pi),this.gradingScalesService=u(ii),this.configurationsService=u(ir),this.subscriptionDetailsService=u(oi),this.eventId$=(this.route.parent?.params??F({})).pipe(I(t=>{let i=t.id;return i?Number(i):null}))??F(null),this.sortCriteria=j(wa),this.loading=q(this.loadingService.loading(or),{requireSync:!0}),this.noEvaluation=x(()=>!this.gradingScale()&&this.columns().length===0&&this.entries().every(({criteria:t})=>t.length===0)),this.hasReviewStarted=x(()=>this.event()?.hasReviewOfEvaluationStarted&&!this.event()?.hasEvaluationStarted),this.event=q(this.eventId$.pipe(G(this.loadEvaluationEvent.bind(this))),{initialValue:null}),this.columns=x(()=>this.collectColumns(this.columnSubscriptionDetails())),this.entries=x(()=>this.sortEntries(this.unsortedEntries(),this.sortCriteria())),this.gradingItems=Yt({source:q(this.eventId$.pipe(G(this.loadGradingItems.bind(this)),Et([])),{initialValue:[]}),computation:t=>t}),this.gradingScale=q(Ot(this.event).pipe(G(t=>this.loadGradingScale(t?.gradingScaleId??null))),{initialValue:null}),this.subscriptionDetailsDisplay=q(this.loadSubscriptionDetailsDisplay(),{initialValue:null}),this.fetchedSubscriptionDetails=q(this.eventId$.pipe(G(this.loadSubscriptionDetails.bind(this))),{initialValue:[]}),this.subscriptionDetails=Yt(()=>this.fetchedSubscriptionDetails()),this.subscriptionDetailsValues=x(()=>this.fetchedSubscriptionDetails().reduce((t,i)=>A(V({},t),{[this.getDetailId(i)]:j(i.Value)}),{})),this.columnSubscriptionDetails=x(()=>this.filterColumns(this.subscriptionDetails(),this.subscriptionDetailsDisplay())),this.criteriaSubscriptionDetails=x(()=>this.filterCriteria(this.subscriptionDetails(),this.subscriptionDetailsDisplay())),this.unsortedEntries=x(()=>this.collectEntries(this.gradingItems(),this.gradingScale(),this.columns(),this.columnSubscriptionDetails(),this.criteriaSubscriptionDetails(),this.subscriptionDetailsValues()))}updateGradingItems(t){this.gradingItems.set(t)}updateSubscriptionDetail(t,i){let r=this.subscriptionDetails().map(d=>this.getDetailId(d)===this.getDetailId(t)?A(V({},d),{Value:i}):d);this.subscriptionDetails.set(r)}loadEvaluationEvent(t){return t===null?F(null):this.loadingService.load(Z([this.loadCourse(t),this.loadStudyClass(t)]).pipe(I(([i,r])=>i??r)),or)}loadCourse(t){let i=new Se().set(ye,{disableErrorHandlingForStatus:[404]});return this.coursesService.getCourseWithStudentCount(t,{context:i}).pipe(Ei(),I(r=>r?this.buildEvaluationEventFromCourse(r):null))}loadStudyClass(t){let i=new Se().set(ye,{disableErrorHandlingForStatus:[404]});return this.studyClassesService.get(t,{context:i}).pipe(Ei(),I(r=>r?this.buildEvaluationEventFromStudyClass(r):null))}buildEvaluationEventFromCourse(t){let i=t.Classes?.map(d=>d.Number)??[],r=i.length>0?`${t.Designation}, ${i.join(", ")}`:t.Designation;return{id:t.Id,designation:r,type:"course",studentCount:t.AttendanceRef.StudentCount??0,gradingScaleId:t.GradingScaleId,hasReviewOfEvaluationStarted:t.EvaluationStatusRef.HasReviewOfEvaluationStarted||!1,hasEvaluationStarted:t.EvaluationStatusRef.HasEvaluationStarted||!1}}buildEvaluationEventFromStudyClass(t){return{id:t.Id,designation:t.Number,type:"study-class",studentCount:t.StudentCount,gradingScaleId:null,hasReviewOfEvaluationStarted:!1,hasEvaluationStarted:!0}}loadGradingItems(t){return t?this.gradingItemsService.getListForEvent(t):F([])}loadGradingScale(t){return t?this.gradingScalesService.get(t):F(null)}loadSubscriptionDetailsDisplay(){return this.configurationsService.getSubscriptionDetailsDisplay()}loadSubscriptionDetails(t){return t?this.subscriptionDetailsService.getListForEvent(t):F([])}filterColumns(t,i){if(!i)return[];let r=i.adAsColumns,d=t.filter(f=>r.includes(Number(f.VssId)));return Ti(d,f=>f.Sort)}filterCriteria(t,i){if(!i)return[];let r=i.adAsCriteria,d=t.filter(f=>r.includes(Number(f.VssId)));return Ti(d,f=>f.Sort)}getDetailId(t){return`${t.Id}_${t.IdPerson}`}getDetailIdByGradingItem(t,i){return`${t.Id}_${i}_${t.IdPerson}`}getSubscriptionDetailValue(t,i){return t[this.getDetailId(i)]??null}collectColumns(t){return Qe(t,i=>i.VssId).map(i=>({vssId:i.VssId,title:i.VssDesignation,tooltip:i.Tooltip,sort:i.Sort}))}collectEntries(t,i,r,d,f,w){return t.map(Q=>this.buildEntry(Q,i,r,d,f,w))}buildEntry(t,i,r,d,f,w){let Q=d.filter(mt=>mt.IdPerson===t.IdPerson),Tt=r.map(({vssId:mt})=>Q.find(va=>va.VssId===mt)??null),Xt=f.filter(mt=>mt.IdPerson===t.IdPerson);return{gradingItem:t,grade:this.findGrade(t,i),columns:Tt.map(mt=>mt?{detail:mt,value:this.getSubscriptionDetailValue(w,mt)}:null),criteria:Xt.map(mt=>({detail:mt,value:this.getSubscriptionDetailValue(w,mt)})),evaluationRequired:this.isEvaluationRequired(t,i,Tt,Xt,w[this.getDetailIdByGradingItem(t,3959)]??null)}}isEvaluationRequired(t,i,r,d,f){let w=i&&this.findGrade(t,i);return!!(i!==null&&w===null||[...r,...d].some(Q=>Q?.VssInternet==="M"&&Q?.Value===null)||!w?.Sufficient&&f!==null&&d.filter(Q=>Q?.Value!==null).length===0)}findGrade(t,i){let r=i?.Grades??[];return t.IdGrade?r.find(d=>d.Id===t.IdGrade)??null:null}sortEntries(t,i){return[...t].sort(ar(i))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=X({token:n,factory:n.\u0275fac});let e=n;return e})();var sr="events-evaluation-update",fe=(()=>{let n=class n{constructor(){this.loadingService=u(tt),this.subscriptionDetailsService=u(oi),this.state=u(vt),this.restErrorService=u(kn),this.toastService=u(re),this.translate=u(J),this.updating=q(this.loadingService.loading(sr),{requireSync:!0})}updateSubscriptionDetail(t){return ct(this,null,function*(){let{detail:i,value:r}=t;if(!r||i.Value===r())return;let{error:d}=yield Ft(this.saveSubscriptionDetail({detail:i,value:r}));d?this.handleSubscriptionDetailError(t,d):this.handleSubscriptionDetailSuccess(t)})}handleSubscriptionDetailSuccess(t){let{detail:i,value:r}=t;r&&this.state.updateSubscriptionDetail(i,r())}handleSubscriptionDetailError(t,i){i instanceof Xi?this.restErrorService.notifyHttpError(i):this.toastService.error(this.translate.instant("global.app-errors.exception-message"),this.translate.instant("global.app-errors.exception-title"));let{detail:r,value:d}=t;d?.set(r.Value)}saveSubscriptionDetail(t){let{detail:i,value:r}=t;if(!r)return F({});let d=new Se().set(ye,{disableErrorHandlingExceptForStatus:[401,403]});return this.loadingService.load(this.subscriptionDetailsService.update(i,r(),d).pipe(I(()=>({})),Pe(f=>F({error:f}))),sr)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=X({token:n,factory:n.\u0275fac});let e=n;return e})();function Mi(e){return e.map(({finalGrade:n})=>n).filter(Ta)}function Ta(e){return e!==null}function cr(e,n,a,t){return e?.map(i=>({student:i,finalGrade:Pa(i,a,t),grades:Ea(i,n)}))}function Ea(e,n){return n.map(a=>{if(a.Results===void 0||a.Results?.length===0)return{kind:"no-result",test:a};let t=a.Results?.find(i=>i.StudentId===e.Id);return t!==void 0?{kind:"grade",result:t,test:a}:{kind:"no-result",test:a}})}function Pa(e,n,a){let t=n.find(r=>r.StudentId===e.Id);if(t)return{gradingId:t.Id,gradeId:t.GradeId??void 0,average:t.AverageTestResult||void 0,canGrade:t.CanGrade};let i=a.find(r=>r.StudentId===e.Id);if(i)return{finalGradeValue:i.Grade,average:i.AverageTestResult||void 0,canGrade:!1};throw new Error(`Student ${e.FullName} has neither a grading and nor a final grade, this should not happen`)}var pr=({primarySortKey:e,ascending:n},a)=>{let t=n?1:-1,i=null;if(e.startsWith("Test-")){let r=Number(e.replace("Test-",""));i=a.find(d=>d.Id===r)??null}return(r,d)=>{switch(e){case"FullName":return t*r.student.FullName.localeCompare(d.student.FullName);case"FinalGrade":return!r.finalGrade?.gradeId||!d.finalGrade?.gradeId?t*-1:t*lr(r.finalGrade.gradeId,d.finalGrade.gradeId);case"TestsMean":return!r.finalGrade?.average||!d.finalGrade?.average?t*-1:t*lr(r.finalGrade.average,d.finalGrade.average);default:return e.startsWith("Test-")&&i?t*Ia(i,r,d):0}}},Ia=(e,n,a)=>{let t=n.grades.filter(dr).find(r=>r.test.Id===e.Id),i=a.grades.filter(dr).find(r=>r.test.Id===e.Id);return e.IsPointGrading&&t?.result.GradeId===i?.result.GradeId?(t?.result.Points??0)-(i?.result.Points??0):((t?.result.GradeId??Number.POSITIVE_INFINITY)-(i?.result.GradeId??Number.POSITIVE_INFINITY))*-1};function lr(e,n){return e===n?0:e<n?-1:1}function dr(e){return e.kind==="grade"}function mr(e){return e?.test?.MaxPoints??0}function ur(e){return(e?.test?.MaxPointsAdjusted||e?.test?.MaxPoints)??0}function hr(e){let n=e.map(a=>a.average).filter(a=>a!=null&&a!==0).map(Number);return xe(n)}function gr(e,n){return xe(e.map(a=>Ma(a,n)).filter(yn))}function Ma({gradeId:e,finalGradeValue:n},a){let t;e?t=a.find(d=>d.Key===e)?.Value:t=n;let i=Number(t);return isNaN(i)?0:i}var fr=(()=>{let n=class n extends oe{constructor(){let t=u(It),i=u(ft);super(t,i,An,"Gradings")}updateGrade(t,i){return this.http.put(`${this.baseUrl}/${t}`,{GradeId:i}).pipe(I(()=>t))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();function ki(e,n){return[...n.filter(a=>a.Id!==e?.Id),e].filter(a=>a!=null)}function vr({id:e,selectedGradeId:n},a){return a.map(t=>t.Id!==e?t:A(V({},t),{GradeId:n}))}function Cr(e,n){switch(n.type){case"reset":return n.payload;case"updateResult":return e?A(V({},e),{Tests:Fn(n.payload.testResult,e.Tests||[],n.payload.ignore),Gradings:n.payload.grading?ki(n.payload.grading,e.Gradings||[]):e.Gradings}):null;case"deleteResult":return e?A(V({},e),{Tests:$n(n.payload.testId,n.payload.studentId,e.Tests||[]),Gradings:n.payload.grading?ki(n.payload.grading,e.Gradings||[]):e.Gradings||[]}):null;case"toggle-test-state":return e?A(V({},e),{Tests:Vn(n.payload,e.Tests||[])}):null;case"final-grade-overwritten":return e?A(V({},e),{Gradings:vr({id:n.payload.id,selectedGradeId:n.payload.selectedGradeId},e.Gradings||[])}):null;case"replace-grades":return e?A(V({},e),{Gradings:n.payload}):null;case"delete-test":return e?A(V({},e),{Tests:Bn(n.payload,e.Tests||[])}):null;default:return e}}var Oi={onlyMine:!1,hidePublished:!1},at=(()=>{let n=class n{constructor(){this.coursesRestService=u(yt),this.gradingScalesRestService=u(ii),this.gradingsRestService=u(fr),this.loadingService=u(tt),this.sortService=u(Un),this.action$=new Si(1),this.loading$=this.loadingService.loading$,this._courseId$=new Si(1),this.courseId$=this._courseId$.asObservable(),this.fetchedCourse$=this._courseId$.pipe(G(t=>this.loadingService.load(this.coursesRestService.getExpandedCourse(t))),lt(1)),this.course$=Ee(this.action$,this.fetchedCourse$.pipe(Kt(Lt),I(t=>({type:"reset",payload:t})))).pipe($i(Cr,null),Kt(Lt),lt(1)),this.tests$=this.course$.pipe(I(t=>t.Tests||[]),I(Rn)),this.hasTests$=this.tests$.pipe(I(t=>t.length>0)),this.filterSubject$=new rt(Oi),this.filter$=this.filterSubject$.asObservable(),this.expandedHeaderSubject$=new rt(!1),this.expandedHeader$=this.expandedHeaderSubject$.asObservable(),this.filteredTests$=Z([this.tests$,this.filter$]).pipe(I(([t,i])=>t.filter(r=>(!i.onlyMine||r.IsOwner)&&(!i.hidePublished||!r.IsPublished)))),this.sortCriteria$=this.sortService.sortCriteria$,this.sortCriteria=this.sortService.sortCriteria,this.studentGrades$=Z([this.course$,this.filteredTests$,this.sortCriteria$]).pipe(I(Ut(this.toStudentGrades.bind(this)))),this.canSetFinalGrade$=this.course$.pipe(I(Kn)),this.gradingScaleIds$=this.course$.pipe(I(t=>_n([...(t.Tests??[]).map(i=>i.GradingScaleId),t.GradingScaleId]).filter(Lt)),ot(Ye),lt(1)),this.gradingScales$=this.gradingScaleIds$.pipe(G(t=>this.gradingScalesRestService.getListForIds(t)),lt(1)),this.UNDEFINED_GRADINGSCALE_ID=-1,this.gradingScalesOptions$=this.gradingScales$.pipe(I(t=>t.map(i=>{let r=i?.Id||this.UNDEFINED_GRADINGSCALE_ID,d=i?.Grades.map(f=>({Key:f.Id,Value:f.Designation}))||[];return{id:r,options:d}}).reduce((i,r)=>A(V({},i),{[r.id]:r.options}),{})),lt(1)),this.meanOfStudentGradesForCourse$=this.studentGrades$.pipe(I(t=>hr(Mi(t)))),this.meanOfFinalGradesForCourse$=Z([this.gradingScalesOptions$,this.studentGrades$]).pipe(G(Ut(this.meanOfOverwrittenGradesForCourse.bind(this))))}setCourseId(t){this._courseId$.next(t)}reload(){this._courseId$.pipe(ut(1)).subscribe(t=>{this.setCourseId(t)})}setFilter(t){this.filterSubject$.next(t)}gradingOptionsForTest$(t){return this.gradingOptions$(t.GradingScaleId)}gradingOptionsForCourse$(){return this.course$.pipe(G(t=>this.gradingOptions$(t.GradingScaleId)))}toStudentGrades(t,i=[],r){let d=cr(t.ParticipatingStudents??[],i,t.Gradings??[],t.FinalGrades??[]);return r?d.sort(pr(r,i)):d}toggleHeader(t){this.expandedHeaderSubject$.next(t)}optimisticallyUpdateGrade(t){return this.course$.pipe(ut(1),I(i=>{let{originalResult:r,updatedResult:d}=this.buildOptimisticResultUpdate(i,t);return this.updateTestResult(d,null),r}))}saveGrade(t,i){this.course$.pipe(ut(1),G(r=>this.coursesRestService.updateTestResult(r.Id,t).pipe(Pe(d=>(i&&this.updateTestResult(V({},i),null),Fi(()=>d)))))).subscribe(({testResult:r,grading:d})=>this.updateOrDeleteTestResult(t.testId,t.studentId,r,d,"gradeId"in t?"grade":"points"))}publish(t){this.coursesRestService.publishTest(t.Id).subscribe(this.toggleTestPublishedState.bind(this))}unpublish(t){this.coursesRestService.unpublishTest(t.Id).subscribe(this.toggleTestPublishedState.bind(this))}deleteTest(t){this.action$.next({type:"delete-test",payload:t})}overwriteFinalGrade({id:t,selectedGradeId:i}){this.gradingsRestService.updateGrade(t,i).subscribe(()=>{this.action$.next({type:"final-grade-overwritten",payload:{id:t,selectedGradeId:i}})})}setAveragesAsFinalGrades(t){this.coursesRestService.setAverageAsFinalGrade(t).subscribe(i=>this.action$.next({type:"replace-grades",payload:i.Gradings}))}buildOptimisticResultUpdate(t,i){let r=Gn(t,i.testId,i.studentId),d=r?V({},r):{Id:"",TestId:i.testId,StudentId:i.studentId,CourseRegistrationId:0,GradeId:null,GradeValue:null,GradeDesignation:null,Points:null};return d.GradeId="gradeId"in i?i.gradeId:r?.GradeId??null,d.Points="points"in i?i.points:r?.Points??null,{originalResult:r,updatedResult:d}}updateOrDeleteTestResult(t,i,r,d,f){r?this.updateTestResult(r,d,f):this.deleteTestResult(t,i,d)}updateTestResult(t,i,r){this.action$.next({type:"updateResult",payload:{testResult:t,grading:i??null,ignore:r}})}deleteTestResult(t,i,r){this.action$.next({type:"deleteResult",payload:{testId:t,studentId:i,grading:r}})}toggleTestPublishedState(t){this.action$.next({type:"toggle-test-state",payload:t})}gradingOptions$(t){return t===null?F(null):this.gradingScalesOptions$.pipe(I(i=>i[t]),lt(1))}meanOfOverwrittenGradesForCourse(t,i){return this.course$.pipe(I(r=>{if(r.GradingScaleId===null||t[r.GradingScaleId]===void 0)return null;let d=t[r.GradingScaleId];return gr(Mi(i),d)}))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=X({token:n,factory:n.\u0275fac});let e=n;return e})();var Di="events-evaluation-default-grade-update",ve=(()=>{let n=class n{constructor(){this.gradingItemsRestService=u(pi),this.evaluationStateService=u(vt),this.testStateService=u(at),this.loadingService=u(tt),this.updating=q(this.loadingService.loading(Di),{requireSync:!0}),this.updateQueue$=new nt,this.subscription=this.updateQueue$.pipe(Ie(t=>ct(this,null,function*(){return this.update(t)}))).subscribe()}ngOnDestroy(){this.subscription.unsubscribe()}update(t){return ct(this,null,function*(){let i=this.evaluationStateService.gradingItems().find(d=>d.Id===t.updateElement.Id);if(!i)return console.error("Grading item not found"),!1;let r;t.updateElement.type==="grade"?r=A(V({},i),{IdGrade:t.updateElement.IdGrade}):r=A(V({},i),{Comment:t.updateElement.Comment});try{return yield Ft(this.loadingService.load(this.gradingItemsRestService.update(r.Id,r),Di)),this.testStateService.reload(),this.evaluationStateService.updateGradingItems(this.evaluationStateService.gradingItems().map(d=>d.Id===r.Id?r:d)),F(!0)}catch(d){return console.error("Error updating comment",d),F(!1)}})}updateDefaultGrade(t){return ct(this,null,function*(){let i=this.evaluationStateService.gradingItems().map(d=>A(V({},d),{IdGrade:t})),r=this.evaluationStateService.event();if(!r)return console.error("No event selected"),!1;try{yield Ft(this.loadingService.load(this.gradingItemsRestService.updateForEvent(r.id,i),Di)),this.testStateService.reload()}catch(d){return console.error("Error updating grades",d),!1}return this.evaluationStateService.updateGradingItems(i),!0})}updateGrade(t,i){this.updateQueue$.next({updateElement:{Id:t,IdGrade:i,Comment:null,type:"grade"}})}updateComment(t,i){this.updateQueue$.next({updateElement:{Id:t,IdGrade:null,Comment:i,type:"comment"}})}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=X({token:n,factory:n.\u0275fac});let e=n;return e})();var _r=(()=>{let n=class n{constructor(){this.activeModal=u(Dt),this.gradingScale=k.required(),this.selectedGradeKey=j(null),this.gradeOptions=x(()=>this.gradingScale().Grades.map(t=>({Key:t.Id,Value:t.Designation}))),this.selectedGrade=x(()=>{let t=this.selectedGradeKey();return this.gradingScale().Grades.find(i=>i.Id===t)??null})}updateGrades(){return ct(this,null,function*(){let t=this.selectedGrade();t&&(yield this.updateService.updateDefaultGrade(t.Id).then(()=>this.activeModal.close()))})}cancel(){this.activeModal.dismiss()}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-evaluation-dialog"]],inputs:{gradingScale:[1,"gradingScale"]},decls:20,vars:19,consts:[[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"dropdown-row"],["for","grade"],["id","grade",3,"valueChange","options","value","allowEmpty"],[1,"info-text"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(i,r){i&1&&(s(0,"div",0)(1,"h5",1),c(2),p(3,"translate"),l()(),s(4,"div",2)(5,"div",3)(6,"label",4),c(7),p(8,"translate"),l(),s(9,"bkd-select",5),K("valueChange",function(f){return U(r.selectedGradeKey,f)||(r.selectedGradeKey=f),f}),l()(),s(10,"p",6),c(11),p(12,"translate"),l()(),s(13,"div",7)(14,"button",8),T("click",function(){return r.cancel()}),c(15),p(16,"translate"),l(),s(17,"button",9),T("click",function(){return r.updateGrades()}),c(18),p(19,"translate"),l()()),i&2&&(o(2),v(" ",m(3,9,"evaluation.set-default-modal.title")," "),o(5),S(m(8,11,"evaluation.set-default-modal.grade")),o(2),g("options",r.gradeOptions()),z("value",r.selectedGradeKey),g("allowEmpty",!1),o(2),v(" ",m(12,13,"evaluation.set-default-modal.message")," "),o(4),v(" ",m(16,15,"evaluation.set-default-modal.cancel")," "),o(2),g("disabled",!r.selectedGrade()||r.updateService.updating()),o(),v(" ",m(19,17,"evaluation.set-default-modal.save")," "))},dependencies:[xt,M],styles:[".dropdown-row[_ngcontent-%COMP%]{display:flex;align-items:center}.dropdown-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{flex:1}.dropdown-row[_ngcontent-%COMP%]   bkd-select[_ngcontent-%COMP%]{flex:1}.info-text[_ngcontent-%COMP%]{margin-top:1.5rem}"],changeDetection:0});let e=n;return e})();var br=e=>({returnlink:e}),ka=e=>({count:e});function Oa(e,n){if(e&1&&(s(0,"button",4)(1,"i",7),c(2,"equalizer"),l()()),e&2){let a=h(2);g("routerLink","statistic")("queryParams",$(3,br,a.queryParam()))("disabled",!a.hasGradeEntries())}}function Da(e,n){if(e&1&&(s(0,"div",1),C(1,Oa,3,5,"button",4),y(2,"bkd-reports-link",5)(3,"div",6),l()),e&2){let a=h();o(),_(a.event().gradingScaleId!==null?1:-1),o(),g("reports",a.reports())}}var mi=(()=>{let n=class n{constructor(){this.reportsService=u(de),this.route=u(gt),this.state=u(vt),this.hasGradeEntries=x(()=>this.state.entries().some(t=>(t.grade?.Value??0)>0)),this.event=k.required(),this.showActions=k(!0),this.queryParam=j(this.route.snapshot.queryParamMap.get("returnlink")),this.reports=q(Ot(this.event).pipe(I(t=>t.id),ot(),G(t=>t?this.reportsService.getEvaluationReports(t):F([])),Et([]))),this.returnlink=x(()=>this.showActions()?this.queryParam()?this.queryParam():"/events":`/events/${this.event().id}/evaluation`)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-evaluation-header"]],inputs:{event:[1,"event"],showActions:[1,"showActions"]},decls:8,vars:12,consts:[[3,"link","params"],[1,"d-flex"],[1,"d-flex","flex-column","header"],[1,"additional-info"],[1,"btn","btn-primary","btn-icon","chart-btn",3,"routerLink","queryParams","disabled"],[1,"ms-2",3,"reports"],["id","excel-import"],[1,"material-icons"]],template:function(i,r){if(i&1&&(s(0,"bkd-backlink",0),C(1,Da,4,2,"div",1),l(),s(2,"div",2)(3,"h1"),c(4),l(),s(5,"div",3),c(6),p(7,"translate"),l()()),i&2){g("link",r.returnlink())("params",r.queryParam()&&r.queryParam()!==r.returnlink()?$(8,br,r.queryParam()):null),o(),_(r.showActions()?1:-1),o(3),S(r.event().designation);let d=r.event().studentCount;o(2),v(" ",W(7,5,d===1?"courses.registration":"courses.registrations",$(10,ka,d))," ")}},dependencies:[qt,M,le,it],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem;border-bottom:1px solid #dee2e6}h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}a[_ngcontent-%COMP%]{text-decoration:none;color:#fff}"],changeDetection:0});let e=n;return e})();var Sr=(()=>{let n=class n{constructor(){this.value=pt(null),this.commit=Ht()}onInput(t){let{value:i}=t.target;this.value.set(i||null)}onBlur(){this.commit.emit(this.value()??null)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-grading-item-comment-textarea"]],inputs:{value:[1,"value"]},outputs:{value:"valueChange",commit:"commit"},decls:1,vars:1,consts:[["bkdTextareaAutosize","",1,"form-control",3,"input","blur","value"]],template:function(i,r){i&1&&(s(0,"textarea",0),T("input",function(f){return r.onInput(f)})("blur",function(){return r.onBlur()}),l()),i&2&&g("value",r.value()||"")},dependencies:[qn],styles:["[_nghost-%COMP%]{display:block}textarea[_ngcontent-%COMP%]{min-width:30ch}@media (max-width: 810px){textarea[_ngcontent-%COMP%]{min-width:auto}}"],changeDetection:0});let e=n;return e})();var La=576,zt=(()=>{let n=class n{constructor(){this.portal=u(Wn),this.inlineHeader=k.required(),this.stickyHeader=k.required(),this.handleWindowScroll=()=>{this.updateStickyVisibility(),this.updateStickyTopOffset()},this.handleWindowResize=()=>{this.updateStickyWidth(),this.updateStickyVisibility(),this.updateStickyTopOffset()},this.handleTableScroll=()=>{this.updateStickyLeftOffset()}}ngAfterViewInit(){this.handleWindowScroll(),this.handleTableScroll(),this.handleWindowResize(),this.window.addEventListener("scroll",this.handleWindowScroll),this.getTableScrollContainer()?.addEventListener("scroll",this.handleTableScroll),this.window.addEventListener("resize",this.handleWindowResize)}ngOnDestroy(){this.window.removeEventListener("scroll",this.handleWindowScroll),this.getTableScrollContainer()?.removeEventListener("scroll",this.handleTableScroll),this.window.removeEventListener("resize",this.handleWindowResize)}refresh(){setTimeout(()=>this.updateStickyWidth())}get window(){return this.portal.window??window}getTableScrollContainer(){return document.querySelector(".table-responsive-wrapper")??null}updateStickyVisibility(){if(this.isSmallBreakpointDown())return;let t=this.inlineHeader().getTop()+this.getIframeScrollY();this.stickyHeader().shown.set(this.getScrollTop()>t)}updateStickyTopOffset(){this.isSmallBreakpointDown()||this.stickyHeader().setTopOffset(this.portal.inIframe?this.getScrollTop():0)}updateStickyLeftOffset(){this.isSmallBreakpointDown()||this.stickyHeader().setLeftOffset(this.inlineHeader().getLeft())}updateStickyWidth(){this.isSmallBreakpointDown()||(this.stickyHeader().setWidth(this.inlineHeader().getWidth()),this.stickyHeader().setColumnWidths(this.inlineHeader().getColumnWidths()),this.stickyHeader().setStickyColumnHeights(this.inlineHeader().getStickyColumnsHeights()))}getScrollTop(){return this.window.scrollY-this.portal.getIframeTop()}getIframeScrollY(){return window.scrollY}isSmallBreakpointDown(){return window.innerWidth<La}};n.\u0275fac=function(i){return new(i||n)},n.\u0275dir=ji({type:n,selectors:[["","bkdTableHeaderSticky",""]],inputs:{inlineHeader:[1,"inlineHeader"],stickyHeader:[1,"stickyHeader"]}});let e=n;return e})();var Ga=(e,n)=>n.detail.Id;function Fa(e,n){if(e&1){let a=D();s(0,"bkd-subscription-detail-field",4),K("valueChange",function(i){let r=E(a).$implicit;return U(r.value,i)||(r.value=i),P(i)}),T("commit",function(){let i=E(a).$implicit,r=h(2);return P(r.subscriptionDetailChange.emit(i))}),l()}if(e&2){let a,t=n.$implicit,i=h(2);Y("hide-for-mobile",((a=i.headingDetail())==null?null:a.Id)===t.detail.Id),g("detail",t.detail)("layout","horizontal"),z("value",t.value)}}function $a(e,n){if(e&1&&(s(0,"div",2),B(1,Fa,1,5,"bkd-subscription-detail-field",3,Ga),l()),e&2){let a=h();o(),R(a.entry().criteria)}}var yr=(()=>{let n=class n{constructor(){this.translate=u(J),this.entry=k.required(),this.visible=pt.required(),this.subscriptionDetailChange=Ht(),this.heading=x(()=>this.headingDetail()?.VssDesignation??this.translate.instant("evaluation.set-criteria")),this.headingDetail=x(()=>this.entry().criteria.find(t=>t.detail.VssStyle==="HE")?.detail)}get visibleClass(){return this.visible()}toggle(){this.visible.update(t=>!t)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-evaluation-criteria"]],hostVars:2,hostBindings:function(i,r){i&2&&Y("criteria-visible",r.visibleClass)},inputs:{entry:[1,"entry"],visible:[1,"visible"]},outputs:{visible:"visibleChange",subscriptionDetailChange:"subscriptionDetailChange"},decls:6,vars:3,consts:[[1,"btn","btn-link","criteria-toggle",3,"click"],[1,"material-icons"],[1,"criteria-container"],[3,"detail","hide-for-mobile","layout","value"],[3,"valueChange","commit","detail","layout","value"]],template:function(i,r){i&1&&(s(0,"button",0),T("click",function(){return r.toggle()}),s(1,"i",1),c(2),l(),s(3,"span"),c(4),l()(),C(5,$a,3,0,"div",2)),i&2&&(o(2),S(r.visible()?"keyboard_arrow_up":"keyboard_arrow_down"),o(2),S(r.heading()),o(),_(r.visible()?5:-1))},dependencies:[si],styles:["[_nghost-%COMP%]{display:block;padding:0 1rem 1rem}.criteria-toggle[_ngcontent-%COMP%]{display:flex;padding-left:0;padding-right:0;color:#00000080}.criteria-toggle[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.25rem}.criteria-toggle[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.criteria-toggle[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.criteria-container[_ngcontent-%COMP%]{margin-top:1rem;display:flex;flex-direction:column;gap:1rem}@media (max-width: 810px){.hide-for-mobile[_ngcontent-%COMP%]{display:none}}@media (min-width: 811px){[_nghost-%COMP%]:not(.criteria-visible){padding:0}.criteria-toggle[_ngcontent-%COMP%]{display:none}.criteria-container[_ngcontent-%COMP%]{margin-top:0;gap:.5rem}}"],changeDetection:0});let e=n;return e})();var xr=tn([Ji({IsDelete:Zi}),ie({IdStatus:Wt,Status:Qt})]);var Ce=(()=>{let n=class n{constructor(){this.http=u(It),this.settings=u(ft),this.loadingService=u(tt),this.baseUrl=`${this.settings.apiUrl}/StatusProcesses/`}forwardStatus(t,i){return ct(this,null,function*(){try{let r=yield Ft(this.loadingService.load(this.getStatus(t),wt));return r?(yield Ft(this.loadingService.load(this.updateNextStatus(r,i),wt)),!0):(console.error("No next status found"),!1)}catch(r){return console.error("Error updating status",r),!1}})}getStatusList(t){return this.loadStatus(t).pipe(I(i=>(i=i.filter(r=>!r.IsDelete),[...new Map(i.map(r=>[r.IdStatus,r])).values()])))}updateStatus(t,i,r,d){return this.http.post(this.baseUrl,{DataClassId:t,Id1:i,Id2:r,IdStatus:d})}getStatus(t){return this.http.get(`${this.baseUrl}forward/`,{params:new ee().set("idStatus",t.toString())}).pipe(I(i=>Array.isArray(i)&&i.length>0?i[0]:null))}loadStatus(t){return this.loadingService.load(this.http.get(`${this.baseUrl}/`,{params:new ee().set("idStatus",t.toString())}).pipe(G(Xe(xr))),wt)}updateNextStatus(t,i){return this.http.post(this.baseUrl,A(V({},t),{DataClassId:"Anlass",Id1:i}))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();function Va(e,n){e&1&&(s(0,"div",3)(1,"i",8),c(2,"info"),l(),s(3,"p",9),c(4),p(5,"translate"),l()()),e&2&&(o(4),v(" ",m(5,1,"evaluation.finalise-modal.open-evaluations")," "))}function Ba(e,n){e&1&&(s(0,"p",4),c(1),p(2,"translate"),l()),e&2&&(o(),v(" ",m(2,1,"evaluation.finalise-modal.note")," "))}var Ra=3,wr=(()=>{let n=class n{constructor(){this.activeModal=u(Dt),this.eventsService=u(me),this.loadingService=u(tt),this.evaluationStatusService=u(Ce),this.eventId=j(null),this.hasOpenEvaluations=j(!1),this.loading=q(this.loadingService.loading(wt),{initialValue:!0}),this.eventSummary=q(Ot(this.eventId).pipe(G(t=>t?this.loadEventSummary(t):F(null))),{initialValue:null}),this.isModuleEvent=x(()=>this.eventSummary()?.EventTypeId===Ra)}loadEventSummary(t){return this.loadingService.load(this.eventsService.getEventSummary(t),wt)}cancel(){this.activeModal.dismiss()}confirm(){return ct(this,null,function*(){this.isModuleEvent()?yield this.updateModuleEventStatus():this.activeModal.close(!0)})}updateModuleEventStatus(){return ct(this,null,function*(){let t=this.eventSummary();if(!t)throw new Error("No event available");try{yield this.evaluationStatusService.forwardStatus(t.StatusId,t.Id),this.activeModal.close(!0)}catch(i){console.error("Error updating module event status",i),this.activeModal.close(!1)}})}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-evaluation-finalise-dialog"]],decls:17,vars:15,consts:[[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"text-danger","d-flex","my-3"],[1,"module-event-notice"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"material-icons","me-2"],[1,"mb-0"]],template:function(i,r){i&1&&(s(0,"div",0)(1,"h5",1),c(2),p(3,"translate"),l()(),s(4,"div",2),C(5,Va,6,3,"div",3),s(6,"p"),c(7),p(8,"translate"),l(),C(9,Ba,3,3,"p",4),l(),s(10,"div",5)(11,"button",6),T("click",function(){return r.cancel()}),c(12),p(13,"translate"),l(),s(14,"button",7),T("click",function(){return r.confirm()}),c(15),p(16,"translate"),l()()),i&2&&(o(2),v(" ",m(3,7,"evaluation.finalise-modal.title")," "),o(3),_(r.hasOpenEvaluations()?5:-1),o(2),v(" ",m(8,9,"evaluation.finalise-modal.message")," "),o(2),_(r.isModuleEvent()?9:-1),o(3),v(" ",m(13,11,"evaluation.finalise-modal.cancel")," "),o(2),g("disabled",r.loading()),o(),v(" ",m(16,13,"evaluation.finalise-modal.confirm")," "))},dependencies:[M],encapsulation:2,changeDetection:0});let e=n;return e})();var Aa=1e3,Tr=(()=>{let n=class n{constructor(){this.options=k.required(),this.value=k.required(),this.valueChange=Ht(),this.valueSubject=new nt,this.destroy$=new nt,this.valueSubject.pipe(Me(Aa),Pt(this.destroy$)).subscribe(t=>{this.valueChange.emit(t)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onValueChange(t){this.valueSubject.next(t)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-evaluation-grade"]],inputs:{options:[1,"options"],value:[1,"value"]},outputs:{valueChange:"valueChange"},decls:1,vars:3,consts:[["id","grade",3,"valueChange","options","value","width"]],template:function(i,r){i&1&&(s(0,"bkd-select",0),T("valueChange",function(f){return r.onValueChange(f)}),l()),i&2&&g("options",r.options())("value",r.value())("width","100%")},dependencies:[xt],encapsulation:2,changeDetection:0});let e=n;return e})();var ui=(()=>{let n=class n{get stickyClass(){return this.sticky()}constructor(){this.element=u(Hi),this.sticky=k(!1),this.shown=j(!1),Be(this.updateShownClass.bind(this))}getTop(){return this.element.nativeElement.getBoundingClientRect().top}getLeft(){return this.element.nativeElement.getBoundingClientRect().left}setTopOffset(t){this.element.nativeElement.style.top=`${t}px`}setLeftOffset(t){this.element.nativeElement.style.left=`${t}px`}getWidth(){return this.element.nativeElement.getBoundingClientRect().width}setWidth(t){this.element.nativeElement.style.width=`${t}px`}getColumnWidths(){return this.getRowsAndColumns().map(t=>t.map(i=>i.getBoundingClientRect().width))}setColumnWidths(t){let i=this.getRowsAndColumns();if(i.length!==t.length||!i.every((r,d)=>r.length===t[d].length))throw new Error("Given column widths do not match number of header rows/columns");i.forEach((r,d)=>r.forEach((f,w)=>{f.style.width=`${t[d][w]}px`,f.style.minWidth=`${t[d][w]}px`}))}getStickyColumnsHeights(){return this.getRowsAndColumns(".sticky").map(t=>t.map(i=>i.getBoundingClientRect().height))}setStickyColumnHeights(t){let i=this.getRowsAndColumns(".sticky");if(i.length!==t.length||!i.every((r,d)=>r.length===t[d].length))throw new Error("Given column heights do not match number of sticky header columns");i.forEach((r,d)=>r.forEach((f,w)=>{f.style.height=`${t[d][w]}px`})),this.getRows().forEach((r,d)=>{let f=t[d].reduce((w,Q)=>Math.max(w,Q),0);r.style.height=`${f}px`})}updateShownClass(){let t=this.element.nativeElement.classList;this.shown()?t.add("shown"):t.remove("shown")}getRowsAndColumns(t){return this.getRows().map(i=>Array.from(i.querySelectorAll(`th:not(.header-mobile)${t??""}`)))}getRows(){return Array.from(this.element.nativeElement.querySelectorAll("tr"))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["ng-component"]],hostVars:2,hostBindings:function(i,r){i&2&&Y("sticky",r.stickyClass)},inputs:{sticky:[1,"sticky"]},decls:0,vars:0,template:function(i,r){},encapsulation:2});let e=n;return e})();var Ha=["bkdEvaluationTableHeader",""],ja=(e,n)=>n.vssId;function Wa(e,n){if(e&1){let a=D();s(0,"th",5)(1,"bkd-sortable-header",1),p(2,"translate"),K("sortCriteriaChange",function(i){E(a);let r=h();return U(r.sortCriteria,i)||(r.sortCriteria=i),P(i)}),l()()}if(e&2){let a=h();Y("selected",a.gradeColumnSelected()),o(),g("label",m(2,5,"evaluation.columns.grade"))("sortKey","grade"),z("sortCriteria",a.sortCriteria)}}function Na(e,n){if(e&1&&(s(0,"th",6),c(1),l()),e&2){let a=n.$implicit,t=h();Y("selected",t.isColumnSelected(a)),g("title",a.tooltip??""),o(),v(" ",a.title," ")}}function Ua(e,n){if(e&1&&(s(0,"th",7),c(1),p(2,"translate"),l()),e&2){let a=h();Y("selected",a.commentColumnSelected()),o(),v(" ",m(2,3,"evaluation.columns.comment")," ")}}var Er=(()=>{let n=class n extends ui{constructor(){super(...arguments),this.columns=k.required(),this.sortCriteria=pt.required(),this.selectedColumn=k.required(),this.hasGrades=k.required(),this.hasGradeComments=k(!1),this.gradeColumnSelected=x(()=>this.selectedColumn()===-1),this.commentColumnSelected=x(()=>this.selectedColumn()===-2)}isColumnSelected(t){return t.vssId===this.selectedColumn()}};n.\u0275fac=(()=>{let t;return function(r){return(t||(t=Oe(n)))(r||n)}})(),n.\u0275cmp=b({type:n,selectors:[["thead","bkdEvaluationTableHeader",""]],inputs:{columns:[1,"columns"],sortCriteria:[1,"sortCriteria"],selectedColumn:[1,"selectedColumn"],hasGrades:[1,"hasGrades"],hasGradeComments:[1,"hasGradeComments"]},outputs:{sortCriteria:"sortCriteriaChange"},features:[De],attrs:Ha,decls:8,vars:7,consts:[[1,"student-name"],[3,"sortCriteriaChange","label","sortKey","sortCriteria"],[1,"student-grade","desktop",3,"selected"],[1,"subscription-detail",3,"selected","title"],[1,"student-comment","desktop",3,"selected"],[1,"student-grade","desktop"],[1,"subscription-detail",3,"title"],[1,"student-comment","desktop"]],template:function(i,r){i&1&&(s(0,"tr")(1,"th",0)(2,"bkd-sortable-header",1),p(3,"translate"),K("sortCriteriaChange",function(f){return U(r.sortCriteria,f)||(r.sortCriteria=f),f}),l()(),C(4,Wa,3,7,"th",2),B(5,Na,2,4,"th",3,ja),C(7,Ua,3,5,"th",4),l()),i&2&&(o(2),g("label",m(3,5,"evaluation.columns.name"))("sortKey","name"),z("sortCriteria",r.sortCriteria),o(2),_(r.hasGrades()?4:-1),o(),R(r.columns()),o(2),_(r.hasGradeComments()?7:-1))},dependencies:[M,ue],styles:["[_nghost-%COMP%]{--spacer: 16px;--grade-input-size: 17ch;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (max-width: 810px){th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%], th.subscription-detail[_ngcontent-%COMP%], td.subscription-detail[_ngcontent-%COMP%]{width:66%;min-width:66%;max-width:66%}}@media (max-width: 500px){th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%], th.subscription-detail[_ngcontent-%COMP%], td.subscription-detail[_ngcontent-%COMP%]{width:50%;min-width:50%;max-width:50%}}th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-comment[_ngcontent-%COMP%]:not(.selected), .subscription-detail[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%], tfoot[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.student-grade[_ngcontent-%COMP%], .subscription-detail[_ngcontent-%COMP%], .student-comment[_ngcontent-%COMP%]{flex:none;display:block;width:50%}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}}.sticky[_nghost-%COMP%]{position:fixed;top:0;left:0;z-index:1000;display:none}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;vertical-align:top}tr[_ngcontent-%COMP%]   th.subscription-detail.absences[_ngcontent-%COMP%]{flex:1}@media (min-width: 811px){.sticky.shown[_nghost-%COMP%]{display:table-header-group}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;padding-top:.25rem;padding-bottom:.25rem;border-top:initial}}"],changeDetection:0});let e=n;return e})();var qa=e=>["student",e,"grades"],za=(e,n)=>n.gradingItem.Id,Ka=(e,n)=>n.vssId;function Ya(e,n){if(e&1){let a=D();s(0,"button",18),T("click",function(){E(a);let i=h().$implicit,r=h();return P(r.toggleCriteria(i))}),s(1,"i",19),c(2),l()()}if(e&2){let a=h().$implicit,t=h();o(2),S(t.isCriteriaVisible(a)()?"keyboard_arrow_up":"keyboard_arrow_down")}}function Qa(e,n){e&1&&(s(0,"span",13),c(1),p(2,"translate"),l()),e&2&&(o(),v(" ",m(2,1,"evaluation.required")," "))}function Xa(e,n){if(e&1){let a=D();s(0,"td",20)(1,"bkd-evaluation-grade",21),T("valueChange",function(i){E(a);let r=h().$implicit,d=h();return P(d.updateGrade(i,r.gradingItem.Id))}),l()()}if(e&2){let a=h().$implicit,t=h();Y("selected",t.gradeColumnSelected()),o(),g("options",t.gradeOptions())("value",a.gradingItem.IdGrade)}}function Za(e,n){if(e&1){let a=D();H(0),s(1,"bkd-subscription-detail-field",24),K("valueChange",function(i){E(a);let r=L(0);return U(r,i),P(i)}),T("commit",function(){E(a);let i=h().$implicit,r=h(2);return P(r.subscriptionDetailChange.emit(i))}),l()}if(e&2){let a=h().$implicit,t=N(h(2).getDetailValue(a));o(),g("detail",a.detail)("hideLabel",!0)("layout","horizontal"),z("value",t)}}function Ja(e,n){if(e&1&&(s(0,"td",22),C(1,Za,2,5,"bkd-subscription-detail-field",23),l()),e&2){let a=n.$implicit,t=h(2);Y("selected",t.isColumnSelected(a)),o(),_(a?1:-1)}}function to(e,n){if(e&1){let a=D();s(0,"td",25)(1,"bkd-grading-item-comment-textarea",26),K("valueChange",function(i){E(a);let r=h().$implicit;return U(r.gradingItem.Comment,i)||(r.gradingItem.Comment=i),P(i)}),T("commit",function(i){E(a);let r=h().$implicit,d=h();return P(d.updateComment(i,r.gradingItem.Id))}),l()()}if(e&2){let a=h().$implicit,t=h();Y("selected",t.commentColumnSelected()),o(),z("value",a.gradingItem.Comment)}}function eo(e,n){if(e&1){let a=D();s(0,"tr",17)(1,"td"),H(2),s(3,"bkd-evaluation-criteria",27),K("visibleChange",function(i){E(a);let r=L(2);return U(r,i),P(i)}),T("subscriptionDetailChange",function(i){E(a);let r=h(2);return P(r.subscriptionDetailChange.emit(i))}),l()()()}if(e&2){let a=h().$implicit,t=h();o(),bt("colspan",t.totalColumns()),o();let i=N(t.isCriteriaVisible(a));o(),g("entry",a),z("visible",i)}}function io(e,n){if(e&1){let a=D();s(0,"tr",8),T("click",function(i){E(a);let r=h();return P(r.onRowClick(i))}),s(1,"td",9)(2,"div",10),C(3,Ya,3,1,"button",11),s(4,"a",12)(5,"span"),c(6),l(),C(7,Qa,3,3,"span",13),l()()(),C(8,Xa,2,4,"td",14),B(9,Ja,2,3,"td",15,Ni),C(11,to,2,3,"td",16),l(),C(12,eo,4,4,"tr",17)}if(e&2){let a=n.$implicit,t=h();o(3),_(a.criteria.length>0?3:-1),o(),g("routerLink",$(7,qa,a.gradingItem.IdPerson)),o(2),S(a.gradingItem.PersonFullname),o(),_(a.evaluationRequired?7:-1),o(),_(t.hasGrades()?8:-1),o(),R(a.columns),o(2),_(t.hasGradeComments()?11:-1),o(),_(a.criteria.length>0?12:-1)}}function no(e,n){if(e&1&&y(0,"td",22),e&2){let a=n.$implicit,t=h(2);Y("selected",t.isColumnSelected(a))}}function ro(e,n){if(e&1&&y(0,"td",25),e&2){let a=h(2);Y("selected",a.commentColumnSelected())}}function ao(e,n){if(e&1&&(s(0,"td",9),c(1),p(2,"translate"),l(),s(3,"td",20),c(4),p(5,"decimalOrDash"),l(),B(6,no,1,2,"td",15,Ka),C(8,ro,1,2,"td",16)),e&2){let a=h();o(),v(" ",m(2,5,"evaluation.average")," "),o(2),Y("selected",a.gradeColumnSelected()),o(),v(" ",W(5,7,a.gradesAverage(),"1-3")," "),o(2),R(a.columns()),o(2),_(a.hasGradeComments()?8:-1)}}var Pr=(()=>{let n=class n{constructor(){this.state=u(vt),this.gradingItemUpdateService=u(ve),this.subscriptionDetailUpdateService=u(fe),this.modalService=u(Gt),this.router=u(kt),this.sortCriteria=pt.required(),this.selectedColumn=k.required(),this.columns=k.required(),this.entries=k.required(),this.hasGrades=k.required(),this.hasGradeComments=k.required(),this.subscriptionDetailChange=Ht(),this.gradingScale=k.required(),this.gradeColumnSelected=x(()=>this.selectedColumn()===-1),this.commentColumnSelected=x(()=>this.selectedColumn()===-2),this.gradesAverage=x(()=>this.getGradesAverage(this.entries())),this.totalColumns=x(()=>1+(this.hasGrades()?1:0)+(this.hasGradeComments()?1:0)+this.columns().length),this.hasPendingRequests=x(()=>this.gradingItemUpdateService.updating()||this.subscriptionDetailUpdateService.updating()),this.criteriaVisibilities=Yt({source:this.entries,computation:(t,i)=>t.reduce((r,d)=>{let f=i?.value&&i.value[d.gradingItem.Id]||j(!1);return A(V({},r),{[d.gradingItem.Id]:f})},{})}),this.sticky=Re(zt),this.gradeOptions=x(()=>this.gradingScale()?.Grades.map(t=>({Key:t.Id,Value:t.Designation}))),Be(()=>{this.columns(),this.sticky()?.refresh()})}isColumnSelected(t){return t?this.getColumnKey(t)===this.selectedColumn():!1}getDetailValue(t){return t?t.value??j(null):j(null)}isCriteriaVisible(t){return this.criteriaVisibilities()[t.gradingItem.Id]??j(!1)}toggleCriteria(t){this.criteriaVisibilities()[t.gradingItem.Id]?.update(i=>!i)}onRowClick(t){let i=t.target;i.tagName==="TD"&&i.closest("tr")?.querySelector("button.criteria-toggle")?.click()}getColumnKey(t){return"detail"in t?t.detail.VssId:t.vssId}getGradesAverage(t){let i=t.map(({grade:r})=>r?.Value).filter(r=>r!=null&&r!==0);return xe(i)}updateGrade(t,i){this.gradingItemUpdateService.updateGrade(i,t)}updateComment(t,i){this.gradingItemUpdateService.updateComment(i,t)}openFinaliseEvaluationDialog(){let t=this.modalService.open(wr),i=t.componentInstance;i.eventId.set(this.state.event()?.id??null);let r=this.entries().some(d=>d.evaluationRequired);i.hasOpenEvaluations.set(r),t.result.then(d=>ct(this,null,function*(){d&&(yield this.router.navigate(["events"]))}),()=>{})}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-evaluation-table"]],viewQuery:function(i,r){i&1&&$e(r.sticky,zt,5),i&2&&Ve()},inputs:{sortCriteria:[1,"sortCriteria"],selectedColumn:[1,"selectedColumn"],columns:[1,"columns"],entries:[1,"entries"],hasGrades:[1,"hasGrades"],hasGradeComments:[1,"hasGradeComments"],gradingScale:[1,"gradingScale"]},outputs:{sortCriteria:"sortCriteriaChange",subscriptionDetailChange:"subscriptionDetailChange"},decls:16,vars:20,consts:[["inlineHeader",""],["stickyHeader",""],[1,"table-responsive-wrapper"],["bkdTableHeaderSticky","",1,"table","table-hover","h-100",3,"inlineHeader","stickyHeader"],["bkdEvaluationTableHeader","",3,"sortCriteriaChange","columns","sortCriteria","selectedColumn","hasGrades","hasGradeComments"],["bkdEvaluationTableHeader","",3,"sortCriteriaChange","sticky","columns","sortCriteria","selectedColumn","hasGrades","hasGradeComments"],[1,"action-buttons"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[3,"click"],[1,"student-name"],[1,"d-flex"],[1,"btn","btn-link","criteria-toggle"],[3,"routerLink"],[1,"open-evaluations"],[1,"student-grade",3,"selected"],[1,"subscription-detail",3,"selected"],[1,"student-comment",3,"selected"],[1,"criteria"],[1,"btn","btn-link","criteria-toggle",3,"click"],[1,"material-icons"],[1,"student-grade"],[3,"valueChange","options","value"],[1,"subscription-detail"],[3,"detail","hideLabel","layout","value"],[3,"valueChange","commit","detail","hideLabel","layout","value"],[1,"student-comment"],[3,"valueChange","commit","value"],[3,"visibleChange","subscriptionDetailChange","entry","visible"]],template:function(i,r){if(i&1){let d=D();s(0,"div",2)(1,"table",3)(2,"thead",4,0),K("sortCriteriaChange",function(w){return E(d),U(r.sortCriteria,w)||(r.sortCriteria=w),P(w)}),l(),s(4,"thead",5,1),K("sortCriteriaChange",function(w){return E(d),U(r.sortCriteria,w)||(r.sortCriteria=w),P(w)}),l(),s(6,"tbody"),B(7,io,13,9,null,null,za),l(),s(9,"tfoot")(10,"tr"),C(11,ao,9,10),l()()(),s(12,"div",6)(13,"button",7),T("click",function(){return E(d),P(r.openFinaliseEvaluationDialog())}),c(14),p(15,"translate"),l()()()}if(i&2){let d=St(3),f=St(5);o(),g("inlineHeader",d)("stickyHeader",f),o(),g("columns",r.columns()),z("sortCriteria",r.sortCriteria),g("selectedColumn",r.selectedColumn())("hasGrades",r.hasGrades())("hasGradeComments",r.hasGradeComments()),o(2),g("sticky",!0)("columns",r.columns()),z("sortCriteria",r.sortCriteria),g("selectedColumn",r.selectedColumn())("hasGrades",r.hasGrades())("hasGradeComments",r.hasGradeComments()),o(3),R(r.entries()),o(4),_(r.hasGrades()?11:-1),o(),Y("mobile-finalise-visible",r.gradeColumnSelected()||!r.hasGrades()),o(),g("disabled",r.hasPendingRequests()),o(),v(" ",m(15,18,"evaluation.finalise")," ")}},dependencies:[it,M,Er,zt,ni,si,yr,Tr,Sr],styles:["[_nghost-%COMP%]{--spacer: 16px;--grade-input-size: 17ch;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (max-width: 810px){th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%], th.subscription-detail[_ngcontent-%COMP%], td.subscription-detail[_ngcontent-%COMP%]{width:66%;min-width:66%;max-width:66%}}@media (max-width: 500px){th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%], th.subscription-detail[_ngcontent-%COMP%], td.subscription-detail[_ngcontent-%COMP%]{width:50%;min-width:50%;max-width:50%}}th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-comment[_ngcontent-%COMP%]:not(.selected), .subscription-detail[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%], tfoot[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.student-grade[_ngcontent-%COMP%], .subscription-detail[_ngcontent-%COMP%], .student-comment[_ngcontent-%COMP%]{flex:none;display:block;width:50%}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}}[_nghost-%COMP%]{border-top:1px solid #dee2e6;display:block}td[_ngcontent-%COMP%]{vertical-align:top}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]{padding-top:1.25rem}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;gap:.25rem;text-decoration:none;font-size:1rem;line-height:1.25;height:2.59375rem}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{text-decoration:underline}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span.open-evaluations[_ngcontent-%COMP%]{color:#ea161f;font-size:.875rem;line-height:1.25}tr.criteria[_ngcontent-%COMP%]:hover > *[_ngcontent-%COMP%]{--bs-table-bg-state: $table-body-bg}tr.criteria[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:0;width:100%}tr.criteria[_ngcontent-%COMP%]   td[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}tr[_ngcontent-%COMP%]:has(+tr.criteria)   td[_ngcontent-%COMP%]{border-bottom:0}button.criteria-toggle[_ngcontent-%COMP%]{display:none}.action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:1rem;padding-right:1rem}@media (min-width: 811px){.table-responsive-wrapper[_ngcontent-%COMP%]{display:block;overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.action-buttons[_ngcontent-%COMP%]{position:sticky;left:0}tr.criteria[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{width:auto}button.criteria-toggle[_ngcontent-%COMP%]{flex:none;display:block;margin:-.5rem 0 -.5rem -.5rem;padding:.5rem;cursor:pointer}  bkd-subscription-detail-label{min-width:auto!important;width:calc(var(--student-name-column-width) - 1rem)!important}}@media (max-width: 810px){.action-buttons[_ngcontent-%COMP%]:not(.mobile-finalise-visible){display:none}}"],changeDetection:0});let e=n;return e})();var oo=e=>({"grade-column-selected":e});function so(e,n){e&1&&y(0,"bkd-spinner")}function lo(e,n){e&1&&(s(0,"p",1),c(1),p(2,"translate"),l()),e&2&&(o(),S(m(2,1,"evaluation.no-event")))}function co(e,n){e&1&&(s(0,"p",1),c(1),p(2,"translate"),l()),e&2&&(o(),S(m(2,1,"evaluation.no-items")))}function po(e,n){e&1&&(s(0,"p",1),c(1),p(2,"translate"),l()),e&2&&(o(),S(m(2,1,"evaluation.no-evaluation")))}function mo(e,n){e&1&&(s(0,"p",1),c(1),p(2,"translate"),l()),e&2&&(o(),v(" ",m(2,1,"evaluation.review-started")," "))}function uo(e,n){if(e&1){let a=D();s(0,"bkd-select",6),K("valueChange",function(i){E(a);let r=h(4);return U(r.selectedColumn,i)||(r.selectedColumn=i),P(i)}),l()}if(e&2){let a=h(4);g("options",a.columnOptions()),z("value",a.selectedColumn),g("allowEmpty",!1)}}function ho(e,n){if(e&1){let a=D();s(0,"a",7),T("click",function(){E(a);let i=h(4);return P(i.openDefaultGradeDialog())}),s(1,"i",8),c(2,"edit"),l(),s(3,"span"),c(4),p(5,"translate"),l()()}if(e&2){let a=h(4);g("ngClass",$(4,oo,a.selectedColumn()===a.GRADE_COLUMN)),o(4),S(m(5,2,"evaluation.set-default-modal.title"))}}function go(e,n){if(e&1){let a=D();C(0,uo,1,3,"bkd-select",3),C(1,ho,6,6,"a",4),s(2,"bkd-evaluation-table",5),K("sortCriteriaChange",function(i){E(a);let r=h(3);return U(r.state.sortCriteria,i)||(r.state.sortCriteria=i),P(i)}),T("subscriptionDetailChange",function(i){E(a);let r=h(3);return P(r.updateSubscriptionDetail(i))}),l()}if(e&2){h();let a=L(1),t=h(2);_(t.columnOptions().length>1?0:-1),o(),_(t.hasGrades()?1:-1),o(),z("sortCriteria",t.state.sortCriteria),g("columns",t.state.columns())("entries",a)("selectedColumn",t.selectedColumn())("hasGrades",t.hasGrades())("hasGradeComments",t.hasGradeComments())("gradingScale",t.state.gradingScale())}}function fo(e,n){if(e&1&&(y(0,"bkd-evaluation-header",2),H(1),C(2,co,3,3,"p",1)(3,po,3,3,"p",1)(4,mo,3,3,"p",1)(5,go,3,9)),e&2){let a=h(2),t=L(0);g("event",t),o();let i=N(a.state.entries());o(),_(i.length===0?2:a.state.noEvaluation()?3:a.state.hasReviewStarted()?4:5)}}function vo(e,n){if(e&1&&C(0,fo,6,3),e&2){h();let a=L(0);_(a?0:-1)}}var Ir=(()=>{let n=class n{constructor(){this.state=u(vt),this.updateDefaultGradeService=u(ve),this.updateSubscriptionDetailService=u(fe),this.translate=u(J),this.modalService=u(Gt),this.GRADE_COLUMN=-1,this.hasGrades=x(()=>this.state.gradingScale()!==null),this.hasGradeComments=x(()=>this.state.gradingScale()?.CommentsAllowed===!0),this.columnOptions=x(()=>{let t={Key:-1,Value:this.translate.instant("evaluation.columns.grade")},i={Key:-2,Value:this.translate.instant("evaluation.columns.comment")},r=Qe(this.state.columns().map(({vssId:d,title:f})=>({Key:d,Value:f})),d=>d.Key);return[this.hasGrades()?t:null,...r,this.hasGradeComments()?i:null].filter(Lt)}),this.selectedColumn=Yt({source:this.columnOptions,computation:(t,i)=>{let r=i?.source,d=i?.value;return Ye(t,r)&&d&&t.find(f=>f.Key===d)?d:t.length>0?Number(t[0].Key):null}})}openDefaultGradeDialog(){let t=this.modalService.open(_r);t.componentInstance.gradingScale=this.state.gradingScale,t.componentInstance.updateService=this.updateDefaultGradeService,t.result.then(()=>{},()=>{})}updateSubscriptionDetail(t){this.updateSubscriptionDetailService.updateSubscriptionDetail(t)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-evaluation-list"]],decls:5,vars:2,consts:[[1,"bkd-container"],[1,"mt-3","px-3"],[3,"event"],["width","100%",1,"columns-dropdown",3,"options","value","allowEmpty"],[1,"set-default","btn","btn-link","my-1",3,"ngClass"],[3,"sortCriteriaChange","subscriptionDetailChange","sortCriteria","columns","entries","selectedColumn","hasGrades","hasGradeComments","gradingScale"],["width","100%",1,"columns-dropdown",3,"valueChange","options","value","allowEmpty"],[1,"set-default","btn","btn-link","my-1",3,"click","ngClass"],[1,"material-icons"]],template:function(i,r){if(i&1&&(H(0),s(1,"div",0),C(2,so,1,0,"bkd-spinner")(3,lo,3,3,"p",1)(4,vo,1,1),l()),i&2){let d=N(r.state.event());o(2),_(r.state.loading()?2:d?4:3)}},dependencies:[M,mi,Pr,st,xt,ht],styles:[".columns-dropdown[_ngcontent-%COMP%]{display:block;padding:1rem 0}.set-default[_ngcontent-%COMP%]{color:#00000080;padding-right:1.5rem;display:flex;width:max-content;text-decoration:none;padding-left:1rem}.set-default[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.set-default[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.set-default[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.3em}@media (min-width: 811px){.columns-dropdown[_ngcontent-%COMP%]{display:none}}@media (max-width: 810px){.set-default[_ngcontent-%COMP%]:not(.grade-column-selected){display:none}}"],changeDetection:0});let e=n;return e})();var Co=["chartWrapper"],_o=["chartLegend"],bo=["xAxisLabel"],Mr=e=>({"margin-left":e}),kr=(e,n)=>n.text,So=(e,n)=>n.value,yo=(e,n)=>n.text+"-"+n.x;function xo(e,n){if(e&1&&(s(0,"div",6),Zt(),s(1,"svg",15),y(2,"rect",15),l(),yi(),s(3,"span",12),c(4),l()()),e&2){let a=n.$implicit;o(2),bt("class",a.colorClass),o(2),v(" ",a.text," ")}}function wo(e,n){if(e&1&&(Zt(),y(0,"rect")),e&2){let a=n.$implicit;bt("x",a.x)("y",a.y)("width",a.width)("height",a.height)("class",a.colorClass)}}function To(e,n){if(e&1&&(Zt(),s(0,"text",11),c(1),l()),e&2){let a=n.$implicit;bt("x",a.x)("y",a.y),o(),v(" ",a.text," ")}}function Eo(e,n){if(e&1&&(Zt(),s(0,"text",12),c(1),l()),e&2){let a=n.$implicit;bt("x",a.x)("y",a.y)("text-anchor",a.textAnchor),o(),v(" ",a.text," ")}}function Po(e,n){if(e&1&&(s(0,"div",5,0),B(2,xo,5,2,"div",6,kr),l(),s(4,"div",7,1)(6,"div",8),Zt(),s(7,"svg")(8,"g"),y(9,"line",9)(10,"line",10),B(11,wo,1,5,":svg:rect",null,So),B(13,To,2,3,":svg:text",11,yo),B(15,Eo,2,4,":svg:text",12,kr),s(17,"text",13),c(18),p(19,"translate"),l()()()()(),yi(),s(20,"div",14,2)(22,"span",12),c(23),p(24,"translate"),l()()),e&2){let a=h();g("ngClass",a.overflowClass())("ngStyle",$(20,Mr,a.isOverflowing()?"unset":a.legendPosition()+"px")),o(2),R(a.legendLabels()),o(5),bt("width",a.renderedChartWidth())("viewBox",a.viewBox()),o(),bt("transform","translate("+a.chartMargin().left+","+a.chartMargin().top+")"),o(),bt("y2",a.chartInnerHeight()),o(),bt("y1",a.chartInnerHeight())("x2",a.chartInnerWidth())("y2",a.chartInnerHeight()),o(),R(a.bars()),o(2),R(a.barLabels()),o(2),R(a.xLabels()),o(2),bt("transform","rotate(-90)")("x",-(a.chartInnerHeight()/2))("y",-a.chartMargin().left+15),o(),v(" ",m(19,16,"evaluation.chart.amount")," "),o(2),g("ngClass",a.overflowClass())("ngStyle",$(22,Mr,a.isOverflowing()?"unset":a.xAxisLabelPosition()+"px")),o(3),S(m(24,18,"evaluation.chart.grade"))}}function Io(e,n){e&1&&(s(0,"div",4),c(1),p(2,"translate"),l()),e&2&&(o(),v(" ",m(2,1,"evaluation.chart.no-items")," "))}var Or=(()=>{let n=class n{constructor(){this.entries=k.required(),this.gradingScale=k.required(),this.translate=u(J),this.chartWidth=j(600),this.minChartWidth=j(300),this.chartHeight=j(350),this.chartMargin=j({top:5,right:25,bottom:25,left:25}),this.minBarWidth=j(20),this.maxBarWidth=j(25),this.barPaddingFactor=j(.7),this.barCountForSmallerWidth=j(25),this.currentChartWidth=j(0),this.currentScrollWidth=j(0),this.legendWidth=j(0),this.xAxisLabelWidth=j(0),this.isOverflowing=x(()=>this.currentScrollWidth()>this.currentChartWidth()),this.overflowClass=x(()=>this.isOverflowing()?"is-overflowing":""),this.hasData=x(()=>this.chartData().length>0),this.chartInnerWidth=x(()=>{let i=this.chartData().length;if(i===0)return this.minChartWidth();let r=i*(this.maxBarWidth()/this.barPaddingFactor());return Math.max(this.minChartWidth(),r)}),this.chartInnerHeight=x(()=>this.chartHeight()-this.chartMargin().top-this.chartMargin().bottom),this.renderedChartWidth=x(()=>this.chartInnerWidth()+this.chartMargin().left+this.chartMargin().right),this.legendPosition=x(()=>(this.renderedChartWidth()-this.legendWidth())/2),this.xAxisLabelPosition=x(()=>(this.renderedChartWidth()-this.xAxisLabelWidth())/2),this.viewBox=x(()=>`0 0 ${this.renderedChartWidth()} ${this.chartHeight()}`),this.bars=x(()=>{let t=this.chartData(),i=this.xScaleBar(),r=this.yScaleLinear();return t.length===0?[]:t.map((d,f)=>{let w=i.step*f+(i.step-i.barWidth)/2,Q=this.scaleY(d.Count,r.domain,r.range),Tt=this.chartInnerHeight()-Q,Xt=i.barWidth,mt=d.Sufficient?"bar-sufficient":"bar-insufficient";return{x:w,y:Q,width:Xt,height:Tt,colorClass:mt,value:d.Value,count:d.Count}})}),this.xLabels=x(()=>{let t=this.chartData(),i=this.xScaleBar(),r=this.chartInnerHeight();if(t.length===0)return[];let d=[];return t.forEach((f,w)=>{let Q=i.step*w+i.step/2,Tt=r+18;d.push({x:Q,y:Tt,text:f.Value.toString(),textAnchor:"middle"})}),d}),this.barLabels=x(()=>this.bars().map(t=>({x:t.x+t.width/2,y:t.y-5,text:t.count.toString()}))),this.legendLabels=x(()=>{let t=this.chartMargin().top/2;return[{text:this.translate.instant("evaluation.chart.unsufficient"),colorClass:"bar-insufficient",x:this.renderedChartWidth()/2-80,y:t},{text:this.translate.instant("evaluation.chart.sufficient"),colorClass:"bar-sufficient",x:this.renderedChartWidth()/2+50,y:t}]}),this.chartData=x(()=>{let t=this.gradingScale();if(!t||t.Grades.length===0||this.entries().length===0)return[];let i=this.countGrades();return t.Grades.map(r=>({Value:r.Value,Count:i.get(r.Value)||0,Sufficient:r.Sufficient,Sort:r.Sort||r.Value.toString().padStart(2,"0")})).filter(r=>r.Value>0).filter(r=>r.Count>0).sort((r,d)=>d.Sort.localeCompare(r.Sort))}),this.xScaleBar=x(()=>{if(this.chartData().length===0)return{domain:[],range:[0,0],step:0,barWidth:0};let t=this.chartData().map(Q=>Q.Value),i=[0,this.chartInnerWidth()],r=this.chartData().length,d=0,f=0,w=this.chartInnerWidth()/r*this.barPaddingFactor();return w>this.maxBarWidth()?d=this.maxBarWidth():r>=this.barCountForSmallerWidth()?d=this.minBarWidth():d=w,f=this.chartInnerWidth()/r,{domain:t,range:i,step:f,barWidth:d}}),this.yScaleLinear=x(()=>{if(this.chartData().length===0)return{domain:[0,0],range:[0,0]};let i=[0,Math.max(...this.chartData().map(d=>d.Count),0)*1.1],r=[this.chartInnerHeight(),0];return{domain:i,range:r}})}ngAfterViewInit(){let t=this.chartWrapper?.nativeElement,i=this.chartLegend?.nativeElement,r=this.xAxisLabel?.nativeElement;t&&(this.currentChartWidth.set(Math.round(t.clientWidth)),this.currentScrollWidth.set(Math.round(t.scrollWidth)),this.legendWidth.set(Math.round(i?.clientWidth??0)),this.xAxisLabelWidth.set(Math.round(r?.clientWidth??0)),this.resizeObserver=new ResizeObserver(d=>{for(let f of d)this.currentChartWidth.set(Math.round(f.contentRect.width)),this.currentScrollWidth.set(Math.round(f.target.scrollWidth))}),this.resizeObserver.observe(t))}ngOnDestroy(){this.resizeObserver&&this.resizeObserver.disconnect()}countGrades(){return this.entries().reduce((t,{grade:i})=>{let r=i?.Value;return r==null?t:t.set(r,(t.get(r)??0)+1)},new Map)}scaleY(t,i,r){let[d,f]=i,[w,Q]=r;return f===d?w:w-(t-d)/(f-d)*(w-Q)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-evaluation-chart"]],viewQuery:function(i,r){if(i&1&&(Le(Co,5),Le(_o,5),Le(bo,5)),i&2){let d;Ge(d=Fe())&&(r.chartWrapper=d.first),Ge(d=Fe())&&(r.chartLegend=d.first),Ge(d=Fe())&&(r.xAxisLabel=d.first)}},inputs:{entries:[1,"entries"],gradingScale:[1,"gradingScale"]},decls:3,vars:1,consts:[["chartLegend",""],["chartWrapper",""],["xAxisLabel",""],[1,"chart-container","mt-3"],[1,"no-data-message"],[1,"chart-legend",3,"ngClass","ngStyle"],[1,"legend-item"],[1,"chart-wrapper"],["id","chart",1,"chart"],["x1","0","y1","0","x2","0",1,"axis"],["x1","0",1,"axis"],["text-anchor","middle",1,"label","bar-label"],[1,"label"],["text-anchor","middle",1,"label"],[1,"x-axis-label",3,"ngClass","ngStyle"],["width","10","height","10"]],template:function(i,r){i&1&&(s(0,"div",3),C(1,Po,25,24)(2,Io,3,3,"div",4),l()),i&2&&(o(),_(r.hasData()?1:2))},dependencies:[ht,Yi,M],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%}.chart-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:100%;height:auto;font-family:sans-serif;box-sizing:border-box;justify-content:center}.chart-legend[_ngcontent-%COMP%], .x-axis-label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;align-self:flex-start;height:1.5em}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:baseline;padding:0 5px}.legend-item[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:0 2px}.chart-wrapper[_ngcontent-%COMP%]{width:100%;height:auto;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow-x:auto;overflow-y:hidden}.chart[_ngcontent-%COMP%]{height:100%;align-self:flex-start}svg[_ngcontent-%COMP%]{display:block;height:100%}.axis[_ngcontent-%COMP%]{stroke:#495057;stroke-width:1}.bar-sufficient[_ngcontent-%COMP%]{fill:#3d8608}.bar-insufficient[_ngcontent-%COMP%]{fill:#ea161f}.bar-label[_ngcontent-%COMP%]{font-weight:700}.no-data-message[_ngcontent-%COMP%]{text-align:center;padding:20px}.is-overflowing[_ngcontent-%COMP%]{align-self:center}"],changeDetection:0});let e=n;return e})();function Mo(e,n){e&1&&y(0,"bkd-spinner")}function ko(e,n){e&1&&(s(0,"p",1),c(1),p(2,"translate"),l()),e&2&&(o(),S(m(2,1,"evaluation.no-event")))}function Oo(e,n){if(e&1&&(y(0,"bkd-evaluation-header",2),s(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),c(5),p(6,"translate"),l(),s(7,"div",7),c(8),l()(),s(9,"div",5)(10,"div",6),c(11),p(12,"translate"),l(),s(13,"div",7),c(14),l()(),s(15,"div",5)(16,"div",6),c(17),p(18,"translate"),l(),s(19,"div",7),c(20),l()(),s(21,"div",5)(22,"div",6),c(23),p(24,"translate"),l(),s(25,"div",7),c(26),l()(),s(27,"div",5)(28,"div",6),c(29),p(30,"translate"),l(),s(31,"div",7),c(32),l()(),s(33,"div",5)(34,"div",6),c(35),p(36,"translate"),l(),s(37,"div",7),c(38),l()()(),y(39,"bkd-evaluation-chart",8),l()),e&2){let a=h(2),t=L(0);g("event",t)("showActions",!1),o(5),v(" ",m(6,16,"evaluation.statistics.average")," "),o(3),v(" ",a.average()," "),o(3),v(" ",m(12,18,"evaluation.statistics.standard-deviation")," "),o(3),S(a.standardDeviation()),o(3),v(" ",m(18,20,"evaluation.statistics.amount-of-notes")," "),o(3),v(" ",a.entries().length," "),o(3),v(" ",m(24,22,"evaluation.statistics.highest-note")," "),o(3),S(a.highestGrade()),o(3),v(" ",m(30,24,"evaluation.statistics.lowest-note")," "),o(3),S(a.lowestGrade()),o(3),v(" ",m(36,26,"evaluation.statistics.unsufficient")," "),o(3),S(a.unsufficientCount()),o(),g("entries",a.state.entries())("gradingScale",a.state.gradingScale())}}function Do(e,n){if(e&1&&C(0,Oo,40,28),e&2){h();let a=L(0);_(a?0:-1)}}var Dr=(()=>{let n=class n{constructor(){this.state=u(vt),this.entries=x(()=>this.state.entries().filter(t=>t.grade?.Value!=null&&t.grade.Value>0)),this.average=x(()=>this.entries().length===0?0:vn(gn(this.entries(),t=>t.grade?.Value??0),2)),this.standardDeviation=x(()=>{if(this.entries().length<=1)return 0;let t=Cn(Ke(this.entries(),i=>Math.pow((i.grade?.Value??0)-this.average(),2)));return Number(Math.sqrt(t/this.entries().length).toFixed(2))}),this.highestGrade=x(()=>this.findGrade(!0)),this.lowestGrade=x(()=>this.findGrade(!1)),this.unsufficientCount=x(()=>this.entries().filter(t=>!t.grade?.Sufficient).length)}findGrade(t){if(this.entries().length===0)return"-";let i=this.state.gradingScale()?.RisingGrades;return i&&t||!i&&!t?hn(Ke(this.entries(),d=>d.grade?.Value??0)):fn(Ke(this.entries(),d=>d.grade?.Value??0))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-evaluation-statistic"]],decls:5,vars:2,consts:[[1,"bkd-container"],[1,"mt-3","px-3"],[3,"event","showActions"],[1,"d-flex","flex-column"],[1,"statistic-values","px-3"],[1,"row"],[1,"col-8","col-sm-4","col-md-3","col-lg-2"],[1,"col"],[3,"entries","gradingScale"]],template:function(i,r){if(i&1&&(H(0),s(1,"div",0),C(2,Mo,1,0,"bkd-spinner")(3,ko,3,3,"p",1)(4,Do,1,1),l()),i&2){let d=N(r.state.event());o(2),_(r.state.loading()?2:d?4:3)}},dependencies:[M,mi,Or,st],styles:[".statistic-values[_ngcontent-%COMP%]{padding-bottom:1rem;padding-top:1rem;border-bottom:1px solid #dee2e6}"],changeDetection:0});let e=n;return e})();var Lr=(()=>{let n=class n{};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-evaluation"]],features:[dt([vt,ve,fe])],decls:1,vars:0,template:function(i,r){i&1&&y(0,"router-outlet")},dependencies:[Mt],encapsulation:2,changeDetection:0});let e=n;return e})();var Gr=(()=>{let n=class n extends oe{constructor(){let t=u(It),i=u(ft);super(t,i,In,"ApprenticeshipContracts")}getCompaniesForStudents(t){if(t.length===0)return F([]);let i=new Date,r={"filter.StudentId":`;${t.join(";")}`,"filter.ApprenticeshipDateFrom":`<${i.toISOString()}`,"filter.ApprenticeshipDateTo":`>${i.toISOString()}`,fields:"Id,StudentId,CompanyName,CompanyNameAddition"};return this.http.get(`${this.baseUrl}/`,{params:r}).pipe(G(Xe(Mn)))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();function Fr(e,n,a){n||Bi(e);let t=n??u(Ai);return a?Vi(t,a):t}function Te(e,n){let a=Fr(Te,n?.injector),t;return x(()=>(t||(t=Ki(()=>q(e,A(V({},n),{injector:a})))),t()))}var hi=1;var $r=10,gi=(()=>{let n=class n{constructor(){this.route=u(gt),this.loadingService=u(tt),this.eventsService=u(me),this.coursesService=u(yt),this.subscriptionsService=u(ce),this.personsService=u(Je),this.apprenticeshipContractsService=u(Gr),this.lessonPresencesService=u(Dn),this.reportsService=u(de),this.eventId$=Z([this.route.paramMap,this.route.parent?.paramMap??F(null)]).pipe(I(([t,i])=>Number(t.get("id")||i?.get("id"))),ot()),this.eventSummary$=this.eventId$.pipe(G(this.loadEventSummary.bind(this)),lt(1)),this.eventSummary=Te(this.eventSummary$,{initialValue:null}),this.eventTypeId=x(()=>this.eventSummary()?.EventTypeId??null),this.studentEntries=Te(this.loadStudentEntries(),{initialValue:null}),this.isStudyCourse=x(()=>this.eventTypeId()===hi),this.loading=q(this.loadingService.loading(wt)),this.title=x(()=>this.getTitle(this.studentEntries())),this.multipleStudyClasses=x(()=>(this.studentEntries()?.studyClasses?.length??0)>1),this.searchTerm=j(""),this.sortCriteria=j({primarySortKey:"registrationDate",ascending:!1}),this.entries=x(()=>this.studentEntries()?.entries??[]),this.sortedEntries=x(()=>this.sortStudentEntries(this.entries(),this.sortCriteria())),this.filteredEntries=x(()=>pe(this.sortedEntries(),["name","status","company","studyClass"],this.searchTerm())),this.mailtoLink=x(()=>this.getMailtoLink(this.eventTypeId(),this.entries())),this.reports=Te(this.eventSummary$.pipe(Kt(Lt)).pipe(G(this.loadReports.bind(this))),{initialValue:[]})}loadEventSummary(t){return this.loadingService.load(this.eventsService.getEventSummary(t),wt)}loadStudentEntries(){return this.eventSummary$.pipe(G(t=>{let i=()=>{if(!t)return F(null);switch(t.EventTypeId){case hi:return this.loadStudyCourseStudents(t);case $r:return this.loadStudyClassStudents(t);default:return this.loadCourseStudents(t.Id)}};return this.loadingService.load(i(),wt)}))}loadStudyCourseStudents({Id:t,Designation:i}){return this.subscriptionsService.getSubscriptionsByCourse(t).pipe(G(r=>this.personsService.getSummaries(r.map(({PersonId:d})=>d).filter(Lt)).pipe(I(d=>Ii(t,d,r,i)))))}loadStudyClassStudents({Id:t,Number:i}){return this.subscriptionsService.getSubscriptionsByCourse(t,{"filter.IsOkay":"=1"}).pipe(G(r=>{let d=r.map(({PersonId:f})=>f).filter(Lt);return Z([this.personsService.getSummaries(d),this.apprenticeshipContractsService.getCompaniesForStudents(d)]).pipe(I(([f,w])=>{let Q=Ii(t,f,r,i);return Pi(Q,w)}))}))}loadCourseStudents(t){return this.coursesService.getExpandedCourseWithParticipants(t).pipe(I(Xn),G(i=>Z([this.apprenticeshipContractsService.getCompaniesForStudents(i.entries.map(({id:r})=>r)),this.lessonPresencesService.getLessonStudyClassesByEvent(t)]).pipe(I(([r,d])=>{let f=Pi(i,r);return Zn(f,d)}))))}getTitle(t){if(!t||!t.eventDesignation)return null;let{eventDesignation:i,studyClasses:r}=t;return[i,...r].join(", ")}getMailtoLink(t,i){if(t===null||t===hi)return null;let r=i.map(d=>d.email).filter(Boolean);return r.length>0?`mailto:${r.join(";")}`:null}loadReports({Id:t,EventTypeId:i}){switch(i){case null:case hi:return F([]);case $r:return this.reportsService.getStudyClassStudentsReports(t);default:return this.reportsService.getCourseStudentsReports(t)}}sortStudentEntries(t,i){return[...t].sort(Lo(i))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();function Lo(e){return(n,a)=>{switch(e.primarySortKey){case"registrationDate":return Go(n,a,e.ascending);case"name":return Vr(n,a,e.ascending);default:throw new Ze(e.primarySortKey,"Unhandled sort criteria")}}}function Go(e,n,a){let t=e.registrationDate?new Date(e.registrationDate).getTime():0,i=n.registrationDate?new Date(n.registrationDate).getTime():0,r=a?t-i:i-t;return r===0?Vr(e,n,!0):r}function Vr(e,n,a){return a?e.name.localeCompare(n.name):n.name.localeCompare(e.name)}var Br=(()=>{let n=class n{constructor(){this.entry=k.required(),this.multipleStudyClasses=k(!1),this.returnLink=k(null),this.link=x(()=>["student",this.entry().id,"contact"]),this.linkParams=x(()=>{let t=this.returnLink();return t?{returnparams:new URLSearchParams({returnlink:t}).toString()}:{}})}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-events-students-course-entry"]],inputs:{entry:[1,"entry"],multipleStudyClasses:[1,"multipleStudyClasses"],returnLink:[1,"returnLink"]},decls:7,vars:10,consts:[[1,"avatar","large",3,"studentId","link","linkParams"],[1,"name",3,"title","routerLink","queryParams"],[1,"study-class"],[1,"company",3,"title"]],template:function(i,r){i&1&&(y(0,"bkd-avatar",0),s(1,"a",1),c(2),l(),s(3,"div",2),c(4),l(),s(5,"div",3),c(6),l()),i&2&&(g("studentId",r.entry().id)("link",r.link())("linkParams",r.linkParams()),o(),g("title",r.entry().name)("routerLink",r.link())("queryParams",r.linkParams()),o(),S(r.entry().name),o(2),v(" ",r.multipleStudyClasses()?r.entry().studyClass:"",`
`),o(),g("title",r.entry().company),o(),S(r.entry().company))},dependencies:[it,Nn],styles:['[_nghost-%COMP%]{display:grid;grid-template-columns:min-content 1fr;grid-template-rows:min-content min-content 1fr;grid-template-areas:"avatar name" "avatar study-class" "avatar company";padding:2rem 1rem}.avatar[_ngcontent-%COMP%]{grid-area:avatar;margin-right:1.5rem}.name[_ngcontent-%COMP%]{grid-area:name}.study-class[_ngcontent-%COMP%]{grid-area:study-class;font-size:.875rem}.company[_ngcontent-%COMP%]{grid-area:company;align-content:end;padding-bottom:1.5rem}.name[_ngcontent-%COMP%], .company[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}'],changeDetection:0});let e=n;return e})();var Fo=e=>({count:e});function $o(e,n){if(e&1&&(s(0,"div",0),c(1),p(2,"translate"),l()),e&2){h();let a=L(2);o(),v(" ",W(2,1,a===1?"events-students.registration":"events-students.registrations",$(4,Fo,a))," ")}}var fi=(()=>{let n=class n{constructor(){this.title=k.required(),this.count=k(null),this.searchTerm=pt()}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-events-students-header"]],inputs:{title:[1,"title"],count:[1,"count"],searchTerm:[1,"searchTerm"]},outputs:{searchTerm:"searchTermChange"},decls:7,vars:10,consts:[[1,"additional-info"],[1,"search",3,"valueChange","value","placeholder","label"]],template:function(i,r){if(i&1){let d=D();s(0,"h1"),c(1),l(),H(2),C(3,$o,3,6,"div",0),s(4,"bkd-resettable-input",1),p(5,"translate"),p(6,"translate"),T("valueChange",function(w){return E(d),P(r.searchTerm.set(w))}),l()}if(i&2){o(),S(r.title()),o();let d=N(r.count());o(),_(d!==null?3:-1),o(),g("value",r.searchTerm())("placeholder",m(5,6,"events-students.search-placeholder"))("label",m(6,8,"events-students.search"))}},dependencies:[M,he],styles:["h1[_ngcontent-%COMP%]{margin-bottom:0}.search[_ngcontent-%COMP%]{margin-top:1rem;display:flex;max-width:300px}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"],changeDetection:0});let e=n;return e})();var Vo=(e,n)=>n.id;function Bo(e,n){e&1&&(s(0,"p"),c(1),p(2,"translate"),l()),e&2&&(o(),S(m(2,1,"events-students.no-entries")))}function Ro(e,n){if(e&1&&y(0,"bkd-events-students-course-entry",2),e&2){let a=n.$implicit,t=h();g("entry",a)("multipleStudyClasses",t.multipleStudyClasses())("returnLink",t.returnLink())}}var Rr=(()=>{let n=class n{constructor(){this.title=k.required(),this.count=k.required(),this.entries=k.required(),this.multipleStudyClasses=k(!1),this.returnLink=k(null),this.searchTerm=pt()}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-events-students-course-list"]],inputs:{title:[1,"title"],count:[1,"count"],entries:[1,"entries"],multipleStudyClasses:[1,"multipleStudyClasses"],returnLink:[1,"returnLink"],searchTerm:[1,"searchTerm"]},outputs:{searchTerm:"searchTermChange"},decls:5,vars:4,consts:[[3,"searchTermChange","title","count","searchTerm"],[1,"list"],[3,"entry","multipleStudyClasses","returnLink"]],template:function(i,r){i&1&&(s(0,"bkd-events-students-header",0),K("searchTermChange",function(f){return U(r.searchTerm,f)||(r.searchTerm=f),f}),l(),s(1,"section",1),C(2,Bo,3,3,"p"),B(3,Ro,1,3,"bkd-events-students-course-entry",2,Vo),l()),i&2&&(g("title",r.title())("count",r.count()),z("searchTerm",r.searchTerm),o(2),_(r.entries().length===0?2:-1),o(),R(r.entries()))},dependencies:[M,fi,Br],styles:["[_nghost-%COMP%]{display:block;overflow:hidden}section.list[_ngcontent-%COMP%]{width:calc(100% + 1px);margin-top:1rem;display:grid;grid-template-columns:repeat(auto-fill,minmax(400px,1fr))}bkd-events-students-course-entry[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;border-right:1px solid #dee2e6}"],changeDetection:0});let e=n;return e})();var Ar=(()=>{let n=class n{constructor(){this.entry=k.required(),this.returnLink=k(null),this.link=x(()=>["study-course-student",this.entry().id]),this.linkParams=x(()=>{let t=this.returnLink();return t?{returnparams:new URLSearchParams({returnlink:t}).toString()}:{}})}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-events-students-study-course-entry"]],inputs:{entry:[1,"entry"],returnLink:[1,"returnLink"]},decls:7,vars:8,consts:[[1,"name",3,"routerLink","queryParams"],[1,"status"],[1,"registration-date"]],template:function(i,r){i&1&&(s(0,"a",0),c(1),l(),s(2,"div",1),c(3),l(),s(4,"div",2),c(5),p(6,"date"),l()),i&2&&(g("routerLink",r.link())("queryParams",r.linkParams()),o(),S(r.entry().name),o(2),S(r.entry().status),o(2),v(" ",W(6,5,r.entry().registrationDate,"dd.MM.yyyy"),`
`))},dependencies:[it,Qi,jt],styles:['[_nghost-%COMP%]{display:grid;align-items:center;grid-template-areas:"name status registration-date";grid-template-columns:2fr 1fr 1fr;border-bottom:1px solid #dee2e6}.name[_ngcontent-%COMP%], .status[_ngcontent-%COMP%], .registration-date[_ngcontent-%COMP%]{padding:1rem}.name[_ngcontent-%COMP%]{grid-area:name;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.status[_ngcontent-%COMP%]{grid-area:status;padding-left:0}.registration-date[_ngcontent-%COMP%]{grid-area:registration-date}@media (max-width: 750px){[_nghost-%COMP%]{grid-template-areas:"name registration-date" "status registration-date";grid-template-columns:2fr 1fr;align-items:start}.name[_ngcontent-%COMP%]{padding-bottom:0}.status[_ngcontent-%COMP%]{padding-top:0;padding-left:1rem;font-size:.875rem}}'],changeDetection:0});let e=n;return e})();var Ao=(e,n)=>n.id;function Ho(e,n){if(e&1){let a=D();s(0,"div",2)(1,"bkd-sortable-header",5),p(2,"translate"),K("sortCriteriaChange",function(i){E(a);let r=h();return U(r.sortCriteria,i)||(r.sortCriteria=i),P(i)}),l(),s(3,"bkd-sortable-header",6),p(4,"translate"),K("sortCriteriaChange",function(i){E(a);let r=h();return U(r.sortCriteria,i)||(r.sortCriteria=i),P(i)}),l()()}if(e&2){let a=h();o(),g("label",m(2,6,"events-students.list.header.name"))("sortKey","name"),z("sortCriteria",a.sortCriteria),o(2),g("label",m(4,8,"events-students.list.header.registration-date"))("sortKey","registrationDate"),z("sortCriteria",a.sortCriteria)}}function jo(e,n){e&1&&(s(0,"p",3),c(1),p(2,"translate"),l()),e&2&&(o(),S(m(2,1,"events-students.no-entries")))}function Wo(e,n){if(e&1&&y(0,"bkd-events-students-study-course-entry",4),e&2){let a=n.$implicit,t=h();g("entry",a)("returnLink",t.returnLink())}}var Hr=(()=>{let n=class n{constructor(){this.title=k.required(),this.count=k.required(),this.entries=k.required(),this.returnLink=k(null),this.sortCriteria=pt.required(),this.searchTerm=pt()}updateSortCriteria(t){this.sortCriteria.set(t)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-events-students-study-course-list"]],inputs:{title:[1,"title"],count:[1,"count"],entries:[1,"entries"],returnLink:[1,"returnLink"],sortCriteria:[1,"sortCriteria"],searchTerm:[1,"searchTerm"]},outputs:{sortCriteria:"sortCriteriaChange",searchTerm:"searchTermChange"},features:[dt([])],decls:6,vars:4,consts:[[3,"searchTermChange","title","count","searchTerm"],[1,"list"],[1,"list-header"],[1,"mt-3"],[3,"entry","returnLink"],[1,"name",3,"sortCriteriaChange","label","sortKey","sortCriteria"],[1,"registration-date",3,"sortCriteriaChange","label","sortKey","sortCriteria"]],template:function(i,r){i&1&&(s(0,"bkd-events-students-header",0),K("searchTermChange",function(f){return U(r.searchTerm,f)||(r.searchTerm=f),f}),l(),s(1,"section",1),C(2,Ho,5,10,"div",2)(3,jo,3,3,"p",3),B(4,Wo,1,2,"bkd-events-students-study-course-entry",4,Ao),l()),i&2&&(g("title",r.title())("count",r.count()),z("searchTerm",r.searchTerm),o(2),_(r.entries().length>0?2:3),o(2),R(r.entries()))},dependencies:[M,fi,Ar,ue],styles:[".list-header[_ngcontent-%COMP%]{cursor:pointer;display:grid;grid-template-columns:3fr 1fr;align-items:center;border-bottom:2px solid #dee2e6}.name[_ngcontent-%COMP%], .registration-date[_ngcontent-%COMP%]{padding:1rem}.name[_ngcontent-%COMP%]{flex:3}.registration-date[_ngcontent-%COMP%]{flex:1}@media (max-width: 750px){.list-header[_ngcontent-%COMP%]{grid-template-columns:2fr 1fr}.name[_ngcontent-%COMP%]{flex:2}.registration-date[_ngcontent-%COMP%]{flex:1;white-space:nowrap}}"],changeDetection:0});let e=n;return e})();var No=e=>[e];function Uo(e,n){if(e&1&&(s(0,"a",5)(1,"i",7),c(2,"mail"),l()()),e&2){let a=h(2);g("href",a.state.mailtoLink(),$t)}}function qo(e,n){if(e&1&&(s(0,"bkd-backlink",0)(1,"div",4),C(2,Uo,3,1,"a",5),y(3,"bkd-reports-link",6),l()()),e&2){let a=h(),t=L(0);g("link",$(3,No,t)),o(2),_(a.state.mailtoLink()?2:-1),o(),g("reports",a.state.reports())}}function zo(e,n){e&1&&y(0,"bkd-spinner")}function Ko(e,n){e&1&&(s(0,"p",1),c(1),p(2,"translate"),l()),e&2&&(o(),S(m(2,1,"events-students.no-entries")))}function Yo(e,n){if(e&1){let a=D();s(0,"bkd-events-students-study-course-list",8),K("sortCriteriaChange",function(i){E(a);let r=h();return U(r.state.sortCriteria,i)||(r.state.sortCriteria=i),P(i)})("searchTermChange",function(i){E(a);let r=h();return U(r.state.searchTerm,i)||(r.state.searchTerm=i),P(i)}),l()}if(e&2){let a=h();g("title",a.state.title())("count",a.state.entries().length)("entries",a.state.filteredEntries())("returnLink",a.returnLink()),z("sortCriteria",a.state.sortCriteria)("searchTerm",a.state.searchTerm)}}function Qo(e,n){if(e&1){let a=D();s(0,"bkd-events-students-course-list",9),K("searchTermChange",function(i){E(a);let r=h();return U(r.state.searchTerm,i)||(r.state.searchTerm=i),P(i)}),l()}if(e&2){let a=h();g("title",a.state.title())("count",a.state.entries().length)("entries",a.state.filteredEntries())("multipleStudyClasses",a.state.multipleStudyClasses())("returnLink",a.returnLink()),z("searchTerm",a.state.searchTerm)}}var jr=(()=>{let n=class n{constructor(){this.state=u(gi),this.route=u(gt),this.returnLink=q(this.route.queryParams.pipe(I(({returnlink:t})=>t?decodeURIComponent(t):null)))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-events-students-list"]],decls:6,vars:3,consts:[[3,"link"],[1,"mt-3"],[3,"title","count","entries","returnLink","sortCriteria","searchTerm"],[3,"title","count","entries","multipleStudyClasses","returnLink","searchTerm"],[1,"d-flex"],["target","_blank",1,"mail","btn","btn-primary","btn-icon","me-2",3,"href"],[1,"ms-2",3,"reports"],[1,"material-icons"],[3,"sortCriteriaChange","searchTermChange","title","count","entries","returnLink","sortCriteria","searchTerm"],[3,"searchTermChange","title","count","entries","multipleStudyClasses","returnLink","searchTerm"]],template:function(i,r){if(i&1&&(H(0),C(1,qo,4,5,"bkd-backlink",0),C(2,zo,1,0,"bkd-spinner")(3,Ko,3,3,"p",1)(4,Yo,1,6,"bkd-events-students-study-course-list",2)(5,Qo,1,6,"bkd-events-students-course-list",3)),i&2){let d=N(r.returnLink());o(),_(d?1:-1),o(),_(r.state.loading()?2:r.state.entries().length===0?3:r.state.isStudyCourse()?4:5)}},dependencies:[M,st,qt,le,Rr,Hr],encapsulation:2,changeDetection:0});let e=n;return e})();var Xo=(e,n)=>n.IdStatus;function Zo(e,n){e&1&&y(0,"bkd-spinner")}function Jo(e,n){if(e&1){let a=D();s(0,"div",6)(1,"input",7),T("change",function(){let i=E(a).$implicit,r=h(2);return P(r.onSelectionChange(i))}),l(),s(2,"label",8),c(3),l()()}if(e&2){let a=n.$implicit,t=n.$index,i=h(2);o(),g("id",Rt("status-",t))("checked",a.IdStatus===i.currentStatus().IdStatus)("value",a.IdStatus),o(),g("for",Rt("status-",t)),o(),v(" ",a.Status," ")}}function ts(e,n){if(e&1&&(s(0,"form"),B(1,Jo,4,7,"div",6,Xo),l()),e&2){let a=h();o(),R(a.statusList())}}var Nr=(()=>{let n=class n{constructor(){this.statusProcessesService=u(Ce),this.loadingService=u(tt),this.activeModal=u(Dt),this.currentStatus=k.required(),this.subscriptionId=k.required(),this.personId=k.required(),this.loading=q(this.loadingService.loading$,{initialValue:!0}),this.statusId=x(()=>this.currentStatus().IdStatus),this.statusList=q(Ot(this.statusId).pipe(ot(),G(t=>this.statusProcessesService.getStatusList(t)),I(t=>(t=[...t,this.currentStatus()],t.sort((i,r)=>i.Status.localeCompare(r.Status)))),Et([]))),this.canUpdate=x(()=>this.selected().IdStatus?this.selected().IdStatus!==this.statusId():!1),this.selected=j({})}onSelectionChange(t){this.selected.set(t)}cancel(){this.activeModal.dismiss()}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-events-students-study-course-edit-dialog"]],inputs:{currentStatus:[1,"currentStatus"],subscriptionId:[1,"subscriptionId"],personId:[1,"personId"]},decls:14,vars:11,consts:[[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"form-check"],["type","radio","name","status",1,"form-check-input",3,"change","id","checked","value"],[1,"form-check-label",3,"for"]],template:function(i,r){i&1&&(s(0,"div",0)(1,"h5",1),c(2),p(3,"translate"),l()(),s(4,"div",2),C(5,Zo,1,0,"bkd-spinner")(6,ts,3,0,"form"),l(),s(7,"div",3)(8,"button",4),T("click",function(){return r.activeModal.dismiss()}),c(9),p(10,"translate"),l(),s(11,"button",5),T("click",function(){return r.activeModal.close(r.selected())}),c(12),p(13,"translate"),l()()),i&2&&(o(2),v(" ",m(3,5,"events-students.study-course-edit.status-dialog.title")," "),o(3),_(r.loading()?5:6),o(4),v(" ",m(10,7,"events-students.study-course-edit.status-dialog.cancel")," "),o(2),g("disabled",!r.canUpdate()),o(),v(" ",m(13,9,"events-students.study-course-edit.status-dialog.save")," "))},dependencies:[Nt,Ne,We,en,M,st],encapsulation:2,changeDetection:0});let e=n;return e})();var es=(e,n)=>n.id;function is(e,n){if(e&1&&(c(0),p(1,"date")),e&2){h(2);let a=L(2);v(" ",W(1,1,a.Birthdate,"dd.MM.yyyy")," ")}}function ns(e,n){if(e&1&&c(0),e&2){h(2);let a=L(2);v(" (",a.Gender,") ")}}function rs(e,n){if(e&1&&(c(0),y(1,"br")),e&2){h(2);let a=L(2);v(" ",a.AddressLine1)}}function as(e,n){if(e&1&&(c(0),y(1,"br")),e&2){h(2);let a=L(2);v(" ",a.AddressLine2)}}function os(e,n){if(e&1&&(c(0),y(1,"br")),e&2){h(2);let a=L(2);be(" ",a.Zip," ",a.Location)}}function ss(e,n){if(e&1&&(s(0,"a",4),c(1),l(),y(2,"br")),e&2){h(2);let a=L(2);g("href",Rt("tel:",a.PhonePrivate),$t),o(),S(a.PhonePrivate)}}function ls(e,n){if(e&1&&(s(0,"a",4),c(1),l(),y(2,"br")),e&2){h(2);let a=L(2);g("href",Rt("tel:",a.PhoneMobile),$t),o(),S(a.PhoneMobile)}}function ds(e,n){if(e&1&&(s(0,"a",4),c(1),l(),y(2,"br")),e&2){h(2);let a=L(2);g("href",Rt("mailto:",a.Email),$t),o(),v(" ",a.Email," ")}}function cs(e,n){if(e&1&&(s(0,"a",4),c(1),l(),y(2,"br")),e&2){h(2);let a=L(2);g("href",Rt("mailto:",a.Email2),$t),o(),v(" ",a.Email2," ")}}function ps(e,n){if(e&1&&(s(0,"h1"),c(1),l(),s(2,"span",3),C(3,is,2,4),C(4,ns,1,1),l(),s(5,"address"),C(6,rs,2,1),C(7,as,2,1),C(8,os,2,2),C(9,ss,3,3),C(10,ls,3,3),C(11,ds,3,3),C(12,cs,3,3),l()),e&2){h();let a=L(2);o(),S(a.FullName),o(2),_(a.Birthdate?3:-1),o(),_(a.Gender?4:-1),o(2),_(a.AddressLine1?6:-1),o(),_(a.AddressLine2?7:-1),o(),_(a.Zip&&a.Location?8:-1),o(),_(a.PhonePrivate?9:-1),o(),_(a.PhoneMobile?10:-1),o(),_(a.Email?11:-1),o(),_(a.Email2?12:-1)}}function ms(e,n){if(e&1){let a=D();s(0,"div",2),c(1),p(2,"translate"),s(3,"button",5),T("click",function(){E(a);let i=h();return P(i.updateStatus())}),s(4,"i",6),c(5,"edit"),l(),s(6,"span",7),c(7),l()()()}if(e&2){h();let a=L(4);o(),v(" ",m(2,2,"events-students.study-course-detail.status"),": "),o(6),S(a)}}function us(e,n){if(e&1&&(s(0,"div",8)(1,"h2"),c(2),l()()),e&2){let a=h().$implicit;o(2),S(a.label)}}function hs(e,n){if(e&1&&(s(0,"a",9),c(1),l()),e&2){let a=h(2).$implicit;g("href",Bt(a.file),$t),o(),S(a.value)}}function gs(e,n){if(e&1&&c(0),e&2){let a=h(2).$implicit;v(" ",a.value," ")}}function fs(e,n){if(e&1&&(s(0,"div",8)(1,"div"),c(2),l(),C(3,hs,2,3,"a",9)(4,gs,1,1),l()),e&2){let a=h().$implicit;o(2),S(a.label),o(),_(a.file!==null?3:4)}}function vs(e,n){if(e&1&&C(0,us,3,1,"div",8)(1,fs,5,2,"div",8),e&2){let a=n.$implicit;_(a.heading?0:a.value?1:-1)}}function Cs(e,n){e&1&&y(0,"bkd-spinner")}var Ur=(()=>{let n=class n{constructor(){this.settings=u(ft),this.route=u(gt),this.personsService=u(Je),this.subscriptionsService=u(ce),this.storageService=u(ae),this.statusProcessesService=u(Ce),this.loadingService=u(tt),this.modalService=u(Gt),this.translate=u(J),this.refreshSubscription=new nt,this.eventId$=this.route.parent?.paramMap.pipe(I(t=>Number(t.get("id"))))??F(0),this.personId$=this.route.paramMap.pipe(I(t=>Number(t.get("id")))),this.person=q(this.personId$.pipe(G(t=>this.personsService.get(t))),{initialValue:null}),this.subscription=q(this.refreshSubscription.pipe(Et(null),G(()=>this.loadSubscription()))),this.subscriptionId=x(()=>this.subscription()?.Id??null),this.subscriptionDetails=q(this.loadSubscriptionDetails(),{initialValue:[]}),this.currentStatus=x(()=>({IdStatus:this.subscription()?.StatusId??0,Status:this.subscription()?.Status??""})),this.backLink=q(this.route.queryParams.pipe(I(({returnparams:t})=>t),I(En))),this.loading=q(this.loadingService.loading$,{initialValue:!0})}updateStatus(){let t=this.subscriptionId(),i=this.person();if(!t||!i)return;let r=this.modalService.open(Nr);r.componentInstance.currentStatus=this.currentStatus,r.componentInstance.subscriptionId=t,r.componentInstance.personId=i.Id,r.result.then(d=>{this.statusProcessesService.updateStatus("PersonenAnmeldung",t,i.Id,d.IdStatus).subscribe(()=>this.refreshSubscription.next())},()=>{})}loadSubscription(){return this.loadingService.load(Z([this.eventId$,this.personId$]).pipe(G(([t,i])=>this.subscriptionsService.getSubscriptionsByCourse(t,{"filter.PersonId":`=${i}`})),I(t=>t[0]??null)),{stopOnFirstValue:!0})}loadSubscriptionDetails(){return this.loadingService.load(Ot(this.subscriptionId).pipe(G(t=>t===null?F([]):this.subscriptionsService.getSubscriptionDetailsById(t)),I(t=>t.map(i=>this.toSubscriptionDetailsEntry(i)))),{stopOnFirstValue:!0})}toSubscriptionDetailsEntry(t){let i=t.Value??"";return i=this.normalizeSubscriptionDetailsDropdownValue(t,i)??"",i=this.translateSubscriptionDetailsValue(t,i)??i,{id:t.Id,label:t.VssDesignation,value:i,file:this.buildFileUrl(t),heading:t.VssStyle==="HE"}}normalizeSubscriptionDetailsDropdownValue(t,i){return t.DropdownItems&&t.VssStyle!=="CB"?t.DropdownItems.find(r=>String(r.Key)===i)?.Value??i:i}translateSubscriptionDetailsValue(t,i){return t.VssType==="Yes"||t.VssType==="YesNo"?this.translate.instant(`events-students.subscriptionDetails.${i||"empty"}`):i}buildFileUrl(t){if(t.VssStyle==="PD"||t.VssStyle==="PF"||t.VssStyle==="DA"){let i=this.storageService.getAccessToken()||"";return`${this.settings.apiUrl}/Files/SubscriptionDetails/${t.Id}?token=${i}`}return null}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-events-students-study-course-detail"]],decls:9,vars:6,consts:[[1,"bkd-container","bkd-container-limited"],["link","../..",3,"params"],[1,"status"],[1,"additional-info"],[3,"href"],["type","button",1,"d-flex","btn","btn-link","p-0","ms-1","status-update",3,"click"],[1,"material-icons"],[1,"label"],[1,"detail"],["target","_blank",3,"href"]],template:function(i,r){if(i&1&&(s(0,"div",0),y(1,"bkd-backlink",1),H(2),C(3,ps,13,10),H(4),C(5,ms,8,4,"div",2),B(6,vs,2,1,null,null,es),C(8,Cs,1,0,"bkd-spinner"),l()),i&2){let d;o(),g("params",r.backLink()),o();let f=N(r.person());o(),_(f?3:-1),o();let w=N((d=r.currentStatus())==null?null:d.Status);o(),_(w?5:-1),o(),R(r.subscriptionDetails()),o(2),_(r.loading()?8:-1)}},dependencies:[M,jt,qt,st],styles:["h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}address[_ngcontent-%COMP%]{margin:1rem 0}.status[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem 0;border-top:1px solid #dee2e6;border-bottom:1px solid #dee2e6}.detail[_ngcontent-%COMP%]{max-width:70ch;padding-top:1rem}.detail[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.detail[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-weight:400;color:#00000080}.status-update[_ngcontent-%COMP%]{color:#00000080;text-decoration:none}.status-update[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#000;text-decoration:underline;font-weight:300}"],changeDetection:0});let e=n;return e})();var qr=(()=>{let n=class n{};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-events-students"]],features:[dt([gi])],decls:1,vars:0,template:function(i,r){i&1&&y(0,"router-outlet")},dependencies:[Mt],encapsulation:2,changeDetection:0});let e=n;return e})();function _s(e,n){if(e&1&&(s(0,"span"),c(1),p(2,"date"),y(3,"wbr"),c(4),p(5,"date"),l()),e&2){let a=h(2);o(),v("",W(2,2,a.event().dateFrom,"dd.MM.yyyy"),"\u2013"),o(3),S(W(5,5,a.event().dateTo,"dd.MM.yyyy"))}}function bs(e,n){if(e&1&&(s(0,"div",2),C(1,_s,6,8,"span"),l()),e&2){let a=h();o(),_(a.event().dateFrom&&a.event().dateTo?1:-1)}}function Ss(e,n){if(e&1&&(s(0,"div",5)(1,"a",6)(2,"i",7),c(3,"arrow_right_alt"),l(),s(4,"span",8),c(5),l()()()),e&2){let a=h();o(),g("routerLink",a.event().evaluationLink),o(4),v("",a.event().evaluationText," ")}}var vi=(()=>{let n=class n{constructor(){this.event=k.required(),this.withRatings=k(!0),this.withDate=k(!0),this.link=x(()=>Pn(this.event().detailLink))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-events-list-entry"]],hostVars:4,hostBindings:function(i,r){i&2&&Y("with-ratings",r.withRatings())("with-date",r.withDate())},inputs:{event:[1,"event"],withRatings:[1,"withRatings"],withDate:[1,"withDate"]},decls:10,vars:9,consts:[[1,"designation"],[3,"routerLink","queryParams"],[1,"date"],[1,"registrations"],[1,"registrations-label"],[1,"rating"],[1,"d-flex",3,"routerLink"],[1,"material-icons"],[1,"ps-1"]],template:function(i,r){i&1&&(s(0,"div",0)(1,"a",1),c(2),l()(),C(3,bs,2,1,"div",2),s(4,"div",3),c(5),s(6,"span",4),c(7),p(8,"translate"),l()(),C(9,Ss,6,2,"div",5)),i&2&&(o(),g("routerLink",r.link().link)("queryParams",r.link().params),o(),S(r.event().designation),o(),_(r.withDate()?3:-1),o(2),v(" ",r.event().studentCount," "),o(2),S(m(8,7,r.event().studentCount===1?"events.registration":"events.registrations")),o(2),_(r.withRatings()&&r.event().evaluationText?9:-1))},dependencies:[it,jt,M],styles:['[_nghost-%COMP%]{display:grid;padding:1rem;border-bottom:1px solid #dee2e6;grid-template-areas:"designation registrations";grid-template-columns:4fr 2fr}.with-ratings.with-date[_nghost-%COMP%]{grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}.with-ratings[_nghost-%COMP%]:not(.with-date){grid-template-areas:"designation registrations rating";grid-template-columns:4fr 2fr 3fr}.with-date[_nghost-%COMP%]:not(.with-ratings){grid-template-areas:"designation date registrations";grid-template-columns:4fr 2fr 2fr}.designation[_ngcontent-%COMP%]{grid-area:designation;padding-right:1rem}.date[_ngcontent-%COMP%]{grid-area:date;padding-right:1rem}.registrations[_ngcontent-%COMP%]{grid-area:registrations;padding-right:1rem}.rating[_ngcontent-%COMP%]{grid-area:rating}.rating[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.registrations-label[_ngcontent-%COMP%]{display:none}@media (max-width: 575.98px){.registrations-label[_ngcontent-%COMP%]{display:inline}.designation[_ngcontent-%COMP%], .date[_ngcontent-%COMP%], .registrations[_ngcontent-%COMP%]{padding-right:0}[_nghost-%COMP%]{grid-template-areas:"designation" "date" "registrations" "rating";grid-template-columns:1fr}}']});let e=n;return e})();var Ci=(()=>{let n=class n{constructor(){this.router=u(kt),this.loadingService=u(tt),this.storageService=u(ae),this.eventsRestService=u(me),this.subscriptionsRestService=u(ce),this.loading$=this.loadingService.loading$,this.searchSubject$=new rt(""),this.search$=this.searchSubject$.asObservable(),this.unfilteredStudyCourses$=this.loadStudyCourses().pipe(lt(1)),this.studyCourses$=Z([this.unfilteredStudyCourses$,F(["designation"]),this.search$]).pipe(I(Ut(pe)))}setSearch(t){this.searchSubject$.next(t)}loadStudyCourses(){let t=this.storageService.getPayload();return this.loadingService.load(this.eventsRestService.getStudyCourseEvents().pipe(I(i=>i.filter(r=>Qn(t,r))),G(this.decorateWithStudentCounts.bind(this)),I(this.createFromStudyCourses.bind(this)),I(i=>[...i].sort((r,d)=>r.designation.localeCompare(d.designation)))),{stopOnFirstValue:!0})}decorateWithStudentCounts(t){return t.length>0?this.subscriptionsRestService.getSubscriptionCountsByEvents(t.map(i=>i.Id)).pipe(I(i=>t.map(r=>A(V({},r),{StudentCount:i[r.Id]??0})))):F(t)}createFromStudyCourses(t){return t.map(i=>({id:i.Id,designation:i.Designation,detailLink:this.buildStudentsLink(i.Id),studentCount:i.StudentCount,state:null}))}buildStudentsLink(t){return ci(t,this.router.url)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=X({token:n,factory:n.\u0275fac});let e=n;return e})();var ys=()=>[],xs=(e,n)=>n.id;function ws(e,n){e&1&&y(0,"bkd-spinner")}function Ts(e,n){if(e&1&&y(0,"bkd-events-list-entry",6),e&2){let a=n.$implicit;g("event",a)("withRatings",!1)("withDate",!1)}}function Es(e,n){if(e&1&&(s(0,"div",3)(1,"div",4),c(2),p(3,"translate"),l(),s(4,"div",5),c(5),p(6,"translate"),l()(),B(7,Ts,1,3,"bkd-events-list-entry",6,xs)),e&2){h(2);let a=L(0);o(2),S(m(3,2,"events.designation")),o(3),v(" ",m(6,4,"events.registrations")," "),o(2),R(a)}}function Ps(e,n){e&1&&(s(0,"p",2),c(1),p(2,"translate"),l()),e&2&&(o(),v(" ",m(2,1,"events.study-courses.no-study-courses")," "))}function Is(e,n){if(e&1&&C(0,Es,9,6)(1,Ps,3,3,"p",2),e&2){h();let a=L(0);_(a.length>0?0:1)}}var zr=(()=>{let n=class n{constructor(){this.state=u(Ci)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-study-courses-list"]],decls:13,vars:20,consts:[[1,"bkd-container"],[1,"d-flex","search",3,"valueChange","value","placeholder","label","disabled"],[1,"mt-3"],[1,"event-header"],[1,"designation"],[1,"registrations"],[3,"event","withRatings","withDate"]],template:function(i,r){if(i&1){let d=D();H(0),p(1,"async"),s(2,"h1"),c(3),p(4,"translate"),l(),s(5,"div",0)(6,"bkd-resettable-input",1),p(7,"async"),p(8,"translate"),p(9,"translate"),T("valueChange",function(w){return E(d),P(r.state.setSearch(w))}),l(),C(10,ws,1,0,"bkd-spinner"),p(11,"async"),Vt(12,Is,2,1),l()}if(i&2){let d=N(m(1,6,r.state.studyCourses$)??At(19,ys));o(3),S(m(4,9,"events.study-courses.title")),o(3),g("value",m(7,11,r.state.search$))("placeholder",m(8,13,"events.search-by"))("label",m(9,15,"events.search"))("disabled",!d),o(4),_(m(11,17,r.state.loading$)?10:12)}},dependencies:[M,et,he,st,vi],styles:['.search[_ngcontent-%COMP%]{max-width:500px}.event-header[_ngcontent-%COMP%]{display:grid;padding:1rem;border-bottom:2px solid #dee2e6;grid-template-areas:"designation registrations";grid-template-columns:4fr 2fr;font-weight:500}@media (max-width: 575.98px){.event-header[_ngcontent-%COMP%]{display:none}}'],changeDetection:0});let e=n;return e})();var Kr=(()=>{let n=class n{};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-study-courses"]],features:[dt([Ci])],decls:1,vars:0,template:function(i,r){i&1&&y(0,"router-outlet")},dependencies:[Mt],encapsulation:2,changeDetection:0});let e=n;return e})();var Ms=()=>[],ks=(e,n)=>n.id;function Os(e,n){e&1&&y(0,"bkd-spinner")}function Ds(e,n){e&1&&(s(0,"div",7),c(1),p(2,"translate"),l()),e&2&&(o(),v(" ",m(2,1,"events.rating")," "))}function Ls(e,n){if(e&1&&y(0,"bkd-events-list-entry",8),e&2){let a=n.$implicit,t=h(3);g("event",a)("withRatings",t.withRatings)}}function Gs(e,n){if(e&1&&(s(0,"div",3)(1,"div",4),c(2),p(3,"translate"),l(),s(4,"div",5),c(5),p(6,"translate"),l(),s(7,"div",6),c(8),p(9,"translate"),l(),C(10,Ds,3,3,"div",7),l(),B(11,Ls,1,2,"bkd-events-list-entry",8,ks)),e&2){let a=h(2),t=L(0);Y("with-ratings",a.withRatings),o(2),S(m(3,6,"events.designation")),o(3),S(m(6,8,"events.date")),o(3),v(" ",m(9,10,"events.registrations")," "),o(2),_(a.withRatings?10:-1),o(),R(t)}}function Fs(e,n){e&1&&(s(0,"p",2),c(1),p(2,"translate"),l()),e&2&&(o(),S(m(2,1,"events.no-events")))}function $s(e,n){if(e&1&&C(0,Gs,13,12)(1,Fs,3,3,"p",2),e&2){h();let a=L(0);_(a.length>0?0:1)}}var Yr=["designation"],Vs=[...Yr,"evaluationText"],_i=(()=>{let n=class n{constructor(){this.state=u(ge),this.storage=u(ae),this.withRatings=!0,this.state.setRoles(this.storage.getPayload()?.roles??null)}ngOnChanges(t){t.withRatings&&this.state.setSearchFields(t.withRatings.currentValue?Vs:Yr)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-events-list"]],inputs:{withRatings:"withRatings"},features:[Jt],decls:10,vars:17,consts:[[1,"bkd-container"],[1,"d-flex","search",3,"valueChange","value","placeholder","label","disabled"],[1,"mt-3"],[1,"event-header"],[1,"designation"],[1,"date"],[1,"registrations"],[1,"rating"],[3,"event","withRatings"]],template:function(i,r){if(i&1){let d=D();H(0),p(1,"async"),s(2,"div",0)(3,"bkd-resettable-input",1),p(4,"async"),p(5,"translate"),p(6,"translate"),T("valueChange",function(w){return E(d),P(r.state.setSearch(w))}),l(),C(7,Os,1,0,"bkd-spinner"),p(8,"async"),Vt(9,$s,2,1),l()}if(i&2){let d=N(m(1,5,r.state.getEntries(r.withRatings))??At(16,Ms));o(3),g("value",m(4,8,r.state.search$))("placeholder",m(5,10,"events.search-by"))("label",m(6,12,"events.search"))("disabled",!d),o(4),_(m(8,14,r.state.loading$)?7:9)}},dependencies:[he,st,et,M,vi],styles:['.search[_ngcontent-%COMP%]{max-width:500px}.event-header[_ngcontent-%COMP%]{display:grid;padding:1rem;border-bottom:2px solid #dee2e6;grid-template-areas:"designation date registrations";grid-template-columns:4fr 2fr 2fr;font-weight:500}.event-header.with-ratings[_ngcontent-%COMP%]{grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}@media (max-width: 575.98px){.event-header[_ngcontent-%COMP%]{display:none}}']});let e=n;return e})();var Qr=(()=>{let n=class n{constructor(){}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-events-tests"]],decls:4,vars:4,consts:[[3,"withRatings"]],template:function(i,r){i&1&&(s(0,"h1"),c(1),p(2,"translate"),l(),y(3,"bkd-events-list",0)),i&2&&(o(),S(m(2,2,"events.title")),o(2),g("withRatings",!0))},dependencies:[_i,M],encapsulation:2});let e=n;return e})();function Xr(e){return n=>{let a=Number(n.value);return a<=e?{greaterThan:{value:a,greaterThanValue:e}}:null}}var Bs=e=>["/events",e,"tests"];function Rs(e,n){if(e&1&&(s(0,"div",7),c(1),p(2,"translate"),l()),e&2){let a=n.$implicit;o(),v(" ",W(2,1,"global.validation-errors."+a.error,a.params)," ")}}function As(e,n){if(e&1&&(s(0,"div",7),c(1),p(2,"translate"),l()),e&2){let a=n.$implicit;o(),v(" ",W(2,1,"global.validation-errors."+a.error,a.params)," ")}}function Hs(e,n){if(e&1&&(s(0,"div",7),c(1),p(2,"translate"),l()),e&2){let a=n.$implicit;o(),v(" ",W(2,1,"global.validation-errors."+a.error,a.params)," ")}}function js(e,n){if(e&1&&(s(0,"div",7),c(1),p(2,"translate"),l()),e&2){let a=n.$implicit;o(),v(" ",W(2,1,"global.validation-errors."+a.error,a.params)," ")}}function Ws(e,n){if(e&1&&(s(0,"div",7),c(1),p(2,"translate"),l()),e&2){let a=n.$implicit;o(),v(" ",W(2,1,"global.validation-errors."+a.error,a.params)," ")}}function Ns(e,n){if(e&1&&(s(0,"div",30)(1,"div",31)(2,"div",17)(3,"label",32),c(4),p(5,"translate"),l(),s(6,"div",33),y(7,"input",34),p(8,"async"),B(9,js,3,4,"div",7,te),p(11,"async"),l()()(),s(12,"div",31)(13,"div",17)(14,"label",35),c(15),p(16,"translate"),l(),s(17,"div",33),y(18,"input",36),p(19,"async"),B(20,Ws,3,4,"div",7,te),p(22,"async"),l()()()(),s(23,"div",37),Ri(),s(24,"math")(25,"mi"),c(26),p(27,"translate"),l(),s(28,"mo"),c(29,"="),l(),s(30,"mfrac")(31,"mrow")(32,"mi"),c(33),p(34,"translate"),l(),s(35,"mo"),c(36,"\xD7"),l(),s(37,"mn"),c(38,"5"),l()(),s(39,"mi"),c(40),p(41,"translate"),l()(),s(42,"mo"),c(43,"+"),l(),s(44,"mn"),c(45,"1"),l()()()),e&2){let a,t,i=h(2);o(4),S(m(5,9,"tests.form.max-points")),o(3),Y("is-invalid",((a=m(8,11,i.maxPointsErrors$))==null?null:a.length)||!1),o(2),R(m(11,13,i.maxPointsErrors$)),o(6),S(m(16,15,"tests.form.max-points-adjusted")),o(3),Y("is-invalid",((t=m(19,17,i.maxPointsAdjustedErrors$))==null?null:t.length)||!1),o(2),R(m(22,19,i.maxPointsAdjustedErrors$)),o(6),v(" ",m(27,21,"tests.form.math.grade")," "),o(7),v(" ",m(34,23,"tests.form.math.points")," "),o(7),S(m(41,25,"tests.form.math.max-points"))}}function Us(e,n){e&1&&(s(0,"div",29)(1,"span",38),c(2,"Loading..."),l()())}function qs(e,n){if(e&1){let a=D();s(0,"form",2),T("ngSubmit",function(){E(a);let i=h();return P(i.onSubmit())}),s(1,"div",3)(2,"div",4)(3,"label",5),c(4),p(5,"translate"),l(),y(6,"input",6),p(7,"async"),p(8,"translate"),B(9,Rs,3,4,"div",7,te),p(11,"async"),l(),s(12,"div",8)(13,"label",9),c(14),p(15,"translate"),l(),s(16,"div",10)(17,"div",11)(18,"button",12),T("click",function(){E(a);let i=St(22);return P(i.toggle())}),s(19,"i",13),c(20,"calendar_today"),l()()(),s(21,"input",14,0),p(23,"async"),p(24,"translate"),T("click",function(){E(a);let i=St(22);return P(i.toggle())}),l(),B(25,As,3,4,"div",7,te),p(27,"async"),l()()(),s(28,"div",15)(29,"label",16),c(30),p(31,"translate"),l(),s(32,"div",4)(33,"div",17)(34,"label",18),c(35),p(36,"translate"),l(),s(37,"div",19),y(38,"input",20),p(39,"async"),B(40,Hs,3,4,"div",7,te),p(42,"async"),l()()()(),s(43,"div")(44,"label",16),c(45),p(46,"translate"),l(),s(47,"div",21),y(48,"input",22),s(49,"label",23),c(50),p(51,"translate"),l()(),s(52,"div",21),y(53,"input",24),s(54,"label",25),c(55),p(56,"translate"),l()(),C(57,Ns,46,27),l(),s(58,"div",26)(59,"button",27),p(60,"async"),c(61),p(62,"translate"),l(),s(63,"button",28),c(64),p(65,"translate"),C(66,Us,3,0,"div",29),l()()()}if(e&2){let a,t,i,r,d=h();g("formGroup",d.formGroup),o(4),S(m(5,26,"tests.form.designation")),o(2),Y("is-invalid",((a=m(7,28,d.designationErrors$))==null?null:a.length)||!1),g("placeholder",m(8,30,"tests.form.designation-placeholder")),o(3),R(m(11,32,d.designationErrors$)),o(5),S(m(15,34,"tests.form.date")),o(4),g("id",d.componentId),o(3),Y("is-invalid",((t=m(23,36,d.dateErrors$))==null?null:t.length)||!1),g("placeholder",m(24,38,"shared.date-select.default-placeholder")),o(4),R(m(27,40,d.dateErrors$)),o(5),S(m(31,42,"tests.form.weight")),o(5),S(m(36,44,"tests.form.factor")),o(3),Y("is-invalid",((i=m(39,46,d.weightErrors$))==null?null:i.length)||!1),o(2),R(m(42,48,d.weightErrors$)),o(5),S(m(46,50,"tests.form.grading-type")),o(3),g("value",!1),o(2),S(m(51,52,"tests.form.grades")),o(3),g("value",!0),o(2),S(m(56,54,"tests.form.points")),o(2),_((r=d.formGroup.get("isPointGrading"))!=null&&r.value?57:-1),o(2),g("disabled",d.saving)("routerLink",$(62,Bs,m(60,56,d.courseId$))),o(2),v(" ",m(62,58,"tests.form.cancel")," "),o(2),g("disabled",d.saving),o(),v(" ",m(65,60,"tests.form.save")," "),o(2),_(d.saving?66:-1)}}var bi=(()=>{let n=class n{constructor(){this.fb=u(ln),this.translate=u(J),this.testStateService=u(at),this.test=null,this.saving=!1,this.save=new Ct,this.componentId=bn("bkd-tests-edit-form"),this.formGroup=this.createFormGroup(),this.submitted$=new rt(!1),this.destroy$=new nt,this.designationErrors$=se(F(this.formGroup),this.submitted$,"designation"),this.dateErrors$=se(F(this.formGroup),this.submitted$,"date"),this.maxPointsErrors$=se(F(this.formGroup),this.submitted$,"maxPoints"),this.maxPointsAdjustedErrors$=se(F(this.formGroup),this.submitted$,"maxPointsAdjusted"),this.weightErrors$=se(F(this.formGroup),this.submitted$,"weight"),this.courseId$=this.testStateService.courseId$}ngOnInit(){this.test&&this.setInitialValues(this.test),xn(F(this.formGroup),"isPointGrading").pipe(Pt(this.destroy$)).subscribe(this.togglePointFieldsDisability.bind(this))}ngOnDestroy(){this.destroy$.next()}onSubmit(){this.submitted$.next(!0),this.formGroup.valid&&this.save.emit(this.formGroup.value)}createFormGroup(){return this.fb.group({designation:["",ne.required],date:[null,ne.required],weight:[1,ne.compose([ne.required,Xr(0)])],isPointGrading:[!1],maxPoints:[{value:null,disabled:!0},ne.required],maxPointsAdjusted:[{value:null,disabled:!0},null]})}setInitialValues(t){this.formGroup.patchValue({designation:t.Designation,date:t.Date,weight:t.Weight,isPointGrading:t.IsPointGrading,maxPoints:t.MaxPoints,maxPointsAdjusted:t.MaxPointsAdjusted}),t.Results&&t.Results.length>0&&(this.formGroup.get("isPointGrading")?.disable(),this.formGroup.get("maxPoints")?.disable(),this.formGroup.get("maxPointsAdjusted")?.disable()),this.togglePointFieldsDisability()}togglePointFieldsDisability(){let t=this.formGroup.get("maxPoints"),i=this.formGroup.get("maxPointsAdjusted");this.formGroup.get("isPointGrading")?.value?(t?.enable(),i?.enable()):(t?.reset({value:this.test?.MaxPoints,disabled:!0}),i?.reset({value:this.test?.MaxPointsAdjusted,disabled:!0}))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-tests-edit-form"]],inputs:{test:"test",saving:"saving"},outputs:{save:"save"},features:[dt([{provide:cn,useClass:un},{provide:pn,useClass:zn}])],decls:1,vars:1,consts:[["dp","ngbDatepicker"],[3,"formGroup"],[3,"ngSubmit","formGroup"],[1,"row","g-3","mb-3"],[1,"col-md-6"],["for","designation",1,"form-label"],["id","designation","name","designation","type","text","formControlName","designation","required","",1,"form-control",3,"placeholder"],[1,"invalid-feedback"],[1,"col-md-6","mb-3"],["for","date",1,"form-label"],[1,"input-group"],[1,"input-group-prepend"],["type","button",1,"btn","btn-outline-secondary",3,"click","id"],[1,"material-icons"],["id","date","name","date","type","text","ngbDatepicker","","formControlName","date","required","",1,"form-control",3,"click","placeholder"],[1,"row","mb-3"],[1,"form-label"],[1,"row"],["for","factor",1,"form-label","col-3","col-sm-2"],[1,"col-9","col-sm-10"],["id","factor","name","factor","type","number","formControlName","weight","step","0.05","min","0","required","",1,"form-control"],[1,"form-check"],["type","radio","formControlName","isPointGrading","id","type-grades",1,"form-check-input",3,"value"],["for","type-grades",1,"form-check-label"],["type","radio","formControlName","isPointGrading","id","type-points",1,"form-check-input",3,"value"],["for","type-points",1,"form-check-label"],[1,"d-flex","justify-content-end","mt-4"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","routerLink"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"row","ms-4","mb-3","g-3"],[1,"col-sm-6","col-md-4"],["for","max-points",1,"ms-2","col-4","col-form-label"],[1,"col-6"],["type","number","name","maxPoints","id","max-points","formControlName","maxPoints","step","0.01","min","0","max","999","required","",1,"form-control"],["for","max-points-adjusted",1,"ms-2","col-4","col-form-label"],["type","number","name","maxPointsAdjusted","id","max-points-adjusted","formControlName","maxPointsAdjusted","step","0.01","min","0","max","999",1,"form-control"],[1,"ms-4","ps-3","py-3"],[1,"visually-hidden"]],template:function(i,r){i&1&&C(0,qs,67,64,"form",1),i&2&&_(r.formGroup?0:-1)},dependencies:[Nt,Ne,He,Ue,rn,je,We,sn,ze,qe,dn,an,on,mn,it,et,M],styles:["#factor[_ngcontent-%COMP%], #max-points[_ngcontent-%COMP%], #max-points-adjusted[_ngcontent-%COMP%]{width:5em}.input-group-prepend[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.375rem .75rem;background-color:var(--bs-tertiary-bg);border-color:#dedede;border-radius:0;height:100%}"]});let e=n;return e})();var Zr=(()=>{let n=class n{constructor(){this.courseService=u(yt),this.toastService=u(re),this.translate=u(J),this.router=u(kt),this.state=u(at),this.saving$=new rt(!1)}save(t){this.saving$.next(!0);let{designation:i,date:r,weight:d,isPointGrading:f,maxPoints:w,maxPointsAdjusted:Q}=t;this.state.courseId$.pipe(ut(1),G(Tt=>this.courseService.add(Tt,r,i,d,f,w,Q)),ke(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.state.reload(),this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}navigateBack(){this.state.courseId$.pipe(ut(1)).subscribe(t=>void this.router.navigate(["events",t,"tests"]))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-tests-add"]],decls:6,vars:6,consts:[[1,"bkd-container","bkd-container-limited"],[3,"save","saving"]],template:function(i,r){i&1&&(s(0,"h1"),c(1),p(2,"translate"),l(),s(3,"div",0)(4,"bkd-tests-edit-form",1),p(5,"async"),T("save",function(f){return r.save(f)}),l()()),i&2&&(o(),S(m(2,2,"tests.add-title")),o(3),g("saving",m(5,4,r.saving$)))},dependencies:[bi,et,M],encapsulation:2});let e=n;return e})();var Jr=(()=>{let n=class n{constructor(){this.activeModal=u(Dt)}get canDeleteTest(){return(this.test?.Results?.filter(i=>i.GradeId!==null||i.GradeValue!==null||i.Points!==null)||[]).length===0}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-tests-delete"]],inputs:{test:"test"},decls:13,vars:10,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click","hidden"],[1,"px-2"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"],[1,"px-3"]],template:function(i,r){i&1&&(s(0,"div",0)(1,"p",1),c(2),p(3,"translate"),l()(),s(4,"div",2)(5,"button",3),T("click",function(){return r.activeModal.dismiss()}),s(6,"span",4),c(7),p(8,"translate"),l()(),s(9,"button",5),T("click",function(){return r.activeModal.close(r.canDeleteTest?r.test:null)}),s(10,"span",6),c(11),p(12,"translate"),l()()()),i&2&&(o(2),v(" ",m(3,4,r.canDeleteTest?"tests.form.confirm":"tests.form.delete-not-allowed")," "),o(3),g("hidden",!r.canDeleteTest),o(2),v(" ",m(8,6,"tests.dialog.no")," "),o(4),v(" ",m(12,8,r.canDeleteTest?"tests.dialog.yes":"tests.dialog.ok")," "))},dependencies:[M],encapsulation:2});let e=n;return e})();var zs=e=>({test:e});function Ks(e,n){e&1&&y(0,"bkd-spinner")}function Ys(e,n){if(e&1){let a=D();s(0,"div",1)(1,"h1"),c(2),p(3,"translate"),l(),s(4,"button",2),T("click",function(){E(a);let i=h(),r=L(0);return P(i.openDeleteModal(r))}),s(5,"i",3),c(6,"delete"),l()()(),s(7,"bkd-tests-edit-form",4),T("save",function(i){E(a);let r=h();return P(r.save(i))}),l()}if(e&2){h();let a=L(0),t=L(2);o(2),v(" ",W(3,3,"tests.edit-title",$(6,zs,a.Designation))," "),o(5),g("test",a)("saving",t)}}var ta=(()=>{let n=class n{constructor(){this.state=u(at),this.courseService=u(yt),this.route=u(gt),this.toastService=u(re),this.translate=u(J),this.router=u(kt),this.modalService=u(Gt),this.saving$=new rt(!1),this.testId$=this.route.paramMap.pipe(I(t=>Number(t.get("testId"))),ot()),this.test$=Z([this.state.tests$,this.testId$]).pipe(I(([t,i])=>t.find(r=>r.Id===i)))}openDeleteModal(t){let i=this.modalService.open(Jr);i.componentInstance.test=t,i.result.then(r=>{r&&this.courseService.delete(t.CourseId,t.Id).subscribe(this.onDeleteSuccess.bind(this))},()=>{})}save(t){this.saving$.next(!0);let{designation:i,date:r,weight:d,isPointGrading:f,maxPoints:w,maxPointsAdjusted:Q}=t;Z([this.state.courseId$,this.testId$]).pipe(ut(1),G(([Tt,Xt])=>this.courseService.update(Tt,Xt,i,r,d,f,w,Q)),ke(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.state.reload(),this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}onDeleteSuccess(t){this.toastService.success(this.translate.instant("tests.form.delete-success")),this.state.deleteTest(t),this.navigateBack()}navigateBack(){this.state.courseId$.pipe(ut(1)).subscribe(t=>void this.router.navigate(["events",t,"tests"]))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-tests-edit"]],decls:8,vars:9,consts:[[1,"bkd-container","bkd-container-limited"],[1,"d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-primary","btn-icon",3,"click"],[1,"material-icons"],[3,"save","test","saving"]],template:function(i,r){if(i&1&&(H(0),p(1,"async"),H(2),p(3,"async"),s(4,"div",0),C(5,Ks,1,0,"bkd-spinner"),p(6,"async"),Vt(7,Ys,8,8),l()),i&2){let d=N(m(1,1,r.test$));o(2),N(m(3,4,r.saving$)),o(3),_(m(6,7,r.state.loading$)?5:d?7:-1)}},dependencies:[bi,st,et,M],encapsulation:2});let e=n;return e})();var Qs=()=>["/events"],Xs=e=>({count:e});function Zs(e,n){if(e&1&&(s(0,"div",7),c(1),p(2,"translate"),l()),e&2){let a=h();o(),v(" ",W(2,1,a.course.ParticipatingStudents.length===1?"courses.registration":"courses.registrations",$(4,Xs,a.course.ParticipatingStudents.length))," ")}}var ea=(()=>{let n=class n{constructor(){this.reportsService=u(de),this.course$=new rt(null),this.reports$=this.course$.pipe(I(t=>t?.Id),ot(),G(t=>t?this.reportsService.getCourseTestsReports(t):F([])),Et([]))}ngOnChanges(t){t.course&&this.course$.next(t.course.currentValue)}getDesignation(){return di(this.course)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-tests-header"]],inputs:{course:"course"},features:[Jt],decls:12,vars:7,consts:[[3,"link"],[1,"d-flex"],["routerLink","add",1,"edit","btn","btn-primary","btn-icon","ms-2"],[1,"material-icons"],[1,"ms-2",3,"reports"],["id","excel-import"],[1,"d-flex","flex-column","header"],[1,"additional-info"]],template:function(i,r){i&1&&(s(0,"bkd-backlink",0)(1,"div",1)(2,"a",2)(3,"i",3),c(4,"add"),l()(),y(5,"bkd-reports-link",4),p(6,"async"),y(7,"div",5),l()(),s(8,"div",6)(9,"h1"),c(10),l(),C(11,Zs,3,6,"div",7),l()),i&2&&(g("link",At(6,Qs)),o(5),g("reports",m(6,4,r.reports$)),o(5),S(r.getDesignation()),o(),_(r.course.ParticipatingStudents?11:-1))},dependencies:[qt,it,le,et,M],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem;border-bottom:1px solid #dee2e6}h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"]});let e=n;return e})();var Js=e=>({designation:e}),ia=(()=>{let n=class n{constructor(){this.activeModal=u(Dt)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-tests-publish"]],inputs:{test:"test"},decls:11,vars:12,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"]],template:function(i,r){i&1&&(s(0,"div",0)(1,"p",1),c(2),p(3,"translate"),l()(),s(4,"div",2)(5,"button",3),T("click",function(){return r.activeModal.dismiss()}),c(6),p(7,"translate"),l(),s(8,"button",4),T("click",function(){return r.activeModal.close(!0)}),c(9),p(10,"translate"),l()()),i&2&&(o(2),v(" ",W(3,3,r.test.IsPublished?"tests.publishing.unpublish":"tests.publishing.publish",$(10,Js,r.test.Designation))," "),o(4),v(" ",m(7,6,"tests.publishing.cancel")," "),o(3),v(" ",m(10,8,"tests.publishing.confirm")," "))},dependencies:[M],encapsulation:2});let e=n;return e})();function tl(e,n){if(e&1&&(s(0,"span",1),c(1),l()),e&2){let a=h();o(),S(a.calculatePointsAverage(a.test))}}var na=(()=>{let n=class n{constructor(){this.locale=u(zi)}calculatePointsAverage(t){return this.safeAverage(t,2,ti)}calculateGradeAverage(t){return this.safeAverage(t,3,ei)}safeAverage(t,i,r){try{return jn(r(t),this.locale,i)}catch{return Hn}}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-average-grades"]],inputs:{test:"test"},decls:4,vars:2,consts:[[1,"d-flex","flex-row","w-100"],["data-testid","average-points",1,"mr-2","mr-md-3","average-points"],["data-testid","average-grade"]],template:function(i,r){i&1&&(s(0,"div",0),C(1,tl,2,1,"span",1),s(2,"span",2),c(3),l()()),i&2&&(o(),_(r.test.IsPointGrading?1:-1),o(2),S(r.calculateGradeAverage(r.test)))},styles:[".average-points[_ngcontent-%COMP%]{min-width:4.5em}@media (min-width: 576px){.average-points[_ngcontent-%COMP%]{min-width:6em}}"]});let e=n;return e})();var ra=(()=>{let n=class n{constructor(){this.disabled=!1,this.width="127px",this.gradeIdSelected=new Ct}onGradeChange(t){this.gradeId?.valueOf()!==void 0&&this.gradeIdSelected.emit({id:this.gradeId?.valueOf(),selectedGradeId:t})}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-grade-select"]],inputs:{options:"options",valueId:"valueId",gradeId:"gradeId",disabled:"disabled",width:"width"},outputs:{gradeIdSelected:"gradeIdSelected"},decls:1,vars:5,consts:[["data-testid","grade-select",3,"valueChange","options","allowEmpty","value","disabled","width"]],template:function(i,r){i&1&&(s(0,"bkd-select",0),T("valueChange",function(f){return r.onGradeChange(f)}),l()),i&2&&g("options",r.options)("allowEmpty",!0)("value",r.valueId)("disabled",r.disabled)("width",r.width)},dependencies:[xt],encapsulation:2});let e=n;return e})();var el=e=>({maxPoints:e});function il(e,n){if(e&1&&(s(0,"div",6)(1,"i",8),c(2,"error_outlined"),l(),c(3),p(4,"translate"),l()),e&2){let a=h(2);o(3),v(" ",W(4,1,"global.validation-errors.invalidPoints",$(4,el,a.maxPoints))," ")}}function nl(e,n){e&1&&(s(0,"div",7)(1,"i",8),c(2,"info_outlined"),l(),c(3),p(4,"translate"),l()),e&2&&(o(3),v(" ",m(4,1,"tests.greater-than-max-points-adjusted")," "))}function rl(e,n){if(e&1){let a=D();s(0,"div",3)(1,"input",5,0),T("ngModelChange",function(){E(a);let i=St(2),r=h();return P(r.onPointsChange(i.value))}),l(),C(3,il,5,6,"div",6),C(4,nl,5,3,"div",7),l()}if(e&2){let a=St(2),t=h();o(),Y("is-invalid",a.errors),g("max",Bt(t.maxPoints))("tabindex",Bt(t.tabIndex))("disabled",t.grade.test.IsPublished||t.hasFinalGrade)("ngModel",t.grade.kind==="grade"?t.grade.result.Points:null),o(2),_(a.errors?3:-1),o(),_(t.isGreaterThanMaxPointsAdjusted(a.value)?4:-1)}}var al=1250,aa=(()=>{let n=class n{constructor(){this.state=u(at),this.hasFinalGrade=!1,this.maxPoints=0,this.maxPointsAdjusted=0,this.pointsSubject$=new nt,this.gradeSubject$=new nt,this.gradingScaleDisabledSubject$=new rt(!0),this.gradingScaleDisabled$=this.gradingScaleDisabledSubject$.asObservable(),this.destroy$=new nt}ngOnInit(){this.gradingScaleDisabledSubject$.next(this.isGradingScaleDisabled()),this.maxPoints=mr(this.grade),this.maxPointsAdjusted=ur(this.grade),this.initSave(this.pointsSubject$.pipe(Kt(this.isValid.bind(this)),I(t=>({studentId:this.student.Id,testId:this.grade.test.Id,points:t?Number(t):null})))),this.initSave(this.gradeSubject$.pipe(I(t=>({studentId:this.student.Id,testId:this.grade.test.Id,gradeId:t}))))}ngOnChanges(){this.gradingScaleDisabledSubject$.next(this.isGradingScaleDisabled())}ngOnDestroy(){this.destroy$.next()}onPointsChange(t){this.pointsSubject$.next(t),this.gradingScaleDisabledSubject$.next(!(t===null||t===""))}onGradeChange(t){this.gradeSubject$.next(t)}isGreaterThanMaxPointsAdjusted(t){let i=Number(t);return this.maxPointsAdjusted>0&&i>this.maxPointsAdjusted&&i<=this.maxPoints}isValid(t){return t===""||t===null?!0:isNaN(Number(t))?!1:!(Number(t)<0||Number(t)>this.maxPoints)}initSave(t){t.pipe(Ie(i=>this.state.optimisticallyUpdateGrade(i).pipe(I(r=>({params:i,originalResult:r})))),Me(al),Pt(this.destroy$)).subscribe(({params:i,originalResult:r})=>this.state.saveGrade(i,r))}isGradingScaleDisabled(){return this.grade.test.IsPublished||this.hasFinalGrade||this.grade.test.IsPointGrading&&this.grade.kind==="grade"&&this.grade.result.Points!=null}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-grade"]],inputs:{grade:"grade",student:"student",tabIndex:"tabIndex",gradeOptions:"gradeOptions",hasFinalGrade:"hasFinalGrade"},features:[Jt],decls:5,vars:8,consts:[["points","ngModel"],[1,"d-flex","flex-column","w-100"],[1,"d-flex","flex-row"],[1,"point-input-container","me-2","me-md-3"],["data-testid","grade-select",1,"grade-select",3,"valueChange","options","allowEmpty","value","disabled","tabindex"],["type","number","step","0.01","min","0","data-testid","point-input",1,"form-control",3,"ngModelChange","max","disabled","tabindex","ngModel"],["data-testid","validation-error-message",1,"invalid-feedback"],[1,"max-points-adjusted-warning"],[1,"material-icons"]],template:function(i,r){i&1&&(s(0,"div",1)(1,"div",2),C(2,rl,5,10,"div",3),s(3,"bkd-select",4),p(4,"async"),T("valueChange",function(f){return r.onGradeChange(f)}),l()()()),i&2&&(o(2),_(r.grade.test.IsPointGrading?2:-1),o(),g("options",r.gradeOptions)("allowEmpty",!0)("value",r.grade.kind==="grade"?r.grade.result.GradeId:null)("disabled",m(4,6,r.gradingScaleDisabled$))("tabindex",r.tabIndex))},dependencies:[Nt,He,Ue,je,ze,qe,nn,xt,et,M],styles:[".point-input-container[_ngcontent-%COMP%]{width:4em}.point-input-container[_ngcontent-%COMP%]   input.is-invalid[_ngcontent-%COMP%]{padding-right:.75rem;background:#fff}.point-input-container[_ngcontent-%COMP%]   .invalid-feedback[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .point-input-container[_ngcontent-%COMP%]   .max-points-adjusted-warning[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:inline-block;vertical-align:middle;width:24px}.point-input-container[_ngcontent-%COMP%]   .max-points-adjusted-warning[_ngcontent-%COMP%]{width:100%;margin-top:.25rem;font-size:.875em;color:#055160}[_nghost-%COMP%]     select{width:127px}@media (min-width: 576px){.point-input-container[_ngcontent-%COMP%]{width:5em}}"]});let e=n;return e})();var oa=(e,n)=>({"btn-primary":e,"btn-outline-secondary":n}),sa=(()=>{let n=class n{constructor(){this.filter=Oi,this.filterChange=new Ct}showOnlyMine(){this.filterChange.next(A(V({},this.filter),{onlyMine:!0}))}showAll(){this.filterChange.next(A(V({},this.filter),{onlyMine:!1}))}onHidePublishedChange(t){let i=(t.target&&t.target instanceof HTMLInputElement&&t.target?.checked)??!1;this.filterChange.next(A(V({},this.filter),{hidePublished:i}))}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-tests-table-filter"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},decls:13,vars:18,consts:[[1,"only-mine-buttons"],["type","button",1,"btn","desktop",3,"click","ngClass"],["type","button",1,"btn","ms-2","desktop",3,"click","ngClass"],[1,"hide-published"],[1,"form-check"],["id","hide-published","type","checkbox",1,"form-check-input",3,"change","checked"],["for","hide-published",1,"form-check-label"]],template:function(i,r){i&1&&(s(0,"div",0)(1,"button",1),T("click",function(){return r.showAll()}),c(2),p(3,"translate"),l(),s(4,"button",2),T("click",function(){return r.showOnlyMine()}),c(5),p(6,"translate"),l()(),s(7,"div",3)(8,"div",4)(9,"input",5),T("change",function(f){return r.onHidePublishedChange(f)}),l(),s(10,"label",6),c(11),p(12,"translate"),l()()()),i&2&&(o(),g("ngClass",xi(12,oa,!r.filter.onlyMine,r.filter.onlyMine)),o(),v(" ",m(3,6,"tests.all-tests")," "),o(2),g("ngClass",xi(15,oa,r.filter.onlyMine,!r.filter.onlyMine)),o(),v(" ",m(6,8,"tests.owned-tests")," "),o(4),g("checked",r.filter.hidePublished),o(2),v(" ",m(12,10,"tests.hide-published")," "))},dependencies:[ht,Nt,M],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:100%}.only-mine-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;height:3.625rem}.hide-published[_ngcontent-%COMP%]{display:flex;align-items:center;height:2.375rem;margin-bottom:1rem}.hide-published[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:300}.hide-published[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]{margin-bottom:0}"]});let e=n;return e})();var la=(()=>{let n=class n{constructor(){this.translate=u(J)}transform(t){return`${t.Weight} (${t.WeightPercent}%)${this.getPoints(t)}`}getPoints(t){return t.IsPointGrading?`, ${t.MaxPointsAdjusted??t.MaxPoints} ${this.translate.instant("tests.summary.points")}`:""}};n.\u0275fac=function(i){return new(i||n)},n.\u0275pipe=Wi({name:"testSummaryShort",type:n,pure:!0});let e=n;return e})();var ol=["*"],da=(()=>{let n=class n{};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-preserve-line-height"]],ngContentSelectors:ol,decls:3,vars:0,template:function(i,r){i&1&&(Ui(),s(0,"div"),qi(1),c(2,"\xA0"),l())},encapsulation:2});let e=n;return e})();var sl=e=>[e,"edit"];function ll(e,n){if(e&1&&(s(0,"a",8)(1,"i",9),c(2,"edit"),l()()),e&2){let a=h(2);g("routerLink",$(1,sl,a.test.Id))}}function dl(e,n){if(e&1&&(s(0,"div",5)(1,"div",7)(2,"bkd-preserve-line-height"),c(3),p(4,"date"),l(),C(5,ll,3,3,"a",8),l(),s(6,"bkd-preserve-line-height"),c(7),p(8,"testSummaryShort"),l(),s(9,"bkd-preserve-line-height"),c(10),l()()),e&2){let a=h();o(3),S(W(4,4,a.test.Date,"dd.MM.yyyy")),o(2),_(a.test.IsOwner&&a.test.IsPublished===!1?5:-1),o(2),v(" ",m(8,7,a.test)," "),o(3),S(a.test.Owner)}}function cl(e,n){if(e&1){let a=D();s(0,"div",6)(1,"button",10),p(2,"translate"),T("click",function(){E(a);let i=h();return P(i.unpublishTest())}),s(3,"i",11),c(4,"lock"),l(),s(5,"span"),c(6),p(7,"translate"),l()(),s(8,"bkd-caret",12),T("click",function(){E(a);let i=h();return P(i.emitToggleHeader())}),l()()}if(e&2){let a=h();o(),g("title",Bt(m(2,5,"tests.edit")))("disabled",!a.test.IsOwner),o(5),S(m(7,7,"tests.published")),o(2),g("expanded",a.expanded)}}function pl(e,n){if(e&1){let a=D();s(0,"div",6)(1,"button",13),p(2,"translate"),T("click",function(){E(a);let i=h();return P(i.publishTest())}),s(3,"i",11),c(4,"lock_open"),l(),s(5,"span"),c(6),p(7,"translate"),l()(),s(8,"bkd-caret",12),T("click",function(){E(a);let i=h();return P(i.emitToggleHeader())}),l()()}if(e&2){let a=h();o(),g("title",Bt(m(2,5,"tests.publish")))("disabled",!a.test.IsOwner),o(5),S(m(7,7,"tests.not-published")),o(2),g("expanded",a.expanded)}}var ca=(()=>{let n=class n{constructor(){this.toggleHeader=new Ct,this.publish=new Ct,this.unpublish=new Ct}emitToggleHeader(){this.toggleHeader.emit(!this.expanded)}publishTest(){this.publish.emit(this.test)}unpublishTest(){this.unpublish.emit(this.test)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-test-table-test-header"]],inputs:{test:"test",expanded:"expanded"},outputs:{toggleHeader:"toggleHeader",publish:"publish",unpublish:"unpublish"},decls:9,vars:5,consts:[[1,"d-flex","flex-column","h-100","justify-content-between"],["role","button",1,"test-designation","d-flex","flex-row","my-3","align-items-end","justify-content-between",3,"click"],[3,"ngClass"],[1,"align-self-start",3,"expanded"],[1,"d-flex","flex-column"],[1,"d-flex","flex-column","mb-3"],[1,"d-flex","align-items-center","justify-content-between","test-status"],[1,"d-flex","flex-row","justify-content-between"],[1,"btn","btn-link","p-0","edit",3,"routerLink"],[1,"material-icons"],["type","button",1,"d-flex","btn","btn-link","ps-0","edit",3,"click","disabled","title"],[1,"material-icons","me-1"],[1,"expand-mobile",3,"click","expanded"],["type","button",1,"d-flex","btn","btn-link","ps-0",3,"click","disabled","title"]],template:function(i,r){i&1&&(s(0,"div",0)(1,"div",1),T("click",function(){return r.emitToggleHeader()}),s(2,"div",2),c(3),l(),y(4,"bkd-caret",3),l(),s(5,"div",4),C(6,dl,11,9,"div",5),C(7,cl,9,9,"div",6)(8,pl,9,9,"div",6),l()()),i&2&&(o(2),g("ngClass",r.expanded?"expanded":"collapsed"),o(),v(" ",r.test.Designation," "),o(),g("expanded",r.expanded),o(2),_(r.expanded?6:-1),o(),_(r.test.IsPublished?7:8))},dependencies:[ht,Ln,da,it,jt,M,la],styles:["[_nghost-%COMP%]{font-weight:300}.collapsed[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.test-designation[_ngcontent-%COMP%]{display:none!important}.test-status[_ngcontent-%COMP%]{order:-1;padding-bottom:1rem}.test-status[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{text-decoration:none}.test-status[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:#000}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.edit[_ngcontent-%COMP%]{color:#00000080;text-decoration:none}@media (min-width: 811px){.test-designation[_ngcontent-%COMP%]{display:inherit!important}.test-status[_ngcontent-%COMP%]{order:initial}.expand-mobile[_ngcontent-%COMP%]{display:none!important}}"]});let e=n;return e})();var ml=["bkdTestsTableHeader",""],ul=e=>({"test-point-grading":e}),hl=e=>({selected:e}),Li=(e,n)=>n.Id;function gl(e,n){if(e&1){let a=D();s(0,"th",3)(1,"bkd-test-table-test-header",12),T("toggleHeader",function(i){E(a);let r=h();return P(r.state.toggleHeader(i))})("publish",function(i){E(a);let r=h();return P(r.publish.emit(i))})("unpublish",function(i){E(a);let r=h();return P(r.unpublish.emit(i))}),l()()}if(e&2){let a=n.$implicit,t=h(),i=L(4);g("ngClass",a.Id===(t.selectedTest==null?null:t.selectedTest.Id)?"selected":""),o(),g("test",a)("expanded",i)}}function fl(e,n){if(e&1){let a=D();s(0,"th",4)(1,"bkd-test-table-test-header",12),T("toggleHeader",function(i){E(a);let r=h();return P(r.state.toggleHeader(i))})("publish",function(i){E(a);let r=h();return P(r.publish.emit(i))})("unpublish",function(i){E(a);let r=h();return P(r.unpublish.emit(i))}),l()()}if(e&2){let a=n.$implicit,t=h(),i=L(4);g("ngClass",a.Id===(t.selectedTest==null?null:t.selectedTest.Id)?"selected":""),o(),g("test",a)("expanded",i)}}function vl(e,n){e&1&&(s(0,"div",14),c(1),p(2,"translate"),l()),e&2&&(o(),v(" ",m(2,1,"tests.points")," "))}function Cl(e,n){if(e&1){let a=D();s(0,"th",11)(1,"div",13),C(2,vl,3,3,"div",14),s(3,"bkd-sortable-header",8),p(4,"translate"),K("sortCriteriaChange",function(i){E(a);let r=h();return U(r.state.sortCriteria,i)||(r.state.sortCriteria=i),P(i)}),l()()()}if(e&2){let a=n.$implicit,t=h();g("ngClass",a.Id===(t.selectedTest==null?null:t.selectedTest.Id)?"selected":""),o(2),_(a.IsPointGrading?2:-1),o(),g("label",m(4,5,"tests.grade"))("sortKey","Test-"+a.Id),z("sortCriteria",t.state.sortCriteria)}}var pa=(()=>{let n=class n extends ui{constructor(){super(...arguments),this.state=u(at),this.publish=new Ct,this.unpublish=new Ct}};n.\u0275fac=(()=>{let t;return function(r){return(t||(t=Oe(n)))(r||n)}})(),n.\u0275cmp=b({type:n,selectors:[["thead","bkdTestsTableHeader",""]],inputs:{selectedTest:"selectedTest"},outputs:{publish:"publish",unpublish:"unpublish"},features:[De],attrs:ml,decls:27,vars:29,consts:[[1,"header-collapsible"],["colspan","3",1,"desktop","sticky"],[3,"filterChange","filter"],["container","body",1,"test-grade","grade","test-info-desktop",3,"ngClass"],["container","body","colspan","3",1,"test-grade","header-mobile","test-info-mobile",3,"ngClass"],[1,"filler"],[3,"ngClass"],[1,"sticky","student-name"],[3,"sortCriteriaChange","label","sortKey","sortCriteria"],[1,"sticky","student-grade","desktop",3,"ngClass"],[1,"border-end","sticky","student-average","desktop"],["container","body",1,"test-grade",3,"ngClass"],[3,"toggleHeader","publish","unpublish","test","expanded"],[1,"d-flex"],[1,"point-column-title","me-2","me-md-3"]],template:function(i,r){if(i&1){let d=D();H(0),p(1,"async"),H(2),p(3,"async"),H(4),p(5,"async"),s(6,"tr",0)(7,"th",1)(8,"bkd-tests-table-filter",2),T("filterChange",function(w){return E(d),P(r.state.setFilter(w))}),l()(),B(9,gl,2,3,"th",3,Li),B(11,fl,2,3,"th",4,Li),y(13,"th",5),l(),s(14,"tr",6)(15,"th",7)(16,"bkd-sortable-header",8),p(17,"translate"),K("sortCriteriaChange",function(w){return E(d),U(r.state.sortCriteria,w)||(r.state.sortCriteria=w),P(w)}),l()(),s(18,"th",9)(19,"bkd-sortable-header",8),p(20,"translate"),K("sortCriteriaChange",function(w){return E(d),U(r.state.sortCriteria,w)||(r.state.sortCriteria=w),P(w)}),l()(),s(21,"th",10)(22,"bkd-sortable-header",8),p(23,"translate"),K("sortCriteriaChange",function(w){return E(d),U(r.state.sortCriteria,w)||(r.state.sortCriteria=w),P(w)}),l()(),B(24,Cl,5,7,"th",11,Li),y(26,"th",5),l()}if(i&2){let d=m(1,12,r.state.filteredTests$),f=m(3,14,r.state.filter$);o(4),N(m(5,16,r.state.expandedHeader$)),o(4),g("filter",f),o(),R(d),o(2),R(d),o(3),g("ngClass",$(25,ul,r.selectedTest==null?null:r.selectedTest.IsPointGrading)),o(2),g("label",m(17,19,"tests.student.name"))("sortKey","FullName"),z("sortCriteria",r.state.sortCriteria),o(2),g("ngClass",$(27,hl,r.selectedTest===void 0)),o(),g("label",m(20,21,"tests.grade"))("sortKey","FinalGrade"),z("sortCriteria",r.state.sortCriteria),o(3),g("label",m(23,23,"tests.mean"))("sortKey","TestsMean"),z("sortCriteria",r.state.sortCriteria),o(2),R(d)}},dependencies:[et,ht,M,sa,ca,ue],styles:["[_nghost-%COMP%]{--spacer: 16px;--point-input-size: 4em;--grade-input-size: 17ch;--points-grade-gap: 1rem;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-average-column-width: 120px;--test-grade-column-width: calc( var(--spacer) + var(--point-input-size) + var(--points-grade-gap) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--student-average-column-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) );--test-columns-offset: calc( var(--student-average-column-offset) + var(--student-average-column-width) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}@media (max-width: 767.98px){[_nghost-%COMP%]{--points-grade-gap: calc(.5 * var(--spacer))}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (min-width: 576px){[_nghost-%COMP%]{--point-input-size: 5em}}tr[_ngcontent-%COMP%]:not(.header-collapsible)   th.test-grade[_ngcontent-%COMP%], td.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}@media (max-width: 810px){tr[_ngcontent-%COMP%]:not(.header-collapsible):not(.test-point-grading)   th.test-grade[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]:not(.test-point-grading)   th.student-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.test-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.student-grade[_ngcontent-%COMP%]{width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));min-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));max-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer))}}th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}th.test-grade[_ngcontent-%COMP%]   .point-column-title[_ngcontent-%COMP%]{width:var(--point-input-size)}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-average[_ngcontent-%COMP%], .test-grade[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex;width:100%}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.test-grade[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}.student-average[_ngcontent-%COMP%]{width:var(--student-average-column-width);min-width:var(--student-average-column-width);max-width:var(--student-average-column-width)}.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}th.sticky.student-average[_ngcontent-%COMP%], td.sticky.student-average[_ngcontent-%COMP%]{left:var(--student-average-column-offset)}}@media (max-width: 1200px){[_nghost-%COMP%]{--student-average-column-width: 1px}.student-average[_ngcontent-%COMP%]{padding:0;overflow:hidden}}@media (min-width: 1201px){.student-average-inline[_ngcontent-%COMP%]{display:none}}.sticky[_nghost-%COMP%]{position:fixed;top:0;left:0;z-index:1000;display:none}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;vertical-align:top}.header-collapsible[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:0 1rem}tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:none!important}@media (min-width: 811px){.sticky.shown[_nghost-%COMP%]{display:table-header-group}tr[_ngcontent-%COMP%]   th.test-info-mobile[_ngcontent-%COMP%]{display:none!important}tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:table-cell!important}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;padding-top:.25rem;padding-bottom:.25rem;border-top:initial}.sticky[_nghost-%COMP%]{margin-left:var(--test-columns-offset)}.sticky[_nghost-%COMP%]   th.sticky[_ngcontent-%COMP%]{position:fixed}}"],changeDetection:0});let e=n;return e})();var _l=e=>({"test-point-grading":e}),ma=e=>({selected:e}),bl=e=>["student",e,"grades"],Sl=e=>({"visible-on-mobile":e}),yl=(e,n)=>n.student.Id,xl=(e,n)=>n.Id,wl=(e,n)=>n.id;function Tl(e,n){if(e&1&&(s(0,"div"),c(1),l()),e&2){let a=h().$implicit;o(),v(" ",a.finalGrade.finalGradeValue," ")}}function El(e,n){if(e&1){let a=D();s(0,"bkd-grade-select",19),p(1,"async"),p(2,"async"),T("gradeIdSelected",function(i){E(a);let r=h(2);return P(r.state.overwriteFinalGrade(i))}),l()}if(e&2){let a=h().$implicit,t=h();g("options",m(1,4,t.state.gradingOptionsForCourse$()))("valueId",a.finalGrade.gradeId??null)("gradeId",a.finalGrade.gradingId??null)("disabled",m(2,6,t.isEditFinalGradesAllowed(a))===!1)}}function Pl(e,n){if(e&1&&(s(0,"td",11),y(1,"bkd-grade",20),p(2,"async"),l()),e&2){let a=n.$implicit,t=n.$index,i=h(),r=i.$implicit,d=i.$index,f=h(),w=a.grade;g("ngClass",f.selectedTest!==void 0&&w.test.Id===f.selectedTest.Id?"selected":""),o(),g("grade",w)("gradeOptions",m(2,6,f.state.gradingOptionsForTest$(w.test)))("student",r.student)("hasFinalGrade",!!r.finalGrade.finalGradeValue)("tabIndex",(1+t)*1e3+d)}}function Il(e,n){if(e&1&&(s(0,"tr")(1,"td",6)(2,"a",15)(3,"div"),c(4),l(),s(5,"div",8),c(6),p(7,"translate"),p(8,"decimalOrDash"),l()()(),s(9,"td",16),C(10,Tl,2,1,"div")(11,El,3,8,"bkd-grade-select",17),l(),s(12,"td",18),c(13),p(14,"decimalOrDash"),l(),B(15,Pl,3,8,"td",11,wl),y(17,"td",12),l()),e&2){let a=n.$implicit,t=h();o(2),g("routerLink",$(15,bl,a.student.Id)),o(2),S(a.student.FullName),o(2),be(" ",m(7,7,"tests.mean"),": ",W(8,9,a.finalGrade.average,"1-3")," "),o(3),g("ngClass",$(17,ma,t.selectedTest===void 0)),o(),_(a.finalGrade.finalGradeValue?10:11),o(3),v(" ",W(14,12,a.finalGrade.average,"1-3")," "),o(2),R(t.getGrades(a))}}function Ml(e,n){if(e&1&&(s(0,"td",11),y(1,"bkd-average-grades",21),l()),e&2){let a=n.$implicit,t=h();g("ngClass",a.Id===(t.selectedTest==null?null:t.selectedTest.Id)||a.Id===(t.selectedTest==null?null:t.selectedTest.Id)?"selected":""),o(),g("test",a)}}function kl(e,n){if(e&1){let a=D();s(0,"button",22),T("click",function(){E(a);let i=h();return P(i.setAverageAsFinalGrade())}),c(1),p(2,"translate"),l()}if(e&2){let a=h(),t=L(2);g("ngClass",$(4,Sl,!t||!a.selectedTest)),o(),v(" ",m(2,2,"tests.set-final-grade")," ")}}var ua=(()=>{let n=class n{constructor(){this.state=u(at),this.modalService=u(Gt),this.destroy$=new nt,this.sticky=Re(zt)}ngOnInit(){this.state.sortCriteria.set({primarySortKey:"FullName",ascending:!0}),Z([this.state.filteredTests$,this.state.expandedHeader$]).pipe(Pt(this.destroy$)).subscribe(()=>this.sticky()?.refresh())}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setAverageAsFinalGrade(){this.state.course$.pipe(ut(1)).subscribe(t=>this.state.setAveragesAsFinalGrades({CourseIds:[t.Id]}))}isEditFinalGradesAllowed(t){return this.state.course$.pipe(I(i=>!!(li(i)?.value&&t.finalGrade?.canGrade)))}getGrades(t){return t.grades.flatMap(i=>({id:`${t.student.Id}-${i.test.Id}`,grade:i}))}publish(t){let i=this.openModal(t);this.onCloseModal(i,()=>this.state.publish(t))}unpublish(t){let i=this.openModal(t);this.onCloseModal(i,()=>this.state.unpublish(t))}calculatePointsAverage(t){return this.safeAverage(t,ti)}calculateGradeAverage(t){return this.safeAverage(t,ei)}safeAverage(t,i){try{return i(t).toString()}catch{return"\u2013"}}openModal(t){let i=this.modalService.open(ia);return i.componentInstance.test=t,i}onCloseModal(t,i){t.result.then(r=>{r&&i()},()=>{})}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-tests-table"]],viewQuery:function(i,r){i&1&&$e(r.sticky,zt,5),i&2&&Ve()},inputs:{selectedTest:"selectedTest"},features:[dt([ge])],decls:40,vars:45,consts:[["inlineHeader",""],["stickyHeader",""],[1,"table-responsive-wrapper"],["bkdTableHeaderSticky","",1,"table","table-hover","h-100",3,"ngClass","inlineHeader","stickyHeader"],["bkdTestsTableHeader","",3,"publish","unpublish","selectedTest"],["bkdTestsTableHeader","",3,"publish","unpublish","sticky","selectedTest"],[1,"sticky","student-name"],[1,"d-flex","flex-column"],[1,"student-average-inline"],[1,"desktop","sticky","student-grade",3,"ngClass"],[1,"desktop","border-end","sticky","student-average"],[1,"test-grade",3,"ngClass"],[1,"filler"],[1,"action-buttons"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"ngClass"],[3,"routerLink"],[1,"sticky","student-grade",3,"ngClass"],[3,"options","valueId","gradeId","disabled"],[1,"border-end","sticky","student-average"],[3,"gradeIdSelected","options","valueId","gradeId","disabled"],[3,"grade","gradeOptions","student","hasFinalGrade","tabIndex"],[3,"test"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"click","ngClass"]],template:function(i,r){if(i&1){let d=D();H(0),p(1,"async"),H(2),p(3,"async"),H(4),p(5,"async"),s(6,"div",2)(7,"table",3)(8,"thead",4,0),T("publish",function(w){return E(d),P(r.publish(w))})("unpublish",function(w){return E(d),P(r.unpublish(w))}),l(),s(10,"thead",5,1),T("publish",function(w){return E(d),P(r.publish(w))})("unpublish",function(w){return E(d),P(r.unpublish(w))}),l(),s(12,"tbody"),B(13,Il,18,19,"tr",null,yl),s(15,"tr")(16,"td",6)(17,"div",7)(18,"div"),c(19),p(20,"translate"),l(),s(21,"div",8),c(22),p(23,"translate"),p(24,"async"),p(25,"decimalOrDash"),l()()(),s(26,"td",9),c(27),p(28,"async"),p(29,"decimalOrDash"),l(),s(30,"td",10),c(31),p(32,"async"),p(33,"decimalOrDash"),l(),B(34,Ml,2,2,"td",11,xl),y(36,"td",12),l()()(),s(37,"div",13),C(38,kl,3,6,"button",14),p(39,"async"),l()()}if(i&2){let d=St(9),f=St(11),w=m(1,13,r.state.filteredTests$);o(2),N(m(3,15,r.state.hasTests$));let Q=m(5,18,r.state.studentGrades$);o(5),g("ngClass",$(41,_l,r.selectedTest==null?null:r.selectedTest.IsPointGrading))("inlineHeader",d)("stickyHeader",f),o(),g("selectedTest",r.selectedTest),o(2),g("sticky",!0)("selectedTest",r.selectedTest),o(3),R(Q),o(6),S(m(20,20,"tests.average")),o(3),be(" ",m(23,22,"tests.mean"),": ",W(25,26,m(24,24,r.state.meanOfStudentGradesForCourse$),"1-3")," "),o(4),g("ngClass",$(43,ma,r.selectedTest===void 0)),o(),v(" ",W(29,31,m(28,29,r.state.meanOfFinalGradesForCourse$),"1-3")," "),o(4),v(" ",W(33,36,m(32,34,r.state.meanOfStudentGradesForCourse$),"1-3")," "),o(3),R(w),o(4),_(m(39,39,r.state.canSetFinalGrade$)?38:-1)}},dependencies:[ht,it,ra,aa,na,et,M,ni,zt,pa],styles:["[_nghost-%COMP%]{--spacer: 16px;--point-input-size: 4em;--grade-input-size: 17ch;--points-grade-gap: 1rem;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-average-column-width: 120px;--test-grade-column-width: calc( var(--spacer) + var(--point-input-size) + var(--points-grade-gap) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--student-average-column-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) );--test-columns-offset: calc( var(--student-average-column-offset) + var(--student-average-column-width) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}@media (max-width: 767.98px){[_nghost-%COMP%]{--points-grade-gap: calc(.5 * var(--spacer))}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (min-width: 576px){[_nghost-%COMP%]{--point-input-size: 5em}}tr[_ngcontent-%COMP%]:not(.header-collapsible)   th.test-grade[_ngcontent-%COMP%], td.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}@media (max-width: 810px){tr[_ngcontent-%COMP%]:not(.header-collapsible):not(.test-point-grading)   th.test-grade[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]:not(.test-point-grading)   th.student-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.test-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.student-grade[_ngcontent-%COMP%]{width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));min-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));max-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer))}}th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}th.test-grade[_ngcontent-%COMP%]   .point-column-title[_ngcontent-%COMP%]{width:var(--point-input-size)}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-average[_ngcontent-%COMP%], .test-grade[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex;width:100%}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.test-grade[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}.student-average[_ngcontent-%COMP%]{width:var(--student-average-column-width);min-width:var(--student-average-column-width);max-width:var(--student-average-column-width)}.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}th.sticky.student-average[_ngcontent-%COMP%], td.sticky.student-average[_ngcontent-%COMP%]{left:var(--student-average-column-offset)}}@media (max-width: 1200px){[_nghost-%COMP%]{--student-average-column-width: 1px}.student-average[_ngcontent-%COMP%]{padding:0;overflow:hidden}}@media (min-width: 1201px){.student-average-inline[_ngcontent-%COMP%]{display:none}}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child{text-decoration:underline}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}.student-average-inline[_ngcontent-%COMP%]{color:#4e4e4ef2;font-size:.875rem;line-height:1}@media (min-width: 811px){.table-responsive-wrapper[_ngcontent-%COMP%]{display:block;overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.action-buttons[_ngcontent-%COMP%]{position:sticky;left:0}}@media (max-width: 810px){.apply-average-button[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]});let e=n;return e})();var Ol=()=>[],Dl=e=>({"visible-on-mobile":e}),Ll=e=>["/events",e,"evaluation"],Gl=e=>({returnlink:e});function Fl(e,n){e&1&&y(0,"bkd-spinner")}function $l(e,n){if(e&1){let a=D();s(0,"bkd-select",4),T("valueChange",function(i){E(a);let r=h(2);return P(i&&r.testSelected(i))}),l(),y(1,"bkd-tests-table",5)}if(e&2){h(2);let a=L(6),t=L(8),i=L(10);g("options",a)("value",t)("allowEmpty",!1),o(),g("selectedTest",i)}}function Vl(e,n){e&1&&(s(0,"p",2),c(1),p(2,"translate"),l()),e&2&&(o(),S(m(2,1,"tests.no-tests")))}function Bl(e,n){if(e&1&&(s(0,"a",3)(1,"i",6),c(2,"arrow_right_alt"),l(),s(3,"span",7),c(4),p(5,"translate"),l()()),e&2){h(2);let a=L(0),t=L(4),i=L(10);g("ngClass",$(6,Dl,!t||!i))("routerLink",$(8,Ll,a==null?null:a.Id))("queryParams",$(10,Gl,"/events/"+(a==null?null:a.Id)+"/tests")),o(4),S(m(5,4,"tests.link-to-rating-overview"))}}function Rl(e,n){if(e&1&&(y(0,"bkd-tests-header",1),C(1,$l,2,4)(2,Vl,3,3,"p",2),C(3,Bl,6,12,"a",3),p(4,"async")),e&2){let a=h(),t=L(0),i=L(2);g("course",t),o(),_(i.length>0?1:2),o(2),_(t&&m(4,3,a.state.canSetFinalGrade$)?3:-1)}}var ha=(()=>{let n=class n{constructor(){this.settings=u(ft),this.state=u(at),this.translate=u(J),this.selectTest$=new nt,this.testOptions$=this.state.tests$.pipe(I(t=>[{Key:-1,Value:this.translate.instant("tests.grade")},...t.map(i=>({Key:i.Id,Value:i.Designation}))]),ot()),this.selectedTestId$=Ee(this.selectTest$,this.state.tests$.pipe(ut(1),I(t=>t[0]?.Id))).pipe(ot()),this.selectedTest$=this.selectedTestId$.pipe(G(t=>this.state.tests$.pipe(I(i=>i.find(r=>r.Id===t)))),ot())}testSelected(t){this.selectTest$.next(t)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-tests-list"]],decls:16,vars:22,consts:[[1,"bkd-container"],[3,"course"],[1,"mt-3","px-3"],[1,"rating-overview","d-flex","justify-content-end","pe-3","border-top","pt-3",3,"ngClass","routerLink","queryParams"],["width","100%",1,"tests-dropdown",3,"valueChange","options","value","allowEmpty"],[3,"selectedTest"],[1,"material-icons","fw-bold"],[1,"ps-1"]],template:function(i,r){i&1&&(H(0),p(1,"async"),H(2),p(3,"async"),H(4),p(5,"async"),H(6),p(7,"async"),H(8),p(9,"async"),H(10),p(11,"async"),s(12,"div",0),C(13,Fl,1,0,"bkd-spinner"),p(14,"async"),Vt(15,Rl,5,5),l()),i&2&&(N(m(1,1,r.state.course$)),o(2),N(m(3,4,r.state.tests$)??At(21,Ol)),o(2),N(m(5,7,r.state.hasTests$)),o(2),N(m(7,10,r.testOptions$)),o(2),N(m(9,13,r.selectedTestId$)),o(2),N(m(11,16,r.selectedTest$)),o(3),_(m(14,19,r.state.loading$)?13:15))},dependencies:[ea,xt,ua,ht,st,et,M,it],styles:[".tests-dropdown[_ngcontent-%COMP%]{display:block;padding:1rem 0}@media (min-width: 811px){.tests-dropdown[_ngcontent-%COMP%]{display:none}}a.rating-overview[_ngcontent-%COMP%]{text-decoration:none}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}@media (max-width: 810px){a.rating-overview[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]});let e=n;return e})();var ga=(()=>{let n=class n{constructor(){this.state=u(at),this.route=u(gt),this.courseId$=this.route.paramMap.pipe(I(t=>Number(t.get("id"))),ot()),this.destroy$=new nt}ngOnInit(){this.courseId$.pipe(Pt(this.destroy$)).subscribe(t=>this.state.setCourseId(t))}ngOnDestroy(){this.destroy$.next()}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-tests"]],features:[dt([at])],decls:1,vars:0,template:function(i,r){i&1&&y(0,"router-outlet")},dependencies:[Mt],encapsulation:2});let e=n;return e})();var fa=(()=>{let n=class n{};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=b({type:n,selectors:[["bkd-events-current-list"]],decls:4,vars:4,consts:[[3,"withRatings"]],template:function(i,r){i&1&&(s(0,"h1"),c(1),p(2,"translate"),l(),y(3,"bkd-events-list",0)),i&2&&(o(),S(m(2,2,"events.current.title")),o(2),g("withRatings",!1))},dependencies:[_i,M],encapsulation:2,changeDetection:0});let e=n;return e})();var _1=[{path:"study-courses",component:Kr,children:[{path:"",component:zr},Gi(":id")]},{path:"",component:Jn,children:[{path:"current",children:[{path:"",component:fa},Gi(":id")]},{path:"",component:Qr},{path:":id",component:ga,children:[{path:"tests",children:[{path:"",component:ha},{path:":testId/edit",component:ta},{path:"add",component:Zr},ri]},{path:"evaluation",component:Lr,children:[{path:"",component:Ir},{path:"statistic",component:Dr},ri]},Gi("students")]}]}];function Gi(e){return{path:e,component:qr,children:[{path:"",component:jr},{path:"study-course-student/:id",component:Ur},ri]}}export{ci as a,_1 as b,Gi as c};
