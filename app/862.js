"use strict";(self.webpackChunkwebapp_schulverwaltung=self.webpackChunkwebapp_schulverwaltung||[]).push([[862],{862:(Yn,E,r)=>{r.r(E),r.d(E,{MyAbsencesModule:()=>On});var se=r(6486),g=r(1523),G=r(7328),u=r(2572),A=r(4664),b=r(7081),x=r(2181),l=r(7398),y=r(8180),oe=r(7921),ie=r(3020),T=r(4141),q=r(49),v=r(3942),M=r(1389),e=r(5879),$=r(8173),B=r(3779);let O=(()=>{class t{constructor(n,s,o){this.settings=n,this.storageService=s,this.studentsService=o,this.studentId$=new G.t(1),this.lessonAbsences$=this.studentId$.pipe((0,A.w)(this.loadLessonAbsences.bind(this)),(0,b.d)(1)),this.lessonIncidents$=this.studentId$.pipe((0,A.w)(this.loadLessonIncidents.bind(this)),(0,b.d)(1)),this.lessonPresences$=this.getLessonPresences(),this.checkableAbsences$=this.getAbsences(this.settings.checkableAbsenceStateId),this.openAbsences$=this.getAbsences(this.settings.unconfirmedAbsenceStateId),this.excusedAbsences$=this.getAbsences(this.settings.excusedAbsenceStateId),this.unexcusedAbsences$=this.getAbsences(this.settings.unexcusedAbsenceStateId),this.incidents$=this.getAbsences(null),this.openLessonAbsences$=(0,u.a)([this.openAbsences$.pipe((0,x.h)(v.Nf)),this.lessonAbsences$]).pipe((0,l.U)((0,M.h)(this.getLessonAbsences.bind(this))),(0,b.d)(1)),this.checkableLessonAbsences$=(0,u.a)([this.checkableAbsences$.pipe((0,x.h)(v.Nf)),this.lessonAbsences$]).pipe((0,l.U)((0,M.h)(this.getLessonAbsences.bind(this))),(0,b.d)(1)),this.excusedLessonAbsences$=(0,u.a)([this.excusedAbsences$.pipe((0,x.h)(v.Nf)),this.lessonAbsences$]).pipe((0,l.U)((0,M.h)(this.getLessonAbsences.bind(this))),(0,b.d)(1)),this.unexcusedLessonAbsences$=(0,u.a)([this.unexcusedAbsences$.pipe((0,x.h)(v.Nf)),this.lessonAbsences$]).pipe((0,l.U)((0,M.h)(this.getLessonAbsences.bind(this))),(0,b.d)(1)),this.incidentsLessonAbsences$=(0,u.a)([this.incidents$.pipe((0,x.h)(v.Nf)),this.lessonIncidents$]).pipe((0,l.U)((0,M.h)(this.getLessonIncidents.bind(this))),(0,b.d)(1)),this.counts$=this.getCounts();const i=this.storageService.getPayload()?.id_person;i&&this.studentId$.next(Number(i))}reset(){this.studentId$.pipe((0,y.q)(1)).subscribe(n=>this.studentId$.next(n))}getLessonPresences(){return this.getCached((0,u.a)([this.studentId$,this.lessonAbsences$,this.lessonIncidents$]).pipe((0,A.w)(([n,s,o])=>this.loadTimetableEntries(n,s,o).pipe((0,l.U)(i=>this.buildLessonPresences(s,o,i)))),(0,l.U)(q.Qw)))}getAbsences(n){return this.getCached(this.lessonPresences$.pipe((0,l.U)(s=>s?.filter(o=>o.ConfirmationStateId===n)||null)))}getLessonAbsences(n,s){const o=n.map(i=>i.LessonRef.Id);return s.filter(i=>o.includes(i.LessonRef.Id))}getLessonIncidents(n,s){const o=n.map(i=>i.LessonRef.Id);return s.filter(i=>o.includes(i.LessonRef.Id))}getCounts(){return(0,u.a)([this.getCount(this.checkableAbsences$),this.getCount(this.openAbsences$),this.getCount(this.excusedAbsences$),this.getCount(this.unexcusedAbsences$),this.getCount(this.incidents$)]).pipe((0,l.U)(([n,s,o,i,a])=>({checkableAbsences:n,openAbsences:s,excusedAbsences:o,unexcusedAbsences:i,incidents:a,halfDays:null})))}getCached(n){return n.pipe((0,oe.O)(null),(0,ie.B)({connector:()=>new G.t(1)}))}getCount(n){return n.pipe((0,l.U)(s=>s?.length??null))}loadLessonAbsences(n){return this.studentsService.getLessonAbsences(n)}loadLessonIncidents(n){return this.studentsService.getLessonIncidents(n)}loadTimetableEntries(n,s,o){return this.studentsService.getTimetableEntries(n,{"filter.Id":`;${[...s,...o].map(i=>i.LessonRef.Id).join(";")}`})}buildLessonPresences(n,s,o){return[...n,...s].map(i=>this.buildLessonPresence(i,o)).filter(v.Nf)}buildLessonPresence(n,s){const o=s.find(i=>i.Id===n.LessonRef.Id);return o?{Id:"",LessonRef:{Id:n.LessonRef.Id,HRef:n.LessonRef.HRef?n.LessonRef.HRef:null},StudentRef:n.StudentRef,EventRef:{Id:0,HRef:null},TypeRef:n.TypeRef,RegistrationRef:{Id:0,HRef:null},StudyClassRef:{Id:0,HRef:null},ConfirmationStateId:"ConfirmationStateId"in n?n.ConfirmationStateId:null,EventDesignation:o.EventDesignation,HasStudyCourseConfirmationCode:!1,LessonDateTimeFrom:o.From,LessonDateTimeTo:o.To,Comment:null,Date:o.From,Type:n.Type,StudentFullName:n.StudentFullName,StudyClassNumber:"",TeacherInformation:o.EventManagerInformation}:null}static#e=this.\u0275fac=function(s){return new(s||t)(e.LFG(T.L6),e.LFG($.V),e.LFG(B.l))};static#n=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})(),ce=(()=>{class t{constructor(){}static#e=this.\u0275fac=function(s){return new(s||t)};static#n=this.\u0275cmp=e.Xpm({type:t,selectors:[["erz-my-absences"]],features:[e._Bn([O])],decls:1,vars:0,template:function(s,o){1&s&&e._UZ(0,"router-outlet")},dependencies:[g.lC],changeDetection:0})}return t})();var Y=r(8645),L=r(2096),K=r(6100),z=r(2194),R=r(6055),re=r(6016),J=r(8393),m=r(6814),C=r(253),U=r(6567),ae=r(8898),le=r(3036),h=r(9515);const de=["link"],pe=function(){return["/my-absences/report"]};let me=(()=>{class t{onClick(){this.link.nativeElement.click()}constructor(){}static#e=this.\u0275fac=function(s){return new(s||t)};static#n=this.\u0275cmp=e.Xpm({type:t,selectors:[["erz-my-absences-report-link"]],viewQuery:function(s,o){if(1&s&&e.Gf(de,5),2&s){let i;e.iGM(i=e.CRH())&&(o.link=i.first)}},hostBindings:function(s,o){1&s&&e.NdJ("click",function(a){return o.onClick(a)})},decls:8,vars:5,consts:[[1,"m-0"],[1,"btn","btn-link","p-0",3,"routerLink"],["link",""],[1,"d-flex","align-items-center"],[1,"material-icons"]],template:function(s,o){1&s&&(e.TgZ(0,"h5",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"a",1,2)(5,"div",3)(6,"i",4),e._uU(7,"keyboard_arrow_right"),e.qZA()()()),2&s&&(e.xp6(1),e.hij(" ",e.lcZ(2,2,"my-absences.report.title"),"\n"),e.xp6(2),e.Q6J("routerLink",e.DdM(4,pe)))},dependencies:[g.rH,h.X$],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1rem;cursor:pointer}.btn[_ngcontent-%COMP%]{color:#000;text-decoration:none}"],changeDetection:0})}return t})();function ue(t,c){1&t&&e._UZ(0,"erz-my-absences-report-link")}function _e(t,c){}function ge(t,c){if(1&t&&(e.ynx(0),e._uU(1),e.BQk()),2&t){const n=e.oxw(2).erzLet;e.xp6(1),e.hij("(",n.absenceCounts.checkableAbsences,")")}}function fe(t,c){if(1&t){const n=e.EpF();e.TgZ(0,"erz-student-dossier-entry-header",15),e.NdJ("click",function(){e.CHM(n),e.oxw();const o=e.MAs(15);return e.KtG(o.toggle("checkable-absences"))}),e._uU(1),e.ALo(2,"translate"),e.YNc(3,ge,2,1,"ng-container",16),e.qZA()}if(2&t){const n=c.opened,s=e.oxw().erzLet;e.Q6J("opened",n),e.xp6(1),e.hij(" ",e.lcZ(2,3,"shared.profile.checkable-absences")," "),e.xp6(2),e.Q6J("ngIf",null!==s.absenceCounts.checkableAbsences)}}function he(t,c){if(1&t&&e._UZ(0,"erz-student-dossier-absences",17),2&t){const n=e.oxw(2);e.Q6J("absences$",n.myAbsencesService.checkableAbsences$)}}function be(t,c){if(1&t&&(e.ynx(0),e._uU(1),e.BQk()),2&t){const n=e.oxw(2).erzLet;e.xp6(1),e.hij("(",n.absenceCounts.openAbsences,")")}}function ye(t,c){if(1&t){const n=e.EpF();e.TgZ(0,"erz-student-dossier-entry-header",15),e.NdJ("click",function(){e.CHM(n),e.oxw();const o=e.MAs(15);return e.KtG(o.toggle("open-absences"))}),e._uU(1),e.ALo(2,"translate"),e.YNc(3,be,2,1,"ng-container",16),e.qZA()}if(2&t){const n=c.opened,s=e.oxw().erzLet;e.Q6J("opened",n),e.xp6(1),e.hij(" ",e.lcZ(2,3,"shared.profile.open-absences")," "),e.xp6(2),e.Q6J("ngIf",null!==s.absenceCounts.openAbsences)}}function ve(t,c){if(1&t&&(e._UZ(0,"erz-student-dossier-absences",18),e.ALo(1,"translate"),e.ALo(2,"async"),e.ALo(3,"async")),2&t){const n=e.oxw(2);e.Q6J("absences$",n.myAbsencesService.openAbsences$)("selectionService",n.absencesSelectionService)("defaultAbsenceSelectionMessage",e.lcZ(1,5,"my-absences.show.default-absence-selection-message"))("reportUrl",e.lcZ(2,7,n.openAbsencesReportUrl$))("reportAvailable",e.lcZ(3,9,n.openAbsencesReportAvailable$))}}function Ae(t,c){if(1&t&&(e.ynx(0),e._uU(1),e.BQk()),2&t){const n=e.oxw(2).erzLet;e.xp6(1),e.hij("(",n.absenceCounts.excusedAbsences,")")}}function xe(t,c){if(1&t){const n=e.EpF();e.TgZ(0,"erz-student-dossier-entry-header",15),e.NdJ("click",function(){e.CHM(n),e.oxw();const o=e.MAs(15);return e.KtG(o.toggle("excused-absences"))}),e._uU(1),e.ALo(2,"translate"),e.YNc(3,Ae,2,1,"ng-container",16),e.qZA()}if(2&t){const n=c.opened,s=e.oxw().erzLet;e.Q6J("opened",n),e.xp6(1),e.hij(" ",e.lcZ(2,3,"shared.profile.excused-absences")," "),e.xp6(2),e.Q6J("ngIf",null!==s.absenceCounts.excusedAbsences)}}function Ce(t,c){if(1&t&&e._UZ(0,"erz-student-dossier-absences",17),2&t){const n=e.oxw(2);e.Q6J("absences$",n.myAbsencesService.excusedAbsences$)}}function Te(t,c){if(1&t&&(e.ynx(0),e._uU(1),e.BQk()),2&t){const n=e.oxw(2).erzLet;e.xp6(1),e.hij("(",n.absenceCounts.unexcusedAbsences,")")}}function Le(t,c){if(1&t){const n=e.EpF();e.TgZ(0,"erz-student-dossier-entry-header",15),e.NdJ("click",function(){e.CHM(n),e.oxw();const o=e.MAs(15);return e.KtG(o.toggle("unexcused-absences"))}),e._uU(1),e.ALo(2,"translate"),e.YNc(3,Te,2,1,"ng-container",16),e.qZA()}if(2&t){const n=c.opened,s=e.oxw().erzLet;e.Q6J("opened",n),e.xp6(1),e.hij(" ",e.lcZ(2,3,"shared.profile.unexcused-absences")," "),e.xp6(2),e.Q6J("ngIf",null!==s.absenceCounts.unexcusedAbsences)}}function Ze(t,c){if(1&t&&e._UZ(0,"erz-student-dossier-absences",19),2&t){const n=e.oxw(2);e.Q6J("absences$",n.myAbsencesService.unexcusedAbsences$)("displayPresenceType",!1)}}function Se(t,c){if(1&t&&(e.ynx(0),e._uU(1),e.BQk()),2&t){const n=e.oxw(2).erzLet;e.xp6(1),e.hij("(",n.absenceCounts.incidents,")")}}function Ie(t,c){if(1&t){const n=e.EpF();e.TgZ(0,"erz-student-dossier-entry-header",15),e.NdJ("click",function(){e.CHM(n),e.oxw();const o=e.MAs(15);return e.KtG(o.toggle("incidents"))}),e._uU(1),e.ALo(2,"translate"),e.YNc(3,Se,2,1,"ng-container",16),e.qZA()}if(2&t){const n=c.opened,s=e.oxw().erzLet;e.Q6J("opened",n),e.xp6(1),e.hij(" ",e.lcZ(2,3,"shared.profile.incidents")," "),e.xp6(2),e.Q6J("ngIf",null!==s.absenceCounts.incidents)}}function Me(t,c){if(1&t&&e._UZ(0,"erz-student-dossier-absences",17),2&t){const n=e.oxw(2);e.Q6J("absences$",n.myAbsencesService.incidents$)}}function $e(t,c){if(1&t&&(e.TgZ(0,"div",1)(1,"h1"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",2)(5,"div"),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"div",3)(9,"a",4),e.ALo(10,"async"),e.ALo(11,"async"),e.TgZ(12,"i",5),e._uU(13,"description"),e.qZA()()()(),e.TgZ(14,"ngb-accordion",null,6)(16,"ngb-panel",7),e.YNc(17,ue,1,0,"ng-template",8),e.YNc(18,_e,0,0,"ng-template",9),e.qZA(),e.TgZ(19,"ngb-panel",10),e.YNc(20,fe,4,5,"ng-template",8),e.YNc(21,he,1,1,"ng-template",9),e.qZA(),e.TgZ(22,"ngb-panel",11),e.YNc(23,ye,4,5,"ng-template",8),e.YNc(24,ve,4,11,"ng-template",9),e.qZA(),e.TgZ(25,"ngb-panel",12),e.YNc(26,xe,4,5,"ng-template",8),e.YNc(27,Ce,1,1,"ng-template",9),e.qZA(),e.TgZ(28,"ngb-panel",13),e.YNc(29,Le,4,5,"ng-template",8),e.YNc(30,Ze,1,2,"ng-template",9),e.qZA(),e.TgZ(31,"ngb-panel",14),e.YNc(32,Ie,4,5,"ng-template",8),e.YNc(33,Me,1,1,"ng-template",9),e.qZA()()()),2&t){const n=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,5,"my-absences.title")),e.xp6(4),e.Oqu(e.lcZ(7,7,"my-absences.description")),e.xp6(3),e.ekj("disabled",!1===e.lcZ(10,9,n.allAbsencesReportUrlAvailable$)),e.Q6J("href",e.lcZ(11,11,n.allAbsencesReportUrl$),e.LSH)}}const Re=function(t){return{absenceCounts:t}};let Ue=(()=>{class t{constructor(n,s,o){this.reportsService=n,this.myAbsencesService=s,this.absencesSelectionService=o,this.openAbsencesReportUrl$=this.loadOpenAbsencesReportUrl(),this.allAbsencesReportUrl$=this.loadAllAbsencesReportUrl(),this.openAbsencesReportAvailable$=this.reportsService.studentConfirmationAvailability$,this.allAbsencesReportUrlAvailable$=this.allAbsencesReportUrl$.pipe((0,l.U)(i=>!!i&&i.length>0)),this.destroy$=new Y.x}ngOnInit(){this.myAbsencesService.openLessonAbsences$.pipe((0,y.q)(1),(0,x.h)((0,v.ff)(K.yD))).subscribe(n=>this.reportsService.setStudentConfirmationAvailabilityRecordIds(n.map(s=>`${s.LessonRef.Id}_${s.RegistrationId}`)))}ngOnDestroy(){this.destroy$.next()}loadOpenAbsencesReportUrl(){return(0,u.a)([this.absencesSelectionService.selectedWithoutPresenceType$,this.absencesSelectionService.selectedIds$]).pipe((0,A.w)(([n,s])=>0===n.length&&s.length>0?this.getOpenAbsencesReportRecordIds((0,z.Z)((0,R.Z)(s.map(o=>o.lessonIds)))):(0,L.of)(null)),(0,l.U)(n=>n?this.reportsService.getStudentConfirmationUrl(n):null))}loadAllAbsencesReportUrl(){return(0,u.a)([this.myAbsencesService.openLessonAbsences$,this.myAbsencesService.checkableLessonAbsences$,this.myAbsencesService.excusedLessonAbsences$,this.myAbsencesService.unexcusedLessonAbsences$,this.myAbsencesService.incidentsLessonAbsences$]).pipe((0,l.U)(n=>this.buildUrl((0,R.Z)(n))),(0,b.d)(1))}buildUrl(n){return n.length>0?this.reportsService.getEvaluateAbsencesUrl(this.getAllReportRecordIds(n)):null}getAllReportRecordIds(n){return n.map(s=>`${s.LessonRef.Id}_${s.RegistrationId}`)}getOpenAbsencesReportRecordIds(n){return this.myAbsencesService.openLessonAbsences$.pipe((0,l.U)(s=>s.filter(o=>n.includes(o.LessonRef.Id)).map(o=>`${o.LessonRef.Id}_${o.RegistrationId}`)))}static#e=this.\u0275fac=function(s){return new(s||t)(e.Y36(re.F),e.Y36(O),e.Y36(J.o))};static#n=this.\u0275cmp=e.Xpm({type:t,selectors:[["erz-my-absences-show"]],decls:2,vars:5,consts:[["class","erz-container erz-container-limited",4,"erzLet"],[1,"erz-container","erz-container-limited"],[1,"d-flex","justify-content-between","border-bottom","header"],[1,"ps-3"],["target","_blank",1,"report","btn","btn-primary","btn-icon",3,"href"],[1,"material-icons"],["acc","ngbAccordion"],["id","report-absence"],["ngbPanelHeader",""],["ngbPanelContent",""],["id","checkable-absences"],["id","open-absences"],["id","excused-absences"],["id","unexcused-absences"],["id","incidents"],[3,"opened","click"],[4,"ngIf"],[3,"absences$"],[3,"absences$","selectionService","defaultAbsenceSelectionMessage","reportUrl","reportAvailable"],[3,"absences$","displayPresenceType"]],template:function(s,o){1&s&&(e.YNc(0,$e,34,13,"div",0),e.ALo(1,"async")),2&s&&e.Q6J("erzLet",e.VKq(3,Re,e.lcZ(1,1,o.myAbsencesService.counts$)))},dependencies:[m.O5,C.gY,C.Gk,C.gW,C.k9,U.e,ae.H,le.u,me,m.Ov,h.X$],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem}"],changeDetection:0})}return t})();var p=r(6223),X=r(5619),Fe=r(4716),ke=r(1257),N=r(6869),F=r(905),P=r(6023);let V=(()=>{class t{constructor(n,s,o,i,a,_,d,f){this.fb=n,this.router=s,this.toastService=o,this.translate=i,this.presenceTypesService=a,this.updateService=_,this.storageService=d,this.settings=f,this.formGroup=this.createFormGroup(),this.saving$=new X.X(!1),this.submitted$=new X.X(!1),this.absenceTypes$=(0,u.a)([this.getConfirmationTypes(),this.getHalfDayType()]).pipe((0,l.U)(([S,I])=>I?[...S,I]:S)),this.absenceTypeIdErrors$=(0,ke.Z6)((0,L.of)(this.formGroup),this.submitted$,"absenceTypeId"),this.destroy$=new Y.x}ngOnInit(){this.selectedLessonIds$.pipe((0,y.q)(1),(0,x.h)(K.yD)).subscribe(()=>this.navigateBack())}ngOnDestroy(){this.destroy$.next()}onSubmit(){if(this.submitted$.next(!0),this.formGroup.valid){const{absenceTypeId:n}=this.formGroup.value;this.save(n)}}cancel(){this.navigateBack()}getSelectedCount(){return this.selectedLessonIds$.pipe((0,l.U)(n=>n.length))}getConfirmationTypes(){return this.presenceTypesService.confirmationTypes$.pipe((0,l.U)(n=>n.filter(s=>s.IsAbsence&&s.Id!==this.settings.halfDayPresenceTypeId)))}getHalfDayType(){return(0,L.of)(null)}createFormGroup(){return this.fb.group({absenceTypeId:[null,p.kI.required]})}save(n){this.saving$.next(!0),this.selectedLessonIds$.pipe((0,y.q)(1),(0,A.w)(s=>this.updateService.editLessonPresences(s,[Number(this.storageService.getPayload()?.id_person)],n)),(0,Fe.x)(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("my-absences.confirm.save-success")),this.navigateBack()}static#e=this.\u0275fac=function(s){return new(s||t)(e.Y36(p.QS),e.Y36(g.F0),e.Y36(N.k),e.Y36(h.sK),e.Y36(F.c),e.Y36(P.O),e.Y36($.V),e.Y36(T.Zr))};static#n=this.\u0275cmp=e.Xpm({type:t,selectors:[["ng-component"]],decls:0,vars:0,template:function(s,o){},encapsulation:2})}return t})();var W=r(500);const Oe=function(t){return{count:t}};function Ye(t,c){if(1&t&&(e.TgZ(0,"div",11),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t){const n=c.erzLet;e.xp6(1),e.hij(" ",e.xi3(2,1,1===n?"my-absences.confirm.lesson-selected":"my-absences.confirm.lessons-selected",e.VKq(4,Oe,n))," ")}}function ze(t,c){if(1&t&&(e.TgZ(0,"div",17),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t){const n=c.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,"global.validation-errors."+n.error,n.params)," ")}}function Je(t,c){if(1&t&&(e.ynx(0),e.YNc(1,ze,3,4,"div",16),e.ALo(2,"async"),e.BQk()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,n.absenceTypeIdErrors$))}}const Ne=function(t){return{"border-top pt-3":t}};function Pe(t,c){if(1&t&&(e.TgZ(0,"div",12),e._UZ(1,"input",13),e.ALo(2,"async"),e.TgZ(3,"label",14),e._uU(4),e.qZA(),e.YNc(5,Je,3,3,"ng-container",15),e.ALo(6,"async"),e.qZA()),2&t){const n=c.$implicit,s=c.index,o=e.oxw();let i;e.Q6J("ngClass",e.VKq(12,Ne,n.IsHalfDay)),e.xp6(1),e.ekj("is-invalid",e.lcZ(2,8,o.absenceTypeIdErrors$).length>0),e.Q6J("id","absence-type-"+s)("value",n.Id),e.xp6(2),e.Q6J("for","absence-type-"+s),e.xp6(1),e.hij(" ",n.Designation," "),e.xp6(1),e.Q6J("ngIf",(null==(i=e.lcZ(6,10,o.absenceTypes$))?null:i.length)-1===s)}}function we(t,c){1&t&&(e.TgZ(0,"div",18)(1,"span",19),e._uU(2,"Loading..."),e.qZA()())}let Qe=(()=>{class t extends V{constructor(n,s,o,i,a,_,d,f,S,I){super(n,s,o,i,a,_,d,f),this.myAbsencesService=S,this.selectionService=I,this.titleKey="my-absences.confirm.title",this.selectedLessonIds$=this.selectionService.selectedIds$.pipe((0,l.U)(j=>(0,z.Z)((0,R.Z)(j.map(H=>H.lessonIds))))),this.confirmationStateId=this.settings.unconfirmedAbsencesRefreshTime}onSaveSuccess(){this.selectionService.clear(),this.myAbsencesService.reset(),super.onSaveSuccess()}navigateBack(){this.router.navigate(["/my-absences"])}static#e=this.\u0275fac=function(s){return new(s||t)(e.Y36(p.QS),e.Y36(g.F0),e.Y36(N.k),e.Y36(h.sK),e.Y36(F.c),e.Y36(P.O),e.Y36($.V),e.Y36(T.L6),e.Y36(O),e.Y36(J.o))};static#n=this.\u0275cmp=e.Xpm({type:t,selectors:[["erz-my-absences-confirm"]],features:[e.qOj],decls:28,vars:35,consts:[[1,"erz-container","erz-container-limited"],["class","mb-3 pb-3 border-bottom",4,"erzLet"],[3,"formGroup","ngSubmit"],[1,"form-group","mb-3","border-bottom"],[1,"form-label"],["class","form-check my-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"remark"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","click"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"mb-3","pb-3","border-bottom"],[1,"form-check","my-3",3,"ngClass"],["type","radio","formControlName","absenceTypeId",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],[4,"ngIf"],["class","invalid-feedback mt-4",4,"ngFor","ngForOf"],[1,"invalid-feedback","mt-4"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"visually-hidden"]],template:function(s,o){1&s&&(e.TgZ(0,"div",0)(1,"h1"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Ye,3,6,"div",1),e.ALo(5,"async"),e.TgZ(6,"form",2),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(7,"div",3)(8,"label",4),e._uU(9),e.ALo(10,"translate"),e.ALo(11,"addSpace"),e.qZA(),e.YNc(12,Pe,7,14,"div",5),e.ALo(13,"async"),e.qZA(),e.TgZ(14,"div",6),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"div",7)(18,"button",8),e.NdJ("click",function(){return o.cancel()}),e.ALo(19,"async"),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.TgZ(22,"button",9),e.ALo(23,"async"),e._uU(24),e.ALo(25,"translate"),e.YNc(26,we,3,0,"div",10),e.ALo(27,"async"),e.qZA()()()()),2&s&&(e.xp6(2),e.Oqu(e.lcZ(3,12,o.titleKey)),e.xp6(2),e.Q6J("erzLet",e.lcZ(5,14,o.getSelectedCount())),e.xp6(2),e.Q6J("formGroup",o.formGroup),e.xp6(3),e.AsE("",e.lcZ(10,16,"my-absences.confirm.choose-presence-type"),"",e.xi3(11,18,":",":"),""),e.xp6(3),e.Q6J("ngForOf",e.lcZ(13,21,o.absenceTypes$)),e.xp6(3),e.hij(" ",e.lcZ(16,23,"my-absences.confirm.remark")," "),e.xp6(3),e.Q6J("disabled",e.lcZ(19,25,o.saving$)),e.xp6(2),e.hij(" ",e.lcZ(21,27,"my-absences.confirm.cancel")," "),e.xp6(2),e.Q6J("disabled",e.lcZ(23,29,o.saving$)),e.xp6(2),e.hij(" ",e.lcZ(25,31,"my-absences.confirm.save")," "),e.xp6(2),e.Q6J("ngIf",e.lcZ(27,33,o.saving$)))},dependencies:[m.mk,m.sg,m.O5,p._Y,p.Fj,p._,p.JJ,p.JL,p.sg,p.u,U.e,m.Ov,h.X$,W.u],changeDetection:0})}return t})();var De=r(9862),k=r(5301),je=r(4307),He=r(8584),ee=r(4477),Ee=r(3005),Ge=r(1608);let w=(()=>{class t extends ee.f{constructor(n,s,o,i,a,_){super(n,s,_,o,"/my-absences/report"),this.studentsService=i,this.storageService=a,this.preventAbsencesAfterStart=!1;const d=this.storageService.getPayload()?.instance_id;this.preventAbsencesAfterStart=!!d&&this.settings.preventStudentAbsenceAfterLessonStart.includes(d)}getInitialFilter(){return{dateFrom:null,dateTo:null}}isValidFilter(n){return!(!n.dateFrom&&!n.dateTo)}loadEntries(n,s,o){const i=this.buildRequestParamsFromFilter(n).set("sort","From.asc");return this.loadingService.load(this.loadTimetableEntries(i).pipe((0,l.U)(a=>this.filterAbsencesAfterLessonStart(a)),(0,A.w)(a=>(0,u.a)([(0,L.of)(a),this.loadLessonAbsences(a),this.loadLessonDispensations(a)])),(0,l.U)(([a,_,d])=>this.buildLessonPresences(a,_,d)),(0,l.U)(a=>({offset:0,total:a.length,entries:a}))),ee.O)}filterAbsencesAfterLessonStart(n){return this.preventAbsencesAfterStart?n.filter(s=>s.From>=new Date):n}buildParamsFromFilter(n){const{dateFrom:s,dateTo:o}=n,i={};return s&&(i.dateFrom=(0,k.Z)(s,"yyyy-MM-dd")),o&&(i.dateTo=(0,k.Z)(o,"yyyy-MM-dd")),i}buildRequestParamsFromFilter(n){let s=new De.LE;return n.dateFrom&&(s=s.set("filter.From",`>${(0,k.Z)((0,je.Z)(n.dateFrom,1),"yyyy-MM-dd")}`)),n.dateTo&&(s=s.set("filter.To",`<${(0,k.Z)((0,He.Z)(n.dateTo,1),"yyyy-MM-dd")}`)),s}get studentId(){const n=this.storageService.getPayload()?.id_person;if(null==n)throw new Error("No student id available");return Number(n)}loadTimetableEntries(n){return this.studentsService.getTimetableEntries(this.studentId,n)}loadLessonAbsences(n){return n.length>0?this.studentsService.getLessonAbsences(this.studentId,{"filter.Id":`;${n.map(s=>s.Id).join(";")}`}):(0,L.of)([])}loadLessonDispensations(n){return n.length>0?this.studentsService.getLessonDispensations(this.studentId,{"filter.Id":`;${n.map(s=>s.Id).join(";")}`}):(0,L.of)([])}buildLessonPresences(n,s,o){return n.map(i=>this.buildLessonPresence(i,s,o))}buildLessonPresence(n,s,o){const i=s.find(d=>d.LessonRef.Id===n.Id),a=o.find(d=>d.LessonRef.Id===n.Id),_=this.buildLessonPresenceTypeRef(i,a);return{Id:"",LessonRef:{Id:n.Id,HRef:null},StudentRef:(i||a)?.StudentRef||{Id:this.studentId,HRef:null},EventRef:{Id:0,HRef:null},TypeRef:_,RegistrationRef:{Id:0,HRef:null},StudyClassRef:{Id:0,HRef:null},ConfirmationStateId:i?.ConfirmationStateId||a&&this.settings.excusedAbsenceStateId||null,EventDesignation:n.EventDesignation||"",HasStudyCourseConfirmationCode:!1,LessonDateTimeFrom:n.From||new Date,LessonDateTimeTo:n.To||new Date,Comment:null,Date:n.From||new Date,Type:(i||a)?.Type||null,StudentFullName:(i||a)?.StudentFullName||"",StudyClassNumber:"",TeacherInformation:n.EventManagerInformation}}buildLessonPresenceTypeRef(n,s){return n?{...n.TypeRef}:s?{...s.TypeRef}:{Id:null,HRef:null}}static#e=this.\u0275fac=function(s){return new(s||t)(e.LFG(m.Ye),e.LFG(Ee.b),e.LFG(T.L6),e.LFG(B.l),e.LFG($.V),e.LFG(Ge.K))};static#n=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})();var qe=r(6561);let Q=(()=>{class t extends qe.z{constructor(){super(...arguments),this.selectedIds$=this.selection$.pipe((0,l.U)(q.fG))}static#e=this.\u0275fac=function(){let n;return function(o){return(n||(n=e.n5z(t)))(o||t)}}();static#n=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})(),Be=(()=>{class t{constructor(){}static#e=this.\u0275fac=function(s){return new(s||t)};static#n=this.\u0275cmp=e.Xpm({type:t,selectors:[["erz-my-absences-report"]],features:[e._Bn([w,Q])],decls:1,vars:0,template:function(s,o){1&s&&e._UZ(0,"router-outlet")},dependencies:[g.lC],changeDetection:0})}return t})();var Ke=r(9773),ne=r(2220),D=r(8484),Z=r(3449),Xe=r(412),Ve=r(59),We=r(9189),en=r(3296),nn=r(1133),tn=r(7625);const sn=function(){return["/my-absences"]};let on=(()=>{class t{constructor(){this.filter={dateFrom:null,dateTo:null},this.filterChange=new e.vpe,this.minDate={year:(new Date).getFullYear(),month:(new Date).getMonth()+1,day:(new Date).getDate()}}updateDateFrom(n){this.filter.dateFrom=n,n&&(this.filter.dateTo=n)}show(){this.filterChange.emit({dateFrom:te(this.filter.dateFrom),dateTo:te(this.filter.dateTo)})}static#e=this.\u0275fac=function(s){return new(s||t)};static#n=this.\u0275cmp=e.Xpm({type:t,selectors:[["erz-my-absences-report-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},features:[e._Bn([{provide:C.DO,useClass:C.s5},{provide:C.NG,useClass:en.n}])],decls:19,vars:18,consts:[[3,"routerLink"],[1,"filters"],[1,"form-group"],[1,"form-label"],[3,"minDate","value","valueChange"],[1,"buttons"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(s,o){1&s&&(e._UZ(0,"erz-backlink",0),e.TgZ(1,"h1"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",1)(5,"div",2)(6,"label",3),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"erz-date-select",4),e.NdJ("valueChange",function(a){return o.updateDateFrom(a)}),e.qZA()(),e.TgZ(10,"div",2)(11,"label",3),e._uU(12),e.ALo(13,"translate"),e.qZA(),e.TgZ(14,"erz-date-select",4),e.NdJ("valueChange",function(a){return o.filter.dateTo=a}),e.qZA()(),e.TgZ(15,"div",5)(16,"button",6),e.NdJ("click",function(){return o.show()}),e._uU(17),e.ALo(18,"translate"),e.qZA()()()),2&s&&(e.Q6J("routerLink",e.DdM(17,sn)),e.xp6(2),e.Oqu(e.lcZ(3,9,"my-absences.report.title")),e.xp6(5),e.Oqu(e.lcZ(8,11,"my-absences.report.header.date-from")),e.xp6(2),e.Q6J("minDate",o.minDate)("value",o.filter.dateFrom),e.xp6(3),e.Oqu(e.lcZ(13,13,"my-absences.report.header.date-to")),e.xp6(2),e.Q6J("minDate",o.minDate)("value",o.filter.dateTo),e.xp6(3),e.hij(" ",e.lcZ(18,15,"my-absences.report.header.show")," "))},dependencies:[g.rH,nn.T,tn.I,h.X$],styles:["[_nghost-%COMP%]{display:block;padding:1rem 0;border-bottom:1px solid #dee2e6}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.form-group[_ngcontent-%COMP%]{flex:1;min-width:20rem;max-width:40rem;margin-right:1rem;margin-bottom:.5rem}.buttons[_ngcontent-%COMP%]{flex:none;margin-top:1.625rem;margin-right:0}@media (max-width: 575.98px){.buttons[_ngcontent-%COMP%]{width:100%;margin-top:1rem;margin-bottom:1rem}}"],changeDetection:0})}return t})();function te(t){return t?(0,We.Z)(t):null}var cn=r(238);function rn(t,c){if(1&t){const n=e.EpF();e.TgZ(0,"div",12)(1,"input",13,29),e.NdJ("change",function(){e.CHM(n);const o=e.oxw(2).$implicit,i=e.oxw(6);return e.KtG(i.selectionService.toggle(o))}),e.ALo(3,"async"),e.qZA()()}if(2&t){const n=e.oxw(2).$implicit,s=e.oxw(6);e.xp6(1),e.Q6J("checked",e.lcZ(3,1,s.selectionService.isSelected$(n)))}}function an(t,c){if(1&t&&(e.TgZ(0,"div")(1,"i",17),e._uU(2),e.qZA()()),2&t){const n=e.oxw().erzLet;e.Gre("checkbox presence-category ",n.category,""),e.xp6(2),e.Oqu(n.icon)}}function ln(t,c){if(1&t&&(e.ynx(0),e.YNc(1,rn,4,3,"div",27),e.YNc(2,an,3,4,"ng-template",null,28,e.W1O),e.BQk()),2&t){const n=c.erzLet,s=e.MAs(3);e.xp6(1),e.Q6J("ngIf",!n)("ngIfElse",s)}}function dn(t,c){if(1&t&&(e.ynx(0),e._uU(1),e.BQk()),2&t){const n=e.oxw().$implicit;e.xp6(1),e.hij(", ",n.StudyClassNumber,"")}}function pn(t,c){if(1&t&&(e.TgZ(0,"div",31),e._uU(1),e.qZA()),2&t){const n=e.oxw().erzLet;e.xp6(1),e.hij(" ",n," ")}}function mn(t,c){if(1&t&&(e.ynx(0),e.YNc(1,pn,2,1,"div",30),e.BQk()),2&t){const n=c.erzLet;e.xp6(1),e.Q6J("ngIf",n)}}function un(t,c){if(1&t){const n=e.EpF();e.TgZ(0,"div",19,20),e.NdJ("click",function(o){e.CHM(n);const i=e.MAs(1),a=e.oxw(6);return e.KtG(a.onRowClick(o,i))}),e.YNc(2,ln,4,2,"ng-container",0),e.ALo(3,"async"),e.TgZ(4,"div",21),e._uU(5),e.YNc(6,dn,2,1,"ng-container",8),e.qZA(),e.TgZ(7,"div",22),e._uU(8),e.ALo(9,"date"),e.ALo(10,"date"),e.qZA(),e.TgZ(11,"div",23),e._uU(12),e.qZA(),e.YNc(13,mn,2,1,"ng-container",0),e.ALo(14,"async"),e.TgZ(15,"div",24),e._uU(16),e.ALo(17,"date"),e.qZA(),e.TgZ(18,"div",25),e._uU(19),e.ALo(20,"erzDaysDifference"),e.qZA(),e.TgZ(21,"div",26),e._uU(22),e.ALo(23,"date"),e.ALo(24,"erzDaysDifference"),e.qZA()()}if(2&t){const n=c.$implicit,s=e.oxw(6);e.xp6(2),e.Q6J("erzLet",e.lcZ(3,11,s.getPresenceCategory(n))),e.xp6(3),e.hij(" ",n.EventDesignation,""),e.xp6(1),e.Q6J("ngIf",n.StudyClassNumber),e.xp6(2),e.AsE(" ",e.xi3(9,13,n.LessonDateTimeFrom,"HH:mm"),"\u2013",e.xi3(10,16,n.LessonDateTimeTo,"HH:mm")," "),e.xp6(4),e.hij(" ",n.TeacherInformation," "),e.xp6(1),e.Q6J("erzLet",e.lcZ(14,19,s.getPresenceTypeDesignation(n))),e.xp6(3),e.hij(" ",e.xi3(17,21,n.LessonDateTimeFrom,"dd.MM.yyyy")," "),e.xp6(3),e.hij(" ",e.lcZ(20,24,n.LessonDateTimeFrom)," "),e.xp6(3),e.AsE(" ",e.xi3(23,26,n.LessonDateTimeFrom,"dd.MM.yyyy"),", ",e.lcZ(24,29,n.LessonDateTimeFrom)," ")}}function _n(t,c){if(1&t){const n=e.EpF();e.TgZ(0,"div")(1,"div",10,11),e.NdJ("click",function(o){e.CHM(n);const i=e.MAs(2),a=e.oxw(5);return e.KtG(a.onRowClick(o,i))}),e.TgZ(3,"div",12)(4,"input",13),e.NdJ("change",function(o){e.CHM(n);const i=e.oxw(5);return e.KtG(i.toggleAll(o.target.checked))}),e.ALo(5,"async"),e.qZA()(),e.TgZ(6,"div",14),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"div",15)(10,"a",16),e.ALo(11,"async"),e.TgZ(12,"i",17),e._uU(13,"edit"),e.qZA()()()(),e.YNc(14,un,25,31,"div",18),e.qZA()}if(2&t){const n=e.oxw(4).erzLet,s=e.oxw();e.xp6(4),e.Q6J("checked",e.lcZ(5,5,s.allSelected$)),e.xp6(3),e.hij(" ",e.lcZ(8,7,"my-absences.report.list.all")," "),e.xp6(3),e.ekj("disabled",0===e.lcZ(11,9,s.selectionService.selection$).length),e.xp6(4),e.Q6J("ngForOf",n.entries)}}function gn(t,c){1&t&&e._UZ(0,"erz-spinner",32)}function fn(t,c){if(1&t&&(e.TgZ(0,"div",7),e.YNc(1,_n,15,11,"div",8),e.YNc(2,gn,1,0,"erz-spinner",9),e.qZA()),2&t){const n=e.oxw(3).erzLet;e.xp6(1),e.Q6J("ngIf",n.entries&&n.entries.length>0),e.xp6(1),e.Q6J("ngIf",n.loadingPage)}}function hn(t,c){1&t&&(e.TgZ(0,"p",33),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"my-absences.report.no-entries")," "))}function bn(t,c){if(1&t&&(e.ynx(0),e.YNc(1,fn,3,2,"div",5),e.YNc(2,hn,3,3,"ng-template",null,6,e.W1O),e.BQk()),2&t){const n=e.MAs(3),s=e.oxw(2).erzLet;e.xp6(1),e.Q6J("ngIf",s.entries&&s.entries.length>0||s.loadingPage)("ngIfElse",n)}}function yn(t,c){1&t&&e._UZ(0,"erz-spinner")}function vn(t,c){if(1&t&&(e.ynx(0),e.YNc(1,bn,4,2,"ng-container",2),e.ALo(2,"async"),e.YNc(3,yn,1,0,"ng-template",null,4,e.W1O),e.BQk()),2&t){const n=e.MAs(4),s=e.oxw(2);e.xp6(1),e.Q6J("ngIf",!1===e.lcZ(2,2,s.state.loading$))("ngIfElse",n)}}function An(t,c){1&t&&(e.TgZ(0,"p",33),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"my-absences.report.no-filter")))}function xn(t,c){if(1&t){const n=e.EpF();e.ynx(0),e.TgZ(1,"erz-my-absences-report-header",1),e.NdJ("filterChange",function(o){e.CHM(n);const i=e.oxw();return e.KtG(i.state.setFilter(o))}),e.ALo(2,"async"),e.qZA(),e.YNc(3,vn,5,4,"ng-container",2),e.ALo(4,"async"),e.YNc(5,An,3,3,"ng-template",null,3,e.W1O),e.BQk()}if(2&t){const n=e.MAs(6),s=e.oxw();e.xp6(1),e.Q6J("filter",e.lcZ(2,3,s.filterFromParams$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,5,s.state.isFilterValid$))("ngIfElse",n)}}const Cn=function(t,c,n){return{selection:t,entries:c,loadingPage:n}};function Ln(t){return{dateFrom:t.dateFrom?(0,ne.nx)(t.dateFrom):null,dateTo:t.dateTo?(0,ne.nx)(t.dateTo):null}}const Zn=function(t){return{count:t}};function Sn(t,c){if(1&t&&(e.TgZ(0,"div",11),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t){const n=c.erzLet;e.xp6(1),e.hij(" ",e.xi3(2,1,1===n?"my-absences.confirm.lesson-selected":"my-absences.confirm.lessons-selected",e.VKq(4,Zn,n))," ")}}function In(t,c){if(1&t&&(e.TgZ(0,"div",17),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t){const n=c.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,"global.validation-errors."+n.error,n.params)," ")}}function Mn(t,c){if(1&t&&(e.ynx(0),e.YNc(1,In,3,4,"div",16),e.ALo(2,"async"),e.BQk()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,n.absenceTypeIdErrors$))}}const $n=function(t){return{"border-top pt-3":t}};function Rn(t,c){if(1&t&&(e.TgZ(0,"div",12),e._UZ(1,"input",13),e.ALo(2,"async"),e.TgZ(3,"label",14),e._uU(4),e.qZA(),e.YNc(5,Mn,3,3,"ng-container",15),e.ALo(6,"async"),e.qZA()),2&t){const n=c.$implicit,s=c.index,o=e.oxw();let i;e.Q6J("ngClass",e.VKq(12,$n,n.IsHalfDay)),e.xp6(1),e.ekj("is-invalid",e.lcZ(2,8,o.absenceTypeIdErrors$).length>0),e.Q6J("id","absence-type-"+s)("value",n.Id),e.xp6(2),e.Q6J("for","absence-type-"+s),e.xp6(1),e.hij(" ",n.Designation," "),e.xp6(1),e.Q6J("ngIf",(null==(i=e.lcZ(6,10,o.absenceTypes$))?null:i.length)-1===s)}}function Un(t,c){1&t&&(e.TgZ(0,"div",18)(1,"span",19),e._uU(2,"Loading..."),e.qZA()())}const Fn=[{path:"",component:ce,children:[{path:"",component:Ue},{path:"confirm",component:Qe},{path:"report",component:Be,children:[{path:"",component:(()=>{class t{constructor(n,s,o,i,a,_){this.state=n,this.selectionService=s,this.route=o,this.scrollPosition=i,this.presenceTypesService=a,this.settings=_,this.filterFromParams$=this.route.queryParams.pipe((0,l.U)(Ln)),this.allSelected$=(0,u.a)([this.selectionService.selection$,this.state.entries$.pipe((0,A.w)(d=>(0,u.a)(d.map(f=>this.getPresenceType(f)))))]).pipe((0,l.U)(([d,f])=>d.length>0&&d.length===f.filter((0,v.ff)(D.qX)).length)),this.destroy$=new Y.x}ngOnInit(){this.filterFromParams$.pipe((0,y.q)(1)).subscribe(n=>this.state.setFilter(n)),this.state.validFilter$.pipe((0,Ke.R)(this.destroy$)).subscribe(()=>this.selectionService.clear())}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}getPresenceCategory(n){return this.getPresenceType(n).pipe((0,l.U)(s=>(0,D.qX)(s)?n.ConfirmationStateId===this.settings.checkableAbsenceStateId?{category:Z.Ov.Unapproved,icon:(0,Z.ES)(Z.Ov.Unapproved)}:{category:Z.Ov.Absent,icon:(0,Z.ES)(Z.Ov.Absent)}:null))}getPresenceTypeDesignation(n){return this.presenceTypesService.displayedTypes$.pipe((0,l.U)(s=>n.TypeRef.Id&&s.find(o=>o.Id===n.TypeRef.Id)?.Designation||null))}toggleAll(n){(0,u.a)([this.state.entries$.pipe((0,y.q)(1)),this.presenceTypesService.presenceTypes$.pipe((0,y.q)(1))]).subscribe(([s,o])=>{const i=o.filter(a=>(0,D.qX)(a)).map(a=>a.Id);this.selectionService.clear(n?s.filter(a=>null==a.TypeRef.Id||!i.includes(a.TypeRef.Id)):null)})}onRowClick(n,s){const o=s.querySelector('input[type="checkbox"]');o&&n.target!==o&&!n.target.closest(".buttons")&&o.click()}getPresenceType(n){return this.presenceTypesService.presenceTypes$.pipe((0,l.U)(s=>n.TypeRef.Id&&s.find(o=>o.Id===n.TypeRef.Id)||null))}static#e=this.\u0275fac=function(s){return new(s||t)(e.Y36(w),e.Y36(Q),e.Y36(g.gz),e.Y36(Xe.X),e.Y36(F.c),e.Y36(T.L6))};static#n=this.\u0275cmp=e.Xpm({type:t,selectors:[["erz-my-absences-report-list"]],decls:4,vars:11,consts:[[4,"erzLet"],[3,"filter","filterChange"],[4,"ngIf","ngIfElse"],["noFilter",""],["loading",""],["class","py-3",4,"ngIf","ngIfElse"],["noEntries",""],[1,"py-3"],[4,"ngIf"],["class","inline",4,"ngIf"],[1,"entries-all",3,"click"],["all",""],[1,"checkbox"],["type","checkbox",1,"form-check-input",3,"checked","change"],[1,"all"],[1,"buttons"],["routerLink","confirm",1,"edit","btn","btn-primary","btn-icon","me-2"],[1,"material-icons"],["class","entry",3,"click",4,"ngFor","ngForOf"],[1,"entry",3,"click"],["row",""],[1,"lesson-class"],[1,"time","pe-2"],[1,"teacher"],[1,"date"],[1,"days-ago"],[1,"date-days-ago"],["class","checkbox",4,"ngIf","ngIfElse"],["categoryIcon",""],["checkbox",""],["class","presence-type",4,"ngIf"],[1,"presence-type"],[1,"inline"],[1,"mt-3"]],template:function(s,o){1&s&&(e.YNc(0,xn,7,7,"ng-container",0),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async")),2&s&&e.Q6J("erzLet",e.kEZ(7,Cn,e.lcZ(1,1,o.selectionService.selection$),e.lcZ(2,3,o.state.entries$),e.lcZ(3,5,o.state.loadingPage$)))},dependencies:[m.sg,m.O5,g.rH,U.e,Ve.O,on,m.Ov,m.uU,h.X$,cn.Q],styles:['.entries-all[_ngcontent-%COMP%]{padding:0 0 .5rem 1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox all buttons";grid-template-columns:min-content 1fr min-content}.entry[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox lesson-class time teacher" "checkbox presence-type date days-ago";grid-template-columns:min-content 2fr 1fr 2fr}.entry[_ngcontent-%COMP%]:first-child{padding-top:0}.entries-all[_ngcontent-%COMP%] + .entry[_ngcontent-%COMP%]{padding-top:1rem}.presence-category.absent[_ngcontent-%COMP%]{color:#ea161f}.presence-category.unapproved[_ngcontent-%COMP%]{color:#ffa814}.checkbox[_ngcontent-%COMP%]{grid-area:checkbox;margin:0;padding:.3rem 1rem 0 0}.presence-category[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{display:block;font-size:16px}.entries-all[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{padding-top:.2rem}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.all[_ngcontent-%COMP%]{grid-area:all}.buttons[_ngcontent-%COMP%]{grid-area:buttons;display:flex}.lesson-class[_ngcontent-%COMP%]{grid-area:lesson-class;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.time[_ngcontent-%COMP%]{grid-area:time}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.presence-type[_ngcontent-%COMP%]{color:#adb5bd;grid-area:presence-type}.date[_ngcontent-%COMP%]{grid-area:date}.days-ago[_ngcontent-%COMP%]{color:#adb5bd;grid-area:days-ago}.date-days-ago[_ngcontent-%COMP%]{grid-area:date-days-ago;display:none}@media (max-width: 750px){.entry[_ngcontent-%COMP%]{grid-template-areas:"checkbox lesson-class" "checkbox teacher" "checkbox date-days-ago" "checkbox time" "checkbox presence-type";grid-template-columns:min-content 1fr}.date-days-ago[_ngcontent-%COMP%]{display:block}.date[_ngcontent-%COMP%], .days-ago[_ngcontent-%COMP%]{display:none}}'],changeDetection:0})}return t})(),data:{restoreScrollPositionFrom:["/my-absences/report/confirm"]}},{path:"confirm",component:(()=>{class t extends V{constructor(n,s,o,i,a,_,d,f,S,I){super(n,s,o,i,a,_,d,f),this.state=S,this.selectionService=I,this.titleKey="my-absences.report.title",this.selectedLessonIds$=this.selectionService.selectedIds$.pipe((0,l.U)(j=>(0,z.Z)((0,R.Z)(j.map(H=>H.lessonIds))))),this.confirmationStateId=this.settings.checkableAbsenceStateId}getHalfDayType(){return this.presenceTypesService.getPresenceType(this.settings.halfDayPresenceTypeId).pipe((0,l.U)(n=>n.Active?n:null))}onSaveSuccess(){this.selectionService.clear(),this.state.resetEntries(),super.onSaveSuccess()}navigateBack(){this.state.queryParams$.pipe((0,y.q)(1)).subscribe(n=>{this.router.navigate(["/my-absences/report"],{queryParams:n})})}static#e=this.\u0275fac=function(s){return new(s||t)(e.Y36(p.QS),e.Y36(g.F0),e.Y36(N.k),e.Y36(h.sK),e.Y36(F.c),e.Y36(P.O),e.Y36($.V),e.Y36(T.L6),e.Y36(w),e.Y36(Q))};static#n=this.\u0275cmp=e.Xpm({type:t,selectors:[["erz-my-absences-confirm"]],features:[e.qOj],decls:28,vars:35,consts:[[1,"erz-container","erz-container-limited"],["class","mb-3 pb-3 border-bottom",4,"erzLet"],[3,"formGroup","ngSubmit"],[1,"form-group","mb-3","border-bottom"],[1,"form-label"],["class","form-check my-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"remark"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","click"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"mb-3","pb-3","border-bottom"],[1,"form-check","my-3",3,"ngClass"],["type","radio","formControlName","absenceTypeId",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],[4,"ngIf"],["class","invalid-feedback mt-4",4,"ngFor","ngForOf"],[1,"invalid-feedback","mt-4"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"visually-hidden"]],template:function(s,o){1&s&&(e.TgZ(0,"div",0)(1,"h1"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Sn,3,6,"div",1),e.ALo(5,"async"),e.TgZ(6,"form",2),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(7,"div",3)(8,"label",4),e._uU(9),e.ALo(10,"translate"),e.ALo(11,"addSpace"),e.qZA(),e.YNc(12,Rn,7,14,"div",5),e.ALo(13,"async"),e.qZA(),e.TgZ(14,"div",6),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"div",7)(18,"button",8),e.NdJ("click",function(){return o.cancel()}),e.ALo(19,"async"),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.TgZ(22,"button",9),e.ALo(23,"async"),e._uU(24),e.ALo(25,"translate"),e.YNc(26,Un,3,0,"div",10),e.ALo(27,"async"),e.qZA()()()()),2&s&&(e.xp6(2),e.Oqu(e.lcZ(3,12,o.titleKey)),e.xp6(2),e.Q6J("erzLet",e.lcZ(5,14,o.getSelectedCount())),e.xp6(2),e.Q6J("formGroup",o.formGroup),e.xp6(3),e.AsE("",e.lcZ(10,16,"my-absences.confirm.choose-presence-type"),"",e.xi3(11,18,":",":"),""),e.xp6(3),e.Q6J("ngForOf",e.lcZ(13,21,o.absenceTypes$)),e.xp6(3),e.hij(" ",e.lcZ(16,23,"my-absences.confirm.remark")," "),e.xp6(3),e.Q6J("disabled",e.lcZ(19,25,o.saving$)),e.xp6(2),e.hij(" ",e.lcZ(21,27,"my-absences.confirm.cancel")," "),e.xp6(2),e.Q6J("disabled",e.lcZ(23,29,o.saving$)),e.xp6(2),e.hij(" ",e.lcZ(25,31,"my-absences.confirm.save")," "),e.xp6(2),e.Q6J("ngIf",e.lcZ(27,33,o.saving$)))},dependencies:[m.mk,m.sg,m.O5,p._Y,p.Fj,p._,p.JJ,p.JL,p.sg,p.u,U.e,m.Ov,h.X$,W.u],changeDetection:0})}return t})()}]}]}];let kn=(()=>{class t{static#e=this.\u0275fac=function(s){return new(s||t)};static#n=this.\u0275mod=e.oAB({type:t});static#t=this.\u0275inj=e.cJS({imports:[g.Bz.forChild(Fn),g.Bz]})}return t})(),On=(()=>{class t{static#e=this.\u0275fac=function(s){return new(s||t)};static#n=this.\u0275mod=e.oAB({type:t});static#t=this.\u0275inj=e.cJS({providers:[J.o],imports:[se.m,kn]})}return t})()}}]);