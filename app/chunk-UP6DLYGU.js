import{a as Fe,b as je}from"./chunk-KY334V7F.js";import{b as Se,d as Pe,e as Me}from"./chunk-VF44T6U3.js";import{b as Te}from"./chunk-A4TCTMIL.js";import"./chunk-Y4QYVF5K.js";import"./chunk-TCEEBBQP.js";import{a as H}from"./chunk-EAS6YCPS.js";import{D as xe,E as Ae,F as ke,K as Oe,L as y,P as $e,R as Ee,T as Le,U as De,a as he}from"./chunk-G2L3C6GE.js";import{l as X}from"./chunk-2FCCHX6W.js";import{b as we}from"./chunk-KCOBA4SV.js";import{b as Ie}from"./chunk-GWJDWK72.js";import{A as ye,z as ve}from"./chunk-7TIAFCYF.js";import"./chunk-LXT7D3OU.js";import{$a as o,Ab as j,Ac as be,Bb as K,Bc as ge,Cb as I,Db as pe,Eb as L,F as _,Fb as B,Gb as q,Hb as le,Kb as a,La as D,Lb as l,M as V,Mb as N,P as R,Qa as C,Qd as fe,R as G,Ra as re,Rd as Ce,Sd as _e,Va as U,X as se,Xa as oe,Ya as J,Za as Q,_ as w,_a as c,aa as O,ab as x,eb as F,ec as z,f as k,fc as de,g as Y,gb as M,hb as f,ia as $,ja as P,k as te,n as b,o as S,qb as ce,rb as u,sb as v,tb as E,ub as ae,w as ne,x as ie,ya as s,yc as me,za as h,zc as ue}from"./chunk-TTJNYD2F.js";var ze=["studentFullName","studyClassNumber"],A=(()=>{class n{constructor(e,t,i,r){this.lessonPresencesService=e,this.selectionService=t,this.loadingService=i,this.translate=r,this.loading$=this.loadingService.loading$,this.search$=new Y(""),this.updateUnconfirmedAbsences$=new k,this.unconfirmedAbsences$=ne(this.loadUnconfirmedAbsences(),this.updateUnconfirmedAbsences$).pipe(V(1)),this.entries$=this.unconfirmedAbsences$.pipe(b(xe),V(1)),this.sortCriteriaSubject$=new Y({primarySortKey:"date",ascending:!1}),this.sortCriteria$=this.sortCriteriaSubject$.asObservable(),this.sortedEntries$=S([this.entries$,this.sortCriteria$]).pipe(b(X(Ae))),this.filteredEntries$=S([this.sortedEntries$,this.search$]).pipe(b(([d,p])=>Fe(d,ze,p)),V(1)),this.currentDetail=null}getUnconfirmedAbsences(e,t){return this.entries$.pipe(b(i=>{let r=i.find(d=>d.dateString===e&&d.studentId===t);return r?r.absences:[]}))}getAllUnconfirmedAbsencesForStudent(e){return this.entries$.pipe(b(t=>t.filter(i=>i.studentId===e).reduce((i,r)=>i.concat(r.absences),[])))}toggleSort(e){this.sortCriteriaSubject$.pipe(_(1)).subscribe(t=>{t.primarySortKey===e?this.sortCriteriaSubject$.next({primarySortKey:e,ascending:!t.ascending}):this.sortCriteriaSubject$.next({primarySortKey:e,ascending:e==="name"})})}get confirmBackLink(){return this.currentDetail?["/open-absences/detail",this.currentDetail.personId,this.currentDetail.date]:["/open-absences"]}updateAfterConfirm(){S([this.unconfirmedAbsences$.pipe(_(1)),this.selectionService.selectedIds$.pipe(_(1))]).pipe(b(X(ke))).subscribe(e=>{this.selectionService.clear(),this.updateUnconfirmedAbsences$.next(e)})}buildMailToString(e,t){let i=e.Email,r=this.translate.instant("open-absences.detail.mail.subject"),d=t.map(T=>Oe(T)).join("%0D%0A"),p=`${this.translate.instant("open-absences.detail.mail.body")}%0D%0A${d}`;return p.length>=1600&&(p=`${p.substring(0,1500)}%0D%0A${this.translate.instant("open-absences.detail.mail.bodyToLargeForEmailTo")}`),`${i}?subject=${r}&body=${p}`}loadUnconfirmedAbsences(){return this.loadingService.load(this.lessonPresencesService.getListOfUnconfirmed())}static{this.\u0275fac=function(t){return new(t||n)(w(Me),w(y),w(we),w(fe))}}static{this.\u0275prov=se({token:n,factory:n.\u0275fac})}}return n})();var We=()=>["/open-absences"],Ve=(()=>{class n{constructor(e,t,i,r,d,p,T){this.router=e,this.route=t,this.openAbsencesService=i,this.presenceTypesService=r,this.personService=d,this.selectionService=p,this.scrollPosition=T,this.absences$=this.route.paramMap.pipe(R(this.getAbsencesForParams.bind(this))),this.hasAbsences$=this.absences$.pipe(b(ve(1))),this.studentFullName$=this.absences$.pipe(b(m=>m[0]&&m[0].StudentFullName||null)),this.allSelected$=S([this.absences$,this.selectionService.selection$]).pipe(b(([m,W])=>m.length===W.length)),this.studentEmail$=this.absences$.pipe(b(m=>m[0]&&m[0].StudentRef.Id||null),R(m=>m?this.personService.getByIdWithEmailInfos(m):te)),this.allUnconfirmedAbsencesForStudent$=this.route.paramMap.pipe(R(this.getAbsencesForStudentParam.bind(this))),this.mailTo$=S([this.studentEmail$,this.allUnconfirmedAbsencesForStudent$]).pipe(b(([m,W])=>this.openAbsencesService.buildMailToString(m,W))),this.destroy$=new k}ngOnInit(){this.selectionService.clearNonLessonPresences(),this.route.paramMap.pipe(G(this.destroy$)).subscribe(e=>this.openAbsencesService.currentDetail={date:String(e.get("date")),personId:Number(e.get("personId"))}),this.hasAbsences$.pipe(G(this.destroy$),ie(he(ye))).subscribe(()=>void this.router.navigate(["/open-absences"]))}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}toggleAll(e){e?this.absences$.pipe(_(1)).subscribe(t=>this.selectionService.clear(t)):this.selectionService.clear()}onRowClick(e,t){e.target!==t&&t.click()}getPresenceTypeDesignation(e){return this.presenceTypesService.displayedTypes$.pipe(b(t=>e.TypeRef.Id&&t.find(i=>i.Id===e.TypeRef.Id)?.Designation||null))}getAbsencesForParams(e){return this.openAbsencesService.getUnconfirmedAbsences(String(e.get("date")),Number(e.get("personId")))}getAbsencesForStudentParam(e){return this.openAbsencesService.getAllUnconfirmedAbsencesForStudent(Number(e.get("personId")))}static{this.\u0275fac=function(t){return new(t||n)(h(be),h(me),h(A),h($e),h(Te),h(y),h(H))}}static{this.\u0275cmp=O({type:n,selectors:[["bkd-open-absences-detail"]],standalone:!0,features:[L],decls:6,vars:10,consts:[[3,"link"],[3,"absences$","selectionService","confirmLink","displayEmail","mailTo$"]],template:function(t,i){t&1&&(c(0,"div"),x(1,"bkd-backlink",0),c(2,"h1"),u(3),a(4,"async"),o()(),x(5,"bkd-student-dossier-absences",1)),t&2&&(s(),C("link",B(9,We)),s(2),v(l(4,7,i.studentFullName$)),s(2),C("absences$",i.absences$)("selectionService",i.selectionService)("confirmLink","/open-absences/confirm")("displayEmail",!0)("mailTo$",i.mailTo$))},dependencies:[De,Le,z],styles:['.content[_ngcontent-%COMP%]{padding-left:1rem;padding-right:1rem}.back[_ngcontent-%COMP%]{color:#000;text-decoration:none}.back[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]:active   span[_ngcontent-%COMP%]{text-decoration:underline}.absence-entry[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox lesson-class time teacher" "checkbox presence-type date days-ago";grid-template-columns:min-content 2fr 1fr 2fr}.checkbox[_ngcontent-%COMP%]{grid-area:checkbox;margin:0;padding:.6rem .5rem 0 0}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.all[_ngcontent-%COMP%]{grid-area:all}.lesson-class[_ngcontent-%COMP%]{grid-area:lesson-class;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.time[_ngcontent-%COMP%]{grid-area:time}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.presence-type[_ngcontent-%COMP%]{color:#adb5bd;grid-area:presence-type}.date[_ngcontent-%COMP%]{grid-area:date}.days-ago[_ngcontent-%COMP%]{color:#adb5bd;grid-area:days-ago}.date-days-ago[_ngcontent-%COMP%]{grid-area:date-days-ago;display:none}@media (max-width: 750px){.content[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.absence-entry[_ngcontent-%COMP%]{grid-template-areas:"checkbox lesson-class" "checkbox teacher" "checkbox date-days-ago" "checkbox time" "checkbox presence-type";grid-template-columns:min-content 1fr}.date-days-ago[_ngcontent-%COMP%]{display:block}.date[_ngcontent-%COMP%], .days-ago[_ngcontent-%COMP%]{display:none}}'],changeDetection:0})}}return n})();var Ye=(n,g)=>g.id,Re=()=>[],ee=n=>({count:n}),Ge=(n,g)=>["detail",n,g];function Je(n,g){if(n&1&&(c(0,"div",2)(1,"div",5),u(2),a(3,"translate"),o(),c(4,"a",6)(5,"i",7),u(6,"edit"),o()()()),n&2){f();let e=I(0);s(2),E(" ",N(3,3,"open-absences.selected",q(6,ee,e.length))," "),s(2),re("disabled",e.length===0)}}function Qe(n,g){n&1&&x(0,"bkd-spinner")}function Xe(n,g){n&1&&(c(0,"p",3),u(1),a(2,"translate"),o()),n&2&&(s(),v(l(2,1,"open-absences.noEntries")))}function Ze(n,g){if(n&1&&(c(0,"span",13),u(1),o()),n&2){let e=f().$implicit,t=f(2),i=I(4);s(),v(t.getSortDirectionCharacter(i,e))}}function et(n,g){if(n&1){let e=F();c(0,"div",12),M("click",function(){let i=$(e).$implicit,r=f(2);return P(r.openAbsencesService.toggleSort(i))}),u(1),a(2,"translate"),D(3,Ze,2,1,"span",13),o()}if(n&2){let e=g.$implicit;f(2);let t=I(4);C("className",e),s(),E(" ",l(2,3,"open-absences.list.header."+e)," "),s(2),U(t?3:-1)}}function tt(n,g){if(n&1){let e=F();c(0,"div")(1,"div",14)(2,"div",15),M("click",function(i){$(e);let r=ce(4),d=f(2);return P(d.onCheckboxCellClick(i,r))}),c(3,"input",10,0),a(5,"async"),M("change",function(){let i=$(e).$implicit,r=f(2);return P(r.selectionService.toggle(i))}),o()(),c(6,"div",16)(7,"a",17),u(8),o()(),c(9,"div",18),u(10),o(),c(11,"div",19),u(12),a(13,"translate"),o(),c(14,"div",20),u(15),a(16,"translate"),o(),c(17,"div",21),u(18),a(19,"bkdDaysDifference"),o(),c(20,"div",22),u(21),a(22,"date"),o()()()}if(n&2){let e=g.$implicit,t=f(2);s(3),C("checked",l(5,9,t.selectionService.isSelected$(e))),s(4),C("routerLink",le(22,Ge,e.studentId,e.dateString)),s(),v(e.studentFullName),s(2),E(" ",e.studyClassNumber," "),s(2),E(" ",N(13,11,t.getLessonsCountKey(e),q(25,ee,e.lessonsCount))," "),s(3),ae(" ",e.studyClassNumber,", ",N(16,14,t.getLessonsCountKey(e),q(27,ee,e.lessonsCount))," "),s(3),E(" ",l(19,17,e.date)," "),s(3),v(N(22,19,e.date,"dd.MM.yyyy"))}}function nt(n,g){if(n&1){let e=F();c(0,"div",4)(1,"div",8)(2,"div",9)(3,"input",10),M("change",function(i){$(e);let r=f();return P(r.onToggleAll(i.currentTarget==null?null:i.currentTarget.checked))}),o()(),J(4,et,4,5,"div",11,oe),o(),J(6,tt,23,29,"div",null,Ye),o()}if(n&2){let e=f(),t=I(0),i=I(2);s(3),C("checked",t.length===i.length),s(),Q(e.primarySortKeys),s(2),Q(i)}}var Ue=(()=>{class n{constructor(e,t,i){this.openAbsencesService=e,this.selectionService=t,this.scrollPosition=i,this.primarySortKeys=["name","date"],this.destroy$=new k}ngOnInit(){this.openAbsencesService.currentDetail=null,this.selectionService.clearNonOpenAbsencesEntries()}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}onToggleAll(e){this.openAbsencesService.filteredEntries$.pipe(_(1)).subscribe(t=>{this.selectionService.clear(e?t:null)})}onCheckboxCellClick(e,t){e.target!==t&&t.click()}getSortDirectionCharacter(e,t){return e.primarySortKey!==t?"":e.ascending?"\u2193":"\u2191"}getLessonsCountKey(e){return`open-absences.list.content.lessonsCount.${e.lessonsCount===1?"singular":"plural"}`}static{this.\u0275fac=function(t){return new(t||n)(h(A),h(y),h(H))}}static{this.\u0275cmp=O({type:n,selectors:[["bkd-open-absences-list"]],standalone:!0,features:[L],decls:22,vars:29,consts:[["checkbox",""],[1,"d-flex","header-search",3,"valueChange","value","placeholder","label"],[1,"d-flex","align-items-center","justify-content-between","mt-1"],[1,"mt-3"],[1,"content"],[1,"selection-count","ps-1"],["routerLink","/open-absences/confirm",1,"edit","btn","btn-primary","btn-edit","mt-1","mb-2"],[1,"material-icons"],[1,"absence-header"],[1,"checkbox"],["type","checkbox",1,"form-check-input",3,"change","checked"],[3,"className"],[3,"click","className"],[1,"sort-direction"],[1,"absence-entry"],[1,"checkbox",3,"click"],[1,"name","pe-2"],[3,"routerLink"],[1,"study-class"],[1,"lessons-count"],[1,"study-class-lessons-count"],[1,"days-ago"],[1,"date"]],template:function(t,i){if(t&1){let r=F();j(0),a(1,"async"),j(2),a(3,"async"),j(4),a(5,"async"),j(6),a(7,"async"),c(8,"h1"),u(9),a(10,"translate"),o(),c(11,"div")(12,"div")(13,"bkd-resettable-input",1),a(14,"async"),a(15,"translate"),a(16,"translate"),M("valueChange",function(p){return $(r),P(i.openAbsencesService.search$.next(p))}),o(),D(17,Je,7,8,"div",2),o(),D(18,Qe,1,0,"bkd-spinner"),a(19,"async"),D(20,Xe,3,3,"p",3)(21,nt,8,1,"div",4),o()}if(t&2){let r,d,p;K((r=l(1,6,i.selectionService.selection$))!==null&&r!==void 0?r:B(27,Re)),s(2);let T=K((d=l(3,9,i.openAbsencesService.filteredEntries$))!==null&&d!==void 0?d:B(28,Re));s(2),K(l(5,12,i.openAbsencesService.sortCriteria$));let m=((p=(p=l(7,15,i.openAbsencesService.sortedEntries$))==null?null:p.length)!==null&&p!==void 0?p:0)===0||T.length===0;s(5),v(l(10,17,"open-absences.title")),s(4),C("value",l(14,19,i.openAbsencesService.search$))("placeholder",l(15,21,"open-absences.search-by-name-or-class"))("label",l(16,23,"open-absences.search")),s(4),U(m?-1:17),s(),U(l(19,25,i.openAbsencesService.loading$)?18:m?20:21)}},dependencies:[je,ge,Ie,z,de,_e,Ce,Ee],styles:['.header-search[_ngcontent-%COMP%]{max-width:500px}.absence-header[_ngcontent-%COMP%]{cursor:pointer;padding:1rem;display:grid;grid-template-areas:"checkbox name date";grid-template-columns:min-content 5fr 1fr;border-top:1px solid #dee2e6;border-bottom:2px solid #dee2e6;align-items:center}.absence-entry[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox name study-class lessons-count days-ago date";grid-template-columns:min-content 2fr 1fr 1fr 1fr 1fr;align-items:center}.checkbox[_ngcontent-%COMP%]{align-self:start;grid-area:checkbox;margin:0;padding:.3rem 1rem 0 0}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.name[_ngcontent-%COMP%]{grid-area:name;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.lessons-count[_ngcontent-%COMP%]{grid-area:lessons-count}.study-class[_ngcontent-%COMP%]{grid-area:study-class}.study-class-lessons-count[_ngcontent-%COMP%]{grid-area:study-class-lessons-count;display:none}.days-ago[_ngcontent-%COMP%]{color:#6c757d;grid-area:days-ago}.date[_ngcontent-%COMP%]{grid-area:date}@media (max-width: 750px){.content[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.absence-header[_ngcontent-%COMP%]{grid-template-areas:"checkbox name date";grid-template-columns:min-content 3fr 2fr}.absence-entry[_ngcontent-%COMP%]{grid-template-areas:"checkbox name date" "checkbox study-class-lessons-count days-ago";grid-template-columns:min-content 3fr 2fr}.study-class-lessons-count[_ngcontent-%COMP%]{display:block}.study-class[_ngcontent-%COMP%], .lessons-count[_ngcontent-%COMP%]{display:none}.days-ago[_ngcontent-%COMP%], .study-class-lessons-count[_ngcontent-%COMP%]{font-size:.875rem;color:#adb5bd}}'],changeDetection:0})}}return n})();var Ke=(()=>{class n{constructor(){}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=O({type:n,selectors:[["bkd-open-absences"]],standalone:!0,features:[pe([A,y,{provide:Se,useExisting:A}]),L],decls:1,vars:0,template:function(t,i){t&1&&x(0,"router-outlet")},dependencies:[ue],changeDetection:0})}}return n})();var Vt=[{path:"",component:Ke,children:[{path:"",component:Ue,data:{restoreScrollPositionFrom:["/open-absences/detail/:personId/:date","/open-absences/confirm"]}},{path:"detail/:personId/:date",component:Ve,data:{restoreScrollPositionFrom:["/open-absences/confirm"]}},{path:"confirm",component:Pe}]}];export{Vt as OPEN_ABSENCES_ROUTES};
