import{b as Me}from"./chunk-I27QBANF.js";import{b as _e}from"./chunk-Y4QYVF5K.js";import{a as Se}from"./chunk-56A7FKFV.js";import{i as xe}from"./chunk-YNODG5RP.js";import"./chunk-SNNR7FJ6.js";import"./chunk-EFJ6WEH7.js";import{a as ve}from"./chunk-LYDHS67M.js";import{N as ye,P as be,r as ae,z as re}from"./chunk-ZXUJZ6KS.js";import{$ as H,Ae as E,Cc as c,Dc as p,Eb as _,G as q,Gb as b,Ib as v,Kb as X,Lb as x,Mb as M,Nb as h,Ob as l,Pb as a,Qb as y,S as z,U as D,Uc as oe,Wb as Z,Xb as T,Zd as le,_ as R,_d as ce,a as P,b as I,ba as F,ce as w,da as N,db as s,de as pe,ga as B,gc as L,ge as de,he as me,ia as Y,ic as f,id as se,j as K,ja as J,jc as C,k as W,kc as k,le as ue,ne as he,oa as m,ob as u,oc as ee,pc as te,q as G,qc as ie,rc as A,sc as j,tc as V,v as S,ve as fe,wb as Q,wc as ne,we as O,xe as ge,ze as Ce}from"./chunk-GP622B77.js";var Te=(()=>{let t=class t{constructor(){this.settings=m(re),this.storage=m(Se),this.currentRoles=null}getNotificationTypes(){return this.getNotificationTypeKeys().map(e=>{if(!(e in this.settings.notificationTypes))throw new Error(`Key '${e}' is missing in 'notificationTypes' setting`);return{key:e,text:this.settings.notificationTypes[e]}})}getNotificationTypeKeys(){return ye(this.settings.notificationTypesAssignments.reduce((e,{roles:n,types:o})=>this.hasAnyRole(n)?[...e,...o]:e,[]))}hasAnyRole(e){return this.currentRoles===null&&(this.currentRoles=_e(this.storage.getPayload()?.roles)),this.currentRoles.some(n=>e.includes(n))}};t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=J({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();var ke=(()=>{let t=class t{constructor(){this.id=null,this.label=null,this.disabled=!1,this.value=!1,this.valueChange=new Q,this.fallbackId=be("bkd-switch")}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=u({type:t,selectors:[["bkd-switch"]],inputs:{id:"id",label:"label",disabled:"disabled",value:"value"},outputs:{valueChange:"valueChange"},decls:3,vars:5,consts:[["type","checkbox",3,"ngModelChange","disabled","ngModel"]],template:function(n,o){n&1&&(l(0,"input",0),Z("ngModelChange",function(g){return o.valueChange.emit(g)}),a(),l(1,"label"),f(2),a()),n&2&&(h("disabled",o.disabled)("ngModel",o.value),_("id",o.id??o.fallbackId),s(),_("for",o.id??o.fallbackId),s(),C(o.label))},dependencies:[O,ce,w,de],styles:['input[_ngcontent-%COMP%]{opacity:0;position:absolute}label[_ngcontent-%COMP%]{cursor:pointer;text-indent:-9999px;width:36px;height:18px;border:1px solid rgb(0,0,0);background:#fff;display:block;border-radius:18px;position:relative}label[_ngcontent-%COMP%]:after{content:"";position:absolute;top:1px;left:1px;width:14px;height:14px;background:#000;border-radius:14px;transition:.3s}input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{border-color:#000;background:#000}input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 1px);transform:translate(-100%);background:#fff}input[_ngcontent-%COMP%]:focus + label[_ngcontent-%COMP%]{box-shadow:0 0 0 .25rem #4e4e4e40}input[_ngcontent-%COMP%]:disabled + label[_ngcontent-%COMP%]{cursor:default;background:#fff;border-color:#dedede}input[_ngcontent-%COMP%]:disabled + label[_ngcontent-%COMP%]:after{background:#dedede}label[_ngcontent-%COMP%]:active:after{width:18.2px}'],changeDetection:0});let i=t;return i})();function Pe(i,t){if(i&1&&(l(0,"div"),f(1),a()),i&2){let r=t.$implicit;s(),k(" ",r," ")}}function Ie(i,t){if(i&1&&(l(0,"div",3),x(1,Pe,2,1,"div",null,X),a()),i&2){let r=T();s(),M(r.descriptionLines)}}var $e=(()=>{let t=class t{constructor(){this.cd=m(oe),this.id="",this.label="",this.description=null,this.disabled=!1,this.onChange=e=>{},this.onTouched=()=>{},this._value=!1}get value(){return this._value}set value(e){this._value=e,this.onChange(e)}get descriptionLines(){return this.description?this.description.split(`
`):[]}writeValue(e){this._value=e}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled=e,this.cd.markForCheck()}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=u({type:t,selectors:[["bkd-my-settings-notifications-toggle"]],inputs:{id:"id",label:"label",description:"description",disabled:"disabled"},features:[ne([{provide:le,useExisting:Y(()=>t),multi:!0}])],decls:5,vars:6,consts:[[1,"d-flex","align-items-center"],[1,"flex-fill"],[3,"valueChange","id","value","disabled"],[1,"form-text"]],template:function(n,o){n&1&&(l(0,"div",0)(1,"label",1),f(2),a(),l(3,"bkd-switch",2),ie("valueChange",function(g){return te(o.value,g)||(o.value=g),g}),a()(),b(4,Ie,3,0,"div",3)),n&2&&(s(),_("for",o.id),s(),k(" ",o.label," "),s(),h("id",o.id),ee("value",o.value),h("disabled",o.disabled),s(),v(o.description?4:-1))},dependencies:[ke],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0});let i=t;return i})();var Fe=(i,t)=>t.key;function Ge(i,t){i&1&&(l(0,"div",2),y(1,"bkd-spinner",5),a())}function De(i,t){if(i&1&&(y(0,"bkd-my-settings-notifications-toggle",7),c(1,"async"),c(2,"async")),i&2){let r=t.$implicit,e=t.$index;L("mt-4",e>0),h("id","notification-channels-"+r.key)("label",p(1,6,r.label))("description",p(2,8,r.description))("formControlName",r.key)}}function Re(i,t){if(i&1&&(l(0,"form",3),x(1,De,3,10,"bkd-my-settings-notifications-toggle",6,Fe),a()),i&2){let r=T(),e=V(0);h("formGroup",e),s(),M(r.channelsSettings)}}function Be(i,t){if(i&1&&(y(0,"bkd-my-settings-notifications-toggle",7),c(1,"async"),c(2,"async")),i&2){let r=t.$implicit,e=t.$index;L("mt-4",e>0),h("id","notification-types-"+r.key)("label",p(1,6,r.label))("description",p(2,8,r.description))("formControlName",r.key)}}function Le(i,t){if(i&1&&(l(0,"form",3),x(1,Be,3,10,"bkd-my-settings-notifications-toggle",6,Fe),a()),i&2){let r=T(),e=V(2);h("formGroup",e),s(),M(r.typesSettings)}}var Ne=(()=>{let t=class t{constructor(){this.userSettings=m(Me),this.formBuilder=m(fe),this.toastService=m(ve),this.translate=m(Ce),this.notificationTypes=m(Te),this.channelsSettings=[{key:"gui",label:this.translate.get("my-settings.notifications.gui")},{key:"mail",label:this.translate.get("my-settings.notifications.mail")},{key:"phoneMobile",label:this.translate.get("my-settings.notifications.phoneMobile")}],this.typesSettings=this.notificationTypes.getNotificationTypes().map(e=>{let{label:n,description:o}=this.translate.currentLang==="fr-CH"?e.text.fr:e.text.de;return{key:e.key,label:G(n),description:G(o)}}),this.channelsValue$=this.userSettings.getNotificationChannels(),this.typesValue$=this.userSettings.getNotificationTypesInactive().pipe(S(this.typesArrayToRecord.bind(this))),this.channelsFormGroup$=this.channelsValue$.pipe(S(e=>this.createFormGroup(this.channelsSettings,e)),R(1)),this.allChannelsInactive$=q(this.channelsValue$,this.channelsFormGroup$.pipe(F(e=>e.valueChanges))).pipe(S(e=>Object.values(e).every(n=>!n)),z()),this.typesFormGroup$=this.typesValue$.pipe(B(this.allChannelsInactive$),S(([e,n])=>this.createFormGroup(this.typesSettings,e,!0,n)),R(1)),this.saving$=new W(!1),this.destroy$=new K}ngOnInit(){this.userSettings.refetch(),this.allChannelsInactive$.pipe(H(1),B(this.typesFormGroup$),N(this.destroy$)).subscribe(([e,n])=>{Object.values(n.controls).forEach(o=>e?o.disable():o.enable())}),this.channelsFormGroup$.pipe(N(this.destroy$),F(e=>e.valueChanges)).subscribe(this.saveChannels.bind(this)),this.typesFormGroup$.pipe(N(this.destroy$),F(e=>e.valueChanges)).subscribe(this.saveTypes.bind(this))}ngOnDestroy(){this.destroy$.next()}createFormGroup(e,n,o=!1,d=!1){return this.formBuilder.group(e.reduce((g,{key:U})=>I(P({},g),{[U]:[{value:n[U]??o,disabled:d}]}),{}))}saveChannels(e){this.saving$.next(!0),this.userSettings.saveNotificationChannels(e).pipe(D(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}saveTypes(e){this.saving$.next(!0),this.userSettings.saveNotificationTypesInactive(this.typesRecordToArray(e)).pipe(D(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("my-settings.notifications.save-success"))}typesArrayToRecord(e){return this.typesSettings.reduce((o,{key:d})=>I(P({},o),{[d]:!e.includes(d)}),{})}typesRecordToArray(e){return Object.keys(e).reduce((o,d)=>e[d]?o:[...o,d],[])}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=u({type:t,selectors:[["bkd-my-settings-notifications"]],decls:17,vars:17,consts:[[1,"pb-4"],[1,"m-0","pb-3","d-flex","align-items-stretch"],[1,"position-relative"],[3,"formGroup"],[1,"mt-4","form-text"],[1,"position-absolute","inline","small","d-inline-block","ms-2"],[3,"id","label","description","formControlName","mt-4"],[3,"id","label","description","formControlName"]],template:function(n,o){if(n&1&&(A(0),c(1,"async"),A(2),c(3,"async"),l(4,"div",0)(5,"h2",1)(6,"span"),f(7),c(8,"translate"),a(),b(9,Ge,2,0,"div",2),c(10,"async"),a(),b(11,Re,3,1,"form",3),l(12,"p",4),f(13),c(14,"translate"),a(),y(15,"hr"),b(16,Le,3,1,"form",3),a()),n&2){let d=j(p(1,5,o.channelsFormGroup$));s(2);let g=j(p(3,8,o.typesFormGroup$));s(5),C(p(8,11,"my-settings.notifications.title")),s(2),v(p(10,13,o.saving$)?9:-1),s(2),v(d?11:-1),s(2),k(" ",p(14,15,"my-settings.notifications.privacy-hint")," "),s(3),v(g?16:-1)}},dependencies:[xe,O,me,w,pe,ge,ue,he,$e,se,E],styles:[".checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important}"],changeDetection:0});let i=t;return i})();var we=(()=>{let t=class t{};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=u({type:t,selectors:[["bkd-my-settings-show"]],decls:5,vars:3,consts:[[1,"bkd-container","bkd-container-limited"]],template:function(n,o){n&1&&(l(0,"div",0)(1,"h1"),f(2),c(3,"translate"),a(),y(4,"bkd-my-settings-notifications"),a()),n&2&&(s(2),C(p(3,1,"my-settings.title")))},dependencies:[Ne,E],encapsulation:2});let i=t;return i})();var Oe=(()=>{let t=class t{constructor(){}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=u({type:t,selectors:[["bkd-my-settings"]],decls:1,vars:0,template:function(n,o){n&1&&y(0,"router-outlet")},dependencies:[ae],encapsulation:2,changeDetection:0});let i=t;return i})();var wt=[{path:"",component:Oe,children:[{path:"",component:we}]}];export{wt as MY_SETTINGS_ROUTES};
