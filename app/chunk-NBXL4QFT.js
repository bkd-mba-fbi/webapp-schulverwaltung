import{a as be,b as he,c as ye}from"./chunk-VANM6WSB.js";import{a as Ce}from"./chunk-Y3BQLEPF.js";import{a as me}from"./chunk-FN7XEGJE.js";import{a as pe}from"./chunk-SME4UDGV.js";import"./chunk-GCWE54XA.js";import"./chunk-DJNW6R6G.js";import"./chunk-N2RKIMWO.js";import{c as ae,e as D}from"./chunk-FMUJPUYQ.js";import"./chunk-SKUS47ZU.js";import"./chunk-Y4QYVF5K.js";import"./chunk-H664QRX4.js";import{a as ue,b as _e,c as ve}from"./chunk-2ZRHGKSY.js";import{f as se}from"./chunk-26VH6QDS.js";import{d as de}from"./chunk-JGKXAFYO.js";import"./chunk-A7EOJZ46.js";import"./chunk-ZELJ2QPT.js";import{a as fe}from"./chunk-UZJ4FIXB.js";import{D as oe,f as ne}from"./chunk-KQORGECX.js";import"./chunk-K42F6AEW.js";import"./chunk-NC6UEGAF.js";import{i as re,j as le}from"./chunk-SL67CYEF.js";import{h as ce}from"./chunk-HQSONWXM.js";import{u as ie}from"./chunk-RXRYDGZR.js";import"./chunk-F4XODHS2.js";import{$ as d,$a as P,$b as J,Bb as F,Bc as Y,Cb as w,Cc as Z,Db as I,Eb as R,Ec as ee,F as H,Fb as B,Gb as S,Hb as X,Ia as g,Ib as z,Jb as V,M as W,Nb as s,Ob as l,P as M,Pa as C,R as j,Ra as G,Sa as v,Sd as $,X as q,Xa as b,_a as T,ab as a,bb as r,cb as E,dc as K,ea as k,fa as A,gb as L,gc as Q,hd as te,ib as h,jb as m,ma as U,n as O,vb as u,wb as y,xb as f,ya as o}from"./chunk-NEW5VGRB.js";var x=(()=>{class e extends _e{constructor(){let t=d(J),i=d(re),n=d(te),_=d(ve);super(t,i,_,n,"/evaluate-absences"),this.lessonPresenceService=d(D),this.queryParamsString$.pipe(j(this.destroy$)).subscribe(p=>this.confirmBackLinkParams={returnparams:p})}updateAfterConfirm(){this.resetEntries()}getInitialFilter(){return{student:null,educationalEvent:null,studyClass:null}}isValidFilter(t){return!!(t.student||t.educationalEvent||t.studyClass)}getInitialSorting(){return{key:"StudentFullName",ascending:!0}}loadEntries(t,i,n){return this.loadingService.load(this.lessonPresenceService.getStatistics(t,i,n),ue)}buildParamsFromFilter(t){return be(t)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return e})();var Se=(()=>{class e{constructor(){this.studentsService=d(se),this.educationalEventsService=d(ye),this.studyClassesService=d(me),this.filter={student:null,educationalEvent:null,studyClass:null},this.filterChange=new U,this.classesHttpFilter={params:{fields:"IsActive","filter.IsActive":"=true"}}}show(){this.filterChange.emit(this.filter)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=g({type:e,selectors:[["bkd-evaluate-absences-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},decls:20,vars:19,consts:[[1,"row","g-3","align-items-end"],[1,"col-sm-12","col-md"],[1,"form-label"],[3,"valueChange","typeaheadService","value"],[3,"valueChange","typeaheadService","value","additionalHttpParams"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"div",1)(2,"label",2),u(3),s(4,"translate"),r(),a(5,"bkd-typeahead",3),I("valueChange",function(p){return w(n.filter.student,p)||(n.filter.student=p),p}),r()(),a(6,"div",1)(7,"label",2),u(8),s(9,"translate"),r(),a(10,"bkd-typeahead",3),I("valueChange",function(p){return w(n.filter.educationalEvent,p)||(n.filter.educationalEvent=p),p}),r()(),a(11,"div",1)(12,"label",2),u(13),s(14,"translate"),r(),a(15,"bkd-typeahead",4),I("valueChange",function(p){return w(n.filter.studyClass,p)||(n.filter.studyClass=p),p}),r()(),a(16,"div",5)(17,"button",6),h("click",function(){return n.show()}),u(18),s(19,"translate"),r()()()),i&2&&(o(3),y(l(4,11,"evaluate-absences.header.student")),o(2),v("typeaheadService",n.studentsService),F("value",n.filter.student),o(3),y(l(9,13,"evaluate-absences.header.module-instance")),o(2),v("typeaheadService",n.educationalEventsService),F("value",n.filter.educationalEvent),o(3),y(l(14,15,"evaluate-absences.header.study-class")),o(2),v("typeaheadService",n.studyClassesService),F("value",n.filter.studyClass),v("additionalHttpParams",n.classesHttpFilter),o(3),f(" ",l(19,17,"evaluate-absences.header.show")," "))},dependencies:[Ce,$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1rem 1rem 1rem 0;border-bottom:1px solid #dee2e6}"],changeDetection:0})}}return e})();var ge=(e,c)=>c.key,Ae=(e,c)=>c.StudentRef.Id,Le=()=>[],Te=e=>["student",e,"absences"],Pe=e=>({returnparams:e});function Fe(e,c){e&1&&E(0,"bkd-spinner")}function we(e,c){if(e&1){let t=L();a(0,"th",9),h("click",function(){let n=k(t).$implicit,_=m(4);return A(_.state.sortService.toggleSorting(n.key))}),a(1,"div",10)(2,"div",11),s(3,"translate"),u(4),s(5,"translate"),r(),a(6,"div",12),u(7),s(8,"async"),r()()()}if(e&2){let t=c.$implicit,i=m(4);v("ngClass",t.label),o(2),v("ngbTooltip",l(3,4,"evaluate-absences.list.header."+t.label)),o(2),f(" ",l(5,6,"evaluate-absences.list.header."+t.label)," "),o(3),f(" ",l(8,8,i.state.sortService.getSortingChar$(t.key))," ")}}function Ie(e,c){if(e&1&&(a(0,"a",13),s(1,"async"),u(2),r()),e&2){let t=m().$implicit,i=m().$implicit,n=m(5);v("routerLink",V(5,Te,i.StudentRef.Id))("queryParams",V(7,Pe,l(1,3,n.profileReturnParams$))),o(2),f(" ",i[t.key]," ")}}function Re(e,c){if(e&1&&u(0),e&2){let t=m().$implicit,i=m().$implicit;f(" ",i[t.key]," ")}}function Be(e,c){if(e&1&&(a(0,"td"),s(1,"translate"),C(2,Ie,3,9,"a",13)(3,Re,1,1),r()),e&2){let t=c.$implicit;G("data-label",l(1,2,"evaluate-absences.list.header."+t.label)),o(2),b(t.key==="StudentFullName"?2:3)}}function $e(e,c){if(e&1&&(a(0,"tr"),T(1,Be,4,4,"td",null,ge),r()),e&2){let t=m(5);o(),P(t.columns)}}function De(e,c){if(e&1&&(a(0,"tbody"),T(1,$e,3,0,"tr",null,Ae),r()),e&2){m(4);let t=S(0);o(),P(t)}}function Me(e,c){e&1&&E(0,"bkd-spinner",7)}function Ve(e,c){if(e&1){let t=L();a(0,"button",14),h("click",function(){k(t);let n=m(4);return A(n.state.nextPage())}),u(1),s(2,"translate"),r()}e&2&&(o(),f(" ",l(2,1,"global.pagination.load-more")," "))}function Ne(e,c){if(e&1){let t=L();a(0,"div",2)(1,"div",3),E(2,"bkd-reports-link",4),s(3,"async"),r(),a(4,"table",5),h("scrolled",function(){k(t);let n=m(3);return A(n.onScroll())}),a(5,"thead")(6,"tr"),T(7,we,9,10,"th",6,ge),r()(),C(9,De,3,0,"tbody"),r(),C(10,Me,1,0,"bkd-spinner",7)(11,Ve,3,3,"button",8),r()}if(e&2){let t,i=m(3),n=S(0),_=S(2),p=S(4);o(2),v("reports",(t=l(3,4,i.reports$))!==null&&t!==void 0?t:z(6,Le)),o(5),P(i.columns),o(2),b(n&&n.length>0?9:-1),o(),b(p?10:-1),o(),b(_&&!p?11:-1)}}function Oe(e,c){e&1&&(a(0,"p",1),u(1),s(2,"translate"),r()),e&2&&(o(),f(" ",l(2,1,"evaluate-absences.no-entries")," "))}function He(e,c){if(e&1&&C(0,Ne,12,7,"div",2)(1,Oe,3,3,"p",1),e&2){m(2);let t=S(0),i=S(4);b(t&&t.length>0||i?0:1)}}function We(e,c){if(e&1&&(C(0,Fe,1,0,"bkd-spinner"),s(1,"async"),C(2,He,2,1)),e&2){let t=m();b(l(1,1,t.state.loading$)?0:2)}}function je(e,c){e&1&&(a(0,"p",1),u(1),s(2,"translate"),r()),e&2&&(o(),y(l(2,1,"evaluate-absences.no-filter")))}var Ee=(()=>{class e{constructor(){this.state=d(x),this.scrollPosition=d(fe),this.route=d(Y),this.presenceTypesService=d(ne),this.reportsService=d(de),this.lessonPresencesService=d(D),this.reports$=this.loadReports(),this.columns=[{key:"StudentFullName",label:"student"},{key:"TotalAbsences",label:"total"},{key:"TotalAbsencesValidExcuse",label:"valid-excuse"},{key:"TotalAbsencesWithoutExcuse",label:"without-excuse"},{key:"TotalAbsencesUnconfirmed",label:"unconfirmed"},{key:"TotalAbsencesUnchecked",label:"unchecked"},{key:"TotalIncidents",label:"incident"}],this.filterFromParams$=this.route.queryParams.pipe(O(qe)),this.profileReturnParams$=this.state.queryParamsString$}ngOnInit(){this.filterFromParams$.pipe(H(1)).subscribe(t=>this.state.setFilter(t)),this.presenceTypesService.halfDayActive$.subscribe(t=>{t&&(this.columns=[...this.columns,{key:"TotalHalfDays",label:"halfday"}])})}ngAfterViewInit(){this.scrollPosition.restore()}onScroll(){this.state.nextPage()}loadReports(){return this.state.validFilter$.pipe(M(t=>this.lessonPresencesService.getLessonRefs(t)),M(t=>t.length>0?this.reportsService.getEvaluateAbsencesReports(this.getReportRecordIds(t)):[]),W(1))}getReportRecordIds(t){return t.map(i=>`${i.LessonRef.Id}_${i.RegistrationRef.Id}`)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=g({type:e,selectors:[["bkd-evaluate-absences-list"]],decls:14,vars:18,consts:[[3,"filterChange","filter"],[1,"mt-3"],[1,"py-3"],[1,"buttons"],[1,"mb-2",3,"reports"],["infiniteScroll","",1,"table","table-striped","table-fixed",3,"scrolled"],["scope","col",3,"ngClass"],[1,"inline"],["type","button",1,"btn","btn-outline-secondary","btn-sm","d-block","mx-auto"],["scope","col",3,"click","ngClass"],[1,"d-flex"],[1,"column-title",3,"ngbTooltip"],[1,"sort-direction"],[1,"student",3,"routerLink","queryParams"],["type","button",1,"btn","btn-outline-secondary","btn-sm","d-block","mx-auto",3,"click"]],template:function(i,n){if(i&1){let _=L();R(0),s(1,"async"),R(2),s(3,"async"),R(4),s(5,"async"),a(6,"h1"),u(7),s(8,"translate"),r(),a(9,"bkd-evaluate-absences-header",0),s(10,"async"),h("filterChange",function(ke){return k(_),A(n.state.setFilter(ke))}),r(),C(11,We,3,3),s(12,"async"),C(13,je,3,3,"p",1)}i&2&&(B(l(1,3,n.state.entries$)),o(2),B(l(3,6,n.state.hasMore$)),o(2),B(l(5,9,n.state.loadingPage$)),o(3),y(l(8,12,"evaluate-absences.title")),o(2),v("filter",l(10,14,n.filterFromParams$)),o(2),b(l(12,16,n.state.isFilterValid$)?11:13))},dependencies:[Se,le,he,K,ie,ee,ce,Q,$],styles:["th[_ngcontent-%COMP%]{cursor:pointer}th.student[_ngcontent-%COMP%]{width:30%}.column-title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"],changeDetection:0})}}return e})();function qe(e){return{student:e.student?Number(e.student):null,educationalEvent:e.educationalEvent?Number(e.educationalEvent):null,studyClass:e.studyClass?Number(e.studyClass):null}}var xe=(()=>{class e{constructor(){this.state=d(x)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=g({type:e,selectors:[["bkd-evaluate-absences"]],features:[X([x,{provide:ae,useExisting:x},oe])],decls:1,vars:0,template:function(i,n){i&1&&E(0,"router-outlet")},dependencies:[Z],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}}return e})();var Wt=[{path:"",component:xe,children:[{path:"",component:Ee,data:{restoreScrollPositionFrom:["/evaluate-absences/student/:id"]}},pe]}];export{Wt as EVALUATE_ABSENCES_ROUTES};
