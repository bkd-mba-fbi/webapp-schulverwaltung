import{a as de}from"./chunk-HGZDPHGY.js";import{a as Ce,b as fe,c as ve}from"./chunk-D65PNOPA.js";import{a as ue}from"./chunk-GV255ZYY.js";import{a as ce}from"./chunk-SAPHGUXN.js";import{a as pe,b as me}from"./chunk-RSH73DDE.js";import{a as le}from"./chunk-2OGX72FJ.js";import"./chunk-BMSLE3QC.js";import{f as ae}from"./chunk-R57N3KQJ.js";import"./chunk-42ODZPRN.js";import{d as se}from"./chunk-3Y4IHYFH.js";import"./chunk-TB6BZPNF.js";import"./chunk-7467TME2.js";import{a as _e}from"./chunk-SXXOG4G2.js";import{c as ne,e as D}from"./chunk-TKJDMFYQ.js";import{C as ie,f as te}from"./chunk-SDJFSJVJ.js";import"./chunk-KZKFAENE.js";import"./chunk-3MQT4YQ4.js";import"./chunk-DAMT53C4.js";import{j as oe}from"./chunk-4QADG3V2.js";import"./chunk-Y4QYVF5K.js";import"./chunk-M3OI3IZ2.js";import"./chunk-JDICAM5O.js";import"./chunk-R6JDUSOG.js";import"./chunk-YHCR7GAG.js";import"./chunk-IBM6IU7V.js";import"./chunk-O6FPKIVG.js";import{i as re}from"./chunk-FGZ22EAH.js";import{u as ee}from"./chunk-PQCUED26.js";import"./chunk-R5Z3WMFK.js";import"./chunk-DQAQYQ7K.js";import"./chunk-V5EJL46U.js";import{$a as v,Ab as b,Ba as a,Bb as h,Fb as x,Gb as k,Gc as Q,Hb as A,Hc as Y,I as W,Ib as R,Jb as B,Jc as Z,Kb as y,La as S,Lb as G,Mb as X,Nb as M,P as O,Rb as s,S as V,Sa as f,Sb as l,U as j,Ua as K,Va as _,_ as q,ca as p,cb as w,ce as $,db as I,eb as r,fb as o,gb as E,ha as T,ia as P,ic as z,kb as F,lc as J,mb as g,nb as m,p as N,pa as U,zb as u}from"./chunk-4HLXNFKK.js";var L=(()=>{class e extends me{constructor(){super("/evaluate-absences"),this.lessonPresenceService=p(D),this.queryParamsString$.pipe(j(this.destroy$)).subscribe(t=>this.confirmBackLinkParams={returnparams:t})}updateAfterConfirm(){this.resetEntries()}getInitialFilter(){return{student:null,educationalEvent:null,studyClass:null}}isValidFilter(t){return!!(t.student||t.educationalEvent||t.studyClass)}getInitialSortCriteria(){return{primarySortKey:"StudentFullName",ascending:!0}}loadEntries(t,n,i){return this.loadingService.load(this.lessonPresenceService.getStatistics(t,n,i),pe)}buildParamsFromFilter(t){return Ce(t)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=q({token:e,factory:e.\u0275fac})}}return e})();var be=(()=>{class e{constructor(){this.studentsService=p(ae),this.educationalEventsService=p(ve),this.studyClassesService=p(ce),this.filter={student:null,educationalEvent:null,studyClass:null},this.filterChange=new U,this.classesHttpFilter={params:{fields:"IsActive","filter.IsActive":"=true"}}}show(){this.filterChange.emit(this.filter)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-evaluate-absences-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},decls:20,vars:19,consts:[[1,"row","g-3","align-items-end"],[1,"col-sm-12","col-md"],[1,"form-label"],[3,"valueChange","typeaheadService","value"],[3,"valueChange","typeaheadService","value","additionalHttpParams"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(n,i){n&1&&(r(0,"div",0)(1,"div",1)(2,"label",2),u(3),s(4,"translate"),o(),r(5,"bkd-typeahead",3),A("valueChange",function(d){return k(i.filter.student,d)||(i.filter.student=d),d}),o()(),r(6,"div",1)(7,"label",2),u(8),s(9,"translate"),o(),r(10,"bkd-typeahead",3),A("valueChange",function(d){return k(i.filter.educationalEvent,d)||(i.filter.educationalEvent=d),d}),o()(),r(11,"div",1)(12,"label",2),u(13),s(14,"translate"),o(),r(15,"bkd-typeahead",4),A("valueChange",function(d){return k(i.filter.studyClass,d)||(i.filter.studyClass=d),d}),o()(),r(16,"div",5)(17,"button",6),g("click",function(){return i.show()}),u(18),s(19,"translate"),o()()()),n&2&&(a(3),b(l(4,11,"evaluate-absences.header.student")),a(2),_("typeaheadService",i.studentsService),x("value",i.filter.student),a(3),b(l(9,13,"evaluate-absences.header.module-instance")),a(2),_("typeaheadService",i.educationalEventsService),x("value",i.filter.educationalEvent),a(3),b(l(14,15,"evaluate-absences.header.study-class")),a(2),_("typeaheadService",i.studyClassesService),x("value",i.filter.studyClass),_("additionalHttpParams",i.classesHttpFilter),a(3),h(" ",l(19,17,"evaluate-absences.header.show")," "))},dependencies:[ue,$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1rem 1rem 1rem 0;border-bottom:1px solid #dee2e6}"],changeDetection:0})}}return e})();var he=(e,c)=>c.key,ge=(e,c)=>c.StudentRef.Id,xe=()=>[],ke=e=>["student",e,"absences"],Ae=e=>({returnparams:e});function Le(e,c){e&1&&E(0,"bkd-spinner")}function Te(e,c){if(e&1){let t=F();r(0,"th",6)(1,"bkd-sortable-header",9),s(2,"translate"),s(3,"translate"),A("sortCriteriaChange",function(i){T(t);let C=m(4);return k(C.state.sortCriteria,i)||(C.state.sortCriteria=i),P(i)}),o()()}if(e&2){let t=c.$implicit,n=m(4);a(),_("ngClass",t.label)("label",l(2,5,"evaluate-absences.list.header."+t.label))("sortKey",t.key),x("sortCriteria",n.state.sortCriteria),_("ngbTooltip",l(3,7,"evaluate-absences.list.header."+t.label))}}function Pe(e,c){if(e&1&&(r(0,"a",10),s(1,"async"),u(2),o()),e&2){let t=m().$implicit,n=m().$implicit,i=m(5);_("routerLink",M(5,ke,n.StudentRef.Id))("queryParams",M(7,Ae,l(1,3,i.profileReturnParams$))),a(2),h(" ",n[t.key]," ")}}function Fe(e,c){if(e&1&&u(0),e&2){let t=m().$implicit,n=m().$implicit;h(" ",n[t.key]," ")}}function we(e,c){if(e&1&&(r(0,"td"),s(1,"translate"),f(2,Pe,3,9,"a",10)(3,Fe,1,1),o()),e&2){let t=c.$implicit;K("data-label",l(1,2,"evaluate-absences.list.header."+t.label)),a(2),v(t.key==="StudentFullName"?2:3)}}function Ie(e,c){if(e&1&&(r(0,"tr"),w(1,we,4,4,"td",null,he),o()),e&2){let t=m(5);a(),I(t.columns)}}function Re(e,c){if(e&1&&(r(0,"tbody"),w(1,Ie,3,0,"tr",null,ge),o()),e&2){m(4);let t=y(0);a(),I(t)}}function Be(e,c){e&1&&E(0,"bkd-spinner",7)}function $e(e,c){if(e&1){let t=F();r(0,"button",11),g("click",function(){T(t);let i=m(4);return P(i.state.nextPage())}),u(1),s(2,"translate"),o()}e&2&&(a(),h(" ",l(2,1,"global.pagination.load-more")," "))}function De(e,c){if(e&1){let t=F();r(0,"div",2)(1,"div",3),E(2,"bkd-reports-link",4),s(3,"async"),o(),r(4,"table",5),g("scrolled",function(){T(t);let i=m(3);return P(i.onScroll())}),r(5,"thead")(6,"tr"),w(7,Te,4,9,"th",6,he),o()(),f(9,Re,3,0,"tbody"),o(),f(10,Be,1,0,"bkd-spinner",7)(11,$e,3,3,"button",8),o()}if(e&2){let t,n=m(3),i=y(0),C=y(2),d=y(4);a(2),_("reports",(t=l(3,4,n.reports$))!==null&&t!==void 0?t:X(6,xe)),a(5),I(n.columns),a(2),v(i&&i.length>0?9:-1),a(),v(d?10:-1),a(),v(C&&!d?11:-1)}}function Ve(e,c){e&1&&(r(0,"p",1),u(1),s(2,"translate"),o()),e&2&&(a(),h(" ",l(2,1,"evaluate-absences.no-entries")," "))}function Me(e,c){if(e&1&&f(0,De,12,7,"div",2)(1,Ve,3,3,"p",1),e&2){m(2);let t=y(0),n=y(4);v(t&&t.length>0||n?0:1)}}function He(e,c){if(e&1&&(f(0,Le,1,0,"bkd-spinner"),s(1,"async"),f(2,Me,2,1)),e&2){let t=m();v(l(1,1,t.state.loading$)?0:2)}}function Ne(e,c){e&1&&(r(0,"p",1),u(1),s(2,"translate"),o()),e&2&&(a(),b(l(2,1,"evaluate-absences.no-filter")))}var ye=(()=>{class e{constructor(){this.state=p(L),this.scrollPosition=p(_e),this.route=p(Q),this.presenceTypesService=p(te),this.reportsService=p(se),this.lessonPresencesService=p(D),this.reports$=this.loadReports(),this.columns=[{key:"StudentFullName",label:"student"},{key:"TotalAbsences",label:"total"},{key:"TotalAbsencesValidExcuse",label:"valid-excuse"},{key:"TotalAbsencesWithoutExcuse",label:"without-excuse"},{key:"TotalAbsencesUnconfirmed",label:"unconfirmed"},{key:"TotalAbsencesUnchecked",label:"unchecked"},{key:"TotalIncidents",label:"incident"}],this.filterFromParams$=this.route.queryParams.pipe(N(We)),this.profileReturnParams$=this.state.queryParamsString$}ngOnInit(){this.filterFromParams$.pipe(W(1)).subscribe(t=>this.state.setFilter(t)),this.presenceTypesService.halfDayActive$.subscribe(t=>{t&&(this.columns=[...this.columns,{key:"TotalHalfDays",label:"halfday"}])})}ngAfterViewInit(){this.scrollPosition.restore()}onScroll(){this.state.nextPage()}loadReports(){return this.state.validFilter$.pipe(V(t=>this.lessonPresencesService.getLessonRefs(t)),V(t=>t.length>0?this.reportsService.getEvaluateAbsencesReports(this.getReportRecordIds(t)):[]),O(1))}getReportRecordIds(t){return t.map(n=>`${n.LessonRef.Id}_${n.RegistrationRef.Id}`)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-evaluate-absences-list"]],decls:14,vars:18,consts:[[3,"filterChange","filter"],[1,"mt-3"],[1,"py-3"],[1,"buttons"],[1,"mb-2",3,"reports"],["infiniteScroll","",1,"table","table-striped","table-fixed",3,"scrolled"],["scope","col"],[1,"inline"],["type","button",1,"btn","btn-outline-secondary","btn-sm","d-block","mx-auto"],[3,"sortCriteriaChange","ngClass","label","sortKey","sortCriteria","ngbTooltip"],[1,"student",3,"routerLink","queryParams"],["type","button",1,"btn","btn-outline-secondary","btn-sm","d-block","mx-auto",3,"click"]],template:function(n,i){if(n&1){let C=F();R(0),s(1,"async"),R(2),s(3,"async"),R(4),s(5,"async"),r(6,"h1"),u(7),s(8,"translate"),o(),r(9,"bkd-evaluate-absences-header",0),s(10,"async"),g("filterChange",function(Ee){return T(C),P(i.state.setFilter(Ee))}),o(),f(11,He,3,3),s(12,"async"),f(13,Ne,3,3,"p",1)}n&2&&(B(l(1,3,i.state.entries$)),a(2),B(l(3,6,i.state.hasMore$)),a(2),B(l(5,9,i.state.loadingPage$)),a(3),b(l(8,12,"evaluate-absences.title")),a(2),_("filter",l(10,14,i.filterFromParams$)),a(2),v(l(12,16,i.state.isFilterValid$)?11:13))},dependencies:[be,oe,fe,ee,Z,re,J,$,de,z],styles:["th[_ngcontent-%COMP%]{cursor:pointer}th.student[_ngcontent-%COMP%]{width:30%}.buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"],changeDetection:0})}}return e})();function We(e){return{student:e.student?Number(e.student):null,educationalEvent:e.educationalEvent?Number(e.educationalEvent):null,studyClass:e.studyClass?Number(e.studyClass):null}}var Se=(()=>{class e{constructor(){this.state=p(L)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-evaluate-absences"]],features:[G([L,{provide:ne,useExisting:L},ie])],decls:1,vars:0,template:function(n,i){n&1&&E(0,"router-outlet")},dependencies:[Y],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}}return e})();var Dt=[{path:"",component:Se,children:[{path:"",component:ye,data:{restoreScrollPositionFrom:["/evaluate-absences/student/:id"]}},le]}];export{Dt as EVALUATE_ABSENCES_ROUTES};
