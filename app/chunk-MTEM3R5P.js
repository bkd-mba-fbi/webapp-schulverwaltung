import{a as Gt}from"./chunk-FNU566LQ.js";import{a as Nt}from"./chunk-FFBZO25J.js";import{a as jt,b as Ot,c as Vt}from"./chunk-SVCHNGNX.js";import{f as Fe,g as Ee}from"./chunk-UFRLS5GG.js";import{b as Dt,d as Et}from"./chunk-DZUR7EKU.js";import"./chunk-FLVW3H6P.js";import"./chunk-2UDOWYE6.js";import{a as Ht}from"./chunk-ZA3SEXFP.js";import{H as Tt,I as kt,J as Mt,L as de,P as Y,Q as me,R as Lt,S as Rt,T as Pt,U as Bt,b as xt,g as At,p as _e,q as It,t as De,w as he,x as Ue}from"./chunk-EDO6DY2V.js";import{a as St,l as ue}from"./chunk-PQGQXFEQ.js";import{a as $t,b as Ft}from"./chunk-UPZQ4FTT.js";import{b as wt}from"./chunk-5NJNJ42P.js";import{c as ut,d as ft,e as bt,f as yt,g as _t,h as ht,i as vt,l as gt,w as te,y as Ct}from"./chunk-JHVNIEZK.js";import{a as pe}from"./chunk-LTVWFE76.js";import{$a as S,Ab as J,Ad as Pe,Bb as w,Bd as ee,Cb as se,Db as Z,Eb as oe,F as E,Fa as k,Hd as ce,Ib as r,J as Qe,Ja as ge,Jb as l,Kb as P,L as ze,M as B,Ma as h,Nd as le,O as Ye,Od as D,P as L,Pa as b,Qa as ne,Qd as G,R as Xe,Sa as et,Sc as qe,Ua as C,Wa as Ce,Wb as at,X as ie,Xa as K,Ya as Q,Za as a,_ as j,_a as c,_b as Se,a as Ve,ad as dt,bc as z,bd as H,cc as ct,da as I,db as O,ea as T,ed as Ie,f as ve,fb as g,g as He,gb as _,gc as pt,gd as mt,h as Ge,ha as Je,hd as Te,id as ke,l as q,la as Ze,mb as tt,md as Me,n as y,nb as it,o as x,ob as nt,od as Le,pb as R,qb as d,qd as Re,rb as $,rd as $e,sb as f,tb as X,vc as lt,wa as o,wb as st,wc as xe,x as W,xa as u,xb as ot,xc as re,yb as rt,yc as Ae,yd as ae,zb as N,zd as we}from"./chunk-34ZOBT6Z.js";var je=(()=>{class t{constructor(e,i,n,s,p,v,A,F){this.fb=e,this.router=i,this.toastService=n,this.translate=s,this.presenceTypesService=p,this.updateService=v,this.storageService=A,this.settings=F,this.formGroup=this.createFormGroup(),this.saving$=new He(!1),this.submitted$=new He(!1),this.absenceTypes$=x([this.getConfirmationTypes(),this.getHalfDayType()]).pipe(y(([U,M])=>M?[...U,M]:U)),this.absenceTypeIdErrors$=St(q(this.formGroup),this.submitted$,"absenceTypeId"),this.destroy$=new ve}ngOnInit(){this.selectedLessonIds$.pipe(E(1),W(Rt)).subscribe(()=>this.navigateBack())}ngOnDestroy(){this.destroy$.next()}onSubmit(){if(this.submitted$.next(!0),this.formGroup.valid){let{absenceTypeId:e}=this.formGroup.value;this.save(e)}}cancel(){this.navigateBack()}getSelectedCount(){return this.selectedLessonIds$.pipe(y(e=>e.length))}getConfirmationTypes(){return this.presenceTypesService.confirmationTypes$.pipe(y(e=>e.filter(i=>i.IsAbsence&&i.Id!==this.settings.halfDayPresenceTypeId)))}getHalfDayType(){return q(null)}createFormGroup(){return this.fb.group({absenceTypeId:[null,mt.required]})}save(e){this.saving$.next(!0),this.selectedLessonIds$.pipe(E(1),L(i=>this.updateService.editLessonPresences(i,[Number(this.storageService.getPayload()?.id_person)],e)),Qe(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("my-absences.confirm.save-success")),this.navigateBack()}static{this.\u0275fac=function(i){return new(i||t)(u(ae),u(re),u(pe),u(le),u(Y),u(me),u(G),u(dt))}}static{this.\u0275cmp=k({type:t,selectors:[["ng-component"]],decls:0,vars:0,template:function(i,n){},encapsulation:2})}}return t})();var fe=(()=>{class t{constructor(e,i,n){this.settings=e,this.storageService=i,this.studentsService=n,this.studentId$=new Ge(1),this.lessonAbsences$=this.studentId$.pipe(L(this.loadLessonAbsences.bind(this)),B(1)),this.lessonIncidents$=this.studentId$.pipe(L(this.loadLessonIncidents.bind(this)),B(1)),this.lessonPresences$=this.getLessonPresences(),this.checkableAbsences$=this.getAbsences(this.settings.checkableAbsenceStateId),this.openAbsences$=this.getAbsences(this.settings.unconfirmedAbsenceStateId),this.excusedAbsences$=this.getAbsences(this.settings.excusedAbsenceStateId),this.unexcusedAbsences$=this.getAbsences(this.settings.unexcusedAbsenceStateId),this.incidents$=this.getAbsences(null),this.openLessonAbsences$=x([this.openAbsences$.pipe(W(te)),this.lessonAbsences$]).pipe(y(ue(this.getLessonAbsences.bind(this))),B(1)),this.checkableLessonAbsences$=x([this.checkableAbsences$.pipe(W(te)),this.lessonAbsences$]).pipe(y(ue(this.getLessonAbsences.bind(this))),B(1)),this.excusedLessonAbsences$=x([this.excusedAbsences$.pipe(W(te)),this.lessonAbsences$]).pipe(y(ue(this.getLessonAbsences.bind(this))),B(1)),this.unexcusedLessonAbsences$=x([this.unexcusedAbsences$.pipe(W(te)),this.lessonAbsences$]).pipe(y(ue(this.getLessonAbsences.bind(this))),B(1)),this.incidentsLessonAbsences$=x([this.incidents$.pipe(W(te)),this.lessonIncidents$]).pipe(y(ue(this.getLessonIncidents.bind(this))),B(1)),this.counts$=this.getCounts();let s=this.storageService.getPayload()?.id_person;s&&this.studentId$.next(Number(s))}reset(){this.studentId$.pipe(E(1)).subscribe(e=>this.studentId$.next(e))}getLessonPresences(){return this.getCached(x([this.studentId$,this.lessonAbsences$,this.lessonIncidents$]).pipe(L(([e,i,n])=>this.loadTimetableEntries(e,i,n).pipe(y(s=>this.buildLessonPresences(i,n,s)))),y(Mt)))}getAbsences(e){return this.getCached(this.lessonPresences$.pipe(y(i=>i?.filter(n=>n.ConfirmationStateId===e)||null)))}getLessonAbsences(e,i){let n=e.map(s=>s.LessonRef.Id);return i.filter(s=>n.includes(s.LessonRef.Id))}getLessonIncidents(e,i){let n=e.map(s=>s.LessonRef.Id);return i.filter(s=>n.includes(s.LessonRef.Id))}getCounts(){return x([this.getCount(this.checkableAbsences$),this.getCount(this.openAbsences$),this.getCount(this.excusedAbsences$),this.getCount(this.unexcusedAbsences$),this.getCount(this.incidents$)]).pipe(y(([e,i,n,s,p])=>({checkableAbsences:e,openAbsences:i,excusedAbsences:n,unexcusedAbsences:s,incidents:p,halfDays:null})))}getCached(e){return e.pipe(Ye(null),ze({connector:()=>new Ge(1)}))}getCount(e){return e.pipe(y(i=>i?.length??null))}loadLessonAbsences(e){return this.studentsService.getLessonAbsences(e)}loadLessonIncidents(e){return this.studentsService.getLessonIncidents(e)}loadTimetableEntries(e,i,n){return this.studentsService.getTimetableEntries(e,{"filter.Id":`;${[...i,...n].map(s=>s.LessonRef.Id).join(";")}`})}buildLessonPresences(e,i,n){return[...e,...i].map(s=>this.buildLessonPresence(s,n)).filter(te)}buildLessonPresence(e,i){let n=i.find(s=>s.Id===e.LessonRef.Id);return n?{Id:"",LessonRef:{Id:e.LessonRef.Id,HRef:e.LessonRef.HRef?e.LessonRef.HRef:null},StudentRef:e.StudentRef,EventRef:{Id:0,HRef:null},TypeRef:e.TypeRef,RegistrationRef:{Id:0,HRef:null},StudyClassRef:{Id:0,HRef:null},ConfirmationStateId:"ConfirmationStateId"in e?e.ConfirmationStateId:null,EventDesignation:n.EventDesignation,HasStudyCourseConfirmationCode:!1,LessonDateTimeFrom:n.From,LessonDateTimeTo:n.To,Comment:null,Date:n.From,Type:e.Type,StudentFullName:e.StudentFullName,StudyClassNumber:"",TeacherInformation:n.EventManagerInformation??null}:null}static{this.\u0275fac=function(i){return new(i||t)(j(H),j(G),j(Fe))}}static{this.\u0275prov=ie({token:t,factory:t.\u0275fac})}}return t})();var pi=(t,m)=>m.Id,li=t=>({count:t}),di=t=>({"border-top pt-3":t});function mi(t,m){if(t&1&&(a(0,"div",13),d(1),r(2,"translate"),c()),t&2){let e=m.$implicit;o(),f(" ",P(2,1,"global.validation-errors."+e.error,e.params)," ")}}function ui(t,m){if(t&1&&(K(0,mi,3,4,"div",13,Ce),r(2,"async")),t&2){let e=_(2);Q(l(2,0,e.absenceTypeIdErrors$))}}function fi(t,m){if(t&1&&(a(0,"div",5),S(1,"input",11),r(2,"async"),a(3,"label",12),d(4),c(),h(5,ui,3,2),r(6,"async"),c()),t&2){let e,i,n=m.$implicit,s=m.$index,p=_();b("ngClass",oe(12,di,n.IsHalfDay)),o(),ne("is-invalid",((e=(e=l(2,8,p.absenceTypeIdErrors$))==null?null:e.length)!==null&&e!==void 0?e:0)>0),b("id","absence-type-"+s)("value",n.Id),o(2),b("for","absence-type-"+s),o(),f(" ",n.Designation," "),o(),C(((i=(i=l(6,10,p.absenceTypes$))==null?null:i.length)!==null&&i!==void 0?i:0)-1===s?5:-1)}}function bi(t,m){t&1&&(a(0,"div",10)(1,"span",14),d(2,"Loading..."),c()())}var zt=(()=>{class t extends je{constructor(e,i,n,s,p,v,A,F,U,M){super(e,i,n,s,p,v,A,F),this.myAbsencesService=U,this.selectionService=M,this.titleKey="my-absences.confirm.title",this.selectedLessonIds$=this.selectionService.selectedIds$.pipe(y(Oe=>ce(ee(Oe.map(Ne=>Ne.lessonIds))))),this.confirmationStateId=this.settings.unconfirmedAbsencesRefreshTime}onSaveSuccess(){this.selectionService.clear(),this.myAbsencesService.reset(),super.onSaveSuccess()}navigateBack(){this.router.navigate(["/my-absences"])}static{this.\u0275fac=function(i){return new(i||t)(u(ae),u(re),u(pe),u(le),u(Y),u(me),u(G),u(H),u(fe),u(de))}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-my-absences-confirm"]],features:[ge],decls:32,vars:39,consts:[[1,"bkd-container","bkd-container-limited"],[1,"mb-3","pb-3","border-bottom"],[3,"ngSubmit","formGroup"],[1,"form-group","mb-3","border-bottom"],[1,"form-label"],[1,"form-check","my-3",3,"ngClass"],[1,"remark"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],["type","radio","formControlName","absenceTypeId",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],[1,"invalid-feedback","mt-4"],[1,"visually-hidden"]],template:function(i,n){if(i&1){let s=O();a(0,"div",0)(1,"h1"),d(2),r(3,"translate"),c(),a(4,"div",1),N(5),r(6,"async"),d(7),r(8,"translate"),c(),a(9,"form",2),g("ngSubmit",function(){return I(s),T(n.onSubmit())}),a(10,"div",3)(11,"label",4),d(12),r(13,"translate"),r(14,"addSpace"),c(),K(15,fi,7,14,"div",5,pi),r(17,"async"),c(),a(18,"div",6),d(19),r(20,"translate"),c(),a(21,"div",7)(22,"button",8),r(23,"async"),g("click",function(){return I(s),T(n.cancel())}),d(24),r(25,"translate"),c(),a(26,"button",9),r(27,"async"),d(28),r(29,"translate"),h(30,bi,3,0,"div",10),r(31,"async"),c()()()()}if(i&2){o(2),$(l(3,11,n.titleKey));let s=l(6,13,n.getSelectedCount());o(5),f(" ",P(8,15,s===1?"my-absences.confirm.lesson-selected":"my-absences.confirm.lessons-selected",oe(37,li,s))," "),o(2),b("formGroup",n.formGroup),o(3),X("",l(13,18,"my-absences.confirm.choose-presence-type"),"",P(14,20,":",":"),""),o(3),Q(l(17,23,n.absenceTypes$)),o(4),f(" ",l(20,25,"my-absences.confirm.remark")," "),o(3),b("disabled",l(23,27,n.saving$)),o(2),f(" ",l(25,29,"my-absences.confirm.cancel")," "),o(2),b("disabled",l(27,31,n.saving$)),o(2),f(" ",l(29,33,"my-absences.confirm.save")," "),o(2),C(l(31,35,n.saving$)?30:-1)}},dependencies:[we,Me,Ie,Le,Te,ke,Pe,Re,$e,Se,z,D,Ee],encapsulation:2,changeDetection:0})}}return t})();var be=(()=>{class t extends Ot{get preventAbsencesAfterStart(){if(this._preventAbsencesAfterStart==null){let e=this.storageService.getPayload()?.instance_id,i=this.settings.preventStudentAbsenceAfterLessonStart;this._preventAbsencesAfterStart=e?i.includes(e):!1}return this._preventAbsencesAfterStart}constructor(e,i,n,s,p,v){super(e,i,v,n,"/my-absences/report"),this.studentsService=s,this.storageService=p}getInitialFilter(){return{dateFrom:null,dateTo:null}}isValidFilter(e){return!!(e.dateFrom||e.dateTo)}loadEntries(e,i,n){let s=this.buildRequestParamsFromFilter(e).set("sort","From.asc");return this.loadingService.load(this.loadTimetableEntries(s).pipe(y(p=>this.filterAbsencesAfterLessonStart(p)),L(p=>x([q(p),this.loadLessonAbsences(p),this.loadLessonDispensations(p)])),y(([p,v,A])=>this.buildLessonPresences(p,v,A)),y(p=>({offset:0,total:p.length,entries:p}))),jt)}filterAbsencesAfterLessonStart(e){return this.preventAbsencesAfterStart?e.filter(i=>i.From.getTime()>=new Date().getTime()):e}buildParamsFromFilter(e){let{dateFrom:i,dateTo:n}=e,s={};return i&&(s.dateFrom=_e(i,"yyyy-MM-dd")),n&&(s.dateTo=_e(n,"yyyy-MM-dd")),s}buildRequestParamsFromFilter(e){let i=new pt;return e.dateFrom&&(i=i.set("filter.From",`>${_e(It(e.dateFrom,1),"yyyy-MM-dd")}`)),e.dateTo&&(i=i.set("filter.To",`<${_e(xt(e.dateTo,1),"yyyy-MM-dd")}`)),i}get studentId(){let e=this.storageService.getPayload()?.id_person;if(e==null)throw new Error("No student id available");return Number(e)}loadTimetableEntries(e){return this.studentsService.getTimetableEntries(this.studentId,e)}loadLessonAbsences(e){return e.length>0?this.studentsService.getLessonAbsences(this.studentId,{"filter.Id":`;${e.map(i=>i.Id).join(";")}`}):q([])}loadLessonDispensations(e){return e.length>0?this.studentsService.getLessonDispensations(this.studentId,{"filter.Id":`;${e.map(i=>i.Id).join(";")}`}):q([])}buildLessonPresences(e,i,n){return e.map(s=>this.buildLessonPresence(s,i,n))}buildLessonPresence(e,i,n){let s=i.find(A=>A.LessonRef.Id===e.Id),p=n.find(A=>A.LessonRef.Id===e.Id),v=this.buildLessonPresenceTypeRef(s,p);return{Id:"",LessonRef:{Id:e.Id,HRef:null},StudentRef:(s||p)?.StudentRef||{Id:this.studentId,HRef:null},EventRef:{Id:0,HRef:null},TypeRef:v,RegistrationRef:{Id:0,HRef:null},StudyClassRef:{Id:0,HRef:null},ConfirmationStateId:s?.ConfirmationStateId||p&&this.settings.excusedAbsenceStateId||null,EventDesignation:e.EventDesignation||"",HasStudyCourseConfirmationCode:!1,LessonDateTimeFrom:e.From||new Date,LessonDateTimeTo:e.To||new Date,Comment:null,Date:e.From||new Date,Type:(s||p)?.Type||null,StudentFullName:(s||p)?.StudentFullName||"",StudyClassNumber:"",TeacherInformation:e.EventManagerInformation??null}}buildLessonPresenceTypeRef(e,i){return e?Ve({},e.TypeRef):i?Ve({},i.TypeRef):{Id:null,HRef:null}}static{this.\u0275fac=function(i){return new(i||t)(j(at),j(Ft),j(H),j(Fe),j(G),j(Vt))}}static{this.\u0275prov=ie({token:t,factory:t.\u0275fac})}}return t})();var ye=(()=>{class t extends Tt{constructor(){super(...arguments),this.selectedIds$=this.selection$.pipe(y(kt))}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=Je(t)))(n||t)}})()}static{this.\u0275prov=ie({token:t,factory:t.\u0275fac})}}return t})();var yi=(t,m)=>m.Id,_i=t=>({count:t}),hi=t=>({"border-top pt-3":t});function vi(t,m){if(t&1&&(a(0,"div",13),d(1),r(2,"translate"),c()),t&2){let e=m.$implicit;o(),f(" ",P(2,1,"global.validation-errors."+e.error,e.params)," ")}}function gi(t,m){if(t&1&&(K(0,vi,3,4,"div",13,Ce),r(2,"async")),t&2){let e=_(2);Q(l(2,0,e.absenceTypeIdErrors$))}}function Ci(t,m){if(t&1&&(a(0,"div",5),S(1,"input",11),r(2,"async"),a(3,"label",12),d(4),c(),h(5,gi,3,2),r(6,"async"),c()),t&2){let e,i,n=m.$implicit,s=m.$index,p=_();b("ngClass",oe(12,hi,n.IsHalfDay)),o(),ne("is-invalid",((e=(e=l(2,8,p.absenceTypeIdErrors$))==null?null:e.length)!==null&&e!==void 0?e:0)>0),b("id","absence-type-"+s)("value",n.Id),o(2),b("for","absence-type-"+s),o(),f(" ",n.Designation," "),o(),C(((i=(i=l(6,10,p.absenceTypes$))==null?null:i.length)!==null&&i!==void 0?i:0)-1===s?5:-1)}}function Si(t,m){t&1&&(a(0,"div",10)(1,"span",14),d(2,"Loading..."),c()())}var Jt=(()=>{class t extends je{constructor(e,i,n,s,p,v,A,F,U,M){super(e,i,n,s,p,v,A,F),this.state=U,this.selectionService=M,this.titleKey="my-absences.report.title",this.selectedLessonIds$=this.selectionService.selectedIds$.pipe(y(Oe=>ce(ee(Oe.map(Ne=>Ne.lessonIds))))),this.confirmationStateId=this.settings.checkableAbsenceStateId}getHalfDayType(){return this.presenceTypesService.getPresenceType(this.settings.halfDayPresenceTypeId).pipe(y(e=>e.Active?e:null))}onSaveSuccess(){this.selectionService.clear(),this.state.resetEntries(),super.onSaveSuccess()}navigateBack(){this.state.queryParams$.pipe(E(1)).subscribe(e=>{this.router.navigate(["/my-absences/report"],{queryParams:e})})}static{this.\u0275fac=function(i){return new(i||t)(u(ae),u(re),u(pe),u(le),u(Y),u(me),u(G),u(H),u(be),u(ye))}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-my-absences-confirm"]],features:[ge],decls:32,vars:39,consts:[[1,"bkd-container","bkd-container-limited"],[1,"mb-3","pb-3","border-bottom"],[3,"ngSubmit","formGroup"],[1,"form-group","mb-3","border-bottom"],[1,"form-label"],[1,"form-check","my-3",3,"ngClass"],[1,"remark"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],["type","radio","formControlName","absenceTypeId",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],[1,"invalid-feedback","mt-4"],[1,"visually-hidden"]],template:function(i,n){if(i&1){let s=O();a(0,"div",0)(1,"h1"),d(2),r(3,"translate"),c(),a(4,"div",1),N(5),r(6,"async"),d(7),r(8,"translate"),c(),a(9,"form",2),g("ngSubmit",function(){return I(s),T(n.onSubmit())}),a(10,"div",3)(11,"label",4),d(12),r(13,"translate"),r(14,"addSpace"),c(),K(15,Ci,7,14,"div",5,yi),r(17,"async"),c(),a(18,"div",6),d(19),r(20,"translate"),c(),a(21,"div",7)(22,"button",8),r(23,"async"),g("click",function(){return I(s),T(n.cancel())}),d(24),r(25,"translate"),c(),a(26,"button",9),r(27,"async"),d(28),r(29,"translate"),h(30,Si,3,0,"div",10),r(31,"async"),c()()()()}if(i&2){o(2),$(l(3,11,n.titleKey));let s=l(6,13,n.getSelectedCount());o(5),f(" ",P(8,15,s===1?"my-absences.confirm.lesson-selected":"my-absences.confirm.lessons-selected",oe(37,_i,s))," "),o(2),b("formGroup",n.formGroup),o(3),X("",l(13,18,"my-absences.confirm.choose-presence-type"),"",P(14,20,":",":"),""),o(3),Q(l(17,23,n.absenceTypes$)),o(4),f(" ",l(20,25,"my-absences.confirm.remark")," "),o(3),b("disabled",l(23,27,n.saving$)),o(2),f(" ",l(25,29,"my-absences.confirm.cancel")," "),o(2),b("disabled",l(27,31,n.saving$)),o(2),f(" ",l(29,33,"my-absences.confirm.save")," "),o(2),C(l(31,35,n.saving$)?30:-1)}},dependencies:[we,Me,Ie,Le,Te,ke,Pe,Re,$e,Se,z,D,Ee],encapsulation:2,changeDetection:0})}}return t})();var xi=()=>["/my-absences"],ei=(()=>{class t{constructor(){this.filter={dateFrom:null,dateTo:null},this.filterChange=new Ze,this.minDate={year:new Date().getFullYear(),month:new Date().getMonth()+1,day:new Date().getDate()}}updateDateFrom(e){this.filter.dateFrom=e,e&&(this.filter.dateTo=e)}show(){this.filterChange.emit({dateFrom:Zt(this.filter.dateFrom),dateTo:Zt(this.filter.dateTo)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-my-absences-report-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},features:[se([{provide:ht,useClass:gt},{provide:vt,useClass:Nt}])],decls:19,vars:18,consts:[[3,"link"],[1,"filters"],[1,"form-group"],[1,"form-label"],[3,"valueChange","minDate","value"],[1,"buttons"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(i,n){i&1&&(S(0,"bkd-backlink",0),a(1,"h1"),d(2),r(3,"translate"),c(),a(4,"div",1)(5,"div",2)(6,"label",3),d(7),r(8,"translate"),c(),a(9,"bkd-date-select",4),g("valueChange",function(p){return n.updateDateFrom(p)}),c()(),a(10,"div",2)(11,"label",3),d(12),r(13,"translate"),c(),a(14,"bkd-date-select",4),rt("valueChange",function(p){return ot(n.filter.dateTo,p)||(n.filter.dateTo=p),p}),c()(),a(15,"div",5)(16,"button",6),g("click",function(){return n.show()}),d(17),r(18,"translate"),c()()()),i&2&&(b("link",Z(17,xi)),o(2),$(l(3,9,"my-absences.report.title")),o(5),$(l(8,11,"my-absences.report.header.date-from")),o(2),b("minDate",n.minDate)("value",n.filter.dateFrom),o(3),$(l(13,13,"my-absences.report.header.date-to")),o(2),b("minDate",n.minDate),st("value",n.filter.dateTo),o(3),f(" ",l(18,15,"my-absences.report.header.show")," "))},dependencies:[Bt,Gt,D],styles:["[_nghost-%COMP%]{display:block;padding-bottom:1rem;border-bottom:1px solid #dee2e6}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.form-group[_ngcontent-%COMP%]{flex:1;min-width:20rem;max-width:40rem;margin-right:1rem;margin-bottom:.5rem}.buttons[_ngcontent-%COMP%]{flex:none;margin-top:1.625rem;margin-right:0}@media (max-width: 575.98px){[_nghost-%COMP%]{padding-bottom:0}.buttons[_ngcontent-%COMP%]{width:100%;margin-top:1rem;margin-bottom:1rem}}"],changeDetection:0})}}return t})();function Zt(t){return t?At(t):null}var Ai=(t,m)=>m.Id;function Ii(t,m){t&1&&S(0,"bkd-spinner")}function Ti(t,m){if(t&1){let e=O();a(0,"div",8)(1,"input",9,2),r(3,"async"),g("change",function(){I(e);let n=_().$implicit,s=_(5);return T(s.selectionService.toggle(n))}),c()()}if(t&2){let e=_().$implicit,i=_(5);o(),b("checked",l(3,1,i.selectionService.isSelected$(e)))}}function ki(t,m){if(t&1&&(a(0,"div")(1,"i",13),d(2),c()()),t&2){_();let e=w(2);et("checkbox presence-category ",e.category,""),o(2),$(e.icon)}}function Mi(t,m){if(t&1&&d(0),t&2){let e=_().$implicit;f(" , ",e.StudyClassNumber," ")}}function Li(t,m){if(t&1&&(a(0,"div",20),d(1),c()),t&2){_();let e=w(15);o(),f(" ",e," ")}}function Ri(t,m){if(t&1){let e=O();a(0,"div",15,1),g("click",function(n){I(e);let s=R(1),p=_(5);return T(p.onRowClick(n,s))}),N(2),r(3,"async"),h(4,Ti,4,3,"div",8)(5,ki,3,4,"div",16),a(6,"div",17),d(7),h(8,Mi,1,1),c(),a(9,"div",18),d(10),r(11,"date"),r(12,"date"),c(),a(13,"div",19),d(14),c(),N(15),r(16,"async"),h(17,Li,2,1,"div",20),a(18,"div",21),d(19),r(20,"date"),c(),a(21,"div",22),d(22),r(23,"bkdDaysDifference"),c(),a(24,"div",23),d(25),r(26,"date"),r(27,"bkdDaysDifference"),c()()}if(t&2){let e=m.$implicit,i=_(5);o(2);let n=J(l(3,11,i.getPresenceCategory(e)));o(2),C(n?5:4),o(3),f(" ",e.EventDesignation," "),o(),C(e.StudyClassNumber?8:-1),o(2),X(" ",P(11,14,e.LessonDateTimeFrom,"HH:mm"),"\u2013",P(12,17,e.LessonDateTimeTo,"HH:mm")," "),o(4),f(" ",e.TeacherInformation," "),o();let s=J(l(16,20,i.getPresenceTypeDesignation(e)));o(2),C(s?17:-1),o(2),f(" ",P(20,23,e.LessonDateTimeFrom,"dd.MM.yyyy")," "),o(3),f(" ",l(23,26,e.LessonDateTimeFrom)," "),o(3),X(" ",P(26,28,e.LessonDateTimeFrom,"dd.MM.yyyy"),", ",l(27,31,e.LessonDateTimeFrom)," ")}}function $i(t,m){if(t&1){let e=O();a(0,"div")(1,"div",7,0),g("click",function(n){I(e);let s=R(2),p=_(4);return T(p.onRowClick(n,s))}),a(3,"div",8)(4,"input",9),r(5,"async"),g("change",function(n){I(e);let s=_(4);return T(s.toggleAll(n.target==null?null:n.target.checked))}),c()(),a(6,"div",10),d(7),r(8,"translate"),c(),a(9,"div",11)(10,"a",12),r(11,"async"),a(12,"i",13),d(13,"edit"),c()()()(),K(14,Ri,28,33,"div",14,Ai),c()}if(t&2){let e,i=_(4),n=w(0);o(4),b("checked",l(5,4,i.allSelected$)),o(3),f(" ",l(8,6,"my-absences.report.list.all")," "),o(3),ne("disabled",((e=l(11,8,i.selectionService.selection$))==null?null:e.length)===0),o(4),Q(n)}}function wi(t,m){t&1&&S(0,"bkd-spinner",6)}function Pi(t,m){if(t&1&&(a(0,"div",5),h(1,$i,16,10,"div")(2,wi,1,0,"bkd-spinner",6),c()),t&2){_(3);let e=w(0),i=w(2);o(),C(e&&e.length>0?1:-1),o(),C(i?2:-1)}}function Di(t,m){t&1&&(a(0,"p",4),d(1),r(2,"translate"),c()),t&2&&(o(),f(" ",l(2,1,"my-absences.report.no-entries")," "))}function Fi(t,m){if(t&1&&h(0,Pi,3,2,"div",5)(1,Di,3,3,"p",4),t&2){_(2);let e=w(0),i=w(2);C(e&&e.length>0||i?0:1)}}function Ei(t,m){if(t&1&&(h(0,Ii,1,0,"bkd-spinner"),r(1,"async"),h(2,Fi,2,1)),t&2){let e=_();C(l(1,1,e.state.loading$)?0:2)}}function Bi(t,m){t&1&&(a(0,"p",4),d(1),r(2,"translate"),c()),t&2&&(o(),$(l(2,1,"my-absences.report.no-filter")))}var ti=(()=>{class t{constructor(e,i,n,s,p,v){this.state=e,this.selectionService=i,this.route=n,this.scrollPosition=s,this.presenceTypesService=p,this.settings=v,this.filterFromParams$=this.route.queryParams.pipe(y(ji)),this.allSelected$=x([this.selectionService.selection$,this.state.entries$.pipe(L(A=>x(A.map(F=>this.getPresenceType(F)))))]).pipe(y(([A,F])=>A.length>0&&A.length===F.filter(Ct(De)).length)),this.destroy$=new ve}ngOnInit(){this.filterFromParams$.pipe(E(1)).subscribe(e=>this.state.setFilter(e)),this.state.validFilter$.pipe(Xe(this.destroy$)).subscribe(()=>this.selectionService.clear())}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}getPresenceCategory(e){return this.getPresenceType(e).pipe(y(i=>De(i)?e.ConfirmationStateId===this.settings.checkableAbsenceStateId?{category:he.Unapproved,icon:Ue(he.Unapproved)}:{category:he.Absent,icon:Ue(he.Absent)}:null))}getPresenceTypeDesignation(e){return this.presenceTypesService.displayedTypes$.pipe(y(i=>e.TypeRef.Id&&i.find(n=>n.Id===e.TypeRef.Id)?.Designation||null))}toggleAll(e){x([this.state.entries$.pipe(E(1)),this.presenceTypesService.presenceTypes$.pipe(E(1))]).subscribe(([i,n])=>{let s=n.filter(p=>De(p)).map(p=>p.Id);this.selectionService.clear(e?i.filter(p=>p.TypeRef.Id==null||!s.includes(p.TypeRef.Id)):null)})}onRowClick(e,i){let n=i.querySelector('input[type="checkbox"]');n&&e.target!==n&&!e.target.closest(".buttons")&&n.click()}getPresenceType(e){return this.presenceTypesService.presenceTypes$.pipe(y(i=>e.TypeRef.Id&&i.find(n=>n.Id===e.TypeRef.Id)||null))}static{this.\u0275fac=function(i){return new(i||t)(u(be),u(ye),u(lt),u(Ht),u(Y),u(H))}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-my-absences-report-list"]],decls:9,vars:12,consts:[["all",""],["row",""],["checkbox",""],[3,"filterChange","filter"],[1,"mt-3"],[1,"py-3"],[1,"inline"],[1,"entries-all",3,"click"],[1,"checkbox"],["type","checkbox",1,"form-check-input",3,"change","checked"],[1,"all"],[1,"buttons"],["routerLink","confirm",1,"edit","btn","btn-primary","btn-icon","me-2"],[1,"material-icons"],[1,"entry"],[1,"entry",3,"click"],[3,"class"],[1,"lesson-class"],[1,"time","pe-2"],[1,"teacher"],[1,"presence-type"],[1,"date"],[1,"days-ago"],[1,"date-days-ago"]],template:function(i,n){if(i&1){let s=O();N(0),r(1,"async"),N(2),r(3,"async"),a(4,"bkd-my-absences-report-header",3),r(5,"async"),g("filterChange",function(v){return I(s),T(n.state.setFilter(v))}),c(),h(6,Ei,3,3),r(7,"async"),h(8,Bi,3,3,"p",4)}i&2&&(J(l(1,2,n.state.entries$)),o(2),J(l(3,5,n.state.loadingPage$)),o(2),b("filter",l(5,8,n.filterFromParams$)),o(2),C(l(7,10,n.state.isFilterValid$)?6:8))},dependencies:[ei,Ae,wt,z,ct,D,Lt],styles:['.entries-all[_ngcontent-%COMP%]{padding:0 0 .5rem 1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox all buttons";grid-template-columns:min-content 1fr min-content}.entry[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox lesson-class time teacher" "checkbox presence-type date days-ago";grid-template-columns:min-content 2fr 1fr 2fr}.entry[_ngcontent-%COMP%]:first-child{padding-top:0}.entries-all[_ngcontent-%COMP%] + .entry[_ngcontent-%COMP%]{padding-top:1rem}.presence-category.absent[_ngcontent-%COMP%]{color:#ea161f}.presence-category.unapproved[_ngcontent-%COMP%]{color:#ffa814}.checkbox[_ngcontent-%COMP%]{grid-area:checkbox;margin:0;padding:.3rem 1rem 0 0}.presence-category[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{display:block;font-size:16px}.entries-all[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{padding-top:.2rem}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.all[_ngcontent-%COMP%]{grid-area:all}.buttons[_ngcontent-%COMP%]{grid-area:buttons;display:flex}.lesson-class[_ngcontent-%COMP%]{grid-area:lesson-class;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.time[_ngcontent-%COMP%]{grid-area:time}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.presence-type[_ngcontent-%COMP%]{color:#adb5bd;grid-area:presence-type}.date[_ngcontent-%COMP%]{grid-area:date}.days-ago[_ngcontent-%COMP%]{color:#adb5bd;grid-area:days-ago}.date-days-ago[_ngcontent-%COMP%]{grid-area:date-days-ago;display:none}@media (max-width: 750px){.entry[_ngcontent-%COMP%]{grid-template-areas:"checkbox lesson-class" "checkbox teacher" "checkbox date-days-ago" "checkbox time" "checkbox presence-type";grid-template-columns:min-content 1fr}.date-days-ago[_ngcontent-%COMP%]{display:block}.date[_ngcontent-%COMP%], .days-ago[_ngcontent-%COMP%]{display:none}}'],changeDetection:0})}}return t})();function ji(t){return{dateFrom:t.dateFrom?qe(t.dateFrom):null,dateTo:t.dateTo?qe(t.dateTo):null}}var ii=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-my-absences-report"]],features:[se([be,ye])],decls:1,vars:0,template:function(i,n){i&1&&S(0,"router-outlet")},dependencies:[xe],encapsulation:2,changeDetection:0})}}return t})();var Oi=["link"],Ni=()=>["/my-absences/report"],ni=(()=>{class t{onClick(){this.link.nativeElement.click()}constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-my-absences-report-link"]],viewQuery:function(i,n){if(i&1&&tt(Oi,5),i&2){let s;it(s=nt())&&(n.link=s.first)}},hostBindings:function(i,n){i&1&&g("click",function(p){return n.onClick(p)})},decls:8,vars:5,consts:[["link",""],[1,"m-0"],[1,"btn","btn-link","p-0",3,"routerLink"],[1,"d-flex","align-items-center"],[1,"material-icons"]],template:function(i,n){i&1&&(a(0,"h5",1),d(1),r(2,"translate"),c(),a(3,"a",2,0)(5,"div",3)(6,"i",4),d(7,"keyboard_arrow_right"),c()()()),i&2&&(o(),f(" ",l(2,2,"my-absences.report.title"),`
`),o(2),b("routerLink",Z(4,Ni)))},dependencies:[Ae,D],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1rem;cursor:pointer}.btn[_ngcontent-%COMP%]{color:#000;text-decoration:none}"],changeDetection:0})}}return t})();var si=()=>[];function Vi(t,m){}function Hi(t,m){if(t&1&&d(0),t&2){_();let e=w(0);f(" (",e==null?null:e.checkableAbsences,") ")}}function Gi(t,m){if(t&1&&S(0,"bkd-student-dossier-absences",15),t&2){let e=_();b("absences$",e.myAbsencesService.checkableAbsences$)}}function qi(t,m){if(t&1&&d(0),t&2){_();let e=w(0);f(" (",e==null?null:e.openAbsences,") ")}}function Ui(t,m){if(t&1&&(S(0,"bkd-student-dossier-absences",16),r(1,"translate"),r(2,"async")),t&2){let e,i=_();b("absences$",i.myAbsencesService.openAbsences$)("selectionService",i.absencesSelectionService)("defaultAbsenceSelectionMessage",l(1,4,"my-absences.show.default-absence-selection-message"))("reports",(e=l(2,6,i.openAbsencesReports$))!==null&&e!==void 0?e:Z(8,si))}}function Wi(t,m){if(t&1&&d(0),t&2){_();let e=w(0);f(" (",e==null?null:e.excusedAbsences,") ")}}function Ki(t,m){if(t&1&&S(0,"bkd-student-dossier-absences",15),t&2){let e=_();b("absences$",e.myAbsencesService.excusedAbsences$)}}function Qi(t,m){if(t&1&&d(0),t&2){_();let e=w(0);f(" (",e==null?null:e.unexcusedAbsences,") ")}}function zi(t,m){if(t&1&&S(0,"bkd-student-dossier-absences",17),t&2){let e=_();b("absences$",e.myAbsencesService.unexcusedAbsences$)("displayPresenceType",!1)}}function Yi(t,m){if(t&1&&d(0),t&2){_();let e=w(0);f(" (",e==null?null:e.incidents,") ")}}function Xi(t,m){if(t&1&&S(0,"bkd-student-dossier-absences",15),t&2){let e=_();b("absences$",e.myAbsencesService.incidents$)}}var oi=(()=>{class t{constructor(e,i,n){this.reportsService=e,this.myAbsencesService=i,this.absencesSelectionService=n,this.openAbsencesReports$=this.loadOpenAbsencesReports(),this.allAbsencesReports$=this.loadAllAbsencesReports()}loadOpenAbsencesReports(){return x([this.absencesSelectionService.selectedWithoutPresenceType$,this.absencesSelectionService.selectedIds$]).pipe(L(([e,i])=>e.length===0&&i.length>0?this.getOpenAbsencesRecordIds(ce(ee(i.map(n=>n.lessonIds)))):q([])),L(e=>this.reportsService.getStudentConfirmationReports(e)),B(1))}loadAllAbsencesReports(){return x([this.myAbsencesService.openLessonAbsences$,this.myAbsencesService.checkableLessonAbsences$,this.myAbsencesService.excusedLessonAbsences$,this.myAbsencesService.unexcusedLessonAbsences$,this.myAbsencesService.incidentsLessonAbsences$]).pipe(y(e=>this.getAllAbsencesRecordIds(ee(e))),L(e=>this.reportsService.getMyAbsencesReports(e)),B(1))}getAllAbsencesRecordIds(e){return e.map(i=>`${i.LessonRef.Id}_${i.RegistrationId}`)}getOpenAbsencesRecordIds(e){return this.myAbsencesService.openLessonAbsences$.pipe(y(i=>i.filter(n=>e.includes(n.LessonRef.Id)).map(n=>`${n.LessonRef.Id}_${n.RegistrationId}`)))}static{this.\u0275fac=function(i){return new(i||t)(u(Et),u(fe),u(de))}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-my-absences-show"]],decls:70,vars:38,consts:[["checkableAbsences","ngbAccordionItem"],["openAbsences","ngbAccordionItem"],["excusedAbsences","ngbAccordionItem"],["unexcusedAbsences","ngbAccordionItem"],["incidents","ngbAccordionItem"],[1,"bkd-container","bkd-container-limited"],[1,"d-flex","justify-content-between","border-bottom","header"],[1,"ps-3"],[3,"reports"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[3,"click","opened"],[3,"absences$"],[3,"absences$","selectionService","defaultAbsenceSelectionMessage","reports"],[3,"absences$","displayPresenceType"]],template:function(i,n){if(i&1){let s=O();N(0),r(1,"async"),a(2,"div",5)(3,"h1"),d(4),r(5,"translate"),c(),a(6,"div",6)(7,"div"),d(8),r(9,"translate"),c(),a(10,"div",7),S(11,"bkd-reports-link",8),r(12,"async"),c()(),a(13,"div",9)(14,"div",10)(15,"div",11),S(16,"bkd-my-absences-report-link"),c(),a(17,"div",12)(18,"div",13),h(19,Vi,0,0,"ng-template"),c()()(),a(20,"div",10,0)(22,"div",11)(23,"bkd-student-dossier-entry-header",14),g("click",function(){I(s);let v=R(21);return T(v.toggle())}),d(24),r(25,"translate"),h(26,Hi,1,1),c()(),a(27,"div",12)(28,"div",13),h(29,Gi,1,1,"ng-template"),c()()(),a(30,"div",10,1)(32,"div",11)(33,"bkd-student-dossier-entry-header",14),g("click",function(){I(s);let v=R(31);return T(v.toggle())}),d(34),r(35,"translate"),h(36,qi,1,1),c()(),a(37,"div",12)(38,"div",13),h(39,Ui,3,9,"ng-template"),c()()(),a(40,"div",10,2)(42,"div",11)(43,"bkd-student-dossier-entry-header",14),g("click",function(){I(s);let v=R(41);return T(v.toggle())}),d(44),r(45,"translate"),h(46,Wi,1,1),c()(),a(47,"div",12)(48,"div",13),h(49,Ki,1,1,"ng-template"),c()()(),a(50,"div",10,3)(52,"div",11)(53,"bkd-student-dossier-entry-header",14),g("click",function(){I(s);let v=R(51);return T(v.toggle())}),d(54),r(55,"translate"),h(56,Qi,1,1),c()(),a(57,"div",12)(58,"div",13),h(59,zi,1,2,"ng-template"),c()()(),a(60,"div",10,4)(62,"div",11)(63,"bkd-student-dossier-entry-header",14),g("click",function(){I(s);let v=R(61);return T(v.toggle())}),d(64),r(65,"translate"),h(66,Yi,1,1),c()(),a(67,"div",12)(68,"div",13),h(69,Xi,1,1,"ng-template"),c()()()()()}if(i&2){let s,p=R(21),v=R(31),A=R(41),F=R(51),U=R(61),M=J(l(1,18,n.myAbsencesService.counts$));o(4),$(l(5,21,"my-absences.title")),o(4),$(l(9,23,"my-absences.description")),o(3),b("reports",(s=l(12,25,n.allAbsencesReports$))!==null&&s!==void 0?s:Z(37,si)),o(12),b("opened",!p.collapsed),o(),f(" ",l(25,27,"shared.profile.checkable-absences")," "),o(2),C((M==null?null:M.checkableAbsences)!==null?26:-1),o(7),b("opened",!v.collapsed),o(),f(" ",l(35,29,"shared.profile.open-absences")," "),o(2),C((M==null?null:M.openAbsences)!==null?36:-1),o(7),b("opened",!A.collapsed),o(),f(" ",l(45,31,"shared.profile.excused-absences")," "),o(2),C((M==null?null:M.excusedAbsences)!==null?46:-1),o(7),b("opened",!F.collapsed),o(),f(" ",l(55,33,"shared.profile.unexcused-absences")," "),o(2),C((M==null?null:M.unexcusedAbsences)!==null?56:-1),o(7),b("opened",!U.collapsed),o(),f(" ",l(65,35,"shared.profile.incidents")," "),o(2),C((M==null?null:M.incidents)!==null?66:-1)}},dependencies:[$t,_t,yt,bt,ni,ft,ut,Dt,Pt,z,D],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem}"],changeDetection:0})}}return t})();var ri=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=k({type:t,selectors:[["bkd-my-absences"]],features:[se([fe,de])],decls:1,vars:0,template:function(i,n){i&1&&S(0,"router-outlet")},dependencies:[xe],encapsulation:2,changeDetection:0})}}return t})();var Ws=[{path:"",component:ri,children:[{path:"",component:oi},{path:"confirm",component:zt},{path:"report",component:ii,children:[{path:"",component:ti,data:{restoreScrollPositionFrom:["/my-absences/report/confirm"]}},{path:"confirm",component:Jt}]}]}];export{Ws as MY_ABSENCES_ROUTES};
