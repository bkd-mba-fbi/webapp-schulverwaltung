"use strict";(self.webpackChunkwebapp_schulverwaltung=self.webpackChunkwebapp_schulverwaltung||[]).push([[778],{1419:(O,S,o)=>{o.r(S),o.d(S,{MY_ABSENCES_ROUTES:()=>Sn});var l=o(177),d=o(9417),f=o(3955),m=o(3460),u=o(5529),p=o(6354),I=o(2809),A=o(7887),_=o(8676),v=o(4412),b=o(4572),y=o(7673),$=o(1413),g=o(6697),R=o(5964),k=o(5558),D=o(980),re=o(5421),T=o(8156),e=o(4438),L=o(5539),B=o(5889),Y=o(8413),V=o(9946),N=o(4599);let Z=(()=>{class t{constructor(n,s,i,r,c,C,h,M){this.fb=n,this.router=s,this.toastService=i,this.translate=r,this.presenceTypesService=c,this.updateService=C,this.storageService=h,this.settings=M,this.formGroup=this.createFormGroup(),this.saving$=new v.t(!1),this.submitted$=new v.t(!1),this.absenceTypes$=(0,b.z)([this.getConfirmationTypes(),this.getHalfDayType()]).pipe((0,p.T)(([P,G])=>G?[...P,G]:P)),this.absenceTypeIdErrors$=(0,T.v)((0,y.of)(this.formGroup),this.submitted$,"absenceTypeId"),this.destroy$=new $.B}ngOnInit(){this.selectedLessonIds$.pipe((0,g.s)(1),(0,R.p)(re.VP)).subscribe(()=>this.navigateBack())}ngOnDestroy(){this.destroy$.next()}onSubmit(){if(this.submitted$.next(!0),this.formGroup.valid){const{absenceTypeId:n}=this.formGroup.value;this.save(n)}}cancel(){this.navigateBack()}getSelectedCount(){return this.selectedLessonIds$.pipe((0,p.T)(n=>n.length))}getConfirmationTypes(){return this.presenceTypesService.confirmationTypes$.pipe((0,p.T)(n=>n.filter(s=>s.IsAbsence&&s.Id!==this.settings.halfDayPresenceTypeId)))}getHalfDayType(){return(0,y.of)(null)}createFormGroup(){return this.fb.group({absenceTypeId:[null,d.k0.required]})}save(n){this.saving$.next(!0),this.selectedLessonIds$.pipe((0,g.s)(1),(0,k.n)(s=>this.updateService.editLessonPresences(s,[Number(this.storageService.getPayload()?.id_person)],n)),(0,D.j)(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("my-absences.confirm.save-success")),this.navigateBack()}static#e=this.\u0275fac=function(s){return new(s||t)(e.rXU(d.ze),e.rXU(L.Ix),e.rXU(B.f),e.rXU(f.c$),e.rXU(Y._),e.rXU(V.T),e.rXU(N.n),e.rXU(I.wB))};static#n=this.\u0275cmp=e.VBU({type:t,selectors:[["ng-component"]],decls:0,vars:0,template:function(s,i){},encapsulation:2})}return t})();var q=o(2771),F=o(4668),ce=o(9172),ae=o(7647),j=o(9728),U=o(3382),ee=o(4125),ne=o(2949);let H=(()=>{class t{constructor(n,s,i){this.settings=n,this.storageService=s,this.studentsService=i,this.studentId$=new q.m(1),this.lessonAbsences$=this.studentId$.pipe((0,k.n)(this.loadLessonAbsences.bind(this)),(0,F.t)(1)),this.lessonIncidents$=this.studentId$.pipe((0,k.n)(this.loadLessonIncidents.bind(this)),(0,F.t)(1)),this.lessonPresences$=this.getLessonPresences(),this.checkableAbsences$=this.getAbsences(this.settings.checkableAbsenceStateId),this.openAbsences$=this.getAbsences(this.settings.unconfirmedAbsenceStateId),this.excusedAbsences$=this.getAbsences(this.settings.excusedAbsenceStateId),this.unexcusedAbsences$=this.getAbsences(this.settings.unexcusedAbsenceStateId),this.incidents$=this.getAbsences(null),this.openLessonAbsences$=(0,b.z)([this.openAbsences$.pipe((0,R.p)(j.TM)),this.lessonAbsences$]).pipe((0,p.T)((0,U.i)(this.getLessonAbsences.bind(this))),(0,F.t)(1)),this.checkableLessonAbsences$=(0,b.z)([this.checkableAbsences$.pipe((0,R.p)(j.TM)),this.lessonAbsences$]).pipe((0,p.T)((0,U.i)(this.getLessonAbsences.bind(this))),(0,F.t)(1)),this.excusedLessonAbsences$=(0,b.z)([this.excusedAbsences$.pipe((0,R.p)(j.TM)),this.lessonAbsences$]).pipe((0,p.T)((0,U.i)(this.getLessonAbsences.bind(this))),(0,F.t)(1)),this.unexcusedLessonAbsences$=(0,b.z)([this.unexcusedAbsences$.pipe((0,R.p)(j.TM)),this.lessonAbsences$]).pipe((0,p.T)((0,U.i)(this.getLessonAbsences.bind(this))),(0,F.t)(1)),this.incidentsLessonAbsences$=(0,b.z)([this.incidents$.pipe((0,R.p)(j.TM)),this.lessonIncidents$]).pipe((0,p.T)((0,U.i)(this.getLessonIncidents.bind(this))),(0,F.t)(1)),this.counts$=this.getCounts();const r=this.storageService.getPayload()?.id_person;r&&this.studentId$.next(Number(r))}reset(){this.studentId$.pipe((0,g.s)(1)).subscribe(n=>this.studentId$.next(n))}getLessonPresences(){return this.getCached((0,b.z)([this.studentId$,this.lessonAbsences$,this.lessonIncidents$]).pipe((0,k.n)(([n,s,i])=>this.loadTimetableEntries(n,s,i).pipe((0,p.T)(r=>this.buildLessonPresences(s,i,r)))),(0,p.T)(ee.wB)))}getAbsences(n){return this.getCached(this.lessonPresences$.pipe((0,p.T)(s=>s?.filter(i=>i.ConfirmationStateId===n)||null)))}getLessonAbsences(n,s){const i=n.map(r=>r.LessonRef.Id);return s.filter(r=>i.includes(r.LessonRef.Id))}getLessonIncidents(n,s){const i=n.map(r=>r.LessonRef.Id);return s.filter(r=>i.includes(r.LessonRef.Id))}getCounts(){return(0,b.z)([this.getCount(this.checkableAbsences$),this.getCount(this.openAbsences$),this.getCount(this.excusedAbsences$),this.getCount(this.unexcusedAbsences$),this.getCount(this.incidents$)]).pipe((0,p.T)(([n,s,i,r,c])=>({checkableAbsences:n,openAbsences:s,excusedAbsences:i,unexcusedAbsences:r,incidents:c,halfDays:null})))}getCached(n){return n.pipe((0,ce.Z)(null),(0,ae.u)({connector:()=>new q.m(1)}))}getCount(n){return n.pipe((0,p.T)(s=>s?.length??null))}loadLessonAbsences(n){return this.studentsService.getLessonAbsences(n)}loadLessonIncidents(n){return this.studentsService.getLessonIncidents(n)}loadTimetableEntries(n,s,i){return this.studentsService.getTimetableEntries(n,{"filter.Id":`;${[...s,...i].map(r=>r.LessonRef.Id).join(";")}`})}buildLessonPresences(n,s,i){return[...n,...s].map(r=>this.buildLessonPresence(r,i)).filter(j.TM)}buildLessonPresence(n,s){const i=s.find(r=>r.Id===n.LessonRef.Id);return i?{Id:"",LessonRef:{Id:n.LessonRef.Id,HRef:n.LessonRef.HRef?n.LessonRef.HRef:null},StudentRef:n.StudentRef,EventRef:{Id:0,HRef:null},TypeRef:n.TypeRef,RegistrationRef:{Id:0,HRef:null},StudyClassRef:{Id:0,HRef:null},ConfirmationStateId:"ConfirmationStateId"in n?n.ConfirmationStateId:null,EventDesignation:i.EventDesignation,HasStudyCourseConfirmationCode:!1,LessonDateTimeFrom:i.From,LessonDateTimeTo:i.To,Comment:null,Date:i.From,Type:n.Type,StudentFullName:n.StudentFullName,StudyClassNumber:"",TeacherInformation:i.EventManagerInformation}:null}static#e=this.\u0275fac=function(s){return new(s||t)(e.KVO(I.yy),e.KVO(N.n),e.KVO(ne.y))};static#n=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac})}return t})();var W=o(9366);const de=t=>({count:t}),le=t=>({"border-top pt-3":t});function pe(t,a){if(1&t&&(e.j41(0,"div",11),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&t){const n=a.bkdLet;e.R7$(),e.SpI(" ",e.i5U(2,1,1===n?"my-absences.confirm.lesson-selected":"my-absences.confirm.lessons-selected",e.eq3(4,de,n))," ")}}function me(t,a){if(1&t&&(e.j41(0,"div",17),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&t){const n=a.$implicit;e.R7$(),e.SpI(" ",e.i5U(2,1,"global.validation-errors."+n.error,n.params)," ")}}function be(t,a){if(1&t&&(e.qex(0),e.DNE(1,me,3,4,"div",16),e.nI1(2,"async"),e.bVm()),2&t){const n=e.XpG(2);e.R7$(),e.Y8G("ngForOf",e.bMT(2,1,n.absenceTypeIdErrors$))}}function ue(t,a){if(1&t&&(e.j41(0,"div",12),e.nrm(1,"input",13),e.nI1(2,"async"),e.j41(3,"label",14),e.EFF(4),e.k0s(),e.DNE(5,be,3,3,"ng-container",15),e.nI1(6,"async"),e.k0s()),2&t){let n,s;const i=a.$implicit,r=a.index,c=e.XpG();e.Y8G("ngClass",e.eq3(12,le,i.IsHalfDay)),e.R7$(),e.AVh("is-invalid",(null!==(n=null==(n=e.bMT(2,8,c.absenceTypeIdErrors$))?null:n.length)&&void 0!==n?n:0)>0),e.Y8G("id","absence-type-"+r)("value",i.Id),e.R7$(2),e.Y8G("for","absence-type-"+r),e.R7$(),e.SpI(" ",i.Designation," "),e.R7$(),e.Y8G("ngIf",(null!==(s=null==(s=e.bMT(6,10,c.absenceTypes$))?null:s.length)&&void 0!==s?s:0)-1===r)}}function fe(t,a){1&t&&(e.j41(0,"div",18)(1,"span",19),e.EFF(2,"Loading..."),e.k0s()())}let ge=(()=>{class t extends Z{constructor(n,s,i,r,c,C,h,M,P,G){super(n,s,i,r,c,C,h,M),this.myAbsencesService=P,this.selectionService=G,this.titleKey="my-absences.confirm.title",this.selectedLessonIds$=this.selectionService.selectedIds$.pipe((0,p.T)(w=>(0,m.A)((0,u.A)(w.map(Q=>Q.lessonIds))))),this.confirmationStateId=this.settings.unconfirmedAbsencesRefreshTime}onSaveSuccess(){this.selectionService.clear(),this.myAbsencesService.reset(),super.onSaveSuccess()}navigateBack(){this.router.navigate(["/my-absences"])}static#e=this.\u0275fac=function(s){return new(s||t)(e.rXU(d.ze),e.rXU(L.Ix),e.rXU(B.f),e.rXU(f.c$),e.rXU(Y._),e.rXU(V.T),e.rXU(N.n),e.rXU(I.yy),e.rXU(H),e.rXU(W.s))};static#n=this.\u0275cmp=e.VBU({type:t,selectors:[["bkd-my-absences-confirm"]],standalone:!0,features:[e.Vt3,e.aNF],decls:28,vars:35,consts:[[1,"bkd-container","bkd-container-limited"],["class","mb-3 pb-3 border-bottom",4,"bkdLet"],[3,"ngSubmit","formGroup"],[1,"form-group","mb-3","border-bottom"],[1,"form-label"],["class","form-check my-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"remark"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"mb-3","pb-3","border-bottom"],[1,"form-check","my-3",3,"ngClass"],["type","radio","formControlName","absenceTypeId",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],[4,"ngIf"],["class","invalid-feedback mt-4",4,"ngFor","ngForOf"],[1,"invalid-feedback","mt-4"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"visually-hidden"]],template:function(s,i){1&s&&(e.j41(0,"div",0)(1,"h1"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.DNE(4,pe,3,6,"div",1),e.nI1(5,"async"),e.j41(6,"form",2),e.bIt("ngSubmit",function(){return i.onSubmit()}),e.j41(7,"div",3)(8,"label",4),e.EFF(9),e.nI1(10,"translate"),e.nI1(11,"addSpace"),e.k0s(),e.DNE(12,ue,7,14,"div",5),e.nI1(13,"async"),e.k0s(),e.j41(14,"div",6),e.EFF(15),e.nI1(16,"translate"),e.k0s(),e.j41(17,"div",7)(18,"button",8),e.nI1(19,"async"),e.bIt("click",function(){return i.cancel()}),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.j41(22,"button",9),e.nI1(23,"async"),e.EFF(24),e.nI1(25,"translate"),e.DNE(26,fe,3,0,"div",10),e.nI1(27,"async"),e.k0s()()()()),2&s&&(e.R7$(2),e.JRh(e.bMT(3,12,i.titleKey)),e.R7$(2),e.Y8G("bkdLet",e.bMT(5,14,i.getSelectedCount())),e.R7$(2),e.Y8G("formGroup",i.formGroup),e.R7$(3),e.Lme("",e.bMT(10,16,"my-absences.confirm.choose-presence-type"),"",e.i5U(11,18,":",":"),""),e.R7$(3),e.Y8G("ngForOf",e.bMT(13,21,i.absenceTypes$)),e.R7$(3),e.SpI(" ",e.bMT(16,23,"my-absences.confirm.remark")," "),e.R7$(3),e.Y8G("disabled",e.bMT(19,25,i.saving$)),e.R7$(2),e.SpI(" ",e.bMT(21,27,"my-absences.confirm.cancel")," "),e.R7$(2),e.Y8G("disabled",e.bMT(23,29,i.saving$)),e.R7$(2),e.SpI(" ",e.bMT(25,31,"my-absences.confirm.save")," "),e.R7$(2),e.Y8G("ngIf",e.bMT(27,33,i.saving$)))},dependencies:[A.N,d.YN,d.qT,d.me,d.Fm,d.BC,d.cb,d.X1,d.j4,d.JD,l.pM,l.YU,l.bT,l.Jj,f.h,f.D9,_.c],changeDetection:0})}return t})();var he=o(1626),X=o(4903),_e=o(7165),ye=o(906),te=o(2915),ve=o(2673),Ie=o(4814);let K=(()=>{class t extends te.z{constructor(n,s,i,r,c,C){super(n,s,C,i,"/my-absences/report"),this.studentsService=r,this.storageService=c,this.preventAbsencesAfterStart=!1;const h=this.storageService.getPayload()?.instance_id;this.preventAbsencesAfterStart=!!h&&this.settings.preventStudentAbsenceAfterLessonStart.includes(h)}getInitialFilter(){return{dateFrom:null,dateTo:null}}isValidFilter(n){return!(!n.dateFrom&&!n.dateTo)}loadEntries(n,s,i){const r=this.buildRequestParamsFromFilter(n).set("sort","From.asc");return this.loadingService.load(this.loadTimetableEntries(r).pipe((0,p.T)(c=>this.filterAbsencesAfterLessonStart(c)),(0,k.n)(c=>(0,b.z)([(0,y.of)(c),this.loadLessonAbsences(c),this.loadLessonDispensations(c)])),(0,p.T)(([c,C,h])=>this.buildLessonPresences(c,C,h)),(0,p.T)(c=>({offset:0,total:c.length,entries:c}))),te.b)}filterAbsencesAfterLessonStart(n){return this.preventAbsencesAfterStart?n.filter(s=>s.From>=new Date):n}buildParamsFromFilter(n){const{dateFrom:s,dateTo:i}=n,r={};return s&&(r.dateFrom=(0,X.GP)(s,"yyyy-MM-dd")),i&&(r.dateTo=(0,X.GP)(i,"yyyy-MM-dd")),r}buildRequestParamsFromFilter(n){let s=new he.Nl;return n.dateFrom&&(s=s.set("filter.From",`>${(0,X.GP)((0,_e.e)(n.dateFrom,1),"yyyy-MM-dd")}`)),n.dateTo&&(s=s.set("filter.To",`<${(0,X.GP)((0,ye.f)(n.dateTo,1),"yyyy-MM-dd")}`)),s}get studentId(){const n=this.storageService.getPayload()?.id_person;if(null==n)throw new Error("No student id available");return Number(n)}loadTimetableEntries(n){return this.studentsService.getTimetableEntries(this.studentId,n)}loadLessonAbsences(n){return n.length>0?this.studentsService.getLessonAbsences(this.studentId,{"filter.Id":`;${n.map(s=>s.Id).join(";")}`}):(0,y.of)([])}loadLessonDispensations(n){return n.length>0?this.studentsService.getLessonDispensations(this.studentId,{"filter.Id":`;${n.map(s=>s.Id).join(";")}`}):(0,y.of)([])}buildLessonPresences(n,s,i){return n.map(r=>this.buildLessonPresence(r,s,i))}buildLessonPresence(n,s,i){const r=s.find(h=>h.LessonRef.Id===n.Id),c=i.find(h=>h.LessonRef.Id===n.Id),C=this.buildLessonPresenceTypeRef(r,c);return{Id:"",LessonRef:{Id:n.Id,HRef:null},StudentRef:(r||c)?.StudentRef||{Id:this.studentId,HRef:null},EventRef:{Id:0,HRef:null},TypeRef:C,RegistrationRef:{Id:0,HRef:null},StudyClassRef:{Id:0,HRef:null},ConfirmationStateId:r?.ConfirmationStateId||c&&this.settings.excusedAbsenceStateId||null,EventDesignation:n.EventDesignation||"",HasStudyCourseConfirmationCode:!1,LessonDateTimeFrom:n.From||new Date,LessonDateTimeTo:n.To||new Date,Comment:null,Date:n.From||new Date,Type:(r||c)?.Type||null,StudentFullName:(r||c)?.StudentFullName||"",StudyClassNumber:"",TeacherInformation:n.EventManagerInformation}}buildLessonPresenceTypeRef(n,s){return n?{...n.TypeRef}:s?{...s.TypeRef}:{Id:null,HRef:null}}static#e=this.\u0275fac=function(s){return new(s||t)(e.KVO(l.aZ),e.KVO(ve.U),e.KVO(I.yy),e.KVO(ne.y),e.KVO(N.n),e.KVO(Ie.a))};static#n=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac})}return t})();var Te=o(8268);let J=(()=>{class t extends Te.A{constructor(){super(...arguments),this.selectedIds$=this.selection$.pipe((0,p.T)(ee.Jr))}static#e=this.\u0275fac=(()=>{let n;return function(i){return(n||(n=e.xGo(t)))(i||t)}})();static#n=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac})}return t})();const Ae=t=>({count:t}),$e=t=>({"border-top pt-3":t});function Re(t,a){if(1&t&&(e.j41(0,"div",11),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&t){const n=a.bkdLet;e.R7$(),e.SpI(" ",e.i5U(2,1,1===n?"my-absences.confirm.lesson-selected":"my-absences.confirm.lessons-selected",e.eq3(4,Ae,n))," ")}}function Ce(t,a){if(1&t&&(e.j41(0,"div",17),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&t){const n=a.$implicit;e.R7$(),e.SpI(" ",e.i5U(2,1,"global.validation-errors."+n.error,n.params)," ")}}function Me(t,a){if(1&t&&(e.qex(0),e.DNE(1,Ce,3,4,"div",16),e.nI1(2,"async"),e.bVm()),2&t){const n=e.XpG(2);e.R7$(),e.Y8G("ngForOf",e.bMT(2,1,n.absenceTypeIdErrors$))}}function Se(t,a){if(1&t&&(e.j41(0,"div",12),e.nrm(1,"input",13),e.nI1(2,"async"),e.j41(3,"label",14),e.EFF(4),e.k0s(),e.DNE(5,Me,3,3,"ng-container",15),e.nI1(6,"async"),e.k0s()),2&t){let n,s;const i=a.$implicit,r=a.index,c=e.XpG();e.Y8G("ngClass",e.eq3(12,$e,i.IsHalfDay)),e.R7$(),e.AVh("is-invalid",(null!==(n=null==(n=e.bMT(2,8,c.absenceTypeIdErrors$))?null:n.length)&&void 0!==n?n:0)>0),e.Y8G("id","absence-type-"+r)("value",i.Id),e.R7$(2),e.Y8G("for","absence-type-"+r),e.R7$(),e.SpI(" ",i.Designation," "),e.R7$(),e.Y8G("ngIf",(null!==(s=null==(s=e.bMT(6,10,c.absenceTypes$))?null:s.length)&&void 0!==s?s:0)-1===r)}}function ke(t,a){1&t&&(e.j41(0,"div",18)(1,"span",19),e.EFF(2,"Loading..."),e.k0s()())}let Fe=(()=>{class t extends Z{constructor(n,s,i,r,c,C,h,M,P,G){super(n,s,i,r,c,C,h,M),this.state=P,this.selectionService=G,this.titleKey="my-absences.report.title",this.selectedLessonIds$=this.selectionService.selectedIds$.pipe((0,p.T)(w=>(0,m.A)((0,u.A)(w.map(Q=>Q.lessonIds))))),this.confirmationStateId=this.settings.checkableAbsenceStateId}getHalfDayType(){return this.presenceTypesService.getPresenceType(this.settings.halfDayPresenceTypeId).pipe((0,p.T)(n=>n.Active?n:null))}onSaveSuccess(){this.selectionService.clear(),this.state.resetEntries(),super.onSaveSuccess()}navigateBack(){this.state.queryParams$.pipe((0,g.s)(1)).subscribe(n=>{this.router.navigate(["/my-absences/report"],{queryParams:n})})}static#e=this.\u0275fac=function(s){return new(s||t)(e.rXU(d.ze),e.rXU(L.Ix),e.rXU(B.f),e.rXU(f.c$),e.rXU(Y._),e.rXU(V.T),e.rXU(N.n),e.rXU(I.yy),e.rXU(K),e.rXU(J))};static#n=this.\u0275cmp=e.VBU({type:t,selectors:[["bkd-my-absences-confirm"]],standalone:!0,features:[e.Vt3,e.aNF],decls:28,vars:35,consts:[[1,"bkd-container","bkd-container-limited"],["class","mb-3 pb-3 border-bottom",4,"bkdLet"],[3,"ngSubmit","formGroup"],[1,"form-group","mb-3","border-bottom"],[1,"form-label"],["class","form-check my-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"remark"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"mb-3","pb-3","border-bottom"],[1,"form-check","my-3",3,"ngClass"],["type","radio","formControlName","absenceTypeId",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],[4,"ngIf"],["class","invalid-feedback mt-4",4,"ngFor","ngForOf"],[1,"invalid-feedback","mt-4"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"visually-hidden"]],template:function(s,i){1&s&&(e.j41(0,"div",0)(1,"h1"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.DNE(4,Re,3,6,"div",1),e.nI1(5,"async"),e.j41(6,"form",2),e.bIt("ngSubmit",function(){return i.onSubmit()}),e.j41(7,"div",3)(8,"label",4),e.EFF(9),e.nI1(10,"translate"),e.nI1(11,"addSpace"),e.k0s(),e.DNE(12,Se,7,14,"div",5),e.nI1(13,"async"),e.k0s(),e.j41(14,"div",6),e.EFF(15),e.nI1(16,"translate"),e.k0s(),e.j41(17,"div",7)(18,"button",8),e.nI1(19,"async"),e.bIt("click",function(){return i.cancel()}),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.j41(22,"button",9),e.nI1(23,"async"),e.EFF(24),e.nI1(25,"translate"),e.DNE(26,ke,3,0,"div",10),e.nI1(27,"async"),e.k0s()()()()),2&s&&(e.R7$(2),e.JRh(e.bMT(3,12,i.titleKey)),e.R7$(2),e.Y8G("bkdLet",e.bMT(5,14,i.getSelectedCount())),e.R7$(2),e.Y8G("formGroup",i.formGroup),e.R7$(3),e.Lme("",e.bMT(10,16,"my-absences.confirm.choose-presence-type"),"",e.i5U(11,18,":",":"),""),e.R7$(3),e.Y8G("ngForOf",e.bMT(13,21,i.absenceTypes$)),e.R7$(3),e.SpI(" ",e.bMT(16,23,"my-absences.confirm.remark")," "),e.R7$(3),e.Y8G("disabled",e.bMT(19,25,i.saving$)),e.R7$(2),e.SpI(" ",e.bMT(21,27,"my-absences.confirm.cancel")," "),e.R7$(2),e.Y8G("disabled",e.bMT(23,29,i.saving$)),e.R7$(2),e.SpI(" ",e.bMT(25,31,"my-absences.confirm.save")," "),e.R7$(2),e.Y8G("ngIf",e.bMT(27,33,i.saving$)))},dependencies:[A.N,d.YN,d.qT,d.me,d.Fm,d.BC,d.cb,d.X1,d.j4,d.JD,l.pM,l.YU,l.bT,l.Jj,f.h,f.D9,_.c],changeDetection:0})}return t})();var Le=o(6977),x=o(5314),z=o(2055),se=o(6834),Ee=o(1517),De=o(5063),E=o(1324),je=o(3601),xe=o(1964),Pe=o(2637),Ge=o(181);const Oe=()=>["/my-absences"];let Ne=(()=>{class t{constructor(){this.filter={dateFrom:null,dateTo:null},this.filterChange=new e.bkB,this.minDate={year:(new Date).getFullYear(),month:(new Date).getMonth()+1,day:(new Date).getDate()}}updateDateFrom(n){this.filter.dateFrom=n,n&&(this.filter.dateTo=n)}show(){this.filterChange.emit({dateFrom:ie(this.filter.dateFrom),dateTo:ie(this.filter.dateTo)})}static#e=this.\u0275fac=function(s){return new(s||t)};static#n=this.\u0275cmp=e.VBU({type:t,selectors:[["bkd-my-absences-report-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},standalone:!0,features:[e.Jv_([{provide:E.dn,useClass:E.Ae},{provide:E.tN,useClass:xe.m}]),e.aNF],decls:19,vars:18,consts:[[3,"link"],[1,"filters"],[1,"form-group"],[1,"form-label"],[3,"valueChange","minDate","value"],[1,"buttons"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(s,i){1&s&&(e.nrm(0,"bkd-backlink",0),e.j41(1,"h1"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"div",1)(5,"div",2)(6,"label",3),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"bkd-date-select",4),e.bIt("valueChange",function(c){return i.updateDateFrom(c)}),e.k0s()(),e.j41(10,"div",2)(11,"label",3),e.EFF(12),e.nI1(13,"translate"),e.k0s(),e.j41(14,"bkd-date-select",4),e.mxI("valueChange",function(c){return e.DH7(i.filter.dateTo,c)||(i.filter.dateTo=c),c}),e.k0s()(),e.j41(15,"div",5)(16,"button",6),e.bIt("click",function(){return i.show()}),e.EFF(17),e.nI1(18,"translate"),e.k0s()()()),2&s&&(e.Y8G("link",e.lJ4(17,Oe)),e.R7$(2),e.JRh(e.bMT(3,9,"my-absences.report.title")),e.R7$(5),e.JRh(e.bMT(8,11,"my-absences.report.header.date-from")),e.R7$(2),e.Y8G("minDate",i.minDate)("value",i.filter.dateFrom),e.R7$(3),e.JRh(e.bMT(13,13,"my-absences.report.header.date-to")),e.R7$(2),e.Y8G("minDate",i.minDate),e.R50("value",i.filter.dateTo),e.R7$(3),e.SpI(" ",e.bMT(18,15,"my-absences.report.header.show")," "))},dependencies:[Pe.P,Ge.m,f.h,f.D9],styles:["[_nghost-%COMP%]{display:block;padding-bottom:1rem;border-bottom:1px solid #dee2e6}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.form-group[_ngcontent-%COMP%]{flex:1;min-width:20rem;max-width:40rem;margin-right:1rem;margin-bottom:.5rem}.buttons[_ngcontent-%COMP%]{flex:none;margin-top:1.625rem;margin-right:0}@media (max-width: 575.98px){[_nghost-%COMP%]{padding-bottom:0}.buttons[_ngcontent-%COMP%]{width:100%;margin-top:1rem;margin-bottom:1rem}}"],changeDetection:0})}return t})();function ie(t){return t?(0,je.o)(t):null}var Ue=o(1769);const Ye=(t,a,n)=>({selection:t,entries:a,loadingPage:n});function Xe(t,a){if(1&t){const n=e.RV6();e.j41(0,"div",15)(1,"input",16,6),e.nI1(3,"async"),e.bIt("change",function(){e.eBV(n);const i=e.XpG(2).$implicit,r=e.XpG(6);return e.Njj(r.selectionService.toggle(i))}),e.k0s()()}if(2&t){const n=e.XpG(2).$implicit,s=e.XpG(6);e.R7$(),e.Y8G("checked",e.bMT(3,1,s.selectionService.isSelected$(n)))}}function Be(t,a){if(1&t&&(e.j41(0,"div")(1,"i",20),e.EFF(2),e.k0s()()),2&t){const n=e.XpG().bkdLet;e.ZvI("checkbox presence-category ",n.category,""),e.R7$(2),e.JRh(n.icon)}}function Ve(t,a){if(1&t&&(e.qex(0),e.DNE(1,Xe,4,3,"div",29)(2,Be,3,4,"ng-template",null,5,e.C5r),e.bVm()),2&t){const n=a.bkdLet,s=e.sdS(3);e.R7$(),e.Y8G("ngIf",!n)("ngIfElse",s)}}function He(t,a){if(1&t&&(e.qex(0),e.EFF(1),e.bVm()),2&t){const n=e.XpG().$implicit;e.R7$(),e.SpI(", ",n.StudyClassNumber,"")}}function We(t,a){if(1&t&&(e.j41(0,"div",31),e.EFF(1),e.k0s()),2&t){const n=e.XpG().bkdLet;e.R7$(),e.SpI(" ",n," ")}}function Ke(t,a){if(1&t&&(e.qex(0),e.DNE(1,We,2,1,"div",30),e.bVm()),2&t){const n=a.bkdLet;e.R7$(),e.Y8G("ngIf",n)}}function Je(t,a){if(1&t){const n=e.RV6();e.j41(0,"div",22,4),e.bIt("click",function(i){e.eBV(n);const r=e.sdS(1),c=e.XpG(6);return e.Njj(c.onRowClick(i,r))}),e.DNE(2,Ve,4,2,"ng-container",7),e.nI1(3,"async"),e.j41(4,"div",23),e.EFF(5),e.DNE(6,He,2,1,"ng-container",12),e.k0s(),e.j41(7,"div",24),e.EFF(8),e.nI1(9,"date"),e.nI1(10,"date"),e.k0s(),e.j41(11,"div",25),e.EFF(12),e.k0s(),e.DNE(13,Ke,2,1,"ng-container",7),e.nI1(14,"async"),e.j41(15,"div",26),e.EFF(16),e.nI1(17,"date"),e.k0s(),e.j41(18,"div",27),e.EFF(19),e.nI1(20,"bkdDaysDifference"),e.k0s(),e.j41(21,"div",28),e.EFF(22),e.nI1(23,"date"),e.nI1(24,"bkdDaysDifference"),e.k0s()()}if(2&t){const n=a.$implicit,s=e.XpG(6);e.R7$(2),e.Y8G("bkdLet",e.bMT(3,11,s.getPresenceCategory(n))),e.R7$(3),e.SpI(" ",n.EventDesignation,""),e.R7$(),e.Y8G("ngIf",n.StudyClassNumber),e.R7$(2),e.Lme(" ",e.i5U(9,13,n.LessonDateTimeFrom,"HH:mm"),"\u2013",e.i5U(10,16,n.LessonDateTimeTo,"HH:mm")," "),e.R7$(4),e.SpI(" ",n.TeacherInformation," "),e.R7$(),e.Y8G("bkdLet",e.bMT(14,19,s.getPresenceTypeDesignation(n))),e.R7$(3),e.SpI(" ",e.i5U(17,21,n.LessonDateTimeFrom,"dd.MM.yyyy")," "),e.R7$(3),e.SpI(" ",e.bMT(20,24,n.LessonDateTimeFrom)," "),e.R7$(3),e.Lme(" ",e.i5U(23,26,n.LessonDateTimeFrom,"dd.MM.yyyy"),", ",e.bMT(24,29,n.LessonDateTimeFrom)," ")}}function ze(t,a){if(1&t){const n=e.RV6();e.j41(0,"div")(1,"div",14,3),e.bIt("click",function(i){e.eBV(n);const r=e.sdS(2),c=e.XpG(5);return e.Njj(c.onRowClick(i,r))}),e.j41(3,"div",15)(4,"input",16),e.nI1(5,"async"),e.bIt("change",function(i){e.eBV(n);const r=e.XpG(5);return e.Njj(r.toggleAll(null==i.target?null:i.target.checked))}),e.k0s()(),e.j41(6,"div",17),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"div",18)(10,"a",19),e.nI1(11,"async"),e.j41(12,"i",20),e.EFF(13,"edit"),e.k0s()()()(),e.DNE(14,Je,25,31,"div",21),e.k0s()}if(2&t){let n;const s=e.XpG(4).bkdLet,i=e.XpG();e.R7$(4),e.Y8G("checked",e.bMT(5,5,i.allSelected$)),e.R7$(3),e.SpI(" ",e.bMT(8,7,"my-absences.report.list.all")," "),e.R7$(3),e.AVh("disabled",0===(null==(n=e.bMT(11,9,i.selectionService.selection$))?null:n.length)),e.R7$(4),e.Y8G("ngForOf",s.entries)}}function we(t,a){1&t&&e.nrm(0,"bkd-spinner",32)}function Qe(t,a){if(1&t&&(e.j41(0,"div",11),e.DNE(1,ze,15,11,"div",12)(2,we,1,0,"bkd-spinner",13),e.k0s()),2&t){const n=e.XpG(3).bkdLet;e.R7$(),e.Y8G("ngIf",n.entries&&n.entries.length>0),e.R7$(),e.Y8G("ngIf",n.loadingPage)}}function Ze(t,a){1&t&&(e.j41(0,"p",33),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&t&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"my-absences.report.no-entries")," "))}function qe(t,a){if(1&t&&(e.qex(0),e.DNE(1,Qe,3,2,"div",10)(2,Ze,3,3,"ng-template",null,2,e.C5r),e.bVm()),2&t){const n=e.sdS(3),s=e.XpG(2).bkdLet;e.R7$(),e.Y8G("ngIf",s.entries&&s.entries.length>0||s.loadingPage)("ngIfElse",n)}}function en(t,a){1&t&&e.nrm(0,"bkd-spinner")}function nn(t,a){if(1&t&&(e.qex(0),e.DNE(1,qe,4,2,"ng-container",9),e.nI1(2,"async"),e.DNE(3,en,1,0,"ng-template",null,1,e.C5r),e.bVm()),2&t){const n=e.sdS(4),s=e.XpG(2);e.R7$(),e.Y8G("ngIf",!1===e.bMT(2,2,s.state.loading$))("ngIfElse",n)}}function tn(t,a){1&t&&(e.j41(0,"p",33),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&t&&(e.R7$(),e.JRh(e.bMT(2,1,"my-absences.report.no-filter")))}function sn(t,a){if(1&t){const n=e.RV6();e.qex(0),e.j41(1,"bkd-my-absences-report-header",8),e.nI1(2,"async"),e.bIt("filterChange",function(i){e.eBV(n);const r=e.XpG();return e.Njj(r.state.setFilter(i))}),e.k0s(),e.DNE(3,nn,5,4,"ng-container",9),e.nI1(4,"async"),e.DNE(5,tn,3,3,"ng-template",null,0,e.C5r),e.bVm()}if(2&t){const n=e.sdS(6),s=e.XpG();e.R7$(),e.Y8G("filter",e.bMT(2,3,s.filterFromParams$)),e.R7$(2),e.Y8G("ngIf",e.bMT(4,5,s.state.isFilterValid$))("ngIfElse",n)}}let on=(()=>{class t{constructor(n,s,i,r,c,C){this.state=n,this.selectionService=s,this.route=i,this.scrollPosition=r,this.presenceTypesService=c,this.settings=C,this.filterFromParams$=this.route.queryParams.pipe((0,p.T)(rn)),this.allSelected$=(0,b.z)([this.selectionService.selection$,this.state.entries$.pipe((0,k.n)(h=>(0,b.z)(h.map(M=>this.getPresenceType(M)))))]).pipe((0,p.T)(([h,M])=>h.length>0&&h.length===M.filter((0,j.AU)(z.W0)).length)),this.destroy$=new $.B}ngOnInit(){this.filterFromParams$.pipe((0,g.s)(1)).subscribe(n=>this.state.setFilter(n)),this.state.validFilter$.pipe((0,Le.Q)(this.destroy$)).subscribe(()=>this.selectionService.clear())}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}getPresenceCategory(n){return this.getPresenceType(n).pipe((0,p.T)(s=>(0,z.W0)(s)?n.ConfirmationStateId===this.settings.checkableAbsenceStateId?{category:x.wf.Unapproved,icon:(0,x.Rb)(x.wf.Unapproved)}:{category:x.wf.Absent,icon:(0,x.Rb)(x.wf.Absent)}:null))}getPresenceTypeDesignation(n){return this.presenceTypesService.displayedTypes$.pipe((0,p.T)(s=>n.TypeRef.Id&&s.find(i=>i.Id===n.TypeRef.Id)?.Designation||null))}toggleAll(n){(0,b.z)([this.state.entries$.pipe((0,g.s)(1)),this.presenceTypesService.presenceTypes$.pipe((0,g.s)(1))]).subscribe(([s,i])=>{const r=i.filter(c=>(0,z.W0)(c)).map(c=>c.Id);this.selectionService.clear(n?s.filter(c=>null==c.TypeRef.Id||!r.includes(c.TypeRef.Id)):null)})}onRowClick(n,s){const i=s.querySelector('input[type="checkbox"]');i&&n.target!==i&&!n.target.closest(".buttons")&&i.click()}getPresenceType(n){return this.presenceTypesService.presenceTypes$.pipe((0,p.T)(s=>n.TypeRef.Id&&s.find(i=>i.Id===n.TypeRef.Id)||null))}static#e=this.\u0275fac=function(s){return new(s||t)(e.rXU(K),e.rXU(J),e.rXU(L.nX),e.rXU(Ue.W),e.rXU(Y._),e.rXU(I.yy))};static#n=this.\u0275cmp=e.VBU({type:t,selectors:[["bkd-my-absences-report-list"]],standalone:!0,features:[e.aNF],decls:4,vars:11,consts:[["noFilter",""],["loading",""],["noEntries",""],["all",""],["row",""],["categoryIcon",""],["checkbox",""],[4,"bkdLet"],[3,"filterChange","filter"],[4,"ngIf","ngIfElse"],["class","py-3",4,"ngIf","ngIfElse"],[1,"py-3"],[4,"ngIf"],["class","inline",4,"ngIf"],[1,"entries-all",3,"click"],[1,"checkbox"],["type","checkbox",1,"form-check-input",3,"change","checked"],[1,"all"],[1,"buttons"],["routerLink","confirm",1,"edit","btn","btn-primary","btn-icon","me-2"],[1,"material-icons"],["class","entry",3,"click",4,"ngFor","ngForOf"],[1,"entry",3,"click"],[1,"lesson-class"],[1,"time","pe-2"],[1,"teacher"],[1,"date"],[1,"days-ago"],[1,"date-days-ago"],["class","checkbox",4,"ngIf","ngIfElse"],["class","presence-type",4,"ngIf"],[1,"presence-type"],[1,"inline"],[1,"mt-3"]],template:function(s,i){1&s&&(e.DNE(0,sn,7,7,"ng-container",7),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async")),2&s&&e.Y8G("bkdLet",e.sMw(7,Ye,e.bMT(1,1,i.selectionService.selection$),e.bMT(2,3,i.state.entries$),e.bMT(3,5,i.state.loadingPage$)))},dependencies:[A.N,Ne,l.bT,L.Wk,l.pM,Ee.t,l.Jj,l.vh,f.h,f.D9,De.j],styles:['.entries-all[_ngcontent-%COMP%]{padding:0 0 .5rem 1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox all buttons";grid-template-columns:min-content 1fr min-content}.entry[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox lesson-class time teacher" "checkbox presence-type date days-ago";grid-template-columns:min-content 2fr 1fr 2fr}.entry[_ngcontent-%COMP%]:first-child{padding-top:0}.entries-all[_ngcontent-%COMP%] + .entry[_ngcontent-%COMP%]{padding-top:1rem}.presence-category.absent[_ngcontent-%COMP%]{color:#ea161f}.presence-category.unapproved[_ngcontent-%COMP%]{color:#ffa814}.checkbox[_ngcontent-%COMP%]{grid-area:checkbox;margin:0;padding:.3rem 1rem 0 0}.presence-category[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{display:block;font-size:16px}.entries-all[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{padding-top:.2rem}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.all[_ngcontent-%COMP%]{grid-area:all}.buttons[_ngcontent-%COMP%]{grid-area:buttons;display:flex}.lesson-class[_ngcontent-%COMP%]{grid-area:lesson-class;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.time[_ngcontent-%COMP%]{grid-area:time}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.presence-type[_ngcontent-%COMP%]{color:#adb5bd;grid-area:presence-type}.date[_ngcontent-%COMP%]{grid-area:date}.days-ago[_ngcontent-%COMP%]{color:#adb5bd;grid-area:days-ago}.date-days-ago[_ngcontent-%COMP%]{grid-area:date-days-ago;display:none}@media (max-width: 750px){.entry[_ngcontent-%COMP%]{grid-template-areas:"checkbox lesson-class" "checkbox teacher" "checkbox date-days-ago" "checkbox time" "checkbox presence-type";grid-template-columns:min-content 1fr}.date-days-ago[_ngcontent-%COMP%]{display:block}.date[_ngcontent-%COMP%], .days-ago[_ngcontent-%COMP%]{display:none}}'],changeDetection:0})}return t})();function rn(t){return{dateFrom:t.dateFrom?(0,se.cv)(t.dateFrom):null,dateTo:t.dateTo?(0,se.cv)(t.dateTo):null}}let cn=(()=>{class t{constructor(){}static#e=this.\u0275fac=function(s){return new(s||t)};static#n=this.\u0275cmp=e.VBU({type:t,selectors:[["bkd-my-absences-report"]],standalone:!0,features:[e.Jv_([K,J]),e.aNF],decls:1,vars:0,template:function(s,i){1&s&&e.nrm(0,"router-outlet")},dependencies:[L.n3],changeDetection:0})}return t})();var an=o(8667),dn=o(235),ln=o(3919);const pn=["link"],mn=()=>["/my-absences/report"];let bn=(()=>{class t{onClick(){this.link.nativeElement.click()}constructor(){}static#e=this.\u0275fac=function(s){return new(s||t)};static#n=this.\u0275cmp=e.VBU({type:t,selectors:[["bkd-my-absences-report-link"]],viewQuery:function(s,i){if(1&s&&e.GBs(pn,5),2&s){let r;e.mGM(r=e.lsd())&&(i.link=r.first)}},hostBindings:function(s,i){1&s&&e.bIt("click",function(c){return i.onClick(c)})},standalone:!0,features:[e.aNF],decls:8,vars:5,consts:[["link",""],[1,"m-0"],[1,"btn","btn-link","p-0",3,"routerLink"],[1,"d-flex","align-items-center"],[1,"material-icons"]],template:function(s,i){1&s&&(e.j41(0,"h5",1),e.EFF(1),e.nI1(2,"translate"),e.k0s(),e.j41(3,"a",2,0)(5,"div",3)(6,"i",4),e.EFF(7,"keyboard_arrow_right"),e.k0s()()()),2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,2,"my-absences.report.title"),"\n"),e.R7$(2),e.Y8G("routerLink",e.lJ4(4,mn)))},dependencies:[L.Wk,f.h,f.D9],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1rem;cursor:pointer}.btn[_ngcontent-%COMP%]{color:#000;text-decoration:none}"],changeDetection:0})}return t})();var un=o(5507);const fn=t=>({absenceCounts:t}),oe=()=>[];function gn(t,a){}function hn(t,a){if(1&t&&(e.qex(0),e.EFF(1),e.bVm()),2&t){const n=e.XpG().bkdLet;e.R7$(),e.SpI("(",n.absenceCounts.checkableAbsences,") ")}}function _n(t,a){if(1&t&&e.nrm(0,"bkd-student-dossier-absences",17),2&t){const n=e.XpG(2);e.Y8G("absences$",n.myAbsencesService.checkableAbsences$)}}function yn(t,a){if(1&t&&(e.qex(0),e.EFF(1),e.bVm()),2&t){const n=e.XpG().bkdLet;e.R7$(),e.SpI("(",n.absenceCounts.openAbsences,") ")}}function vn(t,a){if(1&t&&(e.nrm(0,"bkd-student-dossier-absences",18),e.nI1(1,"translate"),e.nI1(2,"async")),2&t){let n;const s=e.XpG(2);e.Y8G("absences$",s.myAbsencesService.openAbsences$)("selectionService",s.absencesSelectionService)("defaultAbsenceSelectionMessage",e.bMT(1,4,"my-absences.show.default-absence-selection-message"))("reports",null!==(n=e.bMT(2,6,s.openAbsencesReports$))&&void 0!==n?n:e.lJ4(8,oe))}}function In(t,a){if(1&t&&(e.qex(0),e.EFF(1),e.bVm()),2&t){const n=e.XpG().bkdLet;e.R7$(),e.SpI("(",n.absenceCounts.excusedAbsences,") ")}}function Tn(t,a){if(1&t&&e.nrm(0,"bkd-student-dossier-absences",17),2&t){const n=e.XpG(2);e.Y8G("absences$",n.myAbsencesService.excusedAbsences$)}}function An(t,a){if(1&t&&(e.qex(0),e.EFF(1),e.bVm()),2&t){const n=e.XpG().bkdLet;e.R7$(),e.SpI("(",n.absenceCounts.unexcusedAbsences,") ")}}function $n(t,a){if(1&t&&e.nrm(0,"bkd-student-dossier-absences",19),2&t){const n=e.XpG(2);e.Y8G("absences$",n.myAbsencesService.unexcusedAbsences$)("displayPresenceType",!1)}}function Rn(t,a){if(1&t&&(e.qex(0),e.EFF(1),e.bVm()),2&t){const n=e.XpG().bkdLet;e.R7$(),e.SpI("(",n.absenceCounts.incidents,") ")}}function Cn(t,a){if(1&t&&e.nrm(0,"bkd-student-dossier-absences",17),2&t){const n=e.XpG(2);e.Y8G("absences$",n.myAbsencesService.incidents$)}}function Mn(t,a){if(1&t){const n=e.RV6();e.j41(0,"div",6)(1,"h1"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"div",7)(5,"div"),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.j41(8,"div",8),e.nrm(9,"bkd-reports-link",9),e.nI1(10,"async"),e.k0s()(),e.j41(11,"div",10)(12,"div",11)(13,"div",12),e.nrm(14,"bkd-my-absences-report-link"),e.k0s(),e.j41(15,"div",13)(16,"div",14),e.DNE(17,gn,0,0,"ng-template"),e.k0s()()(),e.j41(18,"div",11,0)(20,"div",12)(21,"bkd-student-dossier-entry-header",15),e.bIt("click",function(){e.eBV(n);const i=e.sdS(19);return e.Njj(i.toggle())}),e.EFF(22),e.nI1(23,"translate"),e.DNE(24,hn,2,1,"ng-container",16),e.k0s()(),e.j41(25,"div",13)(26,"div",14),e.DNE(27,_n,1,1,"ng-template"),e.k0s()()(),e.j41(28,"div",11,1)(30,"div",12)(31,"bkd-student-dossier-entry-header",15),e.bIt("click",function(){e.eBV(n);const i=e.sdS(29);return e.Njj(i.toggle())}),e.EFF(32),e.nI1(33,"translate"),e.DNE(34,yn,2,1,"ng-container",16),e.k0s()(),e.j41(35,"div",13)(36,"div",14),e.DNE(37,vn,3,9,"ng-template"),e.k0s()()(),e.j41(38,"div",11,2)(40,"div",12)(41,"bkd-student-dossier-entry-header",15),e.bIt("click",function(){e.eBV(n);const i=e.sdS(39);return e.Njj(i.toggle())}),e.EFF(42),e.nI1(43,"translate"),e.DNE(44,In,2,1,"ng-container",16),e.k0s()(),e.j41(45,"div",13)(46,"div",14),e.DNE(47,Tn,1,1,"ng-template"),e.k0s()()(),e.j41(48,"div",11,3)(50,"div",12)(51,"bkd-student-dossier-entry-header",15),e.bIt("click",function(){e.eBV(n);const i=e.sdS(49);return e.Njj(i.toggle())}),e.EFF(52),e.nI1(53,"translate"),e.DNE(54,An,2,1,"ng-container",16),e.k0s()(),e.j41(55,"div",13)(56,"div",14),e.DNE(57,$n,1,2,"ng-template"),e.k0s()()(),e.j41(58,"div",11,4)(60,"div",12)(61,"bkd-student-dossier-entry-header",15),e.bIt("click",function(){e.eBV(n);const i=e.sdS(59);return e.Njj(i.toggle())}),e.EFF(62),e.nI1(63,"translate"),e.DNE(64,Rn,2,1,"ng-container",16),e.k0s()(),e.j41(65,"div",13)(66,"div",14),e.DNE(67,Cn,1,1,"ng-template"),e.k0s()()()()()}if(2&t){let n;const s=a.bkdLet,i=e.sdS(19),r=e.sdS(29),c=e.sdS(39),C=e.sdS(49),h=e.sdS(59),M=e.XpG();e.R7$(2),e.JRh(e.bMT(3,18,"my-absences.title")),e.R7$(4),e.JRh(e.bMT(7,20,"my-absences.description")),e.R7$(3),e.Y8G("reports",null!==(n=e.bMT(10,22,M.allAbsencesReports$))&&void 0!==n?n:e.lJ4(34,oe)),e.R7$(12),e.Y8G("opened",!i.collapsed),e.R7$(),e.SpI(" ",e.bMT(23,24,"shared.profile.checkable-absences")," "),e.R7$(2),e.Y8G("ngIf",null!==s.absenceCounts.checkableAbsences),e.R7$(7),e.Y8G("opened",!r.collapsed),e.R7$(),e.SpI(" ",e.bMT(33,26,"shared.profile.open-absences")," "),e.R7$(2),e.Y8G("ngIf",null!==s.absenceCounts.openAbsences),e.R7$(7),e.Y8G("opened",!c.collapsed),e.R7$(),e.SpI(" ",e.bMT(43,28,"shared.profile.excused-absences")," "),e.R7$(2),e.Y8G("ngIf",null!==s.absenceCounts.excusedAbsences),e.R7$(7),e.Y8G("opened",!C.collapsed),e.R7$(),e.SpI(" ",e.bMT(53,30,"shared.profile.unexcused-absences")," "),e.R7$(2),e.Y8G("ngIf",null!==s.absenceCounts.unexcusedAbsences),e.R7$(7),e.Y8G("opened",!h.collapsed),e.R7$(),e.SpI(" ",e.bMT(63,32,"shared.profile.incidents")," "),e.R7$(2),e.Y8G("ngIf",null!==s.absenceCounts.incidents)}}const Sn=[{path:"",component:(()=>{class t{constructor(){}static#e=this.\u0275fac=function(s){return new(s||t)};static#n=this.\u0275cmp=e.VBU({type:t,selectors:[["bkd-my-absences"]],standalone:!0,features:[e.Jv_([H,W.s]),e.aNF],decls:1,vars:0,template:function(s,i){1&s&&e.nrm(0,"router-outlet")},dependencies:[L.n3],changeDetection:0})}return t})(),children:[{path:"",component:(()=>{class t{constructor(n,s,i){this.reportsService=n,this.myAbsencesService=s,this.absencesSelectionService=i,this.openAbsencesReports$=this.loadOpenAbsencesReports(),this.allAbsencesReports$=this.loadAllAbsencesReports()}loadOpenAbsencesReports(){return(0,b.z)([this.absencesSelectionService.selectedWithoutPresenceType$,this.absencesSelectionService.selectedIds$]).pipe((0,k.n)(([n,s])=>0===n.length&&s.length>0?this.getOpenAbsencesRecordIds((0,m.A)((0,u.A)(s.map(i=>i.lessonIds)))):(0,y.of)([])),(0,k.n)(n=>this.reportsService.getStudentConfirmationReports(n)),(0,F.t)(1))}loadAllAbsencesReports(){return(0,b.z)([this.myAbsencesService.openLessonAbsences$,this.myAbsencesService.checkableLessonAbsences$,this.myAbsencesService.excusedLessonAbsences$,this.myAbsencesService.unexcusedLessonAbsences$,this.myAbsencesService.incidentsLessonAbsences$]).pipe((0,p.T)(n=>this.getAllAbsencesRecordIds((0,u.A)(n))),(0,k.n)(n=>this.reportsService.getMyAbsencesReports(n)),(0,F.t)(1))}getAllAbsencesRecordIds(n){return n.map(s=>`${s.LessonRef.Id}_${s.RegistrationId}`)}getOpenAbsencesRecordIds(n){return this.myAbsencesService.openLessonAbsences$.pipe((0,p.T)(s=>s.filter(i=>n.includes(i.LessonRef.Id)).map(i=>`${i.LessonRef.Id}_${i.RegistrationId}`)))}static#e=this.\u0275fac=function(s){return new(s||t)(e.rXU(un.P),e.rXU(H),e.rXU(W.s))};static#n=this.\u0275cmp=e.VBU({type:t,selectors:[["bkd-my-absences-show"]],standalone:!0,features:[e.aNF],decls:2,vars:5,consts:[["checkableAbsences","ngbAccordionItem"],["openAbsences","ngbAccordionItem"],["excusedAbsences","ngbAccordionItem"],["unexcusedAbsences","ngbAccordionItem"],["incidents","ngbAccordionItem"],["class","bkd-container bkd-container-limited",4,"bkdLet"],[1,"bkd-container","bkd-container-limited"],[1,"d-flex","justify-content-between","border-bottom","header"],[1,"ps-3"],[3,"reports"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[3,"click","opened"],[4,"ngIf"],[3,"absences$"],[3,"absences$","selectionService","defaultAbsenceSelectionMessage","reports"],[3,"absences$","displayPresenceType"]],template:function(s,i){1&s&&(e.DNE(0,Mn,68,35,"div",5),e.nI1(1,"async")),2&s&&e.Y8G("bkdLet",e.eq3(3,fn,e.bMT(1,1,i.myAbsencesService.counts$)))},dependencies:[A.N,an.Z,E.r6,E.tW,E.x7,bn,E.$R,E.UA,ln.$,l.bT,dn.A,l.Jj,f.h,f.D9],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem}"],changeDetection:0})}return t})()},{path:"confirm",component:ge},{path:"report",component:cn,children:[{path:"",component:on,data:{restoreScrollPositionFrom:["/my-absences/report/confirm"]}},{path:"confirm",component:Fe}]}]}]},6611:(O,S,o)=>{o.d(S,{a:()=>I});var l=o(5783),d=o(5306);const f=l.NW({Id:l.ai}),m=l.OH({HRef:(0,d.c$)(l.Yj)}),u=l.OH({From:d.iC,To:d.iC,EventNumber:l.Yj,EventDesignation:l.Yj,Designation:(0,d.c$)(l.Yj)}),p=l.E$([f,m,u]),I=l.NW({Id:l.Yj,LessonRef:p,StudentRef:d.Or,TypeRef:d.Or,Type:(0,d.c$)(l.Yj),ConfirmationState:(0,d.c$)(l.Yj),ConfirmationStateId:l.ai,Comment:(0,d.c$)(l.Yj),StudentFullName:l.Yj,RegistrationId:l.ai,HRef:l.Yj})},8676:(O,S,o)=>{o.d(S,{c:()=>f});var l=o(4438),d=o(3422);let f=(()=>{class m{constructor(p){this.i18n=p}transform(p,I){return"fr-CH"===this.i18n.detectLanguage()?(Array.from(I).map(_=>p=p.replace(_," ".concat(_))),p):p}static#e=this.\u0275fac=function(I){return new(I||m)(l.rXU(d.W,16))};static#n=this.\u0275pipe=l.EJ8({name:"addSpace",type:m,pure:!0,standalone:!0})}return m})()},2949:(O,S,o)=>{o.d(S,{y:()=>k});var l=o(1626),d=o(5558),f=o(2809),m=o(5783),u=o(5306);const p=m.NW({Id:m.ai,JobTrainer:(0,u.c$)(m.ai),ApprenticeshipManagerId:m.ai,ContractDateFrom:(0,u.c$)(u.iC),ContractDateTo:(0,u.c$)(u.iC)}),I=m.NW({Id:m.ai,RepresentativeId:m.ai,RepresentativeAfterMajority:m.zM});var A=o(6611);const _=m.NW({Id:m.Yj,LessonRef:u.Or,StudentRef:u.Or,TypeRef:u.Or,Type:(0,u.c$)(m.Yj),Comment:(0,u.c$)(m.Yj),StudentFullName:m.Yj,HRef:m.Yj}),v=m.NW({LessonRef:u.Or,StudentRef:u.Or,TypeRef:u.Or,Comment:(0,u.c$)(m.Yj),StudentFullName:m.Yj,Type:(0,u.c$)(m.Yj),RegistrationId:m.ai,HRef:m.Yj});var b=o(9573);const y=m.NW({Id:m.ai,From:u.iC,To:u.iC,EventId:m.ai,EventNumber:m.Yj,EventDesignation:m.Yj,EventLocation:(0,u.c$)(m.Yj),EventManagerInformation:m.Yj});var $=o(785),g=o(3220),R=o(4438);let k=(()=>{class D extends g.X{constructor(T,e){super(T,e,b.o,"Students","FullName")}getLegalRepresentatives(T,e){return this.http.get(`${this.baseUrl}/${T}/LegalRepresentatives`,{params:e}).pipe((0,d.n)((0,$.k$)(I)))}getCurrentApprenticeshipContracts(T,e){return this.http.get(`${this.baseUrl}/${T}/ApprenticeshipContracts/Current`,e).pipe((0,d.n)((0,$.k$)(p)))}getLessonAbsences(T,e){return this.http.get(`${this.baseUrl}/${T}/LessonAbsences`,{params:e}).pipe((0,d.n)((0,$.k$)(A.a)))}getLessonIncidents(T,e){return this.http.get(`${this.baseUrl}/${T}/LessonIncidents`,{params:e}).pipe((0,d.n)((0,$.k$)(v)))}getLessonDispensations(T,e){return this.http.get(`${this.baseUrl}/${T}/LessonDispensations`,{params:e}).pipe((0,d.n)((0,$.k$)(_)))}getTimetableEntries(T,e={}){return e instanceof l.Nl||(e=new l.Nl({fromObject:e})),e=e.set("fields","Id,From,To,EventId,EventNumber,EventDesignation,EventLocation,EventManagerInformation"),this.http.get(`${this.baseUrl}/${T}/TimetableEntries/CurrentSemester`,{params:e}).pipe((0,d.n)((0,$.k$)(y)))}static#e=this.\u0275fac=function(e){return new(e||D)(R.KVO(l.Qq),R.KVO(f.yy))};static#n=this.\u0275prov=R.jDH({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})()},3220:(O,S,o)=>{o.d(S,{X:()=>A});var l=o(5783),d=o(5558),f=o(6354),m=o(785),u=o(5437),p=o(6952);class A extends p.G{constructor(v,b,y,$,g,R="Id"){super(v,b,y,$),this.labelAttr=g,this.keyAttr=R,this.typeaheadCodec=l.NW((0,u.U)(this.codec.props,[this.keyAttr,this.labelAttr]))}getTypeaheadItems(v,b){const y={params:{fields:[this.keyAttr,this.labelAttr].join(","),[`filter.${this.labelAttr}`]:`~*${v}*`}};return this.http.get(`${this.baseUrl}/`,b?this.mergeHttpParams(y,b):y).pipe((0,d.n)((0,m.k$)(this.typeaheadCodec)),(0,f.T)($=>$.map(g=>({Key:g[this.keyAttr],Value:g[this.labelAttr]}))))}getTypeaheadItemByKey(v){return this.http.get(`${this.baseUrl}/${v}`,{params:{fields:[this.keyAttr,this.labelAttr].join(",")}}).pipe((0,d.n)((0,m.D4)(this.typeaheadCodec)),(0,f.T)(b=>({Key:b[this.keyAttr],Value:b[this.labelAttr]})))}mergeHttpParams(v,b){const y={params:{...v.params,...b.params}};return b.params.fields&&(y.params.fields=v.params.fields.concat(",",b.params.fields)),y}}},152:(O,S,o)=>{o.d(S,{B:()=>m});var l=o(3236),d=o(9974),f=o(4360);function m(u,p=l.E){return(0,d.N)((I,A)=>{let _=null,v=null,b=null;const y=()=>{if(_){_.unsubscribe(),_=null;const g=v;v=null,A.next(g)}};function $(){const g=b+u,R=p.now();if(R<g)return _=this.schedule(void 0,g-R),void A.add(_);y()}I.subscribe((0,f._)(A,g=>{v=g,b=p.now(),_||(_=p.schedule($,u),A.add(_))},()=>{y(),A.complete()},void 0,()=>{v=_=null}))})}}}]);