import{b as ne}from"./chunk-NTSKCSYH.js";import{a as Ze}from"./chunk-DYBK5FKC.js";import{a as Ye}from"./chunk-24TK3FB4.js";import"./chunk-7VKKHU7R.js";import{p as We}from"./chunk-LLGOVPQJ.js";import"./chunk-2H6IFZM2.js";import{e as te}from"./chunk-QOR23F4L.js";import{b as Ge}from"./chunk-7FRZV7VF.js";import"./chunk-Y4QYVF5K.js";import"./chunk-OFB4XAK2.js";import{b as Ve,d as U,e as Ke}from"./chunk-VUPOI3TG.js";import"./chunk-WACRWBCS.js";import"./chunk-MIRGHONI.js";import"./chunk-YUHFF3NM.js";import{L as He,b as Ne,g as pe,p as ze,q as Ue}from"./chunk-H6G6Q6V6.js";import"./chunk-NL5E3FC5.js";import{b as qe}from"./chunk-YD3RJIHU.js";import{a as ee,b as ie}from"./chunk-KK2SHN2W.js";import{u as Fe}from"./chunk-AP373D4K.js";import"./chunk-B6WYZ7BT.js";import{$a as se,Ab as x,Bb as F,Cc as Re,Cd as Le,Dc as Oe,Dd as we,Gb as o,Gd as Be,Ha as p,Hb as r,Ib as O,Ic as X,Jd as E,Kb as Me,Kd as A,La as re,Ld as je,M as y,Ma as _,Na as ge,O as fe,P as M,Ra as m,Ua as ve,Va as ye,Wa as d,X as N,Xa as c,Ya as g,Yb as $e,Yc as k,Zb as w,_ as T,_b as J,a as q,aa as S,ab as Se,b as K,cb as z,cc as le,d as he,da as _e,db as f,eb as xe,fb as Te,g as be,gc as Q,h as ue,ia as Y,ja as Z,ka as Ce,l as L,lc as Ie,mb as ce,n as u,nb as l,o as W,ob as P,pb as D,qb as de,rb as De,sc as ke,tc as Ee,uc as Ae,va as B,wa as a,wb as j,xa as C,xb as V,yb as G,zb as Pe}from"./chunk-IFJN5CDK.js";var ut=["*"];function ft(e,s){e&1&&se(0)}function _t(e,s){if(e&1&&(d(0,"a",1),p(1,ft,1,0,"ng-container",3),c()),e&2){let t=f(),i=ce(3);_("routerLink",t.link)("queryParams",t.linkParams),a(),_("ngTemplateOutlet",i)}}function Ct(e,s){e&1&&se(0)}function gt(e,s){if(e&1&&(d(0,"a",2),p(1,Ct,1,0,"ng-container",3),c()),e&2){let t=f(),i=ce(3);_("href",t.externalLink,B),a(),_("ngTemplateOutlet",i)}}function vt(e,s){if(e&1&&(d(0,"span",5),l(1),c()),e&2){let t=f(2);a(),P(t.count)}}function yt(e,s){e&1&&(Ce(),d(0,"svg",6),g(1,"path",7),c())}function St(e,s){if(e&1&&(d(0,"span",4),l(1),o(2,"translate"),c(),d(3,"div"),Te(4),p(5,vt,2,1,"span",5)(6,yt,2,0,":svg:svg",6),c()),e&2){let t=f();a(),P(r(2,2,t.label)),a(4),m(t.hasCount(t.count)?5:6)}}var Je=(()=>{class e{constructor(){}hasCount(t){return typeof t=="number"&&t>=0}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-dashboard-action"]],inputs:{label:"label",count:"count",link:"link",linkParams:"linkParams",externalLink:"externalLink"},standalone:!0,features:[x],ngContentSelectors:ut,decls:4,vars:2,consts:[["actionContent",""],[3,"routerLink","queryParams"],[3,"href"],[4,"ngTemplateOutlet"],[1,"label"],[1,"count"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none"],["fill","currentColor","d","m12 20-1.425-1.4 5.6-5.6H4v-2h12.175l-5.6-5.6L12 4l8 8-8 8Z"]],template:function(i,n){i&1&&(xe(),p(0,_t,2,3,"a",1)(1,gt,2,2,"a",2)(2,St,7,4,"ng-template",null,0,Me)),i&2&&(m(n.externalLink?-1:0),a(),m(n.externalLink?1:-1))},dependencies:[Ae,$e,A,E],styles:["a[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:space-between;align-items:center;padding:1rem 1.5rem;background:#f7e9d2;text-decoration:none;line-height:1}a[_ngcontent-%COMP%]:hover{background:#f2e0c3}a[_ngcontent-%COMP%]:focus-visible{outline-width:2px;outline-offset:-2px}div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:1rem}.label[_ngcontent-%COMP%]{font-weight:400}.count[_ngcontent-%COMP%]{font-size:1.5rem}"]})}}return e})();var Qe=(()=>{class e{constructor(){}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-dashboard-deadline"]],inputs:{count:"count"},standalone:!0,features:[x],decls:3,vars:8,template:function(i,n){i&1&&(l(0),o(1,"translate"),o(2,"addSpace")),i&2&&De("",r(1,3,"dashboard.actions.deadline"),"",O(2,5,": ",":"),"",n.count,`
`)},dependencies:[A,E,Ke],styles:["[_nghost-%COMP%]{background:#ea161f;color:#fff;white-space:nowrap;font-weight:500;font-size:.875rem;min-height:1.5rem;display:flex;padding:.375rem .5rem;align-items:center;border-radius:2.5rem}"]})}}return e})();var Xe=X({Id:Oe,Holder:Re});var et=(()=>{class e extends ee{constructor(t,i){super(t,i,Xe,"TeacherSubstitutions")}getTeacherSubstitution(t){return this.getList({params:{"filter.Id":`=${t}`}}).pipe(u(i=>i[0]||null))}static{this.\u0275fac=function(i){return new(i||e)(T(Q),T(k))}}static{this.\u0275prov=N({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var $t=["LessonTeacherRole","ClassTeacherRole","TeacherRole","AbsenceAdministratorRole"],It=["LessonTeacherRole","TeacherRole","StudentRole","SubstituteAdministratorRole"],kt=["LessonTeacherRole","StudentRole"],R=(()=>{class e{constructor(t,i,n,h,b,$,H,bt){this.settingsService=t,this.lessonPresencesService=i,this.studentsService=n,this.courseService=h,this.teacherSubstitutionService=b,this.personService=$,this.storageService=H,this.settings=bt,this.rolesAndPermissions$=this.settingsService.getRolesAndPermissions(),this.userId$=new ue(1),this.lessonAbsences$=this.userId$.pipe(M(v=>this.studentsService.getLessonAbsences(v)),y(1)),this.lessonIncidents$=this.userId$.pipe(M(v=>this.studentsService.getLessonIncidents(v)),y(1)),this.loading$=this.rolesAndPermissions$.pipe(u(v=>v==null)),this.hasSearch$=this.rolesAndPermissions$.pipe(u(this.hasRoles($t))),this.hasActions$=this.rolesAndPermissions$.pipe(u(this.hasRoles(It))),this.hasTimetable$=this.rolesAndPermissions$.pipe(u(this.hasRoles(kt))),this.hasLessonTeacherRole$=this.rolesAndPermissions$.pipe(u(this.hasRoles(["LessonTeacherRole"])),y(1)),this.hasTeacherRole$=this.rolesAndPermissions$.pipe(u(this.hasRoles(["TeacherRole"])),y(1)),this.hasStudentRole$=this.rolesAndPermissions$.pipe(u(this.hasRoles(["StudentRole"])),y(1)),this.hasSubstituteAdministratorRole$=this.rolesAndPermissions$.pipe(u(this.hasRoles(["SubstituteAdministratorRole"])),y(1)),this.editAbsencesCount$=this.hasLessonTeacherRole$.pipe(M(v=>v?this.lessonPresencesService.checkableAbsencesCount():L(!1)),y(1)),this.openAbsencesCount$=this.rolesAndPermissions$.pipe(u(this.hasRoles(["LessonTeacherRole","ClassTeacherRole"])),M(v=>v?this.lessonPresencesService.getListOfUnconfirmed():L([])),u(v=>v.length),y(1)),this.myAbsencesCount$=this.hasStudentRole$.pipe(M(v=>v?this.getMyAbsences():L([])),u(this.getMyAbsencesCount.bind(this)),y(1)),this.coursesToRateCount$=this.courseService.getNumberOfCoursesForRating().pipe(fe(0),y(1)),this.hasPresenceControl$=this.hasLessonTeacherRole$.pipe(M(v=>v?this.lessonPresencesService.hasLessonsLessonTeacher():L(!1)),y(1)),this.hasOpenAbsences$=this.openAbsencesCount$.pipe(u(v=>v>0),y(1)),this.editAbsencesParams$=this.getFullName().pipe(u(v=>({confirmationStates:this.settings.checkableAbsenceStateId,teacher:v})),y(1));let me=this.storageService.getPayload()?.id_person;me&&this.userId$.next(Number(me))}hasRoles(t){return i=>(i??[]).some(n=>t.includes(n))}getMyAbsences(){return W([this.userId$,this.lessonAbsences$,this.lessonIncidents$]).pipe(M(([t,i,n])=>this.loadTimetableEntries(t,i,n).pipe(u(h=>[...i,...n].map(b=>this.withTimetableEntry(b,h)).filter(Fe)))))}getMyAbsencesCount(t){return t?.filter(i=>("ConfirmationStateId"in i?i.ConfirmationStateId:null)===this.settings.unconfirmedAbsenceStateId).length||0}getFullName(){let t=Number(this.storageService.getPayload()?.substitution_id)||null;return t?this.teacherSubstitutionService.getTeacherSubstitution(t).pipe(u(i=>i?.Holder)):this.personService.getMyself().pipe(u(i=>i.FullName))}withTimetableEntry(t,i){return i.find(n=>n.Id===t.LessonRef.Id)?t:null}loadTimetableEntries(t,i,n){return this.studentsService.getTimetableEntries(t,{"filter.Id":`;${[...i,...n].map(h=>h.LessonRef.Id).join(";")}`})}static{this.\u0275fac=function(i){return new(i||e)(T(ne),T(te),T(U),T(We),T(et),T(Ge),T(je),T(k))}}static{this.\u0275prov=N({token:e,factory:e.\u0275fac})}}return e})();var Et=()=>["/presence-control"],At=()=>["/edit-absences"],Rt=()=>["/open-absences"],Ot=()=>["/events"],Lt=()=>["/my-absences","report"],wt=()=>["/my-absences"];function Bt(e,s){e&1&&g(0,"bkd-dashboard-action",0),e&2&&_("label","dashboard.actions.presence-control")("link",F(2,Et))}function jt(e,s){if(e&1&&(g(0,"bkd-dashboard-action",1),o(1,"async"),o(2,"async")),e&2){let t=f();_("label","dashboard.actions.edit-absences")("link",F(8,At))("linkParams",r(1,4,t.dashboardService.editAbsencesParams$))("count",r(2,6,t.dashboardService.editAbsencesCount$))}}function Ft(e,s){if(e&1&&(g(0,"bkd-dashboard-action",2),o(1,"async")),e&2){let t=f();_("label","dashboard.actions.open-absences")("link",F(5,Rt))("count",r(1,3,t.dashboardService.openAbsencesCount$))}}function Nt(e,s){if(e&1&&(g(0,"bkd-dashboard-deadline",4),o(1,"async")),e&2){let t=f(2);_("count",r(1,1,t.dashboardService.coursesToRateCount$))}}function zt(e,s){if(e&1&&(d(0,"bkd-dashboard-action",0),p(1,Nt,2,3,"bkd-dashboard-deadline",4),o(2,"async"),c()),e&2){let t,i=f();_("label","dashboard.actions.tests")("link",F(5,Ot)),a(),m((t=r(2,3,i.dashboardService.coursesToRateCount$))!==null&&t!==void 0&&t?1:-1)}}function Ut(e,s){e&1&&g(0,"bkd-dashboard-action",0),e&2&&_("label","dashboard.actions.my-absences-report")("link",F(2,Lt))}function Ht(e,s){if(e&1&&(g(0,"bkd-dashboard-action",2),o(1,"async")),e&2){let t=f();_("label","dashboard.actions.my-absences")("link",F(5,wt))("count",r(1,3,t.dashboardService.myAbsencesCount$))}}function Vt(e,s){if(e&1&&g(0,"bkd-dashboard-action",3),e&2){let t=f();_("label","dashboard.actions.substitutions")("externalLink",t.substitutionsAdminLink)}}var it=(()=>{class e{constructor(t,i){this.dashboardService=t,this.settings=i}get substitutionsAdminLink(){return this.settings.dashboard.substitutionsAdminLink}static{this.\u0275fac=function(i){return new(i||e)(C(R),C(k))}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-dashboard-actions"]],standalone:!0,features:[x],decls:15,vars:23,consts:[[3,"label","link"],[3,"label","link","linkParams","count"],[3,"label","link","count"],[3,"label","externalLink"],[3,"count"]],template:function(i,n){i&1&&(p(0,Bt,1,3,"bkd-dashboard-action",0),o(1,"async"),p(2,jt,3,9,"bkd-dashboard-action",1),o(3,"async"),o(4,"async"),p(5,Ft,2,6,"bkd-dashboard-action",2),o(6,"async"),p(7,zt,3,6,"bkd-dashboard-action",0),o(8,"async"),p(9,Ut,1,3,"bkd-dashboard-action",0),o(10,"async"),p(11,Ht,2,6,"bkd-dashboard-action",2),o(12,"async"),p(13,Vt,1,2,"bkd-dashboard-action",3),o(14,"async")),i&2&&(m(r(1,7,n.dashboardService.hasPresenceControl$)?0:-1),a(2),m(r(3,9,n.dashboardService.hasLessonTeacherRole$)&&r(4,11,n.dashboardService.editAbsencesParams$)?2:-1),a(3),m(r(6,13,n.dashboardService.hasOpenAbsences$)?5:-1),a(2),m(r(8,15,n.dashboardService.hasTeacherRole$)?7:-1),a(2),m(r(10,17,n.dashboardService.hasStudentRole$)?9:-1),a(2),m(r(12,19,n.dashboardService.hasStudentRole$)?11:-1),a(2),m(r(14,21,n.dashboardService.hasSubstituteAdministratorRole$)?13:-1))},dependencies:[Je,Qe,w],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:.5rem}"]})}}return e})();var nt=(()=>{class e{constructor(t,i){this.studentsRestService=t,this.router=i}navigateToDossier(t){return he(this,null,function*(){let i=Number(t);yield this.router.navigate(["dashboard","student",i,"addresses"])})}static{this.\u0275fac=function(i){return new(i||e)(C(U),C(Ee))}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-dashboard-search"]],standalone:!0,features:[x],decls:1,vars:2,consts:[[3,"valueChange","typeaheadService","placeholder"]],template:function(i,n){i&1&&(d(0,"bkd-typeahead",0),z("valueChange",function(b){return b&&n.navigateToDossier(b)}),c()),i&2&&_("typeaheadService",n.studentsRestService)("placeholder","dashboard.search.placeholder")},dependencies:[Ze],styles:["[_nghost-%COMP%]{display:block;padding:.75rem;background:#f7e9d2}"]})}}return e})();var at=(()=>{class e{constructor(t){this.sanitizer=t}transform(t,i){switch(i){case"html":return this.sanitizer.bypassSecurityTrustHtml(t);case"style":return this.sanitizer.bypassSecurityTrustStyle(t);case"script":return this.sanitizer.bypassSecurityTrustScript(t);case"url":return this.sanitizer.bypassSecurityTrustUrl(t);case"resourceUrl":return this.sanitizer.bypassSecurityTrustResourceUrl(t);default:throw new Error(`Invalid safe type specified: ${i}`)}}static{this.\u0275fac=function(i){return new(i||e)(C(Ie,16))}}static{this.\u0275pipe=_e({name:"safe",type:e,pure:!0,standalone:!0})}}return e})();function ot(e){return{id:ct(e.EventId,e.Id),from:e.From,until:e.To,eventId:e.EventId,subject:e.EventDesignation,room:e.EventLocation||void 0,teacher:e.EventManagerInformation||void 0}}function rt(e){let s=e.reduce((t,i)=>{let n=ct(i.EventRef.Id,i.LessonRef.Id);return K(q({},t),{[n]:[...t[n]??[],i.StudyClassNumber]})},{});return Object.keys(s).reduce((t,i)=>K(q({},t),{[i]:Le([...s[i]].sort())}),{})}function st(e,s){return e.map(t=>K(q({},t),{studyClass:s[t.id]?.join(", ")}))}function ct(e,s){return`${e}-${s}`}var Gt=(e,s)=>s.id;function qt(e,s){e&1&&(d(0,"th"),l(1),o(2,"translate"),c()),e&2&&(a(),D(" ",r(2,1,"dashboard.timetable.table.teacher")," "))}function Kt(e,s){if(e&1&&(d(0,"a",3),l(1),d(2,"span",8),l(3),c()()),e&2){let t=f().$implicit,i=f(2);_("href",i.buildLink(t.eventId),B),a(),D(" ",t.subject,""),a(2),D(", ",t.studyClass,"")}}function Wt(e,s){if(e&1&&l(0),e&2){let t=f().$implicit;D(" ",t.subject," ")}}function Yt(e,s){if(e&1&&(d(0,"td",4),l(1),o(2,"translate"),c()),e&2){let t=f().$implicit;a(),de(" ",r(2,2,"dashboard.timetable.table.study-class"),": ",t.studyClass," ")}}function Zt(e,s){if(e&1&&(d(0,"td",5),l(1),c()),e&2){let t=f().$implicit;a(),D(" ",t.teacher," ")}}function Jt(e,s){e&1&&(d(0,"span",7),l(1),o(2,"translate"),c()),e&2&&(a(),P(r(2,1,"dashboard.timetable.table.room")))}function Qt(e,s){if(e&1&&(d(0,"tr")(1,"td",1),l(2),o(3,"date"),o(4,"date"),c(),d(5,"td",2),p(6,Kt,4,3,"a",3),o(7,"async"),p(8,Wt,1,1),c(),p(9,Yt,3,4,"td",4),o(10,"async"),p(11,Zt,2,1,"td",5),o(12,"async"),d(13,"td",6),p(14,Jt,3,3,"span",7),l(15),c()()),e&2){let t=s.$implicit,i=f(2);a(2),de(" ",O(3,7,t.from,"HH:mm"),"\u2013",O(4,10,t.until,"HH:mm")," "),a(4),m(r(7,13,i.isTeacher$)?6:8),a(3),m(r(10,15,i.isTeacher$)?9:-1),a(2),m(r(12,17,i.isStudent$)?11:-1),a(3),m(t.room?14:-1),a(),D(" ",t.room," ")}}function Xt(e,s){if(e&1&&(d(0,"table",0)(1,"thead")(2,"tr")(3,"th"),l(4),o(5,"translate"),c(),d(6,"th"),l(7),o(8,"translate"),c(),p(9,qt,3,3,"th"),o(10,"async"),d(11,"th"),l(12),o(13,"translate"),c()()(),d(14,"tbody"),ve(15,Qt,16,19,"tr",null,Gt),c()()),e&2){let t=f();a(4),P(r(5,4,"dashboard.timetable.table.time")),a(3),P(r(8,6,"dashboard.timetable.table.subject")),a(2),m(r(10,8,t.isStudent$)?9:-1),a(3),D(" ",r(13,10,"dashboard.timetable.table.room")," "),a(3),ye(t.entries)}}function ei(e,s){e&1&&(d(0,"p"),l(1),o(2,"translate"),c()),e&2&&(a(),P(r(2,1,"dashboard.timetable.no-entries")))}var dt=(()=>{class e{constructor(t,i){this.dashboardService=t,this.settings=i,this.entries=[],this.isStudent$=this.dashboardService.hasStudentRole$,this.isTeacher$=this.dashboardService.hasLessonTeacherRole$}buildLink(t){return this.settings.eventlist.eventdetail.replace(":id",String(t))}static{this.\u0275fac=function(i){return new(i||e)(C(R),C(k))}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-dashboard-timetable-table"]],inputs:{entries:"entries"},standalone:!0,features:[x],decls:2,vars:1,consts:[[1,"table"],[1,"time"],[1,"subject"],["target","_parent",3,"href"],[1,"study-class"],[1,"teacher"],[1,"room"],[1,"room-label"],[1,"subject-study-class"]],template:function(i,n){i&1&&p(0,Xt,17,12,"table",0)(1,ei,3,3,"p"),i&2&&m(n.entries.length>0?0:1)},dependencies:[w,J,A,E],styles:['td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{padding:1rem 1.75rem}.room-label[_ngcontent-%COMP%], td.study-class[_ngcontent-%COMP%]{display:none}@media (max-width: 767.98px){table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{display:none}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]{border-top:1px solid var(--bs-border-color)}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-template-areas:"time room" "subject subject" "study-class study-class" "teacher teacher";gap:.5rem;padding:1rem;border-bottom:1px solid var(--bs-border-color)}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:0;padding:0}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.time[_ngcontent-%COMP%]{grid-area:time;font-size:.875rem;line-height:1.125rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.subject[_ngcontent-%COMP%]{grid-area:subject;font-size:1rem;line-height:1.25rem;font-weight:400}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.teacher[_ngcontent-%COMP%]{grid-area:teacher;font-size:.8125rem;line-height:1.0625rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.room[_ngcontent-%COMP%]{grid-area:room;text-align:right;font-size:.875rem;line-height:1.125rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.study-class[_ngcontent-%COMP%]{grid-area:study-class;font-size:.8125rem;line-height:1.0625rem;font-weight:300}td.study-class[_ngcontent-%COMP%]{display:block}.subject-study-class[_ngcontent-%COMP%]{display:none}.room-label[_ngcontent-%COMP%]{display:inline}}']})}}return e})();var ti=X({}),lt=(()=>{class e extends ee{constructor(t,i){super(t,i,ti,"Teachers")}getTimetableEntries(t,i={}){let n=i instanceof le?i:new le({fromObject:i});return n=n.set("fields","Id,From,To,EventId,EventNumber,EventDesignation,EventLocation"),this.http.get(`${this.baseUrl}/${t}/TimetableEntries/CurrentSemester`,{params:n}).pipe(M(Be(Ve)))}static{this.\u0275fac=function(i){return new(i||e)(T(Q),T(k))}}static{this.\u0275prov=N({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function ni(e,s){e&1&&(d(0,"a",6),o(1,"safe"),l(2),o(3,"translate"),c()),e&2&&(_("href",O(1,2,s,"url"),B),a(2),D(" ",r(3,5,"dashboard.timetable.subscribe-calendar")," "))}function ai(e,s){e&1&&g(0,"bkd-spinner")}function oi(e,s){e&1&&(d(0,"a",8),o(1,"safe"),l(2),o(3,"translate"),c()),e&2&&(_("href",O(1,2,s,"url"),B),a(2),D(" ",r(3,5,"dashboard.timetable.subscribe-calendar")," "))}function ri(e,s){if(e&1&&(g(0,"bkd-dashboard-timetable-table",7),p(1,oi,4,7,"a",8),o(2,"async")),e&2){let t,i=f(),n=G(18);_("entries",n),a(),m((t=r(2,2,i.getSubscribeCalendarUrl()))?1:-1,t)}}var si="cal",pt=(()=>{class e{constructor(t,i,n,h,b,$){this.teachersService=t,this.studentsService=i,this.lessonPresencesService=n,this.userSettings=h,this.dashboardService=b,this.loadingService=$,this.userId$=this.dashboardService.userId$,this.isTeacher$=this.dashboardService.hasLessonTeacherRole$,this.isStudent$=this.dashboardService.hasStudentRole$,this.date$=new be(pe(new Date)),this.loading$=this.loadingService.loading$,this.timetableEntries$=this.loadTimetableEntries()}gotoToday(){this.date$.next(pe(new Date))}gotoPreviousDay(){this.date$.next(Ue(this.date$.getValue(),1))}gotoNextDay(){this.date$.next(Ne(this.date$.getValue(),1))}getSubscribeCalendarUrl(){return this.userSettings.getSetting(si)}loadTimetableEntries(){return W([this.isTeacher$,this.isStudent$,this.userId$,this.date$]).pipe(M(([t,i,n,h])=>{let b=()=>t?this.fetchTimetableEntries("teacher",n,h):i?this.fetchTimetableEntries("student",n,h):L([]);return this.loadingService.load(b())}),y(1))}fetchTimetableEntries(t,i,n){let h={"filter.From":`=${ze(n,"yyyy-MM-dd")}`,sort:"From,To"};return(t==="teacher"?this.teachersService.getTimetableEntries(i,h):this.studentsService.getTimetableEntries(i,h)).pipe(u(b=>b.map(ot)),u(b=>we(b,$=>$.id)),M(b=>t==="teacher"?this.loadStudyClasses(n).pipe(u($=>st(b,$))):L(b)))}loadStudyClasses(t){return this.lessonPresencesService.getLessonStudyClassesByDate(t).pipe(u(rt))}static{this.\u0275fac=function(i){return new(i||e)(C(lt),C(U),C(te),C(ne),C(R),C(qe))}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-dashboard-timetable"]],standalone:!0,features:[x],decls:23,vars:24,consts:[[1,"header"],["type","button",1,"btn","btn-primary","today",3,"click"],["type","button",1,"btn","btn-secondary","previous-day",3,"click"],[1,"material-icons"],["type","button",1,"btn","btn-secondary","next-day",3,"click"],[1,"date"],["target","_parent",1,"btn","btn-secondary","subscribe-calendar-header",3,"href"],[3,"entries"],["target","_parent",1,"btn","btn-secondary","subscribe-calendar-bottom",3,"href"]],template:function(i,n){if(i&1){let h=Se();d(0,"div",0)(1,"button",1),z("click",function(){return Y(h),Z(n.gotoToday())}),l(2),o(3,"translate"),c(),d(4,"button",2),o(5,"translate"),z("click",function(){return Y(h),Z(n.gotoPreviousDay())}),d(6,"span",3),l(7,"chevron_left"),c()(),d(8,"button",4),o(9,"translate"),z("click",function(){return Y(h),Z(n.gotoNextDay())}),d(10,"span",3),l(11,"chevron_right"),c()(),d(12,"div",5),l(13),o(14,"async"),o(15,"date"),c(),p(16,ni,4,7,"a",6),o(17,"async"),c(),j(18),o(19,"async"),p(20,ai,1,0,"bkd-spinner"),o(21,"async"),p(22,ri,3,4)}if(i&2){let h;a(2),D(" ",r(3,6,"dashboard.timetable.today")," "),a(2),re("aria-label",r(5,8,"dashboard.timetable.previousDay")),a(4),re("aria-label",r(9,10,"dashboard.timetable.nextDay")),a(5),P(O(15,14,r(14,12,n.date$),"E, dd. MMMM yyyy")),a(3),m((h=r(17,17,n.getSubscribeCalendarUrl()))?16:-1,h),a(2),V(r(19,19,n.timetableEntries$)),a(2),m(r(21,22,n.loading$)?20:22)}},dependencies:[dt,ie,w,J,A,E,at],styles:["[_nghost-%COMP%]{display:block;margin-bottom:1rem}.header[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:2rem;display:flex;align-items:center;gap:1rem}.previous-day[_ngcontent-%COMP%], .next-day[_ngcontent-%COMP%]{padding-left:.375rem;padding-right:.375rem}.date[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600}.subscribe-calendar-header[_ngcontent-%COMP%]{margin-left:auto}.subscribe-calendar-bottom[_ngcontent-%COMP%]{display:none}a.btn[_ngcontent-%COMP%]{text-decoration:none}@media (max-width: 767.98px){.subscribe-calendar-header[_ngcontent-%COMP%]{display:none}.subscribe-calendar-bottom[_ngcontent-%COMP%]{display:block;margin-top:2rem}}@media (max-width: 767.98px) and (max-width: 575.98px){.header[_ngcontent-%COMP%]{flex-wrap:wrap-reverse}.header[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{width:100%}}"]})}}return e})();function ci(e,s){e&1&&g(0,"bkd-spinner")}function di(e,s){e&1&&(d(0,"p"),l(1),o(2,"translate"),c()),e&2&&(a(),D(" ",r(2,1,"dashboard.no-access")," "))}function li(e,s){e&1&&(d(0,"div")(1,"h2"),l(2),o(3,"translate"),c(),g(4,"bkd-dashboard-search"),c()),e&2&&(a(2),P(r(3,1,"dashboard.search.title")))}function pi(e,s){e&1&&(d(0,"div")(1,"h2"),l(2),o(3,"translate"),c(),g(4,"bkd-dashboard-actions"),c()),e&2&&(a(2),P(r(3,1,"dashboard.actions.title")))}function mi(e,s){if(e&1&&(d(0,"div",1),p(1,li,5,3,"div")(2,pi,5,3,"div"),c()),e&2){f();let t=G(2),i=G(4);a(),m(t?1:-1),a(),m(i?2:-1)}}function hi(e,s){e&1&&(d(0,"div",2)(1,"h2"),l(2),o(3,"translate"),c(),g(4,"bkd-dashboard-timetable"),c()),e&2&&(a(2),P(r(3,1,"dashboard.timetable.title")))}var mt=(()=>{class e{constructor(t){this.dashboardService=t}static{this.\u0275fac=function(i){return new(i||e)(C(R))}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-dashboard-layout"]],standalone:!0,features:[x],decls:17,vars:19,consts:[[1,"columns"],[1,"search-actions-column"],[1,"timetable-column"]],template:function(i,n){if(i&1&&(j(0),o(1,"async"),j(2),o(3,"async"),j(4),o(5,"async"),j(6),o(7,"async"),d(8,"div")(9,"h1"),l(10),o(11,"translate"),c(),p(12,ci,1,0,"bkd-spinner")(13,di,3,3,"p"),d(14,"div",0),p(15,mi,3,2,"div",1)(16,hi,5,3,"div",2),c()()),i&2){let h=r(1,7,n.dashboardService.loading$);a(2);let b=V(r(3,9,n.dashboardService.hasSearch$));a(2);let $=V(r(5,12,n.dashboardService.hasActions$)),H=r(7,15,n.dashboardService.hasTimetable$);a(5),ge("visually-hidden",h||b||$||H),a(),D(" ",r(11,17,"dashboard.heading")," "),a(2),m(h?12:-1),a(),m(!h&&!b&&!$&&!H?13:-1),a(2),m(b||$?15:-1),a(),m(H?16:-1)}},dependencies:[ie,nt,it,pt,w,A,E],styles:[".columns[_ngcontent-%COMP%]{display:flex;flex-direction:column}.columns[_ngcontent-%COMP%], .search-actions-column[_ngcontent-%COMP%]{gap:3rem}.search-actions-column[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;max-width:40rem}.timetable-column[_ngcontent-%COMP%]{flex:2}@media (min-width: 992px){.columns[_ngcontent-%COMP%]{flex-direction:row;gap:1.5rem}.search-actions-column[_ngcontent-%COMP%]{max-width:33%}}"],changeDetection:0})}}return e})();var ht=(()=>{class e{constructor(){}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-dashboard"]],standalone:!0,features:[Pe([R,He]),x],decls:1,vars:0,template:function(i,n){i&1&&g(0,"router-outlet")},dependencies:[ke],changeDetection:0})}}return e})();var $n=[{path:"",component:ht,children:[{path:"",component:mt},Ye]}];export{$n as DASHBOARD_ROUTES};
