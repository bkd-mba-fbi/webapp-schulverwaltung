import{a as De,b as Ne}from"./chunk-YU2OE6DK.js";import{a as Be}from"./chunk-VGYWDNUP.js";import{a as R}from"./chunk-I75JD2K7.js";import{c as ke,d as Pe,e as Ee}from"./chunk-GOVFDFD6.js";import{A as Oe,B as C,C as H,D as we,F as Le,G as Ie,H as Fe,a as he,f as _e,t as Se,u as xe,v as Ae}from"./chunk-BQGWWMPT.js";import"./chunk-C4EQUSNO.js";import"./chunk-WORSXEGE.js";import{e as Me}from"./chunk-6LRQCBUO.js";import"./chunk-Y4QYVF5K.js";import"./chunk-UOIIL2R2.js";import"./chunk-JE6RMKPQ.js";import"./chunk-RXV77OBQ.js";import"./chunk-M3VKTN3S.js";import"./chunk-USF5QQBL.js";import"./chunk-YHCR7GAG.js";import{d as $e}from"./chunk-KFP6476W.js";import{i as Te}from"./chunk-QWYAXZZX.js";import"./chunk-KKDVS2NL.js";import"./chunk-WNZFLLQC.js";import"./chunk-DVBPCEX4.js";import{e as ye,f as ve}from"./chunk-GH7I4V3C.js";import"./chunk-M732YBIP.js";import{r as me,s as ue,t as be,u as ge}from"./chunk-RYYQAFJB.js";import{$b as $,Ac as D,Bc as Y,Cc as F,E as Q,F as X,Fc as ae,Gc as T,Hb as j,Hc as B,Ib as ee,Ic as pe,Jb as U,Lb as te,Lc as a,Mb as K,Mc as l,Nb as W,Nc as w,O as y,Ob as h,Pb as c,Qb as r,Rb as v,X as L,_ as I,aa as V,bc as M,dc as f,fb as s,h as A,ha as Z,i as G,ie as fe,je as Ce,m as J,ma as p,nc as ne,pc as ie,qd as le,rc as m,sa as O,sc as S,t as d,ta as k,tc as E,td as N,u as _,ub as P,uc as se,ud as de,xc as re,yc as oe,zc as ce}from"./chunk-CHBP6U4G.js";var Re=["name","date"],Ye=["studentFullName","studyClassNumber"],x=(()=>{class n{constructor(){this.translate=p(fe),this.lessonPresencesService=p(Ee),this.selectionService=p(C),this.sortService=p(Fe),this.loadingService=p(Me),this.loading$=this.loadingService.loading$,this.search$=new G(""),this.updateUnconfirmedAbsences$=new A,this.unconfirmedAbsences$=Q(this.loadUnconfirmedAbsences(),this.updateUnconfirmedAbsences$).pipe(L(1)),this.entries$=this.unconfirmedAbsences$.pipe(d(Se),L(1)),this.sortCriteria=this.sortService.sortCriteria,this.sortedEntries$=_([this.entries$,this.sortService.sortCriteria$]).pipe(d(H(xe))),this.filteredEntries$=_([this.sortedEntries$,this.search$]).pipe(d(([e,t])=>De(e,Ye,t)),L(1)),this.currentDetail=null,this.sortService.sortCriteria.set({primarySortKey:"date",ascending:!1})}getUnconfirmedAbsences(e,t){return this.entries$.pipe(d(i=>{let o=i.find(b=>b.dateString===e&&b.studentId===t);return o?o.absences:[]}))}getAllUnconfirmedAbsencesForStudent(e){return this.entries$.pipe(d(t=>t.filter(i=>i.studentId===e).reduce((i,o)=>i.concat(o.absences),[])))}get confirmBackLink(){return this.currentDetail?["/open-absences/detail",this.currentDetail.personId,this.currentDetail.date]:["/open-absences"]}updateAfterConfirm(){_([this.unconfirmedAbsences$.pipe(y(1)),this.selectionService.selectedIds$.pipe(y(1))]).pipe(d(H(Ae))).subscribe(e=>{this.selectionService.clear(),this.updateUnconfirmedAbsences$.next(e)})}buildMailToString(e,t){let i=e.Email,o=this.translate.instant("open-absences.detail.mail.subject"),b=t.map(We=>Oe(We)).join("%0D%0A"),g=`${this.translate.instant("open-absences.detail.mail.body")}%0D%0A${b}`;return g.length>=1600&&(g=`${g.substring(0,1500)}%0D%0A${this.translate.instant("open-absences.detail.mail.bodyToLargeForEmailTo")}`),`${i}?subject=${o}&body=${g}`}loadUnconfirmedAbsences(){return this.loadingService.load(this.lessonPresencesService.getListOfUnconfirmed())}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=Z({token:n,factory:n.\u0275fac})}}return n})();var He=()=>["/open-absences"],Ve=(()=>{class n{constructor(){this.router=p(be),this.route=p(me),this.openAbsencesService=p(x),this.presenceTypesService=p(_e),this.personService=p($e),this.selectionService=p(C),this.scrollPosition=p(R),this.absences$=this.route.paramMap.pipe(I(this.getAbsencesForParams.bind(this))),this.hasAbsences$=this.absences$.pipe(d(ye(1))),this.studentFullName$=this.absences$.pipe(d(e=>e[0]&&e[0].StudentFullName||null)),this.allSelected$=_([this.absences$,this.selectionService.selection$]).pipe(d(([e,t])=>e.length===t.length)),this.studentEmail$=this.absences$.pipe(d(e=>e[0]&&e[0].StudentRef.Id||null),I(e=>e?this.personService.getByIdWithEmailInfos(e):J)),this.allUnconfirmedAbsencesForStudent$=this.route.paramMap.pipe(I(this.getAbsencesForStudentParam.bind(this))),this.mailTo$=_([this.studentEmail$,this.allUnconfirmedAbsencesForStudent$]).pipe(d(([e,t])=>this.openAbsencesService.buildMailToString(e,t))),this.destroy$=new A}ngOnInit(){this.selectionService.clearNonLessonPresences(),this.route.paramMap.pipe(V(this.destroy$)).subscribe(e=>this.openAbsencesService.currentDetail={date:String(e.get("date")),personId:Number(e.get("personId"))}),this.hasAbsences$.pipe(V(this.destroy$),X(he(ve))).subscribe(()=>{this.router.navigate(["/open-absences"])})}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}toggleAll(e){e?this.absences$.pipe(y(1)).subscribe(t=>this.selectionService.clear(t)):this.selectionService.clear()}onRowClick(e,t){e.target!==t&&t.click()}getPresenceTypeDesignation(e){return this.presenceTypesService.displayedTypes$.pipe(d(t=>e.TypeRef.Id&&t.find(i=>i.Id===e.TypeRef.Id)?.Designation||null))}getAbsencesForParams(e){return this.openAbsencesService.getUnconfirmedAbsences(String(e.get("date")),Number(e.get("personId")))}getAbsencesForStudentParam(e){return this.openAbsencesService.getAllUnconfirmedAbsencesForStudent(Number(e.get("personId")))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=P({type:n,selectors:[["bkd-open-absences-detail"]],decls:6,vars:10,consts:[[3,"link"],[3,"absences$","selectionService","confirmLink","displayEmail","mailTo$"]],template:function(t,i){t&1&&(c(0,"div"),v(1,"bkd-backlink",0),c(2,"h1"),m(3),a(4,"async"),r()(),v(5,"bkd-student-dossier-absences",1)),t&2&&(s(),h("link",T(9,He)),s(2),S(l(4,7,i.studentFullName$)),s(2),h("absences$",i.absences$)("selectionService",i.selectionService)("confirmLink","/open-absences/confirm")("displayEmail",!0)("mailTo$",i.mailTo$))},dependencies:[Ie,Le,N],styles:['.content[_ngcontent-%COMP%]{padding-left:1rem;padding-right:1rem}.back[_ngcontent-%COMP%]{color:#000;text-decoration:none}.back[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]:active   span[_ngcontent-%COMP%]{text-decoration:underline}.absence-entry[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox lesson-class time teacher" "checkbox presence-type date days-ago";grid-template-columns:min-content 2fr 1fr 2fr}.checkbox[_ngcontent-%COMP%]{grid-area:checkbox;margin:0;padding:.6rem .5rem 0 0}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.all[_ngcontent-%COMP%]{grid-area:all}.lesson-class[_ngcontent-%COMP%]{grid-area:lesson-class;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.time[_ngcontent-%COMP%]{grid-area:time}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.presence-type[_ngcontent-%COMP%]{color:#adb5bd;grid-area:presence-type}.date[_ngcontent-%COMP%]{grid-area:date}.days-ago[_ngcontent-%COMP%]{color:#adb5bd;grid-area:days-ago}.date-days-ago[_ngcontent-%COMP%]{grid-area:date-days-ago;display:none}@media(max-width:750px){.content[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.absence-entry[_ngcontent-%COMP%]{grid-template-areas:"checkbox lesson-class" "checkbox teacher" "checkbox date-days-ago" "checkbox time" "checkbox presence-type";grid-template-columns:min-content 1fr}.date-days-ago[_ngcontent-%COMP%]{display:block}.date[_ngcontent-%COMP%], .days-ago[_ngcontent-%COMP%]{display:none}}'],changeDetection:0})}}return n})();var je=()=>[],z=n=>({count:n}),qe=(n,u)=>["detail",n,u],ze=(n,u)=>u.id;function Ge(n,u){if(n&1&&(c(0,"div",2)(1,"div",5),m(2),a(3,"translate"),r(),c(4,"a",6)(5,"i",7),m(6,"edit"),r()()()),n&2){f();let e=F(0);s(2),E(" ",w(3,3,"open-absences.selected",B(6,z,e.length))," "),s(2),ie("disabled",e.length===0)}}function Je(n,u){n&1&&v(0,"bkd-spinner")}function Qe(n,u){n&1&&(c(0,"p",3),m(1),a(2,"translate"),r()),n&2&&(s(),S(l(2,1,"open-absences.noEntries")))}function Xe(n,u){if(n&1){let e=$();c(0,"bkd-sortable-header",12),a(1,"translate"),ce("sortCriteriaChange",function(i){O(e);let o=f(2);return oe(o.openAbsencesService.sortCriteria,i)||(o.openAbsencesService.sortCriteria=i),k(i)}),r()}if(n&2){let e=u.$implicit,t=f(2);h("ngClass",e)("label",l(1,4,"open-absences.list.header."+e))("sortKey",e),re("sortCriteria",t.openAbsencesService.sortCriteria)}}function Ze(n,u){if(n&1){let e=$();c(0,"div")(1,"div",13)(2,"div",14),M("click",function(i){O(e);let o=ne(4),b=f(2);return k(b.onCheckboxCellClick(i,o))}),c(3,"input",10,0),a(5,"async"),M("change",function(){let i=O(e).$implicit,o=f(2);return k(o.selectionService.toggle(i))}),r()(),c(6,"div",15)(7,"a",16),m(8),r()(),c(9,"div",17),m(10),r(),c(11,"div",18),m(12),a(13,"translate"),r(),c(14,"div",19),m(15),a(16,"translate"),r(),c(17,"div",20),m(18),a(19,"bkdDaysDifference"),r(),c(20,"div",21),m(21),a(22,"date"),r()()()}if(n&2){let e=u.$implicit,t=f(2);s(3),h("checked",l(5,9,t.selectionService.isSelected$(e))),s(4),h("routerLink",pe(22,qe,e.studentId,e.dateString)),s(),S(e.studentFullName),s(2),E(" ",e.studyClassNumber," "),s(2),E(" ",w(13,11,t.getLessonsCountKey(e),B(25,z,e.lessonsCount))," "),s(3),se(" ",e.studyClassNumber,", ",w(16,14,t.getLessonsCountKey(e),B(27,z,e.lessonsCount))," "),s(3),E(" ",l(19,17,e.date)," "),s(3),S(w(22,19,e.date,"dd.MM.yyyy"))}}function et(n,u){if(n&1){let e=$();c(0,"div",4)(1,"div",8)(2,"div",9)(3,"input",10),M("change",function(i){O(e);let o=f();return k(o.onToggleAll(i.currentTarget==null?null:i.currentTarget.checked))}),r()(),K(4,Xe,2,6,"bkd-sortable-header",11,te),r(),K(6,Ze,23,29,"div",null,ze),r()}if(n&2){let e=f(),t=F(0),i=F(2);s(3),h("checked",t.length===i.length),s(),W(e.sortKeys),s(2),W(i)}}var Ue=(()=>{class n{constructor(){this.openAbsencesService=p(x),this.selectionService=p(C),this.scrollPosition=p(R),this.sortKeys=Re,this.destroy$=new A}ngOnInit(){this.openAbsencesService.currentDetail=null,this.selectionService.clearNonOpenAbsencesEntries()}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}onToggleAll(e){this.openAbsencesService.filteredEntries$.pipe(y(1)).subscribe(t=>{this.selectionService.clear(e?t:null)})}onCheckboxCellClick(e,t){e.target!==t&&t.click()}getLessonsCountKey(e){return`open-absences.list.content.lessonsCount.${e.lessonsCount===1?"singular":"plural"}`}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=P({type:n,selectors:[["bkd-open-absences-list"]],decls:20,vars:26,consts:[["checkbox",""],[1,"d-flex","header-search",3,"valueChange","value","placeholder","label"],[1,"d-flex","align-items-center","justify-content-between","mt-1"],[1,"mt-3"],[1,"content"],[1,"selection-count","ps-1"],["routerLink","/open-absences/confirm",1,"edit","btn","btn-primary","btn-edit","mt-1","mb-2"],[1,"material-icons"],[1,"absence-header"],[1,"checkbox"],["type","checkbox",1,"form-check-input",3,"change","checked"],[3,"ngClass","label","sortKey","sortCriteria"],[3,"sortCriteriaChange","ngClass","label","sortKey","sortCriteria"],[1,"absence-entry"],[1,"checkbox",3,"click"],[1,"name","pe-2"],[3,"routerLink"],[1,"study-class"],[1,"lessons-count"],[1,"study-class-lessons-count"],[1,"days-ago"],[1,"date"]],template:function(t,i){if(t&1){let o=$();D(0),a(1,"async"),D(2),a(3,"async"),D(4),a(5,"async"),c(6,"h1"),m(7),a(8,"translate"),r(),c(9,"div")(10,"div")(11,"bkd-resettable-input",1),a(12,"async"),a(13,"translate"),a(14,"translate"),M("valueChange",function(g){return O(o),k(i.openAbsencesService.search$.next(g))}),r(),j(15,Ge,7,8,"div",2),r(),j(16,Je,1,0,"bkd-spinner"),a(17,"async"),ee(18,Qe,3,3,"p",3)(19,et,8,1,"div",4),r()}if(t&2){let o;Y(l(1,6,i.selectionService.selection$)??T(24,je)),s(2);let b=Y(l(3,9,i.openAbsencesService.filteredEntries$)??T(25,je)),g=(((o=l(5,12,i.openAbsencesService.sortedEntries$))==null?null:o.length)??0)===0||b.length===0;s(5),S(l(8,14,"open-absences.title")),s(4),h("value",l(12,16,i.openAbsencesService.search$))("placeholder",l(13,18,"open-absences.search-by-name-or-class"))("label",l(14,20,"open-absences.search")),s(4),U(g?-1:15),s(),U(l(17,22,i.openAbsencesService.loading$)?16:g?18:19)}},dependencies:[Ne,ge,Te,Be,le,N,de,Ce,we],styles:['.header-search[_ngcontent-%COMP%]{max-width:500px}.absence-header[_ngcontent-%COMP%]{cursor:pointer;padding:1rem;display:grid;grid-template-areas:"checkbox name date";grid-template-columns:min-content 5fr 1fr;border-top:1px solid #dee2e6;border-bottom:2px solid #dee2e6;align-items:center}.absence-entry[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox name study-class lessons-count days-ago date";grid-template-columns:min-content 2fr 1fr 1fr 1fr 1fr;align-items:center}.checkbox[_ngcontent-%COMP%]{align-self:start;grid-area:checkbox;margin:0;padding:.3rem 1rem 0 0}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.name[_ngcontent-%COMP%]{grid-area:name;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.lessons-count[_ngcontent-%COMP%]{grid-area:lessons-count}.study-class[_ngcontent-%COMP%]{grid-area:study-class}.study-class-lessons-count[_ngcontent-%COMP%]{grid-area:study-class-lessons-count;display:none}.days-ago[_ngcontent-%COMP%]{color:#6c757d;grid-area:days-ago}.date[_ngcontent-%COMP%]{grid-area:date}@media(max-width:750px){.content[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.absence-header[_ngcontent-%COMP%]{grid-template-areas:"checkbox name date";grid-template-columns:min-content 3fr 2fr}.absence-entry[_ngcontent-%COMP%]{grid-template-areas:"checkbox name date" "checkbox study-class-lessons-count days-ago";grid-template-columns:min-content 3fr 2fr}.study-class-lessons-count[_ngcontent-%COMP%]{display:block}.study-class[_ngcontent-%COMP%], .lessons-count[_ngcontent-%COMP%]{display:none}.days-ago[_ngcontent-%COMP%], .study-class-lessons-count[_ngcontent-%COMP%]{font-size:.875rem;color:#adb5bd}}'],changeDetection:0})}}return n})();var Ke=(()=>{class n{constructor(){}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=P({type:n,selectors:[["bkd-open-absences"]],features:[ae([x,C,{provide:ke,useExisting:x}])],decls:1,vars:0,template:function(t,i){t&1&&v(0,"router-outlet")},dependencies:[ue],encapsulation:2,changeDetection:0})}}return n})();var sn=[{path:"",component:Ke,children:[{path:"",component:Ue,data:{restoreScrollPositionFrom:["/open-absences/detail/:personId/:date","/open-absences/confirm"]}},{path:"detail/:personId/:date",component:Ve,data:{restoreScrollPositionFrom:["/open-absences/confirm"]}},{path:"confirm",component:Pe}]}];export{sn as OPEN_ABSENCES_ROUTES};
