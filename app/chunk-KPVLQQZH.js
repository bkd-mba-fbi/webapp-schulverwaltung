import{a as ht,b as gt,c as vt,d as yt,e as bt}from"./chunk-NFMYUCUJ.js";import"./chunk-RDNZARDR.js";import{a as Ge,b as Xe,c as Ze,d as Qe,e as qe,h as ft,i as _t}from"./chunk-XWISOVKN.js";import"./chunk-6A3MULQJ.js";import"./chunk-C4EQUSNO.js";import{a as _e}from"./chunk-WORSXEGE.js";import{f as ut}from"./chunk-6LRQCBUO.js";import{b as J,c as L}from"./chunk-RXV77OBQ.js";import{A as st,c as Ke,e as Je,f as et,g as tt,k as it,p as nt,q as ot,y as rt,z as at}from"./chunk-M3VKTN3S.js";import{a as dt}from"./chunk-USF5QQBL.js";import{a as xt}from"./chunk-53FRTF6U.js";import{a as lt,c as Ct}from"./chunk-RRZAXW2T.js";import"./chunk-D2H555EG.js";import{b as Ce}from"./chunk-KZWEGXU2.js";import{d as mt}from"./chunk-KFP6476W.js";import{i as ue}from"./chunk-QWYAXZZX.js";import"./chunk-KKDVS2NL.js";import"./chunk-WNZFLLQC.js";import"./chunk-DVBPCEX4.js";import{b as ct}from"./chunk-GH7I4V3C.js";import{a as pt}from"./chunk-M732YBIP.js";import{A as Ye,e as ye,i as je,s as He,t as Ue,u as We}from"./chunk-RYYQAFJB.js";import{$b as B,Ab as Q,Ac as H,Bc as U,Cc as w,E as Ee,F as Me,Fa as T,Fb as ke,Fc as pe,Gc as se,Ha as ae,Hb as y,J as Pe,Jb as _,Lb as ve,Lc as c,Mb as q,Mc as m,Nb as K,Nc as W,Ob as g,Pb as l,Qb as s,Rb as v,S as Ie,Sb as z,Sc as $,Tb as j,Tc as Oe,Wc as de,X,Xc as ze,Z as De,_ as I,a as O,bc as A,cc as Ae,d as ne,dc as u,fb as a,h as we,ha as Z,i as oe,ie as he,je as F,lc as Te,ma as C,mc as Be,nc as R,o as V,oc as Le,p as G,pc as le,rc as p,s as Se,sa as D,sc as E,t as re,ta as k,tc as f,td as ce,ub as P,uc as $e,ud as me,vc as Re,xc as Ve,yc as Fe,zc as Ne}from"./chunk-CHBP6U4G.js";var ee=(()=>{class i{constructor(){this.storageService=C(dt),this.profileService=C(ht),this.reloadStudent$=new oe(void 0),this.person$=this.reloadStudent$.pipe(I(()=>this.loadPerson()),X(1)),this.loadingPerson$=this.profileService.loadingMyself$,this.legalRepresentatives$=this.person$.pipe(I(e=>e&&this.isStudent()?this.profileService.getLegalRepresentatives(e):V(null)),X(1)),this.loadingLegalRepresentatives$=this.profileService.loadingLegalRepresentatives$,this.apprenticeships$=this.person$.pipe(I(e=>e&&this.isStudent()?this.profileService.getApprenticeships(e.Id):V(null)),X(1)),this.loadingApprenticeships$=this.profileService.loadingApprenticeships$,this.stayPermit$=this.person$.pipe(I(e=>e?this.profileService.getStayPermitValue(e.StayPermit):V(null))),this.loadingStayPermit$=this.profileService.loadingStayPermit$}reloadStudent(){this.reloadStudent$.next()}loadPerson(){return this.profileService.getMyself().pipe(Pe(e=>e.status===403?V(null):G(()=>e)))}isStudent(){return(this.storageService.getPayload()?.roles?.split(";")??[]).includes("StudentRole")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=Z({token:i,factory:i.\u0275fac})}}return i})();function Lt(i,n){if(i&1&&(l(0,"div"),p(1),s()),i&2){u(2);let e=w(1);a(),f(" ",e.AddressLine2," ")}}function $t(i,n){if(i&1&&(l(0,"div",5),p(1),c(2,"translate"),s()),i&2){let e=n.$implicit;a(),f(" ",W(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Rt(i,n){if(i&1&&(l(0,"div",13),p(1),c(2,"translate"),s()),i&2){let e=n.$implicit;a(),f(" ",W(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Vt(i,n){i&1&&(l(0,"div",18)(1,"span",19),p(2,"Loading..."),s()())}function Ft(i,n){if(i&1){let e=B();l(0,"form",2),A("ngSubmit",function(){D(e);let o=u();return k(o.onSubmit())}),l(1,"div",3)(2,"p"),p(3),c(4,"translate"),s(),l(5,"address",4)(6,"div"),p(7),s(),y(8,Lt,2,1,"div"),l(9,"div"),p(10),s()()(),q(11,$t,3,4,"div",5,ve),c(13,"async"),l(14,"div",3)(15,"label",6),p(16),c(17,"translate"),s(),v(18,"input",7),s(),l(19,"div",3)(20,"label",8),p(21),c(22,"translate"),s(),v(23,"input",9),l(24,"small",10),p(25),c(26,"translate"),s()(),l(27,"div",3)(28,"label",11),p(29),c(30,"translate"),s(),v(31,"input",12),c(32,"async"),q(33,Rt,3,4,"div",13,ve),c(35,"async"),l(36,"small",14),p(37),c(38,"translate"),s()(),l(39,"div",15)(40,"button",16),c(41,"async"),A("click",function(){D(e);let o=u();return k(o.cancel())}),p(42),c(43,"translate"),s(),l(44,"button",17),c(45,"async"),p(46),c(47,"translate"),y(48,Vt,3,0,"div",18),c(49,"async"),s()()()}if(i&2){let e,t=u(),o=w(0),r=w(1);g("formGroup",o),a(3),E(m(4,18,"my-profile.edit.address-changes-remark")),a(4),E(r.AddressLine1),a(),_(r.AddressLine2?8:-1),a(2),$e("",r.Zip||""," ",r.Location),a(),K(m(13,20,t.formErrors$)),a(5),f(" ",m(17,22,"my-profile.edit.fields.phone-private")," "),a(5),f(" ",m(22,24,"my-profile.edit.fields.phone-mobile")," "),a(4),E(m(26,26,"my-profile.edit.fields.phone-mobile-hint")),a(4),f(" ",m(30,28,"my-profile.edit.fields.email2")," "),a(2),le("is-invalid",(((e=m(32,30,t.email2Errors$))==null?null:e.length)??0)>0),a(2),K(m(35,32,t.email2Errors$)),a(4),E(m(38,34,"my-profile.edit.fields.email2-hint")),a(3),g("disabled",m(41,36,t.saving$)),a(2),f(" ",m(43,38,"my-profile.edit.cancel")," "),a(2),g("disabled",m(45,40,t.saving$)),a(2),f(" ",m(47,42,"my-profile.edit.save")," "),a(2),_(m(49,44,t.saving$)?48:-1)}}var wt=(()=>{class i{constructor(){this.fb=C(rt),this.router=C(Ue),this.toastService=C(pt),this.translate=C(he),this.profileService=C(ee),this.personsService=C(mt),this.person=L(this.profileService.person$,{initialValue:null}),this.formGroup=$(()=>this.createFormGroup(this.person())),this.formGroup$=J(this.formGroup).pipe(Me(ct)),this.saving$=new oe(!1),this.submitted$=new oe(!1),this.formErrors$=_e(this.formGroup$,this.submitted$),this.email2Errors$=_e(this.formGroup$,this.submitted$,"email2")}cancel(){this.navigateBack()}onSubmit(){this.submitted$.next(!0);let e=this.formGroup();if(e?.valid){let{phonePrivate:t,phoneMobile:o,email2:r}=e.value;this.save(t?.trim()||null,o?.trim()||null,r||null)}}createFormGroup(e){return e?this.fb.group({phonePrivate:[e.PhonePrivate],phoneMobile:[e.PhoneMobile],email2:[e.Email2,Je.email]}):null}save(e,t,o){let r=this.person();r&&(this.saving$.next(!0),this.personsService.update(r.Id,e,t,o).pipe(Ie(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this)))}onSaveSuccess(){this.profileService.reloadStudent(),this.toastService.success(this.translate.instant("my-profile.edit.save-success")),this.navigateBack()}navigateBack(){this.router.navigate(["/my-profile"])}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=P({type:i,selectors:[["bkd-my-profile-edit"]],decls:7,vars:6,consts:[[1,"bkd-container","bkd-container-limited"],[3,"formGroup"],[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"text-muted"],[1,"alert","alert-danger"],["id","my-profile-phone-private",1,"form-label"],["id","my-profile-phone-private","formControlName","phonePrivate","type","tel",1,"form-control"],["id","my-profile-phone-mobile",1,"form-label"],["id","my-profile-phone-mobile","formControlName","phoneMobile","type","tel","aria-describedby","my-profile-phone-mobile-hint",1,"form-control"],["id","my-profile-phone-mobile-hint",1,"form-text"],["for","my-profile-email2",1,"form-label"],["id","my-profile-email2","formControlName","email2","type","email","aria-describedby","my-profile-email2-hint",1,"form-control"],[1,"invalid-feedback"],["id","my-profile-email2-hint",1,"form-text"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"visually-hidden"]],template:function(t,o){if(t&1&&(H(0)(1),l(2,"div",0)(3,"h1"),p(4),c(5,"translate"),s(),y(6,Ft,50,46,"form",1),s()),t&2){let r=U(o.formGroup());a();let d=U(o.person());a(3),E(m(5,4,"my-profile.edit.title")),a(2),_(r&&d?6:-1)}},dependencies:[at,it,Ke,et,tt,st,ot,nt,ce,F],encapsulation:2,changeDetection:0})}}return i})();var St=(()=>{class i{constructor(){}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=P({type:i,selectors:[["bkd-my-profile-address"]],inputs:{address:"address"},decls:2,vars:1,template:function(t,o){t&1&&(z(0,"address"),p(1),j()),t&2&&(a(),E(o.address))},styles:["[_nghost-%COMP%]{padding:1rem}address[_ngcontent-%COMP%]{white-space:pre-wrap}"],changeDetection:0})}}return i})();var Et=(()=>{class i{constructor(){}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=P({type:i,selectors:[["bkd-my-profile-entry"]],inputs:{label:"label",value:"value"},decls:6,vars:4,consts:[[1,"row"],[1,"col-md-6"]],template:function(t,o){t&1&&(z(0,"dl",0)(1,"dt",1),p(2),c(3,"translate"),j(),z(4,"dd",1),p(5),j()()),t&2&&(a(2),E(m(3,2,o.label)),a(3),E(o.value))},dependencies:[F],styles:["dl[_ngcontent-%COMP%]{padding:0 1rem}dt[_ngcontent-%COMP%]{font-weight:400;color:#00000080}"],changeDetection:0})}}return i})();var Mt=(()=>{class i{constructor(){this.http=C(je),this.settings=C(Ye)}uploadPhoto(e,t){return this.preparePhotoUpload(e,t).pipe(I(o=>this.http.put(`${this.settings.apiUrl.replace("/restApi","")}${o}`,t,{headers:{"Content-Type":t.type},context:new ye().set(Ce,{disableErrorHandling:!0})})),re(()=>{}))}preparePhotoUpload(e,t){let o=t.name.replace(/\.jpe?g$/i,".jpg");if(!o.endsWith(".jpg"))return G(()=>new Error("Invalid file extension, must be a JPEG image"));let r={AdditionalInformation:{ObjectId:e,ObjectTypeId:3,Designation:"Photo"},FileStreamInfo:{Filename:o}};return this.http.post(`${this.baseUrl}/files`,r,{observe:"response",context:new ye().set(Ce,{disableErrorHandling:!0})}).pipe(re(d=>{if(d.status!==201)throw new Error("Failed to get photo upload path");let b=d.headers.get("Location");if(!b)throw new Error("Invalid photo upload path");return b}))}get baseUrl(){return`${this.settings.apiUrl}/AdditionalInformations`}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var te=class i{x;y;scale;constructor(n,e,t){this.x=n,this.y=e,this.scale=t}toString(){return`translate(${this.x}px, ${this.y}px) scale(${this.scale})`}static parse(n){let e=n.style.transform.split(") "),t=e[0].substring(10).split(","),o=e.length>1?e[1].substring(6):"1",r=t.length>1?t[0]:"0",d=t.length>1?t[1]:"0";return new i(parseFloat(r),parseFloat(d),parseFloat(o))}},ie=class{x;y;constructor(n){if(!n||!n.style.transformOrigin){this.x=0,this.y=0;return}let[e,t]=n.style.transformOrigin.split(" ");this.x=parseFloat(e),this.y=parseFloat(t)}toString(){return this.x+"px "+this.y+"px"}};function Nt(i,n){let e=0;return(...t)=>{clearTimeout(e),e=setTimeout(()=>i(...t),n)}}function Ot(i,n){let e=parseFloat(n.min),t=parseFloat(n.max);n.value=Math.max(e,Math.min(t,i)).toString()}function zt(i){let n=new Image;return new Promise(function(e,t){n.onload=()=>{e(n)},n.onerror=t,n.src=i})}function Pt(){return{boundary:document.createElement("div"),viewport:document.createElement("div"),preview:document.createElement("img"),overlay:document.createElement("div"),zoomerWrap:document.createElement("div"),zoomer:document.createElement("input")}}function jt(i){return i==="ArrowLeft"?[2,0]:i==="ArrowUp"?[0,2]:i==="ArrowRight"?[-2,0]:[0,-2]}function It(i,n,e){return Math.max(Math.min(i,n),e)}function Ht(){return document.createElement("canvas").toDataURL("image/webp").startsWith("data:image/webp")}var fe=class{element;elements;options={mouseWheelZoom:"on",viewport:{width:220,height:220,borderRadius:"0px"},zoomerInputClass:"cr-slider"};#o=null;#e=1;#i=null;#r=Nt(()=>{this.#p()},200);constructor(n,e){if(n.classList.contains("cropt-container"))throw new Error("Cropt is already initialized on this element");e.viewport&&(e.viewport=O(O({},this.options.viewport),e.viewport)),this.options=O(O({},this.options),e),this.element=n,this.element.classList.add("cropt-container"),this.elements=Pt(),this.elements.zoomerWrap.classList.add("cr-slider-wrap"),this.elements.boundary.classList.add("cr-boundary"),this.elements.viewport.classList.add("cr-viewport"),this.elements.overlay.classList.add("cr-overlay"),this.elements.viewport.setAttribute("tabindex","0"),this.#l(this.elements.preview),this.elements.boundary.appendChild(this.elements.preview),this.elements.boundary.appendChild(this.elements.viewport),this.elements.boundary.appendChild(this.elements.overlay),this.elements.zoomer.type="range",this.elements.zoomer.step="any",this.elements.zoomer.value="1",this.elements.zoomer.setAttribute("aria-label","zoom"),this.element.appendChild(this.elements.boundary),this.element.appendChild(this.elements.zoomerWrap),this.elements.zoomerWrap.appendChild(this.elements.zoomer),this.#a(),this.#v(),this.#y()}bind(n,e=null){if(!n)throw new Error("src cannot be empty");return this.#o=e,zt(n).then(t=>{this.#C(t),this.#d()})}#h(){let n=this.elements.preview.getBoundingClientRect(),e=this.elements.viewport.getBoundingClientRect(),t=this.elements.viewport.offsetWidth,o=this.elements.viewport.offsetHeight,r=(e.width-t)/2,d=(e.height-o)/2,b=e.left-n.left,M=e.top-n.top;return{left:this.#t(b),top:this.#t(M),right:this.#t(b+t+r),bottom:this.#t(M+o+d)}}#t(n){return Math.round(Math.max(0,n/this.#e))}toCanvas(n=null){let e=this.elements.viewport.getBoundingClientRect(),t=e.width/e.height,o=this.#h(),r=o.right-o.left,d=o.bottom-o.top;return n!==null&&(t>1?(r=n,d=n/t):(d=n,r=n*t)),Promise.resolve(this.#f(o,r,d))}toBlob(n=null,e="image/webp",t=1){return e==="image/webp"&&t<1&&!Ht()&&(e="image/jpeg"),new Promise((o,r)=>{this.toCanvas(n).then(d=>{d.toBlob(b=>{b===null?r("Canvas blob is null"):o(b)},e,t)})})}refresh(){this.#d()}setOptions(n){let e=this.options.viewport.width,t=this.options.viewport.height;n.viewport&&(n.viewport=O(O({},this.options.viewport),n.viewport)),this.options=structuredClone(O(O({},this.options),n)),this.#a(),(this.options.viewport.width!==e||this.options.viewport.height!==t)&&this.#m()}setZoom(n){Ot(n,this.elements.zoomer);let e=new Event("input");this.elements.zoomer.dispatchEvent(e)}destroy(){this.#i&&document.removeEventListener("keydown",this.#i),this.element.removeChild(this.elements.boundary),this.element.classList.remove("cropt-container"),this.element.removeChild(this.elements.zoomerWrap),this.elements=Pt()}#a(){this.elements.zoomer.className=this.options.zoomerInputClass;let n=this.elements.viewport;n.style.borderRadius=this.options.viewport.borderRadius,n.style.width=this.options.viewport.width+"px",n.style.height=this.options.viewport.height+"px"}#u(n){let e=n.right-n.left,t=n.bottom-n.top,o=document.createElement("canvas"),r=o.getContext("2d");if(r===null)throw new Error("Canvas context cannot be null");o.width=e,o.height=t;let d=this.elements.preview;return r.drawImage(d,n.left,n.top,e,t,0,0,o.width,o.height),o}#f(n,e,t){let o=this.#u(n),r=o.getContext("2d"),d=document.createElement("canvas"),b=d.getContext("2d"),M=document.createElement("canvas"),h=M.getContext("2d");if(M.width=e,M.height=t,h===null||r===null||b===null)throw new Error("Canvas context cannot be null");let x={width:o.width,height:o.height};for(;x.width*.5>M.width;){let S=x.width,Y=x.height;x={width:Math.floor(x.width*.5),height:Math.floor(x.height*.5)},d.width=S,d.height=Y,b.clearRect(0,0,d.width,d.height),b.drawImage(o,0,0),r.clearRect(0,0,S,Y),r.drawImage(d,0,0,S,Y,0,0,x.width,x.height)}return h.drawImage(o,0,0,x.width,x.height,0,0,M.width,M.height),M}#g(){let n=this.#e,e=this.elements.viewport.getBoundingClientRect(),t=this.elements.boundary.clientWidth/2,o=this.elements.boundary.clientHeight/2,r=this.elements.preview.getBoundingClientRect(),d=e.width/2,b=e.height/2,M=(d/n-t)*-1,h=(b/n-o)*-1,x=1/n*d,S=1/n*b;return{translate:{maxX:M,minX:M-(r.width*(1/n)-e.width*(1/n)),maxY:h,minY:h-(r.height*(1/n)-e.height*(1/n))},origin:{maxX:r.width*(1/n)-x,minX:x,maxY:r.height*(1/n)-S,minY:S}}}#s(n,e){let t=this.elements.preview.getBoundingClientRect(),o=this.elements.viewport.getBoundingClientRect(),r=te.parse(this.elements.preview);r.y+=It(o.top-t.top,e,o.bottom-t.bottom),r.x+=It(o.left-t.left,n,o.right-t.right),this.#c(r),this.#r()}#v(){let n=0,e=0,t=[],o=0,r=h=>{h.preventDefault();let x=t.findIndex(S=>S.pointerId===h.pointerId);if(x!==-1){if(t[x]=h,t.length===2){let S=t[0],Y=t[1],xe=Math.hypot(S.pageX-Y.pageX,S.pageY-Y.pageY);o===0&&(o=xe/this.#e),this.setZoom(xe/o);return}else if(o!==0)return;this.#s(h.pageX-n,h.pageY-e),n=h.pageX,e=h.pageY}},d=h=>{let x=t.findIndex(S=>S.pointerId===h.pointerId);x!==-1&&t.splice(x,1),t.length===0&&(this.elements.overlay.removeEventListener("pointermove",r),this.elements.overlay.removeEventListener("pointerup",d),this.elements.overlay.removeEventListener("pointerout",d),this.#n(!1,this.elements.preview),o=0)},b=h=>{h.button||(h.preventDefault(),t.push(h),this.elements.overlay.setPointerCapture(h.pointerId),!(t.length>1)&&(n=h.pageX,e=h.pageY,this.#n(!0,this.elements.preview),this.elements.overlay.addEventListener("pointermove",r),this.elements.overlay.addEventListener("pointerup",d),this.elements.overlay.addEventListener("pointerout",d)))},M=h=>{if(document.activeElement===this.elements.viewport){if(h.shiftKey&&(h.key==="ArrowUp"||h.key==="ArrowDown")){h.preventDefault();let x=parseFloat(this.elements.zoomer.value),S=h.key==="ArrowUp"?.01:-.01;this.setZoom(x+S)}else if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(h.key)){h.preventDefault();let[x,S]=jt(h.key);this.#s(x,S)}}};this.elements.overlay.addEventListener("pointerdown",b),document.addEventListener("keydown",M),this.#i=M}#y(){let n=()=>{this.#_()},e=t=>{let o=this.options.mouseWheelZoom,r=0;o==="off"||o==="ctrl"&&!t.ctrlKey||(t.deltaY&&(r=t.deltaY*-1/2e3),t.preventDefault(),this.setZoom(this.#e+r*this.#e))};this.elements.zoomer.addEventListener("input",n),this.elements.boundary.addEventListener("wheel",e)}#_(){let n=te.parse(this.elements.preview),e=new ie(this.elements.preview),t=()=>{this.elements.preview.style.transform=n.toString(),this.elements.preview.style.transformOrigin=e.toString()};this.#e=parseFloat(this.elements.zoomer.value),n.scale=this.#e,t();let o=this.#g(),r=o.translate,d=o.origin;n.x>=r.maxX&&(e.x=d.minX,n.x=r.maxX),n.x<=r.minX&&(e.x=d.maxX,n.x=r.minX),n.y>=r.maxY&&(e.y=d.minY,n.y=r.maxY),n.y<=r.minY&&(e.y=d.maxY,n.y=r.minY),t(),this.#r()}#C(n){this.#l(n),this.elements.preview.parentNode&&this.elements.preview.parentNode.replaceChild(n,this.elements.preview),this.elements.preview=n}#l(n){n.classList.add("cr-image"),n.setAttribute("alt","preview"),this.#n(!1,n)}#n(n,e){e.setAttribute("aria-grabbed",n.toString()),this.elements.boundary.setAttribute("aria-dropeffect",n?"move":"none")}#b(){return this.elements.preview.offsetParent!==null}#p(){let n=this.elements.boundary.getBoundingClientRect(),e=this.elements.preview.getBoundingClientRect(),t=this.elements.overlay;t.style.width=e.width+"px",t.style.height=e.height+"px",t.style.top=`${e.top-n.top}px`,t.style.left=`${e.left-n.left}px`}#d(){if(!this.#b())return;let n=this.elements.preview,e=new te(0,0,1);n.style.transform=e.toString(),n.style.transformOrigin=new ie().toString(),this.#m(),e.scale=this.#e,n.style.transform=e.toString(),n.style.transformOrigin=new ie().toString(),this.#x(),this.#p()}#c(n){this.elements.preview.style.transform=n.toString();let e=this.elements.viewport.getBoundingClientRect(),t=this.elements.preview.getBoundingClientRect(),o=new ie(this.elements.preview),r=e.top-t.top+e.height/2,b={x:(e.left-t.left+e.width/2)/this.#e,y:r/this.#e};n.x-=(b.x-o.x)*(1-this.#e),n.y-=(b.y-o.y)*(1-this.#e),this.elements.preview.style.transform=n.toString(),this.elements.preview.style.transformOrigin=b.x+"px "+b.y+"px"}#m(){let n=this.elements.preview,e=this.elements.viewport.getBoundingClientRect(),t=Math.max(e.width/n.naturalWidth,e.height/n.naturalHeight),o=.85;t>=o&&(o+=t),this.elements.zoomer.min=t.toString(),this.elements.zoomer.max=o.toString();let r=this.#o;if(r===null){let d=this.elements.boundary.getBoundingClientRect();r=Math.max(d.width/n.naturalWidth,d.height/n.naturalHeight)}this.setZoom(r)}#x(){let n=this.elements.preview.getBoundingClientRect(),e=this.elements.viewport.getBoundingClientRect(),t=this.elements.boundary.getBoundingClientRect(),o=e.left-t.left,r=e.top-t.top,d=o-(n.width-e.width)/2,b=r-(n.height-e.height)/2;this.#c(new te(d,b,this.#e))}};var be=(()=>{class i{configure(e){let{cropSize:t,cropImageType:o,cropImageQuality:r}=e;t&&this.cropSize.set(t),o&&this.cropImageType.set(o),r&&this.cropImageQuality.set(r)}setImage(e,t){this.element.set(e),this.image.set(t),this.error.set(null)}getCroppedImage(){return ne(this,null,function*(){let e=this.cropt();if(!e)return null;let t=this.image()?.name?.replace(/\.[a-z]{3,4}$/i,".jpg")??"avatar.jpg",o=Math.max(this.cropSize().width,this.cropSize().height),r=yield e.toBlob(o,this.cropImageType(),this.cropImageQuality());return new File([r],t,{type:this.cropImageType()})})}constructor(){this.error=T(null),this.element=T(null),this.image=T(null),this.cropSize=T({width:240,height:320}),this.cropImageType=T("image/jpeg"),this.cropImageQuality=T(.8),this.croptOptions=$(()=>({viewport:this.cropSize()})),this.cropt=Oe({source:this.element,computation:(e,t)=>(t?.value?.destroy(),e?new fe(e,this.croptOptions()):null)}),ae(()=>{let e=this.image();if(!e)return;let t=URL.createObjectURL(e);ne(this,null,function*(){try{yield this.cropt()?.bind(t)}catch(o){console.error("Error binding image for cropping",o),this.error.set(o)}})})}ngOnDestroy(){this.cropt()?.destroy()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=Z({token:i,factory:i.\u0275fac})}}return i})();var Ut=["cropElement"];function Wt(i,n){if(i&1){let e=B();H(0),c(1,"translate"),l(2,"bkd-file-input",8),Ne("fileChange",function(o){D(e);let r=u();return Fe(r.file,o)||(r.file=o),k(o)}),s()}if(i&2){let e=u(),t=e.invalidFile()?m(1,3,"shared.avatar-edit.dialog.invalid-file"):null;a(2),g("acceptedExtensions",e.acceptedExtensions)("error",t),Ve("file",e.file)}}function Yt(i,n){i&1&&(l(0,"p"),p(1),c(2,"translate"),s(),v(3,"div",null,0)),i&2&&(a(),f("",m(2,1,"shared.avatar-edit.dialog.crop"),":"))}function Gt(i,n){i&1&&(l(0,"div",9),p(1),c(2,"translate"),s()),i&2&&(a(),f(" ",m(2,1,"shared.avatar-edit.dialog.load-error")," "))}function Xt(i,n){if(i&1&&y(0,Yt,5,3)(1,Gt,3,3,"div",9),i&2){let e=u();_(e.error()?1:0)}}function Zt(i,n){i&1&&(l(0,"p"),p(1),c(2,"translate"),s(),v(3,"bkd-spinner",10)),i&2&&(a(),E(m(2,1,"shared.avatar-edit.dialog.saving")))}function Qt(i,n){i&1&&(l(0,"div",9),p(1),c(2,"translate"),s()),i&2&&(a(),f(" ",m(2,1,"shared.avatar-edit.dialog.upload-error")," "))}function qt(i,n){if(i&1&&(y(0,Zt,4,3),y(1,Qt,3,3,"div",9)),i&2){let e=u();_(e.saving()?0:-1),a(),_(e.error()?1:-1)}}function Kt(i,n){if(i&1){let e=B();l(0,"button",11),A("click",function(){D(e);let o=u();return k(o.proceed())}),p(1),s()}if(i&2){let e=u();g("disabled",!e.canProceed()),a(),f(" ",e.proceedLabel()," ")}}var Dt=(()=>{class i{constructor(){this.activeModal=C(lt),this.translate=C(he),this.croptService=C(be),this.additionalInformationsRestService=C(Mt),this.studentId=T(0),this.step=T("choose"),this.acceptedExtensions=[".jpg",".jpeg",".png"],this.acceptedMimeTypes=["image/jpeg","image/png"],this.file=T(null),this.invalidFile=$(()=>this.file()&&!this.acceptedMimeTypes.includes(this.file()?.type??"")),this.error=T(null),this.cropElement=ze("cropElement"),this.saving=T(!1),this.canCancel=$(()=>this.step()!=="uploading"||!this.saving()),this.canProceed=$(()=>{switch(this.step()){case"choose":return this.file()!==null&&!this.invalidFile();case"crop":return!this.error()}return!1}),this.cancelLabel=$(()=>this.translate.instant(this.error()?"shared.avatar-edit.dialog.close":"shared.avatar-edit.dialog.cancel")),this.proceedLabel=$(()=>this.translate.instant(this.step()==="crop"?"shared.avatar-edit.dialog.save":"shared.avatar-edit.dialog.next")),this.croptService.configure({cropSize:{width:240,height:320},cropImageType:"image/jpeg"}),ae(()=>{this.step()==="crop"&&this.croptService.setImage(this.cropElement()?.nativeElement??null,this.file())}),ae(()=>{this.error.set(this.croptService.error())})}proceed(){return ne(this,null,function*(){switch(this.step()){case"choose":this.step.set("crop");break;case"crop":{let e=yield this.croptService.getCroppedImage();this.step.set("uploading"),yield this.upload(e);break}}})}upload(e){this.saving.set(!0);let t=V(e).pipe(I(o=>o?V(o):G(()=>new Error("No avatar image available"))),I(o=>this.additionalInformationsRestService.uploadPhoto(this.studentId(),o)));return t.subscribe({next:()=>{this.saving.set(!1),this.activeModal.close(!0)},error:o=>{this.saving.set(!1),this.error.set(o),console.error(o)}}),Se(t)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=P({type:i,selectors:[["bkd-avatar-edit-dialog"]],viewQuery:function(t,o){t&1&&Te(o.cropElement,Ut,5),t&2&&Be()},features:[pe([be])],decls:13,vars:7,consts:[["cropElement",""],[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[3,"acceptedExtensions","error","file"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"disabled"],[3,"fileChange","acceptedExtensions","error","file"],[1,"alert","alert-danger"],[1,"inline"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(t,o){if(t&1&&(l(0,"div",1)(1,"h5",2),p(2),c(3,"translate"),s()(),l(4,"div",3)(5,"p"),y(6,Wt,3,5,"bkd-file-input",4)(7,Xt,2,1)(8,qt,2,2),s()(),l(9,"div",5)(10,"button",6),A("click",function(){return o.activeModal.dismiss()}),p(11),s(),y(12,Kt,2,2,"button",7),s()),t&2){let r;a(2),f(" ",m(3,5,"shared.avatar-edit.dialog.title")," "),a(4),_((r=o.step())==="choose"?6:r==="crop"?7:r==="uploading"?8:-1),a(4),g("disabled",!o.canCancel()),a(),f(" ",o.cancelLabel()," "),a(),_(o.step()!=="uploading"?12:-1)}},dependencies:[xt,ue,F],styles:["#drop-zone[_ngcontent-%COMP%]{border:2px dashed #adb5bd;display:none;flex-direction:column;justify-content:center;align-items:center;padding:5rem;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:1055;background:#dededee6}#drop-zone.dragging[_ngcontent-%COMP%]{display:flex}"],changeDetection:0})}}return i})();function Jt(i,n){if(i&1){let e=B();z(0,"button",0),Ae("click",function(o){D(e);let r=u();return k(r.openDialog(o))}),z(1,"i",1),p(2,"add_a_photo"),j()(),z(3,"div",2),p(4),c(5,"translate"),j()}i&2&&(a(4),f(" ",m(5,1,"shared.avatar-edit.upload")," "))}var kt=(()=>{class i{constructor(){this.avatarService=C(bt),this.modalService=C(Ct),this.reload$=new we,this.studentId=de.required(),this.avatarDataUri=L(Ee(J(this.studentId),this.reload$.pipe(re(()=>this.studentId()))).pipe(I(e=>this.avatarService.loadAvatarDataUri(e)),X(1)))}openDialog(e){if(e?.stopImmediatePropagation(),this.avatarDataUri())return;let t=this.modalService.open(Dt);t.componentInstance.studentId.set(this.studentId()),t.closed.subscribe(()=>{this.reload$.next()})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=P({type:i,selectors:[["bkd-avatar-edit"]],hostVars:4,hostBindings:function(t,o){t&1&&A("click",function(){return o.openDialog()}),t&2&&(Le("background-image",o.avatarDataUri()?"url("+o.avatarDataUri()+")":null),le("edit",!o.avatarDataUri()))},inputs:{studentId:[1,"studentId"]},decls:1,vars:1,consts:[[1,"edit-button","btn","btn-primary","btn-icon",3,"click"],[1,"material-icons"],[1,"edit-label","mt-2"]],template:function(t,o){t&1&&y(0,Jt,6,3),t&2&&_(o.avatarDataUri()?-1:0)},dependencies:[F],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100px;min-width:100px;height:130px;background-repeat:no-repeat;background-size:cover;background-position:center;border:1px solid rgba(0,0,0,.25)}.edit[_nghost-%COMP%]{cursor:pointer}.edit-label[_ngcontent-%COMP%]{text-align:center;font-size:.7em}"],changeDetection:0})}}return i})();function ei(i,n){if(i&1&&(l(0,"span"),p(1),s()),i&2){u(2);let e=w(0);a(),f("(",e.Gender,")")}}function ti(i,n){if(i&1&&(l(0,"div",0)(1,"div",1),v(2,"bkd-avatar-edit",2),l(3,"div",3),p(4),y(5,ei,2,1,"span"),l(6,"div",4),p(7),c(8,"date"),s()()(),v(9,"bkd-reports-link",5),c(10,"async"),s(),l(11,"div",6),p(12),s()),i&2){let e=u(),t=w(0);a(2),g("studentId",t.Id),a(2),Re(" ",t.LastName," ",t.FirstName," ",t.MiddleName," "),a(),_(t.Gender?5:-1),a(2),f(" ",W(8,8,t.Birthdate,"dd.MM.yyyy")," "),a(2),g("reports",m(10,11,e.reports$)),a(3),E(t.Email)}}var At=(()=>{class i{constructor(){this.reportsService=C(_t),this.person=de(),this.personId=$(()=>this.person()?.Id??null),this.reports$=J(this.personId).pipe(I(e=>e?this.reportsService.getPersonMasterDataReports(e):V([])),De([]))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=P({type:i,selectors:[["bkd-my-profile-header"]],inputs:{person:[1,"person"]},decls:2,vars:2,consts:[[1,"avatar-person"],[1,"d-flex"],[1,"me-3","avatar",3,"studentId"],[1,"person"],[1,"birthdate"],[3,"reports"],[1,"email"]],template:function(t,o){if(t&1&&(H(0),y(1,ti,13,13)),t&2){let r=U(o.person());a(),_(r?1:-1)}},dependencies:[kt,ut,ce,me],styles:[".avatar-person[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding-left:1rem 1rem 1rem 0}.person[_ngcontent-%COMP%]{align-self:center}.email[_ngcontent-%COMP%]{padding:1rem 1rem 0 0}.report[_ngcontent-%COMP%]{align-self:flex-start;line-height:1}"],changeDetection:0})}}return i})();var ge=()=>[],ii=(i,n)=>n.apprenticeshipContract.Id,ni=(i,n)=>n.Id;function oi(i,n){i&1&&v(0,"bkd-spinner")}function ri(i,n){i&1&&(l(0,"p",7),p(1),c(2,"translate"),s()),i&2&&(a(),f(" ",m(2,1,"shared.profile.substitution-profile")," "))}function ai(i,n){if(i&1&&v(0,"bkd-my-profile-entry",11),i&2){u(2);let e=w(0);g("value",e.SocialSecurityNumber)}}function si(i,n){if(i&1&&v(0,"bkd-my-profile-entry",12),i&2){u(2);let e=w(0);g("value",e.HomeTown||e.Nationality)}}function li(i,n){if(i&1&&v(0,"bkd-my-profile-entry",13),i&2){u(2);let e=w(0);g("value",e.NativeLanguage)}}function pi(i,n){i&1&&v(0,"bkd-spinner",14)}function di(i,n){if(i&1&&v(0,"bkd-my-profile-entry",15),i&2){u(2);let e=w(1);g("value",e)}}function ci(i,n){if(i&1&&(v(0,"bkd-my-profile-entry",16),c(1,"date")),i&2){u(2);let e=w(0);g("value",W(1,1,e.StayPermitExpiry,"mediumDate"))}}function mi(i,n){if(i&1&&(l(0,"div",24)(1,"a",25),c(2,"translate"),l(3,"i",26),p(4,"edit"),s()(),v(5,"bkd-student-dossier-address",27),s()),i&2){u(2);let e=w(0);a(),ke("aria-label",m(2,2,"my-profile.edit.title")),a(4),g("student",e)}}function hi(i,n){if(i&1&&v(0,"bkd-my-profile-address",28),i&2){u(3);let e=w(0);g("address",e.CorrespondenceAddress)}}function ui(i,n){if(i&1){let e=B();l(0,"div",18,1)(2,"div",19)(3,"bkd-student-dossier-entry-header",20),A("click",function(){D(e);let o=R(1);return k(o.toggle())}),p(4),c(5,"translate"),s()(),l(6,"div",21)(7,"div",22),Q(8,hi,1,1,"ng-template"),s()()()}if(i&2){let e=R(1);a(3),g("opened",!e.collapsed),a(),f(" ",m(5,2,"shared.profile.correspondence-address")," ")}}function fi(i,n){if(i&1&&v(0,"bkd-my-profile-address",28),i&2){u(3);let e=w(0);g("address",e.BillingAddress)}}function gi(i,n){if(i&1){let e=B();l(0,"div",18,2)(2,"div",19)(3,"bkd-student-dossier-entry-header",20),A("click",function(){D(e);let o=R(1);return k(o.toggle())}),p(4),c(5,"translate"),s()(),l(6,"div",21)(7,"div",22),Q(8,fi,1,1,"ng-template"),s()()()}if(i&2){let e=R(1);a(3),g("opened",!e.collapsed),a(),f(" ",m(5,2,"shared.profile.billing-address")," ")}}function vi(i,n){i&1&&v(0,"bkd-spinner",14)}function yi(i,n){if(i&1&&v(0,"bkd-student-dossier-legal-representative",29),i&2){let e=n.$implicit;g("person",e)}}function _i(i,n){if(i&1&&q(0,yi,1,1,"bkd-student-dossier-legal-representative",29,ni),i&2){let e=u(3);K(e.legalRepresentatives()??se(0,ge))}}function Ci(i,n){if(i&1){let e=B();l(0,"div",18,3)(2,"div",19)(3,"bkd-student-dossier-entry-header",20),A("click",function(){D(e);let o=R(1);return k(o.toggle())}),p(4),c(5,"translate"),s()(),l(6,"div",21)(7,"div",22),Q(8,_i,2,1,"ng-template"),s()()()}if(i&2){let e=R(1);a(3),g("opened",!e.collapsed),a(),f(" ",m(5,2,"shared.profile.legal-representation")," ")}}function bi(i,n){i&1&&v(0,"bkd-spinner",14)}function xi(i,n){if(i&1&&p(0),i&2){let e=u().$index;f(" ",e+1," ")}}function wi(i,n){if(i&1&&v(0,"bkd-student-dossier-apprenticeship",30),i&2){let e=u().$implicit;g("apprenticeship",e)}}function Si(i,n){if(i&1){let e=B();l(0,"div",23,4)(2,"div",19)(3,"bkd-student-dossier-entry-header",20),A("click",function(){D(e);let o=R(1);return k(o.toggle())}),p(4),c(5,"translate"),y(6,xi,1,1),s()(),l(7,"div",21)(8,"div",22),Q(9,wi,1,1,"ng-template"),s()()()}if(i&2){let e=R(1),t=u(2);a(3),g("opened",!e.collapsed),a(),f(" ",m(5,3,"shared.profile.apprenticeship-company")," "),a(2),_((t.apprenticeships()??se(5,ge)).length>1?6:-1)}}function Ei(i,n){if(i&1){let e=B();v(0,"bkd-my-profile-header",8),l(1,"div",9)(2,"div",10),y(3,ai,1,1,"bkd-my-profile-entry",11),y(4,si,1,1,"bkd-my-profile-entry",12),y(5,li,1,1,"bkd-my-profile-entry",13),y(6,pi,1,0,"bkd-spinner",14)(7,di,1,1,"bkd-my-profile-entry",15),y(8,ci,2,4,"bkd-my-profile-entry",16),s(),l(9,"div",17)(10,"div",18,0)(12,"div",19)(13,"bkd-student-dossier-entry-header",20),A("click",function(){D(e);let o=R(11);return k(o.toggle())}),p(14),c(15,"translate"),s()(),l(16,"div",21)(17,"div",22),Q(18,mi,6,4,"ng-template"),s()()(),y(19,ui,9,4,"div",18),y(20,gi,9,4,"div",18),y(21,vi,1,0,"bkd-spinner",14)(22,Ci,9,4,"div",18),y(23,bi,1,0,"bkd-spinner",14),q(24,Si,10,6,"div",23,ii),s()()}if(i&2){let e=R(11),t=u(),o=w(0),r=w(1);g("person",o),a(3),_(o.SocialSecurityNumber?3:-1),a(),_(o.HomeTown||o.Nationality?4:-1),a(),_(o.NativeLanguage?5:-1),a(),_(t.loadingStayPermit()?6:r?7:-1),a(2),_(o.StayPermitExpiry?8:-1),a(5),g("opened",!e.collapsed),a(),f(" ",m(15,12,"shared.profile.student-address")," "),a(5),_(o.CorrespondenceAddress?19:-1),a(),_(o.BillingAddress?20:-1),a(),_(t.loadingLegalRepresentatives()?21:(t.legalRepresentatives()??se(14,ge)).length>0?22:-1),a(2),_(t.loadingApprenticeships()?23:-1),a(),K(t.apprenticeships()??se(15,ge))}}var Tt=(()=>{class i{constructor(){this.profileService=C(ee),this.person=L(this.profileService.person$,{initialValue:null}),this.loadingPerson=L(this.profileService.loadingPerson$,{requireSync:!0}),this.legalRepresentatives=L(this.profileService.legalRepresentatives$,{initialValue:null}),this.loadingLegalRepresentatives=L(this.profileService.loadingLegalRepresentatives$,{requireSync:!0}),this.apprenticeships=L(this.profileService.apprenticeships$),this.loadingApprenticeships=L(this.profileService.loadingApprenticeships$,{requireSync:!0}),this.stayPermit=L(this.profileService.stayPermit$,{initialValue:null}),this.loadingStayPermit=L(this.profileService.loadingStayPermit$,{requireSync:!0})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=P({type:i,selectors:[["bkd-my-profile-show"]],decls:9,vars:6,consts:[["studentAddress","ngbAccordionItem"],["correspondenceAddress","ngbAccordionItem"],["billingAddress","ngbAccordionItem"],["legalRepresentativesItem","ngbAccordionItem"],["apprenticeshipCompanies","ngbAccordionItem"],[1,"bkd-container","bkd-container-limited"],["data-testid","profile-title"],["data-testid","profile-substitution"],[3,"person"],["data-testid","profile-content",1,"profile-content"],[1,"profile-entries","pt-3"],["label","my-profile.show.social-security-number",3,"value"],["label","my-profile.show.hometown-nationality",3,"value"],["label","my-profile.show.native-language",3,"value"],[1,"small"],["label","my-profile.show.stay-permit",3,"value"],["label","my-profile.show.stay-permit-expiry",3,"value"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[3,"ngbAccordionItem"],[1,"clearfix"],["routerLink","edit",1,"btn","btn-primary","btn-icon","float-end","me-2"],[1,"material-icons"],["emailProperty","Email2",1,"profile-entry",3,"student"],[1,"profile-entry",3,"address"],[1,"profile-entry",3,"person"],[1,"profile-entry",3,"apprenticeship"]],template:function(t,o){if(t&1&&(H(0)(1),l(2,"div",5)(3,"h1",6),p(4),c(5,"translate"),s(),y(6,oi,1,0,"bkd-spinner")(7,ri,3,3,"p",7)(8,Ei,26,16),s()),t&2){let r=U(o.person());a(),U(o.stayPermit()),a(3),E(m(5,4,"my-profile.title")),a(2),_(o.loadingPerson()?6:r?8:7)}},dependencies:[At,Et,qe,Qe,Ze,ft,Xe,Ge,We,gt,St,yt,vt,ue,me,F],styles:[".profile-content[_ngcontent-%COMP%]{padding-top:1rem}.profile-entry[_ngcontent-%COMP%]{display:block;padding:0 1rem}.profile-entries[_ngcontent-%COMP%]:not(:empty){border-top:1px solid rgb(222,222,222)}"],changeDetection:0})}}return i})();var Bt=(()=>{class i{constructor(){}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=P({type:i,selectors:[["bkd-my-profile"]],features:[pe([ee])],decls:1,vars:0,template:function(t,o){t&1&&v(0,"router-outlet")},dependencies:[He],encapsulation:2,changeDetection:0})}}return i})();var yo=[{path:"",component:Bt,children:[{path:"",component:Tt},{path:"edit",component:wt}]}];export{yo as MY_PROFILE_ROUTES};
