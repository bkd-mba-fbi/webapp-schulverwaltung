import{a as In,b as Yt}from"./chunk-EXUH2IKV.js";import{a as zt,b as Qt}from"./chunk-337UQ62T.js";import{b as Mn}from"./chunk-OSEZAWNS.js";import{a as ot}from"./chunk-LPHT63ZN.js";import{a as qt}from"./chunk-5L5ES5M4.js";import{a as Pe}from"./chunk-EPRXZTM5.js";import{a as Ut}from"./chunk-DTKTCFCA.js";import{e as En}from"./chunk-VCLSDZNG.js";import{a as cn,b as pn}from"./chunk-SBIVIORM.js";import{a as Ct,b as fn,c as Cn,d as vn,e as _n,f as Ht,g as Wt,h as bn,i as yn,k as Sn,l as be,m as Nt,o as xn,p as jt,q as Tn,r as ye}from"./chunk-TQA3IWPA.js";import{b as gn,d as nt}from"./chunk-2YJFQY6Q.js";import{a as ln,d as dn}from"./chunk-QCQIXYZH.js";import{e as hn}from"./chunk-6W2D2RKA.js";import{B as sn,C as tt,G as Re,H as Pn}from"./chunk-M3G4PYWN.js";import{a as et,c as an}from"./chunk-CAKWAK5Y.js";import{a as ne,b as it}from"./chunk-O7D7N5QA.js";import{a as un}from"./chunk-Y4QYVF5K.js";import{p as on}from"./chunk-QPPZNX2W.js";import{a as Ze}from"./chunk-HY2G6OQH.js";import{a as at,b as Kt}from"./chunk-56O3JFYF.js";import{a as rt,b as wn,c as Be}from"./chunk-CVC36YTP.js";import{a as mn,b as ft}from"./chunk-CXKEEE6P.js";import{a as Rt}from"./chunk-YHCR7GAG.js";import{d as At}from"./chunk-UFMGFWOV.js";import{a as Je,b as ui,i as fe}from"./chunk-NY2OCKWG.js";import{a as tn,b as nn}from"./chunk-3F6JOQLC.js";import{a as $e,b as K,h as Yi,i as Qi,k as Xi,l as Zi,r as Ve}from"./chunk-LJEFSGQD.js";import{a as rn,b as _e}from"./chunk-DQAQYQ7K.js";import{a as Xe}from"./chunk-GB43FPNZ.js";import{F as Vt,G as mi,H as Ji,I as Bt,J as en,d as ut,f as ht,g as Ri,h as Ee,q as he,r as Le,s as Fe,t as Z,z as ge}from"./chunk-DXI7W5HI.js";import{$b as w,$d as Gt,Aa as di,Ab as Et,Ac as V,Ad as Ke,Ba as Tt,Bc as ci,Cb as b,Da as Ei,Ec as c,Ed as pi,Fc as m,Fd as kt,G as bt,Ga as Ce,Gc as H,H as Me,Hb as pe,Ib as g,Ja as ke,Ka as M,Kb as Y,Kc as $i,L as yt,La as Pi,Ma as N,N as yi,O as St,Ob as f,Od as Ot,Pb as ki,Q as ce,Qb as qe,Qc as Vi,Rb as R,Rc as P,S as ae,Sb as A,Sc as Mt,Tb as o,Tc as We,U as xt,Ub as s,Vb as _,Y as Si,Yd as Dt,Zb as D,_ as oe,_d as Ye,a as L,aa as je,ac as h,ae as Ai,b as B,ba as G,bc as Oi,cc as Di,cd as ue,d as re,da as we,dc as De,de as Hi,ec as pt,ee as Wi,fd as te,fe as Lt,gb as Oe,gc as Gi,gd as Ge,ge as Ni,hc as Li,ic as Fi,ie as ji,j as se,ja as Q,jb as r,jc as Pt,jd as Bi,k as ee,kc as It,ke as Ui,l as li,lc as xe,mc as d,nc as y,oc as C,oe as Ft,pa as u,pc as mt,pe as $t,q as F,qe as qi,r as bi,rb as wt,sc as q,se as zi,ta as xi,tb as le,tc as j,te as Qe,u as Ie,ua as Ti,uc as z,ue as Ki,v as E,va as Ue,vc as $,w as X,wa as x,wb as v,wc as U,we as ie,xa as T,xc as O,xe as I,ya as He,yb as Ii,yc as me,za as wi,zb as Mi,zc as ze,zd as gt}from"./chunk-D6CA3SC5.js";var Qr=10300,Xr=10260,Zr=10250,Jr=14030,ea=10350;function Xt(t){let{HasEvaluationStarted:l,EvaluationUntil:e,HasTestGrading:i}=t.EvaluationStatusRef;if(l===!0&&(t.StatusId===Jr||t.StatusId===ea))return{value:ve.Rating};if(l===!0&&i===!1){if(e)return{value:ve.RatingUntil};if(t.StatusId===Qr)return{value:ve.IntermediateRating}}return l===!1&&i===!0&&t.StatusId!==Xr&&t.StatusId!==Zr?{value:ve.Tests}:l===!0&&i===!0?e?{value:ve.Tests,label:ve.RatingUntil}:{value:ve.Tests,label:ve.IntermediateRating}:null}function kn(t){return t.EvaluationStatusRef.HasEvaluationStarted===!0}function On(t){return t.EvaluationStatusRef.HasReviewOfEvaluationStarted===!0&&!!t.FinalGrades?.length}function Zt(t){let l=t.Classes?t.Classes.map(e=>e.Number).join(", "):null;return l?t.Designation+", "+l:t.Designation}function Dn(t,l){return t?(l.Leadership??"").split(",").some(e=>e.trim()===t.fullname):!1}function Gn(t,l){let e=new URLSearchParams({returnlink:l});return l.startsWith("/dashboard")?`/dashboard/students/${t}?${e}`:l.startsWith("/events/current")?`/events/current/${t}?${e}`:`/events/${t}/students?${e}`}function Ln(t){let l=t.Participants?.filter(e=>e.IsActive).map(e=>({id:e.PersonId,name:e.FullName,email:e.DisplayEmail??void 0}))??[];return{eventId:t.Id,eventDesignation:t.Designation,studyClasses:(t.Classes??[]).map(e=>e.Designation).sort(),entries:l}}function hi(t,l){return B(L({},t),{entries:t.entries.map(e=>{let i=l.find(a=>a.StudentId===e.id),n=i?[i.CompanyName,i.CompanyNameAddition].filter(Boolean).join(" \u2013 "):void 0;return B(L({},e),{company:n})})})}function gi(t,l,e,{eventDesignation:i,emailFallback:n}={}){return{eventId:t,eventDesignation:i??e[0]?.EventDesignation??"",studyClasses:[],entries:l.map(a=>{let p=e.find(S=>S.PersonId===a.Id);return{id:a.Id,subscriptionId:p?.Id,name:a.FullName,email:(n?a.DisplayEmail??a.Email:a.DisplayEmail)??void 0,status:p?.Status,registrationDate:p?.RegistrationDate??void 0}})}}function Fn(t,l){return B(L({},t),{entries:t.entries.map(e=>B(L({},e),{studyClass:l.find(i=>i.StudentRef.Id===e.id)?.StudyClassNumber}))})}var ve=function(t){return t.Rating="rating",t.RatingUntil="rating-until",t.IntermediateRating="intermediate-rating",t.Tests="add-tests",t}(ve||{}),st=(()=>{class t{constructor(){this.coursesRestService=u(be),this.eventsRestService=u(at),this.studyClassRestService=u(qt),this.subscriptionsRestService=u(rt),this.loadingService=u(ne),this.storageService=u(Ze),this.translate=u(ie),this.router=u(Fe),this.loading$=this.loadingService.loading$,this.searchFields$=new ee(["designation"]),this.searchSubject$=new ee(""),this.search$=this.searchSubject$.asObservable(),this.roles$=new ee(null),this.isClassTeacher$=this.roles$.pipe(E(e=>un(e,"ClassTeacherRole")),oe(1)),this.withStudyCourses$=new ee(!1),this.unratedCourses$=this.roles$.pipe(G(this.loadUnratedCourses.bind(this)),oe(1)),this.studyCourses$=this.withStudyCourses$.pipe(G(this.loadStudyCourses.bind(this)),oe(1)),this.formativeAssessments$=this.isClassTeacher$.pipe(G(this.loadFormativeAssessments.bind(this)),oe(1)),this.studyClasses$=this.isClassTeacher$.pipe(G(this.loadStudyClasses.bind(this)),oe(1)),this.events$=this.getEvents().pipe(oe(1)),this.filteredEvents$=X([this.events$,this.searchFields$,this.search$]).pipe(E(tt(zt)))}setSearch(e){this.searchSubject$.next(e)}setRoles(e){this.roles$.next(e)}setWithStudyCourses(e){this.withStudyCourses$.next(e)}setSearchFields(e){this.searchFields$.next(e)}getEntries(e=!1){return this.filteredEvents$.pipe(E(i=>e?i.filter(n=>n.evaluationText):i))}getEvents(){return this.loadingService.load(X([this.unratedCourses$,this.studyCourses$,this.formativeAssessments$,this.studyClasses$]),{stopOnFirstValue:!0}).pipe(E(tt(this.createAndSortEvents.bind(this))))}loadUnratedCourses(e){return this.coursesRestService.getExpandedCourses(e).pipe(E(i=>i.filter(n=>!On(n))))}loadStudyCourses(e){if(!e)return F([]);let i=this.storageService.getPayload();return this.eventsRestService.getStudyCourseEvents().pipe(E(n=>n.filter(a=>Dn(i,a))),G(n=>n.length>0?this.subscriptionsRestService.getSubscriptionCountsByEvents(n.map(a=>a.Id)).pipe(E(a=>n.map(p=>B(L({},p),{StudentCount:a[p.Id]??0})))):F(n)))}loadFormativeAssessments(e){return e?this.studyClassRestService.getActiveFormativeAssessments():F([])}loadStudyClasses(e){return e?this.studyClassRestService.getActive():F([])}createAndSortEvents(e,i,n,a){let p=a.filter(S=>!n.map(W=>W.Id).includes(S.Id));return[...this.createFromCourses(e),...this.createFromStudyCourses(i),...this.createFromAssessments(n),...this.createFromStudyClasses(p)].sort((S,W)=>S.designation.localeCompare(W.designation))}createFromCourses(e){return e.map(i=>{let n=Xt(i);return{id:i.Id,designation:Zt(i),detailLink:this.buildStudentsLink(i.Id),studentCount:i.AttendanceRef.StudentCount||0,dateFrom:i.DateFrom,dateTo:i.DateTo,state:n?.value||null,evaluationText:this.getEvaluationText(n,i.EvaluationStatusRef.EvaluationUntil),evaluationLink:n?.value&&n?.value!==ve.Tests?["/events",i.Id,"evaluation"]:["/events",i.Id,"tests"]}})}createFromStudyCourses(e){return e.map(i=>({id:i.Id,designation:i.Designation,detailLink:this.buildStudentsLink(i.Id),studentCount:i.StudentCount,state:null}))}createFromAssessments(e){return this.createFromStudyClasses(e).map(n=>B(L({},n),{state:ve.Rating,evaluationText:this.translate.instant("events.state.rating"),evaluationLink:["/events",n.id,"evaluation"]}))}createFromStudyClasses(e){return e.map(i=>({id:i.Id,designation:i.Number,detailLink:this.buildStudentsLink(i.Id),studentCount:i.StudentCount,state:null}))}getEvaluationText(e,i){let n=e?.label||e?.value;return n?this.translate.instant(`events.state.${n}`)+(n===ve.RatingUntil?` ${i?on(i,"dd.MM.yyyy"):""}`:""):""}buildStudentsLink(e){return Gn(e,this.router.url)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Q({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var $n=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events"]],features:[me([st,sn])],decls:1,vars:0,template:function(i,n){i&1&&_(0,"router-outlet")},dependencies:[Le],encapsulation:2})}}return t})();var Vn=kt({adAsColumns:pi(Ke),adAsCriteria:pi(Ke)});var Bn=(()=>{class t{constructor(){this.settings=u(ge),this.resourcePath="Configurations",this.http=u(Ee)}getSubscriptionDetailsDisplay(){return this.http.get(`${this.baseUrl}/Grading`).pipe(G(tn(Vn)))}get baseUrl(){return`${this.settings.apiUrl}/${this.resourcePath}`}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Q({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Rn=kt({Id:gt,IdPerson:Ke,PersonFullname:gt,IdGrade:Ot(Ke),GradeValue:Ot(gt),Comment:Ot(gt)});var Jt=(()=>{class t extends Je{constructor(){let e=u(Ee),i=u(ge);super(e,i,Rn,"GradingItems")}getListForEvent(e){let i=new ut().set("idEvent",e);return this.getList({params:i})}updateForEvent(e,i){let n=new ut().set("idEvent",e);return this.http.put(`${this.baseUrl}/`,i,{params:n})}update(e){let i=`${this.baseUrl}/${e.Id}`;return this.http.put(i,e)}updateComment(e,i){let n=`${this.baseUrl}/${e}`;return this.http.put(n,{Comment:i})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Q({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Hn(t){return(l,e)=>{let i=0;switch(t.primarySortKey){case"name":i=An(l,e);break;case"grade":i=ia(l,e),i===0&&(i=An(l,e));break;default:throw new Rt(t.primarySortKey,"Unhandled sort criteria")}return t.ascending?i:-i}}function An(t,l){return t.gradingItem.PersonFullname.localeCompare(l.gradingItem.PersonFullname)}function ia(t,l){return(t.grade?.Sort??"-").localeCompare(l.grade?.Sort??"-")*-1}var na={primarySortKey:"name",ascending:!0},Wn="events-evaluation",Se=(()=>{class t{constructor(){this.route=u(he),this.loadingService=u(ne),this.coursesService=u(be),this.studyClassesService=u(qt),this.gradingItemsService=u(Jt),this.gradingScalesService=u(Nt),this.configurationsService=u(Bn),this.subscriptionDetailsService=u(Kt),this.eventId$=(this.route.parent?.params??F({})).pipe(E(e=>{let i=e.id;return i?Number(i):null}))??F(null),this.sortCriteria=N(na),this.loading=K(this.loadingService.loading(Wn),{requireSync:!0}),this.noEvaluation=P(()=>!this.gradingScale()&&this.columns().length===0&&this.entries().every(({criteria:e})=>e.length===0)),this.event=K(this.eventId$.pipe(G(this.loadEvaluationEvent.bind(this))),{initialValue:null}),this.columns=P(()=>this.collectColumns(this.columnSubscriptionDetails())),this.entries=P(()=>this.sortEntries(this.unsortedEntries(),this.sortCriteria())),this.gradingItems=We({source:K(this.eventId$.pipe(G(this.loadGradingItems.bind(this)),je([])),{initialValue:[]}),computation:e=>e}),this.gradingScale=K($e(this.event).pipe(G(e=>this.loadGradingScale(e?.gradingScaleId??null))),{initialValue:null}),this.subscriptionDetailsDisplay=K(this.loadSubscriptionDetailsDisplay(),{initialValue:null}),this.fetchedSubscriptionDetails=K(this.eventId$.pipe(G(this.loadSubscriptionDetails.bind(this))),{initialValue:[]}),this.subscriptionDetails=We(()=>this.fetchedSubscriptionDetails()),this.subscriptionDetailsValues=P(()=>this.fetchedSubscriptionDetails().reduce((e,i)=>B(L({},e),{[this.getDetailId(i)]:N(i.Value)}),{})),this.columnSubscriptionDetails=P(()=>this.filterColumns(this.subscriptionDetails(),this.subscriptionDetailsDisplay())),this.criteriaSubscriptionDetails=P(()=>this.filterCriteria(this.subscriptionDetails(),this.subscriptionDetailsDisplay())),this.unsortedEntries=P(()=>this.collectEntries(this.gradingItems(),this.gradingScale(),this.columns(),this.columnSubscriptionDetails(),this.criteriaSubscriptionDetails(),this.subscriptionDetailsValues()))}updateGradingItems(e){this.gradingItems.set(e)}updateSubscriptionDetail(e,i){let n=this.subscriptionDetails().map(a=>this.getDetailId(a)===this.getDetailId(e)?B(L({},a),{Value:i}):a);this.subscriptionDetails.set(n)}loadEvaluationEvent(e){return e===null?F(null):this.loadingService.load(X([this.loadCourse(e),this.loadStudyClass(e)]).pipe(E(([i,n])=>i??n)),Wn)}loadCourse(e){let i=new ht().set(ft,{disableErrorHandlingForStatus:[404]});return this.coursesService.getCourseWithStudentCount(e,{context:i}).pipe(ui(),E(n=>n?this.buildEvaluationEventFromCourse(n):null))}loadStudyClass(e){let i=new ht().set(ft,{disableErrorHandlingForStatus:[404]});return this.studyClassesService.get(e,{context:i}).pipe(ui(),E(n=>n?this.buildEvaluationEventFromStudyClass(n):null))}buildEvaluationEventFromCourse(e){let i=e.Classes?.map(a=>a.Number)??[],n=i.length>0?`${e.Designation}, ${i.join(", ")}`:e.Designation;return{id:e.Id,designation:n,type:"course",studentCount:e.AttendanceRef.StudentCount??0,gradingScaleId:e.GradingScaleId}}buildEvaluationEventFromStudyClass(e){return{id:e.Id,designation:e.Designation,type:"study-class",studentCount:e.StudentCount,gradingScaleId:null}}loadGradingItems(e){return e?this.gradingItemsService.getListForEvent(e):F([])}loadGradingScale(e){return e?this.gradingScalesService.get(e):F(null)}loadSubscriptionDetailsDisplay(){return this.configurationsService.getSubscriptionDetailsDisplay()}loadSubscriptionDetails(e){return e?this.subscriptionDetailsService.getListForEvent(e):F([])}filterColumns(e,i){if(!i)return[];let n=i.adAsColumns,a=e.filter(p=>n.includes(Number(p.VssId)));return mi(a,p=>p.Sort)}filterCriteria(e,i){if(!i)return[];let n=i.adAsCriteria,a=e.filter(p=>n.includes(Number(p.VssId)));return mi(a,p=>p.Sort)}getDetailId(e){return`${e.Id}_${e.IdPerson}`}getDetailIdByGradingItem(e,i){return`${e.Id}_${i}_${e.IdPerson}`}getSubscriptionDetailValue(e,i){return e[this.getDetailId(i)]??null}collectColumns(e){return Bt(e,i=>i.VssId).map(i=>({vssId:i.VssId,title:i.VssDesignation,tooltip:i.Tooltip,sort:i.Sort}))}collectEntries(e,i,n,a,p,S){return e.map(W=>this.buildEntry(W,i,n,a,p,S))}buildEntry(e,i,n,a,p,S){let W=a.filter(de=>de.IdPerson===e.IdPerson),Te=n.map(({vssId:de})=>W.find(Yr=>Yr.VssId===de)??null),Ne=p.filter(de=>de.IdPerson===e.IdPerson);return{gradingItem:e,grade:this.findGrade(e,i),columns:Te.map(de=>de?{detail:de,value:this.getSubscriptionDetailValue(S,de)}:null),criteria:Ne.map(de=>({detail:de,value:this.getSubscriptionDetailValue(S,de)})),evaluationRequired:this.isEvaluationRequired(e,i,Te,Ne,S[this.getDetailIdByGradingItem(e,3959)]??null)}}isEvaluationRequired(e,i,n,a,p){let S=i&&this.findGrade(e,i);return!!(i!==null&&S===null||[...n,...a].some(W=>W?.VssInternet==="M"&&W?.Value===null)||!S?.Sufficient&&p!==null&&a.filter(W=>W?.Value!==null).length===0)}findGrade(e,i){let n=i?.Grades??[];return e.IdGrade?n.find(a=>a.Id===e.IdGrade)??null:null}sortEntries(e,i){return[...e].sort(Hn(i))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Q({token:t,factory:t.\u0275fac})}}return t})();var Nn="events-evaluation-update",lt=(()=>{class t{constructor(){this.loadingService=u(ne),this.subscriptionDetailsService=u(Kt),this.state=u(Se),this.restErrorService=u(mn),this.toastService=u(Xe),this.translate=u(ie),this.updating=K(this.loadingService.loading(Nn),{requireSync:!0})}updateSubscriptionDetail(e){return re(this,null,function*(){let{detail:i,value:n}=e;if(!n||i.Value===n())return;let{error:a}=yield Ie(this.saveSubscriptionDetail({detail:i,value:n}));a?this.handleSubscriptionDetailError(e,a):this.handleSubscriptionDetailSuccess(e)})}handleSubscriptionDetailSuccess(e){let{detail:i,value:n}=e;n&&this.state.updateSubscriptionDetail(i,n())}handleSubscriptionDetailError(e,i){i instanceof Ri?this.restErrorService.notifyHttpError(i):this.toastService.error(this.translate.instant("global.app-errors.exception-message"),this.translate.instant("global.app-errors.exception-title"));let{detail:n,value:a}=e;a?.set(n.Value)}saveSubscriptionDetail(e){let{detail:i,value:n}=e;if(!n)return F({});let a=new ht().set(ft,{disableErrorHandlingExceptForStatus:[401,403]});return this.loadingService.load(this.subscriptionDetailsService.update(i,n(),a).pipe(E(()=>({})),yt(p=>F({error:p}))),Nn)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Q({token:t,factory:t.\u0275fac})}}return t})();function fi(t){return t.map(({finalGrade:l})=>l).filter(ra)}function ra(t){return t!==null}function qn(t,l,e,i){return t?.map(n=>({student:n,finalGrade:oa(n,e,i),grades:aa(n,l)}))}function aa(t,l){return l.map(e=>{if(e.Results===void 0||e.Results?.length===0)return{kind:"no-result",test:e};let i=e.Results?.find(n=>n.StudentId===t.Id);return i!==void 0?{kind:"grade",result:i,test:e}:{kind:"no-result",test:e}})}function oa(t,l,e){let i=l.find(a=>a.StudentId===t.Id);if(i)return{gradingId:i.Id,gradeId:i.GradeId??void 0,average:i.AverageTestResult||void 0,canGrade:i.CanGrade};let n=e.find(a=>a.StudentId===t.Id);if(n)return{finalGradeValue:n.Grade,average:n.AverageTestResult||void 0,canGrade:!1};throw new Error(`Student ${t.FullName} has neither a grading and nor a final grade, this should not happen`)}var zn=({primarySortKey:t,ascending:l},e)=>{let i=l?1:-1,n=null;if(t.startsWith("Test-")){let a=Number(t.replace("Test-",""));n=e.find(p=>p.Id===a)??null}return(a,p)=>{switch(t){case"FullName":return i*a.student.FullName.localeCompare(p.student.FullName);case"FinalGrade":return!a.finalGrade?.gradeId||!p.finalGrade?.gradeId?i*-1:i*jn(a.finalGrade.gradeId,p.finalGrade.gradeId);case"TestsMean":return!a.finalGrade?.average||!p.finalGrade?.average?i*-1:i*jn(a.finalGrade.average,p.finalGrade.average);default:return t.startsWith("Test-")&&n?i*sa(n,a,p):0}}},sa=(t,l,e)=>{let i=l.grades.filter(Un).find(a=>a.test.Id===t.Id),n=e.grades.filter(Un).find(a=>a.test.Id===t.Id);return t.IsPointGrading&&i?.result.GradeId===n?.result.GradeId?(i?.result.Points??0)-(n?.result.Points??0):((i?.result.GradeId??Number.POSITIVE_INFINITY)-(n?.result.GradeId??Number.POSITIVE_INFINITY))*-1};function jn(t,l){return t===l?0:t<l?-1:1}function Un(t){return t.kind==="grade"}function Kn(t){return(t?.test?.MaxPointsAdjusted||t?.test?.MaxPoints)??0}function Yn(t){let l=t.map(e=>e.average).filter(e=>e!=null&&e!==0).map(Number);return Ct(l)}function Qn(t,l){return Ct(t.map(e=>la(e,l)).filter(rn))}function la({gradeId:t,finalGradeValue:l},e){let i;t?i=e.find(p=>p.Key===t)?.Value:i=l;let n=Number(i);return isNaN(n)?0:n}var Xn=(()=>{class t extends Je{constructor(){let e=u(Ee),i=u(ge);super(e,i,Sn,"Gradings")}updateGrade(e,i){return this.http.put(`${this.baseUrl}/${e}`,{GradeId:i}).pipe(E(()=>e))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Q({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Ci(t,l){return[...l.filter(e=>e.Id!==t?.Id),t].filter(e=>e!=null)}function Zn({id:t,selectedGradeId:l},e){return e.map(i=>i.Id!==t?i:B(L({},i),{GradeId:l}))}function Jn(t,l){switch(l.type){case"reset":return l.payload;case"updateResult":return t?B(L({},t),{Tests:Cn(l.payload.testResult,t.Tests||[],l.payload.ignore),Gradings:l.payload.grading?Ci(l.payload.grading,t.Gradings||[]):t.Gradings}):null;case"deleteResult":return t?B(L({},t),{Tests:vn(l.payload.testId,l.payload.studentId,t.Tests||[]),Gradings:l.payload.grading?Ci(l.payload.grading,t.Gradings||[]):t.Gradings||[]}):null;case"toggle-test-state":return t?B(L({},t),{Tests:_n(l.payload,t.Tests||[])}):null;case"final-grade-overwritten":return t?B(L({},t),{Gradings:Zn({id:l.payload.id,selectedGradeId:l.payload.selectedGradeId},t.Gradings||[])}):null;case"replace-grades":return t?B(L({},t),{Gradings:l.payload}):null;case"delete-test":return t?B(L({},t),{Tests:bn(l.payload,t.Tests||[])}):null;default:return t}}var vi={onlyMine:!1,hidePublished:!1},J=(()=>{class t{constructor(){this.coursesRestService=u(be),this.gradingScalesRestService=u(Nt),this.gradingsRestService=u(Xn),this.loadingService=u(ne),this.sortService=u(Pn),this.action$=new li(1),this.loading$=this.loadingService.loading$,this._courseId$=new li(1),this.courseId$=this._courseId$.asObservable(),this.fetchedCourse$=this._courseId$.pipe(G(e=>this.loadingService.load(this.coursesRestService.getExpandedCourse(e))),oe(1)),this.course$=bt(this.action$,this.fetchedCourse$.pipe(Me(_e),E(e=>({type:"reset",payload:e})))).pipe(Si(Jn,null),Me(_e),oe(1)),this.tests$=this.course$.pipe(E(e=>e.Tests||[]),E(yn)),this.hasTests$=this.tests$.pipe(E(e=>e.length>0)),this.filterSubject$=new ee(vi),this.filter$=this.filterSubject$.asObservable(),this.expandedHeaderSubject$=new ee(!1),this.expandedHeader$=this.expandedHeaderSubject$.asObservable(),this.filteredTests$=X([this.tests$,this.filter$]).pipe(E(([e,i])=>e.filter(n=>(!i.onlyMine||n.IsOwner)&&(!i.hidePublished||!n.IsPublished)))),this.sortCriteria$=this.sortService.sortCriteria$,this.sortCriteria=this.sortService.sortCriteria,this.studentGrades$=X([this.course$,this.filteredTests$,this.sortCriteria$]).pipe(E(tt(this.toStudentGrades.bind(this)))),this.canSetFinalGrade$=this.course$.pipe(E(kn)),this.gradingScaleIds$=this.course$.pipe(E(e=>Ji([...(e.Tests??[]).map(i=>i.GradingScaleId),e.GradingScaleId]).filter(_e)),ae(Vt),oe(1)),this.gradingScales$=this.gradingScaleIds$.pipe(G(e=>this.gradingScalesRestService.getListForIds(e)),oe(1)),this.UNDEFINED_GRADINGSCALE_ID=-1,this.gradingScalesOptions$=this.gradingScales$.pipe(E(e=>e.map(i=>{let n=i?.Id||this.UNDEFINED_GRADINGSCALE_ID,a=i?.Grades.map(p=>({Key:p.Id,Value:p.Designation}))||[];return{id:n,options:a}}).reduce((i,n)=>B(L({},i),{[n.id]:n.options}),{})),oe(1)),this.meanOfStudentGradesForCourse$=this.studentGrades$.pipe(E(e=>Yn(fi(e)))),this.meanOfFinalGradesForCourse$=X([this.gradingScalesOptions$,this.studentGrades$]).pipe(G(tt(this.meanOfOverwrittenGradesForCourse.bind(this))))}setCourseId(e){this._courseId$.next(e)}reload(){this._courseId$.pipe(ce(1)).subscribe(e=>{this.setCourseId(e)})}setFilter(e){this.filterSubject$.next(e)}gradingOptionsForTest$(e){return this.gradingOptions$(e.GradingScaleId)}gradingOptionsForCourse$(){return this.course$.pipe(G(e=>this.gradingOptions$(e.GradingScaleId)))}toStudentGrades(e,i=[],n){let a=qn(e.ParticipatingStudents??[],i,e.Gradings??[],e.FinalGrades??[]);return n?a.sort(zn(n,i)):a}toggleHeader(e){this.expandedHeaderSubject$.next(e)}optimisticallyUpdateGrade(e){return this.course$.pipe(ce(1),E(i=>{let{originalResult:n,updatedResult:a}=this.buildOptimisticResultUpdate(i,e);return this.updateTestResult(a,null),n}))}saveGrade(e,i){this.course$.pipe(ce(1),G(n=>this.coursesRestService.updateTestResult(n.Id,e).pipe(yt(a=>(i&&this.updateTestResult(L({},i),null),bi(()=>a)))))).subscribe(({testResult:n,grading:a})=>this.updateOrDeleteTestResult(e.testId,e.studentId,n,a,"gradeId"in e?"grade":"points"))}publish(e){this.coursesRestService.publishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}unpublish(e){this.coursesRestService.unpublishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}deleteTest(e){this.action$.next({type:"delete-test",payload:e})}overwriteFinalGrade({id:e,selectedGradeId:i}){this.gradingsRestService.updateGrade(e,i).subscribe(()=>{this.action$.next({type:"final-grade-overwritten",payload:{id:e,selectedGradeId:i}})})}setAveragesAsFinalGrades(e){this.coursesRestService.setAverageAsFinalGrade(e).subscribe(i=>this.action$.next({type:"replace-grades",payload:i.Gradings}))}buildOptimisticResultUpdate(e,i){let n=fn(e,i.testId,i.studentId),a=n?L({},n):{Id:"",TestId:i.testId,StudentId:i.studentId,CourseRegistrationId:0,GradeId:null,GradeValue:null,GradeDesignation:null,Points:null};return a.GradeId="gradeId"in i?i.gradeId:n?.GradeId??null,a.Points="points"in i?i.points:n?.Points??null,{originalResult:n,updatedResult:a}}updateOrDeleteTestResult(e,i,n,a,p){n?this.updateTestResult(n,a,p):this.deleteTestResult(e,i,a)}updateTestResult(e,i,n){this.action$.next({type:"updateResult",payload:{testResult:e,grading:i??null,ignore:n}})}deleteTestResult(e,i,n){this.action$.next({type:"deleteResult",payload:{testId:e,studentId:i,grading:n}})}toggleTestPublishedState(e){this.action$.next({type:"toggle-test-state",payload:e})}gradingOptions$(e){return e===null?F(null):this.gradingScalesOptions$.pipe(E(i=>i[e]),oe(1))}meanOfOverwrittenGradesForCourse(e,i){return this.course$.pipe(E(n=>{if(n.GradingScaleId===null||e[n.GradingScaleId]===void 0)return null;let a=e[n.GradingScaleId];return Qn(fi(i),a)}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Q({token:t,factory:t.\u0275fac})}}return t})();var ei="events-evaluation-default-grade-update",dt=(()=>{class t{constructor(){this.gradingItemsRestService=u(Jt),this.evaluationStateService=u(Se),this.testStateService=u(J),this.loadingService=u(ne),this.updating=K(this.loadingService.loading(ei),{requireSync:!0})}updateDefaultGrade(e){return re(this,null,function*(){let i=this.evaluationStateService.gradingItems().map(a=>B(L({},a),{IdGrade:e})),n=this.evaluationStateService.event();if(!n)return console.error("No event selected"),!1;try{yield Ie(this.loadingService.load(this.gradingItemsRestService.updateForEvent(n.id,i),ei)),this.testStateService.reload()}catch(a){return console.error("Error updating grades",a),!1}return this.evaluationStateService.updateGradingItems(i),!0})}updateGrade(e,i){return re(this,null,function*(){let n=this.evaluationStateService.gradingItems().find(p=>p.Id===e);if(!n)return console.error("Grading item not found"),!1;let a=B(L({},n),{IdGrade:i});try{return yield Ie(this.loadingService.load(this.gradingItemsRestService.update(a),ei)),this.evaluationStateService.updateGradingItems(this.evaluationStateService.gradingItems().map(p=>p.Id===n.Id?a:p)),this.testStateService.reload(),!0}catch(p){return console.error("Error updating grade",p),!1}})}updateComment(e,i){return re(this,null,function*(){let n=this.evaluationStateService.gradingItems().find(p=>p.Id===e);if(!n)return console.error("Grading item not found"),!1;let a=B(L({},n),{Comment:i});try{return yield Ie(this.loadingService.load(this.gradingItemsRestService.updateComment(e,i),ei)),this.evaluationStateService.updateGradingItems(this.evaluationStateService.gradingItems().map(p=>p.Id===n.Id?a:p)),!0}catch(p){return console.error("Error updating comment",p),!1}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Q({token:t,factory:t.\u0275fac})}}return t})();var er=(()=>{class t{constructor(){this.activeModal=u(Ve),this.gradingScale=M.required(),this.selectedGradeKey=N(null),this.gradeOptions=P(()=>this.gradingScale().Grades.map(e=>({Key:e.Id,Value:e.Designation}))),this.selectedGrade=P(()=>{let e=this.selectedGradeKey();return this.gradingScale().Grades.find(i=>i.Id===e)??null})}updateGrades(){return re(this,null,function*(){let e=this.selectedGrade();e&&(yield this.updateService.updateDefaultGrade(e.Id).then(()=>this.activeModal.close()))})}cancel(){this.activeModal.dismiss()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-evaluation-dialog"]],inputs:{gradingScale:[1,"gradingScale"]},decls:20,vars:19,consts:[[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"dropdown-row"],["for","grade"],["id","grade",3,"valueChange","options","value","allowEmpty"],[1,"info-text"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"h5",1),d(2),c(3,"translate"),s()(),o(4,"div",2)(5,"div",3)(6,"label",4),d(7),c(8,"translate"),s(),o(9,"bkd-select",5),z("valueChange",function(p){return j(n.selectedGradeKey,p)||(n.selectedGradeKey=p),p}),s()(),o(10,"p",6),d(11),c(12,"translate"),s()(),o(13,"div",7)(14,"button",8),w("click",function(){return n.cancel()}),d(15),c(16,"translate"),s(),o(17,"button",9),w("click",function(){return n.updateGrades()}),d(18),c(19,"translate"),s()()),i&2&&(r(2),C(" ",m(3,9,"evaluation.set-default-modal.title")," "),r(5),y(m(8,11,"evaluation.set-default-modal.grade")),r(2),g("options",n.gradeOptions()),q("value",n.selectedGradeKey),g("allowEmpty",!1),r(2),C(" ",m(12,13,"evaluation.set-default-modal.message")," "),r(4),C(" ",m(16,15,"evaluation.set-default-modal.cancel")," "),r(2),g("disabled",!n.selectedGrade()||n.updateService.updating()),r(),C(" ",m(19,17,"evaluation.set-default-modal.save")," "))},dependencies:[ye,I],styles:[".dropdown-row[_ngcontent-%COMP%]{display:flex;align-items:center}.dropdown-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{flex:1}.dropdown-row[_ngcontent-%COMP%]   bkd-select[_ngcontent-%COMP%]{flex:1}.info-text[_ngcontent-%COMP%]{margin-top:1.5rem}"],changeDetection:0})}}return t})();var tr=t=>({returnlink:t}),da=t=>({count:t});function ca(t,l){if(t&1&&(o(0,"a",4)(1,"i",7),d(2,"bar_chart"),s()()),t&2){let e=h(2);g("routerLink","statistic")("queryParams",V(2,tr,e.queryParam()))}}function pa(t,l){if(t&1&&(o(0,"div",1),b(1,ca,3,4,"a",4),_(2,"bkd-reports-link",5)(3,"div",6),s()),t&2){let e=h();r(),f(e.event().gradingScaleId!==null?1:-1),r(),g("reports",e.reports())}}var ti=(()=>{class t{constructor(){this.reportsService=u(nt),this.route=u(he),this.event=M.required(),this.showActions=M(!0),this.queryParam=N(this.route.snapshot.queryParamMap.get("returnlink")),this.reports=K($e(this.event).pipe(E(e=>e.id),ae(),G(e=>e?this.reportsService.getEvaluationReports(e):F([])),je([]))),this.returnlink=P(()=>this.showActions()?this.queryParam()?this.queryParam():"/events":`/events/${this.event().id}/evaluation`)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-evaluation-header"]],inputs:{event:[1,"event"],showActions:[1,"showActions"]},decls:9,vars:12,consts:[[3,"link","params"],[1,"d-flex"],[1,"d-flex","flex-column","header"],[1,"additional-info"],[1,"btn","btn-primary","btn-icon",3,"routerLink","queryParams"],[1,"ms-2",3,"reports"],["id","excel-import"],[1,"material-icons"]],template:function(i,n){if(i&1&&(o(0,"bkd-backlink",0),b(1,pa,4,2,"div",1),s(),o(2,"div",2)(3,"h1"),d(4),s(),o(5,"div",3),$(6),d(7),c(8,"translate"),s()()),i&2){g("link",n.returnlink())("params",n.queryParam()&&n.queryParam()!==n.returnlink()?V(8,tr,n.queryParam()):null),r(),f(n.showActions()?1:-1),r(3),y(n.event().designation);let a=n.event().studentCount;r(3),C(" ",H(8,5,a===1?"courses.registration":"courses.registrations",V(10,da,a))," ")}},dependencies:[Re,I,it,Z],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem;border-bottom:1px solid #dee2e6}h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}a[_ngcontent-%COMP%]{text-decoration:none;color:#fff}"],changeDetection:0})}}return t})();var ir=(()=>{class t{constructor(){this.value=le(null),this.disabled=M(!1),this.commit=ke()}onInput(e){let{value:i}=e.target;this.value.set(i||null)}onBlur(){this.commit.emit(this.value()??null)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-grading-item-comment-textarea"]],inputs:{value:[1,"value"],disabled:[1,"disabled"]},outputs:{value:"valueChange",commit:"commit"},decls:1,vars:2,consts:[["bkdTextareaAutosize","",1,"form-control",3,"input","blur","value","disabled"]],template:function(i,n){i&1&&(o(0,"textarea",0),w("input",function(p){return n.onInput(p)})("blur",function(){return n.onBlur()}),s()),i&2&&g("value",n.value()||"")("disabled",n.disabled())},dependencies:[In],styles:["[_nghost-%COMP%]{display:block}@media (max-width: 810px){textarea[_ngcontent-%COMP%]{min-width:auto}}"],changeDetection:0})}}return t})();var ma=576,Ae=(()=>{class t{constructor(){this.portal=u(wn),this.inlineHeader=M.required(),this.stickyHeader=M.required(),this.handleWindowScroll=()=>{this.updateStickyVisibility(),this.updateStickyTopOffset()},this.handleWindowResize=()=>{this.updateStickyWidth(),this.updateStickyVisibility(),this.updateStickyTopOffset()},this.handleTableScroll=()=>{this.updateStickyLeftOffset()}}ngAfterViewInit(){this.handleWindowScroll(),this.handleTableScroll(),this.handleWindowResize(),this.window.addEventListener("scroll",this.handleWindowScroll),this.getTableScrollContainer()?.addEventListener("scroll",this.handleTableScroll),this.window.addEventListener("resize",this.handleWindowResize)}ngOnDestroy(){this.window.removeEventListener("scroll",this.handleWindowScroll),this.getTableScrollContainer()?.removeEventListener("scroll",this.handleTableScroll),this.window.removeEventListener("resize",this.handleWindowResize)}refresh(){setTimeout(()=>this.updateStickyWidth())}get window(){return this.portal.window??window}getTableScrollContainer(){return document.querySelector(".table-responsive-wrapper")??null}updateStickyVisibility(){if(this.isSmallBreakpointDown())return;let e=this.inlineHeader().getTop()+this.getIframeScrollY();this.stickyHeader().shown.set(this.getScrollTop()>e)}updateStickyTopOffset(){this.isSmallBreakpointDown()||this.stickyHeader().setTopOffset(this.portal.inIframe?this.getScrollTop():0)}updateStickyLeftOffset(){this.isSmallBreakpointDown()||this.stickyHeader().setLeftOffset(this.inlineHeader().getLeft())}updateStickyWidth(){this.isSmallBreakpointDown()||(this.stickyHeader().setWidth(this.inlineHeader().getWidth()),this.stickyHeader().setColumnWidths(this.inlineHeader().getColumnWidths()),this.stickyHeader().setStickyColumnHeights(this.inlineHeader().getStickyColumnsHeights()))}getScrollTop(){return this.window.scrollY-this.portal.getIframeTop()}getIframeScrollY(){return window.scrollY}isSmallBreakpointDown(){return window.innerWidth<ma}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=Ii({type:t,selectors:[["","bkdTableHeaderSticky",""]],inputs:{inlineHeader:[1,"inlineHeader"],stickyHeader:[1,"stickyHeader"]}})}}return t})();var ua=(t,l)=>l.detail.Id;function ha(t,l){if(t&1){let e=D();o(0,"bkd-subscription-detail-field",4),z("valueChange",function(n){let a=x(e).$implicit;return j(a.value,n)||(a.value=n),T(n)}),w("commit",function(){let n=x(e).$implicit,a=h(2);return T(a.subscriptionDetailChange.emit(n))}),s()}if(t&2){let e=l.$implicit;g("detail",e.detail)("layout","horizontal"),q("value",e.value)}}function ga(t,l){if(t&1&&(o(0,"div",2),R(1,ha,1,3,"bkd-subscription-detail-field",3,ua),s()),t&2){let e=h();r(),A(e.entry().criteria)}}var nr=(()=>{class t{constructor(){this.entry=M.required(),this.visible=le.required(),this.subscriptionDetailChange=ke()}get visibleClass(){return this.visible()}toggle(){this.visible.update(e=>!e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-evaluation-criteria"]],hostVars:2,hostBindings:function(i,n){i&2&&Y("criteria-visible",n.visibleClass)},inputs:{entry:[1,"entry"],visible:[1,"visible"]},outputs:{visible:"visibleChange",subscriptionDetailChange:"subscriptionDetailChange"},decls:6,vars:2,consts:[[1,"btn","btn-link","criteria-toggle",3,"click"],[1,"material-icons"],[1,"criteria-container"],[3,"detail","layout","value"],[3,"valueChange","commit","detail","layout","value"]],template:function(i,n){i&1&&(o(0,"button",0),w("click",function(){return n.toggle()}),o(1,"i",1),d(2),s(),o(3,"span"),d(4,"Kriterien beurteilen"),s()(),b(5,ga,3,0,"div",2)),i&2&&(r(2),y(n.visible()?"keyboard_arrow_up":"keyboard_arrow_down"),r(3),f(n.visible()?5:-1))},dependencies:[Yt],styles:["[_nghost-%COMP%]{display:block;padding:0 1rem 1rem}.criteria-toggle[_ngcontent-%COMP%]{display:flex;padding-left:0;padding-right:0;color:#00000080}.criteria-toggle[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.25rem}.criteria-toggle[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.criteria-toggle[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.criteria-container[_ngcontent-%COMP%]{margin-top:1rem;display:flex;flex-direction:column;gap:1rem}@media (min-width: 811px){[_nghost-%COMP%]:not(.criteria-visible){padding:0}.criteria-toggle[_ngcontent-%COMP%]{display:none}.criteria-container[_ngcontent-%COMP%]{margin-top:0;gap:.5rem}}"],changeDetection:0})}}return t})();var rr=(()=>{class t{constructor(){this.http=u(Ee),this.settings=u(ge),this.loadingService=u(ne),this.baseUrl=`${this.settings.apiUrl}/StatusProcesses/`}forwardStatus(e,i){return re(this,null,function*(){try{let n=yield Ie(this.loadingService.load(this.getStatus(e),Pe));return n?(yield Ie(this.loadingService.load(this.updateStatus(n,i),Pe)),!0):(console.error("No next status found"),!1)}catch(n){return console.error("Error updating status",n),!1}})}getStatus(e){return this.http.get(`${this.baseUrl}forward/`,{params:new ut().set("idStatus",e.toString())}).pipe(E(i=>Array.isArray(i)&&i.length>0?i[0]:null))}updateStatus(e,i){return this.http.post(this.baseUrl,B(L({},e),{DataClassId:"Anlass",Id1:i}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Q({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function fa(t,l){t&1&&(o(0,"div",3)(1,"i",8),d(2,"info"),s(),o(3,"p",9),d(4),c(5,"translate"),s()()),t&2&&(r(4),C(" ",m(5,1,"evaluation.finalise-modal.open-evaluations")," "))}function Ca(t,l){t&1&&(o(0,"p",4),d(1),c(2,"translate"),s()),t&2&&(r(),C(" ",m(2,1,"evaluation.finalise-modal.note")," "))}var va=3,ar=(()=>{class t{constructor(){this.activeModal=u(Ve),this.eventsService=u(at),this.loadingService=u(ne),this.evaluationStatusService=u(rr),this.eventId=N(null),this.hasOpenEvaluations=N(!1),this.loading=K(this.loadingService.loading(Pe),{initialValue:!0}),this.eventSummary=K($e(this.eventId).pipe(G(e=>e?this.loadEventSummary(e):F(null))),{initialValue:null}),this.isModuleEvent=P(()=>this.eventSummary()?.EventTypeId===va)}loadEventSummary(e){return this.loadingService.load(this.eventsService.getEventSummary(e),Pe)}cancel(){this.activeModal.dismiss()}confirm(){return re(this,null,function*(){this.isModuleEvent()?yield this.updateModuleEventStatus():this.activeModal.close(!0)})}updateModuleEventStatus(){return re(this,null,function*(){let e=this.eventSummary();if(!e)throw new Error("No event available");try{yield this.evaluationStatusService.forwardStatus(e.StatusId,e.Id),this.activeModal.close(!0)}catch(i){console.error("Error updating module event status",i),this.activeModal.close(!1)}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-evaluation-finalise-dialog"]],decls:17,vars:15,consts:[[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"text-danger","d-flex","my-3"],[1,"module-event-notice"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"material-icons","me-2"],[1,"mb-0"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"h5",1),d(2),c(3,"translate"),s()(),o(4,"div",2),b(5,fa,6,3,"div",3),o(6,"p"),d(7),c(8,"translate"),s(),b(9,Ca,3,3,"p",4),s(),o(10,"div",5)(11,"button",6),w("click",function(){return n.cancel()}),d(12),c(13,"translate"),s(),o(14,"button",7),w("click",function(){return n.confirm()}),d(15),c(16,"translate"),s()()),i&2&&(r(2),C(" ",m(3,7,"evaluation.finalise-modal.title")," "),r(3),f(n.hasOpenEvaluations()?5:-1),r(2),C(" ",m(8,9,"evaluation.finalise-modal.message")," "),r(2),f(n.isModuleEvent()?9:-1),r(3),C(" ",m(13,11,"evaluation.finalise-modal.cancel")," "),r(2),g("disabled",n.loading()),r(),C(" ",m(16,13,"evaluation.finalise-modal.confirm")," "))},dependencies:[I],encapsulation:2,changeDetection:0})}}return t})();var _a=1e3,or=(()=>{class t{constructor(){this.options=M.required(),this.value=M.required(),this.valueChange=ke(),this.valueSubject=new se,this.destroy$=new se,this.valueSubject.pipe(St(_a),we(this.destroy$)).subscribe(e=>{this.valueChange.emit(e)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onValueChange(e){this.valueSubject.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-evaluation-grade"]],inputs:{options:[1,"options"],value:[1,"value"]},outputs:{valueChange:"valueChange"},decls:1,vars:2,consts:[["id","grade",3,"valueChange","options","value"]],template:function(i,n){i&1&&(o(0,"bkd-select",0),w("valueChange",function(p){return n.onValueChange(p)}),s()),i&2&&g("options",n.options())("value",n.value())},dependencies:[ye],encapsulation:2,changeDetection:0})}}return t})();var ii=(()=>{class t{get stickyClass(){return this.sticky()}constructor(){this.element=u(Pi),this.sticky=M(!1),this.shown=N(!1),Mt(this.updateShownClass.bind(this))}getTop(){return this.element.nativeElement.getBoundingClientRect().top}getLeft(){return this.element.nativeElement.getBoundingClientRect().left}setTopOffset(e){this.element.nativeElement.style.top=`${e}px`}setLeftOffset(e){this.element.nativeElement.style.left=`${e}px`}getWidth(){return this.element.nativeElement.getBoundingClientRect().width}setWidth(e){this.element.nativeElement.style.width=`${e}px`}getColumnWidths(){return this.getRowsAndColumns().map(e=>e.map(i=>i.getBoundingClientRect().width))}setColumnWidths(e){let i=this.getRowsAndColumns();if(i.length!==e.length||!i.every((n,a)=>n.length===e[a].length))throw new Error("Given column widths do not match number of header rows/columns");i.forEach((n,a)=>n.forEach((p,S)=>{p.style.width=`${e[a][S]}px`,p.style.minWidth=`${e[a][S]}px`}))}getStickyColumnsHeights(){return this.getRowsAndColumns(".sticky").map(e=>e.map(i=>i.getBoundingClientRect().height))}setStickyColumnHeights(e){let i=this.getRowsAndColumns(".sticky");if(i.length!==e.length||!i.every((n,a)=>n.length===e[a].length))throw new Error("Given column heights do not match number of sticky header columns");i.forEach((n,a)=>n.forEach((p,S)=>{p.style.height=`${e[a][S]}px`})),this.getRows().forEach((n,a)=>{let p=e[a].reduce((S,W)=>Math.max(S,W),0);n.style.height=`${p}px`})}updateShownClass(){let e=this.element.nativeElement.classList;this.shown()?e.add("shown"):e.remove("shown")}getRowsAndColumns(e){return this.getRows().map(i=>Array.from(i.querySelectorAll(`th:not(.header-mobile)${e??""}`)))}getRows(){return Array.from(this.element.nativeElement.querySelectorAll("tr"))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["ng-component"]],hostVars:2,hostBindings:function(i,n){i&2&&Y("sticky",n.stickyClass)},inputs:{sticky:[1,"sticky"]},decls:0,vars:0,template:function(i,n){},encapsulation:2})}}return t})();var ba=["bkdEvaluationTableHeader",""],ya=(t,l)=>l.vssId;function Sa(t,l){if(t&1){let e=D();o(0,"th",5)(1,"bkd-sortable-header",1),c(2,"translate"),z("sortCriteriaChange",function(n){x(e);let a=h();return j(a.sortCriteria,n)||(a.sortCriteria=n),T(n)}),s()()}if(t&2){let e=h();Y("selected",e.gradeColumnSelected()),r(),g("label",m(2,5,"evaluation.columns.grade"))("sortKey","grade"),q("sortCriteria",e.sortCriteria)}}function xa(t,l){if(t&1&&(o(0,"th",6),d(1),s()),t&2){let e,i=l.$implicit,n=h();Y("selected",n.isColumnSelected(i)),g("title",(e=i.tooltip)!==null&&e!==void 0?e:""),r(),C(" ",i.title," ")}}function Ta(t,l){if(t&1&&(o(0,"th",7),d(1),c(2,"translate"),s()),t&2){let e=h();Y("selected",e.commentColumnSelected()),r(),C(" ",m(2,3,"evaluation.columns.comment")," ")}}var sr=(()=>{class t extends ii{constructor(){super(...arguments),this.columns=M.required(),this.sortCriteria=le.required(),this.selectedColumn=M.required(),this.hasGrades=M.required(),this.hasGradeComments=M(!1),this.gradeColumnSelected=P(()=>this.selectedColumn()===-1),this.commentColumnSelected=P(()=>this.selectedColumn()===-2)}isColumnSelected(e){return e.vssId===this.selectedColumn()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=Tt(t)))(n||t)}})()}static{this.\u0275cmp=v({type:t,selectors:[["thead","bkdEvaluationTableHeader",""]],inputs:{columns:[1,"columns"],sortCriteria:[1,"sortCriteria"],selectedColumn:[1,"selectedColumn"],hasGrades:[1,"hasGrades"],hasGradeComments:[1,"hasGradeComments"]},outputs:{sortCriteria:"sortCriteriaChange"},features:[Et],attrs:ba,decls:8,vars:7,consts:[[1,"student-name"],[3,"sortCriteriaChange","label","sortKey","sortCriteria"],[1,"student-grade","desktop",3,"selected"],[1,"subscription-detail",3,"selected","title"],[1,"student-comment","desktop",3,"selected"],[1,"student-grade","desktop"],[1,"subscription-detail",3,"title"],[1,"student-comment","desktop"]],template:function(i,n){i&1&&(o(0,"tr")(1,"th",0)(2,"bkd-sortable-header",1),c(3,"translate"),z("sortCriteriaChange",function(p){return j(n.sortCriteria,p)||(n.sortCriteria=p),p}),s()(),b(4,Sa,3,7,"th",2),R(5,xa,2,4,"th",3,ya),b(7,Ta,3,5,"th",4),s()),i&2&&(r(2),g("label",m(3,5,"evaluation.columns.name"))("sortKey","name"),q("sortCriteria",n.sortCriteria),r(2),f(n.hasGrades()?4:-1),r(),A(n.columns()),r(2),f(n.hasGradeComments()?7:-1))},dependencies:[I,ot],styles:["[_nghost-%COMP%]{--spacer: 16px;--grade-input-size: 127px;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--subscription-detail-columns-offset: var(--student-name-column-width)}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (max-width: 810px){th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%], th.subscription-detail[_ngcontent-%COMP%], td.subscription-detail[_ngcontent-%COMP%]{width:66%;min-width:66%;max-width:66%}}@media (max-width: 500px){th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%], th.subscription-detail[_ngcontent-%COMP%], td.subscription-detail[_ngcontent-%COMP%]{width:50%;min-width:50%;max-width:50%}}th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-comment[_ngcontent-%COMP%]:not(.selected), .subscription-detail[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%], tfoot[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.student-grade[_ngcontent-%COMP%], .subscription-detail[_ngcontent-%COMP%], .student-comment[_ngcontent-%COMP%]{flex:none;display:block;width:50%}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}}.sticky[_nghost-%COMP%]{position:fixed;top:0;left:0;z-index:1000;display:none}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;vertical-align:top}tr[_ngcontent-%COMP%]   th.subscription-detail.absences[_ngcontent-%COMP%]{flex:1}@media (min-width: 811px){.sticky.shown[_nghost-%COMP%]{display:table-header-group}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;padding-top:.25rem;padding-bottom:.25rem;border-top:initial}}"],changeDetection:0})}}return t})();var wa=t=>["student",t,"grades"],Ea=(t,l)=>l.gradingItem.Id,Pa=(t,l)=>l.vssId;function Ia(t,l){if(t&1){let e=D();o(0,"button",18),w("click",function(){x(e);let n=h().$implicit,a=h();return T(a.toggleCriteria(n))}),o(1,"i",19),d(2),s()()}if(t&2){let e=h().$implicit,i=h();r(2),y(i.isCriteriaVisible(e)()?"keyboard_arrow_up":"keyboard_arrow_down")}}function Ma(t,l){t&1&&(o(0,"span",16),d(1),c(2,"translate"),s()),t&2&&(r(),C(" ",m(2,1,"evaluation.required")," "))}function ka(t,l){if(t&1){let e=D();o(0,"td",20)(1,"bkd-evaluation-grade",21),w("valueChange",function(n){x(e);let a=h().$implicit,p=h();return T(p.updateGrade(n,a.gradingItem.Id))}),s()()}if(t&2){let e=h().$implicit,i=h();Y("selected",i.gradeColumnSelected()),r(),g("options",i.gradeOptions())("value",e.gradingItem.IdGrade)}}function Oa(t,l){if(t&1){let e=D();$(0),o(1,"bkd-subscription-detail-field",24),z("valueChange",function(n){x(e);let a=O(0);return j(a,n),T(n)}),w("commit",function(){x(e);let n=h().$implicit,a=h(2);return T(a.subscriptionDetailChange.emit(n))}),s()}if(t&2){let e=h().$implicit,i=U(h(2).getDetailValue(e));r(),g("detail",e.detail)("hideLabel",!0)("layout","horizontal"),q("value",i)}}function Da(t,l){if(t&1&&(o(0,"td",22),b(1,Oa,2,5,"bkd-subscription-detail-field",23),s()),t&2){let e=l.$implicit,i=h(2);Y("selected",i.isColumnSelected(e)),r(),f(e?1:-1)}}function Ga(t,l){if(t&1){let e=D();o(0,"td",25)(1,"bkd-grading-item-comment-textarea",26),z("valueChange",function(n){x(e);let a=h().$implicit;return j(a.gradingItem.Comment,n)||(a.gradingItem.Comment=n),T(n)}),w("commit",function(n){x(e);let a=h().$implicit,p=h();return T(p.updateComment(n,a.gradingItem.Id))}),s()()}if(t&2){let e=h().$implicit,i=h();Y("selected",i.commentColumnSelected()),r(),q("value",e.gradingItem.Comment),g("disabled",i.gradingItemUpdateService.updating())}}function La(t,l){if(t&1){let e=D();o(0,"tr",17)(1,"td"),$(2),o(3,"bkd-evaluation-criteria",27),z("visibleChange",function(n){x(e);let a=O(2);return j(a,n),T(n)}),w("subscriptionDetailChange",function(n){x(e);let a=h(2);return T(a.subscriptionDetailChange.emit(n))}),s()()()}if(t&2){let e=h().$implicit,i=h();r(),pe("colspan",i.totalColumns()),r();let n=U(i.isCriteriaVisible(e));r(),g("entry",e),q("visible",n)}}function Fa(t,l){if(t&1){let e=D();o(0,"tr",12),w("click",function(n){x(e);let a=h();return T(a.onRowClick(n))}),o(1,"td",6)(2,"div",13),b(3,Ia,3,1,"button",14),o(4,"a",15)(5,"span"),d(6),s(),b(7,Ma,3,3,"span",16),s()()(),b(8,ka,2,4,"td",7),R(9,Da,2,3,"td",8,ki),b(11,Ga,2,4,"td",9),s(),b(12,La,4,4,"tr",17)}if(t&2){let e=l.$implicit,i=h();r(3),f(e.criteria.length>0?3:-1),r(),g("routerLink",V(7,wa,e.gradingItem.IdPerson)),r(2),y(e.gradingItem.PersonFullname),r(),f(e.evaluationRequired?7:-1),r(),f(i.hasGrades()?8:-1),r(),A(e.columns),r(2),f(i.hasGradeComments()?11:-1),r(),f(e.criteria.length>0?12:-1)}}function $a(t,l){if(t&1&&(o(0,"td",20),d(1),c(2,"decimalOrDash"),s()),t&2){let e=h();Y("selected",e.gradeColumnSelected()),r(),C(" ",H(2,3,e.gradesAverage(),"1-3")," ")}}function Va(t,l){if(t&1&&_(0,"td",22),t&2){let e=l.$implicit,i=h();Y("selected",i.isColumnSelected(e))}}function Ba(t,l){if(t&1&&_(0,"td",25),t&2){let e=h();Y("selected",e.commentColumnSelected())}}var lr=(()=>{class t{constructor(){this.state=u(Se),this.gradingItemUpdateService=u(dt),this.subscriptionDetailUpdateService=u(lt),this.modalService=u(Be),this.router=u(Fe),this.sortCriteria=le.required(),this.selectedColumn=M.required(),this.columns=M.required(),this.entries=M.required(),this.hasGrades=M.required(),this.hasGradeComments=M.required(),this.subscriptionDetailChange=ke(),this.gradingScale=M.required(),this.gradeColumnSelected=P(()=>this.selectedColumn()===-1),this.commentColumnSelected=P(()=>this.selectedColumn()===-2),this.gradesAverage=P(()=>this.getGradesAverage(this.entries())),this.totalColumns=P(()=>1+(this.hasGrades()?1:0)+(this.hasGradeComments()?1:0)+this.columns().length),this.hasPendingRequests=P(()=>this.gradingItemUpdateService.updating()||this.subscriptionDetailUpdateService.updating()),this.criteriaVisibilities=We({source:this.entries,computation:(e,i)=>e.reduce((n,a)=>{let p=i?.value&&i.value[a.gradingItem.Id]||N(!1);return B(L({},n),{[a.gradingItem.Id]:p})},{})}),this.sticky=wt(Ae),this.gradeOptions=P(()=>this.gradingScale()?.Grades.map(e=>({Key:e.Id,Value:e.Designation}))),Mt(()=>{this.columns(),this.sticky()?.refresh()})}isColumnSelected(e){return e?this.getColumnKey(e)===this.selectedColumn():!1}getDetailValue(e){return e?e.value??N(null):N(null)}isCriteriaVisible(e){return this.criteriaVisibilities()[e.gradingItem.Id]??N(!1)}toggleCriteria(e){this.criteriaVisibilities()[e.gradingItem.Id]?.update(i=>!i)}onRowClick(e){let i=e.target;i.tagName==="TD"&&i.closest("tr")?.querySelector("button.criteria-toggle")?.click()}getColumnKey(e){return"detail"in e?e.detail.VssId:e.vssId}getGradesAverage(e){let i=e.map(({grade:n})=>n?.Value).filter(n=>n!=null&&n!==0);return Ct(i)}updateGrade(e,i){return re(this,null,function*(){yield this.gradingItemUpdateService.updateGrade(i,e)})}updateComment(e,i){return re(this,null,function*(){yield this.gradingItemUpdateService.updateComment(i,e)})}openFinaliseEvaluationDialog(){let e=this.modalService.open(ar),i=e.componentInstance;i.eventId.set(this.state.event()?.id??null);let n=this.entries().some(a=>a.evaluationRequired);i.hasOpenEvaluations.set(n),e.result.then(a=>re(this,null,function*(){a&&(yield this.router.navigate(["events"]))}),()=>{})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-evaluation-table"]],viewQuery:function(i,n){i&1&&Pt(n.sticky,Ae,5),i&2&&It()},inputs:{sortCriteria:[1,"sortCriteria"],selectedColumn:[1,"selectedColumn"],columns:[1,"columns"],entries:[1,"entries"],hasGrades:[1,"hasGrades"],hasGradeComments:[1,"hasGradeComments"],gradingScale:[1,"gradingScale"]},outputs:{sortCriteria:"sortCriteriaChange",subscriptionDetailChange:"subscriptionDetailChange"},decls:22,vars:24,consts:[["inlineHeader",""],["stickyHeader",""],[1,"table-responsive-wrapper"],["bkdTableHeaderSticky","",1,"table","table-hover","h-100",3,"inlineHeader","stickyHeader"],["bkdEvaluationTableHeader","",3,"sortCriteriaChange","columns","sortCriteria","selectedColumn","hasGrades","hasGradeComments"],["bkdEvaluationTableHeader","",3,"sortCriteriaChange","sticky","columns","sortCriteria","selectedColumn","hasGrades","hasGradeComments"],[1,"student-name"],[1,"student-grade",3,"selected"],[1,"subscription-detail",3,"selected"],[1,"student-comment",3,"selected"],[1,"action-buttons"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[3,"click"],[1,"d-flex"],[1,"btn","btn-link","criteria-toggle"],[3,"routerLink"],[1,"open-evaluations"],[1,"criteria"],[1,"btn","btn-link","criteria-toggle",3,"click"],[1,"material-icons"],[1,"student-grade"],[3,"valueChange","options","value"],[1,"subscription-detail"],[3,"detail","hideLabel","layout","value"],[3,"valueChange","commit","detail","hideLabel","layout","value"],[1,"student-comment"],[3,"valueChange","commit","value","disabled"],[3,"visibleChange","subscriptionDetailChange","entry","visible"]],template:function(i,n){if(i&1){let a=D();o(0,"div",2)(1,"table",3)(2,"thead",4,0),z("sortCriteriaChange",function(S){return x(a),j(n.sortCriteria,S)||(n.sortCriteria=S),T(S)}),s(),o(4,"thead",5,1),z("sortCriteriaChange",function(S){return x(a),j(n.sortCriteria,S)||(n.sortCriteria=S),T(S)}),s(),o(6,"tbody"),R(7,Fa,13,9,null,null,Ea),s(),o(9,"tfoot")(10,"tr")(11,"td",6),d(12),c(13,"translate"),s(),b(14,$a,3,6,"td",7),R(15,Va,1,2,"td",8,Pa),b(17,Ba,1,2,"td",9),s()()(),o(18,"div",10)(19,"button",11),w("click",function(){return x(a),T(n.openFinaliseEvaluationDialog())}),d(20),c(21,"translate"),s()()()}if(i&2){let a=xe(3),p=xe(5);r(),g("inlineHeader",a)("stickyHeader",p),r(),g("columns",n.columns()),q("sortCriteria",n.sortCriteria),g("selectedColumn",n.selectedColumn())("hasGrades",n.hasGrades())("hasGradeComments",n.hasGradeComments()),r(2),g("sticky",!0)("columns",n.columns()),q("sortCriteria",n.sortCriteria),g("selectedColumn",n.selectedColumn())("hasGrades",n.hasGrades())("hasGradeComments",n.hasGradeComments()),r(3),A(n.entries()),r(5),C(" ",m(13,20,"evaluation.average")," "),r(2),f(n.hasGrades()?14:-1),r(),A(n.columns()),r(2),f(n.hasGradeComments()?17:-1),r(),Y("mobile-finalise-visible",n.gradeColumnSelected()||!n.hasGrades()),r(),g("disabled",n.hasPendingRequests()),r(),C(" ",m(21,22,"evaluation.finalise")," ")}},dependencies:[Z,I,sr,Ae,jt,Yt,nr,or,ir],styles:["[_nghost-%COMP%]{--spacer: 16px;--grade-input-size: 127px;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--subscription-detail-columns-offset: var(--student-name-column-width)}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (max-width: 810px){th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%], th.subscription-detail[_ngcontent-%COMP%], td.subscription-detail[_ngcontent-%COMP%]{width:66%;min-width:66%;max-width:66%}}@media (max-width: 500px){th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%], th.subscription-detail[_ngcontent-%COMP%], td.subscription-detail[_ngcontent-%COMP%]{width:50%;min-width:50%;max-width:50%}}th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-comment[_ngcontent-%COMP%]:not(.selected), .subscription-detail[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%], tfoot[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.student-grade[_ngcontent-%COMP%], .subscription-detail[_ngcontent-%COMP%], .student-comment[_ngcontent-%COMP%]{flex:none;display:block;width:50%}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}}[_nghost-%COMP%]{border-top:1px solid #dee2e6;display:block}td[_ngcontent-%COMP%]{vertical-align:top}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]{padding-top:1.25rem}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;flex-direction:column;text-decoration:none}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{text-decoration:underline}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   .open-evaluations[_ngcontent-%COMP%]{color:#ea161f;font-size:.875rem;line-height:normal}tr.criteria[_ngcontent-%COMP%]:hover > *[_ngcontent-%COMP%]{--bs-table-bg-state: $table-body-bg}tr.criteria[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:0;width:100%}tr.criteria[_ngcontent-%COMP%]   td[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}tr[_ngcontent-%COMP%]:has(+tr.criteria)   td[_ngcontent-%COMP%]{border-bottom:0}button.criteria-toggle[_ngcontent-%COMP%]{display:none}.action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:1rem;padding-right:1rem}@media (min-width: 811px){.table-responsive-wrapper[_ngcontent-%COMP%]{display:block;overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.action-buttons[_ngcontent-%COMP%]{position:sticky;left:0}tr.criteria[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{width:auto}button.criteria-toggle[_ngcontent-%COMP%]{display:block;margin:-.5rem 0 -.5rem -.5rem;padding:.5rem;cursor:pointer}  bkd-subscription-detail-label{min-width:auto!important;width:calc(var(--subscription-detail-columns-offset) - 1rem)!important}}@media (max-width: 810px){.action-buttons[_ngcontent-%COMP%]:not(.mobile-finalise-visible){display:none}}"],changeDetection:0})}}return t})();var Ra=t=>({"grade-column-selected":t});function Aa(t,l){t&1&&_(0,"bkd-spinner")}function Ha(t,l){t&1&&(o(0,"p",1),d(1),c(2,"translate"),s()),t&2&&(r(),y(m(2,1,"evaluation.no-event")))}function Wa(t,l){t&1&&(o(0,"p",1),d(1),c(2,"translate"),s()),t&2&&(r(),y(m(2,1,"evaluation.no-items")))}function Na(t,l){t&1&&(o(0,"p",1),d(1),c(2,"translate"),s()),t&2&&(r(),y(m(2,1,"evaluation.no-evaluation")))}function ja(t,l){if(t&1){let e=D();o(0,"bkd-select",6),z("valueChange",function(n){x(e);let a=h(4);return j(a.selectedColumn,n)||(a.selectedColumn=n),T(n)}),s()}if(t&2){let e=h(4);g("options",e.columnOptions()),q("value",e.selectedColumn),g("allowEmpty",!1)}}function Ua(t,l){if(t&1){let e=D();o(0,"a",7),w("click",function(){x(e);let n=h(4);return T(n.openDefaultGradeDialog())}),o(1,"i",8),d(2,"edit"),s(),o(3,"span"),d(4),c(5,"translate"),s()()}if(t&2){let e=h(4);g("ngClass",V(4,Ra,e.selectedColumn()===e.GRADE_COLUMN)),r(4),y(m(5,2,"evaluation.set-default-modal.title"))}}function qa(t,l){if(t&1){let e=D();b(0,ja,1,3,"bkd-select",3)(1,Ua,6,6,"a",4),o(2,"bkd-evaluation-table",5),z("sortCriteriaChange",function(n){x(e);let a=h(3);return j(a.state.sortCriteria,n)||(a.state.sortCriteria=n),T(n)}),w("subscriptionDetailChange",function(n){x(e);let a=h(3);return T(a.updateSubscriptionDetail(n))}),s()}if(t&2){h();let e=O(1),i=h(2);f(i.columnOptions().length>1?0:-1),r(),f(i.hasGrades()?1:-1),r(),q("sortCriteria",i.state.sortCriteria),g("columns",i.state.columns())("entries",e)("selectedColumn",i.selectedColumn())("hasGrades",i.hasGrades())("hasGradeComments",i.hasGradeComments())("gradingScale",i.state.gradingScale())}}function za(t,l){if(t&1&&(_(0,"bkd-evaluation-header",2),$(1),b(2,Wa,3,3,"p",1)(3,Na,3,3,"p",1)(4,qa,3,9)),t&2){let e=h(2),i=O(0);g("event",i),r();let n=U(e.state.entries());r(),f(n.length===0?2:e.state.noEvaluation()?3:4)}}function Ka(t,l){if(t&1&&b(0,za,5,3),t&2){h();let e=O(0);f(e?0:-1)}}var dr=(()=>{class t{constructor(){this.state=u(Se),this.updateDefaultGradeService=u(dt),this.updateSubscriptionDetailService=u(lt),this.translate=u(ie),this.modalService=u(Be),this.GRADE_COLUMN=-1,this.hasGrades=P(()=>this.state.gradingScale()!==null),this.hasGradeComments=P(()=>this.state.gradingScale()?.CommentsAllowed===!0),this.columnOptions=P(()=>{let e={Key:-1,Value:this.translate.instant("evaluation.columns.grade")},i={Key:-2,Value:this.translate.instant("evaluation.columns.comment")},n=Bt(this.state.columns().map(({vssId:a,title:p})=>({Key:a,Value:p})),a=>a.Key);return[this.hasGrades()?e:null,...n,this.hasGradeComments()?i:null].filter(_e)}),this.selectedColumn=We({source:this.columnOptions,computation:(e,i)=>{let n=i?.source,a=i?.value;return Vt(e,n)&&a&&e.find(p=>p.Key===a)?a:e.length>0?Number(e[0].Key):null}})}openDefaultGradeDialog(){let e=this.modalService.open(er);e.componentInstance.gradingScale=this.state.gradingScale,e.componentInstance.updateService=this.updateDefaultGradeService,e.result.then(()=>{},()=>{})}updateSubscriptionDetail(e){this.updateSubscriptionDetailService.updateSubscriptionDetail(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-evaluation-list"]],decls:5,vars:2,consts:[[1,"bkd-container"],[1,"mt-3","px-3"],[3,"event"],["width","100%",1,"columns-dropdown",3,"options","value","allowEmpty"],[1,"set-default","btn","btn-link","my-1",3,"ngClass"],[3,"sortCriteriaChange","subscriptionDetailChange","sortCriteria","columns","entries","selectedColumn","hasGrades","hasGradeComments","gradingScale"],["width","100%",1,"columns-dropdown",3,"valueChange","options","value","allowEmpty"],[1,"set-default","btn","btn-link","my-1",3,"click","ngClass"],[1,"material-icons"]],template:function(i,n){if(i&1&&($(0),o(1,"div",0),b(2,Aa,1,0,"bkd-spinner")(3,Ha,3,3,"p",1)(4,Ka,1,1),s()),i&2){let a=U(n.state.event());r(2),f(n.state.loading()?2:a?4:3)}},dependencies:[I,ti,lr,fe,ye,ue],styles:[".columns-dropdown[_ngcontent-%COMP%]{display:block;padding:1rem 0}.set-default[_ngcontent-%COMP%]{color:#00000080;padding-right:1.5rem;display:flex;text-decoration:none;padding-left:1rem}.set-default[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.set-default[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.set-default[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.3em}@media (min-width: 811px){.columns-dropdown[_ngcontent-%COMP%]{display:none}}@media (max-width: 810px){.set-default[_ngcontent-%COMP%]:not(.grade-column-selected){display:none}}"],changeDetection:0})}}return t})();var Ya=["chartWrapper"],cr=(t,l)=>l.text,Qa=(t,l)=>l.value,Xa=(t,l)=>l.text+"-"+l.x;function Za(t,l){if(t&1&&(He(),_(0,"rect",12),o(1,"text",9),d(2),s()),t&2){let e=l.$implicit;pe("x",e.x-15)("y",e.y)("class",e.colorClass),r(),pe("x",e.x)("y",e.y+10),r(),C(" ",e.text," ")}}function Ja(t,l){if(t&1&&(He(),_(0,"rect")),t&2){let e=l.$implicit;pe("x",e.x)("y",e.y)("width",e.width)("height",e.height)("class",e.colorClass)}}function eo(t,l){if(t&1&&(He(),o(0,"text",8),d(1),s()),t&2){let e=l.$implicit;pe("x",e.x)("y",e.y),r(),C(" ",e.text," ")}}function to(t,l){if(t&1&&(He(),o(0,"text",9),d(1),s()),t&2){let e=l.$implicit;pe("x",e.x)("y",e.y)("text-anchor",e.textAnchor),r(),C(" ",e.text," ")}}function io(t,l){if(t&1&&(o(0,"div",3),He(),o(1,"svg"),R(2,Za,3,6,null,null,cr),s()(),di(),o(4,"div",4,0)(6,"div",5),He(),o(7,"svg")(8,"g"),_(9,"line",6)(10,"line",7),R(11,Ja,1,5,":svg:rect",null,Qa),R(13,eo,2,3,":svg:text",8,Xa),R(15,to,2,4,":svg:text",9,cr),o(17,"text",10),d(18),c(19,"translate"),s()()()()(),di(),o(20,"div",11)(21,"span",9),d(22),c(23,"translate"),s()()),t&2){let e=h();r(),pe("height",20)("width",e.renderedChartWidth()),r(),A(e.legendLabels()),r(4),g("ngClass",e.overflowClass),r(),pe("width",e.renderedChartWidth())("viewBox",e.viewBox()),r(),pe("transform","translate("+e.chartMargin().left+","+e.chartMargin().top+")"),r(),pe("y2",e.chartInnerHeight()),r(),pe("y1",e.chartInnerHeight())("x2",e.chartInnerWidth())("y2",e.chartInnerHeight()),r(),A(e.bars()),r(2),A(e.barLabels()),r(2),A(e.xLabels()),r(2),pe("transform","rotate(-90)")("x",-(e.chartInnerHeight()/2))("y",-e.chartMargin().left+15),r(),C(" ",m(19,15,"evaluation.chart.amount")," "),r(4),y(m(23,17,"evaluation.chart.grade"))}}function no(t,l){t&1&&(o(0,"div",2),d(1),c(2,"translate"),s()),t&2&&(r(),C(" ",m(2,1,"evaluation.chart.no-items")," "))}var pr=(()=>{class t{constructor(){this.entries=M.required(),this.gradingScale=M.required(),this.translate=u(ie),this.chartWidth=N(600),this.minChartWidth=N(300),this.chartHeight=N(350),this.chartMargin=N({top:5,right:25,bottom:25,left:25}),this.minBarWidth=N(20),this.maxBarWidth=N(25),this.barPaddingFactor=N(.7),this.barCountForSmallerWidth=N(25),this.currentChartWidth=N(0),this.currentScrollWidth=N(0),this.hasData=P(()=>this.chartData().length>0),this.chartInnerWidth=P(()=>{let i=this.chartData().length;if(i===0)return this.minChartWidth();let n=i*(this.maxBarWidth()/this.barPaddingFactor());return Math.max(this.minChartWidth(),n)}),this.chartInnerHeight=P(()=>this.chartHeight()-this.chartMargin().top-this.chartMargin().bottom),this.renderedChartWidth=P(()=>this.chartInnerWidth()+this.chartMargin().left+this.chartMargin().right),this.viewBox=P(()=>`0 0 ${this.renderedChartWidth()} ${this.chartHeight()}`),this.bars=P(()=>{let e=this.chartData(),i=this.xScaleBar(),n=this.yScaleLinear();return e.length===0?[]:e.map((a,p)=>{let S=i.step*p+(i.step-i.barWidth)/2,W=this.scaleY(a.Count,n.domain,n.range),Te=this.chartInnerHeight()-W,Ne=i.barWidth,de=a.Sufficient?"bar-sufficient":"bar-insufficient";return{x:S,y:W,width:Ne,height:Te,colorClass:de,value:a.Value,count:a.Count}})}),this.xLabels=P(()=>{let e=this.chartData(),i=this.xScaleBar(),n=this.chartInnerHeight();if(e.length===0)return[];let a=[];return e.forEach((p,S)=>{let W=i.step*S+i.step/2,Te=n+18;a.push({x:W,y:Te,text:p.Value.toString(),textAnchor:"middle"})}),a}),this.barLabels=P(()=>this.bars().map(e=>({x:e.x+e.width/2,y:e.y-5,text:e.count.toString()}))),this.legendLabels=P(()=>{let e=this.chartMargin().top/2;return[{text:this.translate.instant("evaluation.chart.unsufficient"),colorClass:"bar-insufficient",x:this.renderedChartWidth()/2-80,y:e},{text:this.translate.instant("evaluation.chart.sufficient"),colorClass:"bar-sufficient",x:this.renderedChartWidth()/2+50,y:e}]}),this.chartData=P(()=>{let e=this.gradingScale();if(!e||e.Grades.length===0||this.entries().length===0)return[];let i=this.countGrades();return e.Grades.map(n=>({Value:n.Value,Count:i.get(n.Value)||0,Sufficient:n.Sufficient,Sort:n.Sort||n.Value.toString().padStart(2,"0")})).filter(n=>n.Value>0).filter(n=>n.Count>0).sort((n,a)=>a.Sort.localeCompare(n.Sort))}),this.xScaleBar=P(()=>{if(this.chartData().length===0)return{domain:[],range:[0,0],step:0,barWidth:0};let e=this.chartData().map(W=>W.Value),i=[0,this.chartInnerWidth()],n=this.chartData().length,a=0,p=0,S=this.chartInnerWidth()/n*this.barPaddingFactor();return S>this.maxBarWidth()?a=this.maxBarWidth():n>=this.barCountForSmallerWidth()?a=this.minBarWidth():a=S,p=this.chartInnerWidth()/n,{domain:e,range:i,step:p,barWidth:a}}),this.yScaleLinear=P(()=>{if(this.chartData().length===0)return{domain:[0,0],range:[0,0]};let i=[0,Math.max(...this.chartData().map(a=>a.Count),0)*1.1],n=[this.chartInnerHeight(),0];return{domain:i,range:n}})}get overflowClass(){return this.currentScrollWidth()-this.currentChartWidth()>0?"is-overflowing":""}ngAfterViewInit(){let e=this.chartWrapper?.nativeElement;e&&(this.resizeObserver=new ResizeObserver(i=>{for(let n of i)this.currentChartWidth.set(Math.round(n.contentRect.width)),this.currentScrollWidth.set(Math.round(n.target.scrollWidth))}),this.resizeObserver?.observe(e),this.currentChartWidth.set(Math.round(e.clientWidth)),this.currentScrollWidth.set(Math.round(e.scrollWidth)))}ngOnDestroy(){this.resizeObserver&&this.resizeObserver.disconnect()}countGrades(){return this.entries().reduce((e,{grade:i})=>{let n=i?.Value;return n==null?e:e.set(n,(e.get(n)??0)+1)},new Map)}scaleY(e,i,n){let[a,p]=i,[S,W]=n;return p===a?S:S-(e-a)/(p-a)*(S-W)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-evaluation-chart"]],viewQuery:function(i,n){if(i&1&&Gi(Ya,5),i&2){let a;Li(a=Fi())&&(n.chartWrapper=a.first)}},inputs:{entries:[1,"entries"],gradingScale:[1,"gradingScale"]},decls:3,vars:1,consts:[["chartWrapper",""],[1,"chart-container","mt-3"],[1,"no-data-message"],[1,"chart-legend"],[1,"chart-wrapper"],["id","chart",1,"chart",3,"ngClass"],["x1","0","y1","0","x2","0",1,"axis"],["x1","0",1,"axis"],["text-anchor","middle",1,"label","bar-label"],[1,"label"],["text-anchor","middle",1,"label"],[1,"x-axis-label"],["width","10","height","10"]],template:function(i,n){i&1&&(o(0,"div",1),b(1,io,24,19)(2,no,3,3,"div",2),s()),i&2&&(r(),f(n.hasData()?1:2))},dependencies:[ue,I],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%}.chart-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:100%;height:auto;font-family:sans-serif;box-sizing:border-box;justify-content:center}.chart-legend[_ngcontent-%COMP%], .x-axis-label[_ngcontent-%COMP%]{align-items:center}.chart-wrapper[_ngcontent-%COMP%]{width:100%;height:auto;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow-x:auto;overflow-y:hidden}.chart[_ngcontent-%COMP%]{height:100%;align-self:center;display:inline-flex}svg[_ngcontent-%COMP%]{display:block;height:100%}.axis[_ngcontent-%COMP%]{stroke:#495057;stroke-width:1}.bar-sufficient[_ngcontent-%COMP%]{fill:#3d8608}.bar-insufficient[_ngcontent-%COMP%]{fill:#ea161f}.bar-label[_ngcontent-%COMP%]{font-weight:700}.no-data-message[_ngcontent-%COMP%]{text-align:center;padding:20px}.is-overflowing[_ngcontent-%COMP%]{align-self:flex-start}"],changeDetection:0})}}return t})();function ro(t,l){t&1&&_(0,"bkd-spinner")}function ao(t,l){t&1&&(o(0,"p",1),d(1),c(2,"translate"),s()),t&2&&(r(),y(m(2,1,"evaluation.no-event")))}function oo(t,l){if(t&1&&(_(0,"bkd-evaluation-header",2),o(1,"div",3)(2,"div",4),d(3," Some content "),_(4,"br"),d(5," Some content "),_(6,"br"),d(7," Some content "),_(8,"br"),d(9," Some content "),_(10,"br"),d(11," Some content "),_(12,"br"),d(13," Some content "),_(14,"br"),s(),_(15,"bkd-evaluation-chart",5),s()),t&2){let e=h(2),i=O(0);g("event",i)("showActions",!1),r(15),g("entries",e.state.entries())("gradingScale",e.state.gradingScale())}}function so(t,l){if(t&1&&b(0,oo,16,4),t&2){h();let e=O(0);f(e?0:-1)}}var mr=(()=>{class t{constructor(){this.state=u(Se)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-evaluation-statistic"]],decls:5,vars:2,consts:[[1,"bkd-container"],[1,"mt-3","px-3"],[3,"event","showActions"],[1,"d-flex","flex-column"],[1,"statistic-values"],[3,"entries","gradingScale"]],template:function(i,n){if(i&1&&($(0),o(1,"div",0),b(2,ro,1,0,"bkd-spinner")(3,ao,3,3,"p",1)(4,so,1,1),s()),i&2){let a=U(n.state.event());r(2),f(n.state.loading()?2:a?4:3)}},dependencies:[I,ti,pr,fe],styles:[".statistic-values[_ngcontent-%COMP%]{padding-bottom:1rem;padding-top:1rem;border-bottom:1px solid #dee2e6}"],changeDetection:0})}}return t})();var ur=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-evaluation"]],features:[me([Se,dt,lt])],decls:1,vars:0,template:function(i,n){i&1&&_(0,"router-outlet")},dependencies:[Le],encapsulation:2,changeDetection:0})}}return t})();var hr=(()=>{class t extends Je{constructor(){let e=u(Ee),i=u(ge);super(e,i,cn,"ApprenticeshipContracts")}getCompaniesForStudents(e){if(e.length===0)return F([]);let i=new Date,n={"filter.StudentId":`;${e.join(";")}`,"filter.ApprenticeshipDateFrom":`<${i.toISOString()}`,"filter.ApprenticeshipDateTo":`>${i.toISOString()}`,fields:"Id,StudentId,CompanyName,CompanyNameAddition"};return this.http.get(`${this.baseUrl}/`,{params:n}).pipe(G(nn(pn)))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Q({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function gr(t,l,e){l||Ti(t);let i=l??u(Ei);return e?xi(i,e):i}function _t(t,l){let e=gr(_t,l?.injector),i;return P(()=>(i||(i=Vi(()=>K(t,B(L({},l),{injector:e})))),i()))}var ni=1;var fr=10,ri=(()=>{class t{constructor(){this.route=u(he),this.loadingService=u(ne),this.eventsService=u(at),this.coursesService=u(be),this.subscriptionsService=u(rt),this.personsService=u(At),this.apprenticeshipContractsService=u(hr),this.lessonPresencesService=u(hn),this.reportsService=u(nt),this.eventId$=X([this.route.paramMap,this.route.parent?.paramMap??F(null)]).pipe(E(([e,i])=>Number(e.get("id")||i?.get("id"))),ae()),this.eventSummary$=this.eventId$.pipe(G(this.loadEventSummary.bind(this)),oe(1)),this.eventSummary=_t(this.eventSummary$,{initialValue:null}),this.eventTypeId=P(()=>this.eventSummary()?.EventTypeId??null),this.studentEntries=_t(this.loadStudentEntries(),{initialValue:null}),this.isStudyCourse=P(()=>this.eventTypeId()===ni),this.loading=K(this.loadingService.loading(Pe)),this.title=P(()=>this.getTitle(this.studentEntries())),this.multipleStudyClasses=P(()=>(this.studentEntries()?.studyClasses?.length??0)>1),this.searchTerm=N(""),this.sortCriteria=N({primarySortKey:"registrationDate",ascending:!1}),this.entries=P(()=>this.studentEntries()?.entries??[]),this.sortedEntries=P(()=>this.sortStudentEntries(this.entries(),this.sortCriteria())),this.filteredEntries=P(()=>zt(this.sortedEntries(),["name","status","company","studyClass"],this.searchTerm())),this.mailtoLink=P(()=>this.getMailtoLink(this.eventTypeId(),this.entries())),this.reports=_t(this.eventSummary$.pipe(Me(_e)).pipe(G(this.loadReports.bind(this))),{initialValue:[]})}loadEventSummary(e){return this.loadingService.load(this.eventsService.getEventSummary(e),Pe)}loadStudentEntries(){return this.eventSummary$.pipe(G(e=>{let i=()=>{if(!e)return F(null);switch(e.EventTypeId){case ni:return this.loadStudyCourseStudents(e);case fr:return this.loadStudyClassStudents(e.Id);default:return this.loadCourseStudents(e.Id)}};return this.loadingService.load(i(),Pe)}))}loadStudyCourseStudents({Id:e,Designation:i}){return this.subscriptionsService.getSubscriptionsByCourse(e).pipe(G(n=>this.personsService.getSummaries(n.map(({PersonId:a})=>a).filter(_e)).pipe(E(a=>gi(e,a,n,{eventDesignation:i})))))}loadStudyClassStudents(e){return this.subscriptionsService.getSubscriptionsByCourse(e,{"filter.IsOkay":"=1"}).pipe(G(i=>{let n=i.map(({PersonId:a})=>a).filter(_e);return X([this.personsService.getSummaries(n),this.apprenticeshipContractsService.getCompaniesForStudents(n)]).pipe(E(([a,p])=>{let S=gi(e,a,i,{emailFallback:!0});return hi(S,p)}))}))}loadCourseStudents(e){return this.coursesService.getExpandedCourseWithParticipants(e).pipe(E(Ln),G(i=>X([this.apprenticeshipContractsService.getCompaniesForStudents(i.entries.map(({id:n})=>n)),this.lessonPresencesService.getLessonStudyClassesByEvent(e)]).pipe(E(([n,a])=>{let p=hi(i,n);return Fn(p,a)}))))}getTitle(e){if(!e||!e.eventDesignation)return null;let{eventDesignation:i,studyClasses:n}=e;return[i,...n].join(", ")}getMailtoLink(e,i){if(e===null||e===ni)return null;let n=i.map(a=>a.email).filter(Boolean);return n.length>0?`mailto:${n.join(";")}`:null}loadReports({Id:e,EventTypeId:i}){switch(i){case null:case ni:return F([]);case fr:return this.reportsService.getStudyClassStudentsReports(e);default:return this.reportsService.getCourseStudentsReports(e)}}sortStudentEntries(e,i){return[...e].sort(lo(i))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Q({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function lo(t){return(l,e)=>{switch(t.primarySortKey){case"registrationDate":return co(l,e,t.ascending);case"name":return Cr(l,e,t.ascending);default:throw new Rt(t.primarySortKey,"Unhandled sort criteria")}}}function co(t,l,e){let i=t.registrationDate?new Date(t.registrationDate).getTime():0,n=l.registrationDate?new Date(l.registrationDate).getTime():0,a=e?i-n:n-i;return a===0?Cr(t,l,!0):a}function Cr(t,l,e){return e?t.name.localeCompare(l.name):l.name.localeCompare(t.name)}var vr=(()=>{class t{constructor(){this.entry=M.required(),this.multipleStudyClasses=M(!1),this.returnLink=M(null),this.link=P(()=>["student",this.entry().id,"contact"]),this.linkParams=P(()=>{let e=this.returnLink();return e?{returnparams:new URLSearchParams({returnlink:e}).toString()}:{}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-students-course-entry"]],inputs:{entry:[1,"entry"],multipleStudyClasses:[1,"multipleStudyClasses"],returnLink:[1,"returnLink"]},decls:7,vars:10,consts:[[1,"avatar","large",3,"studentId","link","linkParams"],[1,"name",3,"title","routerLink","queryParams"],[1,"study-class"],[1,"company",3,"title"]],template:function(i,n){i&1&&(_(0,"bkd-avatar",0),o(1,"a",1),d(2),s(),o(3,"div",2),d(4),s(),o(5,"div",3),d(6),s()),i&2&&(g("studentId",n.entry().id)("link",n.link())("linkParams",n.linkParams()),r(),g("title",n.entry().name)("routerLink",n.link())("queryParams",n.linkParams()),r(),y(n.entry().name),r(2),C(" ",n.multipleStudyClasses()?n.entry().studyClass:"",`
`),r(),g("title",n.entry().company),r(),y(n.entry().company))},dependencies:[Z,En],styles:['[_nghost-%COMP%]{display:grid;grid-template-columns:min-content 1fr;grid-template-rows:min-content min-content 1fr;grid-template-areas:"avatar name" "avatar study-class" "avatar company";padding:2rem 1rem}.avatar[_ngcontent-%COMP%]{grid-area:avatar;margin-right:1.5rem}.name[_ngcontent-%COMP%]{grid-area:name}.study-class[_ngcontent-%COMP%]{grid-area:study-class;font-size:.875rem}.company[_ngcontent-%COMP%]{grid-area:company;align-content:end;padding-bottom:1.5rem}.name[_ngcontent-%COMP%], .company[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}'],changeDetection:0})}}return t})();var po=t=>({count:t});function mo(t,l){if(t&1&&(o(0,"div",0),d(1),c(2,"translate"),s()),t&2){h();let e=O(2);r(),C(" ",H(2,1,e===1?"events-students.registration":"events-students.registrations",V(4,po,e))," ")}}var ai=(()=>{class t{constructor(){this.title=M.required(),this.count=M(null),this.searchTerm=le()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-students-header"]],inputs:{title:[1,"title"],count:[1,"count"],searchTerm:[1,"searchTerm"]},outputs:{searchTerm:"searchTermChange"},decls:7,vars:10,consts:[[1,"additional-info"],[1,"search",3,"valueChange","value","placeholder","label"]],template:function(i,n){if(i&1){let a=D();o(0,"h1"),d(1),s(),$(2),b(3,mo,3,6,"div",0),o(4,"bkd-resettable-input",1),c(5,"translate"),c(6,"translate"),w("valueChange",function(S){return x(a),T(n.searchTerm.set(S))}),s()}if(i&2){r(),y(n.title()),r();let a=U(n.count());r(),f(a!==null?3:-1),r(),g("value",n.searchTerm())("placeholder",m(5,6,"events-students.search-placeholder"))("label",m(6,8,"events-students.search"))}},dependencies:[I,Qt],styles:["h1[_ngcontent-%COMP%]{margin-bottom:0}.search[_ngcontent-%COMP%]{margin-top:1rem;display:flex;max-width:300px}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"],changeDetection:0})}}return t})();var uo=(t,l)=>l.id;function ho(t,l){t&1&&(o(0,"p"),d(1),c(2,"translate"),s()),t&2&&(r(),y(m(2,1,"events-students.no-entries")))}function go(t,l){if(t&1&&_(0,"bkd-events-students-course-entry",2),t&2){let e=l.$implicit,i=h();g("entry",e)("multipleStudyClasses",i.multipleStudyClasses())("returnLink",i.returnLink())}}var _r=(()=>{class t{constructor(){this.title=M.required(),this.count=M.required(),this.entries=M.required(),this.multipleStudyClasses=M(!1),this.returnLink=M(null),this.searchTerm=le()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-students-course-list"]],inputs:{title:[1,"title"],count:[1,"count"],entries:[1,"entries"],multipleStudyClasses:[1,"multipleStudyClasses"],returnLink:[1,"returnLink"],searchTerm:[1,"searchTerm"]},outputs:{searchTerm:"searchTermChange"},decls:5,vars:4,consts:[[3,"searchTermChange","title","count","searchTerm"],[1,"list"],[3,"entry","multipleStudyClasses","returnLink"]],template:function(i,n){i&1&&(o(0,"bkd-events-students-header",0),z("searchTermChange",function(p){return j(n.searchTerm,p)||(n.searchTerm=p),p}),s(),o(1,"section",1),b(2,ho,3,3,"p"),R(3,go,1,3,"bkd-events-students-course-entry",2,uo),s()),i&2&&(g("title",n.title())("count",n.count()),q("searchTerm",n.searchTerm),r(2),f(n.entries().length===0?2:-1),r(),A(n.entries()))},dependencies:[I,ai,vr],styles:["[_nghost-%COMP%]{display:block;overflow:hidden}section.list[_ngcontent-%COMP%]{width:calc(100% + 1px);margin-top:1rem;display:grid;grid-template-columns:repeat(auto-fill,minmax(400px,1fr))}bkd-events-students-course-entry[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;border-right:1px solid #dee2e6}"],changeDetection:0})}}return t})();var br=(()=>{class t{constructor(){this.entry=M.required(),this.returnLink=M(null),this.link=P(()=>["study-course-student",this.entry().id]),this.linkParams=P(()=>{let e=this.returnLink();return e?{returnparams:new URLSearchParams({returnlink:e}).toString()}:{}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-students-study-course-entry"]],inputs:{entry:[1,"entry"],returnLink:[1,"returnLink"]},decls:7,vars:8,consts:[[1,"name",3,"routerLink","queryParams"],[1,"status"],[1,"registration-date"]],template:function(i,n){i&1&&(o(0,"a",0),d(1),s(),o(2,"div",1),d(3),s(),o(4,"div",2),d(5),c(6,"date"),s()),i&2&&(g("routerLink",n.link())("queryParams",n.linkParams()),r(),y(n.entry().name),r(2),y(n.entry().status),r(2),C(" ",H(6,5,n.entry().registrationDate,"dd.MM.yyyy"),`
`))},dependencies:[Z,Bi,Ge],styles:['[_nghost-%COMP%]{display:grid;align-items:center;grid-template-areas:"name status registration-date";grid-template-columns:2fr 1fr 1fr;border-bottom:1px solid #dee2e6}.name[_ngcontent-%COMP%], .status[_ngcontent-%COMP%], .registration-date[_ngcontent-%COMP%]{padding:1rem}.name[_ngcontent-%COMP%]{grid-area:name;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.status[_ngcontent-%COMP%]{grid-area:status;padding-left:0}.registration-date[_ngcontent-%COMP%]{grid-area:registration-date}@media (max-width: 750px){[_nghost-%COMP%]{grid-template-areas:"name registration-date" "status registration-date";grid-template-columns:2fr 1fr;align-items:start}.name[_ngcontent-%COMP%]{padding-bottom:0}.status[_ngcontent-%COMP%]{padding-top:0;padding-left:1rem;font-size:.875rem}}'],changeDetection:0})}}return t})();var fo=(t,l)=>l.id;function Co(t,l){if(t&1){let e=D();o(0,"div",2)(1,"bkd-sortable-header",4),c(2,"translate"),z("sortCriteriaChange",function(n){x(e);let a=h();return j(a.sortCriteria,n)||(a.sortCriteria=n),T(n)}),s(),o(3,"bkd-sortable-header",5),c(4,"translate"),z("sortCriteriaChange",function(n){x(e);let a=h();return j(a.sortCriteria,n)||(a.sortCriteria=n),T(n)}),s()()}if(t&2){let e=h();r(),g("label",m(2,6,"events-students.list.header.name"))("sortKey","name"),q("sortCriteria",e.sortCriteria),r(2),g("label",m(4,8,"events-students.list.header.registration-date"))("sortKey","registrationDate"),q("sortCriteria",e.sortCriteria)}}function vo(t,l){t&1&&(o(0,"p"),d(1),c(2,"translate"),s()),t&2&&(r(),y(m(2,1,"events-students.no-entries")))}function _o(t,l){if(t&1&&_(0,"bkd-events-students-study-course-entry",3),t&2){let e=l.$implicit,i=h();g("entry",e)("returnLink",i.returnLink())}}var yr=(()=>{class t{constructor(){this.title=M.required(),this.count=M.required(),this.entries=M.required(),this.returnLink=M(null),this.sortCriteria=le.required(),this.searchTerm=le()}updateSortCriteria(e){this.sortCriteria.set(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-students-study-course-list"]],inputs:{title:[1,"title"],count:[1,"count"],entries:[1,"entries"],returnLink:[1,"returnLink"],sortCriteria:[1,"sortCriteria"],searchTerm:[1,"searchTerm"]},outputs:{sortCriteria:"sortCriteriaChange",searchTerm:"searchTermChange"},features:[me([])],decls:6,vars:4,consts:[[3,"searchTermChange","title","count","searchTerm"],[1,"list"],[1,"list-header"],[3,"entry","returnLink"],[1,"name",3,"sortCriteriaChange","label","sortKey","sortCriteria"],[1,"registration-date",3,"sortCriteriaChange","label","sortKey","sortCriteria"]],template:function(i,n){i&1&&(o(0,"bkd-events-students-header",0),z("searchTermChange",function(p){return j(n.searchTerm,p)||(n.searchTerm=p),p}),s(),o(1,"section",1),b(2,Co,5,10,"div",2)(3,vo,3,3,"p"),R(4,_o,1,2,"bkd-events-students-study-course-entry",3,fo),s()),i&2&&(g("title",n.title())("count",n.count()),q("searchTerm",n.searchTerm),r(2),f(n.entries().length>0?2:3),r(2),A(n.entries()))},dependencies:[I,ai,br,ot],styles:[".list-header[_ngcontent-%COMP%]{cursor:pointer;display:grid;grid-template-columns:3fr 1fr;align-items:center;border-bottom:2px solid #dee2e6}.name[_ngcontent-%COMP%], .registration-date[_ngcontent-%COMP%]{padding:1rem}.name[_ngcontent-%COMP%]{flex:3}.registration-date[_ngcontent-%COMP%]{flex:1}@media (max-width: 750px){.list-header[_ngcontent-%COMP%]{grid-template-columns:2fr 1fr}.name[_ngcontent-%COMP%]{flex:2}.registration-date[_ngcontent-%COMP%]{flex:1;white-space:nowrap}}"],changeDetection:0})}}return t})();var bo=t=>[t];function yo(t,l){if(t&1&&(o(0,"a",4)(1,"i",6),d(2,"mail"),s()()),t&2){let e=h(2);g("href",e.state.mailtoLink(),Oe)}}function So(t,l){if(t&1&&(o(0,"bkd-backlink",0)(1,"div",3),b(2,yo,3,1,"a",4),_(3,"bkd-reports-link",5),s()()),t&2){let e=h(),i=O(0);g("link",V(3,bo,i)),r(2),f(e.state.mailtoLink()?2:-1),r(),g("reports",e.state.reports())}}function xo(t,l){t&1&&_(0,"bkd-spinner")}function To(t,l){t&1&&(o(0,"p"),d(1),c(2,"translate"),s()),t&2&&(r(),y(m(2,1,"events-students.no-entries")))}function wo(t,l){if(t&1){let e=D();o(0,"bkd-events-students-study-course-list",7),z("sortCriteriaChange",function(n){x(e);let a=h();return j(a.state.sortCriteria,n)||(a.state.sortCriteria=n),T(n)})("searchTermChange",function(n){x(e);let a=h();return j(a.state.searchTerm,n)||(a.state.searchTerm=n),T(n)}),s()}if(t&2){let e=h();g("title",e.state.title())("count",e.state.entries().length)("entries",e.state.filteredEntries())("returnLink",e.returnLink()),q("sortCriteria",e.state.sortCriteria)("searchTerm",e.state.searchTerm)}}function Eo(t,l){if(t&1){let e=D();o(0,"bkd-events-students-course-list",8),z("searchTermChange",function(n){x(e);let a=h();return j(a.state.searchTerm,n)||(a.state.searchTerm=n),T(n)}),s()}if(t&2){let e=h();g("title",e.state.title())("count",e.state.entries().length)("entries",e.state.filteredEntries())("multipleStudyClasses",e.state.multipleStudyClasses())("returnLink",e.returnLink()),q("searchTerm",e.state.searchTerm)}}var Sr=(()=>{class t{constructor(){this.state=u(ri),this.route=u(he),this.returnLink=K(this.route.queryParams.pipe(E(({returnlink:e})=>e?decodeURIComponent(e):null)))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-students-list"]],decls:6,vars:3,consts:[[3,"link"],[3,"title","count","entries","returnLink","sortCriteria","searchTerm"],[3,"title","count","entries","multipleStudyClasses","returnLink","searchTerm"],[1,"d-flex"],["target","_blank",1,"mail","btn","btn-primary","btn-icon","me-2",3,"href"],[1,"ms-2",3,"reports"],[1,"material-icons"],[3,"sortCriteriaChange","searchTermChange","title","count","entries","returnLink","sortCriteria","searchTerm"],[3,"searchTermChange","title","count","entries","multipleStudyClasses","returnLink","searchTerm"]],template:function(i,n){if(i&1&&($(0),b(1,So,4,5,"bkd-backlink",0)(2,xo,1,0,"bkd-spinner")(3,To,3,3,"p")(4,wo,1,6,"bkd-events-students-study-course-list",1)(5,Eo,1,6,"bkd-events-students-course-list",2)),i&2){let a=U(n.returnLink());r(),f(a?1:-1),r(),f(n.state.loading()?2:n.state.entries().length===0?3:n.state.isStudyCourse()?4:5)}},dependencies:[I,fe,Re,it,_r,yr],encapsulation:2,changeDetection:0})}}return t})();var Po=(t,l)=>l.id;function Io(t,l){if(t&1&&(d(0),c(1,"date")),t&2){h(2);let e=O(2);C(" ",H(1,1,e.Birthdate,"dd.MM.yyyy")," ")}}function Mo(t,l){if(t&1&&d(0),t&2){h(2);let e=O(2);C(" (",e.Gender,") ")}}function ko(t,l){if(t&1&&(d(0),_(1,"br")),t&2){h(2);let e=O(2);C(" ",e.AddressLine1,"")}}function Oo(t,l){if(t&1&&(d(0),_(1,"br")),t&2){h(2);let e=O(2);C(" ",e.AddressLine2,"")}}function Do(t,l){if(t&1&&(d(0),_(1,"br")),t&2){h(2);let e=O(2);mt(" ",e.Zip," ",e.Location,"")}}function Go(t,l){if(t&1&&(o(0,"a",4),d(1),s(),_(2,"br")),t&2){h(2);let e=O(2);pt("href","tel:",e.PhonePrivate,"",Oe),r(),y(e.PhonePrivate)}}function Lo(t,l){if(t&1&&(o(0,"a",4),d(1),s(),_(2,"br")),t&2){h(2);let e=O(2);pt("href","tel:",e.PhoneMobile,"",Oe),r(),y(e.PhoneMobile)}}function Fo(t,l){if(t&1&&(o(0,"a",4),d(1),s(),_(2,"br")),t&2){h(2);let e=O(2);pt("href","mailto:",e.Email,"",Oe),r(),C(" ",e.Email," ")}}function $o(t,l){if(t&1&&(o(0,"a",4),d(1),s(),_(2,"br")),t&2){h(2);let e=O(2);pt("href","mailto:",e.Email2,"",Oe),r(),C(" ",e.Email2," ")}}function Vo(t,l){if(t&1&&(o(0,"h1"),d(1),s(),o(2,"span",3),b(3,Io,2,4)(4,Mo,1,1),s(),o(5,"address"),b(6,ko,2,1)(7,Oo,2,1)(8,Do,2,2)(9,Go,3,3)(10,Lo,3,3)(11,Fo,3,3)(12,$o,3,3),s()),t&2){h();let e=O(2);r(),y(e.FullName),r(2),f(e.Birthdate?3:-1),r(),f(e.Gender?4:-1),r(2),f(e.AddressLine1?6:-1),r(),f(e.AddressLine2?7:-1),r(),f(e.Zip&&e.Location?8:-1),r(),f(e.PhonePrivate?9:-1),r(),f(e.PhoneMobile?10:-1),r(),f(e.Email?11:-1),r(),f(e.Email2?12:-1)}}function Bo(t,l){if(t&1&&(o(0,"div",2),d(1),c(2,"translate"),o(3,"span",5),d(4),s()()),t&2){h();let e=O(4);r(),C(" ",m(2,2,"events-students.study-course-detail.status"),": "),r(3),y(e)}}function Ro(t,l){if(t&1&&(o(0,"div",6)(1,"h2"),d(2),s()()),t&2){let e=h().$implicit;r(2),y(e.label)}}function Ao(t,l){if(t&1&&(o(0,"a",7),d(1),s()),t&2){let e=h(2).$implicit;De("href",e.file,Oe),r(),y(e.value)}}function Ho(t,l){if(t&1&&d(0),t&2){let e=h(2).$implicit;C(" ",e.value," ")}}function Wo(t,l){if(t&1&&(o(0,"div",6)(1,"div"),d(2),s(),b(3,Ao,2,2,"a",7)(4,Ho,1,1),s()),t&2){let e=h().$implicit;r(2),y(e.label),r(),f(e.file!==null?3:4)}}function No(t,l){if(t&1&&b(0,Ro,3,1,"div",6)(1,Wo,5,2,"div",6),t&2){let e=l.$implicit;f(e.heading?0:e.value?1:-1)}}function jo(t,l){t&1&&_(0,"bkd-spinner")}var xr=(()=>{class t{constructor(){this.settings=u(ge),this.route=u(he),this.personsService=u(At),this.subscriptionsService=u(rt),this.storageService=u(Ze),this.loadingService=u(ne),this.eventId$=this.route.parent?.paramMap.pipe(E(e=>Number(e.get("id"))))??F(0),this.personId$=this.route.paramMap.pipe(E(e=>Number(e.get("id")))),this.person=K(this.personId$.pipe(G(e=>this.personsService.get(e))),{initialValue:null}),this.subscription=K(this.loadSubscription()),this.subscriptionId=P(()=>this.subscription()?.Id??null),this.subscriptionDetails=K(this.loadSubscriptionDetails(),{initialValue:[]}),this.backLink=K(this.route.queryParams.pipe(E(({returnparams:e})=>e),E(ln))),this.loading=K(this.loadingService.loading$,{initialValue:!0})}loadSubscription(){return this.loadingService.load(X([this.eventId$,this.personId$]).pipe(G(([e,i])=>this.subscriptionsService.getSubscriptionsByCourse(e,{"filter.PersonId":`=${i}`})),E(e=>e[0]??null)),{stopOnFirstValue:!0})}loadSubscriptionDetails(){return this.loadingService.load($e(this.subscriptionId).pipe(Me(_e),G(e=>this.subscriptionsService.getSubscriptionDetailsById(e)),E(e=>e.map(i=>this.toSubscriptionDetailsEntry(i)))),{stopOnFirstValue:!0})}toSubscriptionDetailsEntry(e){let i=e.Value??"";return i=this.normalizeSubscriptionDetailsDropdownValue(e,i)??"",{id:e.Id,label:e.VssDesignation,value:i,file:this.buildFileUrl(e),heading:e.VssStyle==="HE"}}normalizeSubscriptionDetailsDropdownValue(e,i){return e.DropdownItems&&e.VssStyle!=="CB"?e.DropdownItems.find(n=>String(n.Key)===i)?.Value??i:i}buildFileUrl(e){if(e.VssStyle==="PD"||e.VssStyle==="PF"||e.VssStyle==="DA"){let i=this.storageService.getAccessToken()||"";return`${this.settings.apiUrl}/Files/SubscriptionDetails/${e.Id}?token=${i}`}return null}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-students-study-course-detail"]],decls:9,vars:6,consts:[[1,"bkd-container","bkd-container-limited"],["link","../..",3,"params"],[1,"status"],[1,"additional-info"],[3,"href"],[1,"ms-2"],[1,"detail"],["target","_blank",3,"href"]],template:function(i,n){if(i&1&&(o(0,"div",0),_(1,"bkd-backlink",1),$(2),b(3,Vo,13,10),$(4),b(5,Bo,5,4,"div",2),R(6,No,2,1,null,null,Po),b(8,jo,1,0,"bkd-spinner"),s()),i&2){let a;r(),g("params",n.backLink()),r();let p=U(n.person());r(),f(p?3:-1),r();let S=U((a=n.subscription())==null?null:a.Status);r(),f(S?5:-1),r(),A(n.subscriptionDetails()),r(2),f(n.loading()?8:-1)}},dependencies:[I,Ge,Re,fe],styles:["h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}address[_ngcontent-%COMP%]{margin:1rem 0}.status[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem 0;border-top:1px solid #dee2e6;border-bottom:1px solid #dee2e6}.detail[_ngcontent-%COMP%]{max-width:70ch;padding-top:1rem}.detail[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.detail[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-weight:400;color:#00000080}"],changeDetection:0})}}return t})();var Tr=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-students"]],features:[me([ri])],decls:1,vars:0,template:function(i,n){i&1&&_(0,"router-outlet")},dependencies:[Le],encapsulation:2,changeDetection:0})}}return t})();function Uo(t,l){if(t&1&&(o(0,"span"),d(1),c(2,"date"),_(3,"wbr"),d(4),c(5,"date"),s()),t&2){let e=h();r(),C("",H(2,2,e.event().dateFrom,"dd.MM.yyyy"),"\u2013"),r(3),y(H(5,5,e.event().dateTo,"dd.MM.yyyy"))}}function qo(t,l){if(t&1&&(o(0,"div",5)(1,"a",6)(2,"i",7),d(3,"arrow_right_alt"),s(),o(4,"span",8),d(5),s()()()),t&2){let e=h();r(),g("routerLink",e.event().evaluationLink),r(4),C("",e.event().evaluationText," ")}}var wr=(()=>{class t{constructor(){this.event=M.required(),this.withRatings=M(!0),this.link=P(()=>dn(this.event().detailLink))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-list-entry"]],inputs:{event:[1,"event"],withRatings:[1,"withRatings"]},decls:11,vars:9,consts:[[1,"designation"],[3,"routerLink","queryParams"],[1,"date"],[1,"registrations"],[1,"registrations-label"],[1,"rating"],[1,"d-flex",3,"routerLink"],[1,"material-icons"],[1,"ps-1"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"a",1),d(2),s()(),o(3,"div",2),b(4,Uo,6,8,"span"),s(),o(5,"div",3),d(6),o(7,"span",4),d(8),c(9,"translate"),s()(),b(10,qo,6,2,"div",5)),i&2&&(r(),g("routerLink",n.link().link)("queryParams",n.link().params),r(),y(n.event().designation),r(2),f(n.event().dateFrom&&n.event().dateTo?4:-1),r(2),C(" ",n.event().studentCount," "),r(2),y(m(9,7,n.event().studentCount===1?"events.registration":"events.registrations")),r(2),f(n.withRatings()&&n.event().evaluationText?10:-1))},dependencies:[Z,Ge,I],styles:['[_nghost-%COMP%]{display:grid;padding:1rem;border-bottom:1px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}.designation[_ngcontent-%COMP%]{grid-area:designation;padding-right:1rem}.date[_ngcontent-%COMP%]{grid-area:date;padding-right:1rem}.registrations[_ngcontent-%COMP%]{grid-area:registrations;padding-right:1rem}.rating[_ngcontent-%COMP%]{grid-area:rating}.rating[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.registrations-label[_ngcontent-%COMP%]{display:none}@media (max-width: 575.98px){.registrations-label[_ngcontent-%COMP%]{display:inline}.designation[_ngcontent-%COMP%], .date[_ngcontent-%COMP%], .registrations[_ngcontent-%COMP%]{padding-right:0}[_nghost-%COMP%]{grid-template-areas:"designation" "date" "registrations" "rating";grid-template-columns:1fr}}']})}}return t})();var zo=()=>[],Ko=(t,l)=>l.id;function Yo(t,l){t&1&&_(0,"bkd-spinner")}function Qo(t,l){t&1&&(o(0,"div",7),d(1),c(2,"translate"),s()),t&2&&(r(),C(" ",m(2,1,"events.rating")," "))}function Xo(t,l){if(t&1&&_(0,"bkd-events-list-entry",8),t&2){let e=l.$implicit,i=h(3);g("event",e)("withRatings",i.withRatings)}}function Zo(t,l){if(t&1&&(o(0,"div",3)(1,"div",4),d(2),c(3,"translate"),s(),o(4,"div",5),d(5),c(6,"translate"),s(),o(7,"div",6),d(8),c(9,"translate"),s(),b(10,Qo,3,3,"div",7),s(),R(11,Xo,1,2,"bkd-events-list-entry",8,Ko)),t&2){let e=h(2),i=O(0);r(2),y(m(3,4,"events.designation")),r(3),y(m(6,6,"events.date")),r(3),C(" ",m(9,8,"events.registrations")," "),r(2),f(e.withRatings?10:-1),r(),A(i)}}function Jo(t,l){t&1&&(o(0,"p",2),d(1),c(2,"translate"),s()),t&2&&(r(),y(m(2,1,"events.no-events")))}function es(t,l){if(t&1&&b(0,Zo,13,10)(1,Jo,3,3,"p",2),t&2){h();let e=O(0);f(e.length>0?0:1)}}var Er=["designation"],ts=[...Er,"evaluationText"],oi=(()=>{class t{constructor(){this.state=u(st),this.storage=u(Ze),this.withStudyCourses=!1,this.withRatings=!0,this.state.setRoles(this.storage.getPayload()?.roles??null)}ngOnChanges(e){e.withStudyCourses&&this.state.setWithStudyCourses(e.withStudyCourses.currentValue),e.withRatings&&this.state.setSearchFields(e.withRatings.currentValue?ts:Er)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-list"]],inputs:{withStudyCourses:"withStudyCourses",withRatings:"withRatings"},features:[Ue],decls:10,vars:17,consts:[[1,"bkd-container"],[1,"d-flex","search",3,"valueChange","value","placeholder","label","disabled"],[1,"mt-3"],[1,"event-header"],[1,"designation"],[1,"date"],[1,"registrations"],[1,"rating"],[3,"event","withRatings"]],template:function(i,n){if(i&1){let a=D();$(0),c(1,"async"),o(2,"div",0)(3,"bkd-resettable-input",1),c(4,"async"),c(5,"translate"),c(6,"translate"),w("valueChange",function(S){return x(a),T(n.state.setSearch(S))}),s(),b(7,Yo,1,0,"bkd-spinner"),c(8,"async"),b(9,es,2,1),s()}if(i&2){let a,p=U((a=m(1,5,n.state.getEntries(n.withRatings)))!==null&&a!==void 0?a:ze(16,zo));r(3),g("value",m(4,8,n.state.search$))("placeholder",m(5,10,"events.search-by"))("label",m(6,12,"events.search"))("disabled",!p),r(4),f(m(8,14,n.state.loading$)?7:9)}},dependencies:[Qt,fe,te,I,wr],styles:['.search[_ngcontent-%COMP%]{max-width:500px}.event-header[_ngcontent-%COMP%]{display:grid;padding:1rem;border-bottom:2px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr;font-weight:500}@media (max-width: 575.98px){.event-header[_ngcontent-%COMP%]{display:none}}']})}}return t})();var Pr=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-tests"]],decls:4,vars:4,consts:[[3,"withRatings"]],template:function(i,n){i&1&&(o(0,"h1"),d(1),c(2,"translate"),s(),_(3,"bkd-events-list",0)),i&2&&(r(),y(m(2,2,"events.title")),r(2),g("withRatings",!0))},dependencies:[oi,I],encapsulation:2})}}return t})();function Ir(t){return l=>{let e=Number(l.value);return e<=t?{greaterThan:{value:e,greaterThanValue:t}}:null}}var ns=t=>["/events",t,"tests"];function rs(t,l){if(t&1&&(o(0,"div",7),d(1),c(2,"translate"),s()),t&2){let e=l.$implicit;r(),C(" ",H(2,1,"global.validation-errors."+e.error,e.params)," ")}}function as(t,l){if(t&1&&(o(0,"div",7),d(1),c(2,"translate"),s()),t&2){let e=l.$implicit;r(),C(" ",H(2,1,"global.validation-errors."+e.error,e.params)," ")}}function os(t,l){if(t&1&&(o(0,"div",7),d(1),c(2,"translate"),s()),t&2){let e=l.$implicit;r(),C(" ",H(2,1,"global.validation-errors."+e.error,e.params)," ")}}function ss(t,l){if(t&1&&(o(0,"div",7),d(1),c(2,"translate"),s()),t&2){let e=l.$implicit;r(),C(" ",H(2,1,"global.validation-errors."+e.error,e.params)," ")}}function ls(t,l){if(t&1&&(o(0,"div",7),d(1),c(2,"translate"),s()),t&2){let e=l.$implicit;r(),C(" ",H(2,1,"global.validation-errors."+e.error,e.params)," ")}}function ds(t,l){if(t&1&&(o(0,"div",29)(1,"div",30)(2,"div",16)(3,"label",31),d(4),c(5,"translate"),s(),o(6,"div",32),_(7,"input",33),c(8,"async"),R(9,ss,3,4,"div",7,qe),c(11,"async"),s()()(),o(12,"div",30)(13,"div",16)(14,"label",34),d(15),c(16,"translate"),s(),o(17,"div",32),_(18,"input",35),c(19,"async"),R(20,ls,3,4,"div",7,qe),c(22,"async"),s()()()(),o(23,"div",36),wi(),o(24,"math")(25,"mi"),d(26),c(27,"translate"),s(),o(28,"mo"),d(29,"="),s(),o(30,"mfrac")(31,"mrow")(32,"mi"),d(33),c(34,"translate"),s(),o(35,"mo"),d(36,"\xD7"),s(),o(37,"mn"),d(38,"5"),s()(),o(39,"mi"),d(40),c(41,"translate"),s()(),o(42,"mo"),d(43,"+"),s(),o(44,"mn"),d(45,"1"),s()()()),t&2){let e,i,n=h(2);r(4),y(m(5,9,"tests.form.max-points")),r(3),Y("is-invalid",((e=m(8,11,n.maxPointsErrors$))==null?null:e.length)||!1),r(2),A(m(11,13,n.maxPointsErrors$)),r(6),y(m(16,15,"tests.form.max-points-adjusted")),r(3),Y("is-invalid",((i=m(19,17,n.maxPointsAdjustedErrors$))==null?null:i.length)||!1),r(2),A(m(22,19,n.maxPointsAdjustedErrors$)),r(6),C(" ",m(27,21,"tests.form.math.grade")," "),r(7),C(" ",m(34,23,"tests.form.math.points")," "),r(7),y(m(41,25,"tests.form.math.max-points"))}}function cs(t,l){t&1&&(o(0,"div",28)(1,"span",37),d(2,"Loading..."),s()())}function ps(t,l){if(t&1){let e=D();o(0,"form",2),w("ngSubmit",function(){x(e);let n=h();return T(n.onSubmit())}),o(1,"div",3)(2,"div",4)(3,"label",5),d(4),c(5,"translate"),s(),_(6,"input",6),c(7,"async"),c(8,"translate"),R(9,rs,3,4,"div",7,qe),c(11,"async"),s(),o(12,"div",8)(13,"label",9),d(14),c(15,"translate"),s(),o(16,"div",10)(17,"span",11)(18,"i",12),d(19,"calendar_today"),s()(),o(20,"input",13,0),c(22,"async"),c(23,"translate"),w("click",function(){x(e);let n=xe(21);return T(n.toggle())}),s(),R(24,as,3,4,"div",7,qe),c(26,"async"),s()()(),o(27,"div",14)(28,"label",15),d(29),c(30,"translate"),s(),o(31,"div",4)(32,"div",16)(33,"label",17),d(34),c(35,"translate"),s(),o(36,"div",18),_(37,"input",19),c(38,"async"),R(39,os,3,4,"div",7,qe),c(41,"async"),s()()()(),o(42,"div")(43,"label",15),d(44),c(45,"translate"),s(),o(46,"div",20),_(47,"input",21),o(48,"label",22),d(49),c(50,"translate"),s()(),o(51,"div",20),_(52,"input",23),o(53,"label",24),d(54),c(55,"translate"),s()(),b(56,ds,46,27),s(),o(57,"div",25)(58,"button",26),c(59,"async"),d(60),c(61,"translate"),s(),o(62,"button",27),d(63),c(64,"translate"),b(65,cs,3,0,"div",28),s()()()}if(t&2){let e,i,n,a,p=h();g("formGroup",p.formGroup),r(4),y(m(5,26,"tests.form.designation")),r(2),Y("is-invalid",((e=m(7,28,p.designationErrors$))==null?null:e.length)||!1),g("placeholder",m(8,30,"tests.form.designation-placeholder")),r(3),A(m(11,32,p.designationErrors$)),r(5),y(m(15,34,"tests.form.date")),r(3),g("id",p.componentId),r(3),Y("is-invalid",((i=m(22,36,p.dateErrors$))==null?null:i.length)||!1),g("placeholder",m(23,38,"shared.date-select.default-placeholder")),r(4),A(m(26,40,p.dateErrors$)),r(5),y(m(30,42,"tests.form.weight")),r(5),y(m(35,44,"tests.form.factor")),r(3),Y("is-invalid",((n=m(38,46,p.weightErrors$))==null?null:n.length)||!1),r(2),A(m(41,48,p.weightErrors$)),r(5),y(m(45,50,"tests.form.grading-type")),r(3),g("value",!1),r(2),y(m(50,52,"tests.form.grades")),r(3),g("value",!0),r(2),y(m(55,54,"tests.form.points")),r(2),f((a=p.formGroup.get("isPointGrading"))!=null&&a.value?56:-1),r(2),g("disabled",p.saving)("routerLink",V(62,ns,m(59,56,p.courseId$))),r(2),C(" ",m(61,58,"tests.form.cancel")," "),r(2),g("disabled",p.saving),r(),C(" ",m(64,60,"tests.form.save")," "),r(2),f(p.saving?65:-1)}}var si=(()=>{class t{constructor(){this.fb=u(zi),this.translate=u(ie),this.testStateService=u(J),this.test=null,this.saving=!1,this.save=new Ce,this.componentId=en("bkd-tests-edit-form"),this.formGroup=this.createFormGroup(),this.submitted$=new ee(!1),this.destroy$=new se,this.designationErrors$=et(F(this.formGroup),this.submitted$,"designation"),this.dateErrors$=et(F(this.formGroup),this.submitted$,"date"),this.maxPointsErrors$=et(F(this.formGroup),this.submitted$,"maxPoints"),this.maxPointsAdjustedErrors$=et(F(this.formGroup),this.submitted$,"maxPointsAdjusted"),this.weightErrors$=et(F(this.formGroup),this.submitted$,"weight"),this.courseId$=this.testStateService.courseId$}ngOnInit(){this.test&&this.setInitialValues(this.test),an(F(this.formGroup),"isPointGrading").pipe(we(this.destroy$)).subscribe(this.togglePointFieldsDisability.bind(this))}ngOnDestroy(){this.destroy$.next()}onSubmit(){this.submitted$.next(!0),this.formGroup.valid&&this.save.emit(this.formGroup.value)}createFormGroup(){return this.fb.group({designation:["",Ye.required],date:[null,Ye.required],weight:[1,Ye.compose([Ye.required,Ir(0)])],isPointGrading:[!1],maxPoints:[{value:null,disabled:!0},Ye.required],maxPointsAdjusted:[{value:null,disabled:!0},null]})}setInitialValues(e){this.formGroup.patchValue({designation:e.Designation,date:e.Date,weight:e.Weight,isPointGrading:e.IsPointGrading,maxPoints:e.MaxPoints,maxPointsAdjusted:e.MaxPointsAdjusted}),e.Results&&e.Results.length>0&&(this.formGroup.get("isPointGrading")?.disable(),this.formGroup.get("maxPoints")?.disable(),this.formGroup.get("maxPointsAdjusted")?.disable()),this.togglePointFieldsDisability()}togglePointFieldsDisability(){let e=this.formGroup.get("maxPoints"),i=this.formGroup.get("maxPointsAdjusted");this.formGroup.get("isPointGrading")?.value?(e?.enable(),i?.enable()):(e?.reset({value:this.test?.MaxPoints,disabled:!0}),i?.reset({value:this.test?.MaxPointsAdjusted,disabled:!0}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-edit-form"]],inputs:{test:"test",saving:"saving"},outputs:{save:"save"},features:[me([{provide:Yi,useClass:Zi},{provide:Qi,useClass:Mn}])],decls:1,vars:1,consts:[["dp","ngbDatepicker"],[3,"formGroup"],[3,"ngSubmit","formGroup"],[1,"row","g-3","mb-3"],[1,"col-md-6"],["for","designation",1,"form-label"],["id","designation","name","designation","type","text","formControlName","designation","required","",1,"form-control",3,"placeholder"],[1,"invalid-feedback"],[1,"col-md-6","mb-3"],["for","date",1,"form-label"],[1,"input-group"],[1,"input-group-text",3,"id"],[1,"material-icons"],["id","date","name","date","type","text","ngbDatepicker","","formControlName","date","required","",1,"form-control",3,"click","placeholder"],[1,"row","mb-3"],[1,"form-label"],[1,"row"],["for","factor",1,"form-label","col-3","col-sm-2"],[1,"col-9","col-sm-10"],["id","factor","name","factor","type","number","formControlName","weight","step","0.05","min","0","required","",1,"form-control"],[1,"form-check"],["type","radio","formControlName","isPointGrading","id","type-grades",1,"form-check-input",3,"value"],["for","type-grades",1,"form-check-label"],["type","radio","formControlName","isPointGrading","id","type-points",1,"form-check-input",3,"value"],["for","type-points",1,"form-check-label"],[1,"d-flex","justify-content-end","mt-4"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","routerLink"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"row","ms-4","mb-3","g-3"],[1,"col-sm-6","col-md-4"],["for","max-points",1,"ms-2","col-4","col-form-label"],[1,"col-6"],["type","number","name","maxPoints","id","max-points","formControlName","maxPoints","step","0.01","min","0","max","999","required","",1,"form-control"],["for","max-points-adjusted",1,"ms-2","col-4","col-form-label"],["type","number","name","maxPointsAdjusted","id","max-points-adjusted","formControlName","maxPointsAdjusted","step","0.01","min","0","max","999",1,"form-control"],[1,"ms-4","ps-3","py-3"],[1,"visually-hidden"]],template:function(i,n){i&1&&b(0,ps,66,64,"form",1),i&2&&f(n.formGroup?0:-1)},dependencies:[Qe,Wi,Dt,Lt,Ni,Gt,Ai,qi,$t,Ft,Ki,ji,Ui,Xi,Z,te,I],styles:["#factor[_ngcontent-%COMP%], #max-points[_ngcontent-%COMP%], #max-points-adjusted[_ngcontent-%COMP%]{width:5em}"]})}}return t})();var Mr=(()=>{class t{constructor(){this.courseService=u(be),this.toastService=u(Xe),this.translate=u(ie),this.router=u(Fe),this.state=u(J),this.saving$=new ee(!1)}save(e){this.saving$.next(!0);let{designation:i,date:n,weight:a,isPointGrading:p,maxPoints:S,maxPointsAdjusted:W}=e;this.state.courseId$.pipe(ce(1),G(Te=>this.courseService.add(Te,n,i,a,p,S,W)),xt(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.state.reload(),this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}navigateBack(){this.state.courseId$.pipe(ce(1)).subscribe(e=>void this.router.navigate(["events",e,"tests"]))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-add"]],decls:6,vars:6,consts:[[1,"bkd-container","bkd-container-limited"],[3,"save","saving"]],template:function(i,n){i&1&&(o(0,"h1"),d(1),c(2,"translate"),s(),o(3,"div",0)(4,"bkd-tests-edit-form",1),c(5,"async"),w("save",function(p){return n.save(p)}),s()()),i&2&&(r(),y(m(2,2,"tests.add-title")),r(3),g("saving",m(5,4,n.saving$)))},dependencies:[si,te,I],encapsulation:2})}}return t})();var kr=(()=>{class t{constructor(){this.activeModal=u(Ve)}get canDeleteTest(){return(this.test?.Results?.filter(i=>i.GradeId!==null||i.GradeValue!==null||i.Points!==null)||[]).length===0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-delete"]],inputs:{test:"test"},decls:13,vars:10,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click","hidden"],[1,"px-2"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"],[1,"px-3"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"p",1),d(2),c(3,"translate"),s()(),o(4,"div",2)(5,"button",3),w("click",function(){return n.activeModal.dismiss()}),o(6,"span",4),d(7),c(8,"translate"),s()(),o(9,"button",5),w("click",function(){return n.activeModal.close(n.canDeleteTest?n.test:null)}),o(10,"span",6),d(11),c(12,"translate"),s()()()),i&2&&(r(2),C(" ",m(3,4,n.canDeleteTest?"tests.form.confirm":"tests.form.delete-not-allowed")," "),r(3),g("hidden",!n.canDeleteTest),r(2),C(" ",m(8,6,"tests.dialog.no")," "),r(4),C(" ",m(12,8,n.canDeleteTest?"tests.dialog.yes":"tests.dialog.ok")," "))},dependencies:[I],encapsulation:2})}}return t})();var ms=t=>({test:t});function us(t,l){t&1&&_(0,"bkd-spinner")}function hs(t,l){if(t&1){let e=D();o(0,"div",1)(1,"h1"),d(2),c(3,"translate"),s(),o(4,"button",2),w("click",function(){x(e);let n=h(),a=O(0);return T(n.openDeleteModal(a))}),o(5,"i",3),d(6,"delete"),s()()(),o(7,"bkd-tests-edit-form",4),w("save",function(n){x(e);let a=h();return T(a.save(n))}),s()}if(t&2){h();let e=O(0),i=O(2);r(2),C(" ",H(3,3,"tests.edit-title",V(6,ms,e.Designation))," "),r(5),g("test",e)("saving",i)}}var Or=(()=>{class t{constructor(){this.state=u(J),this.courseService=u(be),this.route=u(he),this.toastService=u(Xe),this.translate=u(ie),this.router=u(Fe),this.modalService=u(Be),this.saving$=new ee(!1),this.testId$=this.route.paramMap.pipe(E(e=>Number(e.get("testId"))),ae()),this.test$=X([this.state.tests$,this.testId$]).pipe(E(([e,i])=>e.find(n=>n.Id===i)))}openDeleteModal(e){let i=this.modalService.open(kr);i.componentInstance.test=e,i.result.then(n=>{n&&this.courseService.delete(e.CourseId,e.Id).subscribe(this.onDeleteSuccess.bind(this))},()=>{})}save(e){this.saving$.next(!0);let{designation:i,date:n,weight:a,isPointGrading:p,maxPoints:S,maxPointsAdjusted:W}=e;X([this.state.courseId$,this.testId$]).pipe(ce(1),G(([Te,Ne])=>this.courseService.update(Te,Ne,i,n,a,p,S,W)),xt(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.state.reload(),this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}onDeleteSuccess(e){this.toastService.success(this.translate.instant("tests.form.delete-success")),this.state.deleteTest(e),this.navigateBack()}navigateBack(){this.state.courseId$.pipe(ce(1)).subscribe(e=>void this.router.navigate(["events",e,"tests"]))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-edit"]],decls:8,vars:9,consts:[[1,"bkd-container","bkd-container-limited"],[1,"d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-primary","btn-icon",3,"click"],[1,"material-icons"],[3,"save","test","saving"]],template:function(i,n){if(i&1&&($(0),c(1,"async"),$(2),c(3,"async"),o(4,"div",0),b(5,us,1,0,"bkd-spinner"),c(6,"async"),b(7,hs,8,8),s()),i&2){let a=U(m(1,1,n.test$));r(2),U(m(3,4,n.saving$)),r(3),f(m(6,7,n.state.loading$)?5:a?7:-1)}},dependencies:[si,fe,te,I],encapsulation:2})}}return t})();var gs=()=>["/events"],fs=t=>({count:t});function Cs(t,l){if(t&1&&(o(0,"div",7),d(1),c(2,"translate"),s()),t&2){let e=h();r(),C(" ",H(2,1,e.course.ParticipatingStudents.length===1?"courses.registration":"courses.registrations",V(4,fs,e.course.ParticipatingStudents.length))," ")}}var Dr=(()=>{class t{constructor(){this.reportsService=u(nt),this.course$=new ee(null),this.reports$=this.course$.pipe(E(e=>e?.Id),ae(),G(e=>e?this.reportsService.getCourseTestsReports(e):F([])),je([]))}ngOnChanges(e){e.course&&this.course$.next(e.course.currentValue)}getDesignation(){return Zt(this.course)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-header"]],inputs:{course:"course"},features:[Ue],decls:12,vars:7,consts:[[3,"link"],[1,"d-flex"],["routerLink","add",1,"edit","btn","btn-primary","btn-icon","ms-2"],[1,"material-icons"],[1,"ms-2",3,"reports"],["id","excel-import"],[1,"d-flex","flex-column","header"],[1,"additional-info"]],template:function(i,n){i&1&&(o(0,"bkd-backlink",0)(1,"div",1)(2,"a",2)(3,"i",3),d(4,"add"),s()(),_(5,"bkd-reports-link",4),c(6,"async"),_(7,"div",5),s()(),o(8,"div",6)(9,"h1"),d(10),s(),b(11,Cs,3,6,"div",7),s()),i&2&&(g("link",ze(6,gs)),r(5),g("reports",m(6,4,n.reports$)),r(5),y(n.getDesignation()),r(),f(n.course.ParticipatingStudents?11:-1))},dependencies:[Re,Z,it,te,I],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem;border-bottom:1px solid #dee2e6}h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"]})}}return t})();var vs=t=>({designation:t}),Gr=(()=>{class t{constructor(){this.activeModal=u(Ve)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-publish"]],inputs:{test:"test"},decls:11,vars:12,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"p",1),d(2),c(3,"translate"),s()(),o(4,"div",2)(5,"button",3),w("click",function(){return n.activeModal.dismiss()}),d(6),c(7,"translate"),s(),o(8,"button",4),w("click",function(){return n.activeModal.close(!0)}),d(9),c(10,"translate"),s()()),i&2&&(r(2),C(" ",H(3,3,n.test.IsPublished?"tests.publishing.unpublish":"tests.publishing.publish",V(10,vs,n.test.Designation))," "),r(4),C(" ",m(7,6,"tests.publishing.cancel")," "),r(3),C(" ",m(10,8,"tests.publishing.confirm")," "))},dependencies:[I],encapsulation:2})}}return t})();function _s(t,l){if(t&1&&(o(0,"span",1),d(1),s()),t&2){let e=h();r(),y(e.calculatePointsAverage(e.test))}}var Lr=(()=>{class t{constructor(){this.locale=u($i)}calculatePointsAverage(e){return this.safeAverage(e,2,Ht)}calculateGradeAverage(e){return this.safeAverage(e,3,Wt)}safeAverage(e,i,n){try{return Tn(n(e),this.locale,i)}catch{return xn}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-average-grades"]],inputs:{test:"test"},decls:4,vars:2,consts:[[1,"d-flex","flex-row","w-100"],["data-testid","average-points",1,"mr-2","mr-md-3","average-points"],["data-testid","average-grade"]],template:function(i,n){i&1&&(o(0,"div",0),b(1,_s,2,1,"span",1),o(2,"span",2),d(3),s()()),i&2&&(r(),f(n.test.IsPointGrading?1:-1),r(2),y(n.calculateGradeAverage(n.test)))},styles:[".average-points[_ngcontent-%COMP%]{min-width:4.5em}@media (min-width: 576px){.average-points[_ngcontent-%COMP%]{min-width:6em}}"]})}}return t})();var Fr=(()=>{class t{constructor(){this.disabled=!1,this.width="127px",this.gradeIdSelected=new Ce}onGradeChange(e){this.gradeId?.valueOf()!==void 0&&this.gradeIdSelected.emit({id:this.gradeId?.valueOf(),selectedGradeId:e})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-grade-select"]],inputs:{options:"options",valueId:"valueId",gradeId:"gradeId",disabled:"disabled",width:"width"},outputs:{gradeIdSelected:"gradeIdSelected"},decls:1,vars:5,consts:[["data-testid","grade-select",3,"valueChange","options","allowEmpty","value","disabled","width"]],template:function(i,n){i&1&&(o(0,"bkd-select",0),w("valueChange",function(p){return n.onGradeChange(p)}),s()),i&2&&g("options",n.options)("allowEmpty",!0)("value",n.valueId)("disabled",n.disabled)("width",n.width)},dependencies:[ye],encapsulation:2})}}return t})();var bs=t=>({maxPoints:t});function ys(t,l){if(t&1&&(o(0,"div",6),d(1),c(2,"translate"),s()),t&2){let e=h(2);r(),C(" ",H(2,1,"global.validation-errors.invalidPoints",V(4,bs,e.maxPoints))," ")}}function Ss(t,l){if(t&1){let e=D();o(0,"div",3)(1,"input",5,0),w("ngModelChange",function(){x(e);let n=xe(2),a=h();return T(a.onPointsChange(n.value))}),s(),b(3,ys,3,6,"div",6),s()}if(t&2){let e=xe(2),i=h();r(),Y("is-invalid",e.errors),De("max",i.maxPoints),De("tabindex",i.tabIndex),g("disabled",i.grade.test.IsPublished||i.hasFinalGrade)("ngModel",i.grade.kind==="grade"?i.grade.result.Points:null),r(2),f(e.errors?3:-1)}}var xs=1250,$r=(()=>{class t{constructor(){this.state=u(J),this.hasFinalGrade=!1,this.maxPoints=0,this.pointsSubject$=new se,this.gradeSubject$=new se,this.gradingScaleDisabledSubject$=new ee(!0),this.gradingScaleDisabled$=this.gradingScaleDisabledSubject$.asObservable(),this.destroy$=new se}ngOnInit(){this.gradingScaleDisabledSubject$.next(this.isGradingScaleDisabled()),this.maxPoints=Kn(this.grade),this.initSave(this.pointsSubject$.pipe(Me(this.isValid.bind(this)),E(e=>({studentId:this.student.Id,testId:this.grade.test.Id,points:e?Number(e):null})))),this.initSave(this.gradeSubject$.pipe(E(e=>({studentId:this.student.Id,testId:this.grade.test.Id,gradeId:e}))))}ngOnChanges(){this.gradingScaleDisabledSubject$.next(this.isGradingScaleDisabled())}ngOnDestroy(){this.destroy$.next()}onPointsChange(e){this.pointsSubject$.next(e),this.gradingScaleDisabledSubject$.next(!(e===null||e===""))}onGradeChange(e){this.gradeSubject$.next(e)}isValid(e){return e===""||e===null?!0:isNaN(Number(e))?!1:!(Number(e)<0||Number(e)>this.maxPoints)}initSave(e){e.pipe(yi(i=>this.state.optimisticallyUpdateGrade(i).pipe(E(n=>({params:i,originalResult:n})))),St(xs),we(this.destroy$)).subscribe(({params:i,originalResult:n})=>this.state.saveGrade(i,n))}isGradingScaleDisabled(){return this.grade.test.IsPublished||this.hasFinalGrade||this.grade.test.IsPointGrading&&this.grade.kind==="grade"&&this.grade.result.Points!=null}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-grade"]],inputs:{grade:"grade",student:"student",tabIndex:"tabIndex",gradeOptions:"gradeOptions",hasFinalGrade:"hasFinalGrade"},features:[Ue],decls:5,vars:8,consts:[["points","ngModel"],[1,"d-flex","flex-column","w-100"],[1,"d-flex","flex-row"],[1,"point-input-container","me-2","me-md-3"],["data-testid","grade-select",1,"grade-select",3,"valueChange","options","allowEmpty","value","disabled","tabindex"],["type","number","step","0.01","min","0","data-testid","point-input",1,"form-control",3,"ngModelChange","max","disabled","tabindex","ngModel"],["data-testid","validation-error-message",1,"invalid-feedback"]],template:function(i,n){i&1&&(o(0,"div",1)(1,"div",2),b(2,Ss,4,7,"div",3),o(3,"bkd-select",4),c(4,"async"),w("valueChange",function(p){return n.onGradeChange(p)}),s()()()),i&2&&(r(2),f(n.grade.test.IsPointGrading?2:-1),r(),g("options",n.gradeOptions)("allowEmpty",!0)("value",n.grade.kind==="grade"?n.grade.result.GradeId:null)("disabled",m(4,6,n.gradingScaleDisabled$))("tabindex",n.tabIndex))},dependencies:[Qe,Dt,Lt,Gt,$t,Ft,Hi,ye,te,I],styles:[".point-input-container[_ngcontent-%COMP%]{width:4em}[_nghost-%COMP%]     select{width:127px}@media (min-width: 576px){.point-input-container[_ngcontent-%COMP%]{width:5em}}"]})}}return t})();var Vr=(t,l)=>({"btn-primary":t,"btn-outline-secondary":l}),Br=(()=>{class t{constructor(){this.filter=vi,this.filterChange=new Ce}showOnlyMine(){this.filterChange.next(B(L({},this.filter),{onlyMine:!0}))}showAll(){this.filterChange.next(B(L({},this.filter),{onlyMine:!1}))}onHidePublishedChange(e){let i=(e.target&&e.target instanceof HTMLInputElement&&e.target?.checked)??!1;this.filterChange.next(B(L({},this.filter),{hidePublished:i}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-table-filter"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},decls:13,vars:18,consts:[[1,"only-mine-buttons"],["type","button",1,"btn","desktop",3,"click","ngClass"],["type","button",1,"btn","ms-2","desktop",3,"click","ngClass"],[1,"hide-published"],[1,"form-check"],["id","hide-published","type","checkbox",1,"form-check-input",3,"change","checked"],["for","hide-published",1,"form-check-label"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"button",1),w("click",function(){return n.showAll()}),d(2),c(3,"translate"),s(),o(4,"button",2),w("click",function(){return n.showOnlyMine()}),d(5),c(6,"translate"),s()(),o(7,"div",3)(8,"div",4)(9,"input",5),w("change",function(p){return n.onHidePublishedChange(p)}),s(),o(10,"label",6),d(11),c(12,"translate"),s()()()),i&2&&(r(),g("ngClass",ci(12,Vr,!n.filter.onlyMine,n.filter.onlyMine)),r(),C(" ",m(3,6,"tests.all-tests")," "),r(2),g("ngClass",ci(15,Vr,n.filter.onlyMine,!n.filter.onlyMine)),r(),C(" ",m(6,8,"tests.owned-tests")," "),r(4),g("checked",n.filter.hidePublished),r(2),C(" ",m(12,10,"tests.hide-published")," "))},dependencies:[ue,Qe,I],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:100%}.only-mine-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;height:3.625rem}.hide-published[_ngcontent-%COMP%]{display:flex;align-items:center;height:2.375rem;margin-bottom:1rem}.hide-published[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:300}.hide-published[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]{margin-bottom:0}"]})}}return t})();var Rr=(()=>{class t{constructor(){this.translate=u(ie)}transform(e){return`${e.Weight} (${e.WeightPercent}%)${this.getPoints(e)}`}getPoints(e){return e.IsPointGrading?`, ${e.MaxPointsAdjusted??e.MaxPoints} ${this.translate.instant("tests.summary.points")}`:""}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275pipe=Mi({name:"testSummaryShort",type:t,pure:!0})}}return t})();var Ts=["*"],Ar=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-preserve-line-height"]],ngContentSelectors:Ts,decls:3,vars:0,template:function(i,n){i&1&&(Oi(),o(0,"div"),Di(1),d(2,"\xA0"),s())},encapsulation:2})}}return t})();var ws=t=>[t,"edit"];function Es(t,l){t&1&&(o(0,"i",9),d(1,"edit"),s())}function Ps(t,l){if(t&1&&(o(0,"div",5)(1,"div",7)(2,"bkd-preserve-line-height"),d(3),c(4,"date"),s(),o(5,"a",8),b(6,Es,2,0,"i",9),s()(),o(7,"bkd-preserve-line-height"),d(8),c(9,"testSummaryShort"),s(),o(10,"bkd-preserve-line-height"),d(11),s()()),t&2){let e=h();r(3),y(H(4,5,e.test.Date,"dd.MM.yyyy")),r(2),g("routerLink",V(10,ws,e.test.Id)),r(),f(e.test.IsOwner&&e.test.IsPublished===!1?6:-1),r(2),C(" ",m(9,8,e.test)," "),r(3),y(e.test.Owner)}}function Is(t,l){if(t&1){let e=D();o(0,"div",6)(1,"a",10),c(2,"translate"),w("click",function(){x(e);let n=h();return T(n.unpublishTest())}),o(3,"i",11),d(4,"lock"),s(),o(5,"span"),d(6),c(7,"translate"),s()(),o(8,"bkd-caret",12),w("click",function(){x(e);let n=h();return T(n.emitToggleHeader())}),s()()}if(t&2){let e=h();r(),De("title",m(2,3,"tests.edit")),r(5),y(m(7,5,"tests.published")),r(2),g("expanded",e.expanded)}}function Ms(t,l){if(t&1){let e=D();o(0,"div",6)(1,"a",13),c(2,"translate"),w("click",function(){x(e);let n=h();return T(n.publishTest())}),o(3,"i",11),d(4,"lock_open"),s(),o(5,"span"),d(6),c(7,"translate"),s()(),o(8,"bkd-caret",12),w("click",function(){x(e);let n=h();return T(n.emitToggleHeader())}),s()()}if(t&2){let e=h();r(),De("title",m(2,3,"tests.publish")),r(5),y(m(7,5,"tests.not-published")),r(2),g("expanded",e.expanded)}}var Hr=(()=>{class t{constructor(){this.toggleHeader=new Ce,this.publish=new Ce,this.unpublish=new Ce}emitToggleHeader(){this.toggleHeader.emit(!this.expanded)}publishTest(){this.publish.emit(this.test)}unpublishTest(){this.unpublish.emit(this.test)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-test-table-test-header"]],inputs:{test:"test",expanded:"expanded"},outputs:{toggleHeader:"toggleHeader",publish:"publish",unpublish:"unpublish"},decls:9,vars:5,consts:[[1,"d-flex","flex-column","h-100","justify-content-between"],["role","button",1,"test-designation","d-flex","flex-row","my-3","align-items-end","justify-content-between",3,"click"],[3,"ngClass"],[1,"align-self-start",3,"expanded"],[1,"d-flex","flex-column"],[1,"d-flex","flex-column","mb-3"],[1,"d-flex","align-items-center","justify-content-between","test-status"],[1,"d-flex","flex-row","justify-content-between"],[1,"btn","btn-link","p-0","edit",3,"routerLink"],[1,"material-icons"],[1,"d-flex","btn","btn-link","ps-0","edit",3,"click","title"],[1,"material-icons","me-1"],[1,"expand-mobile",3,"click","expanded"],[1,"d-flex","btn","btn-link","ps-0",3,"click","title"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"div",1),w("click",function(){return n.emitToggleHeader()}),o(2,"div",2),d(3),s(),_(4,"bkd-caret",3),s(),o(5,"div",4),b(6,Ps,12,12,"div",5)(7,Is,9,7,"div",6)(8,Ms,9,7,"div",6),s()()),i&2&&(r(2),g("ngClass",n.expanded?"expanded":"collapsed"),r(),C(" ",n.test.Designation," "),r(),g("expanded",n.expanded),r(2),f(n.expanded?6:-1),r(),f(n.test.IsPublished?7:8))},dependencies:[ue,gn,Ar,Z,Ge,I,Rr],styles:["[_nghost-%COMP%]{font-weight:300}.collapsed[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.test-designation[_ngcontent-%COMP%]{display:none!important}.test-status[_ngcontent-%COMP%]{order:-1;padding-bottom:1rem}.test-status[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.test-status[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#000}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.edit[_ngcontent-%COMP%]{color:#00000080;text-decoration:none}@media (min-width: 811px){.test-designation[_ngcontent-%COMP%]{display:inherit!important}.test-status[_ngcontent-%COMP%]{order:initial}.expand-mobile[_ngcontent-%COMP%]{display:none!important}}"]})}}return t})();var ks=["bkdTestsTableHeader",""],Os=t=>({"test-point-grading":t}),Ds=t=>({selected:t}),_i=(t,l)=>l.Id;function Gs(t,l){if(t&1){let e=D();o(0,"th",3)(1,"bkd-test-table-test-header",12),w("toggleHeader",function(n){x(e);let a=h();return T(a.state.toggleHeader(n))})("publish",function(n){x(e);let a=h();return T(a.publish.emit(n))})("unpublish",function(n){x(e);let a=h();return T(a.unpublish.emit(n))}),s()()}if(t&2){let e=l.$implicit,i=h(),n=O(4);g("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),r(),g("test",e)("expanded",n)}}function Ls(t,l){if(t&1){let e=D();o(0,"th",4)(1,"bkd-test-table-test-header",12),w("toggleHeader",function(n){x(e);let a=h();return T(a.state.toggleHeader(n))})("publish",function(n){x(e);let a=h();return T(a.publish.emit(n))})("unpublish",function(n){x(e);let a=h();return T(a.unpublish.emit(n))}),s()()}if(t&2){let e=l.$implicit,i=h(),n=O(4);g("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),r(),g("test",e)("expanded",n)}}function Fs(t,l){t&1&&(o(0,"div",14),d(1),c(2,"translate"),s()),t&2&&(r(),C(" ",m(2,1,"tests.points")," "))}function $s(t,l){if(t&1){let e=D();o(0,"th",11)(1,"div",13),b(2,Fs,3,3,"div",14),o(3,"bkd-sortable-header",8),c(4,"translate"),z("sortCriteriaChange",function(n){x(e);let a=h();return j(a.state.sortCriteria,n)||(a.state.sortCriteria=n),T(n)}),s()()()}if(t&2){let e=l.$implicit,i=h();g("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),r(2),f(e.IsPointGrading?2:-1),r(),g("label",m(4,5,"tests.grade"))("sortKey","Test-"+e.Id),q("sortCriteria",i.state.sortCriteria)}}var Wr=(()=>{class t extends ii{constructor(){super(...arguments),this.state=u(J),this.publish=new Ce,this.unpublish=new Ce}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=Tt(t)))(n||t)}})()}static{this.\u0275cmp=v({type:t,selectors:[["thead","bkdTestsTableHeader",""]],inputs:{selectedTest:"selectedTest"},outputs:{publish:"publish",unpublish:"unpublish"},features:[Et],attrs:ks,decls:27,vars:29,consts:[[1,"header-collapsible"],["colspan","3",1,"desktop","sticky"],[3,"filterChange","filter"],["container","body",1,"test-grade","grade","test-info-desktop",3,"ngClass"],["container","body","colspan","3",1,"test-grade","header-mobile","test-info-mobile",3,"ngClass"],[1,"filler"],[3,"ngClass"],[1,"sticky","student-name"],[3,"sortCriteriaChange","label","sortKey","sortCriteria"],[1,"sticky","student-grade","desktop",3,"ngClass"],[1,"border-end","sticky","student-average","desktop"],["container","body",1,"test-grade",3,"ngClass"],[3,"toggleHeader","publish","unpublish","test","expanded"],[1,"d-flex"],[1,"point-column-title","me-2","me-md-3"]],template:function(i,n){if(i&1){let a=D();$(0),c(1,"async"),$(2),c(3,"async"),$(4),c(5,"async"),o(6,"tr",0)(7,"th",1)(8,"bkd-tests-table-filter",2),w("filterChange",function(S){return x(a),T(n.state.setFilter(S))}),s()(),R(9,Gs,2,3,"th",3,_i),R(11,Ls,2,3,"th",4,_i),_(13,"th",5),s(),o(14,"tr",6)(15,"th",7)(16,"bkd-sortable-header",8),c(17,"translate"),z("sortCriteriaChange",function(S){return x(a),j(n.state.sortCriteria,S)||(n.state.sortCriteria=S),T(S)}),s()(),o(18,"th",9)(19,"bkd-sortable-header",8),c(20,"translate"),z("sortCriteriaChange",function(S){return x(a),j(n.state.sortCriteria,S)||(n.state.sortCriteria=S),T(S)}),s()(),o(21,"th",10)(22,"bkd-sortable-header",8),c(23,"translate"),z("sortCriteriaChange",function(S){return x(a),j(n.state.sortCriteria,S)||(n.state.sortCriteria=S),T(S)}),s()(),R(24,$s,5,7,"th",11,_i),_(26,"th",5),s()}if(i&2){let a=m(1,12,n.state.filteredTests$),p=m(3,14,n.state.filter$);r(4),U(m(5,16,n.state.expandedHeader$)),r(4),g("filter",p),r(),A(a),r(2),A(a),r(3),g("ngClass",V(25,Os,n.selectedTest==null?null:n.selectedTest.IsPointGrading)),r(2),g("label",m(17,19,"tests.student.name"))("sortKey","FullName"),q("sortCriteria",n.state.sortCriteria),r(2),g("ngClass",V(27,Ds,n.selectedTest===void 0)),r(),g("label",m(20,21,"tests.grade"))("sortKey","FinalGrade"),q("sortCriteria",n.state.sortCriteria),r(3),g("label",m(23,23,"tests.mean"))("sortKey","TestsMean"),q("sortCriteria",n.state.sortCriteria),r(2),A(a)}},dependencies:[te,ue,I,Br,Hr,ot],styles:["[_nghost-%COMP%]{--spacer: 16px;--point-input-size: 4em;--grade-input-size: 127px;--points-grade-gap: 1rem;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-average-column-width: 120px;--test-grade-column-width: calc( var(--spacer) + var(--point-input-size) + var(--points-grade-gap) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--student-average-column-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) );--test-columns-offset: calc( var(--student-average-column-offset) + var(--student-average-column-width) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}@media (max-width: 767.98px){[_nghost-%COMP%]{--points-grade-gap: calc(.5 * var(--spacer))}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (min-width: 576px){[_nghost-%COMP%]{--point-input-size: 5em}}tr[_ngcontent-%COMP%]:not(.header-collapsible)   th.test-grade[_ngcontent-%COMP%], td.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}@media (max-width: 810px){tr[_ngcontent-%COMP%]:not(.header-collapsible):not(.test-point-grading)   th.test-grade[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]:not(.test-point-grading)   th.student-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.test-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.student-grade[_ngcontent-%COMP%]{width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));min-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));max-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer))}}th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}th.test-grade[_ngcontent-%COMP%]   .point-column-title[_ngcontent-%COMP%]{width:var(--point-input-size)}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-average[_ngcontent-%COMP%], .test-grade[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex;width:100%}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.test-grade[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}.student-average[_ngcontent-%COMP%]{width:var(--student-average-column-width);min-width:var(--student-average-column-width);max-width:var(--student-average-column-width)}.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}th.sticky.student-average[_ngcontent-%COMP%], td.sticky.student-average[_ngcontent-%COMP%]{left:var(--student-average-column-offset)}}@media (max-width: 1200px){[_nghost-%COMP%]{--student-average-column-width: 1px}.student-average[_ngcontent-%COMP%]{padding:0;overflow:hidden}}@media (min-width: 1201px){.student-average-inline[_ngcontent-%COMP%]{display:none}}.sticky[_nghost-%COMP%]{position:fixed;top:0;left:0;z-index:1000;display:none}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;vertical-align:top}.header-collapsible[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:0 1rem}tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:none!important}@media (min-width: 811px){.sticky.shown[_nghost-%COMP%]{display:table-header-group}tr[_ngcontent-%COMP%]   th.test-info-mobile[_ngcontent-%COMP%]{display:none!important}tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:table-cell!important}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;padding-top:.25rem;padding-bottom:.25rem;border-top:initial}.sticky[_nghost-%COMP%]{margin-left:var(--test-columns-offset)}.sticky[_nghost-%COMP%]   th.sticky[_ngcontent-%COMP%]{position:fixed}}"],changeDetection:0})}}return t})();var Vs=t=>({"test-point-grading":t}),Nr=t=>({selected:t}),Bs=t=>["student",t,"grades"],Rs=t=>({"visible-on-mobile":t}),As=(t,l)=>l.student.Id,Hs=(t,l)=>l.Id,Ws=(t,l)=>l.id;function Ns(t,l){if(t&1&&(o(0,"div"),d(1),s()),t&2){let e=h().$implicit;r(),C(" ",e.finalGrade.finalGradeValue," ")}}function js(t,l){if(t&1){let e=D();o(0,"bkd-grade-select",19),c(1,"async"),c(2,"async"),w("gradeIdSelected",function(n){x(e);let a=h(2);return T(a.state.overwriteFinalGrade(n))}),s()}if(t&2){let e,i,n=h().$implicit,a=h();g("options",m(1,4,a.state.gradingOptionsForCourse$()))("valueId",(e=n.finalGrade.gradeId)!==null&&e!==void 0?e:null)("gradeId",(i=n.finalGrade.gradingId)!==null&&i!==void 0?i:null)("disabled",m(2,6,a.isEditFinalGradesAllowed(n))===!1)}}function Us(t,l){if(t&1&&($(0),o(1,"td",11),_(2,"bkd-grade",20),c(3,"async"),s()),t&2){let e=l.$implicit,i=l.$index,n=h(),a=n.$implicit,p=n.$index,S=h(),W=e.grade;r(),g("ngClass",S.selectedTest!==void 0&&W.test.Id===S.selectedTest.Id?"selected":""),r(),g("grade",W)("gradeOptions",m(3,6,S.state.gradingOptionsForTest$(W.test)))("student",a.student)("hasFinalGrade",!!a.finalGrade.finalGradeValue)("tabIndex",(1+i)*1e3+p)}}function qs(t,l){if(t&1&&(o(0,"tr")(1,"td",6)(2,"a",15)(3,"div"),d(4),s(),o(5,"div",8),d(6),c(7,"translate"),c(8,"decimalOrDash"),s()()(),o(9,"td",16),b(10,Ns,2,1,"div")(11,js,3,8,"bkd-grade-select",17),s(),o(12,"td",18),d(13),c(14,"decimalOrDash"),s(),R(15,Us,4,8,"td",11,Ws),_(17,"td",12),s()),t&2){let e=l.$implicit,i=h();r(2),g("routerLink",V(15,Bs,e.student.Id)),r(2),y(e.student.FullName),r(2),mt(" ",m(7,7,"tests.mean"),": ",H(8,9,e.finalGrade.average,"1-3")," "),r(3),g("ngClass",V(17,Nr,i.selectedTest===void 0)),r(),f(e.finalGrade.finalGradeValue?10:11),r(3),C(" ",H(14,12,e.finalGrade.average,"1-3")," "),r(2),A(i.getGrades(e))}}function zs(t,l){if(t&1&&(o(0,"td",11),_(1,"bkd-average-grades",21),s()),t&2){let e=l.$implicit,i=h();g("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)||e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),r(),g("test",e)}}function Ks(t,l){if(t&1){let e=D();o(0,"button",22),w("click",function(){x(e);let n=h();return T(n.setAverageAsFinalGrade())}),d(1),c(2,"translate"),s()}if(t&2){let e=h(),i=O(2);g("ngClass",V(4,Rs,!i||!e.selectedTest)),r(),C(" ",m(2,2,"tests.set-final-grade")," ")}}var jr=(()=>{class t{constructor(){this.state=u(J),this.modalService=u(Be),this.destroy$=new se,this.sticky=wt(Ae)}ngOnInit(){this.state.sortCriteria.set({primarySortKey:"FullName",ascending:!0}),X([this.state.filteredTests$,this.state.expandedHeader$]).pipe(we(this.destroy$)).subscribe(()=>this.sticky()?.refresh())}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setAverageAsFinalGrade(){this.state.course$.pipe(ce(1)).subscribe(e=>this.state.setAveragesAsFinalGrades({CourseIds:[e.Id]}))}isEditFinalGradesAllowed(e){return this.state.course$.pipe(E(i=>!!(Xt(i)?.value&&e.finalGrade?.canGrade)))}getGrades(e){return e.grades.flatMap(i=>({id:`${e.student.Id}-${i.test.Id}`,grade:i}))}publish(e){let i=this.openModal(e);this.onCloseModal(i,()=>this.state.publish(e))}unpublish(e){let i=this.openModal(e);this.onCloseModal(i,()=>this.state.unpublish(e))}calculatePointsAverage(e){return this.safeAverage(e,Ht)}calculateGradeAverage(e){return this.safeAverage(e,Wt)}safeAverage(e,i){try{return i(e).toString()}catch{return"\u2013"}}openModal(e){let i=this.modalService.open(Gr);return i.componentInstance.test=e,i}onCloseModal(e,i){e.result.then(n=>{n&&i()},()=>{})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-table"]],viewQuery:function(i,n){i&1&&Pt(n.sticky,Ae,5),i&2&&It()},inputs:{selectedTest:"selectedTest"},features:[me([st])],decls:40,vars:45,consts:[["inlineHeader",""],["stickyHeader",""],[1,"table-responsive-wrapper"],["bkdTableHeaderSticky","",1,"table","table-hover","h-100",3,"ngClass","inlineHeader","stickyHeader"],["bkdTestsTableHeader","",3,"publish","unpublish","selectedTest"],["bkdTestsTableHeader","",3,"publish","unpublish","sticky","selectedTest"],[1,"sticky","student-name"],[1,"d-flex","flex-column"],[1,"student-average-inline"],[1,"desktop","sticky","student-grade",3,"ngClass"],[1,"desktop","border-end","sticky","student-average"],[1,"test-grade",3,"ngClass"],[1,"filler"],[1,"action-buttons"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"ngClass"],[3,"routerLink"],[1,"sticky","student-grade",3,"ngClass"],[3,"options","valueId","gradeId","disabled"],[1,"border-end","sticky","student-average"],[3,"gradeIdSelected","options","valueId","gradeId","disabled"],[3,"grade","gradeOptions","student","hasFinalGrade","tabIndex"],[3,"test"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"click","ngClass"]],template:function(i,n){if(i&1){let a=D();$(0),c(1,"async"),$(2),c(3,"async"),$(4),c(5,"async"),o(6,"div",2)(7,"table",3)(8,"thead",4,0),w("publish",function(S){return x(a),T(n.publish(S))})("unpublish",function(S){return x(a),T(n.unpublish(S))}),s(),o(10,"thead",5,1),w("publish",function(S){return x(a),T(n.publish(S))})("unpublish",function(S){return x(a),T(n.unpublish(S))}),s(),o(12,"tbody"),R(13,qs,18,19,"tr",null,As),o(15,"tr")(16,"td",6)(17,"div",7)(18,"div"),d(19),c(20,"translate"),s(),o(21,"div",8),d(22),c(23,"translate"),c(24,"async"),c(25,"decimalOrDash"),s()()(),o(26,"td",9),d(27),c(28,"async"),c(29,"decimalOrDash"),s(),o(30,"td",10),d(31),c(32,"async"),c(33,"decimalOrDash"),s(),R(34,zs,2,2,"td",11,Hs),_(36,"td",12),s()()(),o(37,"div",13),b(38,Ks,3,6,"button",14),c(39,"async"),s()()}if(i&2){let a=xe(9),p=xe(11),S=m(1,13,n.state.filteredTests$);r(2),U(m(3,15,n.state.hasTests$));let W=m(5,18,n.state.studentGrades$);r(5),g("ngClass",V(41,Vs,n.selectedTest==null?null:n.selectedTest.IsPointGrading))("inlineHeader",a)("stickyHeader",p),r(),g("selectedTest",n.selectedTest),r(2),g("sticky",!0)("selectedTest",n.selectedTest),r(3),A(W),r(6),y(m(20,20,"tests.average")),r(3),mt(" ",m(23,22,"tests.mean"),": ",H(25,26,m(24,24,n.state.meanOfStudentGradesForCourse$),"1-3")," "),r(4),g("ngClass",V(43,Nr,n.selectedTest===void 0)),r(),C(" ",H(29,31,m(28,29,n.state.meanOfFinalGradesForCourse$),"1-3")," "),r(4),C(" ",H(33,36,m(32,34,n.state.meanOfStudentGradesForCourse$),"1-3")," "),r(3),A(S),r(4),f(m(39,39,n.state.canSetFinalGrade$)?38:-1)}},dependencies:[ue,Z,Fr,$r,Lr,te,I,jt,Ae,Wr],styles:["[_nghost-%COMP%]{--spacer: 16px;--point-input-size: 4em;--grade-input-size: 127px;--points-grade-gap: 1rem;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-average-column-width: 120px;--test-grade-column-width: calc( var(--spacer) + var(--point-input-size) + var(--points-grade-gap) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--student-average-column-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) );--test-columns-offset: calc( var(--student-average-column-offset) + var(--student-average-column-width) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}@media (max-width: 767.98px){[_nghost-%COMP%]{--points-grade-gap: calc(.5 * var(--spacer))}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (min-width: 576px){[_nghost-%COMP%]{--point-input-size: 5em}}tr[_ngcontent-%COMP%]:not(.header-collapsible)   th.test-grade[_ngcontent-%COMP%], td.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}@media (max-width: 810px){tr[_ngcontent-%COMP%]:not(.header-collapsible):not(.test-point-grading)   th.test-grade[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]:not(.test-point-grading)   th.student-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.test-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.student-grade[_ngcontent-%COMP%]{width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));min-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));max-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer))}}th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}th.test-grade[_ngcontent-%COMP%]   .point-column-title[_ngcontent-%COMP%]{width:var(--point-input-size)}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-average[_ngcontent-%COMP%], .test-grade[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex;width:100%}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.test-grade[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}.student-average[_ngcontent-%COMP%]{width:var(--student-average-column-width);min-width:var(--student-average-column-width);max-width:var(--student-average-column-width)}.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}th.sticky.student-average[_ngcontent-%COMP%], td.sticky.student-average[_ngcontent-%COMP%]{left:var(--student-average-column-offset)}}@media (max-width: 1200px){[_nghost-%COMP%]{--student-average-column-width: 1px}.student-average[_ngcontent-%COMP%]{padding:0;overflow:hidden}}@media (min-width: 1201px){.student-average-inline[_ngcontent-%COMP%]{display:none}}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child{text-decoration:underline}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}.student-average-inline[_ngcontent-%COMP%]{color:#4e4e4ef2;font-size:.875rem;line-height:1}@media (min-width: 811px){.table-responsive-wrapper[_ngcontent-%COMP%]{display:block;overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.action-buttons[_ngcontent-%COMP%]{position:sticky;left:0}}@media (max-width: 810px){.apply-average-button[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]})}}return t})();var Ys=()=>[],Qs=t=>({"visible-on-mobile":t}),Xs=t=>["/events",t,"evaluation"],Zs=t=>({returnlink:t});function Js(t,l){t&1&&_(0,"bkd-spinner")}function el(t,l){if(t&1){let e=D();o(0,"bkd-select",4),w("valueChange",function(n){x(e);let a=h(2);return T(n&&a.testSelected(n))}),s(),_(1,"bkd-tests-table",5)}if(t&2){h(2);let e=O(6),i=O(8),n=O(10);g("options",e)("value",i)("allowEmpty",!1),r(),g("selectedTest",n)}}function tl(t,l){t&1&&(o(0,"p",2),d(1),c(2,"translate"),s()),t&2&&(r(),y(m(2,1,"tests.no-tests")))}function il(t,l){if(t&1&&(o(0,"a",3)(1,"i",6),d(2,"arrow_right_alt"),s(),o(3,"span",7),d(4),c(5,"translate"),s()()),t&2){h(2);let e=O(0),i=O(4),n=O(10);g("ngClass",V(6,Qs,!i||!n))("routerLink",V(8,Xs,e==null?null:e.Id))("queryParams",V(10,Zs,"/events/"+(e==null?null:e.Id)+"/tests")),r(4),y(m(5,4,"tests.link-to-rating-overview"))}}function nl(t,l){if(t&1&&(_(0,"bkd-tests-header",1),b(1,el,2,4)(2,tl,3,3,"p",2)(3,il,6,12,"a",3),c(4,"async")),t&2){let e=h(),i=O(0),n=O(2);g("course",i),r(),f(n.length>0?1:2),r(2),f(i&&m(4,3,e.state.canSetFinalGrade$)?3:-1)}}var Ur=(()=>{class t{constructor(){this.settings=u(ge),this.state=u(J),this.translate=u(ie),this.selectTest$=new se,this.testOptions$=this.state.tests$.pipe(E(e=>[{Key:-1,Value:this.translate.instant("tests.grade")},...e.map(i=>({Key:i.Id,Value:i.Designation}))]),ae()),this.selectedTestId$=bt(this.selectTest$,this.state.tests$.pipe(ce(1),E(e=>e[0]?.Id))).pipe(ae()),this.selectedTest$=this.selectedTestId$.pipe(G(e=>this.state.tests$.pipe(E(i=>i.find(n=>n.Id===e)))),ae())}testSelected(e){this.selectTest$.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests-list"]],decls:16,vars:22,consts:[[1,"bkd-container"],[3,"course"],[1,"mt-3","px-3"],[1,"rating-overview","d-flex","justify-content-end","pe-3","border-top","pt-3",3,"ngClass","routerLink","queryParams"],["width","100%",1,"tests-dropdown",3,"valueChange","options","value","allowEmpty"],[3,"selectedTest"],[1,"material-icons","fw-bold"],[1,"ps-1"]],template:function(i,n){if(i&1&&($(0),c(1,"async"),$(2),c(3,"async"),$(4),c(5,"async"),$(6),c(7,"async"),$(8),c(9,"async"),$(10),c(11,"async"),o(12,"div",0),b(13,Js,1,0,"bkd-spinner"),c(14,"async"),b(15,nl,5,5),s()),i&2){let a;U(m(1,1,n.state.course$)),r(2),U((a=m(3,4,n.state.tests$))!==null&&a!==void 0?a:ze(21,Ys)),r(2),U(m(5,7,n.state.hasTests$)),r(2),U(m(7,10,n.testOptions$)),r(2),U(m(9,13,n.selectedTestId$)),r(2),U(m(11,16,n.selectedTest$)),r(3),f(m(14,19,n.state.loading$)?13:15)}},dependencies:[Dr,ye,jr,ue,fe,te,I,Z],styles:[".tests-dropdown[_ngcontent-%COMP%]{display:block;padding:1rem 0}@media (min-width: 811px){.tests-dropdown[_ngcontent-%COMP%]{display:none}}a.rating-overview[_ngcontent-%COMP%]{text-decoration:none}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}@media (max-width: 810px){a.rating-overview[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]})}}return t})();var qr=(()=>{class t{constructor(){this.state=u(J),this.route=u(he),this.courseId$=this.route.paramMap.pipe(E(e=>Number(e.get("id"))),ae()),this.destroy$=new se}ngOnInit(){this.courseId$.pipe(we(this.destroy$)).subscribe(e=>this.state.setCourseId(e))}ngOnDestroy(){this.destroy$.next()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-tests"]],features:[me([J])],decls:1,vars:0,template:function(i,n){i&1&&_(0,"router-outlet")},dependencies:[Le],encapsulation:2})}}return t})();var zr=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["bkd-events-current-list"]],decls:4,vars:5,consts:[[3,"withStudyCourses","withRatings"]],template:function(i,n){i&1&&(o(0,"h1"),d(1),c(2,"translate"),s(),_(3,"bkd-events-list",0)),i&2&&(r(),y(m(2,3,"events.current.title")),r(2),g("withStudyCourses",!0)("withRatings",!1))},dependencies:[oi,I],encapsulation:2,changeDetection:0})}}return t})();var UC=[{path:"",component:$n,children:[{path:"current",children:[{path:"",component:zr},Kr(":id")]},{path:"",component:Pr},{path:":id",component:qr,children:[{path:"tests",children:[{path:"",component:Ur},{path:":testId/edit",component:Or},{path:"add",component:Mr},Ut]},{path:"evaluation",component:ur,children:[{path:"",component:dr},{path:"statistic",component:mr},Ut]},Kr("students")]}]}];function Kr(t){return{path:t,component:Tr,children:[{path:"",component:Sr},{path:"study-course-student/:id",component:xr},Ut]}}export{Gn as a,UC as b,Kr as c};
