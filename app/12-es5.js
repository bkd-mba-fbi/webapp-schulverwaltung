!function(){function e(n,t,c){return(e="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,n,t){var c=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=i(e)););return e}(e,n);if(c){var r=Object.getOwnPropertyDescriptor(c,n);return r.get?r.get.call(t):r.value}})(n,t,c||n)}function n(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&t(e,n)}function t(e,n){return(t=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function c(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var t,c=i(e);if(n){var s=i(this).constructor;t=Reflect.construct(c,arguments,s)}else t=c.apply(this,arguments);return r(this,t)}}function r(e,n){return!n||"object"!=typeof n&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==t)return;var c,r,i=[],s=!0,a=!1;try{for(t=t.call(e);!(s=(c=t.next()).done)&&(i.push(c.value),!n||i.length!==n);s=!0);}catch(o){a=!0,r=o}finally{try{s||null==t.return||t.return()}finally{if(a)throw r}}return i}(e,n)||o(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,n){if(e){if("string"==typeof e)return l(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?l(e,n):void 0}}function l(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,c=new Array(n);t<n;t++)c[t]=e[t];return c}function u(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function b(e,n){for(var t=0;t<n.length;t++){var c=n[t];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function f(e,n,t){return n&&b(e.prototype,n),t&&b(e,t),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{CZtb:function(t,r,o){"use strict";o.r(r),o.d(r,"MyAbsencesModule",function(){return Jn});var l,b,d,p=o("PCNd"),g=o("tyNb"),m=o("jtHE"),y=o("itXk"),h=o("eIep"),v=o("UXun"),S=o("pLZG"),k=o("lJxs"),I=o("IzEk"),O=o("JX91"),R=o("oB13"),z=o("x+ZX"),C=o("Xr/R"),$=o("fbMX"),j=o("mmcK"),T=o("IClS"),D=o("K+0v"),P=o("eB9A"),F=o("fXoL"),M=((b=function(){function e(n,t,c){var r;u(this,e),this.settings=n,this.storageService=t,this.studentsService=c,this.studentId$=new m.a(1),this.lessonAbsences$=this.studentId$.pipe(Object(h.a)(this.loadLessonAbsences.bind(this)),Object(v.a)(1)),this.lessonIncidents$=this.studentId$.pipe(Object(h.a)(this.loadLessonIncidents.bind(this)),Object(v.a)(1)),this.lessonPresences$=this.getLessonPresences(),this.checkableAbsences$=this.getAbsences(this.settings.checkableAbsenceStateId),this.openAbsences$=this.getAbsences(this.settings.unconfirmedAbsenceStateId),this.excusedAbsences$=this.getAbsences(this.settings.excusedAbsenceStateId),this.unexcusedAbsences$=this.getAbsences(this.settings.unexcusedAbsenceStateId),this.incidents$=this.getAbsences(null),this.openLessonAbsences$=Object(y.a)([this.openAbsences$.pipe(Object(S.a)(D.e)),this.lessonAbsences$]).pipe(Object(k.a)(Object(P.a)(this.getOpenLessonAbsences.bind(this))),Object(v.a)(1)),this.counts$=this.getCounts();var i=(null===(r=this.storageService.getPayload())||void 0===r?void 0:r.id_person)||null;i&&this.studentId$.next(i)}return f(e,[{key:"reset",value:function(){var e=this;this.studentId$.pipe(Object(I.a)(1)).subscribe(function(n){return e.studentId$.next(n)})}},{key:"getLessonPresences",value:function(){var e=this;return this.getCached(Object(y.a)([this.studentId$,this.lessonAbsences$,this.lessonIncidents$]).pipe(Object(h.a)(function(n){var t=a(n,3),c=t[0],r=t[1],i=t[2];return e.loadTimetableEntries(c,r,i).pipe(Object(k.a)(function(n){return e.buildLessonPresences(r,i,n)}))}),Object(k.a)(T.c)))}},{key:"getAbsences",value:function(e){return this.getCached(this.lessonPresences$.pipe(Object(k.a)(function(n){return(null==n?void 0:n.filter(function(n){return n.ConfirmationStateId===e}))||null})))}},{key:"getOpenLessonAbsences",value:function(e,n){var t=e.map(function(e){return e.LessonRef.Id});return n.filter(function(e){return t.includes(e.LessonRef.Id)})}},{key:"getCounts",value:function(){return Object(y.a)([this.getCount(this.checkableAbsences$),this.getCount(this.openAbsences$),this.getCount(this.excusedAbsences$),this.getCount(this.unexcusedAbsences$),this.getCount(this.incidents$)]).pipe(Object(k.a)(function(e){var n=a(e,5);return{checkableAbsences:n[0],openAbsences:n[1],excusedAbsences:n[2],unexcusedAbsences:n[3],incidents:n[4],halfDays:null}}))}},{key:"getCached",value:function(e){return e.pipe(Object(O.a)(null),Object(R.a)(function(){return new m.a(1)}),Object(z.a)())}},{key:"getCount",value:function(e){return e.pipe(Object(k.a)(function(e){var n;return null!==(n=null==e?void 0:e.length)&&void 0!==n?n:null}))}},{key:"loadLessonAbsences",value:function(e){return this.studentsService.getLessonAbsences(e)}},{key:"loadLessonIncidents",value:function(e){return this.studentsService.getLessonIncidents(e)}},{key:"loadTimetableEntries",value:function(e,n,t){return this.studentsService.getTimetableEntries(e,{"filter.Id":";".concat([].concat(s(n),s(t)).map(function(e){return e.LessonRef.Id}).join(";")),fields:"Id,From,To,EventNumber,EventDesignation,EventManagerInformation"})}},{key:"buildLessonPresences",value:function(e,n,t){var c=this;return[].concat(s(e),s(n)).map(function(e){return c.buildLessonPresence(e,t)}).filter(D.e)}},{key:"buildLessonPresence",value:function(e,n){var t=n.find(function(n){return n.Id===e.LessonRef.Id});return t?{Id:"",LessonRef:{Id:e.LessonRef.Id,HRef:e.LessonRef.HRef?e.LessonRef.HRef:null},StudentRef:e.StudentRef,EventRef:{Id:0,HRef:null},TypeRef:e.TypeRef,RegistrationRef:{Id:0,HRef:null},StudyClassRef:{Id:0,HRef:null},ConfirmationStateId:"ConfirmationStateId"in e?e.ConfirmationStateId:null,EventDesignation:t.EventDesignation,HasStudyCourseConfirmationCode:!1,LessonDateTimeFrom:t.From,LessonDateTimeTo:t.To,Comment:null,Date:t.From,Type:e.Type,StudentFullName:e.StudentFullName,StudyClassNumber:"",TeacherInformation:t.EventManagerInformation}:null}}]),e}()).\u0275fac=function(e){return new(e||b)(F.Zb(C.a),F.Zb($.a),F.Zb(j.a))},b.\u0275prov=F.Ib({token:b,factory:b.\u0275fac}),b),L=((l=function(){function e(){u(this,e)}return f(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||l)},l.\u0275cmp=F.Gb({type:l,selectors:[["erz-my-absences"]],features:[F.yb([M])],decls:1,vars:0,template:function(e,n){1&e&&F.Nb(0,"router-outlet")},directives:[g.k],styles:[""],changeDetection:0}),l),A=o("XNiG"),w=o("LRne"),x=o("5QKP"),B=o("Ug8t"),_=o("8teX"),E=o("BeL+"),N=o("tPH9"),H=o("ylTp"),G=o("9f76"),Q=o("/1FC"),U=H.a?H.a.isConcatSpreadable:void 0,Z=function(e){return Object(Q.a)(e)||Object(G.a)(e)||!!(U&&e&&e[U])},X=function e(n,t,c,r,i){var s=-1,a=n.length;for(c||(c=Z),i||(i=[]);++s<a;){var o=n[s];t>0&&c(o)?t>1?e(o,t-1,c,r,i):Object(N.a)(i,o):r||(i[i.length]=o)}return i},q=function(e){return null!=e&&e.length?X(e,1):[]},K=o("EOpz"),J=o("1kSV"),Y=o("sYmb"),V=["link"],W=function(){return["/my-absences/report"]},ee=((d=function(){function e(){u(this,e)}return f(e,[{key:"onClick",value:function(){this.link.nativeElement.click()}},{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||d)},d.\u0275cmp=F.Gb({type:d,selectors:[["erz-my-absences-report-link"]],viewQuery:function(e,n){var t;1&e&&F.Jc(V,1),2&e&&F.tc(t=F.ec())&&(n.link=t.first)},hostBindings:function(e,n){1&e&&F.dc("click",function(e){return n.onClick(e)})},decls:8,vars:5,consts:[[1,"m-0"],[1,"btn","btn-link","p-0",3,"routerLink"],["link",""],[1,"d-flex","align-items-center"],[1,"material-icons"]],template:function(e,n){1&e&&(F.Sb(0,"h5",0),F.Dc(1),F.gc(2,"translate"),F.Rb(),F.Sb(3,"a",1,2),F.Sb(5,"div",3),F.Sb(6,"i",4),F.Dc(7,"keyboard_arrow_right"),F.Rb(),F.Rb(),F.Rb()),2&e&&(F.zb(1),F.Fc(" ",F.hc(2,2,"my-absences.report.title"),"\n"),F.zb(2),F.lc("routerLink",F.oc(4,W)))},directives:[g.i],pipes:[Y.c],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1.5rem;cursor:pointer}.btn[_ngcontent-%COMP%]{color:#33333d;text-decoration:none}"],changeDetection:0}),d),ne=o("4vw6"),te=o("ofXK"),ce=o("ZLMY");function re(e,n){1&e&&F.Nb(0,"erz-my-absences-report-link")}function ie(e,n){}function se(e,n){if(1&e&&(F.Qb(0),F.Dc(1),F.Pb()),2&e){var t=F.fc(2).erzLet;F.zb(1),F.Fc("(",t.absenceCounts.checkableAbsences,")")}}function ae(e,n){if(1&e){var t=F.Tb();F.Sb(0,"erz-student-profile-entry-header",12),F.dc("click",function(){return F.vc(t),F.fc(),F.uc(2).toggle("checkable-absences")}),F.Dc(1),F.gc(2,"translate"),F.Bc(3,se,2,1,"ng-container",13),F.Rb()}if(2&e){var c=n.opened,r=F.fc().erzLet;F.lc("opened",c),F.zb(1),F.Fc(" ",F.hc(2,3,"shared.profile.checkable-absences")," "),F.zb(2),F.lc("ngIf",null!=r.absenceCounts.checkableAbsences)}}function oe(e,n){if(1&e&&F.Nb(0,"erz-student-profile-absences",14),2&e){var t=F.fc(2);F.lc("absences$",t.myAbsencesService.checkableAbsences$)}}function le(e,n){if(1&e&&(F.Qb(0),F.Dc(1),F.Pb()),2&e){var t=F.fc(2).erzLet;F.zb(1),F.Fc("(",t.absenceCounts.openAbsences,")")}}function ue(e,n){if(1&e){var t=F.Tb();F.Sb(0,"erz-student-profile-entry-header",12),F.dc("click",function(){return F.vc(t),F.fc(),F.uc(2).toggle("open-absences")}),F.Dc(1),F.gc(2,"translate"),F.Bc(3,le,2,1,"ng-container",13),F.Rb()}if(2&e){var c=n.opened,r=F.fc().erzLet;F.lc("opened",c),F.zb(1),F.Fc(" ",F.hc(2,3,"shared.profile.open-absences")," "),F.zb(2),F.lc("ngIf",null!=r.absenceCounts.openAbsences)}}function be(e,n){if(1&e&&(F.Nb(0,"erz-student-profile-absences",15),F.gc(1,"translate"),F.gc(2,"async"),F.gc(3,"async")),2&e){var t=F.fc(2);F.lc("absences$",t.myAbsencesService.openAbsences$)("selectionService",t.absencesSelectionService)("defaultAbsenceSelectionMessage",F.hc(1,5,"my-absences.show.default-absence-selection-message"))("reportUrl",F.hc(2,7,t.reportUrl$))("reportAvailable",F.hc(3,9,t.reportAvailable$))}}function fe(e,n){if(1&e&&(F.Qb(0),F.Dc(1),F.Pb()),2&e){var t=F.fc(2).erzLet;F.zb(1),F.Fc("(",t.absenceCounts.excusedAbsences,")")}}function de(e,n){if(1&e){var t=F.Tb();F.Sb(0,"erz-student-profile-entry-header",12),F.dc("click",function(){return F.vc(t),F.fc(),F.uc(2).toggle("excused-absences")}),F.Dc(1),F.gc(2,"translate"),F.Bc(3,fe,2,1,"ng-container",13),F.Rb()}if(2&e){var c=n.opened,r=F.fc().erzLet;F.lc("opened",c),F.zb(1),F.Fc(" ",F.hc(2,3,"shared.profile.excused-absences")," "),F.zb(2),F.lc("ngIf",null!=r.absenceCounts.excusedAbsences)}}function pe(e,n){if(1&e&&F.Nb(0,"erz-student-profile-absences",14),2&e){var t=F.fc(2);F.lc("absences$",t.myAbsencesService.excusedAbsences$)}}function ge(e,n){if(1&e&&(F.Qb(0),F.Dc(1),F.Pb()),2&e){var t=F.fc(2).erzLet;F.zb(1),F.Fc("(",t.absenceCounts.unexcusedAbsences,")")}}function me(e,n){if(1&e){var t=F.Tb();F.Sb(0,"erz-student-profile-entry-header",12),F.dc("click",function(){return F.vc(t),F.fc(),F.uc(2).toggle("unexcused-absences")}),F.Dc(1),F.gc(2,"translate"),F.Bc(3,ge,2,1,"ng-container",13),F.Rb()}if(2&e){var c=n.opened,r=F.fc().erzLet;F.lc("opened",c),F.zb(1),F.Fc(" ",F.hc(2,3,"shared.profile.unexcused-absences")," "),F.zb(2),F.lc("ngIf",null!=r.absenceCounts.unexcusedAbsences)}}function ye(e,n){if(1&e&&F.Nb(0,"erz-student-profile-absences",16),2&e){var t=F.fc(2);F.lc("absences$",t.myAbsencesService.unexcusedAbsences$)("displayPresenceType",!1)}}function he(e,n){if(1&e&&(F.Qb(0),F.Dc(1),F.Pb()),2&e){var t=F.fc(2).erzLet;F.zb(1),F.Fc("(",t.absenceCounts.incidents,")")}}function ve(e,n){if(1&e){var t=F.Tb();F.Sb(0,"erz-student-profile-entry-header",12),F.dc("click",function(){return F.vc(t),F.fc(),F.uc(2).toggle("incidents")}),F.Dc(1),F.gc(2,"translate"),F.Bc(3,he,2,1,"ng-container",13),F.Rb()}if(2&e){var c=n.opened,r=F.fc().erzLet;F.lc("opened",c),F.zb(1),F.Fc(" ",F.hc(2,3,"shared.profile.incidents")," "),F.zb(2),F.lc("ngIf",null!=r.absenceCounts.incidents)}}function Se(e,n){if(1&e&&F.Nb(0,"erz-student-profile-absences",14),2&e){var t=F.fc(2);F.lc("absences$",t.myAbsencesService.incidents$)}}function ke(e,n){1&e&&(F.Sb(0,"div",1),F.Sb(1,"ngb-accordion",2,3),F.Sb(3,"ngb-panel",4),F.Bc(4,re,1,0,"ng-template",5),F.Bc(5,ie,0,0,"ng-template",6),F.Rb(),F.Sb(6,"ngb-panel",7),F.Bc(7,ae,4,5,"ng-template",5),F.Bc(8,oe,1,1,"ng-template",6),F.Rb(),F.Sb(9,"ngb-panel",8),F.Bc(10,ue,4,5,"ng-template",5),F.Bc(11,be,4,11,"ng-template",6),F.Rb(),F.Sb(12,"ngb-panel",9),F.Bc(13,de,4,5,"ng-template",5),F.Bc(14,pe,1,1,"ng-template",6),F.Rb(),F.Sb(15,"ngb-panel",10),F.Bc(16,me,4,5,"ng-template",5),F.Bc(17,ye,1,2,"ng-template",6),F.Rb(),F.Sb(18,"ngb-panel",11),F.Bc(19,ve,4,5,"ng-template",5),F.Bc(20,Se,1,1,"ng-template",6),F.Rb(),F.Rb(),F.Rb())}var Ie,Oe,Re=function(e){return{absenceCounts:e}},ze=((Ie=function(){function e(n,t,c){u(this,e),this.reportsService=n,this.myAbsencesService=t,this.absencesSelectionService=c,this.reportUrl$=this.loadReportUrl(),this.reportAvailable$=this.reportsService.studentConfirmationAvailability$,this.destroy$=new A.a}return f(e,[{key:"ngOnInit",value:function(){var e=this;this.myAbsencesService.openLessonAbsences$.pipe(Object(I.a)(1),Object(S.a)(Object(D.d)(_.b))).subscribe(function(n){return e.reportsService.setStudentConfirmationAvailabilityRecordIds(n.map(function(e){return"".concat(e.LessonRef.Id,"_").concat(e.RegistrationId)}))})}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"loadReportUrl",value:function(){var e=this;return Object(y.a)([this.absencesSelectionService.selectedWithoutPresenceType$,this.absencesSelectionService.selectedIds$]).pipe(Object(h.a)(function(n){var t=a(n,2),c=t[0],r=t[1];return 0===c.length&&r.length>0?e.getReportRecordIds(Object(E.a)(q(r.map(function(e){return e.lessonIds})))):Object(w.a)(null)}),Object(k.a)(function(n){return n?e.reportsService.getStudentConfirmationUrl(n):null}))}},{key:"getReportRecordIds",value:function(e){return this.myAbsencesService.openLessonAbsences$.pipe(Object(k.a)(function(n){return n.filter(function(n){return e.includes(n.LessonRef.Id)}).map(function(e){return"".concat(e.LessonRef.Id,"_").concat(e.RegistrationId)})}))}}]),e}()).\u0275fac=function(e){return new(e||Ie)(F.Mb(B.a),F.Mb(M),F.Mb(x.a))},Ie.\u0275cmp=F.Gb({type:Ie,selectors:[["erz-my-absences-show"]],decls:2,vars:5,consts:[["class","erz-container erz-container-padding-y erz-container-padding-x-responsive",4,"erzLet"],[1,"erz-container","erz-container-padding-y","erz-container-padding-x-responsive"],["ngb-accordion",""],["acc","ngbAccordion"],["id","report-absence"],["ngbPanelHeader",""],["ngbPanelContent",""],["id","checkable-absences"],["id","open-absences"],["id","excused-absences"],["id","unexcused-absences"],["id","incidents"],[3,"opened","click"],[4,"ngIf"],[3,"absences$"],[3,"absences$","selectionService","defaultAbsenceSelectionMessage","reportUrl","reportAvailable"],[3,"absences$","displayPresenceType"]],template:function(e,n){1&e&&(F.Bc(0,ke,21,0,"div",0),F.gc(1,"async")),2&e&&F.lc("erzLet",F.pc(3,Re,F.hc(1,1,n.myAbsencesService.counts$)))},directives:[K.a,J.a,J.m,J.o,J.n,ee,ne.a,te.m,ce.a],pipes:[te.b,Y.c],styles:[""],changeDetection:0}),Ie),Ce=o("3Pt+"),$e=o("2Vo4"),je=o("wO+i"),Te=o("nYR2"),De=o("LpL1"),Pe=o("KJh6"),Fe=o("A6ef"),Me=o("5eHb"),Le=((Oe=function(){function e(n,t,c,r,i,o,l,b){u(this,e),this.fb=n,this.router=t,this.toastr=c,this.translate=r,this.presenceTypesService=i,this.updateService=o,this.storageService=l,this.settings=b,this.formGroup=this.createFormGroup(),this.saving$=new $e.a(!1),this.submitted$=new $e.a(!1),this.absenceTypes$=Object(y.a)([this.getConfirmationTypes(),this.getHalfDayType()]).pipe(Object(k.a)(function(e){var n=a(e,2),t=n[0],c=n[1];return c?[].concat(s(t),[c]):t})),this.absenceTypeIdErrors$=Object(Fe.c)(Object(w.a)(this.formGroup),this.submitted$,"absenceTypeId"),this.confirmationStateId=null,this.destroy$=new A.a}return f(e,[{key:"ngOnInit",value:function(){var e=this;this.selectedLessonIds$.pipe(Object(I.a)(1),Object(S.a)(_.b)).subscribe(function(){return e.navigateBack()})}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"onSubmit",value:function(){if(this.submitted$.next(!0),this.formGroup.valid){var e=this.formGroup.value.absenceTypeId;this.save(e)}}},{key:"cancel",value:function(){this.navigateBack()}},{key:"getSelectedCount",value:function(){return this.selectedLessonIds$.pipe(Object(je.a)("length"))}},{key:"getConfirmationTypes",value:function(){var e=this;return this.presenceTypesService.confirmationTypes$.pipe(Object(k.a)(function(n){return n.filter(function(n){return n.IsAbsence&&n.Id!==e.settings.halfDayPresenceTypeId})}))}},{key:"getHalfDayType",value:function(){return Object(w.a)(null)}},{key:"createFormGroup",value:function(){return this.fb.group({absenceTypeId:[null,Ce.q.required]})}},{key:"save",value:function(e){var n=this;this.saving$.next(!0),this.selectedLessonIds$.pipe(Object(I.a)(1),Object(h.a)(function(t){var c;return n.updateService.editLessonPresences(t,[Number(null===(c=n.storageService.getPayload())||void 0===c?void 0:c.id_person)],e)}),Object(Te.a)(function(){return n.saving$.next(!1)})).subscribe(this.onSaveSuccess.bind(this))}},{key:"onSaveSuccess",value:function(){this.toastr.success(this.translate.instant("my-absences.confirm.save-success")),this.navigateBack()}}]),e}()).\u0275fac=function(e){return new(e||Oe)(F.Mb(Ce.c),F.Mb(g.g),F.Mb(Me.b),F.Mb(Y.d),F.Mb(Pe.a),F.Mb(De.a),F.Mb($.a),F.Mb(C.b))},Oe.\u0275cmp=F.Gb({type:Oe,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,n){},encapsulation:2}),Oe),Ae=function(e){return{count:e}};function we(e,n){if(1&e&&(F.Sb(0,"div",10),F.Dc(1),F.gc(2,"translate"),F.Rb()),2&e){var t=n.erzLet;F.zb(1),F.Fc(" ",F.ic(2,1,1===t?"my-absences.confirm.lesson-selected":"my-absences.confirm.lessons-selected",F.pc(4,Ae,t))," ")}}function xe(e,n){if(1&e&&(F.Sb(0,"div",16),F.Dc(1),F.gc(2,"translate"),F.Rb()),2&e){var t=n.$implicit;F.zb(1),F.Fc(" ",F.ic(2,1,"global.validation-errors."+t.error,t.params)," ")}}function Be(e,n){if(1&e&&(F.Qb(0),F.Bc(1,xe,3,4,"div",15),F.gc(2,"async"),F.Pb()),2&e){var t=F.fc(2);F.zb(1),F.lc("ngForOf",F.hc(2,1,t.absenceTypeIdErrors$))}}var _e=function(e){return{"border-top pt-3":e}};function Ee(e,n){if(1&e&&(F.Sb(0,"div",11),F.Nb(1,"input",12),F.gc(2,"async"),F.Sb(3,"label",13),F.Dc(4),F.Rb(),F.Bc(5,Be,3,3,"ng-container",14),F.gc(6,"async"),F.Rb()),2&e){var t,c=n.$implicit,r=n.index,i=F.fc();F.lc("ngClass",F.pc(12,_e,c.IsHalfDay)),F.zb(1),F.Eb("is-invalid",F.hc(2,8,i.absenceTypeIdErrors$).length>0),F.lc("id","absence-type-"+r)("value",c.Id),F.zb(2),F.lc("for","absence-type-"+r),F.zb(1),F.Fc(" ",c.Designation," "),F.zb(1),F.lc("ngIf",(null==(t=F.hc(6,10,i.absenceTypes$))?null:t.length)-1===r)}}function Ne(e,n){1&e&&(F.Sb(0,"div",17),F.Sb(1,"span",18),F.Dc(2,"Loading..."),F.Rb(),F.Rb())}var He,Ge,Qe,Ue,Ze,Xe=((He=function(t){n(s,t);var r=c(s);function s(e,n,t,c,i,a,o,l,b,f){var d;return u(this,s),(d=r.call(this,e,n,t,c,i,a,o,l)).myAbsencesService=b,d.selectionService=f,d.selectedLessonIds$=d.selectionService.selectedIds$.pipe(Object(k.a)(function(e){return Object(E.a)(q(e.map(function(e){return e.lessonIds})))})),d.confirmationStateId=d.settings.unconfirmedAbsencesRefreshTime,d}return f(s,[{key:"onSaveSuccess",value:function(){this.selectionService.clear(),this.myAbsencesService.reset(),e(i(s.prototype),"onSaveSuccess",this).call(this)}},{key:"navigateBack",value:function(){this.router.navigate(["/my-absences"])}}]),s}(Le)).\u0275fac=function(e){return new(e||He)(F.Mb(Ce.c),F.Mb(g.g),F.Mb(Me.b),F.Mb(Y.d),F.Mb(Pe.a),F.Mb(De.a),F.Mb($.a),F.Mb(C.a),F.Mb(M),F.Mb(x.a))},He.\u0275cmp=F.Gb({type:He,selectors:[["erz-my-absences-confirm"]],features:[F.wb],decls:24,vars:28,consts:[[1,"erz-container","erz-container-limited","erz-container-padding-y"],["class","mb-3 pb-3 border-bottom",4,"erzLet"],[3,"formGroup","ngSubmit"],[1,"form-group","mb-3","border-bottom"],["class","form-check my-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"remark"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],["type","submit",1,"btn","btn-primary","ml-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"mb-3","pb-3","border-bottom"],[1,"form-check","my-3",3,"ngClass"],["type","radio","formControlName","absenceTypeId",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],[4,"ngIf"],["class","invalid-feedback mt-4",4,"ngFor","ngForOf"],[1,"invalid-feedback","mt-4"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"sr-only"]],template:function(e,n){1&e&&(F.Sb(0,"div",0),F.Bc(1,we,3,6,"div",1),F.gc(2,"async"),F.Sb(3,"form",2),F.dc("ngSubmit",function(){return n.onSubmit()}),F.Sb(4,"div",3),F.Sb(5,"label"),F.Dc(6),F.gc(7,"translate"),F.Rb(),F.Bc(8,Ee,7,14,"div",4),F.gc(9,"async"),F.Rb(),F.Sb(10,"div",5),F.Dc(11),F.gc(12,"translate"),F.Rb(),F.Sb(13,"div",6),F.Sb(14,"button",7),F.dc("click",function(){return n.cancel()}),F.gc(15,"async"),F.Dc(16),F.gc(17,"translate"),F.Rb(),F.Sb(18,"button",8),F.gc(19,"async"),F.Dc(20),F.gc(21,"translate"),F.Bc(22,Ne,3,0,"div",9),F.gc(23,"async"),F.Rb(),F.Rb(),F.Rb(),F.Rb()),2&e&&(F.zb(1),F.lc("erzLet",F.hc(2,10,n.getSelectedCount())),F.zb(2),F.lc("formGroup",n.formGroup),F.zb(3),F.Fc("",F.hc(7,12,"my-absences.confirm.choose-presence-type"),":"),F.zb(2),F.lc("ngForOf",F.hc(9,14,n.absenceTypes$)),F.zb(3),F.Fc(" ",F.hc(12,16,"my-absences.confirm.remark")," "),F.zb(3),F.lc("disabled",F.hc(15,18,n.saving$)),F.zb(2),F.Fc(" ",F.hc(17,20,"my-absences.confirm.cancel")," "),F.zb(2),F.lc("disabled",F.hc(19,22,n.saving$)),F.zb(2),F.Fc(" ",F.hc(21,24,"my-absences.confirm.save")," "),F.zb(2),F.lc("ngIf",F.hc(23,26,n.saving$)))},directives:[K.a,Ce.r,Ce.j,Ce.e,te.l,te.m,te.k,Ce.n,Ce.b,Ce.i,Ce.d],pipes:[te.b,Y.c],styles:[""],changeDetection:0}),He),qe=o("tk/3"),Ke=o("sWYD"),Je=o("Xep9"),Ye=o("9/EM"),Ve=o("fhBx"),We=o("CqUA"),en=((Ge=function(e){n(r,e);var t=c(r);function r(e,n,c,i,s){var a;return u(this,r),(a=t.call(this,e,n,c,"/my-absences/report")).studentsService=i,a.storageService=s,a}return f(r,[{key:"getInitialFilter",value:function(){return{dateFrom:null,dateTo:null}}},{key:"isValidFilter",value:function(e){return Boolean(e.dateFrom||e.dateTo)}},{key:"loadEntries",value:function(e,n,t){var c=this,r=this.buildRequestParamsFromFilter(e).set("sort","From.asc").set("fields","Id,From,To,EventNumber,EventDesignation,EventManagerInformation");return this.loadingService.load(this.loadTimetableEntries(r).pipe(Object(h.a)(function(e){return Object(y.a)([Object(w.a)(e),c.loadLessonAbsences(e),c.loadLessonDispensations(e)])}),Object(k.a)(function(e){var n=a(e,3),t=n[0],r=n[1],i=n[2];return c.buildLessonPresences(t,r,i)}),Object(k.a)(function(e){return{offset:0,total:e.length,entries:e}})),Ve.a)}},{key:"buildParamsFromFilter",value:function(e){var n=e.dateFrom,t=e.dateTo,c={};return n&&(c.dateFrom=Object(Ke.a)(n,"yyyy-MM-dd")),t&&(c.dateTo=Object(Ke.a)(t,"yyyy-MM-dd")),c}},{key:"buildRequestParamsFromFilter",value:function(e){var n=new qe.f;return e.dateFrom&&(n=n.set("filter.From",">".concat(Object(Ke.a)(Object(Je.a)(e.dateFrom,1),"yyyy-MM-dd")))),e.dateTo&&(n=n.set("filter.To","<".concat(Object(Ke.a)(Object(Ye.a)(e.dateTo,1),"yyyy-MM-dd")))),n}},{key:"studentId",get:function(){var e,n=null===(e=this.storageService.getPayload())||void 0===e?void 0:e.id_person;if(null==n)throw new Error("No student id available");return n}},{key:"loadTimetableEntries",value:function(e){return this.studentsService.getTimetableEntries(this.studentId,e)}},{key:"loadLessonAbsences",value:function(e){return e.length>0?this.studentsService.getLessonAbsences(this.studentId,{"filter.Id":";".concat(e.map(function(e){return e.Id}).join(";"))}):Object(w.a)([])}},{key:"loadLessonDispensations",value:function(e){return e.length>0?this.studentsService.getLessonDispensations(this.studentId,{"filter.Id":";".concat(e.map(function(e){return e.Id}).join(";"))}):Object(w.a)([])}},{key:"buildLessonPresences",value:function(e,n,t){var c=this;return e.map(function(e){return c.buildLessonPresence(e,n,t)})}},{key:"buildLessonPresence",value:function(e,n,t){var c,r,i,s=n.find(function(n){return n.LessonRef.Id===e.Id}),a=t.find(function(n){return n.LessonRef.Id===e.Id}),o=this.buildLessonPresenceTypeRef(s,a);return{Id:"",LessonRef:{Id:e.Id,HRef:null},StudentRef:(null===(c=s||a)||void 0===c?void 0:c.StudentRef)||{Id:this.studentId,HRef:null},EventRef:{Id:0,HRef:null},TypeRef:o,RegistrationRef:{Id:0,HRef:null},StudyClassRef:{Id:0,HRef:null},ConfirmationStateId:(null==s?void 0:s.ConfirmationStateId)||a&&this.settings.excusedAbsenceStateId||null,EventDesignation:e.EventDesignation||"",HasStudyCourseConfirmationCode:!1,LessonDateTimeFrom:e.From||new Date,LessonDateTimeTo:e.To||new Date,Comment:null,Date:e.From||new Date,Type:(null===(r=s||a)||void 0===r?void 0:r.Type)||null,StudentFullName:(null===(i=s||a)||void 0===i?void 0:i.StudentFullName)||"",StudyClassNumber:"",TeacherInformation:e.EventManagerInformation}}},{key:"buildLessonPresenceTypeRef",value:function(e,n){return e?Object.assign({},e.TypeRef):n?Object.assign({},n.TypeRef):{Id:null,HRef:null}}}]),r}(Ve.b)).\u0275fac=function(e){return new(e||Ge)(F.Zb(te.i),F.Zb(We.a),F.Zb(C.a),F.Zb(j.a),F.Zb($.a))},Ge.\u0275prov=F.Ib({token:Ge,factory:Ge.\u0275fac}),Ge),nn=o("ulei"),tn=((Qe=function(e){n(r,e);var t=c(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).selectedIds$=e.selection$.pipe(Object(k.a)(T.a)),e}return r}(nn.a)).\u0275fac=function(e){return cn(e||Qe)},Qe.\u0275prov=F.Ib({token:Qe,factory:Qe.\u0275fac}),Qe),cn=F.Ub(tn),rn=((Ue=function(){function e(){u(this,e)}return f(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||Ue)},Ue.\u0275cmp=F.Gb({type:Ue,selectors:[["erz-my-absences-report"]],features:[F.yb([en,tn])],decls:1,vars:0,template:function(e,n){1&e&&F.Nb(0,"router-outlet")},directives:[g.k],styles:[""],changeDetection:0}),Ue),sn=o("1G5W"),an=o("KCaQ"),on=o("vlqf"),ln=o("RYjX"),un=o("yl8S"),bn=o("M34a"),fn=o("YDIV"),dn=o("DKSB"),pn=function(){return["/my-absences"]},gn=((Ze=function(){function e(){u(this,e),this.filter={dateFrom:null,dateTo:null},this.filterChange=new F.n,this.minDate={year:(new Date).getFullYear(),month:(new Date).getMonth()+1,day:(new Date).getDate()}}return f(e,[{key:"ngOnInit",value:function(){}},{key:"updateDateFrom",value:function(e){this.filter.dateFrom=e,e&&(this.filter.dateTo=e)}},{key:"show",value:function(){this.filterChange.emit({dateFrom:mn(this.filter.dateFrom),dateTo:mn(this.filter.dateTo)})}}]),e}()).\u0275fac=function(e){return new(e||Ze)},Ze.\u0275cmp=F.Gb({type:Ze,selectors:[["erz-my-absences-report-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},features:[F.yb([{provide:J.c,useClass:J.d},{provide:J.e,useClass:fn.a}])],decls:22,vars:18,consts:[[1,"backlink"],[1,"btn","btn-link","py-2","text-body",3,"routerLink"],[1,"material-icons","d-block"],[1,"filters"],[1,"form-group"],[3,"minDate","value","valueChange"],[1,"buttons"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(e,n){1&e&&(F.Sb(0,"div",0),F.Sb(1,"a",1),F.Sb(2,"i",2),F.Dc(3,"navigate_before"),F.Rb(),F.Rb(),F.Sb(4,"div"),F.Dc(5),F.gc(6,"translate"),F.Rb(),F.Rb(),F.Sb(7,"div",3),F.Sb(8,"div",4),F.Sb(9,"label"),F.Dc(10),F.gc(11,"translate"),F.Rb(),F.Sb(12,"erz-date-select",5),F.dc("valueChange",function(e){return n.updateDateFrom(e)}),F.Rb(),F.Rb(),F.Sb(13,"div",4),F.Sb(14,"label"),F.Dc(15),F.gc(16,"translate"),F.Rb(),F.Sb(17,"erz-date-select",5),F.dc("valueChange",function(e){return n.filter.dateTo=e}),F.Rb(),F.Rb(),F.Sb(18,"div",6),F.Sb(19,"button",7),F.dc("click",function(){return n.show()}),F.Dc(20),F.gc(21,"translate"),F.Rb(),F.Rb(),F.Rb()),2&e&&(F.zb(1),F.lc("routerLink",F.oc(17,pn)),F.zb(4),F.Ec(F.hc(6,9,"my-absences.report.title")),F.zb(5),F.Ec(F.hc(11,11,"my-absences.report.header.date-from")),F.zb(2),F.lc("minDate",n.minDate)("value",n.filter.dateFrom),F.zb(3),F.Ec(F.hc(16,13,"my-absences.report.header.date-to")),F.zb(2),F.lc("minDate",n.minDate)("value",n.filter.dateTo),F.zb(3),F.Fc(" ",F.hc(21,15,"my-absences.report.header.show")," "))},directives:[g.i,dn.a],pipes:[Y.c],styles:["[_nghost-%COMP%]{display:block;padding:1.5rem;border-bottom:1px solid #dee2e6}.backlink[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:1.5rem}.backlink[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{margin-left:-1.5rem}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.form-group[_ngcontent-%COMP%]{flex:1;min-width:20rem;max-width:40rem;margin-right:1.5rem;margin-bottom:.75rem}.buttons[_ngcontent-%COMP%]{flex:none;margin-top:2.75rem;margin-right:0}@media (max-width:767.98px){.buttons[_ngcontent-%COMP%]{width:100%;margin-top:1.5rem;margin-bottom:1.5rem}}"],changeDetection:0}),Ze);function mn(e){return e?Object(bn.a)(e):null}var yn=o("4Kj8"),hn=o("73sZ");function vn(e,n){if(1&e){var t=F.Tb();F.Sb(0,"div",12),F.Sb(1,"input",13,29),F.dc("change",function(){F.vc(t);var e=F.fc(2).$implicit;return F.fc(6).selectionService.toggle(e)}),F.gc(3,"async"),F.Rb(),F.Rb()}if(2&e){var c=F.fc(2).$implicit,r=F.fc(6);F.zb(1),F.lc("checked",F.hc(3,1,r.selectionService.isSelected$(c)))}}function Sn(e,n){if(1&e&&(F.Sb(0,"div"),F.Sb(1,"i",17),F.Dc(2),F.Rb(),F.Rb()),2&e){var t=F.fc().erzLet;F.Cb("checkbox presence-category ",t.category,""),F.zb(2),F.Ec(t.icon)}}function kn(e,n){if(1&e&&(F.Qb(0),F.Bc(1,vn,4,3,"div",27),F.Bc(2,Sn,3,4,"ng-template",null,28,F.Cc),F.Pb()),2&e){var t=n.erzLet,c=F.uc(3);F.zb(1),F.lc("ngIf",!t)("ngIfElse",c)}}function In(e,n){if(1&e&&(F.Qb(0),F.Dc(1),F.Pb()),2&e){var t=F.fc().$implicit;F.zb(1),F.Fc(", ",t.StudyClassNumber,"")}}function On(e,n){if(1&e&&(F.Sb(0,"div",31),F.Dc(1),F.Rb()),2&e){var t=F.fc().erzLet;F.zb(1),F.Fc(" ",t," ")}}function Rn(e,n){if(1&e&&(F.Qb(0),F.Bc(1,On,2,1,"div",30),F.Pb()),2&e){var t=n.erzLet;F.zb(1),F.lc("ngIf",t)}}function zn(e,n){if(1&e){var t=F.Tb();F.Sb(0,"div",19,20),F.dc("click",function(e){F.vc(t);var n=F.uc(1);return F.fc(6).onRowClick(e,n)}),F.Bc(2,kn,4,2,"ng-container",0),F.gc(3,"async"),F.Sb(4,"div",21),F.Dc(5),F.Bc(6,In,2,1,"ng-container",8),F.Rb(),F.Sb(7,"div",22),F.Dc(8),F.gc(9,"date"),F.gc(10,"date"),F.Rb(),F.Sb(11,"div",23),F.Dc(12),F.Rb(),F.Bc(13,Rn,2,1,"ng-container",0),F.gc(14,"async"),F.Sb(15,"div",24),F.Dc(16),F.gc(17,"date"),F.Rb(),F.Sb(18,"div",25),F.Dc(19),F.gc(20,"erzDaysDifference"),F.Rb(),F.Sb(21,"div",26),F.Dc(22),F.gc(23,"date"),F.gc(24,"erzDaysDifference"),F.Rb(),F.Rb()}if(2&e){var c=n.$implicit,r=F.fc(6);F.zb(2),F.lc("erzLet",F.hc(3,11,r.getPresenceCategory(c))),F.zb(3),F.Fc(" ",c.EventDesignation,""),F.zb(1),F.lc("ngIf",c.StudyClassNumber),F.zb(2),F.Gc(" ",F.ic(9,13,c.LessonDateTimeFrom,"HH:mm"),"\u2013",F.ic(10,16,c.LessonDateTimeTo,"HH:mm")," "),F.zb(4),F.Fc(" ",c.TeacherInformation," "),F.zb(1),F.lc("erzLet",F.hc(14,19,r.getPresenceTypeDesignation(c))),F.zb(3),F.Fc(" ",F.ic(17,21,c.LessonDateTimeFrom,"dd.MM.yyyy")," "),F.zb(3),F.Fc(" ",F.hc(20,24,c.LessonDateTimeFrom)," "),F.zb(3),F.Gc(" ",F.ic(23,26,c.LessonDateTimeFrom,"dd.MM.yyyy"),", ",F.hc(24,29,c.LessonDateTimeFrom)," ")}}function Cn(e,n){if(1&e){var t=F.Tb();F.Sb(0,"div"),F.Sb(1,"div",10,11),F.dc("click",function(e){F.vc(t);var n=F.uc(2);return F.fc(5).onRowClick(e,n)}),F.Sb(3,"div",12),F.Sb(4,"input",13),F.dc("change",function(e){return F.vc(t),F.fc(5).toggleAll(e.target.checked)}),F.gc(5,"async"),F.Rb(),F.Rb(),F.Sb(6,"div",14),F.Dc(7),F.gc(8,"translate"),F.Rb(),F.Sb(9,"div",15),F.Sb(10,"a",16),F.gc(11,"async"),F.Sb(12,"i",17),F.Dc(13,"edit"),F.Rb(),F.Rb(),F.Rb(),F.Rb(),F.Bc(14,zn,25,31,"div",18),F.Rb()}if(2&e){var c=F.fc(4).erzLet,r=F.fc();F.zb(4),F.lc("checked",F.hc(5,5,r.allSelected$)),F.zb(3),F.Fc(" ",F.hc(8,7,"my-absences.report.list.all")," "),F.zb(3),F.Eb("disabled",0===F.hc(11,9,r.selectionService.selection$).length),F.zb(4),F.lc("ngForOf",c.entries)}}function $n(e,n){1&e&&F.Nb(0,"erz-spinner",32)}function jn(e,n){if(1&e&&(F.Sb(0,"div",7),F.Bc(1,Cn,15,11,"div",8),F.Bc(2,$n,1,0,"erz-spinner",9),F.Rb()),2&e){var t=F.fc(3).erzLet;F.zb(1),F.lc("ngIf",t.entries&&t.entries.length>0),F.zb(1),F.lc("ngIf",t.loadingPage)}}function Tn(e,n){1&e&&(F.Sb(0,"p",33),F.Dc(1),F.gc(2,"translate"),F.Rb()),2&e&&(F.zb(1),F.Fc(" ",F.hc(2,1,"my-absences.report.no-entries")," "))}function Dn(e,n){if(1&e&&(F.Qb(0),F.Bc(1,jn,3,2,"div",5),F.Bc(2,Tn,3,3,"ng-template",null,6,F.Cc),F.Pb()),2&e){var t=F.uc(3),c=F.fc(2).erzLet;F.zb(1),F.lc("ngIf",c.entries&&c.entries.length>0||c.loadingPage)("ngIfElse",t)}}function Pn(e,n){1&e&&F.Nb(0,"erz-spinner")}function Fn(e,n){if(1&e&&(F.Qb(0),F.Bc(1,Dn,4,2,"ng-container",2),F.gc(2,"async"),F.Bc(3,Pn,1,0,"ng-template",null,4,F.Cc),F.Pb()),2&e){var t=F.uc(4),c=F.fc(2);F.zb(1),F.lc("ngIf",!F.hc(2,2,c.state.loading$))("ngIfElse",t)}}function Mn(e,n){1&e&&(F.Sb(0,"p",33),F.Dc(1),F.gc(2,"translate"),F.Rb()),2&e&&(F.zb(1),F.Ec(F.hc(2,1,"my-absences.report.no-filter")))}function Ln(e,n){if(1&e){var t=F.Tb();F.Qb(0),F.Sb(1,"erz-my-absences-report-header",1),F.dc("filterChange",function(e){return F.vc(t),F.fc().state.setFilter(e)}),F.gc(2,"async"),F.Rb(),F.Bc(3,Fn,5,4,"ng-container",2),F.gc(4,"async"),F.Bc(5,Mn,3,3,"ng-template",null,3,F.Cc),F.Pb()}if(2&e){var c=F.uc(6),r=F.fc();F.zb(1),F.lc("filter",F.hc(2,3,r.filterFromParams$)),F.zb(2),F.lc("ngIf",F.hc(4,5,r.state.isFilterValid$))("ngIfElse",c)}}var An=function(e,n,t){return{selection:e,entries:n,loadingPage:t}};function wn(e){return{dateFrom:e.dateFrom?Object(an.c)(e.dateFrom):null,dateTo:e.dateTo?Object(an.c)(e.dateTo):null}}var xn=function(e){return{count:e}};function Bn(e,n){if(1&e&&(F.Sb(0,"div",10),F.Dc(1),F.gc(2,"translate"),F.Rb()),2&e){var t=n.erzLet;F.zb(1),F.Fc(" ",F.ic(2,1,1===t?"my-absences.confirm.lesson-selected":"my-absences.confirm.lessons-selected",F.pc(4,xn,t))," ")}}function _n(e,n){if(1&e&&(F.Sb(0,"div",16),F.Dc(1),F.gc(2,"translate"),F.Rb()),2&e){var t=n.$implicit;F.zb(1),F.Fc(" ",F.ic(2,1,"global.validation-errors."+t.error,t.params)," ")}}function En(e,n){if(1&e&&(F.Qb(0),F.Bc(1,_n,3,4,"div",15),F.gc(2,"async"),F.Pb()),2&e){var t=F.fc(2);F.zb(1),F.lc("ngForOf",F.hc(2,1,t.absenceTypeIdErrors$))}}var Nn=function(e){return{"border-top pt-3":e}};function Hn(e,n){if(1&e&&(F.Sb(0,"div",11),F.Nb(1,"input",12),F.gc(2,"async"),F.Sb(3,"label",13),F.Dc(4),F.Rb(),F.Bc(5,En,3,3,"ng-container",14),F.gc(6,"async"),F.Rb()),2&e){var t,c=n.$implicit,r=n.index,i=F.fc();F.lc("ngClass",F.pc(12,Nn,c.IsHalfDay)),F.zb(1),F.Eb("is-invalid",F.hc(2,8,i.absenceTypeIdErrors$).length>0),F.lc("id","absence-type-"+r)("value",c.Id),F.zb(2),F.lc("for","absence-type-"+r),F.zb(1),F.Fc(" ",c.Designation," "),F.zb(1),F.lc("ngIf",(null==(t=F.hc(6,10,i.absenceTypes$))?null:t.length)-1===r)}}function Gn(e,n){1&e&&(F.Sb(0,"div",17),F.Sb(1,"span",18),F.Dc(2,"Loading..."),F.Rb(),F.Rb())}var Qn,Un,Zn,Xn,qn=[{path:"",component:L,children:[{path:"",component:ze},{path:"confirm",component:Xe},{path:"report",component:rn,children:[{path:"",component:(Un=function(){function e(n,t,c,r,i,s){var o=this;u(this,e),this.state=n,this.selectionService=t,this.route=c,this.scrollPosition=r,this.presenceTypesService=i,this.settings=s,this.filterFromParams$=this.route.queryParams.pipe(Object(k.a)(wn)),this.allSelected$=Object(y.a)([this.selectionService.selection$,this.state.entries$.pipe(Object(h.a)(function(e){return Object(y.a)(e.map(function(e){return o.getPresenceType(e)}))}))]).pipe(Object(k.a)(function(e){var n=a(e,2),t=n[0],c=n[1];return t.length>0&&t.length===c.filter(Object(D.d)(on.c)).length})),this.destroy$=new A.a}return f(e,[{key:"ngOnInit",value:function(){var e=this;this.filterFromParams$.pipe(Object(I.a)(1)).subscribe(function(n){return e.state.setFilter(n)}),this.state.validFilter$.pipe(Object(sn.a)(this.destroy$)).subscribe(function(){return e.selectionService.clear()})}},{key:"ngAfterViewInit",value:function(){this.scrollPosition.restore()}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"getPresenceCategory",value:function(e){var n=this;return this.getPresenceType(e).pipe(Object(k.a)(function(t){return Object(on.c)(t)?e.ConfirmationStateId===n.settings.checkableAbsenceStateId?{category:ln.a.Unapproved,icon:Object(ln.c)(ln.a.Unapproved)}:{category:ln.a.Absent,icon:Object(ln.c)(ln.a.Absent)}:null}))}},{key:"getPresenceTypeDesignation",value:function(e){return this.presenceTypesService.displayedTypes$.pipe(Object(k.a)(function(n){var t;return e.TypeRef.Id&&(null===(t=n.find(function(n){return n.Id===e.TypeRef.Id}))||void 0===t?void 0:t.Designation)||null}))}},{key:"toggleAll",value:function(e){var n=this;Object(y.a)([this.state.entries$.pipe(Object(I.a)(1)),this.presenceTypesService.presenceTypes$.pipe(Object(I.a)(1))]).subscribe(function(t){var c=a(t,2),r=c[0],i=c[1].filter(function(e){return Object(on.c)(e)}).map(function(e){return e.Id});n.selectionService.clear(e?r.filter(function(e){return null==e.TypeRef.Id||!i.includes(e.TypeRef.Id)}):null)})}},{key:"onRowClick",value:function(e,n){var t=n.querySelector('input[type="checkbox"]');t&&e.target!==t&&!Boolean(e.target.closest(".buttons"))&&t.click()}},{key:"getPresenceType",value:function(e){return this.presenceTypesService.presenceTypes$.pipe(Object(k.a)(function(n){return e.TypeRef.Id&&n.find(function(n){return n.Id===e.TypeRef.Id})||null}))}}]),e}(),Un.\u0275fac=function(e){return new(e||Un)(F.Mb(en),F.Mb(tn),F.Mb(g.a),F.Mb(un.a),F.Mb(Pe.a),F.Mb(C.a))},Un.\u0275cmp=F.Gb({type:Un,selectors:[["erz-my-absences-report-list"]],decls:4,vars:11,consts:[[4,"erzLet"],[3,"filter","filterChange"],[4,"ngIf","ngIfElse"],["noFilter",""],["loading",""],["class","p-3",4,"ngIf","ngIfElse"],["noEntries",""],[1,"p-3"],[4,"ngIf"],["class","inline",4,"ngIf"],[1,"entries-all",3,"click"],["all",""],[1,"checkbox"],["type","checkbox",1,"form-check-input",3,"checked","change"],[1,"all"],[1,"buttons"],["routerLink","confirm",1,"edit","btn","btn-primary","mr-2"],[1,"material-icons"],["class","entry",3,"click",4,"ngFor","ngForOf"],[1,"entry",3,"click"],["row",""],[1,"lesson-class"],[1,"time","pr-2"],[1,"teacher"],[1,"date"],[1,"days-ago"],[1,"date-days-ago"],["class","checkbox",4,"ngIf","ngIfElse"],["categoryIcon",""],["checkbox",""],["class","presence-type",4,"ngIf"],[1,"presence-type"],[1,"inline"],[1,"mt-3","px-3"]],template:function(e,n){1&e&&(F.Bc(0,Ln,7,7,"ng-container",0),F.gc(1,"async"),F.gc(2,"async"),F.gc(3,"async")),2&e&&F.lc("erzLet",F.rc(7,An,F.hc(1,1,n.selectionService.selection$),F.hc(2,3,n.state.entries$),F.hc(3,5,n.state.loadingPage$)))},directives:[K.a,gn,te.m,g.i,te.l,yn.a],pipes:[te.b,Y.c,te.e,hn.a],styles:['.entries-all[_ngcontent-%COMP%]{padding:0 0 .75rem 1.5rem;grid-template-areas:"checkbox all buttons";grid-template-columns:-webkit-min-content 1fr -webkit-min-content;grid-template-columns:min-content 1fr min-content}.entries-all[_ngcontent-%COMP%], .entry[_ngcontent-%COMP%]{border-bottom:1px solid #e9ecef;display:grid}.entry[_ngcontent-%COMP%]{padding:1.5rem;grid-template-areas:"checkbox lesson-class time teacher" "checkbox presence-type date days-ago";grid-template-columns:-webkit-min-content 2fr 1fr 2fr;grid-template-columns:min-content 2fr 1fr 2fr}.entry[_ngcontent-%COMP%]:first-child{padding-top:0}.entries-all[_ngcontent-%COMP%] + .entry[_ngcontent-%COMP%]{padding-top:1.5rem}.presence-category.absent[_ngcontent-%COMP%]{color:#dc3545}.presence-category.unapproved[_ngcontent-%COMP%]{color:#ffa814}.checkbox[_ngcontent-%COMP%]{grid-area:checkbox;margin:0;padding:.6rem .75rem 0 0}.presence-category[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{display:block;font-size:16px}.entries-all[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{padding-top:.2rem}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.all[_ngcontent-%COMP%]{grid-area:all}.buttons[_ngcontent-%COMP%]{grid-area:buttons;display:flex}.buttons[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{line-height:1;font-size:2.2rem}.lesson-class[_ngcontent-%COMP%]{grid-area:lesson-class;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.time[_ngcontent-%COMP%]{grid-area:time}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.presence-type[_ngcontent-%COMP%]{color:#adb5bd;grid-area:presence-type}.date[_ngcontent-%COMP%]{grid-area:date}.days-ago[_ngcontent-%COMP%]{color:#adb5bd;grid-area:days-ago}.date-days-ago[_ngcontent-%COMP%]{grid-area:date-days-ago;display:none}@media (max-width:750px){.entry[_ngcontent-%COMP%]{grid-template-areas:"checkbox lesson-class" "checkbox teacher" "checkbox date-days-ago" "checkbox time" "checkbox presence-type";grid-template-columns:-webkit-min-content 1fr;grid-template-columns:min-content 1fr}.date-days-ago[_ngcontent-%COMP%]{display:block}.date[_ngcontent-%COMP%], .days-ago[_ngcontent-%COMP%]{display:none}}'],changeDetection:0}),Un),data:{restoreScrollPositionFrom:["/my-absences/report/confirm"]}},{path:"confirm",component:(Qn=function(t){n(s,t);var r=c(s);function s(e,n,t,c,i,a,o,l,b,f){var d;return u(this,s),(d=r.call(this,e,n,t,c,i,a,o,l)).state=b,d.selectionService=f,d.selectedLessonIds$=d.selectionService.selectedIds$.pipe(Object(k.a)(function(e){return Object(E.a)(q(e.map(function(e){return e.lessonIds})))})),d.confirmationStateId=d.settings.checkableAbsenceStateId,d}return f(s,[{key:"getHalfDayType",value:function(){return this.presenceTypesService.getPresenceType(this.settings.halfDayPresenceTypeId).pipe(Object(k.a)(function(e){return e.Active?e:null}))}},{key:"onSaveSuccess",value:function(){this.selectionService.clear(),this.state.resetEntries(),e(i(s.prototype),"onSaveSuccess",this).call(this)}},{key:"navigateBack",value:function(){var e=this;this.state.queryParams$.pipe(Object(I.a)(1)).subscribe(function(n){e.router.navigate(["/my-absences/report"],{queryParams:n})})}}]),s}(Le),Qn.\u0275fac=function(e){return new(e||Qn)(F.Mb(Ce.c),F.Mb(g.g),F.Mb(Me.b),F.Mb(Y.d),F.Mb(Pe.a),F.Mb(De.a),F.Mb($.a),F.Mb(C.a),F.Mb(en),F.Mb(tn))},Qn.\u0275cmp=F.Gb({type:Qn,selectors:[["erz-my-absences-confirm"]],features:[F.wb],decls:24,vars:28,consts:[[1,"erz-container","erz-container-limited","erz-container-padding-y"],["class","mb-3 pb-3 border-bottom",4,"erzLet"],[3,"formGroup","ngSubmit"],[1,"form-group","mb-3","border-bottom"],["class","form-check my-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"remark"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],["type","submit",1,"btn","btn-primary","ml-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"mb-3","pb-3","border-bottom"],[1,"form-check","my-3",3,"ngClass"],["type","radio","formControlName","absenceTypeId",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],[4,"ngIf"],["class","invalid-feedback mt-4",4,"ngFor","ngForOf"],[1,"invalid-feedback","mt-4"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"sr-only"]],template:function(e,n){1&e&&(F.Sb(0,"div",0),F.Bc(1,Bn,3,6,"div",1),F.gc(2,"async"),F.Sb(3,"form",2),F.dc("ngSubmit",function(){return n.onSubmit()}),F.Sb(4,"div",3),F.Sb(5,"label"),F.Dc(6),F.gc(7,"translate"),F.Rb(),F.Bc(8,Hn,7,14,"div",4),F.gc(9,"async"),F.Rb(),F.Sb(10,"div",5),F.Dc(11),F.gc(12,"translate"),F.Rb(),F.Sb(13,"div",6),F.Sb(14,"button",7),F.dc("click",function(){return n.cancel()}),F.gc(15,"async"),F.Dc(16),F.gc(17,"translate"),F.Rb(),F.Sb(18,"button",8),F.gc(19,"async"),F.Dc(20),F.gc(21,"translate"),F.Bc(22,Gn,3,0,"div",9),F.gc(23,"async"),F.Rb(),F.Rb(),F.Rb(),F.Rb()),2&e&&(F.zb(1),F.lc("erzLet",F.hc(2,10,n.getSelectedCount())),F.zb(2),F.lc("formGroup",n.formGroup),F.zb(3),F.Fc("",F.hc(7,12,"my-absences.confirm.choose-presence-type"),":"),F.zb(2),F.lc("ngForOf",F.hc(9,14,n.absenceTypes$)),F.zb(3),F.Fc(" ",F.hc(12,16,"my-absences.confirm.remark")," "),F.zb(3),F.lc("disabled",F.hc(15,18,n.saving$)),F.zb(2),F.Fc(" ",F.hc(17,20,"my-absences.confirm.cancel")," "),F.zb(2),F.lc("disabled",F.hc(19,22,n.saving$)),F.zb(2),F.Fc(" ",F.hc(21,24,"my-absences.confirm.save")," "),F.zb(2),F.lc("ngIf",F.hc(23,26,n.saving$)))},directives:[K.a,Ce.r,Ce.j,Ce.e,te.l,te.m,te.k,Ce.n,Ce.b,Ce.i,Ce.d],pipes:[te.b,Y.c],styles:[""],changeDetection:0}),Qn)}]}]}],Kn=((Xn=function e(){u(this,e)}).\u0275fac=function(e){return new(e||Xn)},Xn.\u0275mod=F.Kb({type:Xn}),Xn.\u0275inj=F.Jb({imports:[[g.j.forChild(qn)],g.j]}),Xn),Jn=((Zn=function e(){u(this,e)}).\u0275fac=function(e){return new(e||Zn)},Zn.\u0275mod=F.Kb({type:Zn}),Zn.\u0275inj=F.Jb({imports:[[p.a,Kn]]}),Zn)}}])}();