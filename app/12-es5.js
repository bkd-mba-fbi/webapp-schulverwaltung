!function(){function e(n,t,c){return(e="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,n,t){var c=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=i(e)););return e}(e,n);if(c){var r=Object.getOwnPropertyDescriptor(c,n);return r.get?r.get.call(t):r.value}})(n,t,c||n)}function n(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&t(e,n)}function t(e,n){return(t=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function c(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var t,c=i(e);if(n){var s=i(this).constructor;t=Reflect.construct(c,arguments,s)}else t=c.apply(this,arguments);return r(this,t)}}function r(e,n){return!n||"object"!=typeof n&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==t)return;var c,r,i=[],s=!0,a=!1;try{for(t=t.call(e);!(s=(c=t.next()).done)&&(i.push(c.value),!n||i.length!==n);s=!0);}catch(o){a=!0,r=o}finally{try{s||null==t.return||t.return()}finally{if(a)throw r}}return i}(e,n)||o(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,n){if(e){if("string"==typeof e)return l(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?l(e,n):void 0}}function l(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,c=new Array(n);t<n;t++)c[t]=e[t];return c}function b(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function u(e,n){for(var t=0;t<n.length;t++){var c=n[t];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function f(e,n,t){return n&&u(e.prototype,n),t&&u(e,t),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{CZtb:function(t,r,o){"use strict";o.r(r),o.d(r,"MyAbsencesModule",function(){return Qn});var l,u,d,p=o("PCNd"),g=o("tyNb"),m=o("jtHE"),y=o("itXk"),h=o("eIep"),v=o("UXun"),S=o("pLZG"),k=o("lJxs"),I=o("IzEk"),O=o("JX91"),R=o("oB13"),z=o("x+ZX"),C=o("Xr/R"),$=o("fbMX"),j=o("mmcK"),D=o("IClS"),T=o("K+0v"),P=o("eB9A"),M=o("fXoL"),F=((u=function(){function e(n,t,c){var r;b(this,e),this.settings=n,this.storageService=t,this.studentsService=c,this.studentId$=new m.a(1),this.lessonAbsences$=this.studentId$.pipe(Object(h.a)(this.loadLessonAbsences.bind(this)),Object(v.a)(1)),this.lessonIncidents$=this.studentId$.pipe(Object(h.a)(this.loadLessonIncidents.bind(this)),Object(v.a)(1)),this.lessonPresences$=this.getLessonPresences(),this.checkableAbsences$=this.getAbsences(this.settings.checkableAbsenceStateId),this.openAbsences$=this.getAbsences(this.settings.unconfirmedAbsenceStateId),this.excusedAbsences$=this.getAbsences(this.settings.excusedAbsenceStateId),this.unexcusedAbsences$=this.getAbsences(this.settings.unexcusedAbsenceStateId),this.incidents$=this.getAbsences(null),this.openLessonAbsences$=Object(y.a)([this.openAbsences$.pipe(Object(S.a)(T.e)),this.lessonAbsences$]).pipe(Object(k.a)(Object(P.a)(this.getOpenLessonAbsences.bind(this))),Object(v.a)(1)),this.counts$=this.getCounts();var i=(null===(r=this.storageService.getPayload())||void 0===r?void 0:r.id_person)||null;i&&this.studentId$.next(i)}return f(e,[{key:"reset",value:function(){var e=this;this.studentId$.pipe(Object(I.a)(1)).subscribe(function(n){return e.studentId$.next(n)})}},{key:"getLessonPresences",value:function(){var e=this;return this.getCached(Object(y.a)([this.studentId$,this.lessonAbsences$,this.lessonIncidents$]).pipe(Object(h.a)(function(n){var t=a(n,3),c=t[0],r=t[1],i=t[2];return e.loadTimetableEntries(c,r,i).pipe(Object(k.a)(function(n){return e.buildLessonPresences(r,i,n)}))}),Object(k.a)(D.c)))}},{key:"getAbsences",value:function(e){return this.getCached(this.lessonPresences$.pipe(Object(k.a)(function(n){return(null==n?void 0:n.filter(function(n){return n.ConfirmationStateId===e}))||null})))}},{key:"getOpenLessonAbsences",value:function(e,n){var t=e.map(function(e){return e.LessonRef.Id});return n.filter(function(e){return t.includes(e.LessonRef.Id)})}},{key:"getCounts",value:function(){return Object(y.a)([this.getCount(this.checkableAbsences$),this.getCount(this.openAbsences$),this.getCount(this.excusedAbsences$),this.getCount(this.unexcusedAbsences$),this.getCount(this.incidents$)]).pipe(Object(k.a)(function(e){var n=a(e,5);return{checkableAbsences:n[0],openAbsences:n[1],excusedAbsences:n[2],unexcusedAbsences:n[3],incidents:n[4],halfDays:null}}))}},{key:"getCached",value:function(e){return e.pipe(Object(O.a)(null),Object(R.a)(function(){return new m.a(1)}),Object(z.a)())}},{key:"getCount",value:function(e){return e.pipe(Object(k.a)(function(e){var n;return null!==(n=null==e?void 0:e.length)&&void 0!==n?n:null}))}},{key:"loadLessonAbsences",value:function(e){return this.studentsService.getLessonAbsences(e)}},{key:"loadLessonIncidents",value:function(e){return this.studentsService.getLessonIncidents(e)}},{key:"loadTimetableEntries",value:function(e,n,t){return this.studentsService.getTimetableEntries(e,{"filter.Id":";".concat([].concat(s(n),s(t)).map(function(e){return e.LessonRef.Id}).join(";")),fields:"Id,From,To,EventNumber,EventDesignation,EventManagerInformation"})}},{key:"buildLessonPresences",value:function(e,n,t){var c=this;return[].concat(s(e),s(n)).map(function(e){return c.buildLessonPresence(e,t)}).filter(T.e)}},{key:"buildLessonPresence",value:function(e,n){var t=n.find(function(n){return n.Id===e.LessonRef.Id});return t?{Id:"",LessonRef:{Id:e.LessonRef.Id,HRef:e.LessonRef.HRef?e.LessonRef.HRef:null},StudentRef:e.StudentRef,EventRef:{Id:0,HRef:null},TypeRef:e.TypeRef,RegistrationRef:{Id:0,HRef:null},StudyClassRef:{Id:0,HRef:null},ConfirmationStateId:"ConfirmationStateId"in e?e.ConfirmationStateId:null,EventDesignation:t.EventDesignation,HasStudyCourseConfirmationCode:!1,LessonDateTimeFrom:t.From,LessonDateTimeTo:t.To,Comment:null,Date:t.From,Type:e.Type,StudentFullName:e.StudentFullName,StudyClassNumber:"",TeacherInformation:t.EventManagerInformation}:null}}]),e}()).\u0275fac=function(e){return new(e||u)(M.Zb(C.a),M.Zb($.a),M.Zb(j.a))},u.\u0275prov=M.Ib({token:u,factory:u.\u0275fac}),u),L=((l=function(){function e(){b(this,e)}return f(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||l)},l.\u0275cmp=M.Gb({type:l,selectors:[["erz-my-absences"]],features:[M.yb([F])],decls:1,vars:0,template:function(e,n){1&e&&M.Nb(0,"router-outlet")},directives:[g.k],styles:[""],changeDetection:0}),l),A=o("XNiG"),w=o("LRne"),x=o("5QKP"),B=o("Ug8t"),_=o("8teX"),E=o("BeL+"),N=o("xWuZ"),G=o("EOpz"),H=o("1kSV"),Q=o("sYmb"),U=["link"],Z=function(){return["/my-absences/report"]},X=((d=function(){function e(){b(this,e)}return f(e,[{key:"onClick",value:function(){this.link.nativeElement.click()}},{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||d)},d.\u0275cmp=M.Gb({type:d,selectors:[["erz-my-absences-report-link"]],viewQuery:function(e,n){var t;1&e&&M.Jc(U,1),2&e&&M.tc(t=M.ec())&&(n.link=t.first)},hostBindings:function(e,n){1&e&&M.dc("click",function(e){return n.onClick(e)})},decls:8,vars:5,consts:[[1,"m-0"],[1,"btn","btn-link","p-0",3,"routerLink"],["link",""],[1,"d-flex","align-items-center"],[1,"material-icons"]],template:function(e,n){1&e&&(M.Sb(0,"h5",0),M.Dc(1),M.gc(2,"translate"),M.Rb(),M.Sb(3,"a",1,2),M.Sb(5,"div",3),M.Sb(6,"i",4),M.Dc(7,"keyboard_arrow_right"),M.Rb(),M.Rb(),M.Rb()),2&e&&(M.zb(1),M.Fc(" ",M.hc(2,2,"my-absences.report.title"),"\n"),M.zb(2),M.lc("routerLink",M.oc(4,Z)))},directives:[g.i],pipes:[Q.c],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1.5rem;cursor:pointer}.btn[_ngcontent-%COMP%]{color:#33333d;text-decoration:none}"],changeDetection:0}),d),q=o("4vw6"),K=o("ofXK"),J=o("ZLMY");function Y(e,n){1&e&&M.Nb(0,"erz-my-absences-report-link")}function V(e,n){}function W(e,n){if(1&e&&(M.Qb(0),M.Dc(1),M.Pb()),2&e){var t=M.fc(2).erzLet;M.zb(1),M.Fc("(",t.absenceCounts.checkableAbsences,")")}}function ee(e,n){if(1&e){var t=M.Tb();M.Sb(0,"erz-student-profile-entry-header",12),M.dc("click",function(){return M.vc(t),M.fc(),M.uc(2).toggle("checkable-absences")}),M.Dc(1),M.gc(2,"translate"),M.Bc(3,W,2,1,"ng-container",13),M.Rb()}if(2&e){var c=n.opened,r=M.fc().erzLet;M.lc("opened",c),M.zb(1),M.Fc(" ",M.hc(2,3,"shared.profile.checkable-absences")," "),M.zb(2),M.lc("ngIf",null!=r.absenceCounts.checkableAbsences)}}function ne(e,n){if(1&e&&M.Nb(0,"erz-student-profile-absences",14),2&e){var t=M.fc(2);M.lc("absences$",t.myAbsencesService.checkableAbsences$)}}function te(e,n){if(1&e&&(M.Qb(0),M.Dc(1),M.Pb()),2&e){var t=M.fc(2).erzLet;M.zb(1),M.Fc("(",t.absenceCounts.openAbsences,")")}}function ce(e,n){if(1&e){var t=M.Tb();M.Sb(0,"erz-student-profile-entry-header",12),M.dc("click",function(){return M.vc(t),M.fc(),M.uc(2).toggle("open-absences")}),M.Dc(1),M.gc(2,"translate"),M.Bc(3,te,2,1,"ng-container",13),M.Rb()}if(2&e){var c=n.opened,r=M.fc().erzLet;M.lc("opened",c),M.zb(1),M.Fc(" ",M.hc(2,3,"shared.profile.open-absences")," "),M.zb(2),M.lc("ngIf",null!=r.absenceCounts.openAbsences)}}function re(e,n){if(1&e&&(M.Nb(0,"erz-student-profile-absences",15),M.gc(1,"translate"),M.gc(2,"async"),M.gc(3,"async")),2&e){var t=M.fc(2);M.lc("absences$",t.myAbsencesService.openAbsences$)("selectionService",t.absencesSelectionService)("defaultAbsenceSelectionMessage",M.hc(1,5,"my-absences.show.default-absence-selection-message"))("reportUrl",M.hc(2,7,t.reportUrl$))("reportAvailable",M.hc(3,9,t.reportAvailable$))}}function ie(e,n){if(1&e&&(M.Qb(0),M.Dc(1),M.Pb()),2&e){var t=M.fc(2).erzLet;M.zb(1),M.Fc("(",t.absenceCounts.excusedAbsences,")")}}function se(e,n){if(1&e){var t=M.Tb();M.Sb(0,"erz-student-profile-entry-header",12),M.dc("click",function(){return M.vc(t),M.fc(),M.uc(2).toggle("excused-absences")}),M.Dc(1),M.gc(2,"translate"),M.Bc(3,ie,2,1,"ng-container",13),M.Rb()}if(2&e){var c=n.opened,r=M.fc().erzLet;M.lc("opened",c),M.zb(1),M.Fc(" ",M.hc(2,3,"shared.profile.excused-absences")," "),M.zb(2),M.lc("ngIf",null!=r.absenceCounts.excusedAbsences)}}function ae(e,n){if(1&e&&M.Nb(0,"erz-student-profile-absences",14),2&e){var t=M.fc(2);M.lc("absences$",t.myAbsencesService.excusedAbsences$)}}function oe(e,n){if(1&e&&(M.Qb(0),M.Dc(1),M.Pb()),2&e){var t=M.fc(2).erzLet;M.zb(1),M.Fc("(",t.absenceCounts.unexcusedAbsences,")")}}function le(e,n){if(1&e){var t=M.Tb();M.Sb(0,"erz-student-profile-entry-header",12),M.dc("click",function(){return M.vc(t),M.fc(),M.uc(2).toggle("unexcused-absences")}),M.Dc(1),M.gc(2,"translate"),M.Bc(3,oe,2,1,"ng-container",13),M.Rb()}if(2&e){var c=n.opened,r=M.fc().erzLet;M.lc("opened",c),M.zb(1),M.Fc(" ",M.hc(2,3,"shared.profile.unexcused-absences")," "),M.zb(2),M.lc("ngIf",null!=r.absenceCounts.unexcusedAbsences)}}function be(e,n){if(1&e&&M.Nb(0,"erz-student-profile-absences",16),2&e){var t=M.fc(2);M.lc("absences$",t.myAbsencesService.unexcusedAbsences$)("displayPresenceType",!1)}}function ue(e,n){if(1&e&&(M.Qb(0),M.Dc(1),M.Pb()),2&e){var t=M.fc(2).erzLet;M.zb(1),M.Fc("(",t.absenceCounts.incidents,")")}}function fe(e,n){if(1&e){var t=M.Tb();M.Sb(0,"erz-student-profile-entry-header",12),M.dc("click",function(){return M.vc(t),M.fc(),M.uc(2).toggle("incidents")}),M.Dc(1),M.gc(2,"translate"),M.Bc(3,ue,2,1,"ng-container",13),M.Rb()}if(2&e){var c=n.opened,r=M.fc().erzLet;M.lc("opened",c),M.zb(1),M.Fc(" ",M.hc(2,3,"shared.profile.incidents")," "),M.zb(2),M.lc("ngIf",null!=r.absenceCounts.incidents)}}function de(e,n){if(1&e&&M.Nb(0,"erz-student-profile-absences",14),2&e){var t=M.fc(2);M.lc("absences$",t.myAbsencesService.incidents$)}}function pe(e,n){1&e&&(M.Sb(0,"div",1),M.Sb(1,"ngb-accordion",2,3),M.Sb(3,"ngb-panel",4),M.Bc(4,Y,1,0,"ng-template",5),M.Bc(5,V,0,0,"ng-template",6),M.Rb(),M.Sb(6,"ngb-panel",7),M.Bc(7,ee,4,5,"ng-template",5),M.Bc(8,ne,1,1,"ng-template",6),M.Rb(),M.Sb(9,"ngb-panel",8),M.Bc(10,ce,4,5,"ng-template",5),M.Bc(11,re,4,11,"ng-template",6),M.Rb(),M.Sb(12,"ngb-panel",9),M.Bc(13,se,4,5,"ng-template",5),M.Bc(14,ae,1,1,"ng-template",6),M.Rb(),M.Sb(15,"ngb-panel",10),M.Bc(16,le,4,5,"ng-template",5),M.Bc(17,be,1,2,"ng-template",6),M.Rb(),M.Sb(18,"ngb-panel",11),M.Bc(19,fe,4,5,"ng-template",5),M.Bc(20,de,1,1,"ng-template",6),M.Rb(),M.Rb(),M.Rb())}var ge,me,ye=function(e){return{absenceCounts:e}},he=((ge=function(){function e(n,t,c){b(this,e),this.reportsService=n,this.myAbsencesService=t,this.absencesSelectionService=c,this.reportUrl$=this.loadReportUrl(),this.reportAvailable$=this.reportsService.studentConfirmationAvailability$,this.destroy$=new A.a}return f(e,[{key:"ngOnInit",value:function(){var e=this;this.myAbsencesService.openLessonAbsences$.pipe(Object(I.a)(1),Object(S.a)(Object(T.d)(_.b))).subscribe(function(n){return e.reportsService.setStudentConfirmationAvailabilityRecordIds(n.map(function(e){return"".concat(e.LessonRef.Id,"_").concat(e.RegistrationId)}))})}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"loadReportUrl",value:function(){var e=this;return Object(y.a)([this.absencesSelectionService.selectedWithoutPresenceType$,this.absencesSelectionService.selectedIds$]).pipe(Object(h.a)(function(n){var t=a(n,2),c=t[0],r=t[1];return 0===c.length&&r.length>0?e.getReportRecordIds(Object(E.a)(Object(N.a)(r.map(function(e){return e.lessonIds})))):Object(w.a)(null)}),Object(k.a)(function(n){return n?e.reportsService.getStudentConfirmationUrl(n):null}))}},{key:"getReportRecordIds",value:function(e){return this.myAbsencesService.openLessonAbsences$.pipe(Object(k.a)(function(n){return n.filter(function(n){return e.includes(n.LessonRef.Id)}).map(function(e){return"".concat(e.LessonRef.Id,"_").concat(e.RegistrationId)})}))}}]),e}()).\u0275fac=function(e){return new(e||ge)(M.Mb(B.a),M.Mb(F),M.Mb(x.a))},ge.\u0275cmp=M.Gb({type:ge,selectors:[["erz-my-absences-show"]],decls:2,vars:5,consts:[["class","erz-container erz-container-padding-y erz-container-padding-x-responsive",4,"erzLet"],[1,"erz-container","erz-container-padding-y","erz-container-padding-x-responsive"],["ngb-accordion",""],["acc","ngbAccordion"],["id","report-absence"],["ngbPanelHeader",""],["ngbPanelContent",""],["id","checkable-absences"],["id","open-absences"],["id","excused-absences"],["id","unexcused-absences"],["id","incidents"],[3,"opened","click"],[4,"ngIf"],[3,"absences$"],[3,"absences$","selectionService","defaultAbsenceSelectionMessage","reportUrl","reportAvailable"],[3,"absences$","displayPresenceType"]],template:function(e,n){1&e&&(M.Bc(0,pe,21,0,"div",0),M.gc(1,"async")),2&e&&M.lc("erzLet",M.pc(3,ye,M.hc(1,1,n.myAbsencesService.counts$)))},directives:[G.a,H.a,H.m,H.o,H.n,X,q.a,K.m,J.a],pipes:[K.b,Q.c],styles:[""],changeDetection:0}),ge),ve=o("3Pt+"),Se=o("2Vo4"),ke=o("wO+i"),Ie=o("nYR2"),Oe=o("LpL1"),Re=o("KJh6"),ze=o("A6ef"),Ce=o("5eHb"),$e=((me=function(){function e(n,t,c,r,i,o,l,u){b(this,e),this.fb=n,this.router=t,this.toastr=c,this.translate=r,this.presenceTypesService=i,this.updateService=o,this.storageService=l,this.settings=u,this.formGroup=this.createFormGroup(),this.saving$=new Se.a(!1),this.submitted$=new Se.a(!1),this.absenceTypes$=Object(y.a)([this.getConfirmationTypes(),this.getHalfDayType()]).pipe(Object(k.a)(function(e){var n=a(e,2),t=n[0],c=n[1];return c?[].concat(s(t),[c]):t})),this.absenceTypeIdErrors$=Object(ze.c)(Object(w.a)(this.formGroup),this.submitted$,"absenceTypeId"),this.confirmationStateId=null,this.destroy$=new A.a}return f(e,[{key:"ngOnInit",value:function(){var e=this;this.selectedLessonIds$.pipe(Object(I.a)(1),Object(S.a)(_.b)).subscribe(function(){return e.navigateBack()})}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"onSubmit",value:function(){if(this.submitted$.next(!0),this.formGroup.valid){var e=this.formGroup.value.absenceTypeId;this.save(e)}}},{key:"cancel",value:function(){this.navigateBack()}},{key:"getSelectedCount",value:function(){return this.selectedLessonIds$.pipe(Object(ke.a)("length"))}},{key:"getConfirmationTypes",value:function(){var e=this;return this.presenceTypesService.confirmationTypes$.pipe(Object(k.a)(function(n){return n.filter(function(n){return n.IsAbsence&&n.Id!==e.settings.halfDayPresenceTypeId})}))}},{key:"getHalfDayType",value:function(){return Object(w.a)(null)}},{key:"createFormGroup",value:function(){return this.fb.group({absenceTypeId:[null,ve.q.required]})}},{key:"save",value:function(e){var n=this;this.saving$.next(!0),this.selectedLessonIds$.pipe(Object(I.a)(1),Object(h.a)(function(t){var c;return n.updateService.editLessonPresences(t,[Number(null===(c=n.storageService.getPayload())||void 0===c?void 0:c.id_person)],e)}),Object(Ie.a)(function(){return n.saving$.next(!1)})).subscribe(this.onSaveSuccess.bind(this))}},{key:"onSaveSuccess",value:function(){this.toastr.success(this.translate.instant("my-absences.confirm.save-success")),this.navigateBack()}}]),e}()).\u0275fac=function(e){return new(e||me)(M.Mb(ve.c),M.Mb(g.g),M.Mb(Ce.b),M.Mb(Q.d),M.Mb(Re.a),M.Mb(Oe.a),M.Mb($.a),M.Mb(C.b))},me.\u0275cmp=M.Gb({type:me,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,n){},encapsulation:2}),me),je=o("6UOe"),De=function(e){return{count:e}};function Te(e,n){if(1&e&&(M.Sb(0,"div",10),M.Dc(1),M.gc(2,"translate"),M.Rb()),2&e){var t=n.erzLet;M.zb(1),M.Fc(" ",M.ic(2,1,1===t?"my-absences.confirm.lesson-selected":"my-absences.confirm.lessons-selected",M.pc(4,De,t))," ")}}function Pe(e,n){if(1&e&&(M.Sb(0,"div",16),M.Dc(1),M.gc(2,"translate"),M.Rb()),2&e){var t=n.$implicit;M.zb(1),M.Fc(" ",M.ic(2,1,"global.validation-errors."+t.error,t.params)," ")}}function Me(e,n){if(1&e&&(M.Qb(0),M.Bc(1,Pe,3,4,"div",15),M.gc(2,"async"),M.Pb()),2&e){var t=M.fc(2);M.zb(1),M.lc("ngForOf",M.hc(2,1,t.absenceTypeIdErrors$))}}var Fe=function(e){return{"border-top pt-3":e}};function Le(e,n){if(1&e&&(M.Sb(0,"div",11),M.Nb(1,"input",12),M.gc(2,"async"),M.Sb(3,"label",13),M.Dc(4),M.Rb(),M.Bc(5,Me,3,3,"ng-container",14),M.gc(6,"async"),M.Rb()),2&e){var t,c=n.$implicit,r=n.index,i=M.fc();M.lc("ngClass",M.pc(12,Fe,c.IsHalfDay)),M.zb(1),M.Eb("is-invalid",M.hc(2,8,i.absenceTypeIdErrors$).length>0),M.lc("id","absence-type-"+r)("value",c.Id),M.zb(2),M.lc("for","absence-type-"+r),M.zb(1),M.Fc(" ",c.Designation," "),M.zb(1),M.lc("ngIf",(null==(t=M.hc(6,10,i.absenceTypes$))?null:t.length)-1===r)}}function Ae(e,n){1&e&&(M.Sb(0,"div",17),M.Sb(1,"span",18),M.Dc(2,"Loading..."),M.Rb(),M.Rb())}var we,xe,Be,_e,Ee,Ne=((we=function(t){n(s,t);var r=c(s);function s(e,n,t,c,i,a,o,l,u,f){var d;return b(this,s),(d=r.call(this,e,n,t,c,i,a,o,l)).myAbsencesService=u,d.selectionService=f,d.selectedLessonIds$=d.selectionService.selectedIds$.pipe(Object(k.a)(function(e){return Object(E.a)(Object(N.a)(e.map(function(e){return e.lessonIds})))})),d.confirmationStateId=d.settings.unconfirmedAbsencesRefreshTime,d}return f(s,[{key:"onSaveSuccess",value:function(){this.selectionService.clear(),this.myAbsencesService.reset(),e(i(s.prototype),"onSaveSuccess",this).call(this)}},{key:"navigateBack",value:function(){this.router.navigate(["/my-absences"])}}]),s}($e)).\u0275fac=function(e){return new(e||we)(M.Mb(ve.c),M.Mb(g.g),M.Mb(Ce.b),M.Mb(Q.d),M.Mb(Re.a),M.Mb(Oe.a),M.Mb($.a),M.Mb(C.a),M.Mb(F),M.Mb(x.a))},we.\u0275cmp=M.Gb({type:we,selectors:[["erz-my-absences-confirm"]],features:[M.wb],decls:25,vars:32,consts:[[1,"erz-container","erz-container-limited","erz-container-padding-y"],["class","mb-3 pb-3 border-bottom",4,"erzLet"],[3,"formGroup","ngSubmit"],[1,"form-group","mb-3","border-bottom"],["class","form-check my-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"remark"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],["type","submit",1,"btn","btn-primary","ml-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"mb-3","pb-3","border-bottom"],[1,"form-check","my-3",3,"ngClass"],["type","radio","formControlName","absenceTypeId",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],[4,"ngIf"],["class","invalid-feedback mt-4",4,"ngFor","ngForOf"],[1,"invalid-feedback","mt-4"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"sr-only"]],template:function(e,n){1&e&&(M.Sb(0,"div",0),M.Bc(1,Te,3,6,"div",1),M.gc(2,"async"),M.Sb(3,"form",2),M.dc("ngSubmit",function(){return n.onSubmit()}),M.Sb(4,"div",3),M.Sb(5,"label"),M.Dc(6),M.gc(7,"translate"),M.gc(8,"addSpace"),M.Rb(),M.Bc(9,Le,7,14,"div",4),M.gc(10,"async"),M.Rb(),M.Sb(11,"div",5),M.Dc(12),M.gc(13,"translate"),M.Rb(),M.Sb(14,"div",6),M.Sb(15,"button",7),M.dc("click",function(){return n.cancel()}),M.gc(16,"async"),M.Dc(17),M.gc(18,"translate"),M.Rb(),M.Sb(19,"button",8),M.gc(20,"async"),M.Dc(21),M.gc(22,"translate"),M.Bc(23,Ae,3,0,"div",9),M.gc(24,"async"),M.Rb(),M.Rb(),M.Rb(),M.Rb()),2&e&&(M.zb(1),M.lc("erzLet",M.hc(2,11,n.getSelectedCount())),M.zb(2),M.lc("formGroup",n.formGroup),M.zb(3),M.Gc("",M.hc(7,13,"my-absences.confirm.choose-presence-type"),"",M.ic(8,15,":",":"),""),M.zb(3),M.lc("ngForOf",M.hc(10,18,n.absenceTypes$)),M.zb(3),M.Fc(" ",M.hc(13,20,"my-absences.confirm.remark")," "),M.zb(3),M.lc("disabled",M.hc(16,22,n.saving$)),M.zb(2),M.Fc(" ",M.hc(18,24,"my-absences.confirm.cancel")," "),M.zb(2),M.lc("disabled",M.hc(20,26,n.saving$)),M.zb(2),M.Fc(" ",M.hc(22,28,"my-absences.confirm.save")," "),M.zb(2),M.lc("ngIf",M.hc(24,30,n.saving$)))},directives:[G.a,ve.r,ve.j,ve.e,K.l,K.m,K.k,ve.n,ve.b,ve.i,ve.d],pipes:[K.b,Q.c,je.a],styles:[""],changeDetection:0}),we),Ge=o("tk/3"),He=o("sWYD"),Qe=o("Xep9"),Ue=o("9/EM"),Ze=o("fhBx"),Xe=o("CqUA"),qe=((xe=function(e){n(r,e);var t=c(r);function r(e,n,c,i,s){var a;return b(this,r),(a=t.call(this,e,n,c,"/my-absences/report")).studentsService=i,a.storageService=s,a}return f(r,[{key:"getInitialFilter",value:function(){return{dateFrom:null,dateTo:null}}},{key:"isValidFilter",value:function(e){return Boolean(e.dateFrom||e.dateTo)}},{key:"loadEntries",value:function(e,n,t){var c=this,r=this.buildRequestParamsFromFilter(e).set("sort","From.asc").set("fields","Id,From,To,EventNumber,EventDesignation,EventManagerInformation");return this.loadingService.load(this.loadTimetableEntries(r).pipe(Object(h.a)(function(e){return Object(y.a)([Object(w.a)(e),c.loadLessonAbsences(e),c.loadLessonDispensations(e)])}),Object(k.a)(function(e){var n=a(e,3),t=n[0],r=n[1],i=n[2];return c.buildLessonPresences(t,r,i)}),Object(k.a)(function(e){return{offset:0,total:e.length,entries:e}})),Ze.a)}},{key:"buildParamsFromFilter",value:function(e){var n=e.dateFrom,t=e.dateTo,c={};return n&&(c.dateFrom=Object(He.a)(n,"yyyy-MM-dd")),t&&(c.dateTo=Object(He.a)(t,"yyyy-MM-dd")),c}},{key:"buildRequestParamsFromFilter",value:function(e){var n=new Ge.f;return e.dateFrom&&(n=n.set("filter.From",">".concat(Object(He.a)(Object(Qe.a)(e.dateFrom,1),"yyyy-MM-dd")))),e.dateTo&&(n=n.set("filter.To","<".concat(Object(He.a)(Object(Ue.a)(e.dateTo,1),"yyyy-MM-dd")))),n}},{key:"studentId",get:function(){var e,n=null===(e=this.storageService.getPayload())||void 0===e?void 0:e.id_person;if(null==n)throw new Error("No student id available");return n}},{key:"loadTimetableEntries",value:function(e){return this.studentsService.getTimetableEntries(this.studentId,e)}},{key:"loadLessonAbsences",value:function(e){return e.length>0?this.studentsService.getLessonAbsences(this.studentId,{"filter.Id":";".concat(e.map(function(e){return e.Id}).join(";"))}):Object(w.a)([])}},{key:"loadLessonDispensations",value:function(e){return e.length>0?this.studentsService.getLessonDispensations(this.studentId,{"filter.Id":";".concat(e.map(function(e){return e.Id}).join(";"))}):Object(w.a)([])}},{key:"buildLessonPresences",value:function(e,n,t){var c=this;return e.map(function(e){return c.buildLessonPresence(e,n,t)})}},{key:"buildLessonPresence",value:function(e,n,t){var c,r,i,s=n.find(function(n){return n.LessonRef.Id===e.Id}),a=t.find(function(n){return n.LessonRef.Id===e.Id}),o=this.buildLessonPresenceTypeRef(s,a);return{Id:"",LessonRef:{Id:e.Id,HRef:null},StudentRef:(null===(c=s||a)||void 0===c?void 0:c.StudentRef)||{Id:this.studentId,HRef:null},EventRef:{Id:0,HRef:null},TypeRef:o,RegistrationRef:{Id:0,HRef:null},StudyClassRef:{Id:0,HRef:null},ConfirmationStateId:(null==s?void 0:s.ConfirmationStateId)||a&&this.settings.excusedAbsenceStateId||null,EventDesignation:e.EventDesignation||"",HasStudyCourseConfirmationCode:!1,LessonDateTimeFrom:e.From||new Date,LessonDateTimeTo:e.To||new Date,Comment:null,Date:e.From||new Date,Type:(null===(r=s||a)||void 0===r?void 0:r.Type)||null,StudentFullName:(null===(i=s||a)||void 0===i?void 0:i.StudentFullName)||"",StudyClassNumber:"",TeacherInformation:e.EventManagerInformation}}},{key:"buildLessonPresenceTypeRef",value:function(e,n){return e?Object.assign({},e.TypeRef):n?Object.assign({},n.TypeRef):{Id:null,HRef:null}}}]),r}(Ze.b)).\u0275fac=function(e){return new(e||xe)(M.Zb(K.i),M.Zb(Xe.a),M.Zb(C.a),M.Zb(j.a),M.Zb($.a))},xe.\u0275prov=M.Ib({token:xe,factory:xe.\u0275fac}),xe),Ke=o("ulei"),Je=((Be=function(e){n(r,e);var t=c(r);function r(){var e;return b(this,r),(e=t.apply(this,arguments)).selectedIds$=e.selection$.pipe(Object(k.a)(D.a)),e}return r}(Ke.a)).\u0275fac=function(e){return Ye(e||Be)},Be.\u0275prov=M.Ib({token:Be,factory:Be.\u0275fac}),Be),Ye=M.Ub(Je),Ve=((_e=function(){function e(){b(this,e)}return f(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||_e)},_e.\u0275cmp=M.Gb({type:_e,selectors:[["erz-my-absences-report"]],features:[M.yb([qe,Je])],decls:1,vars:0,template:function(e,n){1&e&&M.Nb(0,"router-outlet")},directives:[g.k],styles:[""],changeDetection:0}),_e),We=o("1G5W"),en=o("KCaQ"),nn=o("vlqf"),tn=o("RYjX"),cn=o("yl8S"),rn=o("M34a"),sn=o("YDIV"),an=o("DKSB"),on=function(){return["/my-absences"]},ln=((Ee=function(){function e(){b(this,e),this.filter={dateFrom:null,dateTo:null},this.filterChange=new M.n,this.minDate={year:(new Date).getFullYear(),month:(new Date).getMonth()+1,day:(new Date).getDate()}}return f(e,[{key:"ngOnInit",value:function(){}},{key:"updateDateFrom",value:function(e){this.filter.dateFrom=e,e&&(this.filter.dateTo=e)}},{key:"show",value:function(){this.filterChange.emit({dateFrom:bn(this.filter.dateFrom),dateTo:bn(this.filter.dateTo)})}}]),e}()).\u0275fac=function(e){return new(e||Ee)},Ee.\u0275cmp=M.Gb({type:Ee,selectors:[["erz-my-absences-report-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},features:[M.yb([{provide:H.c,useClass:H.d},{provide:H.e,useClass:sn.a}])],decls:22,vars:18,consts:[[1,"backlink"],[1,"btn","btn-link","py-2","text-body",3,"routerLink"],[1,"material-icons","d-block"],[1,"filters"],[1,"form-group"],[3,"minDate","value","valueChange"],[1,"buttons"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(e,n){1&e&&(M.Sb(0,"div",0),M.Sb(1,"a",1),M.Sb(2,"i",2),M.Dc(3,"navigate_before"),M.Rb(),M.Rb(),M.Sb(4,"div"),M.Dc(5),M.gc(6,"translate"),M.Rb(),M.Rb(),M.Sb(7,"div",3),M.Sb(8,"div",4),M.Sb(9,"label"),M.Dc(10),M.gc(11,"translate"),M.Rb(),M.Sb(12,"erz-date-select",5),M.dc("valueChange",function(e){return n.updateDateFrom(e)}),M.Rb(),M.Rb(),M.Sb(13,"div",4),M.Sb(14,"label"),M.Dc(15),M.gc(16,"translate"),M.Rb(),M.Sb(17,"erz-date-select",5),M.dc("valueChange",function(e){return n.filter.dateTo=e}),M.Rb(),M.Rb(),M.Sb(18,"div",6),M.Sb(19,"button",7),M.dc("click",function(){return n.show()}),M.Dc(20),M.gc(21,"translate"),M.Rb(),M.Rb(),M.Rb()),2&e&&(M.zb(1),M.lc("routerLink",M.oc(17,on)),M.zb(4),M.Ec(M.hc(6,9,"my-absences.report.title")),M.zb(5),M.Ec(M.hc(11,11,"my-absences.report.header.date-from")),M.zb(2),M.lc("minDate",n.minDate)("value",n.filter.dateFrom),M.zb(3),M.Ec(M.hc(16,13,"my-absences.report.header.date-to")),M.zb(2),M.lc("minDate",n.minDate)("value",n.filter.dateTo),M.zb(3),M.Fc(" ",M.hc(21,15,"my-absences.report.header.show")," "))},directives:[g.i,an.a],pipes:[Q.c],styles:["[_nghost-%COMP%]{display:block;padding:1.5rem;border-bottom:1px solid #dee2e6}.backlink[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:1.5rem}.backlink[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{margin-left:-1.5rem}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.form-group[_ngcontent-%COMP%]{flex:1;min-width:20rem;max-width:40rem;margin-right:1.5rem;margin-bottom:.75rem}.buttons[_ngcontent-%COMP%]{flex:none;margin-top:2.75rem;margin-right:0}@media (max-width:767.98px){.buttons[_ngcontent-%COMP%]{width:100%;margin-top:1.5rem;margin-bottom:1.5rem}}"],changeDetection:0}),Ee);function bn(e){return e?Object(rn.a)(e):null}var un=o("4Kj8"),fn=o("73sZ");function dn(e,n){if(1&e){var t=M.Tb();M.Sb(0,"div",12),M.Sb(1,"input",13,29),M.dc("change",function(){M.vc(t);var e=M.fc(2).$implicit;return M.fc(6).selectionService.toggle(e)}),M.gc(3,"async"),M.Rb(),M.Rb()}if(2&e){var c=M.fc(2).$implicit,r=M.fc(6);M.zb(1),M.lc("checked",M.hc(3,1,r.selectionService.isSelected$(c)))}}function pn(e,n){if(1&e&&(M.Sb(0,"div"),M.Sb(1,"i",17),M.Dc(2),M.Rb(),M.Rb()),2&e){var t=M.fc().erzLet;M.Cb("checkbox presence-category ",t.category,""),M.zb(2),M.Ec(t.icon)}}function gn(e,n){if(1&e&&(M.Qb(0),M.Bc(1,dn,4,3,"div",27),M.Bc(2,pn,3,4,"ng-template",null,28,M.Cc),M.Pb()),2&e){var t=n.erzLet,c=M.uc(3);M.zb(1),M.lc("ngIf",!t)("ngIfElse",c)}}function mn(e,n){if(1&e&&(M.Qb(0),M.Dc(1),M.Pb()),2&e){var t=M.fc().$implicit;M.zb(1),M.Fc(", ",t.StudyClassNumber,"")}}function yn(e,n){if(1&e&&(M.Sb(0,"div",31),M.Dc(1),M.Rb()),2&e){var t=M.fc().erzLet;M.zb(1),M.Fc(" ",t," ")}}function hn(e,n){if(1&e&&(M.Qb(0),M.Bc(1,yn,2,1,"div",30),M.Pb()),2&e){var t=n.erzLet;M.zb(1),M.lc("ngIf",t)}}function vn(e,n){if(1&e){var t=M.Tb();M.Sb(0,"div",19,20),M.dc("click",function(e){M.vc(t);var n=M.uc(1);return M.fc(6).onRowClick(e,n)}),M.Bc(2,gn,4,2,"ng-container",0),M.gc(3,"async"),M.Sb(4,"div",21),M.Dc(5),M.Bc(6,mn,2,1,"ng-container",8),M.Rb(),M.Sb(7,"div",22),M.Dc(8),M.gc(9,"date"),M.gc(10,"date"),M.Rb(),M.Sb(11,"div",23),M.Dc(12),M.Rb(),M.Bc(13,hn,2,1,"ng-container",0),M.gc(14,"async"),M.Sb(15,"div",24),M.Dc(16),M.gc(17,"date"),M.Rb(),M.Sb(18,"div",25),M.Dc(19),M.gc(20,"erzDaysDifference"),M.Rb(),M.Sb(21,"div",26),M.Dc(22),M.gc(23,"date"),M.gc(24,"erzDaysDifference"),M.Rb(),M.Rb()}if(2&e){var c=n.$implicit,r=M.fc(6);M.zb(2),M.lc("erzLet",M.hc(3,11,r.getPresenceCategory(c))),M.zb(3),M.Fc(" ",c.EventDesignation,""),M.zb(1),M.lc("ngIf",c.StudyClassNumber),M.zb(2),M.Gc(" ",M.ic(9,13,c.LessonDateTimeFrom,"HH:mm"),"\u2013",M.ic(10,16,c.LessonDateTimeTo,"HH:mm")," "),M.zb(4),M.Fc(" ",c.TeacherInformation," "),M.zb(1),M.lc("erzLet",M.hc(14,19,r.getPresenceTypeDesignation(c))),M.zb(3),M.Fc(" ",M.ic(17,21,c.LessonDateTimeFrom,"dd.MM.yyyy")," "),M.zb(3),M.Fc(" ",M.hc(20,24,c.LessonDateTimeFrom)," "),M.zb(3),M.Gc(" ",M.ic(23,26,c.LessonDateTimeFrom,"dd.MM.yyyy"),", ",M.hc(24,29,c.LessonDateTimeFrom)," ")}}function Sn(e,n){if(1&e){var t=M.Tb();M.Sb(0,"div"),M.Sb(1,"div",10,11),M.dc("click",function(e){M.vc(t);var n=M.uc(2);return M.fc(5).onRowClick(e,n)}),M.Sb(3,"div",12),M.Sb(4,"input",13),M.dc("change",function(e){return M.vc(t),M.fc(5).toggleAll(e.target.checked)}),M.gc(5,"async"),M.Rb(),M.Rb(),M.Sb(6,"div",14),M.Dc(7),M.gc(8,"translate"),M.Rb(),M.Sb(9,"div",15),M.Sb(10,"a",16),M.gc(11,"async"),M.Sb(12,"i",17),M.Dc(13,"edit"),M.Rb(),M.Rb(),M.Rb(),M.Rb(),M.Bc(14,vn,25,31,"div",18),M.Rb()}if(2&e){var c=M.fc(4).erzLet,r=M.fc();M.zb(4),M.lc("checked",M.hc(5,5,r.allSelected$)),M.zb(3),M.Fc(" ",M.hc(8,7,"my-absences.report.list.all")," "),M.zb(3),M.Eb("disabled",0===M.hc(11,9,r.selectionService.selection$).length),M.zb(4),M.lc("ngForOf",c.entries)}}function kn(e,n){1&e&&M.Nb(0,"erz-spinner",32)}function In(e,n){if(1&e&&(M.Sb(0,"div",7),M.Bc(1,Sn,15,11,"div",8),M.Bc(2,kn,1,0,"erz-spinner",9),M.Rb()),2&e){var t=M.fc(3).erzLet;M.zb(1),M.lc("ngIf",t.entries&&t.entries.length>0),M.zb(1),M.lc("ngIf",t.loadingPage)}}function On(e,n){1&e&&(M.Sb(0,"p",33),M.Dc(1),M.gc(2,"translate"),M.Rb()),2&e&&(M.zb(1),M.Fc(" ",M.hc(2,1,"my-absences.report.no-entries")," "))}function Rn(e,n){if(1&e&&(M.Qb(0),M.Bc(1,In,3,2,"div",5),M.Bc(2,On,3,3,"ng-template",null,6,M.Cc),M.Pb()),2&e){var t=M.uc(3),c=M.fc(2).erzLet;M.zb(1),M.lc("ngIf",c.entries&&c.entries.length>0||c.loadingPage)("ngIfElse",t)}}function zn(e,n){1&e&&M.Nb(0,"erz-spinner")}function Cn(e,n){if(1&e&&(M.Qb(0),M.Bc(1,Rn,4,2,"ng-container",2),M.gc(2,"async"),M.Bc(3,zn,1,0,"ng-template",null,4,M.Cc),M.Pb()),2&e){var t=M.uc(4),c=M.fc(2);M.zb(1),M.lc("ngIf",!M.hc(2,2,c.state.loading$))("ngIfElse",t)}}function $n(e,n){1&e&&(M.Sb(0,"p",33),M.Dc(1),M.gc(2,"translate"),M.Rb()),2&e&&(M.zb(1),M.Ec(M.hc(2,1,"my-absences.report.no-filter")))}function jn(e,n){if(1&e){var t=M.Tb();M.Qb(0),M.Sb(1,"erz-my-absences-report-header",1),M.dc("filterChange",function(e){return M.vc(t),M.fc().state.setFilter(e)}),M.gc(2,"async"),M.Rb(),M.Bc(3,Cn,5,4,"ng-container",2),M.gc(4,"async"),M.Bc(5,$n,3,3,"ng-template",null,3,M.Cc),M.Pb()}if(2&e){var c=M.uc(6),r=M.fc();M.zb(1),M.lc("filter",M.hc(2,3,r.filterFromParams$)),M.zb(2),M.lc("ngIf",M.hc(4,5,r.state.isFilterValid$))("ngIfElse",c)}}var Dn=function(e,n,t){return{selection:e,entries:n,loadingPage:t}};function Tn(e){return{dateFrom:e.dateFrom?Object(en.c)(e.dateFrom):null,dateTo:e.dateTo?Object(en.c)(e.dateTo):null}}var Pn=function(e){return{count:e}};function Mn(e,n){if(1&e&&(M.Sb(0,"div",10),M.Dc(1),M.gc(2,"translate"),M.Rb()),2&e){var t=n.erzLet;M.zb(1),M.Fc(" ",M.ic(2,1,1===t?"my-absences.confirm.lesson-selected":"my-absences.confirm.lessons-selected",M.pc(4,Pn,t))," ")}}function Fn(e,n){if(1&e&&(M.Sb(0,"div",16),M.Dc(1),M.gc(2,"translate"),M.Rb()),2&e){var t=n.$implicit;M.zb(1),M.Fc(" ",M.ic(2,1,"global.validation-errors."+t.error,t.params)," ")}}function Ln(e,n){if(1&e&&(M.Qb(0),M.Bc(1,Fn,3,4,"div",15),M.gc(2,"async"),M.Pb()),2&e){var t=M.fc(2);M.zb(1),M.lc("ngForOf",M.hc(2,1,t.absenceTypeIdErrors$))}}var An=function(e){return{"border-top pt-3":e}};function wn(e,n){if(1&e&&(M.Sb(0,"div",11),M.Nb(1,"input",12),M.gc(2,"async"),M.Sb(3,"label",13),M.Dc(4),M.Rb(),M.Bc(5,Ln,3,3,"ng-container",14),M.gc(6,"async"),M.Rb()),2&e){var t,c=n.$implicit,r=n.index,i=M.fc();M.lc("ngClass",M.pc(12,An,c.IsHalfDay)),M.zb(1),M.Eb("is-invalid",M.hc(2,8,i.absenceTypeIdErrors$).length>0),M.lc("id","absence-type-"+r)("value",c.Id),M.zb(2),M.lc("for","absence-type-"+r),M.zb(1),M.Fc(" ",c.Designation," "),M.zb(1),M.lc("ngIf",(null==(t=M.hc(6,10,i.absenceTypes$))?null:t.length)-1===r)}}function xn(e,n){1&e&&(M.Sb(0,"div",17),M.Sb(1,"span",18),M.Dc(2,"Loading..."),M.Rb(),M.Rb())}var Bn,_n,En,Nn,Gn=[{path:"",component:L,children:[{path:"",component:he},{path:"confirm",component:Ne},{path:"report",component:Ve,children:[{path:"",component:(_n=function(){function e(n,t,c,r,i,s){var o=this;b(this,e),this.state=n,this.selectionService=t,this.route=c,this.scrollPosition=r,this.presenceTypesService=i,this.settings=s,this.filterFromParams$=this.route.queryParams.pipe(Object(k.a)(Tn)),this.allSelected$=Object(y.a)([this.selectionService.selection$,this.state.entries$.pipe(Object(h.a)(function(e){return Object(y.a)(e.map(function(e){return o.getPresenceType(e)}))}))]).pipe(Object(k.a)(function(e){var n=a(e,2),t=n[0],c=n[1];return t.length>0&&t.length===c.filter(Object(T.d)(nn.c)).length})),this.destroy$=new A.a}return f(e,[{key:"ngOnInit",value:function(){var e=this;this.filterFromParams$.pipe(Object(I.a)(1)).subscribe(function(n){return e.state.setFilter(n)}),this.state.validFilter$.pipe(Object(We.a)(this.destroy$)).subscribe(function(){return e.selectionService.clear()})}},{key:"ngAfterViewInit",value:function(){this.scrollPosition.restore()}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"getPresenceCategory",value:function(e){var n=this;return this.getPresenceType(e).pipe(Object(k.a)(function(t){return Object(nn.c)(t)?e.ConfirmationStateId===n.settings.checkableAbsenceStateId?{category:tn.a.Unapproved,icon:Object(tn.c)(tn.a.Unapproved)}:{category:tn.a.Absent,icon:Object(tn.c)(tn.a.Absent)}:null}))}},{key:"getPresenceTypeDesignation",value:function(e){return this.presenceTypesService.displayedTypes$.pipe(Object(k.a)(function(n){var t;return e.TypeRef.Id&&(null===(t=n.find(function(n){return n.Id===e.TypeRef.Id}))||void 0===t?void 0:t.Designation)||null}))}},{key:"toggleAll",value:function(e){var n=this;Object(y.a)([this.state.entries$.pipe(Object(I.a)(1)),this.presenceTypesService.presenceTypes$.pipe(Object(I.a)(1))]).subscribe(function(t){var c=a(t,2),r=c[0],i=c[1].filter(function(e){return Object(nn.c)(e)}).map(function(e){return e.Id});n.selectionService.clear(e?r.filter(function(e){return null==e.TypeRef.Id||!i.includes(e.TypeRef.Id)}):null)})}},{key:"onRowClick",value:function(e,n){var t=n.querySelector('input[type="checkbox"]');t&&e.target!==t&&!Boolean(e.target.closest(".buttons"))&&t.click()}},{key:"getPresenceType",value:function(e){return this.presenceTypesService.presenceTypes$.pipe(Object(k.a)(function(n){return e.TypeRef.Id&&n.find(function(n){return n.Id===e.TypeRef.Id})||null}))}}]),e}(),_n.\u0275fac=function(e){return new(e||_n)(M.Mb(qe),M.Mb(Je),M.Mb(g.a),M.Mb(cn.a),M.Mb(Re.a),M.Mb(C.a))},_n.\u0275cmp=M.Gb({type:_n,selectors:[["erz-my-absences-report-list"]],decls:4,vars:11,consts:[[4,"erzLet"],[3,"filter","filterChange"],[4,"ngIf","ngIfElse"],["noFilter",""],["loading",""],["class","p-3",4,"ngIf","ngIfElse"],["noEntries",""],[1,"p-3"],[4,"ngIf"],["class","inline",4,"ngIf"],[1,"entries-all",3,"click"],["all",""],[1,"checkbox"],["type","checkbox",1,"form-check-input",3,"checked","change"],[1,"all"],[1,"buttons"],["routerLink","confirm",1,"edit","btn","btn-primary","mr-2"],[1,"material-icons"],["class","entry",3,"click",4,"ngFor","ngForOf"],[1,"entry",3,"click"],["row",""],[1,"lesson-class"],[1,"time","pr-2"],[1,"teacher"],[1,"date"],[1,"days-ago"],[1,"date-days-ago"],["class","checkbox",4,"ngIf","ngIfElse"],["categoryIcon",""],["checkbox",""],["class","presence-type",4,"ngIf"],[1,"presence-type"],[1,"inline"],[1,"mt-3","px-3"]],template:function(e,n){1&e&&(M.Bc(0,jn,7,7,"ng-container",0),M.gc(1,"async"),M.gc(2,"async"),M.gc(3,"async")),2&e&&M.lc("erzLet",M.rc(7,Dn,M.hc(1,1,n.selectionService.selection$),M.hc(2,3,n.state.entries$),M.hc(3,5,n.state.loadingPage$)))},directives:[G.a,ln,K.m,g.i,K.l,un.a],pipes:[K.b,Q.c,K.e,fn.a],styles:['.entries-all[_ngcontent-%COMP%]{padding:0 0 .75rem 1.5rem;grid-template-areas:"checkbox all buttons";grid-template-columns:-webkit-min-content 1fr -webkit-min-content;grid-template-columns:min-content 1fr min-content}.entries-all[_ngcontent-%COMP%], .entry[_ngcontent-%COMP%]{border-bottom:1px solid #e9ecef;display:grid}.entry[_ngcontent-%COMP%]{padding:1.5rem;grid-template-areas:"checkbox lesson-class time teacher" "checkbox presence-type date days-ago";grid-template-columns:-webkit-min-content 2fr 1fr 2fr;grid-template-columns:min-content 2fr 1fr 2fr}.entry[_ngcontent-%COMP%]:first-child{padding-top:0}.entries-all[_ngcontent-%COMP%] + .entry[_ngcontent-%COMP%]{padding-top:1.5rem}.presence-category.absent[_ngcontent-%COMP%]{color:#dc3545}.presence-category.unapproved[_ngcontent-%COMP%]{color:#ffa814}.checkbox[_ngcontent-%COMP%]{grid-area:checkbox;margin:0;padding:.6rem .75rem 0 0}.presence-category[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{display:block;font-size:16px}.entries-all[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{padding-top:.2rem}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.all[_ngcontent-%COMP%]{grid-area:all}.buttons[_ngcontent-%COMP%]{grid-area:buttons;display:flex}.buttons[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{line-height:1;font-size:2.2rem}.lesson-class[_ngcontent-%COMP%]{grid-area:lesson-class;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.time[_ngcontent-%COMP%]{grid-area:time}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.presence-type[_ngcontent-%COMP%]{color:#adb5bd;grid-area:presence-type}.date[_ngcontent-%COMP%]{grid-area:date}.days-ago[_ngcontent-%COMP%]{color:#adb5bd;grid-area:days-ago}.date-days-ago[_ngcontent-%COMP%]{grid-area:date-days-ago;display:none}@media (max-width:750px){.entry[_ngcontent-%COMP%]{grid-template-areas:"checkbox lesson-class" "checkbox teacher" "checkbox date-days-ago" "checkbox time" "checkbox presence-type";grid-template-columns:-webkit-min-content 1fr;grid-template-columns:min-content 1fr}.date-days-ago[_ngcontent-%COMP%]{display:block}.date[_ngcontent-%COMP%], .days-ago[_ngcontent-%COMP%]{display:none}}'],changeDetection:0}),_n),data:{restoreScrollPositionFrom:["/my-absences/report/confirm"]}},{path:"confirm",component:(Bn=function(t){n(s,t);var r=c(s);function s(e,n,t,c,i,a,o,l,u,f){var d;return b(this,s),(d=r.call(this,e,n,t,c,i,a,o,l)).state=u,d.selectionService=f,d.selectedLessonIds$=d.selectionService.selectedIds$.pipe(Object(k.a)(function(e){return Object(E.a)(Object(N.a)(e.map(function(e){return e.lessonIds})))})),d.confirmationStateId=d.settings.checkableAbsenceStateId,d}return f(s,[{key:"getHalfDayType",value:function(){return this.presenceTypesService.getPresenceType(this.settings.halfDayPresenceTypeId).pipe(Object(k.a)(function(e){return e.Active?e:null}))}},{key:"onSaveSuccess",value:function(){this.selectionService.clear(),this.state.resetEntries(),e(i(s.prototype),"onSaveSuccess",this).call(this)}},{key:"navigateBack",value:function(){var e=this;this.state.queryParams$.pipe(Object(I.a)(1)).subscribe(function(n){e.router.navigate(["/my-absences/report"],{queryParams:n})})}}]),s}($e),Bn.\u0275fac=function(e){return new(e||Bn)(M.Mb(ve.c),M.Mb(g.g),M.Mb(Ce.b),M.Mb(Q.d),M.Mb(Re.a),M.Mb(Oe.a),M.Mb($.a),M.Mb(C.a),M.Mb(qe),M.Mb(Je))},Bn.\u0275cmp=M.Gb({type:Bn,selectors:[["erz-my-absences-confirm"]],features:[M.wb],decls:25,vars:32,consts:[[1,"erz-container","erz-container-limited","erz-container-padding-y"],["class","mb-3 pb-3 border-bottom",4,"erzLet"],[3,"formGroup","ngSubmit"],[1,"form-group","mb-3","border-bottom"],["class","form-check my-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"remark"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],["type","submit",1,"btn","btn-primary","ml-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"mb-3","pb-3","border-bottom"],[1,"form-check","my-3",3,"ngClass"],["type","radio","formControlName","absenceTypeId",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],[4,"ngIf"],["class","invalid-feedback mt-4",4,"ngFor","ngForOf"],[1,"invalid-feedback","mt-4"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"sr-only"]],template:function(e,n){1&e&&(M.Sb(0,"div",0),M.Bc(1,Mn,3,6,"div",1),M.gc(2,"async"),M.Sb(3,"form",2),M.dc("ngSubmit",function(){return n.onSubmit()}),M.Sb(4,"div",3),M.Sb(5,"label"),M.Dc(6),M.gc(7,"translate"),M.gc(8,"addSpace"),M.Rb(),M.Bc(9,wn,7,14,"div",4),M.gc(10,"async"),M.Rb(),M.Sb(11,"div",5),M.Dc(12),M.gc(13,"translate"),M.Rb(),M.Sb(14,"div",6),M.Sb(15,"button",7),M.dc("click",function(){return n.cancel()}),M.gc(16,"async"),M.Dc(17),M.gc(18,"translate"),M.Rb(),M.Sb(19,"button",8),M.gc(20,"async"),M.Dc(21),M.gc(22,"translate"),M.Bc(23,xn,3,0,"div",9),M.gc(24,"async"),M.Rb(),M.Rb(),M.Rb(),M.Rb()),2&e&&(M.zb(1),M.lc("erzLet",M.hc(2,11,n.getSelectedCount())),M.zb(2),M.lc("formGroup",n.formGroup),M.zb(3),M.Gc("",M.hc(7,13,"my-absences.confirm.choose-presence-type"),"",M.ic(8,15,":",":"),""),M.zb(3),M.lc("ngForOf",M.hc(10,18,n.absenceTypes$)),M.zb(3),M.Fc(" ",M.hc(13,20,"my-absences.confirm.remark")," "),M.zb(3),M.lc("disabled",M.hc(16,22,n.saving$)),M.zb(2),M.Fc(" ",M.hc(18,24,"my-absences.confirm.cancel")," "),M.zb(2),M.lc("disabled",M.hc(20,26,n.saving$)),M.zb(2),M.Fc(" ",M.hc(22,28,"my-absences.confirm.save")," "),M.zb(2),M.lc("ngIf",M.hc(24,30,n.saving$)))},directives:[G.a,ve.r,ve.j,ve.e,K.l,K.m,K.k,ve.n,ve.b,ve.i,ve.d],pipes:[K.b,Q.c,je.a],styles:[""],changeDetection:0}),Bn)}]}]}],Hn=((Nn=function e(){b(this,e)}).\u0275fac=function(e){return new(e||Nn)},Nn.\u0275mod=M.Kb({type:Nn}),Nn.\u0275inj=M.Jb({imports:[[g.j.forChild(Gn)],g.j]}),Nn),Qn=((En=function e(){b(this,e)}).\u0275fac=function(e){return new(e||En)},En.\u0275mod=M.Kb({type:En}),En.\u0275inj=M.Jb({imports:[[p.a,Hn]]}),En)}}])}();