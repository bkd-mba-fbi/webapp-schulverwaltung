import{b as Me}from"./chunk-QMQAOEA2.js";import{b as Se}from"./chunk-Y4QYVF5K.js";import{a as Ce}from"./chunk-VC5UPH5O.js";import"./chunk-JH5SE53N.js";import{i as _e}from"./chunk-AYB63UDV.js";import"./chunk-243DB4JG.js";import{a as be}from"./chunk-RQKJ2TYN.js";import{$a as b,Ab as v,Ba as o,Bb as T,Bd as ce,Cd as de,Fb as Z,Gb as ee,Gd as me,Hb as te,Hc as se,Ib as L,Id as ue,Jb as A,K as q,Kb as j,La as u,Lb as ie,M as G,P as D,Q as z,Qd as he,Rb as c,Rd as F,S as N,Sa as y,Sb as d,Sd as fe,U as w,Ua as S,Va as h,X as R,Xa as B,Yb as ne,Z as H,_ as Y,_d as ge,a as E,ae as ye,b as P,bb as Q,ca as m,cb as _,ce as ve,db as M,de as O,eb as a,f as U,fb as s,g as K,gb as g,lc as oe,m as I,mb as X,nb as x,p as C,pa as J,rd as ae,sd as re,td as le,xd as $,y as W,yd as pe,zb as f}from"./chunk-23XES5LI.js";var xe=(()=>{class t{constructor(){this.settings=m(ae),this.storage=m(Ce),this.currentRoles=null}getNotificationTypes(){return this.getNotificationTypeKeys().map(e=>{if(!(e in this.settings.notificationTypes))throw new Error(`Key '${e}' is missing in 'notificationTypes' setting`);return{key:e,text:this.settings.notificationTypes[e]}})}getNotificationTypeKeys(){return ge(this.settings.notificationTypesAssignments.reduce((e,{roles:i,types:n})=>this.hasAnyRole(i)?[...e,...n]:e,[]))}hasAnyRole(e){return this.currentRoles===null&&(this.currentRoles=Se(this.storage.getPayload()?.roles)),this.currentRoles.some(i=>e.includes(i))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Y({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Te=(()=>{class t{constructor(){this.id=null,this.label=null,this.disabled=!1,this.value=!1,this.valueChange=new J,this.fallbackId=ye("bkd-switch")}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=u({type:t,selectors:[["bkd-switch"]],inputs:{id:"id",label:"label",disabled:"disabled",value:"value"},outputs:{valueChange:"valueChange"},decls:3,vars:5,consts:[["type","checkbox",3,"ngModelChange","disabled","ngModel"]],template:function(i,n){if(i&1&&(a(0,"input",0),X("ngModelChange",function(p){return n.valueChange.emit(p)}),s(),a(1,"label"),f(2),s()),i&2){let r,p;h("disabled",n.disabled)("ngModel",n.value),S("id",(r=n.id)!==null&&r!==void 0?r:n.fallbackId),o(),S("for",(p=n.id)!==null&&p!==void 0?p:n.fallbackId),o(),v(n.label)}},dependencies:[F,le,$,ce],styles:['input[_ngcontent-%COMP%]{opacity:0;position:absolute}label[_ngcontent-%COMP%]{cursor:pointer;text-indent:-9999px;width:36px;height:18px;border:1px solid rgb(0,0,0);background:#fff;display:block;border-radius:18px;position:relative}label[_ngcontent-%COMP%]:after{content:"";position:absolute;top:1px;left:1px;width:14px;height:14px;background:#000;border-radius:14px;transition:.3s}input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{border-color:#000;background:#000}input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 1px);transform:translate(-100%);background:#fff}input[_ngcontent-%COMP%]:focus + label[_ngcontent-%COMP%]{box-shadow:0 0 0 .25rem #4e4e4e40}input[_ngcontent-%COMP%]:disabled + label[_ngcontent-%COMP%]{cursor:default;background:#fff;border-color:#dedede}input[_ngcontent-%COMP%]:disabled + label[_ngcontent-%COMP%]:after{background:#dedede}label[_ngcontent-%COMP%]:active:after{width:18.2px}'],changeDetection:0})}}return t})();function Ee(t,l){if(t&1&&(a(0,"div"),f(1),s()),t&2){let e=l.$implicit;o(),T(" ",e," ")}}function Pe(t,l){if(t&1&&(a(0,"div",3),_(1,Ee,2,1,"div",null,Q),s()),t&2){let e=x();o(),M(e.descriptionLines)}}var ke=(()=>{class t{constructor(){this.cd=m(ne),this.id="",this.label="",this.description=null,this.disabled=!1,this.onChange=e=>{},this.onTouched=()=>{},this._value=!1}get value(){return this._value}set value(e){this._value=e,this.onChange(e)}get descriptionLines(){return this.description?this.description.split(`
`):[]}writeValue(e){this._value=e}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled=e,this.cd.markForCheck()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=u({type:t,selectors:[["bkd-my-settings-notifications-toggle"]],inputs:{id:"id",label:"label",description:"description",disabled:"disabled"},features:[ie([{provide:re,useExisting:H(()=>t),multi:!0}])],decls:5,vars:6,consts:[[1,"d-flex","align-items-center"],[1,"flex-fill"],[3,"valueChange","id","value","disabled"],[1,"form-text"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"label",1),f(2),s(),a(3,"bkd-switch",2),te("valueChange",function(p){return ee(n.value,p)||(n.value=p),p}),s()(),y(4,Pe,3,0,"div",3)),i&2&&(o(),S("for",n.id),o(),T(" ",n.label," "),o(),h("id",n.id),Z("value",n.value),h("disabled",n.disabled),o(),b(n.description?4:-1))},dependencies:[Te],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}}return t})();var Ne=(t,l)=>l.key;function Ie(t,l){t&1&&(a(0,"div",2),g(1,"bkd-spinner",5),s())}function Ge(t,l){if(t&1&&(g(0,"bkd-my-settings-notifications-toggle",7),c(1,"async"),c(2,"async")),t&2){let e=l.$implicit,i=l.$index;B("mt-4",i>0),h("id","notification-channels-"+e.key)("label",d(1,6,e.label))("description",d(2,8,e.description))("formControlName",e.key)}}function De(t,l){if(t&1&&(a(0,"form",3),_(1,Ge,3,10,"bkd-my-settings-notifications-toggle",6,Ne),s()),t&2){let e=x(),i=j(0);h("formGroup",i),o(),M(e.channelsSettings)}}function Re(t,l){if(t&1&&(g(0,"bkd-my-settings-notifications-toggle",7),c(1,"async"),c(2,"async")),t&2){let e=l.$implicit,i=l.$index;B("mt-4",i>0),h("id","notification-types-"+e.key)("label",d(1,6,e.label))("description",d(2,8,e.description))("formControlName",e.key)}}function Be(t,l){if(t&1&&(a(0,"form",3),_(1,Re,3,10,"bkd-my-settings-notifications-toggle",6,Ne),s()),t&2){let e=x(),i=j(2);h("formGroup",i),o(),M(e.typesSettings)}}var we=(()=>{class t{constructor(){this.userSettings=m(Me),this.formBuilder=m(he),this.toastService=m(be),this.translate=m(ve),this.notificationTypes=m(xe),this.channelsSettings=[{key:"gui",label:this.translate.get("my-settings.notifications.gui")},{key:"mail",label:this.translate.get("my-settings.notifications.mail")},{key:"phoneMobile",label:this.translate.get("my-settings.notifications.phoneMobile")}],this.typesSettings=this.notificationTypes.getNotificationTypes().map(e=>{let{label:i,description:n}=this.translate.currentLang==="fr-CH"?e.text.fr:e.text.de;return{key:e.key,label:I(i),description:I(n)}}),this.channelsValue$=this.userSettings.getNotificationChannels(),this.typesValue$=this.userSettings.getNotificationTypesInactive().pipe(C(this.typesArrayToRecord.bind(this))),this.channelsFormGroup$=this.channelsValue$.pipe(C(e=>this.createFormGroup(this.channelsSettings,e)),D(1)),this.allChannelsInactive$=W(this.channelsValue$,this.channelsFormGroup$.pipe(N(e=>e.valueChanges))).pipe(C(e=>Object.values(e).every(i=>!i)),q()),this.typesFormGroup$=this.typesValue$.pipe(R(this.allChannelsInactive$),C(([e,i])=>this.createFormGroup(this.typesSettings,e,!0,i)),D(1)),this.saving$=new K(!1),this.destroy$=new U}ngOnInit(){this.userSettings.refetch(),this.allChannelsInactive$.pipe(z(1),R(this.typesFormGroup$),w(this.destroy$)).subscribe(([e,i])=>{Object.values(i.controls).forEach(n=>e?n.disable():n.enable())}),this.channelsFormGroup$.pipe(w(this.destroy$),N(e=>e.valueChanges)).subscribe(this.saveChannels.bind(this)),this.typesFormGroup$.pipe(w(this.destroy$),N(e=>e.valueChanges)).subscribe(this.saveTypes.bind(this))}ngOnDestroy(){this.destroy$.next()}createFormGroup(e,i,n=!1,r=!1){return this.formBuilder.group(e.reduce((p,{key:V})=>P(E({},p),{[V]:[{value:i[V]??n,disabled:r}]}),{}))}saveChannels(e){this.saving$.next(!0),this.userSettings.saveNotificationChannels(e).pipe(G(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}saveTypes(e){this.saving$.next(!0),this.userSettings.saveNotificationTypesInactive(this.typesRecordToArray(e)).pipe(G(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("my-settings.notifications.save-success"))}typesArrayToRecord(e){return this.typesSettings.reduce((n,{key:r})=>P(E({},n),{[r]:!e.includes(r)}),{})}typesRecordToArray(e){return Object.keys(e).reduce((n,r)=>e[r]?n:[...n,r],[])}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=u({type:t,selectors:[["bkd-my-settings-notifications"]],decls:17,vars:17,consts:[[1,"pb-4"],[1,"m-0","pb-3","d-flex","align-items-stretch"],[1,"position-relative"],[3,"formGroup"],[1,"mt-4","form-text"],[1,"position-absolute","inline","small","d-inline-block","ms-2"],[3,"id","label","description","formControlName","mt-4"],[3,"id","label","description","formControlName"]],template:function(i,n){if(i&1&&(L(0),c(1,"async"),L(2),c(3,"async"),a(4,"div",0)(5,"h2",1)(6,"span"),f(7),c(8,"translate"),s(),y(9,Ie,2,0,"div",2),c(10,"async"),s(),y(11,De,3,1,"form",3),a(12,"p",4),f(13),c(14,"translate"),s(),g(15,"hr"),y(16,Be,3,1,"form",3),s()),i&2){let r=A(d(1,5,n.channelsFormGroup$));o(2);let p=A(d(3,8,n.typesFormGroup$));o(5),v(d(8,11,"my-settings.notifications.title")),o(2),b(d(10,13,n.saving$)?9:-1),o(2),b(r?11:-1),o(2),T(" ",d(14,15,"my-settings.notifications.privacy-hint")," "),o(3),b(p?16:-1)}},dependencies:[_e,F,de,$,pe,fe,me,ue,ke,oe,O],styles:[".checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important}"],changeDetection:0})}}return t})();var $e=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=u({type:t,selectors:[["bkd-my-settings-show"]],decls:5,vars:3,consts:[[1,"bkd-container","bkd-container-limited"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"h1"),f(2),c(3,"translate"),s(),g(4,"bkd-my-settings-notifications"),s()),i&2&&(o(2),v(d(3,1,"my-settings.title")))},dependencies:[we,O],encapsulation:2})}}return t})();var Fe=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=u({type:t,selectors:[["bkd-my-settings"]],decls:1,vars:0,template:function(i,n){i&1&&g(0,"router-outlet")},dependencies:[se],encapsulation:2,changeDetection:0})}}return t})();var $t=[{path:"",component:Fe,children:[{path:"",component:$e}]}];export{$t as MY_SETTINGS_ROUTES};
