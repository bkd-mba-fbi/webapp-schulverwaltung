import{a as te}from"./chunk-MOUU4NVJ.js";import{a as me}from"./chunk-VGYWDNUP.js";import{a as fe,b as ve,c as be}from"./chunk-5OPYJ6TU.js";import{a as _e}from"./chunk-DPEWBBYN.js";import{a as de}from"./chunk-2XASZCAK.js";import{a as pe,b as ue}from"./chunk-4AD6ZYJB.js";import"./chunk-XVSXXWST.js";import{a as ce}from"./chunk-B5DYS5JB.js";import"./chunk-E4SARKOR.js";import{f as oe}from"./chunk-RDNZARDR.js";import"./chunk-6BKFZAMB.js";import{i as le}from"./chunk-XWISOVKN.js";import"./chunk-3DIISX7M.js";import"./chunk-6A3MULQJ.js";import{a as Ce}from"./chunk-I75JD2K7.js";import{c as ae,e as D}from"./chunk-GOVFDFD6.js";import{B as ne,f as ie}from"./chunk-BQGWWMPT.js";import"./chunk-C4EQUSNO.js";import"./chunk-WORSXEGE.js";import{f as se}from"./chunk-6LRQCBUO.js";import"./chunk-Y4QYVF5K.js";import"./chunk-UOIIL2R2.js";import"./chunk-JE6RMKPQ.js";import"./chunk-RXV77OBQ.js";import"./chunk-M3VKTN3S.js";import"./chunk-USF5QQBL.js";import"./chunk-MPIUER5J.js";import"./chunk-GXPB5I4C.js";import"./chunk-D2H555EG.js";import"./chunk-KZWEGXU2.js";import"./chunk-YHCR7GAG.js";import"./chunk-KFP6476W.js";import{i as re}from"./chunk-QWYAXZZX.js";import"./chunk-KKDVS2NL.js";import"./chunk-WNZFLLQC.js";import"./chunk-DVBPCEX4.js";import"./chunk-GH7I4V3C.js";import"./chunk-M732YBIP.js";import{r as Y,s as Z,u as ee}from"./chunk-RYYQAFJB.js";import{$b as F,Ac as R,Ba as K,Bc as B,Cc as y,Fb as G,Fc as X,Gc as z,Hb as f,Hc as H,Ib as M,Jb as v,Lc as s,Mb as w,Mc as l,Nb as I,O,Ob as C,Pb as r,Qb as o,Rb as E,X as j,_ as V,aa as q,bc as g,dc as p,fb as a,ha as U,je as $,ma as d,qd as J,rc as m,sa as T,sc as b,t as W,ta as P,tc as h,td as Q,ub as S,xc as x,yc as k,zc as A}from"./chunk-CHBP6U4G.js";var L=(()=>{class e extends ue{constructor(){super("/evaluate-absences"),this.lessonPresenceService=d(D),this.queryParamsString$.pipe(q(this.destroy$)).subscribe(t=>this.confirmBackLinkParams={returnparams:t})}updateAfterConfirm(){this.resetEntries()}getInitialFilter(){return{student:null,educationalEvent:null,studyClass:null}}isValidFilter(t){return!!(t.student||t.educationalEvent||t.studyClass)}getInitialSortCriteria(){return{primarySortKey:"StudentFullName",ascending:!0}}loadEntries(t,n,i){return this.loadingService.load(this.lessonPresenceService.getStatistics(t,n,i),pe)}buildParamsFromFilter(t){return fe(t)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=U({token:e,factory:e.\u0275fac})}}return e})();var he=(()=>{class e{constructor(){this.studentsService=d(oe),this.educationalEventsService=d(be),this.studyClassesService=d(de),this.filter={student:null,educationalEvent:null,studyClass:null},this.filterChange=new K,this.classesHttpFilter={params:{fields:"IsActive","filter.IsActive":"=true"}}}show(){this.filterChange.emit(this.filter)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-evaluate-absences-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},decls:20,vars:19,consts:[[1,"row","g-3","align-items-end"],[1,"col-sm-12","col-md"],[1,"form-label"],[3,"valueChange","typeaheadService","value"],[3,"valueChange","typeaheadService","value","additionalHttpParams"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(n,i){n&1&&(r(0,"div",0)(1,"div",1)(2,"label",2),m(3),s(4,"translate"),o(),r(5,"bkd-typeahead",3),A("valueChange",function(u){return k(i.filter.student,u)||(i.filter.student=u),u}),o()(),r(6,"div",1)(7,"label",2),m(8),s(9,"translate"),o(),r(10,"bkd-typeahead",3),A("valueChange",function(u){return k(i.filter.educationalEvent,u)||(i.filter.educationalEvent=u),u}),o()(),r(11,"div",1)(12,"label",2),m(13),s(14,"translate"),o(),r(15,"bkd-typeahead",4),A("valueChange",function(u){return k(i.filter.studyClass,u)||(i.filter.studyClass=u),u}),o()(),r(16,"div",5)(17,"button",6),g("click",function(){return i.show()}),m(18),s(19,"translate"),o()()()),n&2&&(a(3),b(l(4,11,"evaluate-absences.header.student")),a(2),C("typeaheadService",i.studentsService),x("value",i.filter.student),a(3),b(l(9,13,"evaluate-absences.header.module-instance")),a(2),C("typeaheadService",i.educationalEventsService),x("value",i.filter.educationalEvent),a(3),b(l(14,15,"evaluate-absences.header.study-class")),a(2),C("typeaheadService",i.studyClassesService),x("value",i.filter.studyClass),C("additionalHttpParams",i.classesHttpFilter),a(3),h(" ",l(19,17,"evaluate-absences.header.show")," "))},dependencies:[_e,$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1rem 1rem 1rem 0;border-bottom:1px solid #dee2e6}"],changeDetection:0})}}return e})();var xe=()=>[],ke=e=>["student",e,"absences"],Ae=e=>({returnparams:e}),ye=(e,c)=>c.key,Le=(e,c)=>c.StudentRef.Id;function Te(e,c){e&1&&E(0,"bkd-spinner")}function Pe(e,c){if(e&1){let t=F();r(0,"th",6)(1,"bkd-sortable-header",9),s(2,"translate"),s(3,"translate"),A("sortCriteriaChange",function(i){T(t);let _=p(4);return k(_.state.sortCriteria,i)||(_.state.sortCriteria=i),P(i)}),o()()}if(e&2){let t=c.$implicit,n=p(4);a(),C("ngClass",t.label)("label",l(2,5,"evaluate-absences.list.header."+t.label))("sortKey",t.key),x("sortCriteria",n.state.sortCriteria),C("ngbTooltip",l(3,7,"evaluate-absences.list.header."+t.label))}}function Fe(e,c){if(e&1&&(r(0,"a",10),s(1,"async"),m(2),o()),e&2){let t=p().$implicit,n=p().$implicit,i=p(5);C("routerLink",H(5,ke,n.StudentRef.Id))("queryParams",H(7,Ae,l(1,3,i.profileReturnParams$))),a(2),h(" ",n[t.key]," ")}}function we(e,c){if(e&1&&m(0),e&2){let t=p().$implicit,n=p().$implicit;h(" ",n[t.key]," ")}}function Ie(e,c){if(e&1&&(r(0,"td"),s(1,"translate"),f(2,Fe,3,9,"a",10)(3,we,1,1),o()),e&2){let t=c.$implicit;G("data-label",l(1,2,"evaluate-absences.list.header."+t.label)),a(2),v(t.key==="StudentFullName"?2:3)}}function Re(e,c){if(e&1&&(r(0,"tr"),w(1,Ie,4,4,"td",null,ye),o()),e&2){let t=p(5);a(),I(t.columns)}}function Be(e,c){if(e&1&&(r(0,"tbody"),w(1,Re,3,0,"tr",null,Le),o()),e&2){p(4);let t=y(0);a(),I(t)}}function $e(e,c){e&1&&E(0,"bkd-spinner",7)}function De(e,c){if(e&1){let t=F();r(0,"button",11),g("click",function(){T(t);let i=p(4);return P(i.state.nextPage())}),m(1),s(2,"translate"),o()}e&2&&(a(),h(" ",l(2,1,"global.pagination.load-more")," "))}function Ve(e,c){if(e&1){let t=F();r(0,"div",2)(1,"div",3),E(2,"bkd-reports-link",4),s(3,"async"),o(),r(4,"table",5),g("scrolled",function(){T(t);let i=p(3);return P(i.onScroll())}),r(5,"thead")(6,"tr"),w(7,Pe,4,9,"th",6,ye),o()(),f(9,Be,3,0,"tbody"),o(),f(10,$e,1,0,"bkd-spinner",7),f(11,De,3,3,"button",8),o()}if(e&2){let t=p(3),n=y(0),i=y(2),_=y(4);a(2),C("reports",l(3,4,t.reports$)??z(6,xe)),a(5),I(t.columns),a(2),v(n&&n.length>0?9:-1),a(),v(_?10:-1),a(),v(i&&!_?11:-1)}}function Me(e,c){e&1&&(r(0,"p",1),m(1),s(2,"translate"),o()),e&2&&(a(),h(" ",l(2,1,"evaluate-absences.no-entries")," "))}function He(e,c){if(e&1&&f(0,Ve,12,7,"div",2)(1,Me,3,3,"p",1),e&2){p(2);let t=y(0),n=y(4);v(t&&t.length>0||n?0:1)}}function Ne(e,c){if(e&1&&(f(0,Te,1,0,"bkd-spinner"),s(1,"async"),M(2,He,2,1)),e&2){let t=p();v(l(1,1,t.state.loading$)?0:2)}}function We(e,c){e&1&&(r(0,"p",1),m(1),s(2,"translate"),o()),e&2&&(a(),b(l(2,1,"evaluate-absences.no-filter")))}var Se=(()=>{class e{constructor(){this.state=d(L),this.scrollPosition=d(Ce),this.route=d(Y),this.presenceTypesService=d(ie),this.reportsService=d(le),this.lessonPresencesService=d(D),this.reports$=this.loadReports(),this.columns=[{key:"StudentFullName",label:"student"},{key:"TotalAbsences",label:"total"},{key:"TotalAbsencesValidExcuse",label:"valid-excuse"},{key:"TotalAbsencesWithoutExcuse",label:"without-excuse"},{key:"TotalAbsencesUnconfirmed",label:"unconfirmed"},{key:"TotalAbsencesUnchecked",label:"unchecked"},{key:"TotalIncidents",label:"incident"}],this.filterFromParams$=this.route.queryParams.pipe(W(Oe)),this.profileReturnParams$=this.state.queryParamsString$}ngOnInit(){this.filterFromParams$.pipe(O(1)).subscribe(t=>this.state.setFilter(t)),this.presenceTypesService.halfDayActive$.subscribe(t=>{t&&(this.columns=[...this.columns,{key:"TotalHalfDays",label:"halfday"}])})}ngAfterViewInit(){this.scrollPosition.restore()}onScroll(){this.state.nextPage()}loadReports(){return this.state.validFilter$.pipe(V(t=>this.lessonPresencesService.getLessonRefs(t)),V(t=>t.length>0?this.reportsService.getEvaluateAbsencesReports(this.getReportRecordIds(t)):[]),j(1))}getReportRecordIds(t){return t.map(n=>`${n.LessonRef.Id}_${n.RegistrationRef.Id}`)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-evaluate-absences-list"]],decls:14,vars:18,consts:[[3,"filterChange","filter"],[1,"mt-3"],[1,"py-3"],[1,"buttons"],[1,"mb-2",3,"reports"],["infiniteScroll","",1,"table","table-striped","table-fixed",3,"scrolled"],["scope","col"],[1,"inline"],["type","button",1,"btn","btn-outline-secondary","btn-sm","d-block","mx-auto"],[3,"sortCriteriaChange","ngClass","label","sortKey","sortCriteria","ngbTooltip"],[1,"student",3,"routerLink","queryParams"],["type","button",1,"btn","btn-outline-secondary","btn-sm","d-block","mx-auto",3,"click"]],template:function(n,i){if(n&1){let _=F();R(0),s(1,"async"),R(2),s(3,"async"),R(4),s(5,"async"),r(6,"h1"),m(7),s(8,"translate"),o(),r(9,"bkd-evaluate-absences-header",0),s(10,"async"),g("filterChange",function(ge){return T(_),P(i.state.setFilter(ge))}),o(),f(11,Ne,3,3),s(12,"async"),M(13,We,3,3,"p",1)}n&2&&(B(l(1,3,i.state.entries$)),a(2),B(l(3,6,i.state.hasMore$)),a(2),B(l(5,9,i.state.loadingPage$)),a(3),b(l(8,12,"evaluate-absences.title")),a(2),C("filter",l(10,14,i.filterFromParams$)),a(2),v(l(12,16,i.state.isFilterValid$)?11:13))},dependencies:[he,se,ve,te,ee,re,me,J,Q,$],styles:["th[_ngcontent-%COMP%]{cursor:pointer}th.student[_ngcontent-%COMP%]{width:30%}.buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"],changeDetection:0})}}return e})();function Oe(e){return{student:e.student?Number(e.student):null,educationalEvent:e.educationalEvent?Number(e.educationalEvent):null,studyClass:e.studyClass?Number(e.studyClass):null}}var Ee=(()=>{class e{constructor(){this.state=d(L)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-evaluate-absences"]],features:[X([L,{provide:ae,useExisting:L},ne])],decls:1,vars:0,template:function(n,i){n&1&&E(0,"router-outlet")},dependencies:[Z],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}}return e})();var Vt=[{path:"",component:Ee,children:[{path:"",component:Se,data:{restoreScrollPositionFrom:["/evaluate-absences/student/:id"]}},ce]}];export{Vt as EVALUATE_ABSENCES_ROUTES};
