"use strict";(self.webpackChunkwebapp_schulverwaltung=self.webpackChunkwebapp_schulverwaltung||[]).push([[0],{2e3:(Z,S,o)=>{o.r(S),o.d(S,{EVENTS_ROUTES:()=>wn});var P=o(6407),l=o(3955),u=o(177),j=o(2239),E=o(1517),T=o(7887),m=o(5539),t=o(4438);const b=n=>[n,"tests"];function ft(n,a){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"date"),t.nrm(3,"wbr"),t.EFF(4),t.nI1(5,"date"),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI("",t.i5U(2,2,e.event.dateFrom,"dd.MM.yyyy"),"\u2013"),t.R7$(3),t.JRh(t.i5U(5,5,e.event.dateTo,"dd.MM.yyyy"))}}function I(n,a){if(1&n&&(t.j41(0,"a",10)(1,"i",11),t.EFF(2,"arrow_right_alt"),t.k0s(),t.j41(3,"span",12),t.EFF(4),t.k0s()()),2&n){const e=t.XpG(2);t.Y8G("routerLink",t.eq3(2,b,e.event.id)),t.R7$(4),t.JRh(e.event.evaluationText)}}function f(n,a){if(1&n&&(t.j41(0,"a",13)(1,"i",11),t.EFF(2,"arrow_right_alt"),t.k0s(),t.j41(3,"span",12),t.EFF(4),t.k0s()()),2&n){const e=t.XpG(2);t.Y8G("href",e.event.evaluationLink,t.B4B),t.R7$(4),t.SpI("",e.event.evaluationText," ")}}function L(n,a){if(1&n&&(t.j41(0,"div",7),t.DNE(1,I,5,4,"a",8)(2,f,5,2,"a",9),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngIf",!e.event.evaluationLink),t.R7$(),t.Y8G("ngIf",e.event.evaluationLink)}}let _t=(()=>{class n{constructor(){this.withRatings=!0}static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-events-list-entry"]],inputs:{event:"event",withRatings:"withRatings"},standalone:!0,features:[t.aNF],decls:11,vars:8,consts:[[1,"designation"],[3,"href"],[1,"date"],[4,"ngIf"],[1,"registrations"],[1,"registrations-label"],["class","rating",4,"ngIf"],[1,"rating"],["class","d-flex",3,"routerLink",4,"ngIf"],["class","d-flex",3,"href",4,"ngIf"],[1,"d-flex",3,"routerLink"],[1,"material-icons"],[1,"ps-1"],[1,"d-flex",3,"href"]],template:function(s,i){1&s&&(t.j41(0,"div",0)(1,"a",1),t.EFF(2),t.k0s()(),t.j41(3,"div",2),t.DNE(4,ft,6,8,"span",3),t.k0s(),t.j41(5,"div",4),t.EFF(6),t.j41(7,"span",5),t.EFF(8),t.nI1(9,"translate"),t.k0s()(),t.DNE(10,L,3,2,"div",6)),2&s&&(t.R7$(),t.Y8G("href",i.event.detailLink,t.B4B),t.R7$(),t.JRh(i.event.designation),t.R7$(2),t.Y8G("ngIf",i.event.dateFrom&&i.event.dateTo),t.R7$(2),t.SpI(" ",i.event.studentCount," "),t.R7$(2),t.JRh(t.bMT(9,6,1===i.event.studentCount?"events.registration":"events.registrations")),t.R7$(2),t.Y8G("ngIf",i.withRatings&&i.event.evaluationText))},dependencies:[u.bT,m.Wk,u.vh,l.h,l.D9],styles:['[_nghost-%COMP%]{display:grid;padding:1rem;border-bottom:1px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}.designation[_ngcontent-%COMP%]{grid-area:designation;padding-right:1rem}.date[_ngcontent-%COMP%]{grid-area:date;padding-right:1rem}.registrations[_ngcontent-%COMP%]{grid-area:registrations;padding-right:1rem}.rating[_ngcontent-%COMP%]{grid-area:rating}.rating[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.registrations-label[_ngcontent-%COMP%]{display:none}@media (max-width: 575.98px){.registrations-label[_ngcontent-%COMP%]{display:inline}.designation[_ngcontent-%COMP%], .date[_ngcontent-%COMP%], .registrations[_ngcontent-%COMP%]{padding-right:0}[_nghost-%COMP%]{grid-template-areas:"designation" "date" "registrations" "rating";grid-template-columns:1fr}}']})}return n})();var bt=o(4903),y=o(4412),p=o(6354),C=o(4668),v=o(5558),R=o(4572),G=o(7673),X=o(2809),A=o(3382),vt=o(4297),Tt=o(8358);function q(n){const{HasEvaluationStarted:a,EvaluationUntil:e,HasTestGrading:s}=n.EvaluationStatusRef;if(!0===a&&(14030===n.StatusId||10350===n.StatusId))return{value:$.Rating};if(!0===a&&!1===s){if(e)return{value:$.RatingUntil};if(10300===n.StatusId)return{value:$.IntermediateRating}}return!1===a&&!0===s&&10260!==n.StatusId&&10250!==n.StatusId?{value:$.Tests}:!0===a&&!0===s?e?{value:$.Tests,label:$.RatingUntil}:{value:$.Tests,label:$.IntermediateRating}:null}function kt(n){return!0===n.EvaluationStatusRef.HasEvaluationStarted}function tt(n){const a=n.Classes?n.Classes.map(e=>e.Number).join(", "):null;return a?n.Designation+", "+a:n.Designation}var V=o(5449),Et=o(5400),Rt=o(9483),et=o(2673),$=function(n){return n.Rating="rating",n.RatingUntil="rating-until",n.IntermediateRating="intermediate-rating",n.Tests="add-tests",n}($||{});let Y=(()=>{class n{constructor(e,s,i,r,d,c){this.coursesRestService=e,this.eventsRestService=s,this.studyClassRestService=i,this.loadingService=r,this.translate=d,this.settings=c,this.loading$=this.loadingService.loading$,this.searchSubject$=new y.t(""),this.search$=this.searchSubject$.asObservable(),this.roles$=new y.t(null),this.isClassTeacher$=this.roles$.pipe((0,p.T)(h=>(0,vt.h)(h,"ClassTeacherRole")),(0,C.t)(1)),this.withStudyCourses$=new y.t(!1),this.unratedCourses$=this.roles$.pipe((0,v.n)(this.loadUnratedCourses.bind(this)),(0,C.t)(1)),this.studyCourses$=this.withStudyCourses$.pipe((0,v.n)(this.loadStudyCourses.bind(this)),(0,C.t)(1)),this.formativeAssessments$=this.isClassTeacher$.pipe((0,v.n)(this.loadFormativeAssessments.bind(this)),(0,C.t)(1)),this.studyClasses$=this.isClassTeacher$.pipe((0,v.n)(this.loadStudyClasses.bind(this)),(0,C.t)(1)),this.events$=this.getEvents().pipe((0,C.t)(1)),this.filteredEvents$=(0,R.z)([this.events$,this.search$]).pipe((0,p.T)((0,A.i)(Tt.x)))}setSearch(e){this.searchSubject$.next(e)}setRoles(e){this.roles$.next(e)}setWithStudyCourses(e){this.withStudyCourses$.next(e)}getEntries(e=!1){return this.filteredEvents$.pipe((0,p.T)(s=>e?s.filter(i=>i.evaluationText):s))}getEvents(){return this.loadingService.load((0,R.z)([this.unratedCourses$,this.studyCourses$,this.formativeAssessments$,this.studyClasses$]),{stopOnFirstValue:!0}).pipe((0,p.T)((0,A.i)(this.createAndSortEvents.bind(this))))}loadUnratedCourses(e){return this.coursesRestService.getExpandedCourses(e).pipe((0,p.T)(s=>s.filter(i=>!function Ft(n){return!0===n.EvaluationStatusRef.HasReviewOfEvaluationStarted&&!!n.FinalGrades?.length}(i))))}loadStudyCourses(e){return e?this.eventsRestService.getStudyCourseEvents():(0,G.of)([])}loadFormativeAssessments(e){return e?this.studyClassRestService.getActiveFormativeAssessments():(0,G.of)([])}loadStudyClasses(e){return e?this.studyClassRestService.getActive():(0,G.of)([])}createAndSortEvents(e,s,i,r){const d=r.filter(c=>!i.map(h=>h.Id).includes(c.Id));return[...this.createFromCourses(e),...this.createFromStudyCourses(s),...this.createFromAssessments(i),...this.createFromStudyClasses(d)].sort((c,h)=>c.designation.localeCompare(h.designation))}createFromCourses(e){return e.map(s=>{const i=q(s);return{id:s.Id,designation:tt(s),detailLink:this.buildLink(s.Id,"eventdetail"),studentCount:s.AttendanceRef.StudentCount||0,dateFrom:s.DateFrom,dateTo:s.DateTo,state:i?.value||null,evaluationText:this.getEvaluationText(i,s.EvaluationStatusRef.EvaluationUntil),evaluationLink:this.getEvaluationLink(i?.value,s)}})}createFromStudyCourses(e){return e.map(s=>({id:s.Id,designation:s.Designation,detailLink:this.buildLink(s.Id,"eventdetail"),studentCount:s.StudentCount,state:null}))}createFromAssessments(e){return this.createFromStudyClasses(e).map(i=>({...i,state:$.Rating,evaluationText:this.translate.instant("events.state.rating"),evaluationLink:this.buildLink(i.id,"evaluation")}))}createFromStudyClasses(e){return e.map(s=>({id:s.Id,designation:s.Number,detailLink:this.buildLink(s.Id,"eventdetail"),studentCount:s.StudentCount,state:null}))}getEvaluationText(e,s){const i=e?.label||e?.value;return i?this.translate.instant(`events.state.${i}`)+(i===$.RatingUntil?` ${s?(0,bt.GP)(s,"dd.MM.yyyy"):""}`:""):""}getEvaluationLink(e,s){return e&&e!==$.Tests?this.buildLink(s.Id,"evaluation"):null}buildLink(e,s){return(this.settings.eventlist[s]??"").replace(":id",String(e))}static#t=this.\u0275fac=function(s){return new(s||n)(t.KVO(V.I),t.KVO(Et.z),t.KVO(Rt.r),t.KVO(et.U),t.KVO(l.c$),t.KVO(X.yy))};static#e=this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Mt=o(4599);const xt=n=>({events:n});function St(n,a){1&n&&(t.j41(0,"div",12),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"events.rating")," "))}function Pt(n,a){if(1&n&&t.nrm(0,"bkd-events-list-entry",13),2&n){const e=a.$implicit,s=t.XpG(4);t.Y8G("event",e)("withRatings",s.withRatings)}}function jt(n,a){if(1&n&&(t.qex(0),t.j41(1,"div",6)(2,"div",7),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"div",8),t.EFF(6),t.nI1(7,"translate"),t.k0s(),t.j41(8,"div",9),t.EFF(9),t.nI1(10,"translate"),t.k0s(),t.DNE(11,St,3,3,"div",10),t.k0s(),t.DNE(12,Pt,1,2,"bkd-events-list-entry",11),t.bVm()),2&n){const e=t.XpG(2).bkdLet,s=t.XpG();t.R7$(3),t.JRh(t.bMT(4,5,"events.designation")),t.R7$(3),t.JRh(t.bMT(7,7,"events.date")),t.R7$(3),t.SpI(" ",t.bMT(10,9,"events.registrations")," "),t.R7$(2),t.Y8G("ngIf",s.withRatings),t.R7$(),t.Y8G("ngForOf",e.events)}}function Ot(n,a){1&n&&(t.j41(0,"p",14),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"events.no-events")))}function Dt(n,a){if(1&n&&(t.qex(0),t.DNE(1,jt,13,11,"ng-container",5)(2,Ot,3,3,"ng-template",null,1,t.C5r),t.bVm()),2&n){const e=t.sdS(3),s=t.XpG().bkdLet;t.R7$(),t.Y8G("ngIf",(null==s.events?null:s.events.length)>0)("ngIfElse",e)}}function Nt(n,a){1&n&&t.nrm(0,"bkd-spinner")}function wt(n,a){if(1&n){const e=t.RV6();t.j41(0,"div",3)(1,"bkd-resettable-input",4),t.nI1(2,"async"),t.nI1(3,"translate"),t.nI1(4,"translate"),t.bIt("valueChange",function(i){t.eBV(e);const r=t.XpG();return t.Njj(r.state.setSearch(i))}),t.k0s(),t.DNE(5,Dt,4,2,"ng-container",5),t.nI1(6,"async"),t.DNE(7,Nt,1,0,"ng-template",null,0,t.C5r),t.k0s()}if(2&n){const e=a.bkdLet,s=t.sdS(8),i=t.XpG();t.R7$(),t.Y8G("value",t.bMT(2,6,i.state.search$))("placeholder",t.bMT(3,8,"events.search-by"))("label",t.bMT(4,10,"events.search"))("disabled",!e.events),t.R7$(4),t.Y8G("ngIf",!1===t.bMT(6,12,i.state.loading$))("ngIfElse",s)}}let nt=(()=>{class n{constructor(e,s){this.state=e,this.storage=s,this.withStudyCourses=!1,this.withRatings=!0,this.state.setRoles(this.storage.getPayload()?.roles??null)}ngOnChanges(e){e.withStudyCourses&&this.state.setWithStudyCourses(e.withStudyCourses.currentValue)}static#t=this.\u0275fac=function(s){return new(s||n)(t.rXU(Y),t.rXU(Mt.n))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-events-list"]],inputs:{withStudyCourses:"withStudyCourses",withRatings:"withRatings"},standalone:!0,features:[t.OA$,t.aNF],decls:2,vars:5,consts:[["loading",""],["noEvents",""],["class","bkd-container",4,"bkdLet"],[1,"bkd-container"],[1,"d-flex","search",3,"valueChange","value","placeholder","label","disabled"],[4,"ngIf","ngIfElse"],[1,"event-header"],[1,"designation"],[1,"date"],[1,"registrations"],["class","rating",4,"ngIf"],[3,"event","withRatings",4,"ngFor","ngForOf"],[1,"rating"],[3,"event","withRatings"],[1,"mt-3"]],template:function(s,i){1&s&&(t.DNE(0,wt,9,14,"div",2),t.nI1(1,"async")),2&s&&t.Y8G("bkdLet",t.eq3(3,xt,t.bMT(1,1,i.state.getEntries(i.withRatings))))},dependencies:[T.N,j.B,u.bT,u.pM,E.t,u.Jj,l.h,l.D9,_t],styles:['.search[_ngcontent-%COMP%]{max-width:500px}.event-header[_ngcontent-%COMP%]{display:grid;padding:1rem;border-bottom:2px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}@media (max-width: 575.98px){.event-header[_ngcontent-%COMP%]{display:none}}']})}return n})(),At=(()=>{class n{constructor(){}static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-events-current"]],standalone:!0,features:[t.aNF],decls:4,vars:5,consts:[[3,"withStudyCourses","withRatings"]],template:function(s,i){1&s&&(t.j41(0,"h1"),t.EFF(1),t.nI1(2,"translate"),t.k0s(),t.nrm(3,"bkd-events-list",0)),2&s&&(t.R7$(),t.JRh(t.bMT(2,3,"events.current.title")),t.R7$(2),t.Y8G("withStudyCourses",!0)("withRatings",!1))},dependencies:[nt,l.h,l.D9]})}return n})(),Vt=(()=>{class n{constructor(){}static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-events-tests"]],standalone:!0,features:[t.aNF],decls:4,vars:4,consts:[[3,"withRatings"]],template:function(s,i){1&s&&(t.j41(0,"h1"),t.EFF(1),t.nI1(2,"translate"),t.k0s(),t.nrm(3,"bkd-events-list",0)),2&s&&(t.R7$(),t.JRh(t.bMT(2,2,"events.title")),t.R7$(2),t.Y8G("withRatings",!0))},dependencies:[nt,l.h,l.D9]})}return n})();var Ut=o(9366);let Lt=(()=>{class n{constructor(){}static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-events"]],standalone:!0,features:[t.Jv_([Y,Ut.s]),t.aNF],decls:1,vars:0,template:function(s,i){1&s&&t.nrm(0,"router-outlet")},dependencies:[m.n3]})}return n})();var F=o(3294),st=o(980),g=o(9417),O=o(1324),Xt=o(1195),D=o(1413),B=o(6977),Yt=o(1964),N=o(8156);function Bt(n){return a=>{const e=Number(a.value);return e<=n?{greaterThan:{value:e,greaterThanValue:n}}:null}}var Jt=o(3460),Ht=o(977),it=o(2771),at=o(7786),Kt=o(2816),Wt=o(8810),J=o(5964),M=o(6697),zt=o(9437),rt=o(9736);function ot(n){return n.map(({finalGrade:a})=>a).filter(Qt)}function Qt(n){return null!==n}function qt(n,a){return a.map(e=>{if(void 0===e.Results||0===e.Results?.length)return{kind:"no-result",test:e};const s=e.Results?.find(i=>i.StudentId===n.Id);return void 0!==s?{kind:"grade",result:s,test:e}:{kind:"no-result",test:e}})}function te(n,a,e){const s=a.find(r=>r.StudentId===n.Id),i=e.find(r=>r.StudentId===n.Id);return s?{id:s.Id,average:ee(s),finalGradeId:s.GradeId,freeHandGrade:i?Number(i.Grade):null,canGrade:s.CanGrade}:null}function ee(n){return 0===n.AverageTestResult?null:n.AverageTestResult}function dt(n,a){return n===a?0:n<a?-1:1}function lt(n){return"grade"===n.kind}var H=o(9728);function ct(n,a){return[...a.filter(e=>e.Id!==n?.Id),n].filter(e=>null!=e)}function oe({id:n,selectedGradeId:a},e){return e.map(s=>s.Id!==n?s:{...s,GradeId:a})}var k=o(7113);function de(n,a){switch(a.type){case"reset":return a.payload;case"updateResult":return n?{...n,Tests:(0,k.C7)(a.payload.testResult,n.Tests||[],a.payload.ignore),Gradings:a.payload.grading?ct(a.payload.grading,n.Gradings||[]):n.Gradings}:null;case"deleteResult":return n?{...n,Tests:(0,k.tj)(a.payload.testId,a.payload.studentId,n.Tests||[]),Gradings:a.payload.grading?ct(a.payload.grading,n.Gradings||[]):n.Gradings||[]}:null;case"toggle-test-state":return n?{...n,Tests:(0,k.p6)(a.payload,n.Tests||[])}:null;case"final-grade-overwritten":return n?{...n,Gradings:oe({id:a.payload.id,selectedGradeId:a.payload.selectedGradeId},n.Gradings||[])}:null;case"replace-grades":return n?{...n,Gradings:a.payload}:null;case"delete-test":return n?{...n,Tests:(0,k.xk)(a.payload,n.Tests||[])}:null;default:return n}}var le=o(1763),ce=o(4456),ue=o(6952),pe=o(1626);let ge=(()=>{class n extends ue.G{constructor(e,s){super(e,s,ce.NL,"Gradings")}updateGrade(e,s){return this.http.put(`${this.baseUrl}/${e}`,{GradeId:s}).pipe((0,p.T)(()=>e))}static#t=this.\u0275fac=function(s){return new(s||n)(t.KVO(pe.Qq),t.KVO(X.yy))};static#e=this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var he=o(4814);const ut={onlyMine:!1,hidePublished:!1};let x=(()=>{class n{constructor(e,s,i,r,d){this.coursesRestService=e,this.gradingScalesRestService=s,this.gradingsRestService=i,this.loadingService=r,this.sortService=d,this.action$=new it.m(1),this.loading$=this.loadingService.loading$,this._courseId$=new it.m(1),this.courseId$=this._courseId$.asObservable(),this.fetchedCourse$=this._courseId$.pipe((0,v.n)(c=>this.loadingService.load(this.coursesRestService.getExpandedCourse(c))),(0,C.t)(1)),this.course$=(0,at.h)(this.action$,this.fetchedCourse$.pipe((0,J.p)(H.TM),(0,p.T)(c=>({type:"reset",payload:c})))).pipe((0,Kt.S)(de,null),(0,J.p)(H.TM),(0,C.t)(1)),this.tests$=this.course$.pipe((0,p.T)(c=>c.Tests||[]),(0,p.T)(k.my)),this.hasTests$=this.tests$.pipe((0,p.T)(c=>c.length>0)),this.filterSubject$=new y.t(ut),this.filter$=this.filterSubject$.asObservable(),this.expandedHeader$=new y.t(!1),this.filteredTests$=(0,R.z)([this.tests$,this.filter$]).pipe((0,p.T)(([c,h])=>c.filter(_=>(!h.onlyMine||_.IsOwner)&&(!h.hidePublished||!_.IsPublished)))),this.sorting$=this.sortService.sorting$,this.studentGrades$=(0,R.z)([this.course$,this.filteredTests$,this.sorting$]).pipe((0,p.T)((0,A.i)(this.toStudentGrades.bind(this)))),this.canSetFinalGrade$=this.course$.pipe((0,p.T)(kt)),this.gradingScaleIds$=this.course$.pipe((0,p.T)(c=>(0,Jt.A)([...(c.Tests??[]).map(h=>h.GradingScaleId),c.GradingScaleId]).filter(H.TM)),(0,F.F)(Ht.A),(0,C.t)(1)),this.gradingScales$=this.gradingScaleIds$.pipe((0,v.n)(c=>this.gradingScalesRestService.getGradingScales(c)),(0,C.t)(1)),this.UNDEFINED_GRADINGSCALE_ID=-1,this.gradingScalesOptions$=this.gradingScales$.pipe((0,p.T)(c=>c.map(h=>({id:h?.Id||this.UNDEFINED_GRADINGSCALE_ID,options:h?.Grades.map(U=>({Key:U.Id,Value:U.Designation}))||[]})).reduce((h,_)=>({...h,[_.id]:_.options}),{})),(0,C.t)(1)),this.meanOfStudentGradesForCourse$=this.studentGrades$.pipe((0,p.T)(c=>function ae(n){const a=n.map(e=>e.average).filter(e=>null!=e&&0!==e).map(Number);return(0,rt.G)(a)}(ot(c)))),this.meanOfFinalGradesForCourse$=(0,R.z)([this.gradingScalesOptions$,this.studentGrades$]).pipe((0,v.n)((0,A.i)(this.meanOfOverwrittenGradesForCourse.bind(this))))}setCourseId(e){this._courseId$.next(e)}setFilter(e){this.filterSubject$.next(e)}gradingOptionsForTest$(e){return this.gradingOptions$(e.GradingScaleId)}gradingOptionsForCourse$(){return this.course$.pipe((0,v.n)(e=>this.gradingOptions$(e.GradingScaleId)))}toStudentGrades(e,s=[],i){return function Zt(n,a,e,s){return n?.map(i=>({student:i,finalGrade:te(i,e,s),grades:qt(i,a)}))}(e.ParticipatingStudents??[],s,e.Gradings??[],e.FinalGrades??[]).sort((({key:n,ascending:a})=>(e,s)=>{const i=a?1:-1;switch(n){case"FullName":return i*e.student.FullName.localeCompare(s.student.FullName);case"FinalGrade":return e.finalGrade?.finalGradeId&&s.finalGrade?.finalGradeId?i*dt(e.finalGrade.finalGradeId,s.finalGrade.finalGradeId):-1*i;case"TestsMean":return e.finalGrade?.average&&s.finalGrade?.average?i*dt(e.finalGrade.average,s.finalGrade.average):-1*i}return i*((n,a,e)=>{const s=a.grades.filter(lt).find(r=>r.test.Id===n.Id),i=e.grades.filter(lt).find(r=>r.test.Id===n.Id);return n.IsPointGrading&&s?.result.GradeId===i?.result.GradeId?(s?.result.Points??0)-(i?.result.Points??0):-1*((s?.result.GradeId??Number.POSITIVE_INFINITY)-(i?.result.GradeId??Number.POSITIVE_INFINITY))})(n,e,s)})(i))}setSorting(e){this.sortService.setSorting(e)}getSortingChar$(e){return this.sortService.getSortingChar$(e)}sortBy(e){this.sortService.toggleSorting(e)}toggleHeader(e){this.expandedHeader$.next(e)}optimisticallyUpdateGrade(e){return this.course$.pipe((0,M.s)(1),(0,p.T)(s=>{const{originalResult:i,updatedResult:r}=this.buildOptimisticResultUpdate(s,e);return this.updateTestResult(r,null),i}))}saveGrade(e,s){this.course$.pipe((0,M.s)(1),(0,v.n)(i=>this.coursesRestService.updateTestResult(i.Id,e).pipe((0,zt.W)(r=>(s&&this.updateTestResult({...s},null),(0,Wt.$)(()=>r)))))).subscribe(({testResult:i,grading:r})=>this.updateOrDeleteTestResult(e.testId,e.studentId,i,r,"gradeId"in e?"grade":"points"))}publish(e){this.coursesRestService.publishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}unpublish(e){this.coursesRestService.unpublishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}deleteTest(e){this.action$.next({type:"delete-test",payload:e})}overwriteFinalGrade({id:e,selectedGradeId:s}){this.gradingsRestService.updateGrade(e,s).subscribe(()=>{this.action$.next({type:"final-grade-overwritten",payload:{id:e,selectedGradeId:s}})})}setAveragesAsFinalGrades(e){this.coursesRestService.setAverageAsFinalGrade(e).subscribe(s=>this.action$.next({type:"replace-grades",payload:s.Gradings}))}buildOptimisticResultUpdate(e,s){const i=(0,k.tb)(e,s.testId,s.studentId),r=i?{...i}:{Id:"",TestId:s.testId,StudentId:s.studentId,CourseRegistrationId:0,GradeId:null,GradeValue:null,GradeDesignation:null,Points:null};return r.GradeId="gradeId"in s?s.gradeId:i?.GradeId??null,r.Points="points"in s?s.points:i?.Points??null,{originalResult:i,updatedResult:r}}updateOrDeleteTestResult(e,s,i,r,d){i?this.updateTestResult(i,r,d):this.deleteTestResult(e,s,r)}updateTestResult(e,s,i){this.action$.next({type:"updateResult",payload:{testResult:e,grading:s??null,ignore:i}})}deleteTestResult(e,s,i){this.action$.next({type:"deleteResult",payload:{testId:e,studentId:s,grading:i}})}toggleTestPublishedState(e){this.action$.next({type:"toggle-test-state",payload:e})}gradingOptions$(e){return null===e?(0,G.of)(null):this.gradingScalesOptions$.pipe((0,p.T)(s=>s[e]),(0,C.t)(1))}meanOfOverwrittenGradesForCourse(e,s){return this.course$.pipe((0,p.T)(i=>{if(null===i.GradingScaleId||void 0===e[i.GradingScaleId])return null;const r=e[i.GradingScaleId];return function re(n,a){const e=n.map(i=>i.freeHandGrade).filter(i=>!!i),s=n.map(i=>i.finalGradeId).filter(i=>null!==i).map(i=>a.find(r=>r.Key===i)).filter(i=>void 0!==i).map(i=>i?.Value).filter(i=>void 0!==i).map(Number).filter(i=>!isNaN(i));return(0,rt.G)([...s,...e])}(ot(s),r)}))}static#t=this.\u0275fac=function(s){return new(s||n)(t.KVO(V.I),t.KVO(le.T),t.KVO(ge),t.KVO(et.U),t.KVO(he.a))};static#e=this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac})}return n})();const me=n=>({formGroup:n}),fe=n=>["/events",n,"tests"];function _e(n,a){if(1&n&&(t.j41(0,"div",31),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=a.$implicit;t.R7$(),t.SpI(" ",t.i5U(2,1,"global.validation-errors."+e.error,e.params)," ")}}function be(n,a){if(1&n&&(t.j41(0,"div",31),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=a.$implicit;t.R7$(),t.SpI(" ",t.i5U(2,1,"global.validation-errors."+e.error,e.params)," ")}}function ve(n,a){if(1&n&&(t.j41(0,"div",31),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=a.$implicit;t.R7$(),t.SpI(" ",t.i5U(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Te(n,a){if(1&n&&(t.j41(0,"div",31),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=a.$implicit;t.R7$(),t.SpI(" ",t.i5U(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Ie(n,a){if(1&n&&(t.j41(0,"div",31),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=a.$implicit;t.R7$(),t.SpI(" ",t.i5U(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Ce(n,a){if(1&n&&(t.qex(0),t.j41(1,"div",32)(2,"div",33)(3,"div",17)(4,"label",34),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.j41(7,"div",35),t.nrm(8,"input",36),t.nI1(9,"async"),t.DNE(10,Te,3,4,"div",8),t.nI1(11,"async"),t.k0s()()(),t.j41(12,"div",33)(13,"div",17)(14,"label",37),t.EFF(15),t.nI1(16,"translate"),t.k0s(),t.j41(17,"div",35),t.nrm(18,"input",38),t.nI1(19,"async"),t.DNE(20,Ie,3,4,"div",8),t.nI1(21,"async"),t.k0s()()()(),t.j41(22,"div",39),t.By9(),t.j41(23,"math")(24,"mi"),t.EFF(25),t.nI1(26,"translate"),t.k0s(),t.j41(27,"mo"),t.EFF(28,"="),t.k0s(),t.j41(29,"mfrac")(30,"mrow")(31,"mi"),t.EFF(32),t.nI1(33,"translate"),t.k0s(),t.j41(34,"mo"),t.EFF(35,"\xd7"),t.k0s(),t.j41(36,"mn"),t.EFF(37,"5"),t.k0s()(),t.j41(38,"mi"),t.EFF(39),t.nI1(40,"translate"),t.k0s()(),t.j41(41,"mo"),t.EFF(42,"+"),t.k0s(),t.j41(43,"mn"),t.EFF(44,"1"),t.k0s()()(),t.bVm()),2&n){let e,s;const i=t.XpG(3);t.R7$(5),t.JRh(t.bMT(6,11,"tests.form.max-points")),t.R7$(3),t.AVh("is-invalid",(null==(e=t.bMT(9,13,i.maxPointsErrors$))?null:e.length)||!1),t.R7$(2),t.Y8G("ngForOf",t.bMT(11,15,i.maxPointsErrors$)),t.R7$(5),t.JRh(t.bMT(16,17,"tests.form.max-points-adjusted")),t.R7$(3),t.AVh("is-invalid",(null==(s=t.bMT(19,19,i.maxPointsAdjustedErrors$))?null:s.length)||!1),t.R7$(2),t.Y8G("ngForOf",t.bMT(21,21,i.maxPointsAdjustedErrors$)),t.R7$(5),t.SpI(" ",t.bMT(26,23,"tests.form.math.grade")," "),t.R7$(7),t.SpI(" ",t.bMT(33,25,"tests.form.math.points")," "),t.R7$(7),t.JRh(t.bMT(40,27,"tests.form.math.max-points"))}}function $e(n,a){1&n&&(t.j41(0,"div",40)(1,"span",41),t.EFF(2,"Loading..."),t.k0s()())}function Ge(n,a){if(1&n){const e=t.RV6();t.j41(0,"form",3),t.bIt("ngSubmit",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.onSubmit())}),t.j41(1,"div",4)(2,"div",5)(3,"label",6),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.nrm(6,"input",7),t.nI1(7,"async"),t.nI1(8,"translate"),t.DNE(9,_e,3,4,"div",8),t.nI1(10,"async"),t.k0s(),t.j41(11,"div",9)(12,"label",10),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.j41(15,"div",11)(16,"span",12)(17,"i",13),t.EFF(18,"calendar_today"),t.k0s()(),t.j41(19,"input",14,0),t.nI1(21,"async"),t.nI1(22,"translate"),t.bIt("click",function(){t.eBV(e);const i=t.sdS(20);return t.Njj(i.toggle())}),t.k0s(),t.DNE(23,be,3,4,"div",8),t.nI1(24,"async"),t.k0s()()(),t.j41(25,"div",15)(26,"label",16),t.EFF(27),t.nI1(28,"translate"),t.k0s(),t.j41(29,"div",5)(30,"div",17)(31,"label",18),t.EFF(32),t.nI1(33,"translate"),t.k0s(),t.j41(34,"div",19),t.nrm(35,"input",20),t.nI1(36,"async"),t.DNE(37,ve,3,4,"div",8),t.nI1(38,"async"),t.k0s()()()(),t.j41(39,"div")(40,"label",16),t.EFF(41),t.nI1(42,"translate"),t.k0s(),t.j41(43,"div",21),t.nrm(44,"input",22),t.j41(45,"label",23),t.EFF(46),t.nI1(47,"translate"),t.k0s()(),t.j41(48,"div",21),t.nrm(49,"input",24),t.j41(50,"label",25),t.EFF(51),t.nI1(52,"translate"),t.k0s()(),t.DNE(53,Ce,45,29,"ng-container",26),t.k0s(),t.j41(54,"div",27)(55,"button",28),t.nI1(56,"async"),t.EFF(57),t.nI1(58,"translate"),t.k0s(),t.j41(59,"button",29),t.EFF(60),t.nI1(61,"translate"),t.DNE(62,$e,3,0,"div",30),t.k0s()()()}if(2&n){let e,s,i;const r=t.XpG().bkdLet,d=t.XpG();t.Y8G("formGroup",r.formGroup),t.R7$(4),t.JRh(t.bMT(5,29,"tests.form.designation")),t.R7$(2),t.AVh("is-invalid",(null==(e=t.bMT(7,31,d.designationErrors$))?null:e.length)||!1),t.Y8G("placeholder",t.bMT(8,33,"tests.form.designation-placeholder")),t.R7$(3),t.Y8G("ngForOf",t.bMT(10,35,d.designationErrors$)),t.R7$(4),t.JRh(t.bMT(14,37,"tests.form.date")),t.R7$(3),t.Y8G("id",d.componentId),t.R7$(3),t.AVh("is-invalid",(null==(s=t.bMT(21,39,d.dateErrors$))?null:s.length)||!1),t.Y8G("placeholder",t.bMT(22,41,"shared.date-select.default-placeholder")),t.R7$(4),t.Y8G("ngForOf",t.bMT(24,43,d.dateErrors$)),t.R7$(4),t.JRh(t.bMT(28,45,"tests.form.weight")),t.R7$(5),t.JRh(t.bMT(33,47,"tests.form.factor")),t.R7$(3),t.AVh("is-invalid",(null==(i=t.bMT(36,49,d.weightErrors$))?null:i.length)||!1),t.R7$(2),t.Y8G("ngForOf",t.bMT(38,51,d.weightErrors$)),t.R7$(4),t.JRh(t.bMT(42,53,"tests.form.grading-type")),t.R7$(3),t.Y8G("value",!1),t.R7$(2),t.JRh(t.bMT(47,55,"tests.form.grades")),t.R7$(3),t.Y8G("value",!0),t.R7$(2),t.JRh(t.bMT(52,57,"tests.form.points")),t.R7$(2),t.Y8G("ngIf",r.formGroup.get("isPointGrading").value),t.R7$(2),t.Y8G("disabled",d.saving)("routerLink",t.eq3(65,fe,t.bMT(56,59,d.courseId$))),t.R7$(2),t.SpI(" ",t.bMT(58,61,"tests.form.cancel")," "),t.R7$(2),t.Y8G("disabled",d.saving),t.R7$(),t.SpI(" ",t.bMT(61,63,"tests.form.save")," "),t.R7$(2),t.Y8G("ngIf",d.saving)}}function ye(n,a){if(1&n&&(t.qex(0),t.DNE(1,Ge,63,67,"form",2),t.bVm()),2&n){const e=a.bkdLet;t.R7$(),t.Y8G("ngIf",e.formGroup)}}let pt=(()=>{class n{constructor(e,s,i){this.fb=e,this.translate=s,this.testStateService=i,this.test=null,this.saving=!1,this.save=new t.bkB,this.componentId=(0,Xt.A)("bkd-tests-edit-form"),this.formGroup=this.createFormGroup(),this.submitted$=new y.t(!1),this.destroy$=new D.B,this.designationErrors$=(0,N.v)((0,G.of)(this.formGroup),this.submitted$,"designation"),this.dateErrors$=(0,N.v)((0,G.of)(this.formGroup),this.submitted$,"date"),this.maxPointsErrors$=(0,N.v)((0,G.of)(this.formGroup),this.submitted$,"maxPoints"),this.maxPointsAdjustedErrors$=(0,N.v)((0,G.of)(this.formGroup),this.submitted$,"maxPointsAdjusted"),this.weightErrors$=(0,N.v)((0,G.of)(this.formGroup),this.submitted$,"weight"),this.courseId$=this.testStateService.courseId$}ngOnInit(){this.test&&this.setInitialValues(this.test),(0,N.IK)((0,G.of)(this.formGroup),"isPointGrading").pipe((0,B.Q)(this.destroy$)).subscribe(this.togglePointFieldsDisability.bind(this))}ngOnDestroy(){this.destroy$.next()}onSubmit(){this.submitted$.next(!0),this.formGroup.valid&&this.save.emit(this.formGroup.value)}createFormGroup(){return this.fb.group({designation:["",g.k0.required],date:[null,g.k0.required],weight:[1,g.k0.compose([g.k0.required,Bt(0)])],isPointGrading:[!1],maxPoints:[{value:null,disabled:!0},g.k0.required],maxPointsAdjusted:[{value:null,disabled:!0},null]})}setInitialValues(e){this.formGroup.patchValue({designation:e.Designation,date:e.Date,weight:e.Weight,isPointGrading:e.IsPointGrading,maxPoints:e.MaxPoints,maxPointsAdjusted:e.MaxPointsAdjusted}),e.Results&&e.Results.length>0&&(this.formGroup.get("isPointGrading")?.disable(),this.formGroup.get("maxPoints")?.disable(),this.formGroup.get("maxPointsAdjusted")?.disable()),this.togglePointFieldsDisability()}togglePointFieldsDisability(){const e=this.formGroup.get("maxPoints"),s=this.formGroup.get("maxPointsAdjusted");this.formGroup.get("isPointGrading")?.value?(e?.enable(),s?.enable()):(e?.reset({value:this.test?.MaxPoints,disabled:!0}),s?.reset({value:this.test?.MaxPointsAdjusted,disabled:!0}))}static#t=this.\u0275fac=function(s){return new(s||n)(t.rXU(g.ze),t.rXU(l.c$),t.rXU(x))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-tests-edit-form"]],inputs:{test:"test",saving:"saving"},outputs:{save:"save"},standalone:!0,features:[t.Jv_([{provide:O.dn,useClass:O.Ae},{provide:O.tN,useClass:Yt.m}]),t.aNF],decls:1,vars:3,consts:[["dp","ngbDatepicker"],[4,"bkdLet"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"row","g-3","mb-3"],[1,"col-md-6"],["for","designation",1,"form-label"],["id","designation","name","designation","type","text","formControlName","designation","required","",1,"form-control",3,"placeholder"],["class","invalid-feedback",4,"ngFor","ngForOf"],[1,"col-md-6","mb-3"],["for","date",1,"form-label"],[1,"input-group"],[1,"input-group-text",3,"id"],[1,"material-icons"],["id","date","name","date","type","text","ngbDatepicker","","formControlName","date","required","",1,"form-control",3,"click","placeholder"],[1,"row","mb-3"],[1,"form-label"],[1,"row"],["for","factor",1,"form-label","col-3","col-sm-2"],[1,"col-9","col-sm-10"],["id","factor","name","factor","type","number","formControlName","weight","step","0.05","min","0","required","",1,"form-control"],[1,"form-check"],["type","radio","formControlName","isPointGrading","id","type-grades",1,"form-check-input",3,"value"],["for","type-grades",1,"form-check-label"],["type","radio","formControlName","isPointGrading","id","type-points",1,"form-check-input",3,"value"],["for","type-points",1,"form-check-label"],[4,"ngIf"],[1,"d-flex","justify-content-end","mt-4"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","routerLink"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"invalid-feedback"],[1,"row","ms-4","mb-3","g-3"],[1,"col-sm-6","col-md-4"],["for","max-points",1,"ms-2","col-4","col-form-label"],[1,"col-6"],["type","number","name","maxPoints","id","max-points","formControlName","maxPoints","step","0.01","min","0","max","999","required","",1,"form-control"],["for","max-points-adjusted",1,"ms-2","col-4","col-form-label"],["type","number","name","maxPointsAdjusted","id","max-points-adjusted","formControlName","maxPointsAdjusted","step","0.01","min","0","max","999",1,"form-control"],[1,"ms-4","ps-3","py-3"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"visually-hidden"]],template:function(s,i){1&s&&t.DNE(0,ye,2,1,"ng-container",1),2&s&&t.Y8G("bkdLet",t.eq3(1,me,i.formGroup))},dependencies:[T.N,u.bT,g.YN,g.qT,g.me,g.Q0,g.Fm,g.BC,g.cb,g.YS,g.VZ,g.zX,g.X1,g.j4,g.JD,u.pM,O.cw,m.Wk,u.Jj,l.h,l.D9],styles:["#factor[_ngcontent-%COMP%], #max-points[_ngcontent-%COMP%], #max-points-adjusted[_ngcontent-%COMP%]{width:5em}"]})}return n})();var gt=o(5889);const ke=(n,a)=>({courseId:n,saving:a});function Fe(n,a){if(1&n){const e=t.RV6();t.j41(0,"div",1)(1,"bkd-tests-edit-form",2),t.bIt("save",function(i){t.eBV(e);const r=t.XpG();return t.Njj(r.save(i))}),t.k0s()()}if(2&n){const e=a.bkdLet;t.R7$(),t.Y8G("saving",e.saving)}}let Ee=(()=>{class n{constructor(e,s,i,r,d){this.route=e,this.courseService=s,this.toastService=i,this.translate=r,this.router=d,this.saving$=new y.t(!1),this.courseId$=this.route.paramMap.pipe((0,p.T)(c=>Number(c.get("id"))),(0,F.F)())}save(e){this.saving$.next(!0);const{designation:s,date:i,weight:r,isPointGrading:d,maxPoints:c,maxPointsAdjusted:h}=e;this.courseId$.pipe((0,v.n)(_=>this.courseService.add(_,i,s,r,d,c,h)),(0,st.j)(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}navigateBack(){this.courseId$.subscribe(e=>this.router.navigate(["events",e,"tests"]))}static#t=this.\u0275fac=function(s){return new(s||n)(t.rXU(m.nX),t.rXU(V.I),t.rXU(gt.f),t.rXU(l.c$),t.rXU(m.Ix))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-tests-add"]],standalone:!0,features:[t.aNF],decls:6,vars:11,consts:[["class","bkd-container bkd-container-limited",4,"bkdLet"],[1,"bkd-container","bkd-container-limited"],[3,"save","saving"]],template:function(s,i){1&s&&(t.j41(0,"h1"),t.EFF(1),t.nI1(2,"translate"),t.k0s(),t.DNE(3,Fe,2,1,"div",0),t.nI1(4,"async"),t.nI1(5,"async")),2&s&&(t.R7$(),t.JRh(t.bMT(2,2,"tests.add-title")),t.R7$(2),t.Y8G("bkdLet",t.l_i(8,ke,t.bMT(4,4,i.courseId$),t.bMT(5,6,i.saving$))))},dependencies:[T.N,pt,u.Jj,l.h,l.D9]})}return n})(),Re=(()=>{class n{constructor(e){this.activeModal=e}get canDeleteTest(){return 0===(this.test?.Results?.filter(s=>null!==s.GradeId||null!==s.GradeValue||null!==s.Points)||[]).length}static#t=this.\u0275fac=function(s){return new(s||n)(t.rXU(O.Lw))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-tests-delete"]],inputs:{test:"test"},standalone:!0,features:[t.aNF],decls:13,vars:10,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click","hidden"],[1,"px-2"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"],[1,"px-3"]],template:function(s,i){1&s&&(t.j41(0,"div",0)(1,"p",1),t.EFF(2),t.nI1(3,"translate"),t.k0s()(),t.j41(4,"div",2)(5,"button",3),t.bIt("click",function(){return i.activeModal.dismiss()}),t.j41(6,"span",4),t.EFF(7),t.nI1(8,"translate"),t.k0s()(),t.j41(9,"button",5),t.bIt("click",function(){return i.activeModal.close(i.canDeleteTest?i.test:null)}),t.j41(10,"span",6),t.EFF(11),t.nI1(12,"translate"),t.k0s()()()),2&s&&(t.R7$(2),t.SpI(" ",t.bMT(3,4,i.canDeleteTest?"tests.form.confirm":"tests.form.delete-not-allowed")," "),t.R7$(3),t.Y8G("hidden",!i.canDeleteTest),t.R7$(2),t.SpI(" ",t.bMT(8,6,"tests.dialog.no")," "),t.R7$(4),t.SpI(" ",t.bMT(12,8,i.canDeleteTest?"tests.dialog.yes":"tests.dialog.ok")," "))},dependencies:[l.h,l.D9]})}return n})();var ht=o(855);const Me=(n,a,e)=>({courseId:n,test:a,saving:e}),xe=n=>({test:n});function Se(n,a){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"div",4)(2,"h1"),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"button",5),t.bIt("click",function(){t.eBV(e);const i=t.XpG().bkdLet,r=t.XpG();return t.Njj(r.openDeleteModal(i.test))}),t.j41(6,"i",6),t.EFF(7,"delete"),t.k0s()()(),t.j41(8,"bkd-tests-edit-form",7),t.bIt("save",function(i){t.eBV(e);const r=t.XpG(2);return t.Njj(r.save(i))}),t.k0s(),t.bVm()}if(2&n){const e=t.XpG().bkdLet;t.R7$(3),t.SpI(" ",t.i5U(4,3,"tests.edit-title",t.eq3(6,xe,e.test.Designation))," "),t.R7$(5),t.Y8G("test",e.test)("saving",e.saving)}}function Pe(n,a){1&n&&t.nrm(0,"bkd-spinner")}function je(n,a){if(1&n&&(t.j41(0,"div",2),t.DNE(1,Se,9,8,"ng-container",3),t.nI1(2,"async"),t.DNE(3,Pe,1,0,"ng-template",null,0,t.C5r),t.k0s()),2&n){const e=t.sdS(4),s=t.XpG();t.R7$(),t.Y8G("ngIf",!1===t.bMT(2,2,s.state.loading$))("ngIfElse",e)}}let Oe=(()=>{class n{constructor(e,s,i,r,d,c,h){this.state=e,this.courseService=s,this.route=i,this.toastService=r,this.translate=d,this.router=c,this.modalService=h,this.saving$=new y.t(!1),this.testId$=this.route.paramMap.pipe((0,p.T)(_=>Number(_.get("testId"))),(0,F.F)()),this.test$=(0,R.z)([this.state.tests$,this.testId$]).pipe((0,p.T)(([_,w])=>_.find(U=>U.Id===w)))}openDeleteModal(e){const s=this.modalService.open(Re);s.componentInstance.test=e,s.result.then(i=>{i&&this.courseService.delete(e.CourseId,e.Id).subscribe(this.onDeleteSuccess.bind(this))},()=>{})}save(e){this.saving$.next(!0);const{designation:s,date:i,weight:r,isPointGrading:d,maxPoints:c,maxPointsAdjusted:h}=e;(0,R.z)([this.state.courseId$,this.testId$]).pipe((0,M.s)(1),(0,v.n)(([_,w])=>this.courseService.update(_,w,s,i,r,d,c,h)),(0,st.j)(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}onDeleteSuccess(e){this.toastService.success(this.translate.instant("tests.form.delete-success")),this.state.deleteTest(e),this.navigateBack()}navigateBack(){this.state.courseId$.pipe((0,M.s)(1)).subscribe(e=>this.router.navigate(["events",e,"tests"]))}static#t=this.\u0275fac=function(s){return new(s||n)(t.rXU(x),t.rXU(V.I),t.rXU(m.nX),t.rXU(gt.f),t.rXU(l.c$),t.rXU(m.Ix),t.rXU(ht.y))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-tests-edit"]],standalone:!0,features:[t.aNF],decls:4,vars:11,consts:[["loading",""],["class","bkd-container bkd-container-limited",4,"bkdLet"],[1,"bkd-container","bkd-container-limited"],[4,"ngIf","ngIfElse"],[1,"d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-primary","btn-icon",3,"click"],[1,"material-icons"],[3,"save","test","saving"]],template:function(s,i){1&s&&(t.DNE(0,je,5,4,"div",1),t.nI1(1,"async"),t.nI1(2,"async"),t.nI1(3,"async")),2&s&&t.Y8G("bkdLet",t.sMw(7,Me,t.bMT(1,1,i.state.courseId$),t.bMT(2,3,i.test$),t.bMT(3,5,i.saving$)))},dependencies:[T.N,u.bT,pt,E.t,u.Jj,l.h,l.D9]})}return n})();var K=o(2619);const De=n=>({designation:n});let Ne=(()=>{class n{constructor(e){this.activeModal=e}static#t=this.\u0275fac=function(s){return new(s||n)(t.rXU(O.Lw))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-publish-test"]],inputs:{test:"test"},standalone:!0,features:[t.aNF],decls:11,vars:12,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"]],template:function(s,i){1&s&&(t.j41(0,"div",0)(1,"p",1),t.EFF(2),t.nI1(3,"translate"),t.k0s()(),t.j41(4,"div",2)(5,"button",3),t.bIt("click",function(){return i.activeModal.dismiss()}),t.EFF(6),t.nI1(7,"translate"),t.k0s(),t.j41(8,"button",4),t.bIt("click",function(){return i.activeModal.close(!0)}),t.EFF(9),t.nI1(10,"translate"),t.k0s()()),2&s&&(t.R7$(2),t.SpI(" ",t.i5U(3,3,i.test.IsPublished?"tests.publishing.unpublish":"tests.publishing.publish",t.eq3(10,De,i.test.Designation))," "),t.R7$(4),t.SpI(" ",t.bMT(7,6,"tests.publishing.cancel")," "),t.R7$(3),t.SpI(" ",t.bMT(10,8,"tests.publishing.confirm")," "))},dependencies:[l.h,l.D9],encapsulation:2})}return n})();var W=o(9082),we=o(274),Ae=o(152);const Ve=n=>({maxPoints:n});function Ue(n,a){if(1&n&&(t.j41(0,"div",8),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.SpI(" ",t.i5U(2,1,"global.validation-errors.invalidPoints",t.eq3(4,Ve,e.maxPoints))," ")}}function Le(n,a){if(1&n){const e=t.RV6();t.j41(0,"div",5)(1,"input",6,0),t.bIt("ngModelChange",function(){t.eBV(e);const i=t.sdS(2),r=t.XpG();return t.Njj(r.onPointsChange(i.value))}),t.k0s(),t.DNE(3,Ue,3,6,"div",7),t.k0s()}if(2&n){const e=t.sdS(2),s=t.XpG();t.R7$(),t.AVh("is-invalid",e.errors),t.FS9("max",s.maxPoints),t.FS9("tabindex",s.tabIndex),t.Y8G("disabled",s.grade.test.IsPublished)("ngModel","grade"===s.grade.kind?s.grade.result.Points:null),t.R7$(2),t.Y8G("ngIf",e.errors)}}let Ye=(()=>{class n{constructor(e){this.state=e,this.maxPoints=0,this.pointsSubject$=new D.B,this.gradeSubject$=new D.B,this.gradingScaleDisabledSubject$=new y.t(!0),this.gradingScaleDisabled$=this.gradingScaleDisabledSubject$.asObservable(),this.destroy$=new D.B}ngOnInit(){this.gradingScaleDisabledSubject$.next(this.disableGradingScale()),this.maxPoints=function ie(n){return(n?.test?.MaxPointsAdjusted||n?.test?.MaxPoints)??0}(this.grade),this.initSave(this.pointsSubject$.pipe((0,J.p)(this.isValid.bind(this)),(0,p.T)(e=>({studentId:this.student.Id,testId:this.grade.test.Id,points:e?Number(e):null})))),this.initSave(this.gradeSubject$.pipe((0,p.T)(e=>({studentId:this.student.Id,testId:this.grade.test.Id,gradeId:e}))))}ngOnChanges(){this.gradingScaleDisabledSubject$.next(this.disableGradingScale())}ngOnDestroy(){this.destroy$.next()}onPointsChange(e){this.pointsSubject$.next(e),this.gradingScaleDisabledSubject$.next(!(null===e||""===e))}onGradeChange(e){this.gradeSubject$.next(e)}isValid(e){return""===e||null===e||!isNaN(Number(e))&&!(Number(e)<0||Number(e)>this.maxPoints)}initSave(e){e.pipe((0,we.H)(s=>this.state.optimisticallyUpdateGrade(s).pipe((0,p.T)(i=>({params:s,originalResult:i})))),(0,Ae.B)(1250),(0,B.Q)(this.destroy$)).subscribe(({params:s,originalResult:i})=>this.state.saveGrade(s,i))}disableGradingScale(){return!!this.grade.test.IsPublished||"no-result"!==this.grade.kind&&null!=this.grade.result.Points&&this.grade.test.IsPointGrading}static#t=this.\u0275fac=function(s){return new(s||n)(t.rXU(x))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-grade"]],inputs:{grade:"grade",student:"student",tabIndex:"tabIndex",gradeOptions:"gradeOptions"},standalone:!0,features:[t.OA$,t.aNF],decls:5,vars:8,consts:[["points","ngModel"],[1,"d-flex","flex-column","w-100"],[1,"d-flex","flex-row"],["class","point-input-container me-2 me-md-3",4,"ngIf"],["data-testid","grade-select",1,"grade-select",3,"valueChange","options","allowEmpty","value","disabled","tabindex"],[1,"point-input-container","me-2","me-md-3"],["type","number","step","0.01","min","0","data-testid","point-input",1,"form-control",3,"ngModelChange","max","disabled","tabindex","ngModel"],["class","invalid-feedback","data-testid","validation-error-message",4,"ngIf"],["data-testid","validation-error-message",1,"invalid-feedback"]],template:function(s,i){1&s&&(t.j41(0,"div",1)(1,"div",2),t.DNE(2,Le,4,7,"div",3),t.j41(3,"bkd-select",4),t.nI1(4,"async"),t.bIt("valueChange",function(d){return i.onGradeChange(d)}),t.k0s()()()),2&s&&(t.R7$(2),t.Y8G("ngIf",i.grade.test.IsPointGrading),t.R7$(),t.Y8G("options",i.gradeOptions)("allowEmpty",!0)("value","grade"===i.grade.kind?i.grade.result.GradeId:null)("disabled",t.bMT(4,6,i.gradingScaleDisabled$))("tabindex",i.tabIndex))},dependencies:[u.bT,g.YN,g.me,g.Q0,g.BC,g.VZ,g.zX,g.vS,K.w,u.Jj,l.h,l.D9],styles:[".point-input-container[_ngcontent-%COMP%]{width:4em}[_nghost-%COMP%]     select{min-width:13ch}@media (min-width: 576px){.point-input-container[_ngcontent-%COMP%]{width:5em}}"]})}return n})();function Be(n,a){if(1&n&&(t.j41(0,"span",3),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.JRh(e.calculatePointsAverage(e.test))}}let Je=(()=>{class n{constructor(e){this.locale=e}calculatePointsAverage(e){return this.safeAverage(e,2,k.zs)}calculateGradeAverage(e){return this.safeAverage(e,3,k.TG)}safeAverage(e,s,i){try{return(0,W.yk)(i(e),this.locale,s)}catch{return W.jr}}static#t=this.\u0275fac=function(s){return new(s||n)(t.rXU(t.xe9))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-average-grades"]],inputs:{test:"test"},standalone:!0,features:[t.aNF],decls:4,vars:2,consts:[[1,"d-flex","flex-row","w-100"],["class","mr-2 mr-md-3 average-points","data-testid","average-points",4,"ngIf"],["data-testid","average-grade"],["data-testid","average-points",1,"mr-2","mr-md-3","average-points"]],template:function(s,i){1&s&&(t.j41(0,"div",0),t.DNE(1,Be,2,1,"span",1),t.j41(2,"span",2),t.EFF(3),t.k0s()()),2&s&&(t.R7$(),t.Y8G("ngIf",i.test.IsPointGrading),t.R7$(2),t.JRh(i.calculateGradeAverage(i.test)))},dependencies:[u.bT],styles:[".average-points[_ngcontent-%COMP%]{min-width:4.5em}@media (min-width: 576px){.average-points[_ngcontent-%COMP%]{min-width:6em}}"]})}return n})(),He=(()=>{class n{constructor(){this.disabled=!1,this.gradeIdSelected=new t.bkB}onGradeChange(e){void 0!==this.gradeId?.valueOf()&&this.gradeIdSelected.emit({id:this.gradeId?.valueOf(),selectedGradeId:e})}static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-grade-select"]],inputs:{options:"options",valueId:"valueId",gradeId:"gradeId",disabled:"disabled"},outputs:{gradeIdSelected:"gradeIdSelected"},standalone:!0,features:[t.aNF],decls:1,vars:4,consts:[["data-testid","grade-select",3,"valueChange","options","allowEmpty","value","disabled"]],template:function(s,i){1&s&&(t.j41(0,"bkd-select",0),t.bIt("valueChange",function(d){return i.onGradeChange(d)}),t.k0s()),2&s&&t.Y8G("options",i.options)("allowEmpty",!0)("value",i.valueId)("disabled",i.disabled)},dependencies:[K.w],styles:["[_nghost-%COMP%]     select{min-width:13ch}"]})}return n})();const mt=(n,a)=>({"btn-primary":n,"btn-outline-secondary":a});let Ke=(()=>{class n{constructor(){this.filter=ut,this.filterChange=new t.bkB}showOnlyMine(){this.filterChange.next({...this.filter,onlyMine:!0})}showAll(){this.filterChange.next({...this.filter,onlyMine:!1})}onHidePublishedChange(e){const s=(e.target&&e.target instanceof HTMLInputElement&&e.target?.checked)??!1;this.filterChange.next({...this.filter,hidePublished:s})}static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-test-table-filter"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},standalone:!0,features:[t.aNF],decls:13,vars:18,consts:[[1,"only-mine-buttons"],["type","button",1,"btn","desktop",3,"click","ngClass"],["type","button",1,"btn","ms-2","desktop",3,"click","ngClass"],[1,"hide-published"],[1,"form-check"],["id","hide-published","type","checkbox",1,"form-check-input",3,"change","checked"],["for","hide-published",1,"form-check-label"]],template:function(s,i){1&s&&(t.j41(0,"div",0)(1,"button",1),t.bIt("click",function(){return i.showAll()}),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"button",2),t.bIt("click",function(){return i.showOnlyMine()}),t.EFF(5),t.nI1(6,"translate"),t.k0s()(),t.j41(7,"div",3)(8,"div",4)(9,"input",5),t.bIt("change",function(d){return i.onHidePublishedChange(d)}),t.k0s(),t.j41(10,"label",6),t.EFF(11),t.nI1(12,"translate"),t.k0s()()()),2&s&&(t.R7$(),t.Y8G("ngClass",t.l_i(12,mt,!i.filter.onlyMine,i.filter.onlyMine)),t.R7$(),t.SpI(" ",t.bMT(3,6,"tests.all-tests")," "),t.R7$(2),t.Y8G("ngClass",t.l_i(15,mt,i.filter.onlyMine,!i.filter.onlyMine)),t.R7$(),t.SpI(" ",t.bMT(6,8,"tests.owned-tests")," "),t.R7$(4),t.Y8G("checked",i.filter.hidePublished),t.R7$(2),t.SpI(" ",t.bMT(12,10,"tests.hide-published")," "))},dependencies:[u.YU,g.YN,l.h,l.D9],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:100%}.only-mine-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;height:3.625rem}.hide-published[_ngcontent-%COMP%]{display:flex;align-items:center;height:2.375rem;margin-bottom:1rem}.hide-published[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:300}.hide-published[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]{margin-bottom:0}"]})}return n})();var We=o(853);const ze=["*"];let Qe=(()=>{class n{static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-preserve-line-height"]],standalone:!0,features:[t.aNF],ngContentSelectors:ze,decls:3,vars:0,template:function(s,i){1&s&&(t.NAR(),t.j41(0,"div"),t.SdG(1),t.EFF(2,"\xa0"),t.k0s())},encapsulation:2})}return n})(),Ze=(()=>{class n{constructor(e){this.translate=e}transform(e){return`${e.Weight} (${e.WeightPercent}%)${this.getPoints(e)}`}getPoints(e){return e.IsPointGrading?`, ${e.MaxPointsAdjusted??e.MaxPoints} ${this.translate.instant("tests.summary.points")}`:""}static#t=this.\u0275fac=function(s){return new(s||n)(t.rXU(l.c$,16))};static#e=this.\u0275pipe=t.EJ8({name:"testSummaryShort",type:n,pure:!0,standalone:!0})}return n})();const qe=n=>[n,"edit"];function tn(n,a){1&n&&(t.j41(0,"i",12),t.EFF(1,"edit"),t.k0s())}function en(n,a){if(1&n&&(t.j41(0,"div",8)(1,"div",9)(2,"bkd-preserve-line-height"),t.EFF(3),t.nI1(4,"date"),t.k0s(),t.j41(5,"a",10),t.DNE(6,tn,2,0,"i",11),t.k0s()(),t.j41(7,"bkd-preserve-line-height"),t.EFF(8),t.nI1(9,"testSummaryShort"),t.k0s(),t.j41(10,"bkd-preserve-line-height"),t.EFF(11),t.k0s()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.i5U(4,5,e.test.Date,"dd.MM.yyyy")),t.R7$(2),t.Y8G("routerLink",t.eq3(10,qe,e.test.Id)),t.R7$(),t.Y8G("ngIf",e.test.IsOwner&&!1===e.test.IsPublished),t.R7$(2),t.SpI(" ",t.bMT(9,8,e.test)," "),t.R7$(3),t.JRh(e.test.Owner)}}function nn(n,a){if(1&n){const e=t.RV6();t.j41(0,"div",13)(1,"a",14),t.nI1(2,"translate"),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.unpublishTest())}),t.j41(3,"i",15),t.EFF(4,"lock"),t.k0s(),t.j41(5,"span"),t.EFF(6),t.nI1(7,"translate"),t.k0s()(),t.j41(8,"bkd-caret",16),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.toggleHeader())}),t.k0s()()}if(2&n){const e=t.XpG();t.R7$(),t.FS9("title",t.bMT(2,3,"tests.edit")),t.R7$(5),t.JRh(t.bMT(7,5,"tests.published")),t.R7$(2),t.Y8G("expanded",e.expanded)}}function sn(n,a){if(1&n){const e=t.RV6();t.j41(0,"div",13)(1,"a",17),t.nI1(2,"translate"),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.publishTest())}),t.j41(3,"i",15),t.EFF(4,"lock_open"),t.k0s(),t.j41(5,"span"),t.EFF(6),t.nI1(7,"translate"),t.k0s()(),t.j41(8,"bkd-caret",16),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.toggleHeader())}),t.k0s()()}if(2&n){const e=t.XpG();t.R7$(),t.FS9("title",t.bMT(2,3,"tests.publish")),t.R7$(5),t.JRh(t.bMT(7,5,"tests.not-published")),t.R7$(2),t.Y8G("expanded",e.expanded)}}let an=(()=>{class n{constructor(){this.toggle=new t.bkB,this.publish=new t.bkB,this.unpublish=new t.bkB}toggleHeader(){this.toggle.emit(!this.expanded)}publishTest(){this.publish.emit(this.test)}unpublishTest(){this.unpublish.emit(this.test)}static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-test-table-header"]],inputs:{test:"test",expanded:"expanded"},outputs:{toggle:"toggle",publish:"publish",unpublish:"unpublish"},standalone:!0,features:[t.aNF],decls:10,vars:6,consts:[["notPublished",""],[1,"d-flex","flex-column","h-100","justify-content-between"],["role","button",1,"test-designation","d-flex","flex-row","my-3","align-items-end","justify-content-between",3,"click"],[3,"ngClass"],[1,"align-self-start",3,"expanded"],[1,"d-flex","flex-column"],["class","d-flex flex-column mb-3",4,"ngIf"],["class","d-flex align-items-center justify-content-between test-status",4,"ngIf","ngIfElse"],[1,"d-flex","flex-column","mb-3"],[1,"d-flex","flex-row","justify-content-between"],[1,"btn","btn-link","p-0","edit",3,"routerLink"],["class","material-icons",4,"ngIf"],[1,"material-icons"],[1,"d-flex","align-items-center","justify-content-between","test-status"],[1,"d-flex","btn","btn-link","ps-0","edit",3,"click","title"],[1,"material-icons","me-1"],[1,"expand-mobile",3,"click","expanded"],[1,"d-flex","btn","btn-link","ps-0",3,"click","title"]],template:function(s,i){if(1&s){const r=t.RV6();t.j41(0,"div",1)(1,"div",2),t.bIt("click",function(){return t.eBV(r),t.Njj(i.toggleHeader())}),t.j41(2,"div",3),t.EFF(3),t.k0s(),t.nrm(4,"bkd-caret",4),t.k0s(),t.j41(5,"div",5),t.DNE(6,en,12,12,"div",6)(7,nn,9,7,"div",7)(8,sn,9,7,"ng-template",null,0,t.C5r),t.k0s()()}if(2&s){const r=t.sdS(9);t.R7$(2),t.Y8G("ngClass",i.expanded?"expanded":"collapsed"),t.R7$(),t.SpI(" ",i.test.Designation," "),t.R7$(),t.Y8G("expanded",i.expanded),t.R7$(2),t.Y8G("ngIf",i.expanded),t.R7$(),t.Y8G("ngIf",i.test.IsPublished)("ngIfElse",r)}},dependencies:[u.YU,We.h,u.bT,Qe,m.Wk,u.vh,l.h,l.D9,Ze],styles:["[_nghost-%COMP%]{font-weight:300}.collapsed[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.test-designation[_ngcontent-%COMP%]{display:none!important}.test-status[_ngcontent-%COMP%]{order:-1;padding-bottom:1rem}.test-status[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.test-status[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#000}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.edit[_ngcontent-%COMP%]{color:#00000080;text-decoration:none}@media (min-width: 750px){.test-designation[_ngcontent-%COMP%]{display:inherit!important}.test-status[_ngcontent-%COMP%]{order:initial}.expand-mobile[_ngcontent-%COMP%]{display:none!important}}"]})}return n})();const rn=(n,a,e,s,i)=>({tests:n,hasTests:a,studentGrades:e,filter:s,expanded:i}),z=n=>({selected:n}),on=n=>["student",n,"grades"],dn=n=>({"visible-on-mobile":n});function ln(n,a){if(1&n){const e=t.RV6();t.j41(0,"th",24)(1,"bkd-test-table-header",25),t.bIt("toggle",function(i){t.eBV(e);const r=t.XpG(2);return t.Njj(r.state.toggleHeader(i))})("publish",function(i){t.eBV(e);const r=t.XpG(2);return t.Njj(r.publish(i))})("unpublish",function(i){t.eBV(e);const r=t.XpG(2);return t.Njj(r.unpublish(i))}),t.k0s()()}if(2&n){const e=a.$implicit,s=t.XpG().bkdLet,i=t.XpG();t.Y8G("ngClass",e.Id===(null==i.selectedTest?null:i.selectedTest.Id)?"selected":""),t.R7$(),t.Y8G("test",e)("expanded",s.expanded)}}function cn(n,a){if(1&n){const e=t.RV6();t.j41(0,"th",26)(1,"bkd-test-table-header",25),t.bIt("toggle",function(i){t.eBV(e);const r=t.XpG(2);return t.Njj(r.state.toggleHeader(i))})("publish",function(i){t.eBV(e);const r=t.XpG(2);return t.Njj(r.publish(i))})("unpublish",function(i){t.eBV(e);const r=t.XpG(2);return t.Njj(r.unpublish(i))}),t.k0s()()}if(2&n){const e=a.$implicit,s=t.XpG().bkdLet,i=t.XpG();t.Y8G("ngClass",e.Id===(null==i.selectedTest?null:i.selectedTest.Id)?"selected":""),t.R7$(),t.Y8G("test",e)("expanded",s.expanded)}}function un(n,a){if(1&n){const e=t.RV6();t.j41(0,"div",30)(1,"span",29),t.bIt("click",function(){t.eBV(e);const i=t.XpG().$implicit,r=t.XpG(2);return t.Njj(r.state.sortBy(i))}),t.EFF(2),t.nI1(3,"translate"),t.k0s()()}2&n&&(t.R7$(2),t.SpI("",t.bMT(3,1,"tests.points")," "))}function pn(n,a){if(1&n){const e=t.RV6();t.j41(0,"th",27)(1,"div",10),t.DNE(2,un,4,3,"div",28),t.j41(3,"div",11)(4,"span",29),t.bIt("click",function(){const i=t.eBV(e).$implicit,r=t.XpG(2);return t.Njj(r.state.sortBy(i))}),t.EFF(5),t.nI1(6,"translate"),t.k0s()(),t.j41(7,"div",12),t.EFF(8),t.nI1(9,"async"),t.k0s()()()}if(2&n){const e=a.$implicit,s=t.XpG(2);t.Y8G("ngClass",e.Id===(null==s.selectedTest?null:s.selectedTest.Id)?"selected":""),t.R7$(2),t.Y8G("ngIf",e.IsPointGrading),t.R7$(3),t.JRh(t.bMT(6,4,"tests.grade")),t.R7$(3),t.SpI(" ",t.bMT(9,6,s.state.getSortingChar$(e))," ")}}function gn(n,a){if(1&n){const e=t.RV6();t.j41(0,"bkd-grade-select",38),t.nI1(1,"async"),t.nI1(2,"async"),t.bIt("gradeIdSelected",function(i){t.eBV(e);const r=t.XpG(3);return t.Njj(r.state.overwriteFinalGrade(i))}),t.k0s()}if(2&n){const e=t.XpG().$implicit,s=t.XpG(2);t.Y8G("options",t.bMT(1,4,s.state.gradingOptionsForCourse$()))("valueId",e.finalGrade.finalGradeId)("gradeId",e.finalGrade.id)("disabled",!1===t.bMT(2,6,s.isEditFinalGradesAllowed(e)))}}function hn(n,a){if(1&n&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&n){const e=t.XpG().$implicit;t.R7$(),t.SpI(" ",e.finalGrade.freeHandGrade," ")}}function mn(n,a){if(1&n&&(t.j41(0,"td",39),t.nrm(1,"bkd-grade",40),t.nI1(2,"async"),t.k0s()),2&n){const e=a.$implicit,s=a.index,i=t.XpG(),r=i.$implicit,d=i.index,c=t.XpG(2);t.Y8G("ngClass",void 0!==c.selectedTest&&e.test.Id===c.selectedTest.Id?"selected":""),t.R7$(),t.Y8G("grade",e)("gradeOptions",t.bMT(2,5,c.state.gradingOptionsForTest$(e.test)))("student",r.student)("tabIndex",1e3*(1+s)+d)}}function fn(n,a){if(1&n&&(t.j41(0,"tr")(1,"td",31)(2,"a",32)(3,"span"),t.EFF(4),t.k0s(),t.j41(5,"span",19),t.EFF(6),t.nI1(7,"translate"),t.nI1(8,"decimalOrDash"),t.k0s()()(),t.j41(9,"td",33),t.DNE(10,gn,3,8,"bkd-grade-select",34)(11,hn,2,1,"div",35),t.k0s(),t.j41(12,"td",36),t.EFF(13),t.nI1(14,"decimalOrDash"),t.k0s(),t.DNE(15,mn,3,7,"td",37),t.k0s()),2&n){const e=a.$implicit,s=t.XpG(2);t.R7$(2),t.Y8G("routerLink",t.eq3(18,on,e.student.Id)),t.R7$(2),t.JRh(e.student.FullName),t.R7$(2),t.Lme(" ",t.bMT(7,10,"tests.mean"),": ",t.i5U(8,12,null==e.finalGrade?null:e.finalGrade.average,"1-3")," "),t.R7$(3),t.Y8G("ngClass",t.eq3(20,z,void 0===s.selectedTest)),t.R7$(),t.Y8G("ngIf",e.finalGrade&&!e.finalGrade.freeHandGrade),t.R7$(),t.Y8G("ngIf",e.finalGrade&&e.finalGrade.freeHandGrade),t.R7$(2),t.SpI(" ",t.i5U(14,15,null==e.finalGrade?null:e.finalGrade.average,"1-3")," "),t.R7$(2),t.Y8G("ngForOf",e.grades)("ngForTrackBy",s.trackGradeOf(e.student))}}function _n(n,a){if(1&n&&(t.j41(0,"td",39),t.nrm(1,"bkd-average-grades",41),t.k0s()),2&n){const e=a.$implicit,s=t.XpG(2);t.Y8G("ngClass",e.Id===(null==s.selectedTest?null:s.selectedTest.Id)||e.Id===(null==s.selectedTest?null:s.selectedTest.Id)?"selected":""),t.R7$(),t.Y8G("test",e)}}function bn(n,a){if(1&n){const e=t.RV6();t.j41(0,"button",42),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.setAverageAsFinalGrade())}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&n){const e=t.XpG().bkdLet,s=t.XpG();t.Y8G("ngClass",t.eq3(4,dn,!e.hasTests||!s.selectedTest)),t.R7$(),t.SpI(" ",t.bMT(2,2,"tests.set-final-grade")," ")}}function vn(n,a){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"div",1)(2,"table",2)(3,"thead",3)(4,"tr",4)(5,"th",5)(6,"bkd-test-table-filter",6),t.bIt("filterChange",function(i){t.eBV(e);const r=t.XpG();return t.Njj(r.state.setFilter(i))}),t.k0s()(),t.DNE(7,ln,2,3,"th",7)(8,cn,2,3,"th",8),t.k0s(),t.j41(9,"tr")(10,"th",9),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.state.sortBy("FullName"))}),t.j41(11,"div",10)(12,"div",11),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.j41(15,"div",12),t.EFF(16),t.nI1(17,"async"),t.k0s()()(),t.j41(18,"th",13),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.state.sortBy("FinalGrade"))}),t.j41(19,"div",10)(20,"div",11),t.EFF(21),t.nI1(22,"translate"),t.k0s(),t.j41(23,"div",12),t.EFF(24),t.nI1(25,"async"),t.k0s()()(),t.j41(26,"th",14),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.state.sortBy("TestsMean"))}),t.j41(27,"div",10)(28,"div",11),t.EFF(29),t.nI1(30,"translate"),t.k0s(),t.j41(31,"div",12),t.EFF(32),t.nI1(33,"async"),t.k0s()()(),t.DNE(34,pn,10,8,"th",15),t.k0s()(),t.j41(35,"tbody"),t.DNE(36,fn,16,22,"tr",16),t.j41(37,"tr")(38,"td",17)(39,"div",18)(40,"div"),t.EFF(41),t.nI1(42,"translate"),t.k0s(),t.j41(43,"div",19),t.EFF(44),t.nI1(45,"translate"),t.nI1(46,"async"),t.nI1(47,"decimalOrDash"),t.k0s()()(),t.j41(48,"td",20),t.EFF(49),t.nI1(50,"async"),t.nI1(51,"decimalOrDash"),t.k0s(),t.j41(52,"td",21),t.EFF(53),t.nI1(54,"async"),t.nI1(55,"decimalOrDash"),t.k0s(),t.DNE(56,_n,2,2,"td",22),t.k0s()()(),t.DNE(57,bn,3,6,"button",23),t.nI1(58,"async"),t.k0s(),t.bVm()}if(2&n){const e=a.bkdLet,s=t.XpG();t.R7$(6),t.Y8G("filter",e.filter),t.R7$(),t.Y8G("ngForOf",e.tests),t.R7$(),t.Y8G("ngForOf",e.tests),t.R7$(5),t.SpI(" ",t.bMT(14,21,"tests.student.name")," "),t.R7$(3),t.SpI(" ",t.bMT(17,23,s.state.getSortingChar$("FullName"))," "),t.R7$(2),t.Y8G("ngClass",t.eq3(54,z,void 0===s.selectedTest)),t.R7$(3),t.SpI(" ",t.bMT(22,25,"tests.grade")," "),t.R7$(3),t.SpI(" ",t.bMT(25,27,s.state.getSortingChar$("FinalGrade"))," "),t.R7$(5),t.SpI(" ",t.bMT(30,29,"tests.mean")," "),t.R7$(3),t.SpI(" ",t.bMT(33,31,s.state.getSortingChar$("TestsMean"))," "),t.R7$(2),t.Y8G("ngForOf",e.tests),t.R7$(2),t.Y8G("ngForOf",e.studentGrades)("ngForTrackBy",s.trackStudentGrade),t.R7$(5),t.JRh(t.bMT(42,33,"tests.average")),t.R7$(3),t.Lme(" ",t.bMT(45,35,"tests.mean"),": ",t.i5U(47,39,t.bMT(46,37,s.state.meanOfStudentGradesForCourse$),"1-3")," "),t.R7$(4),t.Y8G("ngClass",t.eq3(56,z,void 0===s.selectedTest)),t.R7$(),t.SpI(" ",t.i5U(51,44,t.bMT(50,42,s.state.meanOfFinalGradesForCourse$),"1-3")," "),t.R7$(4),t.SpI(" ",t.i5U(55,49,t.bMT(54,47,s.state.meanOfStudentGradesForCourse$),"1-3")," "),t.R7$(3),t.Y8G("ngForOf",e.tests),t.R7$(),t.Y8G("ngIf",t.bMT(58,52,s.state.canSetFinalGrade$))}}let Tn=(()=>{class n{constructor(e,s){this.state=e,this.modalService=s}ngOnInit(){this.state.setSorting({key:"FullName",ascending:!0})}setAverageAsFinalGrade(){this.state.course$.pipe((0,M.s)(1)).subscribe(e=>this.state.setAveragesAsFinalGrades({CourseIds:[e.Id]}))}isEditFinalGradesAllowed(e){return this.state.course$.pipe((0,p.T)(s=>!(!q(s)?.value||!e.finalGrade?.canGrade)))}publish(e){const s=this.openModal(e);this.onCloseModal(s,()=>this.state.publish(e))}unpublish(e){const s=this.openModal(e);this.onCloseModal(s,()=>this.state.unpublish(e))}trackStudentGrade(e){return e}trackGradeOf(e){return function(s,i){return`${e.Id}_${i.test.Id}`}}calculatePointsAverage(e){return this.safeAverage(e,k.zs)}calculateGradeAverage(e){return this.safeAverage(e,k.TG)}safeAverage(e,s){try{return s(e).toString()}catch{return"\u2013"}}openModal(e){const s=this.modalService.open(Ne);return s.componentInstance.test=e,s}onCloseModal(e,s){e.result.then(i=>{i&&s()},()=>{})}static#t=this.\u0275fac=function(s){return new(s||n)(t.rXU(x),t.rXU(ht.y))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-test-edit-grades"]],inputs:{selectedTest:"selectedTest"},standalone:!0,features:[t.Jv_([Y]),t.aNF],decls:6,vars:17,consts:[[4,"bkdLet"],[1,"table-responsive-wrapper"],[1,"table","table-hover","h-100"],[1,"h-100"],[1,"h-100","header-collapsible"],["colspan","3",1,"desktop","sticky"],[3,"filterChange","filter"],["container","body","class","grade h-100 test-info-desktop",3,"ngClass",4,"ngFor","ngForOf"],["container","body","class","grade h-100 header-mobile test-info-mobile","colspan","3",3,"ngClass",4,"ngFor","ngForOf"],[1,"primary-column-width","sticky",3,"click"],[1,"d-flex"],[1,"column-title"],[1,"sort-direction","ms-1"],[1,"secondary-column-width","sticky","sticky-col-2","desktop",3,"click","ngClass"],[1,"secondary-column-width","border-end","sticky","sticky-col-3","desktop",3,"click"],["container","body","class","grade h-100",3,"ngClass",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"sticky"],[1,"d-flex","flex-column"],[1,"mobile","mean"],[1,"desktop","sticky","sticky","sticky-col-2",3,"ngClass"],[1,"desktop","border-end","sticky","sticky-col-3"],["class","grade",3,"ngClass",4,"ngFor","ngForOf"],["data-testId","apply-average-button","class","apply-average-button btn btn-primary m-3","type","button",3,"ngClass","click",4,"ngIf"],["container","body",1,"grade","h-100","test-info-desktop",3,"ngClass"],[3,"toggle","publish","unpublish","test","expanded"],["container","body","colspan","3",1,"grade","h-100","header-mobile","test-info-mobile",3,"ngClass"],["container","body",1,"grade","h-100",3,"ngClass"],["class","column-title me-3 point-input-container",4,"ngIf"],[3,"click"],[1,"column-title","me-3","point-input-container"],[1,"primary-column-width","sticky","name"],[3,"routerLink"],[1,"grade","sticky","sticky-col-2",3,"ngClass"],[3,"options","valueId","gradeId","disabled","gradeIdSelected",4,"ngIf"],[4,"ngIf"],[1,"grade","border-end","sticky","sticky-col-3"],["class","grade",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[3,"gradeIdSelected","options","valueId","gradeId","disabled"],[1,"grade",3,"ngClass"],[3,"grade","gradeOptions","student","tabIndex"],[3,"test"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"click","ngClass"]],template:function(s,i){1&s&&(t.DNE(0,vn,59,58,"ng-container",0),t.nI1(1,"async"),t.nI1(2,"async"),t.nI1(3,"async"),t.nI1(4,"async"),t.nI1(5,"async")),2&s&&t.Y8G("bkdLet",t.s1E(11,rn,t.bMT(1,1,i.state.filteredTests$),t.bMT(2,3,i.state.hasTests$),t.bMT(3,5,i.state.studentGrades$),t.bMT(4,7,i.state.filter$),t.bMT(5,9,i.state.expandedHeader$)))},dependencies:[T.N,u.YU,u.pM,Ke,an,u.bT,m.Wk,He,Ye,Je,u.Jj,l.h,l.D9,W.rv],styles:[".filter-hover[_ngcontent-%COMP%]:hover{background-color:#dedede}table[_ngcontent-%COMP%]   th.grade.selected[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td.grade.selected[_ngcontent-%COMP%]{display:table-cell!important}table[_ngcontent-%COMP%]   th.grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td.grade[_ngcontent-%COMP%], .desktop[_ngcontent-%COMP%]{display:none!important}.desktop.selected[_ngcontent-%COMP%]{display:table-cell!important}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;vertical-align:top}.header-collapsible[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:0 1rem}.mobile[_ngcontent-%COMP%]{display:block!important}.mean[_ngcontent-%COMP%]{color:#4e4e4ef2;font-size:.875rem;line-height:1}td.name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}td.name[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{text-decoration:underline}td.name[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:none!important}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem}table[_ngcontent-%COMP%]   td.name[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td.average[_ngcontent-%COMP%]{max-width:18ch;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding-right:0}.point-input-container[_ngcontent-%COMP%]{width:5em}@media (min-width: 576px){.table-responsive-wrapper[_ngcontent-%COMP%]{display:block;overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th.test-info-mobile[_ngcontent-%COMP%]{display:none!important}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   th.grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td.grade[_ngcontent-%COMP%], .desktop[_ngcontent-%COMP%]{display:table-cell!important}table[_ngcontent-%COMP%]   td.name[_ngcontent-%COMP%]{max-width:auto;overflow:visible}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;padding-top:.25rem;padding-bottom:.25rem;border-top:initial;min-width:100px;max-width:100px}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th.grade[_ngcontent-%COMP%]{min-width:300px;max-width:300px}.mobile[_ngcontent-%COMP%]{display:none!important}.primary-column-width[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-width:300px;max-width:300px}.secondary-column-width[_ngcontent-%COMP%]{min-width:100px;max-width:100px}table[_ngcontent-%COMP%]   .sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}table[_ngcontent-%COMP%]   .sticky.sticky-col-2[_ngcontent-%COMP%]{left:300px}table[_ngcontent-%COMP%]   .sticky.sticky-col-3[_ngcontent-%COMP%]{left:452px}}@media (max-width: 575.98px){.apply-average-button[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]})}return n})();var In=o(9172),Cn=o(2637),$n=o(8667),Gn=o(5507);const yn=()=>["/events"],kn=n=>({count:n});function Fn(n,a){if(1&n&&(t.j41(0,"div",8),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",t.i5U(2,1,1===e.course.ParticipatingStudents.length?"courses.registration":"courses.registrations",t.eq3(4,kn,e.course.ParticipatingStudents.length))," ")}}let En=(()=>{class n{constructor(e){this.reportsService=e,this.course$=new y.t(null),this.reports$=this.course$.pipe((0,p.T)(s=>s?.Id),(0,F.F)(),(0,v.n)(s=>s?this.reportsService.getCourseReports(s):(0,G.of)([])),(0,In.Z)([]))}ngOnChanges(e){e.course&&this.course$.next(e.course.currentValue)}getDesignation(){return tt(this.course)}static#t=this.\u0275fac=function(s){return new(s||n)(t.rXU(Gn.P))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-tests-header"]],inputs:{course:"course"},standalone:!0,features:[t.OA$,t.aNF],decls:12,vars:7,consts:[[3,"link"],[1,"d-flex"],["routerLink","add",1,"edit","btn","btn-primary","btn-icon","ms-2"],[1,"material-icons"],[1,"ms-2",3,"reports"],["id","excel-import"],[1,"d-flex","flex-column","header"],["class","additional-info",4,"ngIf"],[1,"additional-info"]],template:function(s,i){1&s&&(t.j41(0,"bkd-backlink",0)(1,"div",1)(2,"a",2)(3,"i",3),t.EFF(4,"add"),t.k0s()(),t.nrm(5,"bkd-reports-link",4),t.nI1(6,"async"),t.nrm(7,"div",5),t.k0s()(),t.j41(8,"div",6)(9,"h1"),t.EFF(10),t.k0s(),t.DNE(11,Fn,3,6,"div",7),t.k0s()),2&s&&(t.Y8G("link",t.lJ4(6,yn)),t.R7$(5),t.Y8G("reports",t.bMT(6,4,i.reports$)),t.R7$(5),t.JRh(i.getDesignation()),t.R7$(),t.Y8G("ngIf",i.course.ParticipatingStudents))},dependencies:[Cn.P,m.Wk,$n.Z,u.bT,u.Jj,l.h,l.D9],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem;border-bottom:1px solid #dee2e6}h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"]})}return n})();const Rn=(n,a,e,s,i,r)=>({course:n,tests:a,hasTests:e,testOptions:s,selectedTestId:i,selectedTest:r}),Mn=n=>({"visible-on-mobile":n});function xn(n,a){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"bkd-select",7),t.bIt("valueChange",function(i){t.eBV(e);const r=t.XpG(3);return t.Njj(i&&r.testSelected(i))}),t.k0s(),t.nrm(2,"bkd-test-edit-grades",8),t.bVm()}if(2&n){const e=t.XpG(2).bkdLet;t.R7$(),t.Y8G("options",e.testOptions)("value",e.selectedTestId)("allowEmpty",!1),t.R7$(),t.Y8G("selectedTest",e.selectedTest)}}function Sn(n,a){if(1&n&&(t.j41(0,"a",9),t.nI1(1,"async"),t.j41(2,"i",10),t.EFF(3,"arrow_right_alt"),t.k0s(),t.j41(4,"span",11),t.EFF(5),t.nI1(6,"translate"),t.k0s()()),2&n){const e=t.XpG(2).bkdLet,s=t.XpG();t.FS9("href",t.bMT(1,3,s.buildLinkToRatingOverview()),t.B4B),t.Y8G("ngClass",t.eq3(7,Mn,!e.hasTests||!e.selectedTest)),t.R7$(5),t.JRh(t.bMT(6,5,"tests.link-to-rating-overview"))}}function Pn(n,a){if(1&n&&(t.qex(0),t.nrm(1,"bkd-tests-header",5),t.DNE(2,xn,3,4,"ng-container",4)(3,Sn,7,9,"a",6),t.nI1(4,"async"),t.bVm()),2&n){const e=t.XpG().bkdLet,s=t.XpG(),i=t.sdS(9);t.R7$(),t.Y8G("course",e.course),t.R7$(),t.Y8G("ngIf",e.tests.length>0)("ngIfElse",i),t.R7$(),t.Y8G("ngIf",t.bMT(4,4,s.state.canSetFinalGrade$))}}function jn(n,a){if(1&n&&(t.qex(0),t.DNE(1,Pn,5,6,"ng-container",4),t.nI1(2,"async"),t.bVm()),2&n){const e=t.XpG(),s=t.sdS(11);t.R7$(),t.Y8G("ngIf",!1===t.bMT(2,2,e.state.loading$))("ngIfElse",s)}}function On(n,a){1&n&&(t.j41(0,"p",12),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"tests.no-tests")))}function Dn(n,a){1&n&&t.nrm(0,"bkd-spinner")}let Nn=(()=>{class n{constructor(e,s,i){this.settings=e,this.state=s,this.translate=i,this.selectTest$=new D.B,this.testOptions$=this.state.tests$.pipe((0,p.T)(r=>[{Key:-1,Value:this.translate.instant("tests.grade")},...r.map(d=>({Key:d.Id,Value:d.Designation}))]),(0,F.F)()),this.selectedTestId$=(0,at.h)(this.selectTest$,this.state.tests$.pipe((0,M.s)(1),(0,p.T)(r=>r[0]?.Id))).pipe((0,F.F)()),this.selectedTest$=this.selectedTestId$.pipe((0,v.n)(r=>this.state.tests$.pipe((0,p.T)(d=>d.find(c=>c.Id===r)))),(0,F.F)())}testSelected(e){this.selectTest$.next(e)}buildLinkToRatingOverview(){return this.state.course$.pipe((0,M.s)(1),(0,p.T)(e=>this.settings.eventlist.evaluation.replace(":id",String(e.Id))))}static#t=this.\u0275fac=function(s){return new(s||n)(t.rXU(X.yy),t.rXU(x),t.rXU(l.c$))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-tests-list"]],standalone:!0,features:[t.aNF],decls:12,vars:20,consts:[["noTests",""],["loading",""],[1,"bkd-container"],[4,"bkdLet"],[4,"ngIf","ngIfElse"],[3,"course"],["class","rating-overview d-flex justify-content-end pe-3 border-top pt-3",3,"ngClass","href",4,"ngIf"],[1,"tests-dropdown",3,"valueChange","options","value","allowEmpty"],[3,"selectedTest"],[1,"rating-overview","d-flex","justify-content-end","pe-3","border-top","pt-3",3,"ngClass","href"],[1,"material-icons","fw-bold"],[1,"ps-1"],[1,"mt-3","px-3"]],template:function(s,i){1&s&&(t.j41(0,"div",2),t.DNE(1,jn,3,4,"ng-container",3),t.nI1(2,"async"),t.nI1(3,"async"),t.nI1(4,"async"),t.nI1(5,"async"),t.nI1(6,"async"),t.nI1(7,"async"),t.DNE(8,On,3,3,"ng-template",null,0,t.C5r)(10,Dn,1,0,"ng-template",null,1,t.C5r),t.k0s()),2&s&&(t.R7$(),t.Y8G("bkdLet",t.l4e(13,Rn,t.bMT(2,1,i.state.course$),t.bMT(3,3,i.state.tests$),t.bMT(4,5,i.state.hasTests$),t.bMT(5,7,i.testOptions$),t.bMT(6,9,i.selectedTestId$),t.bMT(7,11,i.selectedTest$))))},dependencies:[T.N,u.bT,En,K.w,Tn,u.YU,E.t,u.Jj,l.h,l.D9],styles:[".tests-dropdown[_ngcontent-%COMP%]{display:block;padding:1rem 0}@media (min-width: 576px){.tests-dropdown[_ngcontent-%COMP%]{display:none}}a.rating-overview[_ngcontent-%COMP%]{text-decoration:none}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}@media (max-width: 575.98px){a.rating-overview[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]})}return n})(),Q=(()=>{class n{constructor(e,s){this.state=e,this.route=s,this.courseId$=this.route.paramMap.pipe((0,p.T)(i=>Number(i.get("id"))),(0,F.F)()),this.destroy$=new D.B}ngOnInit(){this.courseId$.pipe((0,B.Q)(this.destroy$)).subscribe(e=>this.state.setCourseId(e))}ngOnDestroy(){this.destroy$.next()}static#t=this.\u0275fac=function(s){return new(s||n)(t.rXU(x),t.rXU(m.nX))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["bkd-tests"]],standalone:!0,features:[t.Jv_([x]),t.aNF],decls:1,vars:0,template:function(s,i){1&s&&t.nrm(0,"router-outlet")},dependencies:[m.n3]})}return n})();const wn=[{path:"",component:Lt,children:[{path:"",component:Vt},{path:"current",component:At},{path:":id",component:Q,children:[{path:"tests",component:Nn}]},{path:":id/tests/:testId/edit",component:Q,children:[{path:"",component:Oe}]},{path:":id/tests/add",component:Q,children:[{path:"",component:Ee}]},{path:":id/tests",children:[P.R]}]}]},4814:(Z,S,o)=>{o.d(S,{a:()=>t});var P=o(977),l=o(6354),u=o(4412),j=o(3294),E=o(4668),T=o(6697),m=o(4438);let t=(()=>{class b{getSortingChar$(I){return this.sorting$.pipe((0,l.T)(f=>f&&I===f.key?f.ascending?"\u2193":"\u2191":""))}constructor(){this.sortingSubject$=new u.t(null),this.sorting$=this.sortingSubject$.asObservable().pipe((0,j.F)(P.A),(0,E.t)(1))}setSorting(I){this.sortingSubject$.next(I)}toggleSorting(I){this.sorting$.pipe((0,T.s)(1)).subscribe(f=>{this.sortingSubject$.next({key:I,ascending:!f||f.key!==I||!f.ascending})})}static#t=this.\u0275fac=function(f){return new(f||b)};static#e=this.\u0275prov=m.jDH({token:b,factory:b.\u0275fac,providedIn:"root"})}return b})()},9483:(Z,S,o)=>{o.d(S,{r:()=>t});var P=o(5558),l=o(2809),u=o(838),j=o(785),E=o(3220),T=o(4438),m=o(1626);let t=(()=>{class b extends E.X{constructor(I,f){super(I,f,u.i,"StudyClasses","Number")}getActive(){return this.http.get(`${this.baseUrl}/?filter.IsActive==true`,{headers:{"X-Role-Restriction":"ClassTeacherRole"}}).pipe((0,P.n)((0,j.k$)(u.i)))}getActiveFormativeAssessments(){return this.http.get(`${this.baseUrl}/FormativeAssessments?filter.IsActive==true`,{headers:{"X-Role-Restriction":"ClassTeacherRole"}}).pipe((0,P.n)((0,j.k$)(u.i)))}static#t=this.\u0275fac=function(f){return new(f||b)(T.KVO(m.Qq),T.KVO(l.yy))};static#e=this.\u0275prov=T.jDH({token:b,factory:b.\u0275fac,providedIn:"root"})}return b})()}}]);