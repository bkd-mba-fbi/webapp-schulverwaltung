import{a as Ee,b as ke,c as Ie}from"./chunk-V34B6ZOV.js";import{a as ye}from"./chunk-VTGXNMZL.js";import{a as Te}from"./chunk-VFMGCCGG.js";import{a as be}from"./chunk-RC3HL7KB.js";import"./chunk-KLXFX6SJ.js";import"./chunk-QHPTZGVN.js";import"./chunk-HHGALFFJ.js";import{b as pe,e as O}from"./chunk-2FIH3FGB.js";import"./chunk-MVTCHCDH.js";import"./chunk-Y4QYVF5K.js";import"./chunk-WN7VWSJW.js";import{a as Ce,b as Se}from"./chunk-DXYHDL5D.js";import{a as he}from"./chunk-TK3HGFHH.js";import{a as xe}from"./chunk-2IXEFCAH.js";import{c as fe}from"./chunk-X2BR3YJG.js";import{d as ge}from"./chunk-LO5XSJLW.js";import"./chunk-DMYOU5OM.js";import"./chunk-RWNJF4OZ.js";import{P as de,T as _e}from"./chunk-GI4AZI25.js";import"./chunk-Q5U6YZUT.js";import{a as me,b as ve}from"./chunk-N6FFLIGM.js";import{a as ce,c as ue}from"./chunk-33NXTXD7.js";import{s as le}from"./chunk-FTRAQKUW.js";import"./chunk-3AROKYRB.js";import{$ as E,$a as _,Bb as p,Cb as d,E as q,Fb as L,Ga as v,Ha as J,Hd as j,Ia as c,Id as M,L as U,Nb as Z,O as N,Q as G,Rb as ee,Sa as s,Sb as te,Ta as l,Tb as ne,Ua as x,Va as F,W as X,Wa as w,Wb as ie,Wc as se,Ya as A,Z as S,_a as y,ha as I,ia as T,ib as P,jb as u,kb as h,lb as g,m as W,pb as R,pc as ae,qb as B,qc as re,ra as z,rb as $,sb as K,sc as oe,tb as k,ua as o,ub as Q,va as f,vb as V,xb as Y}from"./chunk-T7QWSMKM.js";var Ae=(()=>{let n=class n{constructor(t,i,r){this.studentsService=t,this.educationalEventsService=i,this.studyClassesService=r,this.filter={student:null,educationalEvent:null,studyClass:null},this.filterChange=new z,this.classesHttpFilter={params:{fields:"IsActive","filter.IsActive":"=true"}}}show(){this.filterChange.emit(this.filter)}};n.\u0275fac=function(i){return new(i||n)(f(fe),f(Ie),f(Te))},n.\u0275cmp=E({type:n,selectors:[["bkd-evaluate-absences-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},standalone:!0,features:[k],decls:20,vars:19,consts:[[1,"row","g-3","align-items-end"],[1,"col-sm-12","col-md"],[1,"form-label"],[3,"valueChange","typeaheadService","value"],[3,"valueChange","typeaheadService","value","additionalHttpParams"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(i,r){i&1&&(s(0,"div",0)(1,"div",1)(2,"label",2),u(3),p(4,"translate"),l(),s(5,"bkd-typeahead",3),$("valueChange",function(m){return B(r.filter.student,m)||(r.filter.student=m),m}),l()(),s(6,"div",1)(7,"label",2),u(8),p(9,"translate"),l(),s(10,"bkd-typeahead",3),$("valueChange",function(m){return B(r.filter.educationalEvent,m)||(r.filter.educationalEvent=m),m}),l()(),s(11,"div",1)(12,"label",2),u(13),p(14,"translate"),l(),s(15,"bkd-typeahead",4),$("valueChange",function(m){return B(r.filter.studyClass,m)||(r.filter.studyClass=m),m}),l()(),s(16,"div",5)(17,"button",6),y("click",function(){return r.show()}),u(18),p(19,"translate"),l()()()),i&2&&(o(3),h(d(4,11,"evaluate-absences.header.student")),o(2),c("typeaheadService",r.studentsService),R("value",r.filter.student),o(3),h(d(9,13,"evaluate-absences.header.module-instance")),o(2),c("typeaheadService",r.educationalEventsService),R("value",r.filter.educationalEvent),o(3),h(d(14,15,"evaluate-absences.header.study-class")),o(2),c("typeaheadService",r.studyClassesService),R("value",r.filter.studyClass),c("additionalHttpParams",r.classesHttpFilter),o(3),g(" ",d(19,17,"evaluate-absences.header.show")," "))},dependencies:[ye,M,j],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1rem 1rem 1rem 0;border-bottom:1px solid #dee2e6}"],changeDetection:0});let e=n;return e})();var C=(()=>{let n=class n extends Se{constructor(t,i,r,b,m){super(t,i,m,r,"/evaluate-absences"),this.lessonPresenceService=b,this.queryParamsString$.pipe(G(this.destroy$)).subscribe(D=>this.confirmBackLinkParams={returnparams:D})}updateAfterConfirm(){this.resetEntries()}getInitialFilter(){return{student:null,educationalEvent:null,studyClass:null}}isValidFilter(t){return!!(t.student||t.educationalEvent||t.studyClass)}getInitialSorting(){return{key:"StudentFullName",ascending:!0}}loadEntries(t,i,r){return this.loadingService.load(this.lessonPresenceService.getStatistics(t,i,r),Ce)}buildParamsFromFilter(t){return Ee(t)}};n.\u0275fac=function(i){return new(i||n)(S(Z),S(ve),S(se),S(O),S(xe))},n.\u0275prov=X({token:n,factory:n.\u0275fac});let e=n;return e})();var Be=(e,n,a)=>({entries:e,hasMore:n,loadingPage:a}),$e=()=>[],je=e=>["student",e,"absences"],Me=e=>({returnparams:e});function Oe(e,n){if(e&1){let a=A();s(0,"th",16),y("click",function(){let i=I(a).$implicit,r=_(5);return T(r.state.sortService.toggleSorting(i.key))}),s(1,"div",17)(2,"div",18),p(3,"translate"),u(4),p(5,"translate"),l(),s(6,"div",19),u(7),p(8,"async"),l()()()}if(e&2){let a=n.$implicit,t=_(5);c("ngClass",a.label),o(2),c("ngbTooltip",d(3,4,"evaluate-absences.list.header."+a.label)),o(2),g(" ",d(5,6,"evaluate-absences.list.header."+a.label)," "),o(3),g(" ",d(8,8,t.state.sortService.getSortingChar$(a.key))," ")}}function De(e,n){if(e&1&&(s(0,"a",22),p(1,"async"),u(2),l()),e&2){let a=_().$implicit,t=_().$implicit,i=_(6);c("routerLink",V(5,je,t.StudentRef.Id))("queryParams",V(7,Me,d(1,3,i.profileReturnParams$))),o(2),g(" ",t[a.key]," ")}}function Ne(e,n){if(e&1&&u(0),e&2){let a=_().$implicit,t=_().$implicit;g(" ",t[a.key]," ")}}function Ve(e,n){if(e&1&&(s(0,"td"),p(1,"translate"),v(2,De,3,9,"a",21)(3,Ne,1,1,"ng-template",null,3,L),l()),e&2){let a=n.$implicit,t=P(4);J("data-label",d(1,3,"evaluate-absences.list.header."+a.label)),o(2),c("ngIf",a.key==="StudentFullName")("ngIfElse",t)}}function He(e,n){if(e&1&&(s(0,"tr"),v(1,Ve,5,5,"td",20),l()),e&2){let a=_(6);o(),c("ngForOf",a.columns)}}function We(e,n){if(e&1&&(s(0,"tbody"),v(1,He,2,1,"tr",20),l()),e&2){let a=_(4).bkdLet;o(),c("ngForOf",a.entries)}}function qe(e,n){e&1&&x(0,"bkd-spinner",23)}function Ue(e,n){if(e&1){let a=A();s(0,"button",24),y("click",function(){I(a);let i=_(5);return T(i.state.nextPage())}),u(1),p(2,"translate"),l()}e&2&&(o(),g(" ",d(2,1,"global.pagination.load-more")," "))}function Ge(e,n){if(e&1){let a=A();s(0,"div",8)(1,"div",9),x(2,"bkd-reports-link",10),p(3,"async"),l(),s(4,"table",11),y("scrolled",function(){I(a);let i=_(4);return T(i.onScroll())}),s(5,"thead")(6,"tr"),v(7,Oe,9,10,"th",12),l()(),v(8,We,2,1,"tbody",13),l(),v(9,qe,1,0,"bkd-spinner",14)(10,Ue,3,3,"button",15),l()}if(e&2){let a,t=_(3).bkdLet,i=_();o(2),c("reports",(a=d(3,5,i.reports$))!==null&&a!==void 0?a:Q(7,$e)),o(5),c("ngForOf",i.columns),o(),c("ngIf",t.entries&&t.entries.length>0),o(),c("ngIf",t.loadingPage),o(),c("ngIf",t.hasMore&&!t.loadingPage)}}function Xe(e,n){e&1&&(s(0,"p",25),u(1),p(2,"translate"),l()),e&2&&(o(),g(" ",d(2,1,"evaluate-absences.no-entries")," "))}function ze(e,n){if(e&1&&(F(0),v(1,Ge,11,8,"div",7)(2,Xe,3,3,"ng-template",null,2,L),w()),e&2){let a=P(3),t=_(2).bkdLet;o(),c("ngIf",t.entries&&t.entries.length>0||t.loadingPage)("ngIfElse",a)}}function Je(e,n){e&1&&x(0,"bkd-spinner")}function Ke(e,n){if(e&1&&(F(0),v(1,ze,4,2,"ng-container",6),p(2,"async"),v(3,Je,1,0,"ng-template",null,1,L),w()),e&2){let a=P(4),t=_(2);o(),c("ngIf",d(2,2,t.state.loading$)===!1)("ngIfElse",a)}}function Qe(e,n){e&1&&(s(0,"p",25),u(1),p(2,"translate"),l()),e&2&&(o(),h(d(2,1,"evaluate-absences.no-filter")))}function Ye(e,n){if(e&1){let a=A();F(0),s(1,"bkd-evaluate-absences-header",5),p(2,"async"),y("filterChange",function(i){I(a);let r=_();return T(r.state.setFilter(i))}),l(),v(3,Ke,5,4,"ng-container",6),p(4,"async"),v(5,Qe,3,3,"ng-template",null,0,L),w()}if(e&2){let a=P(6),t=_();o(),c("filter",d(2,3,t.filterFromParams$)),o(2),c("ngIf",d(4,5,t.state.isFilterValid$))("ngIfElse",a)}}var Le=(()=>{let n=class n{constructor(t,i,r,b,m,D){this.state=t,this.scrollPosition=i,this.route=r,this.presenceTypesService=b,this.reportsService=m,this.lessonPresencesService=D,this.reports$=this.loadReports(),this.columns=[{key:"StudentFullName",label:"student"},{key:"TotalAbsences",label:"total"},{key:"TotalAbsencesValidExcuse",label:"valid-excuse"},{key:"TotalAbsencesWithoutExcuse",label:"without-excuse"},{key:"TotalAbsencesUnconfirmed",label:"unconfirmed"},{key:"TotalAbsencesUnchecked",label:"unchecked"},{key:"TotalIncidents",label:"incident"}],this.filterFromParams$=this.route.queryParams.pipe(W(Ze)),this.profileReturnParams$=this.state.queryParamsString$}ngOnInit(){this.filterFromParams$.pipe(q(1)).subscribe(t=>this.state.setFilter(t)),this.presenceTypesService.halfDayActive$.subscribe(t=>{t&&(this.columns=[...this.columns,{key:"TotalHalfDays",label:"halfday"}])})}ngAfterViewInit(){this.scrollPosition.restore()}onScroll(){this.state.nextPage()}loadReports(){return this.state.validFilter$.pipe(N(t=>this.lessonPresencesService.getLessonRefs(t)),N(t=>t.length>0?this.reportsService.getEvaluateAbsencesReports(this.getReportRecordIds(t)):[]),U(1))}getReportRecordIds(t){return t.map(i=>`${i.LessonRef.Id}_${i.RegistrationRef.Id}`)}};n.\u0275fac=function(i){return new(i||n)(f(C),f(he),f(ae),f(_e),f(ge),f(O))},n.\u0275cmp=E({type:n,selectors:[["bkd-evaluate-absences-list"]],standalone:!0,features:[k],decls:7,vars:14,consts:[["noFilter",""],["loading",""],["noEntries",""],["noLink",""],[4,"bkdLet"],[3,"filterChange","filter"],[4,"ngIf","ngIfElse"],["class","py-3",4,"ngIf","ngIfElse"],[1,"py-3"],[1,"buttons"],[1,"mb-2",3,"reports"],["infiniteScroll","",1,"table","table-striped","table-fixed",3,"scrolled"],["scope","col",3,"ngClass","click",4,"ngFor","ngForOf"],[4,"ngIf"],["class","inline",4,"ngIf"],["type","button","class","btn btn-outline-secondary btn-sm d-block mx-auto",3,"click",4,"ngIf"],["scope","col",3,"click","ngClass"],[1,"d-flex"],[1,"column-title",3,"ngbTooltip"],[1,"sort-direction"],[4,"ngFor","ngForOf"],["class","student",3,"routerLink","queryParams",4,"ngIf","ngIfElse"],[1,"student",3,"routerLink","queryParams"],[1,"inline"],["type","button",1,"btn","btn-outline-secondary","btn-sm","d-block","mx-auto",3,"click"],[1,"mt-3"]],template:function(i,r){i&1&&(s(0,"h1"),u(1),p(2,"translate"),l(),v(3,Ye,7,7,"ng-container",4),p(4,"async"),p(5,"async"),p(6,"async")),i&2&&(o(),h(d(2,2,"evaluate-absences.title")),o(2),c("bkdLet",Y(10,Be,d(4,4,r.state.entries$),d(5,6,r.state.hasMore$),d(6,8,r.state.loadingPage$))))},dependencies:[ce,Ae,ne,me,ke,te,ee,le,oe,ue,ie,M,j],styles:["th[_ngcontent-%COMP%]{cursor:pointer}th.student[_ngcontent-%COMP%]{width:30%}.column-title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"],changeDetection:0});let e=n;return e})();function Ze(e){return{student:e.student?Number(e.student):null,educationalEvent:e.educationalEvent?Number(e.educationalEvent):null,studyClass:e.studyClass?Number(e.studyClass):null}}var Fe=(()=>{let n=class n{constructor(t){this.state=t}};n.\u0275fac=function(i){return new(i||n)(f(C))},n.\u0275cmp=E({type:n,selectors:[["bkd-evaluate-absences"]],standalone:!0,features:[K([C,{provide:pe,useExisting:C},de]),k],decls:1,vars:0,template:function(i,r){i&1&&x(0,"router-outlet")},dependencies:[re],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0});let e=n;return e})();var Vt=[{path:"",component:Fe,children:[{path:"",component:Le,data:{restoreScrollPositionFrom:["/evaluate-absences/student/:id"]}},be]}];export{Vt as EVALUATE_ABSENCES_ROUTES};
