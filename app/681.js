"use strict";(self.webpackChunkwebapp_schulverwaltung=self.webpackChunkwebapp_schulverwaltung||[]).push([[681],{7681:(ee,x,r)=>{r.d(x,{d:()=>K});var e=r(5e3),v=r(8980),o=r(9808),l=r(1504),C=r(6342);function f(s,i,t){return i?i.Grade:function I(s,i){var t;return null===(t=null==i?void 0:i.Grades.find(n=>n.Id===(null==s?void 0:s.GradeId)))||void 0===t?void 0:t.Designation}(s,t)||(null==s?void 0:s.GradeValue)}function G(s,i){if(1&s&&(e.TgZ(0,"span",2),e._uU(1),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.hij(" (",t.grade,")")}}function b(s,i){if(1&s&&(e.TgZ(0,"span",3),e._uU(1),e.ALo(2,"number"),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.hij(" (",e.xi3(2,1,t.average,"1.0-3"),")")}}let S=(()=>{class s{constructor(){}get grade(){return this.getGradeForStudent()}get average(){var t;return null===(t=this.grading)||void 0===t?void 0:t.AverageTestResult}getGradeForStudent(){return f(this.grading,this.finalGrade,this.gradingScale)}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["erz-dossier-grades-course-header"]],inputs:{designation:"designation",finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale"},decls:3,vars:3,consts:[["class","grade","data-testId","grade",4,"ngIf"],["class","average","data-testId","average",4,"ngIf"],["data-testId","grade",1,"grade"],["data-testId","average",1,"average"]],template:function(t,n){1&t&&(e._uU(0),e.YNc(1,G,2,1,"span",0),e.YNc(2,b,3,4,"span",1)),2&t&&(e.Oqu(n.designation),e.xp6(1),e.Q6J("ngIf",n.grade),e.xp6(1),e.Q6J("ngIf",!n.grade&&n.average))},directives:[o.O5],pipes:[o.JJ],styles:[".average[_ngcontent-%COMP%]{color:#33333d80}"]}),s})();var g=r(8088),u=r(8995);let A=(()=>{class s{constructor(t){this.decimalPipe=t}getGradeForStudent(){return f(this.grading,this.finalGrade,this.gradingScale)}get average(){var t,n;return this.grading&&0!==(null===(t=this.grading)||void 0===t?void 0:t.AverageTestResult)&&null!==(n=this.decimalPipe.transform(this.grading.AverageTestResult,"1.0-3"))&&void 0!==n?n:"-"}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(o.JJ))},s.\u0275cmp=e.Xpm({type:s,selectors:[["erz-dossier-grades-final-grade"]],inputs:{finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale"},features:[e._Bn([o.JJ])],decls:13,vars:8,consts:[[1,"final-entry"],["data-testid","final-grade"],["data-testid","average-test-results"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",1),e.TgZ(5,"span"),e._uU(6),e.qZA(),e.qZA(),e.TgZ(7,"div"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"div",2),e.TgZ(11,"span"),e._uU(12),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(2),e.Oqu(e.lcZ(3,4,"dossier.grade")),e.xp6(4),e.Oqu(n.getGradeForStudent()||"-"),e.xp6(2),e.Oqu(e.lcZ(9,6,"dossier.average")),e.xp6(4),e.Oqu(n.average))},pipes:[u.X$],styles:[".final-entry[_ngcontent-%COMP%]{padding:1.5rem;display:grid;grid-template-columns:repeat(2,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}"]}),s})();var D=r(4707),p=r(4004),d=r(3075),m=r(7579),_=r(1135),h=r(8372),y=r(9300),T=r(2722),O=r(9118),P=r(9092);const q=function(s){return{maxPoints:s}};function E(s,i){if(1&s&&(e.TgZ(0,"div",14),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&s){const t=e.oxw(2);e.xp6(1),e.hij(" ",e.xi3(2,1,"global.validation-errors.invalidPoints",e.VKq(4,q,t.maxPoints))," ")}}function w(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"div",3),e.TgZ(1,"label",10),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",5),e.TgZ(5,"input",11,12),e.NdJ("input",function(){e.CHM(t);const a=e.MAs(6);return e.oxw().onPointsChange(a.value)}),e.qZA(),e.qZA(),e.YNc(7,E,3,6,"div",13),e.qZA()}if(2&s){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,8,"dossier.dialog.points")),e.xp6(2),e.ekj("is-invalid",t.pointsInput.errors),e.xp6(1),e.ekj("is-invalid",t.pointsInput.errors),e.s9C("max",t.maxPoints),e.Q6J("formControl",t.pointsInput),e.xp6(2),e.Q6J("ngIf",t.pointsInput.errors)}}let $=(()=>{class s{constructor(t,n){this.activeModal=t,this.courseService=n,this.maxPoints=0,this.gradeSubject$=new m.x,this.pointsSubject$=new m.x,this.closeButtonDisabled$=new _.X(!1),this.gradingScaleDisabled$=new _.X(!0),this.grade$=this.gradeSubject$.pipe((0,h.b)(500)),this.points$=this.pointsSubject$.pipe((0,h.b)(500),(0,y.h)(this.isValid.bind(this)),(0,p.U)(Number)),this.destroy$=new m.x}ngOnInit(){this.maxPoints=(0,g.Re)(this.test),this.pointsInput=new d.NI({value:this.points,disabled:!1},[d.kI.min(0),d.kI.pattern("[0-9]+([\\.][0-9]+)?"),this.maxPointValidator()]),this.gradingScaleDisabled$.next(this.test.IsPointGrading&&this.points>0),this.grade$.pipe((0,T.R)(this.destroy$),(0,p.U)(this.buildRuequestBodyForGradeChange.bind(this))).subscribe(t=>this.updateTestResult(t)),this.points$.pipe((0,T.R)(this.destroy$),(0,p.U)(this.buildRequestBodyPointsChange.bind(this))).subscribe(t=>this.updateTestResult(t))}onGradeChange(t){this.gradeSubject$.next(t)}onPointsChange(t){this.pointsSubject$.next(t),this.gradingScaleDisabled$.next(t.length>0)}get updatedTestResult(){var t;return null===(t=this.updatedTest)||void 0===t?void 0:t.TestResults[0]}updateTestResult(t){this.closeButtonDisabled$.next(!0),this.courseService.updateTestResult(this.test.CourseId,t).subscribe(n=>{var a;this.gradeId=null===(a=n.TestResults[0])||void 0===a?void 0:a.GradeId,this.updatedTest=n,this.closeButtonDisabled$.next(!1)})}buildRuequestBodyForGradeChange(t){return{StudentIds:[this.studentId],TestId:this.test.Id,GradeId:t}}buildRequestBodyPointsChange(t){return{StudentIds:[this.studentId],TestId:this.test.Id,Points:t}}isValid(t){return""!==t&&!isNaN(Number(t))&&!(Number(t)<0||Number(t)>this.maxPoints)}maxPointValidator(){return t=>Number(t.value)>(0,g.Re)(this.test)?{customMax:!0}:null}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(l.Kz),e.Y36(O.s))},s.\u0275cmp=e.Xpm({type:s,selectors:[["erz-dossier-grades-edit"]],inputs:{test:"test",gradeId:"gradeId",gradeOptions:"gradeOptions",points:"points",studentId:"studentId"},decls:19,vars:20,consts:[[1,"modal-body"],[1,"mb-4"],["class","form-group row",4,"ngIf"],[1,"form-group","row"],["for","grade",1,"col-6","col-form-label"],[1,"col-6"],["id","grade",3,"options","value","allowEmpty","disabled","valueChange"],[1,"text-muted","mt-4"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["for","points",1,"col-6","col-form-label"],["id","points","type","number","step","0.01","min","0",1,"form-control",3,"max","formControl","input"],["pointInput",""],["class","invalid-feedback col-6 offset-6","data-testid","validation-error-message",4,"ngIf"],["data-testid","validation-error-message",1,"invalid-feedback","col-6","offset-6"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"p",1),e._uU(2),e.qZA(),e.YNc(3,w,8,10,"div",2),e.TgZ(4,"div",3),e.TgZ(5,"label",4),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"div",5),e.TgZ(9,"erz-select",6),e.NdJ("valueChange",function(c){return n.onGradeChange(c)}),e.ALo(10,"async"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(11,"p",7),e._uU(12),e.ALo(13,"translate"),e.qZA(),e.qZA(),e.TgZ(14,"div",8),e.TgZ(15,"button",9),e.NdJ("click",function(){return n.activeModal.close(n.updatedTestResult)}),e.ALo(16,"async"),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.qZA()),2&t&&(e.xp6(2),e.Oqu(n.test.Designation),e.xp6(1),e.Q6J("ngIf",n.test.IsPointGrading),e.xp6(3),e.Oqu(e.lcZ(7,10,"dossier.dialog.grade")),e.xp6(3),e.Q6J("options",n.gradeOptions)("value",n.gradeId)("allowEmpty",!1)("disabled",e.lcZ(10,12,n.gradingScaleDisabled$)),e.xp6(3),e.hij(" ",e.lcZ(13,14,n.test.IsPointGrading?"dossier.dialog.hint.points":"dossier.dialog.hint.grade")," "),e.xp6(3),e.Q6J("disabled",e.lcZ(16,16,n.closeButtonDisabled$)),e.xp6(2),e.hij(" ",e.lcZ(18,18,"dossier.dialog.close")," "))},directives:[o.O5,d.qQ,d.Fd,d.wV,d.Fj,d.JJ,d.oH,P.H],pipes:[u.X$,o.Ov],styles:[""]}),s})();var F=r(1104),U=r(2097),J=r(4371);function M(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"a",11),e.NdJ("click",function(){e.CHM(t);const a=e.oxw().erzLet;return e.oxw().editGrading(a)}),e.TgZ(1,"i",12),e._uU(2,"edit"),e.qZA(),e.TgZ(3,"span",13),e._uU(4),e.ALo(5,"async"),e.qZA(),e.qZA()}if(2&s){const t=e.oxw(2);e.xp6(4),e.Oqu(e.lcZ(5,1,t.grading$))}}function N(s,i){if(1&s&&(e.TgZ(0,"span",13),e._uU(1),e.ALo(2,"async"),e.qZA()),2&s){const t=e.oxw(2);e.xp6(1),e.Oqu(e.lcZ(2,1,t.grading$))}}function j(s,i){if(1&s&&(e.TgZ(0,"div",14),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&s){const t=e.oxw().erzLet;e.xp6(1),e.hij(" ",e.lcZ(2,1,t.IsPublished?"tests.published":"tests.not-published")," ")}}function z(s,i){if(1&s&&(e.TgZ(0,"div",1),e.TgZ(1,"div",2),e._uU(2),e.qZA(),e.TgZ(3,"div",3),e._uU(4),e.ALo(5,"date"),e.qZA(),e.TgZ(6,"div",4),e.YNc(7,M,6,3,"a",5),e.YNc(8,N,3,3,"ng-template",null,6,e.W1O),e.qZA(),e.TgZ(10,"div",7),e._uU(11),e.ALo(12,"erzTestWeight"),e.qZA(),e.TgZ(13,"div",8),e.TgZ(14,"span"),e._uU(15),e.ALo(16,"erzTestPoints"),e.qZA(),e.qZA(),e.TgZ(17,"div",9),e._uU(18),e.qZA(),e.YNc(19,j,3,3,"div",10),e.qZA()),2&s){const t=i.erzLet,n=e.MAs(9),a=e.oxw();e.xp6(2),e.hij(" ",t.Designation," "),e.xp6(2),e.hij(" ",e.xi3(5,8,t.Date,"dd.MM.yyyy")," "),e.xp6(3),e.Q6J("ngIf",a.isEditable)("ngIfElse",n),e.xp6(4),e.hij(" ",e.lcZ(12,11,t)," "),e.xp6(4),e.Oqu(e.Dn7(16,13,t,a.studentId,"dossier.points")),e.xp6(3),e.hij(" ",t.Owner," "),e.xp6(1),e.Q6J("ngIf",a.isEditable)}}let L=(()=>{class s{constructor(t){this.modalService=t,this.test$=new D.t(1),this.grading$=this.test$.pipe((0,p.U)(this.getGrading.bind(this)))}ngOnInit(){this.test$.next(this.test)}editGrading(t){const n=this.modalService.open($,{backdrop:"static"});n.componentInstance.test=t,n.componentInstance.gradeId=this.getGradeId(t),n.componentInstance.gradeOptions=s.mapToOptions(this.gradingScale),n.componentInstance.studentId=this.studentId,n.componentInstance.points=this.getPoints(t),n.result.then(a=>{a&&this.updateStudentGrade(a,t)},()=>{})}updateStudentGrade(t,n){const a=(0,g.Ps)(t,n);this.test$.next(a)}getGrading(t){var n,a;return(null===(a=null===(n=this.gradingScale)||void 0===n?void 0:n.Grades.find(c=>c.Id===this.getGradeId(t)))||void 0===a?void 0:a.Designation)||"-"}getGradeId(t){var n;return(null===(n=(0,g.W3)(this.studentId,t))||void 0===n?void 0:n.GradeId)||null}getPoints(t){var n;return(null===(n=(0,g.W3)(this.studentId,t))||void 0===n?void 0:n.Points)||null}static mapToOptions(t){return(null==t?void 0:t.Grades.map(n=>({Key:n.Id,Value:n.Designation})))||null}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(l.FF))},s.\u0275cmp=e.Xpm({type:s,selectors:[["erz-dossier-single-test"]],inputs:{test:"test",studentId:"studentId",gradingScale:"gradingScale",isEditable:"isEditable"},decls:2,vars:3,consts:[["class","test-entry",4,"erzLet"],[1,"test-entry"],["data-testid","test-designation",1,"designation"],["data-testid","test-date",1,"date"],[1,"grade"],["class","btn btn-link","aria-label","edit grade",3,"click",4,"ngIf","ngIfElse"],["notEditable",""],["data-testid","test-factor",1,"factor"],["data-testid","test-points",1,"points"],["data-testid","test-teacher",1,"teacher"],["class","state","data-testid","test-status",4,"ngIf"],["aria-label","edit grade",1,"btn","btn-link",3,"click"],[1,"material-icons"],["data-testid","test-grade"],["data-testid","test-status",1,"state"]],template:function(t,n){1&t&&(e.YNc(0,z,20,17,"div",0),e.ALo(1,"async")),2&t&&e.Q6J("erzLet",e.lcZ(1,1,n.test$))},directives:[F.e,o.O5],pipes:[o.Ov,o.uU,U.H,J.g,u.X$],styles:['.test-entry[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1.5rem;display:grid;grid-template-areas:"designation designation grade factor" "date date points ." "teacher teacher . ." "state state . .";grid-template-columns:repeat(4,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}.designation[_ngcontent-%COMP%]{grid-area:designation}.date[_ngcontent-%COMP%]{grid-area:date}.grade[_ngcontent-%COMP%]{grid-area:grade}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;color:#33333d;padding:0}.grade[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:-1em;color:#33333d80}.points[_ngcontent-%COMP%]{grid-area:points;color:#33333d80}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.state[_ngcontent-%COMP%]{grid-area:state}@media (max-width: 767.98px){.test-entry[_ngcontent-%COMP%]{grid-template-areas:"designation designation" "date grade" "factor points" "teacher teacher" "state state";grid-template-columns:repeat(2,1fr)}}']}),s})();function Y(s,i){if(1&s&&e._UZ(0,"erz-dossier-single-test",4),2&s){const t=i.$implicit,n=e.oxw(2);e.Q6J("test",t)("studentId",n.studentId)("gradingScale",n.getGradingScaleOfTest(t))("isEditable",n.isEditable)}}function Q(s,i){if(1&s&&(e.TgZ(0,"div"),e._UZ(1,"erz-dossier-grades-final-grade",2),e.YNc(2,Y,1,4,"erz-dossier-single-test",3),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("finalGrade",t.dossierGradeService.getFinalGradeForStudent(t.course,t.studentId))("grading",t.dossierGradeService.getGradingForStudent(t.course,t.studentId))("gradingScale",t.dossierGradeService.getGradingScaleOfCourse(t.course,t.gradingScales)),e.xp6(1),e.Q6J("ngForOf",t.sortedTests())}}function R(s,i){1&s&&(e.TgZ(0,"p",5),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&s&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"dossier.no-tests")," "))}let V=(()=>{class s{constructor(t){this.dossierGradeService=t}sortedTests(){return this.course.Tests?(0,g.df)(this.course.Tests):[]}getGradingScaleOfTest(t){return this.gradingScales.find(n=>n.Id===t.GradingScaleId)}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(v.S))},s.\u0275cmp=e.Xpm({type:s,selectors:[["erz-dossier-course-tests"]],inputs:{studentId:"studentId",course:"course",gradingScales:"gradingScales",isEditable:"isEditable"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["noTests",""],[3,"finalGrade","grading","gradingScale"],[3,"test","studentId","gradingScale","isEditable",4,"ngFor","ngForOf"],[3,"test","studentId","gradingScale","isEditable"],["data-testid","message-no-tests",1,"p-3"]],template:function(t,n){if(1&t&&(e.YNc(0,Q,3,4,"div",0),e.YNc(1,R,3,3,"ng-template",null,1,e.W1O)),2&t){const a=e.MAs(2);e.Q6J("ngIf",n.sortedTests().length>0)("ngIfElse",a)}},directives:[o.O5,A,o.sg,L],pipes:[u.X$],styles:[""]}),s})();function H(s,i){if(1&s){const t=e.EpF();e.TgZ(0,"erz-student-dossier-entry-header",7),e.NdJ("click",function(){e.CHM(t);const a=e.oxw().index;return e.MAs(2).toggle("course-"+a)}),e._UZ(1,"erz-dossier-grades-course-header",8),e.qZA()}if(2&s){const t=i.opened,n=e.oxw().$implicit,a=e.oxw(2);e.Q6J("opened",t),e.xp6(1),e.Q6J("designation",n.Designation)("finalGrade",a.dossierGradeService.getFinalGradeForStudent(n,a.studentId))("grading",a.dossierGradeService.getGradingForStudent(n,a.studentId))("gradingScale",a.dossierGradeService.getGradingScaleOfCourse(n,a.gradingScales))}}function X(s,i){if(1&s&&e._UZ(0,"erz-dossier-course-tests",9),2&s){const t=e.oxw().$implicit,n=e.oxw(2);e.Q6J("course",t)("studentId",n.studentId)("gradingScales",n.gradingScales)("isEditable",n.isEditable)}}function B(s,i){if(1&s&&(e.TgZ(0,"div"),e.TgZ(1,"ngb-accordion",null,3),e.TgZ(3,"ngb-panel",4),e.YNc(4,H,2,5,"ng-template",5),e.YNc(5,X,1,4,"ng-template",6),e.qZA(),e.qZA(),e.qZA()),2&s){const t=i.index;e.xp6(3),e.Q6J("id","course-"+t)}}function k(s,i){if(1&s&&(e.ynx(0),e.YNc(1,B,6,1,"div",2),e.BQk()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.courses)}}function W(s,i){1&s&&(e.TgZ(0,"p",10),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&s&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"dossier.no-courses")," "))}let K=(()=>{class s{constructor(t){this.dossierGradeService=t,this.isEditable=!0}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(v.S))},s.\u0275cmp=e.Xpm({type:s,selectors:[["erz-dossier-grades-view"]],inputs:{courses:"courses",studentId:"studentId",gradingScales:"gradingScales",isEditable:"isEditable"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["noCourses",""],[4,"ngFor","ngForOf"],["acc","ngbAccordion"],[3,"id"],["ngbPanelHeader",""],["ngbPanelContent",""],[3,"opened","click"],[3,"designation","finalGrade","grading","gradingScale"],[3,"course","studentId","gradingScales","isEditable"],["data-testid","message-no-courses",1,"p-3"]],template:function(t,n){if(1&t&&(e.YNc(0,k,2,1,"ng-container",0),e.YNc(1,W,3,3,"ng-template",null,1,e.W1O)),2&t){const a=e.MAs(2);e.Q6J("ngIf",(null==n.courses?null:n.courses.length)>0)("ngIfElse",a)}},directives:[o.O5,o.sg,l.gY,l.Gk,l.k9,C.H,S,l.gW,V],pipes:[u.X$],styles:[""]}),s})()}}]);