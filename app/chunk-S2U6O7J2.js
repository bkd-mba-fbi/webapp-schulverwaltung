import{b as Te}from"./chunk-KDAC4GJ5.js";import{b as xe}from"./chunk-Y4QYVF5K.js";import"./chunk-HII3S2DL.js";import{a as Se,c as Me}from"./chunk-SOHFFTKU.js";import{a as be}from"./chunk-UX5TA32W.js";import{$ as g,$a as _,$c as $,Ab as u,Bb as f,Bd as ve,Fd as Ce,G as z,Ga as h,Gd as E,Ha as T,Hb as oe,Hd as P,I as B,Ia as l,Id as _e,Ja as U,L,M as H,O as I,Q as N,Rb as O,Sa as p,Sb as w,T as A,Ta as a,Ua as b,V as Y,Vb as se,Vc as ae,W as J,Wc as le,Xc as pe,Z as V,_a as X,a as D,ad as ce,b as R,dd as de,e as K,ed as me,f as W,id as ue,jb as y,jd as fe,k as j,kb as S,lb as k,m as M,pb as Z,pc as re,qb as ee,qd as ge,ra as Q,rb as te,rd as G,sb as ie,sd as he,tb as v,ua as r,v as q,va as C,wb as ne,zd as ye}from"./chunk-XTHSYQMN.js";var ke=(()=>{let t=class t{constructor(){this.id=null,this.label=null,this.disabled=!1,this.value=!1,this.valueChange=new Q,this.fallbackId=ve("bkd-switch")}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=g({type:t,selectors:[["bkd-switch"]],inputs:{id:"id",label:"label",disabled:"disabled",value:"value"},outputs:{valueChange:"valueChange"},standalone:!0,features:[v],decls:3,vars:5,consts:[["type","checkbox",3,"ngModelChange","disabled","ngModel"]],template:function(n,o){if(n&1&&(p(0,"input",0),X("ngModelChange",function(m){return o.valueChange.emit(m)}),a(),p(1,"label"),y(2),a()),n&2){let c,m;l("disabled",o.disabled)("ngModel",o.value),T("id",(c=o.id)!==null&&c!==void 0?c:o.fallbackId),r(),T("for",(m=o.id)!==null&&m!==void 0?m:o.fallbackId),r(),S(o.label)}},dependencies:[G,pe,$,de],styles:['input[_ngcontent-%COMP%]{opacity:0;position:absolute}label[_ngcontent-%COMP%]{cursor:pointer;text-indent:-9999px;width:36px;height:18px;border:1px solid rgb(0,0,0);background:#fff;display:block;border-radius:18px;position:relative}label[_ngcontent-%COMP%]:after{content:"";position:absolute;top:1px;left:1px;width:14px;height:14px;background:#000;border-radius:14px;transition:.3s}input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{border-color:#000;background:#000}input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 1px);transform:translate(-100%);background:#fff}input[_ngcontent-%COMP%]:focus + label[_ngcontent-%COMP%]{box-shadow:0 0 0 .25rem #4e4e4e40}input[_ngcontent-%COMP%]:disabled + label[_ngcontent-%COMP%]{cursor:default;background:#fff;border-color:#dedede}input[_ngcontent-%COMP%]:disabled + label[_ngcontent-%COMP%]:after{background:#dedede}label[_ngcontent-%COMP%]:active:after{width:18.2px}'],changeDetection:0});let i=t;return i})();function Ee(i,t){if(i&1&&(p(0,"div"),y(1),a()),i&2){let s=t.$implicit;r(),k(" ",s," ")}}function Pe(i,t){if(i&1&&(p(0,"div",4),h(1,Ee,2,1,"div",5),a()),i&2){let s=_();r(),l("ngForOf",s.descriptionLines)}}var Fe=(()=>{let t=class t{constructor(e){this.cd=e,this.id="",this.label="",this.description=null,this.disabled=!1,this.onChange=n=>{},this.onTouched=()=>{},this._value=!1}get value(){return this._value}set value(e){this._value=e,this.onChange(e)}get descriptionLines(){return this.description?this.description.split(`
`):[]}writeValue(e){this._value=e}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled=e,this.cd.markForCheck()}};t.\u0275fac=function(n){return new(n||t)(C(oe))},t.\u0275cmp=g({type:t,selectors:[["bkd-my-settings-notifications-toggle"]],inputs:{id:"id",label:"label",description:"description",disabled:"disabled"},standalone:!0,features:[ie([{provide:le,useExisting:Y(()=>t),multi:!0}]),v],decls:5,vars:6,consts:[[1,"d-flex","align-items-center"],[1,"flex-fill"],[3,"valueChange","id","value","disabled"],["class","form-text",4,"ngIf"],[1,"form-text"],[4,"ngFor","ngForOf"]],template:function(n,o){n&1&&(p(0,"div",0)(1,"label",1),y(2),a(),p(3,"bkd-switch",2),te("valueChange",function(m){return ee(o.value,m)||(o.value=m),m}),a()(),h(4,Pe,2,1,"div",3)),n&2&&(r(),T("for",o.id),r(),k(" ",o.label," "),r(),l("id",o.id),Z("value",o.value),l("disabled",o.disabled),r(),l("ngIf",o.description))},dependencies:[ke,w,O],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0});let i=t;return i})();var Ie=(()=>{let t=class t{constructor(e,n){this.settings=e,this.storage=n,this.currentRoles=null}getNotificationTypes(){return this.getNotificationTypeKeys().map(e=>{if(!(e in this.settings.notificationTypes))throw new Error(`Key '${e}' is missing in 'notificationTypes' setting`);return{key:e,text:this.settings.notificationTypes[e]}})}getNotificationTypeKeys(){return ye(this.settings.notificationTypesAssignments.reduce((e,{roles:n,types:o})=>this.hasAnyRole(n)?[...e,...o]:e,[]))}hasAnyRole(e){return this.currentRoles===null&&(this.currentRoles=xe(this.storage.getPayload()?.roles)),this.currentRoles.some(n=>e.includes(n))}};t.\u0275fac=function(n){return new(n||t)(V(ae),V(_e))},t.\u0275prov=J({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();var je=(i,t)=>({channelsFormGroup:i,typesFormGroup:t});function Be(i,t){i&1&&(p(0,"div",6),b(1,"bkd-spinner",7),a())}function Le(i,t){if(i&1&&(b(0,"bkd-my-settings-notifications-toggle",10),u(1,"async"),u(2,"async")),i&2){let s=t.$implicit,e=t.index;U("mt-4",e>0),l("id","notification-channels-"+s.key)("label",f(1,6,s.label))("description",f(2,8,s.description))("formControlName",s.key)}}function Ae(i,t){if(i&1&&(p(0,"form",8),h(1,Le,3,10,"bkd-my-settings-notifications-toggle",9),a()),i&2){let s=_().bkdLet,e=_();l("formGroup",s.channelsFormGroup),r(),l("ngForOf",e.channelsSettings)}}function Ve(i,t){if(i&1&&(b(0,"bkd-my-settings-notifications-toggle",10),u(1,"async"),u(2,"async")),i&2){let s=t.$implicit,e=t.index;U("mt-4",e>0),l("id","notification-types-"+s.key)("label",f(1,6,s.label))("description",f(2,8,s.description))("formControlName",s.key)}}function Ue(i,t){if(i&1&&(p(0,"form",8),h(1,Ve,3,10,"bkd-my-settings-notifications-toggle",9),a()),i&2){let s=_().bkdLet,e=_();l("formGroup",s.typesFormGroup),r(),l("ngForOf",e.typesSettings)}}function Ke(i,t){if(i&1&&(p(0,"div",1)(1,"h2",2)(2,"span"),y(3),u(4,"translate"),a(),h(5,Be,2,0,"div",3),u(6,"async"),a(),h(7,Ae,2,2,"form",4),p(8,"p",5),y(9),u(10,"translate"),a(),b(11,"hr"),h(12,Ue,2,2,"form",4),a()),i&2){let s=t.bkdLet,e=_();r(3),S(f(4,5,"my-settings.notifications.title")),r(2),l("ngIf",f(6,7,e.saving$)),r(2),l("ngIf",s.channelsFormGroup),r(2),k(" ",f(10,9,"my-settings.notifications.privacy-hint")," "),r(3),l("ngIf",s.typesFormGroup)}}var Ne=(()=>{let t=class t{constructor(e,n,o,c,m){this.userSettings=e,this.formBuilder=n,this.toastService=o,this.translate=c,this.notificationTypes=m,this.channelsSettings=[{key:"gui",label:this.translate.get("my-settings.notifications.gui")},{key:"mail",label:this.translate.get("my-settings.notifications.mail")},{key:"phoneMobile",label:this.translate.get("my-settings.notifications.phoneMobile")}],this.typesSettings=this.notificationTypes.getNotificationTypes().map(d=>{let{label:x,description:$e}=this.translate.currentLang==="fr-CH"?d.text.fr:d.text.de;return{key:d.key,label:j(x),description:j($e)}}),this.channelsValue$=this.userSettings.getNotificationChannels(),this.typesValue$=this.userSettings.getNotificationTypesInactive().pipe(M(this.typesArrayToRecord.bind(this))),this.channelsFormGroup$=this.channelsValue$.pipe(M(d=>this.createFormGroup(this.channelsSettings,d)),L(1)),this.allChannelsInactive$=q(this.channelsValue$,this.channelsFormGroup$.pipe(I(d=>d.valueChanges))).pipe(M(d=>Object.values(d).every(x=>!x)),z()),this.typesFormGroup$=this.typesValue$.pipe(A(this.allChannelsInactive$),M(([d,x])=>this.createFormGroup(this.typesSettings,d,!0,x)),L(1)),this.saving$=new W(!1),this.destroy$=new K}ngOnInit(){this.userSettings.refetch(),this.allChannelsInactive$.pipe(H(1),A(this.typesFormGroup$),N(this.destroy$)).subscribe(([e,n])=>{Object.values(n.controls).forEach(o=>e?o.disable():o.enable())}),this.channelsFormGroup$.pipe(N(this.destroy$),I(e=>e.valueChanges)).subscribe(this.saveChannels.bind(this)),this.typesFormGroup$.pipe(N(this.destroy$),I(e=>e.valueChanges)).subscribe(this.saveTypes.bind(this))}ngOnDestroy(){this.destroy$.next()}createFormGroup(e,n,o=!1,c=!1){return this.formBuilder.group(e.reduce((m,{key:d})=>R(D({},m),{[d]:[{value:n[d]??o,disabled:c}]}),{}))}saveChannels(e){this.saving$.next(!0),this.userSettings.saveNotificationChannels(e).pipe(B(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}saveTypes(e){this.saving$.next(!0),this.userSettings.saveNotificationTypesInactive(this.typesRecordToArray(e)).pipe(B(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("my-settings.notifications.save-success"))}typesArrayToRecord(e){return this.typesSettings.reduce((o,{key:c})=>R(D({},o),{[c]:!e.includes(c)}),{})}typesRecordToArray(e){return Object.keys(e).reduce((o,c)=>e[c]?o:[...o,c],[])}};t.\u0275fac=function(n){return new(n||t)(C(Te),C(ge),C(be),C(Ce),C(Ie))},t.\u0275cmp=g({type:t,selectors:[["bkd-my-settings-notifications"]],standalone:!0,features:[v],decls:3,vars:8,consts:[["class","pb-4",4,"bkdLet"],[1,"pb-4"],[1,"m-0","pb-3","d-flex","align-items-stretch"],["class","position-relative",4,"ngIf"],[3,"formGroup",4,"ngIf"],[1,"mt-4","form-text"],[1,"position-relative"],[1,"position-absolute","inline","small","d-inline-block","ms-2"],[3,"formGroup"],[3,"id","label","description","formControlName","mt-4",4,"ngFor","ngForOf"],[3,"id","label","description","formControlName"]],template:function(n,o){n&1&&(h(0,Ke,13,11,"div",0),u(1,"async"),u(2,"async")),n&2&&l("bkdLet",ne(5,je,f(1,1,o.channelsFormGroup$),f(2,3,o.typesFormGroup$)))},dependencies:[Se,w,Me,G,me,$,ce,he,ue,fe,O,Fe,se,P,E],styles:[".checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important}"],changeDetection:0});let i=t;return i})();var Oe=(()=>{let t=class t{};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=g({type:t,selectors:[["bkd-my-settings-show"]],standalone:!0,features:[v],decls:5,vars:3,consts:[[1,"bkd-container","bkd-container-limited"]],template:function(n,o){n&1&&(p(0,"div",0)(1,"h1"),y(2),u(3,"translate"),a(),b(4,"bkd-my-settings-notifications"),a()),n&2&&(r(2),S(f(3,1,"my-settings.title")))},dependencies:[Ne,P,E]});let i=t;return i})();var we=(()=>{let t=class t{constructor(){}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=g({type:t,selectors:[["bkd-my-settings"]],standalone:!0,features:[v],decls:1,vars:0,template:function(n,o){n&1&&b(0,"router-outlet")},dependencies:[re],changeDetection:0});let i=t;return i})();var Ot=[{path:"",component:we,children:[{path:"",component:Oe}]}];export{Ot as MY_SETTINGS_ROUTES};
