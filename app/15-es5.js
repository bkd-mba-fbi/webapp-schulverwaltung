!function(){function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var i,s,r=[],c=!0,o=!1;try{for(n=n.call(e);!(c=(i=n.next()).done)&&(r.push(i.value),!t||r.length!==t);c=!0);}catch(a){o=!0,s=a}finally{try{c||null==n.return||n.return()}finally{if(o)throw s}}return r}(e,t)||n(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,i=d(e);if(t){var s=d(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return l(this,n)}}function l(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"2TIA":function(i,r,a){"use strict";a.r(r),a.d(r,"PresenceControlModule",function(){return yn});var l,d=a("PCNd"),p=a("tyNb"),b=a("XNiG"),f=a("1G5W"),g=a("G6Tw"),h=a("jIYg"),v=a("sWYD"),m=a("Muja"),y=a("BeL+"),O=a("2Vo4"),S=a("VRyK"),P=a("itXk"),w=a("PqYM"),C=a("/uUt"),k=a("eIep"),j=a("UXun"),M=a("lJxs"),I=a("JX91"),$=a("IzEk"),D=a("xbPD"),R=a("bHdf"),L=a("pLZG"),T=a("Xr/R"),_=a("kZPp"),x=a("PYvG"),z=a("t0ae"),E=a("AEFh"),F=a("AcjI"),A=a("v6cN"),U=a("CCnw"),B=a("mbak"),G=a("LuCL"),V=a("fXoL"),Z=a("tk/3"),N=((l=function(e){o(n,e);var t=u(n);function n(e,i){return s(this,n),t.call(this,e,i,G.a,"LessonTeachers")}return c(n,[{key:"loadOtherTeachersLessonAbsences",value:function(e,t,n){var i="".concat(this.baseUrl,"/except/").concat(e,"/LessonAbsences?expand=LessonRef");return t&&t.length>0&&(i=i.concat("&filter.StudentRef=;"+t.join(";"))),this.http.get(i,{params:n}).pipe(Object(k.a)(Object(z.b)(G.a)))}}]),n}(B.a)).\u0275fac=function(e){return new(e||l)(V.Zb(Z.b),V.Zb(T.a))},l.\u0275prov=V.Ib({token:l,factory:l.\u0275fac,providedIn:"root"}),l),H=a("CqUA"),K=a("xHFS"),q=a("KJh6"),J=a("eB9A"),Q=a("2jKe"),X=a("BzUC");function W(e,t){return null===e&&null===t||null!==e&&null!==t&&e.TeacherInformation===t.TeacherInformation&&e.LessonDateTimeFrom.getTime()===t.LessonDateTimeFrom.getTime()&&e.LessonDateTimeTo.getTime()===t.LessonDateTimeTo.getTime()}var Y=function(){function e(t,n,i){s(this,e),this.TeacherInformation=t,this.LessonDateTimeFrom=n,this.LessonDateTimeTo=i,this.lessons=[]}return c(e,[{key:"addLesson",value:function(e){this.lessons.some(function(t){return Object(X.d)(t,e)})||(this.lessons.push(e),this.updateId(),this.updateStudyClassNumbers(),this.updateEventDesignations())}},{key:"getIds",value:function(){return t(new Set(this.lessons.map(function(e){return e.LessonRef.Id})))}},{key:"getEventIds",value:function(){return t(new Set(this.lessons.map(function(e){return e.EventRef.Id})))}},{key:"updateId",value:function(){this.id=t(new Set(this.lessons.map(function(e){return e.LessonRef.Id}).sort())).join("-")}},{key:"updateStudyClassNumbers",value:function(){this.studyClassNumbers=t(new Set(this.lessons.map(function(e){return e.StudyClassNumber}).sort(function(e,t){return e.localeCompare(t)}))).join(", ")}},{key:"updateEventDesignations",value:function(){this.eventDesignations=t(new Set(this.lessons.map(function(e){return e.EventDesignation}).sort())).join(", ")}}]),e}(),ee=a("/Tr7");function te(e,t){Object(h.a)(2,arguments);var n=Object(ee.a)(e),i=Object(ee.a)(t);return n.getTime()<i.getTime()}function ne(e,t){Object(h.a)(2,arguments);var n=Object(ee.a)(e).getTime(),i=Object(ee.a)(t.start).getTime(),s=Object(ee.a)(t.end).getTime();if(!(i<=s))throw new RangeError("Invalid interval");return n>=i&&n<=s}function ie(e){return function(e){return e.reduce(function(e,n){return e.some(function(e){return Object(X.d)(e,n)})?e:[].concat(t(e),[n])},[])}(e).reduce(function(e,n,i){var s=e.find(function(e){return W(e,n)});if(s)return s.addLesson(Object(X.a)(n)),e;var r,c,o=(r=Object(X.a)(n),(c=new Y(r.TeacherInformation,r.LessonDateTimeFrom,r.LessonDateTimeTo)).addLesson(r),c);return[].concat(t(e),[o])},[]).sort(X.c)}function se(e){if(0===e.length)return null;var i=new Date;if(e=t(e).sort(X.c),Object(g.a)(i,e[0].LessonDateTimeFrom)){var s,r=function(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=n(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var s=0,r=function(){};return{s:r,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,o=!0,a=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){a=!0,c=e},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw c}}}}(e);try{for(r.s();!(s=r.n()).done;){var c=s.value;if(te(i,c.LessonDateTimeFrom)||ne(i,{start:c.LessonDateTimeFrom,end:c.LessonDateTimeTo}))return c}}catch(o){r.e(o)}finally{r.f()}return e[e.length-1]}return e[0]}var re=a("vlqf");function ce(e){return function(t){return t.reduce(function(t,n){return t+(n.presenceCategory===e?1:0)},0)}}var oe=a("jtHE"),ae=a("cp0P");function ue(e,n){return t(e).sort(function(e){return function(t,n){switch(e.primarySortKey){case"name":var i=t.name.localeCompare(n.name);return e.ascending?-1*i:i;case"group":var s=(t.detail.Value||"").localeCompare(n.detail.Value||"");return e.ascending?-1*s:s}}}(n))}function le(e,t){return e.map(function(e){return function(e,t){var n;return{id:e.IdPerson,name:(null===(n=t.find(function(t){return t.StudentRef.Id===e.IdPerson}))||void 0===n?void 0:n.StudentFullName)||"",group:e.Value,detail:e}}(e,t)})}function de(e,t){return e.find(function(e){return e.VssId===t.subscriptionDetailGroupId})}var pe,be,fe,ge,he,ve=a("j+Kt"),me=a("KVDH"),ye=ve.p({Key:ve.n,Value:ve.n}),Oe=ve.p({Id:ve.n,SubscriptionId:ve.k,VssId:ve.k,EventId:ve.k,DropdownItems:Object(me.d)(ve.b(ye)),IdPerson:ve.k,ShowAsRadioButtons:ve.c,Value:Object(me.d)(ve.n)}),Se=((be=function(e){o(n,e);var t=u(n);function n(e,i){return s(this,n),t.call(this,e,i,Oe,"Events")}return c(n,[{key:"getSubscriptionDetails",value:function(e){return this.http.get("".concat(this.baseUrl,"/").concat(e,"/SubscriptionDetails")).pipe(Object(k.a)(Object(z.b)(this.codec)))}}]),n}(B.a)).\u0275fac=function(e){return new(e||be)(V.Zb(Z.b),V.Zb(T.a))},be.\u0275prov=V.Ib({token:be,factory:be.\u0275fac,providedIn:"root"}),be),Pe=((pe=function(e){o(n,e);var t=u(n);function n(e,i){return s(this,n),t.call(this,e,i,Oe,"Subscriptions")}return c(n,[{key:"getListByRegistrationId",value:function(e){return this.http.get("".concat(this.baseUrl,"/").concat(e,"/SubscriptionDetails")).pipe(Object(k.a)(Object(z.b)(this.codec)))}}]),n}(B.a)).\u0275fac=function(e){return new(e||pe)(V.Zb(Z.b),V.Zb(T.a))},pe.\u0275prov=V.Ib({token:pe,factory:pe.\u0275fac,providedIn:"root"}),pe),we=a("xWuZ"),Ce=((fe=function(){function t(n,i,r,c,o){var a=this;s(this,t),this.settingsService=n,this.eventService=i,this.subscriptionService=r,this.loadingService=c,this.settings=o,this.selectGroup$=new b.a,this.selectedLesson$=new oe.a,this.lessonPresences$=new oe.a,this.reloadSubscriptionDetails$=new b.a,this.defaultGroup=null,this.savedGroupViews$=this.loadSavedGroupViews(),this.savedGroup$=this.selectedLesson$.pipe(Object(k.a)(function(e){return a.savedGroupViews$.pipe(Object(M.a)(function(t){return a.findGroupByLesson(t,e)}))})),this.group$=Object(S.a)(this.selectGroup$,this.savedGroup$).pipe(Object(I.a)(this.defaultGroup),Object(j.a)(1)),this.subscriptionsDetailsByEvents$=this.selectedLesson$.pipe(Object(M.a)(function(e){return(null==e?void 0:e.getEventIds())||[]}),Object(k.a)(function(e){return Object(ae.a)(e.map(function(e){return a.eventService.getSubscriptionDetails(e)}))}),Object(j.a)(1)),this.groupsAvailability$=this.subscriptionsDetailsByEvents$.pipe(Object(M.a)(function(e){return e.every(function(e){return de(e,a.settings)})}),Object(j.a)(1)),this.selectedLessonRegistrationIds$=Object(P.a)([this.selectedLesson$,this.lessonPresences$]).pipe(Object(M.a)(function(t){var n=e(t,2),i=n[0];return n[1].filter(function(e){return null==i?void 0:i.getIds().includes(e.LessonRef.Id)})}),Object(M.a)(function(e){return e.map(function(e){return e.RegistrationRef.Id}).filter(function(e){return e})})),this.subscriptionsDetailsByRegistrations$=Object(P.a)([this.selectedLessonRegistrationIds$,this.groupsAvailability$,this.reloadSubscriptionDetails$.pipe(Object(I.a)(void 0))]).pipe(Object(k.a)(function(t){var n=e(t,2),i=n[0],s=n[1];return Object(ae.a)(i.map(function(e){return s?a.loadSubscriptionDetails(e):[]}))})),this.subscriptionDetails$=this.subscriptionsDetailsByRegistrations$.pipe(Object(M.a)(we.a),Object(M.a)(function(e){return function(e,t){return e.filter(function(e){return e.VssId===t.subscriptionDetailGroupId})}(e,a.settings)}),Object(j.a)(1)),this.subscriptionDetailPersonIds$=Object(P.a)([this.group$,this.subscriptionDetails$]).pipe(Object(M.a)(function(t){var n=e(t,2),i=n[0];return n[1].filter(function(e){return e.Value===i}).map(function(e){return e.IdPerson})}),Object(I.a)([]))}return c(t,[{key:"selectGroup",value:function(e){this.selectGroup$.next(e)}},{key:"setSelectedLesson",value:function(e){this.selectedLesson$.next(e)}},{key:"setLessonPresences",value:function(e){this.lessonPresences$.next(e)}},{key:"getSubscriptionDetailForGroupEvent",value:function(){var e=this;return this.subscriptionsDetailsByEvents$.pipe(Object(M.a)(we.a),Object(M.a)(function(t){return de(t,e.settings)}))}},{key:"getSubscriptionDetailsForStudents",value:function(){return Object(P.a)([this.subscriptionDetails$,this.lessonPresences$]).pipe(Object(M.a)(Object(J.a)(le)))}},{key:"reloadSubscriptionDetails",value:function(){this.reloadSubscriptionDetails$.next(void 0)}},{key:"loadSubscriptionDetails",value:function(e){return this.loadingService.load(this.subscriptionService.getListByRegistrationId(e))}},{key:"loadSavedGroupViews",value:function(){return this.settingsService.getUserSettingsCst().pipe(Object(M.a)(function(e){return e.Settings}),Object(R.a)(),Object(L.a)(function(e){return"presenceControlGroupView"===e.Key}),Object(M.a)(function(e){return JSON.parse(e.Value)}),Object(k.a)(Object(z.b)(_.a)),Object(D.a)([]))}},{key:"findGroupByLesson",value:function(e,t){var n=e.find(function(e){return e.eventId===(null==t?void 0:t.getEventIds()[0])});return(null==n?void 0:n.group)||this.defaultGroup}}]),t}()).\u0275fac=function(e){return new(e||fe)(V.Zb(x.a),V.Zb(Se),V.Zb(Pe),V.Zb(H.a),V.Zb(T.a))},fe.\u0275prov=V.Ib({token:fe,factory:fe.\u0275fac}),fe),ke=a("ofXK"),je=function(e){return e.Grid="grid",e.List="list",e}({}),Me=Object.keys(je).map(function(e){return je[e]}),Ie=((ge=function(){function t(n,i,r,c,o,a,u,l,d,p){var g=this;s(this,t),this.settingsService=n,this.lessonPresencesService=i,this.lessonTeacherService=r,this.presenceTypesService=c,this.personsService=o,this.groupService=a,this.dropDownItemsService=u,this.loadingService=l,this.settings=d,this.location=p,this.selectedDateSubject$=new O.a(new Date),this.selectLesson$=new b.a,this.viewModeSubject$=new b.a,this.updateLessonPresences$=new b.a,this.lessonPresences$=Object(S.a)(this.selectedDateSubject$.pipe(Object(C.a)(m.a),Object(k.a)(this.loadLessonPresencesByDate.bind(this))),this.updateLessonPresences$).pipe(Object(j.a)(1)),this.presenceTypes$=this.loadPresenceTypes().pipe(Object(j.a)(1)),this.lessons$=this.lessonPresences$.pipe(Object(M.a)(ie),Object(j.a)(1)),this.currentLesson$=this.lessons$.pipe(Object(M.a)(se),Object(C.a)(W)),this.studentIdsWithUnconfirmedAbsences$=this.selectedDateSubject$.pipe(Object(k.a)(function(){return g.loadStudentIdsWithUnconfirmedAbsences()}),Object(j.a)(1)),this.loading$=this.loadingService.loading$,this.selectedLesson$=Object(S.a)(this.currentLesson$,this.selectLesson$).pipe(Object(j.a)(1)),this.absenceConfirmationStates$=this.dropDownItemsService.getAbsenceConfirmationStates().pipe(Object(j.a)(1)),this.selectedLessonStudentIds$=Object(P.a)([this.selectLesson$,this.lessonPresences$]).pipe(Object(M.a)(function(t){var n=e(t,2),i=n[0];return n[1].filter(function(e){return e.LessonRef.Id===Number(null==i?void 0:i.id)})}),Object(M.a)(function(e){return e.map(function(e){return e.StudentRef.Id})}),Object(j.a)(1)),this.otherTeachersAbsences$=Object(P.a)([this.personsService.getMyself(),this.selectedLessonStudentIds$.pipe(Object(I.a)([]))]).pipe(Object(k.a)(function(t){var n=e(t,2),i=n[0],s=n[1];return g.lessonTeacherService.loadOtherTeachersLessonAbsences(i.Id,s)}),Object(j.a)(1)),this.groupsAvailability$=this.groupService.groupsAvailability$,this.selectedPresenceControlEntries$=Object(P.a)([this.selectedLesson$,this.lessonPresences$,this.presenceTypes$,this.absenceConfirmationStates$,this.otherTeachersAbsences$]).pipe(Object(M.a)(Object(J.a)(X.b))),this.selectedPresenceControlEntriesByGroup$=Object(P.a)([this.groupService.group$,this.selectedPresenceControlEntries$,this.groupService.subscriptionDetailPersonIds$]).pipe(Object(M.a)(Object(J.a)(Q.b)),Object(j.a)(1)),this.presentCount$=this.selectedPresenceControlEntriesByGroup$.pipe(Object(M.a)(ce("present"))),this.absentCount$=this.selectedPresenceControlEntriesByGroup$.pipe(Object(M.a)(ce("absent"))),this.unapprovedCount$=this.selectedPresenceControlEntriesByGroup$.pipe(Object(M.a)(ce("unapproved"))),this.absentPrecedingCount$=this.selectedPresenceControlEntriesByGroup$.pipe(Object(M.a)(function(e){return e.reduce(function(e,t){return e+(t.precedingAbsences&&t.precedingAbsences.length>0?1:0)},0)})),this.viewMode$=Object(S.a)(this.viewModeSubject$,this.getSavedViewMode().pipe(Object($.a)(1),Object(D.a)(je.Grid))),this.selectedDate$=this.selectedDateSubject$.asObservable(),this.queryParamsString$=Object(P.a)([this.selectedDate$,this.selectedLesson$,this.viewMode$]).pipe(Object(M.a)(Object(J.a)(this.buildQueryParams.bind(this))),Object(M.a)(E.c)),this.destroy$=new b.a,this.queryParamsString$.pipe(Object(f.a)(this.destroy$)).subscribe(function(e){g.location.replaceState("/presence-control",e),g.confirmBackLinkParams={returnparams:e}}),this.viewModeSubject$.pipe(Object(f.a)(this.destroy$),Object(C.a)(),Object(k.a)(function(e){return g.updateSavedViewMode(e)})).subscribe(),this.selectedLesson$.pipe(Object(f.a)(this.destroy$)).subscribe(function(e){return g.groupService.setSelectedLesson(e)}),this.lessonPresences$.pipe(Object(f.a)(this.destroy$)).subscribe(function(e){return g.groupService.setLessonPresences(e)})}return c(t,[{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"setDate",value:function(e){this.selectedDateSubject$.next(e)}},{key:"setLesson",value:function(e){this.selectLesson$.next(e)}},{key:"setViewMode",value:function(e){this.viewModeSubject$.next(e)}},{key:"updateLessonPresencesTypes",value:function(t){var n=this;Object(P.a)([this.lessonPresences$.pipe(Object($.a)(1)),this.presenceTypes$.pipe(Object($.a)(1))]).pipe(Object(M.a)(function(i){var s=e(i,2),r=s[0],c=s[1];return function(e,t,n,i){return e.map(function(e){var s,r,c=t.find(function(t){return(n=t.presence).LessonRef.Id===(i=e).LessonRef.Id&&n.StudentRef.Id===i.StudentRef.Id;var n,i});return c?(s=!c.newPresenceTypeId&&e.Comment?n.find(function(e){return e.IsComment})||null:n.find(function(e){return e.Id===c.newPresenceTypeId})||null,Object.assign(Object.assign({},e),{TypeRef:(r=s,{Id:r?r.Id:null,HRef:null}),Date:null,Type:s?s.Designation:null,ConfirmationStateId:Object(re.b)(s,i)})):e})}(r,t,c,n.settings)})).subscribe(function(e){return n.updateLessonPresences$.next(e)})}},{key:"getNextPresenceType",value:function(e){return this.presenceTypes$.pipe(Object($.a)(1),Object(M.a)(function(t){return e.getNextPresenceType(t)}))}},{key:"hasUnconfirmedAbsences",value:function(e){return this.studentIdsWithUnconfirmedAbsences$.pipe(Object(M.a)(function(t){return t.includes(e.lessonPresence.StudentRef.Id)}))}},{key:"getBlockLessonPresences",value:function(t){var n=this;return Object(P.a)([this.lessonPresences$.pipe(Object($.a)(1)),this.presenceTypes$.pipe(Object($.a)(1))]).pipe(Object(M.a)(function(i){var s=e(i,2),r=s[0],c=s[1];return r.filter(function(e){return e.TeacherInformation===t.lessonPresence.TeacherInformation&&e.StudentRef.Id===t.lessonPresence.StudentRef.Id&&Object(re.a)(e,c.find(function(t){return t.Id===e.TypeRef.Id})||null,n.settings)}).sort(function(e,t){return e.LessonDateTimeFrom>t.LessonDateTimeFrom?1:-1}).reduce(function(e,i){return n.isPartOfBlock(i,e[e.length-1])?(e.push(i),e):e.find(function(e){return e.Id===t.lessonPresence.Id})?e:[i]},[])}))}},{key:"isPartOfBlock",value:function(e,t){return!t||e.LessonDateTimeFrom.getTime()-t.LessonDateTimeTo.getTime()<=18e5}},{key:"loadLessonPresencesByDate",value:function(e){return this.loadingService.load(function(e){return Object(h.a)(1,arguments),Object(g.a)(e,Date.now())}(e)?this.lessonPresencesService.getListForToday():this.lessonPresencesService.getListByDate(e))}},{key:"loadPresenceTypes",value:function(){return this.loadingService.load(this.presenceTypesService.presenceTypes$)}},{key:"loadStudentIdsWithUnconfirmedAbsences",value:function(){var e=this;return Object(w.a)(0,this.settings.unconfirmedAbsencesRefreshTime||void 0).pipe(Object(k.a)(function(){return e.lessonPresencesService.getListOfUnconfirmed()}),Object(M.a)(function(e){return Object(y.a)(e.map(function(e){return e.StudentRef.Id}))}))}},{key:"buildQueryParams",value:function(e,t,n){var i={date:Object(v.a)(e,"yyyy-MM-dd"),viewMode:n};return t&&(i.lesson=String(t.id)),i}},{key:"getSavedViewMode",value:function(){var e=this;return this.settingsService.getUserSettingsCst().pipe(Object(M.a)(function(e){return e.Settings}),Object(R.a)(),Object(L.a)(function(e){return"presenceControlViewMode"===e.Key}),Object($.a)(1),Object(M.a)(function(e){return JSON.parse(e.Value)}),Object(k.a)(Object(z.a)(_.e)),Object(M.a)(function(t){return e.getViewModeForString(t.presenceControl)}),Object(j.a)())}},{key:"getViewModeForString",value:function(e){return e===je.List?je.List:je.Grid}},{key:"updateSavedViewMode",value:function(e){var t={Key:"presenceControlViewMode",Value:JSON.stringify({presenceControl:e})},n=Object.assign({},Object(F.a)());return n.Settings.push(t),this.settingsService.updateUserSettingsCst(n)}}]),t}()).\u0275fac=function(e){return new(e||ge)(V.Zb(x.a),V.Zb(U.a),V.Zb(N),V.Zb(q.a),V.Zb(K.a),V.Zb(Ce),V.Zb(A.a),V.Zb(H.a),V.Zb(T.a),V.Zb(ke.i))},ge.\u0275prov=V.Ib({token:ge,factory:ge.\u0275fac}),ge),$e=a("LRne"),De=a("Kqap"),Re=a("w1tV"),Le=a("Kj3r"),Te=a("bOdf"),_e=a("CqXF"),xe=a("JIr8"),ze=a("PduT"),Ee=a("8teX"),Fe=a("K+0v"),Ae=a("LpL1"),Ue=a("5eHb"),Be=a("sYmb"),Ge=function(e){return e.AddUpdateAction="ADD",e.RemoveUpdateAction="REMOVE",e}({}),Ve=((he=function(){function e(t,n,i,r,c){s(this,e),this.toastr=t,this.translate=n,this.restService=i,this.presenceTypesService=r,this.settings=c,this.destroy$=new b.a,this.action$=new b.a,this.pendingUpdates$=this.action$.pipe(Object(De.a)(this.reduceUpdates.bind(this),[]),Object(Re.a)()),this.revertUpdates$=new b.a,this.performUpdates$=this.pendingUpdates$.pipe(Object(Le.a)(3e3),Object(L.a)(Object(Fe.d)(Ee.b)),Object(Te.a)(this.performUpdates.bind(this))),this.stateUpdates$=Object(S.a)(this.pendingUpdates$,this.revertUpdates$).pipe(Object(Le.a)(20),Object(L.a)(Object(Fe.d)(Ee.b))),this.performUpdates$.pipe(Object(f.a)(this.destroy$)).subscribe()}return c(e,[{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"updatePresenceTypes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.forEach(function(e){return t.dispatchAddUpdate(e,n)})}},{key:"performUpdates",value:function(e){var t=this,n=this.groupUpdates(e);return Object(P.a)(Object.keys(n).reduce(function(e,i){var s=n[i];return Object.keys(s).forEach(function(n){e.push(t.performUpdateForGroup(s[n]))}),e},[])).pipe(Object(_e.a)(n))}},{key:"performUpdateForGroup",value:function(e){var t=this;return e.forEach(function(e){return t.dispatchRemoveUpdate(e.presence)}),this.performLessonPresencesUpdatesByIds(e[0].presence.LessonRef.Id,e.map(function(e){return e.presence.StudentRef.Id}),e[0].newPresenceTypeId).pipe(Object(xe.a)(function(n){return t.revertUpdatesAfterError(e,n)}))}},{key:"performLessonPresencesUpdatesByIds",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return i?(i?this.presenceTypesService.getPresenceType(i):Object($e.a)(null)).pipe(Object(k.a)(function(i){return n.restService.editLessonPresences([e],t,null==i?void 0:i.Id,Object(re.b)(i,n.settings)||void 0,Object(ze.b)({disableErrorHandling:!0}))})):this.restService.removeLessonPresences([e],t,Object(ze.b)({disableErrorHandling:!0}))}},{key:"revertUpdatesAfterError",value:function(e,t){return console.error("Bulk-update of lesson presences failed"),console.error(t),this.toastr.error(this.translate.instant("shared.lesson-presences-update.error")),this.revertUpdates$.next(e.map(function(e){return Object.assign(Object.assign({},e),{newPresenceTypeId:e.presence.TypeRef.Id})})),Object($e.a)(void 0)}},{key:"groupUpdates",value:function(e){return e.reduce(function(e,t){var n=String(t.newPresenceTypeId&&t.newPresenceTypeId);return e[n]||(e[n]={}),Array.isArray(e[n][t.presence.LessonRef.Id])||(e[n][t.presence.LessonRef.Id]=[]),e[n][t.presence.LessonRef.Id].push(t),e},{})}},{key:"reduceUpdates",value:function(e,n){switch(n.type){case Ge.AddUpdateAction:var i=n.payload,s=i.presence,r=i.newPresenceTypeId,c=e.findIndex(Ze(s));return-1===c?[].concat(t(e),[{presence:s,newPresenceTypeId:r}]):[].concat(t(e.slice(0,c)),[{presence:e[c].presence,newPresenceTypeId:r}],t(e.slice(c+1)));case Ge.RemoveUpdateAction:return e.filter(Object(Fe.d)(Ze(n.payload)));default:return e}}},{key:"dispatchAddUpdate",value:function(e,t){this.action$.next({type:Ge.AddUpdateAction,payload:{presence:e,newPresenceTypeId:t}})}},{key:"dispatchRemoveUpdate",value:function(e){this.action$.next({type:Ge.RemoveUpdateAction,payload:e})}}]),e}()).\u0275fac=function(e){return new(e||he)(V.Zb(Ue.b),V.Zb(Be.d),V.Zb(Ae.a),V.Zb(q.a),V.Zb(T.a))},he.\u0275prov=V.Ib({token:he,factory:he.\u0275fac,providedIn:"root"}),he);function Ze(e){return function(t){return t.presence.LessonRef.Id===e.LessonRef.Id&&t.presence.StudentRef.Id===e.StudentRef.Id}}var Ne,He=a("qUtt"),Ke=a("0HM3"),qe=((Ne=function(){function e(t,n){s(this,e),this.state=t,this.lessonPresencesUpdateService=n,this.destroy$=new b.a}return c(e,[{key:"ngOnInit",value:function(){var e=this;this.lessonPresencesUpdateService.stateUpdates$.pipe(Object(f.a)(this.destroy$)).subscribe(function(t){return e.state.updateLessonPresencesTypes(t)})}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}}]),e}()).\u0275fac=function(e){return new(e||Ne)(V.Mb(Ie),V.Mb(Ve))},Ne.\u0275cmp=V.Gb({type:Ne,selectors:[["erz-presence-control"]],features:[V.yb([Ie,Ce,{provide:He.a,useExisting:Ie},{provide:Ke.a,useValue:"/presence-control"}])],decls:1,vars:0,template:function(e,t){1&e&&V.Nb(0,"router-outlet")},directives:[p.k],styles:[""],changeDetection:0}),Ne),Je=a("jiSq"),Qe=(a("RYjX"),a("1kSV")),Xe=a("3Pt+");function We(e,t){if(1&e&&(V.Sb(0,"div",5),V.Sb(1,"input",6),V.dc("change",function(){var e=t.$implicit;return e.selected=!e.selected}),V.Rb(),V.Sb(2,"label",7),V.Dc(3),V.gc(4,"date"),V.gc(5,"date"),V.Rb(),V.Rb()),2&e){var n=t.$implicit,i=t.index,s=V.fc();V.zb(1),V.nc("id","lesson-presence-",i,""),V.lc("checked",n.selected),V.zb(1),V.Eb("font-weight-bold",n.lessonPresence.LessonDateTimeFrom===s.entry.lessonPresence.LessonDateTimeFrom),V.nc("for","lesson-presence-",i,""),V.zb(1),V.Hc(" ",V.ic(4,8,n.lessonPresence.LessonDateTimeFrom,"HH:mm"),"\u2013",V.ic(5,11,n.lessonPresence.LessonDateTimeTo,"HH:mm")," ",n.lessonPresence.EventDesignation,"")}}var Ye,et=((Ye=function(){function e(t){s(this,e),this.activeModal=t,this.lessonPresenceOptions=[]}return c(e,[{key:"ngOnInit",value:function(){var e=this;this.lessonPresenceOptions=this.blockLessonPresences.map(function(t){return e.createLessonPresenceOption(t)})}},{key:"getSelectedLessonPresences",value:function(){return this.lessonPresenceOptions.filter(function(e){return e.selected}).map(function(e){return e.lessonPresence})}},{key:"createLessonPresenceOption",value:function(e){return{lessonPresence:e,selected:!0}}}]),e}()).\u0275fac=function(e){return new(e||Ye)(V.Mb(Qe.b))},Ye.\u0275cmp=V.Gb({type:Ye,selectors:[["erz-presence-control-block-lesson-component"]],inputs:{entry:"entry",blockLessonPresences:"blockLessonPresences"},decls:13,vars:11,consts:[[1,"modal-body"],["class","form-group form-check",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"form-group","form-check"],["type","checkbox",1,"form-check-input",3,"id","checked","change"],[1,"form-check-label","d-block","text-truncate",3,"for"]],template:function(e,t){1&e&&(V.Sb(0,"div",0),V.Sb(1,"p"),V.Dc(2),V.gc(3,"translate"),V.Rb(),V.Sb(4,"form"),V.Bc(5,We,6,14,"div",1),V.Rb(),V.Rb(),V.Sb(6,"div",2),V.Sb(7,"button",3),V.dc("click",function(){return t.activeModal.close()}),V.Dc(8),V.gc(9,"translate"),V.Rb(),V.Sb(10,"button",4),V.dc("click",function(){return t.activeModal.close(t.getSelectedLessonPresences())}),V.Dc(11),V.gc(12,"translate"),V.Rb(),V.Rb()),2&e&&(V.zb(2),V.Fc(" ",V.hc(3,5,"presence-control.block-lesson.text")," "),V.zb(3),V.lc("ngForOf",t.lessonPresenceOptions),V.zb(3),V.Fc(" ",V.hc(9,7,"presence-control.block-lesson.cancel")," "),V.zb(2),V.lc("disabled",0===t.getSelectedLessonPresences().length),V.zb(1),V.Fc(" ",V.hc(12,9,"presence-control.block-lesson.save")," "))},directives:[Xe.r,Xe.j,Xe.k,ke.l],pipes:[Be.c,ke.e],encapsulation:2}),Ye),tt=a("yl8S"),nt=a("KCaQ");function it(e,t){if(1&e){var n=V.Tb();V.Sb(0,"div",5),V.Sb(1,"input",6),V.dc("change",function(){V.vc(n);var e=t.$implicit;return V.fc().onSelectionChange(e)}),V.Rb(),V.Sb(2,"label",7),V.Dc(3),V.Rb(),V.Rb()}if(2&e){var i=t.$implicit,s=t.index,r=V.fc();V.zb(1),V.nc("id","incident-",s,""),V.lc("checked",i.id===r.selected.id)("value",i.id),V.zb(1),V.nc("for","incident-",s,""),V.zb(1),V.Fc(" ",i.label," ")}}var st,rt=((st=function(){function e(t,n){s(this,e),this.activeModal=t,this.translate=n,this.incidentOptions=[]}return c(e,[{key:"ngOnInit",value:function(){var e=this,t=this.createIncidentOption();this.incidentOptions=this.incidentTypes.map(function(t){return e.createIncidentOption(t)}),this.incidentOptions.unshift(t),this.selected=this.incidentOptions.find(function(t){var n;return t.id===(null===(n=e.incident)||void 0===n?void 0:n.Id)})||t}},{key:"createIncidentOption",value:function(e){return{id:e?e.Id:null,label:e?e.Designation:this.translate.instant("presence-control.incident.no-incident")}}},{key:"onSelectionChange",value:function(e){this.selected=e}},{key:"getSelectedIncident",value:function(){var e=this;return this.incidentTypes.find(function(t){var n;return t.Id===(null===(n=e.selected)||void 0===n?void 0:n.id)})||null}}]),e}()).\u0275fac=function(e){return new(e||st)(V.Mb(Qe.b),V.Mb(Be.d))},st.\u0275cmp=V.Gb({type:st,selectors:[["erz-presence-control-incident"]],inputs:{incident:"incident",incidentTypes:"incidentTypes"},decls:13,vars:10,consts:[[1,"modal-body"],["class","form-group form-check",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"form-group","form-check"],["type","radio","name","incident",1,"form-check-input",3,"id","checked","value","change"],[1,"form-check-label",3,"for"]],template:function(e,t){1&e&&(V.Sb(0,"div",0),V.Sb(1,"p"),V.Dc(2),V.gc(3,"translate"),V.Rb(),V.Sb(4,"form"),V.Bc(5,it,4,5,"div",1),V.Rb(),V.Rb(),V.Sb(6,"div",2),V.Sb(7,"button",3),V.dc("click",function(){return t.activeModal.dismiss()}),V.Dc(8),V.gc(9,"translate"),V.Rb(),V.Sb(10,"button",4),V.dc("click",function(){return t.activeModal.close(t.getSelectedIncident())}),V.Dc(11),V.gc(12,"translate"),V.Rb(),V.Rb()),2&e&&(V.zb(2),V.Fc(" ",V.hc(3,4,"presence-control.incident.text")," "),V.zb(3),V.lc("ngForOf",t.incidentOptions),V.zb(3),V.Fc(" ",V.hc(9,6,"presence-control.incident.cancel")," "),V.zb(3),V.Fc(" ",V.hc(12,8,"presence-control.incident.save")," "))},directives:[Xe.r,Xe.j,Xe.k,ke.l],pipes:[Be.c],styles:["form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding-bottom:.75rem;border-bottom:1px solid #e9ecef}"]}),st),ct=a("EOpz"),ot=a("YDIV"),at=a("U+jE");function ut(e,t){if(1&e){var n=V.Tb();V.Sb(0,"div",22),V.dc("click",function(){return V.vc(n),V.fc().lessonDropdown.toggle()}),V.Dc(1),V.gc(2,"date"),V.Sb(3,"span",23),V.Dc(4),V.gc(5,"date"),V.Rb(),V.Rb()}if(2&e){var i=V.fc();V.zb(1),V.Fc(" ",V.ic(2,2,i.selectedLesson.LessonDateTimeFrom,"HH:mm"),"\u2013"),V.zb(3),V.Ec(V.ic(5,5,i.selectedLesson.LessonDateTimeTo,"HH:mm"))}}function lt(e,t){if(1&e){var n=V.Tb();V.Sb(0,"div",29),V.dc("click",function(){V.vc(n);var e=t.$implicit;return V.fc(2).selectLessonChange.emit(e)}),V.Sb(1,"div",30),V.Sb(2,"div"),V.Dc(3),V.gc(4,"date"),V.gc(5,"date"),V.Rb(),V.Sb(6,"div",26),V.Dc(7),V.Rb(),V.Sb(8,"div",26),V.Dc(9),V.Rb(),V.Rb(),V.Rb()}if(2&e){var i=t.$implicit,s=V.fc(2);V.Eb("active",i.id===s.selectedLesson.id),V.zb(3),V.Gc(" ",V.ic(4,6,i.LessonDateTimeFrom,"HH:mm"),"\u2013",V.ic(5,9,i.LessonDateTimeTo,"HH:mm")," "),V.zb(4),V.Ec(i.eventDesignations),V.zb(2),V.Ec(i.studyClassNumbers)}}function dt(e,t){if(1&e&&(V.Sb(0,"div",24),V.Sb(1,"div",25),V.Sb(2,"div",26),V.Dc(3),V.Rb(),V.Sb(4,"div",26),V.Dc(5),V.Rb(),V.Rb(),V.Sb(6,"div",27),V.Bc(7,lt,10,12,"div",28),V.Rb(),V.Rb()),2&e){var n=V.fc();V.zb(3),V.Ec(n.selectedLesson.eventDesignations),V.zb(2),V.Ec(n.selectedLesson.studyClassNumbers),V.zb(2),V.lc("ngForOf",n.lessons)}}function pt(e,t){if(1&e){var n=V.Tb();V.Sb(0,"button",31),V.dc("click",function(){V.vc(n);var e=V.fc();return null==e.lessonDropdown?null:e.lessonDropdown.toggle()}),V.Sb(1,"i",3),V.Dc(2),V.Rb(),V.Rb()}if(2&e){var i=V.fc();V.zb(2),V.Fc(" ",null!=i.lessonDropdown&&i.lessonDropdown.isOpen()?"keyboard_arrow_up":"keyboard_arrow_down"," ")}}var bt=function(e){return["groups",e]},ft=function(e){return{returnparams:e}};function gt(e,t){if(1&e&&(V.Sb(0,"a",32),V.gc(1,"async"),V.Sb(2,"i",33),V.Dc(3,"groups"),V.Rb(),V.Rb()),2&e){var n=V.fc();V.lc("routerLink",V.pc(4,bt,n.selectedLesson.id))("queryParams",V.pc(6,ft,V.hc(1,2,n.state.queryParamsString$)))}}function ht(e,t){if(1&e){var n=V.Tb();V.Sb(0,"button",34),V.dc("click",function(){V.vc(n);var e=t.$implicit;return V.fc().viewModeChange.emit(e.viewMode)}),V.Sb(1,"i",33),V.Dc(2),V.Rb(),V.Rb()}if(2&e){var i=t.$implicit,s=V.fc();V.Eb("btn-secondary",i.viewMode===s.viewMode)("btn-link",i.viewMode!==s.viewMode)("active",i.viewMode===s.viewMode),V.lc("disabled",!s.selectedLesson),V.zb(2),V.Ec(i.icon)}}var vt=Qe.f.prototype._positionMenu;Qe.f.prototype._positionMenu=function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var s=vt.apply(this,n);if("lesson-dropdown"===this._anchor.nativeElement.id){var r=this._bodyContainer||this._menu.nativeElement,c=null===(e=r.style.transform)||void 0===e?void 0:e.match(/translate\(([0-9-\.]+)px, ([0-9-\.]+)px\)/);c&&parseFloat(c[1])<0&&(r.style.transform="translate(0px, ".concat(c[2],"px)"))}return s};var mt,yt=((mt=function(){function e(t){s(this,e),this.state=t,this.presentCount=null,this.absentCount=null,this.unapprovedCount=null,this.absentPrecedingCount=null,this.search="",this.selectLessonChange=new V.n,this.selectDateChange=new V.n,this.searchChange=new V.n,this.viewModeChange=new V.n,this.viewModeOptions=[{viewMode:je.List,icon:"list"},{viewMode:je.Grid,icon:"view_module"}]}return c(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||mt)(V.Mb(Ie))},mt.\u0275cmp=V.Gb({type:mt,selectors:[["erz-presence-control-header"]],viewQuery:function(e,t){var n;1&e&&V.Jc(Qe.f,1),2&e&&V.tc(n=V.ec())&&(t.lessonDropdown=n.first)},inputs:{selectedLesson:"selectedLesson",lessons:"lessons",presentCount:"presentCount",absentCount:"absentCount",unapprovedCount:"unapprovedCount",absentPrecedingCount:"absentPrecedingCount",viewMode:"viewMode",selectDate:"selectDate",search:"search"},outputs:{selectLessonChange:"selectLessonChange",selectDateChange:"selectDateChange",searchChange:"searchChange",viewModeChange:"viewModeChange"},features:[V.yb([{provide:Qe.c,useClass:Qe.d},{provide:Qe.e,useClass:ot.a}])],decls:40,vars:20,consts:[[1,"navigation"],[1,"lesson-date"],["type","button",1,"btn","btn-link",3,"click"],[1,"material-icons"],["placement","bottom","positionTarget",".lesson-date-input","ngbDatepicker","",1,"lesson-date-input",3,"ngModel","ngModelChange"],["d","ngbDatepicker"],["class","lesson-time",3,"click",4,"ngIf"],["ngbDropdown","","class","lesson-description","container","body","display","dynamic","placement","bottom",4,"ngIf"],["type","button","class","dropdown-caret btn btn-link",3,"click",4,"ngIf"],[1,"states"],[1,"state","present"],[1,"count"],[1,"state","absent"],[1,"state","unapproved"],[1,"state","previously-absent"],[1,"material-icons-outlined"],[1,"search-and-views"],[1,"search",3,"value","disabled","placeholder","label","valueChange"],[1,"group-and-views","d-flex"],["type","button","class","group btn btn-link pr-xs-0 pr-sm-4",3,"routerLink","queryParams",4,"ngIf"],[1,"views"],["type","button","class","view btn",3,"disabled","btn-secondary","btn-link","active","click",4,"ngFor","ngForOf"],[1,"lesson-time",3,"click"],[1,"lesson-time-to"],["ngbDropdown","","container","body","display","dynamic","placement","bottom",1,"lesson-description"],["id","lesson-dropdown","ngbDropdownToggle",""],[1,"text-truncate"],["ngbDropdownMenu","","aria-labelledby","lesson-dropdown"],["ngbDropdownItem","",3,"active","click",4,"ngFor","ngForOf"],["ngbDropdownItem","",3,"click"],[1,"lesson-entry"],["type","button",1,"dropdown-caret","btn","btn-link",3,"click"],["type","button",1,"group","btn","btn-link","pr-xs-0","pr-sm-4",3,"routerLink","queryParams"],[1,"material-icons","align-middle"],["type","button",1,"view","btn",3,"disabled","click"]],template:function(e,t){if(1&e){var n=V.Tb();V.Sb(0,"div",0),V.Sb(1,"div",1),V.Sb(2,"button",2),V.dc("click",function(){return V.vc(n),V.uc(6).toggle()}),V.Sb(3,"i",3),V.Dc(4,"calendar_today"),V.Rb(),V.Rb(),V.Sb(5,"input",4,5),V.dc("ngModelChange",function(e){return t.selectDateChange.emit(e)}),V.Rb(),V.Rb(),V.Bc(7,ut,6,8,"div",6),V.Bc(8,dt,8,3,"div",7),V.Bc(9,pt,3,1,"button",8),V.Rb(),V.Sb(10,"div",9),V.Sb(11,"div",10),V.Sb(12,"i",3),V.Dc(13,"check_circle"),V.Rb(),V.Sb(14,"span",11),V.Dc(15),V.Rb(),V.Rb(),V.Sb(16,"div",12),V.Sb(17,"i",3),V.Dc(18,"cancel"),V.Rb(),V.Sb(19,"span",11),V.Dc(20),V.Rb(),V.Rb(),V.Sb(21,"div",13),V.Sb(22,"i",3),V.Dc(23,"help"),V.Rb(),V.Sb(24,"span",11),V.Dc(25),V.Rb(),V.Rb(),V.Sb(26,"div",14),V.Sb(27,"i",15),V.Dc(28,"info"),V.Rb(),V.Sb(29,"span",11),V.Dc(30),V.Rb(),V.Rb(),V.Rb(),V.Sb(31,"div",16),V.Sb(32,"erz-resettable-input",17),V.dc("valueChange",function(e){return t.searchChange.emit(e)}),V.gc(33,"translate"),V.gc(34,"translate"),V.Rb(),V.Sb(35,"div",18),V.Bc(36,gt,4,8,"a",19),V.gc(37,"async"),V.Sb(38,"div",20),V.Bc(39,ht,3,8,"button",21),V.Rb(),V.Rb(),V.Rb()}2&e&&(V.zb(5),V.lc("ngModel",t.selectDate),V.zb(2),V.lc("ngIf",t.selectedLesson),V.zb(1),V.lc("ngIf",t.selectedLesson),V.zb(1),V.lc("ngIf",t.lessons.length>0),V.zb(6),V.Ec(null!=t.presentCount?t.presentCount:"?"),V.zb(5),V.Ec(null!=t.absentCount?t.absentCount:"?"),V.zb(5),V.Ec(null!=t.unapprovedCount?t.unapprovedCount:"?"),V.zb(5),V.Ec(null!=t.absentPrecedingCount?t.absentPrecedingCount:"?"),V.zb(2),V.lc("value",t.search)("disabled",!t.selectedLesson)("placeholder",V.hc(33,14,"presence-control.header.search-by-name"))("label",V.hc(34,16,"presence-control.header.search")),V.zb(4),V.lc("ngIf",V.hc(37,18,t.selectedLesson&&t.state.groupsAvailability$)),V.zb(3),V.lc("ngForOf",t.viewModeOptions))},directives:[Qe.j,Xe.b,Xe.i,Xe.l,ke.m,at.a,ke.l,Qe.f,Qe.i,Qe.h,Qe.g,p.i],pipes:[Be.c,ke.b,ke.e],styles:['[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1.125rem 1.5rem}.navigation[_ngcontent-%COMP%]{display:grid;grid-template-areas:". date time dropdown-caret" ". description description dropdown-caret";grid-template-columns:1fr auto auto 1fr}.lesson-date[_ngcontent-%COMP%]{grid-area:date;justify-self:end;display:flex;align-items:center;justify-content:end}.lesson-date[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0 .5ch 0 0}.lesson-date[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#33333d;position:relative;top:2px}.lesson-date-input[_ngcontent-%COMP%]{font-weight:600;background:transparent;border:none;width:11ch}.lesson-time[_ngcontent-%COMP%]{grid-area:time;cursor:pointer}.lesson-description[_ngcontent-%COMP%]{grid-area:description;overflow:hidden;text-align:center;cursor:pointer}.dropdown-toggle[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.dropdown-caret[_ngcontent-%COMP%]{grid-area:dropdown-caret;line-height:100%;text-align:left;color:#33333d}.dropdown-menu[_ngcontent-%COMP%]{width:50ch;padding:0;box-shadow:2px 2px 3px -1px rgba(0,0,0,.2)}@media (max-width:800px){.dropdown-menu[_ngcontent-%COMP%]{width:100vw}}.dropdown-item[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid #dee2e6}.states[_ngcontent-%COMP%]{margin:1.125rem 0;display:flex;justify-content:center}.state[_ngcontent-%COMP%]{margin-right:7%;display:flex}.state[_ngcontent-%COMP%]:last-child{margin-right:0}@media (min-width:1000px){.state[_ngcontent-%COMP%]{margin-right:6rem}}.state.present[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#28a745}.state.absent[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#dc3545}.state.unapproved[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#ffa814}.state.previously-absent[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:rgba(51,51,61,.5)}.state[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{margin-left:.3em;margin-top:1px}.search-and-views[_ngcontent-%COMP%]{padding-top:1.125rem;display:flex;justify-content:space-between;border-top:1px solid #e9ecef}.search[_ngcontent-%COMP%]{flex:auto;max-width:300px;margin-right:1.5rem}.views[_ngcontent-%COMP%]{display:flex}.view[_ngcontent-%COMP%]{padding:.25rem;color:#6c757d}.view.active[_ngcontent-%COMP%]{color:#33333d}.group[_ngcontent-%COMP%]{color:#6c757d}@media (max-width:380px){[_nghost-%COMP%]{padding-left:.75rem;padding-right:.75rem}#search-addon[_ngcontent-%COMP%]{padding-left:.5rem;padding-right:.5rem}}@media (max-width:365px){.lesson-time[_ngcontent-%COMP%]{line-height:1}.lesson-time-to[_ngcontent-%COMP%]{display:block}.dropdown-caret[_ngcontent-%COMP%]{padding-left:0}}']}),mt),Ot=a("6UOe");function St(e,t){if(1&e&&(V.Sb(0,"div"),V.Dc(1),V.gc(2,"date"),V.gc(3,"date"),V.gc(4,"addSpace"),V.Rb()),2&e){var n=t.$implicit;V.zb(1),V.Ic(" ",V.ic(2,5,n.LessonRef.From,"HH:mm"),"\u2013",V.ic(3,8,n.LessonRef.To,"HH:mm")," ",n.LessonRef.EventDesignation,"",V.ic(4,11,":",":")," ",n.Type," ")}}var Pt,wt=((Pt=function(){function e(t){s(this,e),this.activeModal=t}return c(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||Pt)(V.Mb(Qe.b))},Pt.\u0275cmp=V.Gb({type:Pt,selectors:[["erz-presence-control-preceding-absence"]],inputs:{precedingAbsences:"precedingAbsences"},decls:9,vars:7,consts:[[1,"modal-body"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(e,t){1&e&&(V.Sb(0,"div",0),V.Sb(1,"p"),V.Dc(2),V.gc(3,"translate"),V.Rb(),V.Bc(4,St,5,14,"div",1),V.Rb(),V.Sb(5,"div",2),V.Sb(6,"button",3),V.dc("click",function(){return t.activeModal.dismiss()}),V.Dc(7),V.gc(8,"translate"),V.Rb(),V.Rb()),2&e&&(V.zb(2),V.Fc(" ",V.hc(3,3,"presence-control.preceding-absence.text")," "),V.zb(2),V.lc("ngForOf",t.precedingAbsences),V.zb(3),V.Fc(" ",V.hc(8,5,"presence-control.preceding-absence.cancel")," "))},directives:[ke.l],pipes:[Be.c,ke.e,Ot.a],styles:[""]}),Pt),Ct=a("PT0D"),kt=function(e){return["/presence-control/student",e]};function jt(e,t){if(1&e&&(V.Nb(0,"erz-avatar",9),V.gc(1,"async")),2&e){var n=V.fc();V.lc("studentId",V.hc(1,3,n.studentId$))("link",V.pc(5,kt,n.entry.lessonPresence.StudentRef.Id))("linkParams",n.profileReturnParams)}}function Mt(e,t){if(1&e&&(V.Sb(0,"span"),V.Dc(1),V.Rb()),2&e){var n=V.fc(2);V.zb(1),V.Ec(null==n.entry.presenceType?null:n.entry.presenceType.Designation)}}function It(e,t){if(1&e){var n=V.Tb();V.Sb(0,"button",10),V.dc("click",function(){V.vc(n);var e=V.fc();return e.updatePresenceType(e.entry)}),V.Bc(1,Mt,2,1,"span",11),V.Rb()}if(2&e){var i=V.fc();V.zb(1),V.lc("ngIf",!(null!=i.entry.presenceType&&i.entry.presenceType.IsIncident))}}function $t(e,t){if(1&e){var n=V.Tb();V.Sb(0,"button",12),V.dc("click",function(){V.vc(n);var e=V.fc();return e.showPrecedingAbsences(e.entry)}),V.Sb(1,"i",13),V.Dc(2,"info"),V.Rb(),V.Rb()}}function Dt(e,t){if(1&e){var n=V.Tb();V.Sb(0,"a",14),V.dc("click",function(){V.vc(n);var e=V.fc();return e.updateIncident(e.entry)}),V.Sb(1,"i",3),V.Dc(2,"edit"),V.Rb(),V.Sb(3,"span"),V.Dc(4),V.gc(5,"translate"),V.Rb(),V.Rb()}if(2&e){var i=V.fc();V.zb(4),V.Ec(V.hc(5,1,(null==i.entry.presenceType?null:i.entry.presenceType.IsIncident)&&(null==i.entry.presenceType?null:i.entry.presenceType.Designation)||"presence-control.entry.incident"))}}var Rt,Lt=((Rt=function(){function e(t,n,i){s(this,e),this.toastr=t,this.translate=n,this.modalService=i,this.hasUnconfirmedAbsences=!1,this.togglePresenceType=new V.n,this.changeIncident=new V.n,this.studentId$=new oe.a(1)}return c(e,[{key:"classNames",get:function(){return[this.entry.presenceCategory,this.viewMode].join(" ")}},{key:"ngOnInit",value:function(){}},{key:"ngOnChanges",value:function(e){e.entry&&this.studentId$.next(e.entry.currentValue.lessonPresence.StudentRef.Id)}},{key:"isListViewMode",get:function(){return this.viewMode===je.List}},{key:"updatePresenceType",value:function(e){e.canChangePresenceType?this.togglePresenceType.emit(e):this.toastr.warning(this.translate.instant("presence-control.entry.update-warning"))}},{key:"updateIncident",value:function(e){e.canChangeIncident&&this.changeIncident.emit(e)}},{key:"showPrecedingAbsences",value:function(e){this.modalService.open(wt).componentInstance.precedingAbsences=e.precedingAbsences}}]),e}()).\u0275fac=function(e){return new(e||Rt)(V.Mb(Ue.b),V.Mb(Be.d),V.Mb(Qe.k))},Rt.\u0275cmp=V.Gb({type:Rt,selectors:[["erz-presence-control-entry"]],hostVars:2,hostBindings:function(e,t){2&e&&V.Bb(t.classNames)},inputs:{entry:"entry",hasUnconfirmedAbsences:"hasUnconfirmedAbsences",viewMode:"viewMode",profileReturnParams:"profileReturnParams"},outputs:{togglePresenceType:"togglePresenceType",changeIncident:"changeIncident"},features:[V.xb],decls:13,vars:13,consts:[["class","avatar large",3,"studentId","link","linkParams",4,"ngIf"],["type","button","class","presence-category designation btn btn-link",3,"click",4,"ngIf"],["type","button",1,"presence-category","status","btn","btn-link",3,"click"],[1,"material-icons"],["type","button","class","previously-absent btn btn-link",3,"click",4,"ngIf"],[1,"student-name",3,"routerLink","queryParams"],[1,"text-truncate"],[1,"unconfirmed-absences"],["class","incident btn btn-link",3,"click",4,"ngIf"],[1,"avatar","large",3,"studentId","link","linkParams"],["type","button",1,"presence-category","designation","btn","btn-link",3,"click"],[4,"ngIf"],["type","button",1,"previously-absent","btn","btn-link",3,"click"],[1,"material-icons-outlined"],[1,"incident","btn","btn-link",3,"click"]],template:function(e,t){1&e&&(V.Bc(0,jt,2,7,"erz-avatar",0),V.Bc(1,It,2,1,"button",1),V.Sb(2,"button",2),V.dc("click",function(){return t.updatePresenceType(t.entry)}),V.Sb(3,"i",3),V.Dc(4),V.Rb(),V.Rb(),V.Bc(5,$t,3,0,"button",4),V.Sb(6,"a",5),V.Sb(7,"span",6),V.Dc(8),V.Rb(),V.Sb(9,"span",7),V.Dc(10),V.gc(11,"translate"),V.Rb(),V.Rb(),V.Bc(12,Dt,6,3,"a",8)),2&e&&(V.lc("ngIf",!t.isListViewMode),V.zb(1),V.lc("ngIf",t.entry.showDesignation),V.zb(3),V.Ec(t.entry.presenceCategoryIcon),V.zb(1),V.lc("ngIf",(null==t.entry.precedingAbsences?null:t.entry.precedingAbsences.length)>0),V.zb(1),V.lc("routerLink",V.pc(11,kt,t.entry.lessonPresence.StudentRef.Id))("queryParams",t.profileReturnParams),V.zb(2),V.Ec(t.entry.lessonPresence.StudentFullName),V.zb(2),V.Fc(" ",t.hasUnconfirmedAbsences?V.hc(11,9,"presence-control.entry.unconfirmed-absences"):""," "),V.zb(2),V.lc("ngIf",t.entry.canChangeIncident))},directives:[ke.m,p.i,Ct.a],pipes:[Be.c,ke.b],styles:['[_nghost-%COMP%]{padding:3rem 1.5rem;background-color:#fff;display:grid;grid-template-areas:"avatar status designation previously-absent" "avatar student-name student-name student-name" "avatar incident incident incident";grid-template-columns:-webkit-min-content -webkit-min-content 3fr -webkit-min-content;grid-template-columns:min-content min-content 3fr min-content}[_nghost-%COMP%] > *[_ngcontent-%COMP%]{align-self:center}.presence-category[_ngcontent-%COMP%]{text-decoration:none}.presence-category[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{top:.1875rem}.absent[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#dc3545}.present[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#28a745}.unapproved[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#ffa814}.designation[_ngcontent-%COMP%], .incident[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .student-name[_ngcontent-%COMP%], a.incident[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.avatar[_ngcontent-%COMP%]{grid-area:avatar;margin-right:2.25rem}.status[_ngcontent-%COMP%]{grid-area:status}.status[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:2.75rem}.designation[_ngcontent-%COMP%]{grid-area:designation;text-align:left;line-height:3.125rem}.previously-absent[_ngcontent-%COMP%]{grid-area:previously-absent;text-decoration:none;color:rgba(51,51,61,.5);justify-self:end}.student-name[_ngcontent-%COMP%]{color:#33333d;grid-area:student-name;display:flex;flex-direction:column}.unconfirmed-absences[_ngcontent-%COMP%]{color:#dc3545;font-size:1.1rem;line-height:1}.incident[_ngcontent-%COMP%]{color:rgba(51,51,61,.5);padding-right:.75rem;grid-area:incident;display:flex}.incident[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.3em}.grid[_nghost-%COMP%]   .designation[_ngcontent-%COMP%], .grid[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{align-self:start;margin-left:-.75rem;margin-top:-.375rem}.grid[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{align-self:end;margin-left:-.75rem;margin-bottom:-.375rem}.grid[_nghost-%COMP%]   .previously-absent[_ngcontent-%COMP%]{padding-right:0;align-self:start}.grid[_nghost-%COMP%]   .unconfirmed-absences[_ngcontent-%COMP%]{height:1.1rem}.list[_nghost-%COMP%]{grid-template-areas:"student-name status designation incident previously-absent";grid-template-columns:3fr -webkit-min-content 3fr 2fr 3em;grid-template-columns:3fr min-content 3fr 2fr 3em;padding:.5rem .5rem .5rem 1rem}.list[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{justify-self:start}@media (max-width:750px){.list[_nghost-%COMP%]{grid-template-areas:"student-name student-name student-name previously-absent" "status incidentordesignation incidentordesignation incidentordesignation";grid-template-columns:-webkit-min-content 1fr 1fr -webkit-min-content;grid-template-columns:min-content 1fr 1fr min-content;row-gap:1.5rem}.list[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.list[_nghost-%COMP%]   .designation[_ngcontent-%COMP%], .list[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{grid-area:incidentordesignation}.list[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{justify-self:end}.list[_nghost-%COMP%]   .previously-absent[_ngcontent-%COMP%]{padding-top:0;align-self:start}}']}),Rt),Tt=a("4Kj8"),_t=function(e){return{returnparams:e}};function xt(e,t){if(1&e){var n=V.Tb();V.Sb(0,"erz-presence-control-entry",7),V.dc("togglePresenceType",function(e){return V.vc(n),V.fc(5).togglePresenceType(e)})("changeIncident",function(e){return V.vc(n),V.fc(5).changeIncident(e)}),V.gc(1,"async"),V.gc(2,"async"),V.gc(3,"async"),V.Rb()}if(2&e){var i=t.$implicit,s=V.fc(5);V.lc("entry",i)("hasUnconfirmedAbsences",V.hc(1,4,s.state.hasUnconfirmedAbsences(i)))("viewMode",V.hc(2,6,s.state.viewMode$))("profileReturnParams",V.pc(10,_t,V.hc(3,8,s.state.queryParamsString$)))}}function zt(e,t){if(1&e&&(V.Qb(0),V.Sb(1,"div"),V.gc(2,"async"),V.Bc(3,xt,4,12,"erz-presence-control-entry",6),V.Rb(),V.Pb()),2&e){var n=V.fc(3).erzLet,i=V.fc();V.zb(1),V.Cb("default-entries entries view-mode-",V.hc(2,4,i.state.viewMode$),""),V.zb(2),V.lc("ngForOf",n.entries)}}function Et(e,t){1&e&&(V.Sb(0,"p",8),V.Dc(1),V.gc(2,"translate"),V.Rb()),2&e&&(V.zb(1),V.Fc(" ",V.hc(2,1,"presence-control.no-lesson-presences")," "))}function Ft(e,t){if(1&e&&(V.Qb(0),V.Bc(1,zt,4,6,"ng-container",1),V.Bc(2,Et,3,3,"ng-template",null,5,V.Cc),V.Pb()),2&e){var n=V.uc(3),i=V.fc(2).erzLet;V.zb(1),V.lc("ngIf",(null==i.entries?null:i.entries.length)>0)("ngIfElse",n)}}function At(e,t){1&e&&(V.Sb(0,"p",9),V.Dc(1),V.gc(2,"translate"),V.Rb()),2&e&&(V.zb(1),V.Ec(V.hc(2,1,"presence-control.no-lessons")))}function Ut(e,t){if(1&e){var n=V.Tb();V.Qb(0),V.Sb(1,"erz-presence-control-header",3),V.dc("searchChange",function(e){return V.vc(n),V.fc(2).search$.next(e)})("viewModeChange",function(e){return V.vc(n),V.fc(2).state.setViewMode(e)})("selectDateChange",function(e){return V.vc(n),V.fc(2).state.setDate(e)})("selectLessonChange",function(e){return V.vc(n),V.fc(2).state.setLesson(e)}),V.gc(2,"async"),V.gc(3,"async"),V.gc(4,"async"),V.gc(5,"async"),V.gc(6,"async"),V.gc(7,"async"),V.gc(8,"async"),V.Rb(),V.Bc(9,Ft,4,2,"ng-container",1),V.Bc(10,At,3,3,"ng-template",null,4,V.Cc),V.Pb()}if(2&e){var i=V.uc(11),s=V.fc().erzLet,r=V.fc();V.zb(1),V.lc("selectedLesson",s.lesson)("lessons",s.lessons)("presentCount",V.hc(2,11,r.state.presentCount$))("absentCount",V.hc(3,13,r.state.absentCount$))("unapprovedCount",V.hc(4,15,r.state.unapprovedCount$))("absentPrecedingCount",V.hc(5,17,r.state.absentPrecedingCount$))("viewMode",V.hc(6,19,r.state.viewMode$))("selectDate",V.hc(7,21,r.state.selectedDate$))("search",V.hc(8,23,r.search$)),V.zb(8),V.lc("ngIf",s.lesson)("ngIfElse",i)}}function Bt(e,t){1&e&&V.Nb(0,"erz-spinner")}function Gt(e,t){if(1&e&&(V.Qb(0),V.Bc(1,Ut,12,25,"ng-container",1),V.gc(2,"async"),V.Bc(3,Bt,1,0,"ng-template",null,2,V.Cc),V.Pb()),2&e){var n=V.uc(4),i=V.fc();V.zb(1),V.lc("ngIf",!V.hc(2,2,i.state.loading$))("ngIfElse",n)}}var Vt,Zt,Nt,Ht=function(e,t,n){return{lesson:e,lessons:t,entries:n}},Kt=((Vt=function(){function e(t,n,i,r,c,o){s(this,e),this.state=t,this.lessonPresencesUpdateService=n,this.presenceTypesService=i,this.modalService=r,this.scrollPosition=c,this.route=o,this.search$=new O.a(""),this.entries$=Object(P.a)([this.state.selectedPresenceControlEntriesByGroup$,this.search$]).pipe(Object(M.a)(Object(J.a)(Je.a)),Object(j.a)(1)),this.destroy$=new b.a}return c(e,[{key:"ngOnInit",value:function(){this.route.queryParams.pipe(Object(f.a)(this.destroy$)).subscribe(this.restoreStateFromParams.bind(this))}},{key:"ngAfterViewInit",value:function(){this.scrollPosition.restore()}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"doTogglePresenceType",value:function(e,t){var n=this;this.state.getNextPresenceType(e).subscribe(function(i){return n.lessonPresencesUpdateService.updatePresenceTypes(t||[e.lessonPresence],i?i.Id:null)})}},{key:"togglePresenceType",value:function(e){var t=this;this.state.getBlockLessonPresences(e).pipe(Object($.a)(1)).subscribe(function(n){if(1===n.length)t.doTogglePresenceType(e);else{var i=t.modalService.open(et);i.componentInstance.entry=e,i.componentInstance.blockLessonPresences=n,i.result.then(function(n){n&&t.doTogglePresenceType(e,n)},function(){})}})}},{key:"updateIncident",value:function(e,t){this.lessonPresencesUpdateService.updatePresenceTypes([e.lessonPresence],t)}},{key:"changeIncident",value:function(e){var t=this;this.presenceTypesService.incidentTypes$.subscribe(function(n){var i=t.modalService.open(rt);i.componentInstance.incident=n.find(function(t){var n;return t.Id===(null===(n=e.presenceType)||void 0===n?void 0:n.Id)})||null,i.componentInstance.incidentTypes=n,i.result.then(function(n){t.updateIncident(e,(null==n?void 0:n.Id)||null)},function(){})})}},{key:"restoreStateFromParams",value:function(e){var t=this;e.date&&this.state.setDate(Object(nt.c)(e.date));var n=String(e.lesson);n&&this.state.lessons$.pipe(Object($.a)(1)).subscribe(function(e){var i=e.find(function(e){return e.id===n});i&&t.state.setLesson(i)}),e.viewMode&&Me.includes(e.viewMode)&&this.state.setViewMode(e.viewMode)}}]),e}()).\u0275fac=function(e){return new(e||Vt)(V.Mb(Ie),V.Mb(Ve),V.Mb(q.a),V.Mb(Qe.k),V.Mb(tt.a),V.Mb(p.a))},Vt.\u0275cmp=V.Gb({type:Vt,selectors:[["erz-presence-control-list"]],decls:4,vars:11,consts:[[4,"erzLet"],[4,"ngIf","ngIfElse"],["loading",""],[3,"selectedLesson","lessons","presentCount","absentCount","unapprovedCount","absentPrecedingCount","viewMode","selectDate","search","searchChange","viewModeChange","selectDateChange","selectLessonChange"],["noLessons",""],["noLessonPresences",""],[3,"entry","hasUnconfirmedAbsences","viewMode","profileReturnParams","togglePresenceType","changeIncident",4,"ngFor","ngForOf"],[3,"entry","hasUnconfirmedAbsences","viewMode","profileReturnParams","togglePresenceType","changeIncident"],[1,"mt-3","pl-3"],[1,"mt-3","px-3"]],template:function(e,t){1&e&&(V.Bc(0,Gt,5,4,"ng-container",0),V.gc(1,"async"),V.gc(2,"async"),V.gc(3,"async")),2&e&&V.lc("erzLet",V.rc(7,Ht,V.hc(1,1,t.state.selectedLesson$),V.hc(2,3,t.state.lessons$),V.hc(3,5,t.entries$)))},directives:[ct.a,ke.m,yt,ke.l,Lt,Tt.a],pipes:[ke.b,Be.c],styles:["erz-presence-control-entry[_ngcontent-%COMP%]{border-bottom:1px solid #e9ecef}.entries.view-mode-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}@media (min-width:400px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%;border-right:1px solid #e9ecef}}@media (min-width:800px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:50%;border-right:1px solid #e9ecef}}@media (min-width:1200px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:33.3333333333%;border-right:1px solid #e9ecef}}@media (min-width:1600px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:25%;border-right:1px solid #e9ecef}}@media (min-width:2000px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:20%;border-right:1px solid #e9ecef}}@media (min-width:2400px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:16.6666666667%;border-right:1px solid #e9ecef}}"],changeDetection:0}),Vt),qt=a("hH5/"),Jt=a("ccj6"),Qt=a("wO+i"),Xt=((Zt=function(e){o(n,e);var t=u(n);function n(e,i){return s(this,n),t.call(this,e,i,Oe,"SubscriptionDetails")}return c(n,[{key:"update",value:function(e,t){return this.http.put("".concat(this.baseUrl,"/").concat(t.Id),{IdPerson:t.IdPerson,EventId:t.EventId,Value:e}).pipe(Object(_e.a)(void 0))}}]),n}(B.a)).\u0275fac=function(e){return new(e||Zt)(V.Zb(Z.b),V.Zb(T.a))},Zt.\u0275prov=V.Ib({token:Zt,factory:Zt.\u0275fac,providedIn:"root"}),Zt),Wt=a("ulei"),Yt=((Nt=function(e){o(n,e);var t=u(n);function n(){return s(this,n),t.apply(this,arguments)}return n}(Wt.a)).\u0275fac=function(e){return en(e||Nt)},Nt.\u0275prov=V.Ib({token:Nt,factory:Nt.\u0275fac}),Nt),en=V.Ub(Yt);function tn(e,t){if(1&e){var n=V.Tb();V.Sb(0,"div",5),V.Sb(1,"input",6),V.dc("change",function(){V.vc(n);var e=t.$implicit;return V.fc().onSelectionChange(e)}),V.Rb(),V.Sb(2,"label",7),V.Dc(3),V.Rb(),V.Rb()}if(2&e){var i=t.$implicit,s=t.index,r=V.fc();V.zb(1),V.nc("id","group-",s,""),V.lc("checked",i.id===r.selected.id)("value",i.id),V.zb(1),V.nc("for","group-",s,""),V.zb(1),V.Fc(" ",i.label," ")}}var nn,sn=function(e){return e.Select="select",e.Assign="assign",e}({}),rn=((nn=function(){function e(t,n){s(this,e),this.activeModal=t,this.translate=n,this.groupOptions=[]}return c(e,[{key:"ngOnInit",value:function(){var e=this;this.title="presence-control.groups.".concat(this.dialogMode,".title");var t=this.createEmtpyOption();this.groupOptions=this.createGroupOptions(this.subscriptionDetail),this.groupOptions.unshift(t),this.selected=this.groupOptions.find(function(t){return t.id===e.group})||t}},{key:"createEmtpyOption",value:function(){return{id:null,label:this.translate.instant(this.dialogMode===sn.Select?"presence-control.groups.all":"presence-control.groups.none")}}},{key:"createGroupOptions",value:function(e){var t=this;return e.DropdownItems?e.DropdownItems.map(function(e){return{id:e.Key,label:"".concat(t.translate.instant("presence-control.groups.group")," ").concat(e.Value)}}):[]}},{key:"getSelectedGroup",value:function(){return this.selected}},{key:"onSelectionChange",value:function(e){this.selected=e}}]),e}()).\u0275fac=function(e){return new(e||nn)(V.Mb(Qe.b),V.Mb(Be.d))},nn.\u0275cmp=V.Gb({type:nn,selectors:[["erz-presence-control-group-dialog"]],inputs:{dialogMode:"dialogMode",subscriptionDetail:"subscriptionDetail",group:"group"},decls:13,vars:10,consts:[[1,"modal-body"],["class","form-group form-check",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"form-group","form-check"],["type","radio","name","groups",1,"form-check-input",3,"id","checked","value","change"],[1,"form-check-label",3,"for"]],template:function(e,t){1&e&&(V.Sb(0,"div",0),V.Sb(1,"p"),V.Dc(2),V.gc(3,"translate"),V.Rb(),V.Sb(4,"form"),V.Bc(5,tn,4,5,"div",1),V.Rb(),V.Rb(),V.Sb(6,"div",2),V.Sb(7,"button",3),V.dc("click",function(){return t.activeModal.dismiss()}),V.Dc(8),V.gc(9,"translate"),V.Rb(),V.Sb(10,"button",4),V.dc("click",function(){return t.activeModal.close(t.getSelectedGroup())}),V.Dc(11),V.gc(12,"translate"),V.Rb(),V.Rb()),2&e&&(V.zb(2),V.Fc(" ",V.hc(3,4,t.title)," "),V.zb(3),V.lc("ngForOf",t.groupOptions),V.zb(3),V.Fc(" ",V.hc(9,6,"presence-control.groups.cancel")," "),V.zb(3),V.Fc(" ",V.hc(12,8,"presence-control.groups.save")," "))},directives:[Xe.r,Xe.j,Xe.k,ke.l],pipes:[Be.c],styles:[""]}),nn);function cn(e,t){if(1&e){var n=V.Tb();V.Sb(0,"div",15),V.dc("click",function(){V.vc(n);var e=t.$implicit;return V.fc(2).toggleSort(e)}),V.Dc(1),V.gc(2,"translate"),V.Sb(3,"span",16),V.Dc(4),V.Rb(),V.Rb()}if(2&e){var i=t.$implicit,s=V.fc().erzLet,r=V.fc();V.lc("className",i),V.zb(1),V.Fc(" ",V.hc(2,3,"presence-control.groups.list.header."+i)," "),V.zb(3),V.Ec(r.getSortDirectionCharacter(s.sortCriteria,i))}}function on(e,t){if(1&e){var n=V.Tb();V.Qb(0),V.Sb(1,"div",18),V.Sb(2,"div",19),V.Sb(3,"input",20,21),V.dc("change",function(){V.vc(n);var e=t.$implicit;return V.fc(3).selectionService.toggle(e)}),V.gc(5,"async"),V.Rb(),V.Rb(),V.Sb(6,"div",22),V.Dc(7),V.Rb(),V.Sb(8,"div",23),V.Dc(9),V.Rb(),V.Rb(),V.Pb()}if(2&e){var i=t.$implicit,s=V.fc(3);V.zb(3),V.lc("checked",V.hc(5,3,s.selectionService.isSelected$(i))),V.zb(4),V.Fc(" ",i.name," "),V.zb(2),V.Fc(" ",i.group?i.group:""," ")}}function an(e,t){if(1&e&&(V.Qb(0),V.Bc(1,on,10,5,"ng-container",17),V.Pb()),2&e){var n=V.fc().erzLet;V.zb(1),V.lc("ngForOf",n.sortedEntries)}}function un(e,t){1&e&&V.Nb(0,"erz-spinner")}var ln=function(){return["/presence-control"]},dn=function(){return["name","group"]};function pn(e,t){if(1&e){var n=V.Tb();V.Sb(0,"div"),V.Sb(1,"a",1),V.gc(2,"async"),V.Sb(3,"div",2),V.Sb(4,"i",3),V.Dc(5,"navigate_before"),V.Rb(),V.Sb(6,"span",4),V.Dc(7),V.gc(8,"translate"),V.Rb(),V.Rb(),V.Rb(),V.Sb(9,"div",5),V.Sb(10,"div",6),V.Sb(11,"span",7),V.Dc(12),V.gc(13,"translate"),V.Rb(),V.Sb(14,"button",8),V.dc("click",function(){return V.vc(n),V.fc().selectGroup()}),V.Dc(15),V.gc(16,"translate"),V.gc(17,"translate"),V.Rb(),V.Rb(),V.Sb(18,"a",9),V.dc("click",function(){return V.vc(n),V.fc().assignGroup()}),V.Sb(19,"i",3),V.Dc(20,"edit"),V.Rb(),V.Rb(),V.Rb(),V.Sb(21,"div",10),V.Sb(22,"div",11),V.Bc(23,cn,5,5,"div",12),V.Rb(),V.Bc(24,an,2,1,"ng-container",13),V.gc(25,"async"),V.Bc(26,un,1,0,"ng-template",null,14,V.Cc),V.Rb(),V.Rb()}if(2&e){var i=t.erzLet,s=V.uc(27),r=V.fc();V.zb(1),V.lc("routerLink",V.oc(22,ln))("queryParams",V.hc(2,10,r.backlinkQueryParams$)),V.zb(6),V.Ec(V.hc(8,12,"presence-control.groups.title")),V.zb(5),V.Ec(V.hc(13,14,"presence-control.groups.show")),V.zb(3),V.Fc(" ",i.group?V.hc(16,16,"presence-control.groups.group")+" "+i.group:V.hc(17,18,"presence-control.groups.all")," "),V.zb(3),V.Eb("disabled",0===i.selection.length),V.zb(5),V.lc("ngForOf",V.oc(23,dn)),V.zb(1),V.lc("ngIf",!V.hc(25,20,r.state.loading$))("ngIfElse",s)}}var bn,fn,gn,hn=function(e,t,n,i){return{sortCriteria:e,sortedEntries:t,selection:n,group:i}},vn=[{path:"",component:qe,children:[{path:"",component:Kt,data:{restoreScrollPositionFrom:["/presence-control/student/:id"]}},{path:"student/:id",children:[{path:"",component:Jt.a},{path:"confirm",component:qt.a}]},{path:"groups/:id",component:(bn=function(){function n(e,t,i,r,c,o,a,u,l){s(this,n),this.route=e,this.state=t,this.selectionService=i,this.groupService=r,this.settingsService=c,this.subscriptionDetailService=o,this.toastr=a,this.translate=u,this.modalService=l,this.backlinkQueryParams$=this.route.queryParams.pipe(Object(Qt.a)("returnparams"),Object(M.a)(E.b)),this.eventIds$=this.state.selectedLesson$.pipe(Object(M.a)(function(e){return(null==e?void 0:e.getEventIds())||[]})),this.sortCriteriaSubject$=new O.a({primarySortKey:"name",ascending:!1}),this.sortCriteria$=this.sortCriteriaSubject$.asObservable(),this.sortedEntries$=Object(P.a)([this.groupService.getSubscriptionDetailsForStudents(),this.sortCriteria$]).pipe(Object(M.a)(Object(J.a)(ue))),this.selected=[]}return c(n,[{key:"ngOnInit",value:function(){var e=this;this.selectionService.selection$.subscribe(function(t){return e.selected=t})}},{key:"selectGroup",value:function(){this.openGroupModal(sn.Select,this.selectCallback.bind(this))}},{key:"assignGroup",value:function(){this.openGroupModal(sn.Assign,this.assignCallback.bind(this))}},{key:"openGroupModal",value:function(t,n){var i=this;Object(P.a)([this.groupService.getSubscriptionDetailForGroupEvent(),this.groupService.group$]).pipe(Object($.a)(1)).subscribe(function(s){var r=e(s,2),c=r[0],o=r[1],a=i.modalService.open(rn);a.componentInstance.dialogMode=t,a.componentInstance.subscriptionDetail=c,a.componentInstance.group=o,a.result.then(function(e){n(e)},function(){})})}},{key:"selectCallback",value:function(n){var i=this;Object(P.a)([this.eventIds$,this.groupService.savedGroupViews$]).pipe(Object($.a)(1),Object(k.a)(function(s){var r=e(s,2),c=r[0],o=r[1],a=function(e,t){var n={Key:"presenceControlGroupView",Value:JSON.stringify(t)},i=Object.assign({},Object(F.a)());return i.Settings.push(n),i}(0,function(e,n,i){var s=n.map(function(t){return{eventId:t,group:e}}),r=i.map(function(e){return s.find(function(t){return t.eventId===e.eventId})||e});return t(new Set([].concat(t(r),t(s)))).filter(function(e){return null!==e.group})}(n.id,c,o));return i.settingsService.updateUserSettingsCst(a).pipe(Object(_e.a)(n.id))})).subscribe(function(e){return i.groupService.selectGroup(e)})}},{key:"assignCallback",value:function(e){var t=this;Object(ae.a)(this.selected.map(function(n){return t.subscriptionDetailService.update(e.id,n.detail)})).subscribe(this.onSaveSuccess.bind(this))}},{key:"onSaveSuccess",value:function(){this.groupService.reloadSubscriptionDetails(),this.selectionService.clear(),this.toastr.success(this.translate.instant("presence-control.groups.notifications.save-success"))}},{key:"getSortDirectionCharacter",value:function(e,t){return e.primarySortKey!==t?"":e.ascending?"\u2193":"\u2191"}},{key:"toggleSort",value:function(e){var t=this;this.sortCriteriaSubject$.pipe(Object($.a)(1)).subscribe(function(n){t.sortCriteriaSubject$.next(n.primarySortKey===e?{primarySortKey:e,ascending:!n.ascending}:{primarySortKey:e,ascending:"name"===e})})}}]),n}(),bn.\u0275fac=function(e){return new(e||bn)(V.Mb(p.a),V.Mb(Ie),V.Mb(Yt),V.Mb(Ce),V.Mb(x.a),V.Mb(Xt),V.Mb(Ue.b),V.Mb(Be.d),V.Mb(Qe.k))},bn.\u0275cmp=V.Gb({type:bn,selectors:[["erz-presence-control-group"]],features:[V.yb([Yt])],decls:5,vars:14,consts:[[4,"erzLet"],[1,"back","btn","btn-link","p-3",3,"routerLink","queryParams"],[1,"d-flex","align-items-center"],[1,"material-icons"],[1,"ml-3"],[1,"group-header","mb-2","d-flex","justify-content-between"],[1,"d-flex","align-items-baseline"],[1,"pl-3"],["type","button",1,"show","btn","btn-link",3,"click"],["aria-label","edit",1,"btn","btn-primary","mr-2",3,"click"],[1,"group-list"],[1,"group-list-header"],[3,"className","click",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["loading",""],[3,"className","click"],[1,"sort-direction"],[4,"ngFor","ngForOf"],[1,"group-list-entry"],[1,"checkbox"],["type","checkbox",1,"form-check-input",3,"checked","change"],["checkbox",""],[1,"name","pr-2"],[1,"group"]],template:function(e,t){1&e&&(V.Bc(0,pn,28,24,"div",0),V.gc(1,"async"),V.gc(2,"async"),V.gc(3,"async"),V.gc(4,"async")),2&e&&V.lc("erzLet",V.sc(9,hn,V.hc(1,1,t.sortCriteria$),V.hc(2,3,t.sortedEntries$),V.hc(3,5,t.selectionService.selection$),V.hc(4,7,t.groupService.group$)))},directives:[ct.a,p.i,ke.l,ke.m,Tt.a],pipes:[ke.b,Be.c],styles:['.back[_ngcontent-%COMP%]{color:#33333d;text-decoration:none}.back[_ngcontent-%COMP%]:active   span[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%]{text-decoration:underline}.group-list[_ngcontent-%COMP%]{padding-left:1.5rem;padding-right:1.5rem}.group-list-header[_ngcontent-%COMP%]{cursor:pointer;padding:1.5rem;display:grid;grid-template-areas:"name group";grid-template-columns:3fr 2fr;border-top:1px solid #dee2e6;border-bottom:2px solid #dee2e6}.group-list-entry[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid #e9ecef;display:grid;grid-template-areas:"checkbox name group";grid-template-columns:-webkit-min-content 3fr 2fr;grid-template-columns:min-content 3fr 2fr}.checkbox[_ngcontent-%COMP%]{grid-area:checkbox;margin:0;padding:.6rem .75rem 0 0}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.name[_ngcontent-%COMP%]{grid-area:name;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.group[_ngcontent-%COMP%]{grid-area:group}@media (max-width:750px){.group-list[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.group-list-header[_ngcontent-%COMP%]{grid-template-columns:3fr 1fr}.group-list-entry[_ngcontent-%COMP%]{grid-template-columns:-webkit-min-content 3fr 1fr;grid-template-columns:min-content 3fr 1fr}}'],changeDetection:0}),bn)}]}],mn=((gn=function e(){s(this,e)}).\u0275fac=function(e){return new(e||gn)},gn.\u0275mod=V.Kb({type:gn}),gn.\u0275inj=V.Jb({imports:[[p.j.forChild(vn)],p.j]}),gn),yn=((fn=function e(){s(this,e)}).\u0275fac=function(e){return new(e||fn)},fn.\u0275mod=V.Kb({type:fn}),fn.\u0275inj=V.Jb({imports:[[d.a,mn]]}),fn)}}])}();