!function(){function e(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==t)return;var s,c,i=[],r=!0,o=!1;try{for(t=t.call(e);!(r=(s=t.next()).done)&&(i.push(s.value),!n||i.length!==n);r=!0);}catch(a){o=!0,c=a}finally{try{r||null==t.return||t.return()}finally{if(o)throw c}}return i}(e,n)||r(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){return(n=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,t)}function t(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var t,i=c(e);if(n){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return s(this,t)}}function s(e,n){return!n||"object"!=typeof n&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||r(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,n){if(e){if("string"==typeof e)return o(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?o(e,n):void 0}}function o(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,s=new Array(n);t<n;t++)s[t]=e[t];return s}function a(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function d(e,n){for(var t=0;t<n.length;t++){var s=n[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function l(e,n,t){return n&&d(e.prototype,n),t&&d(e,t),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"2TIA":function(s,c,o){"use strict";o.r(c),o.d(c,"PresenceControlModule",function(){return Dn});var d=o("PCNd"),u=o("tyNb"),p=o("XNiG"),b=o("1G5W"),f=o("2Vo4"),g=o("VRyK"),h=o("itXk"),v=o("PqYM"),m=o("/uUt"),y=o("eIep"),O=o("UXun"),P=o("lJxs"),w=o("JX91"),C=o("IzEk"),M=o("bHdf"),S=o("pLZG"),j=o("Muja"),k=o("BeL+"),I=o("sWYD"),T=o("CCnw"),R=o("CqUA"),D=o("KJh6"),L=o("eB9A"),_=o("BzUC");function $(e){return function(n){return n.reduce(function(n,t){return n+(t.presenceCategory===e?1:0)},0)}}var x=o("vlqf"),z=o("Xr/R"),A=o("G6Tw"),U=o("jIYg"),F=o("v6cN"),E=o("AEFh");function B(e,n){return null===e&&null===n||null!==e&&null!==n&&e.TeacherInformation===n.TeacherInformation&&e.LessonDateTimeFrom.getTime()===n.LessonDateTimeFrom.getTime()&&e.LessonDateTimeTo.getTime()===n.LessonDateTimeTo.getTime()}var H=function(){function e(n,t,s){a(this,e),this.TeacherInformation=n,this.LessonDateTimeFrom=t,this.LessonDateTimeTo=s,this.lessons=[]}return l(e,[{key:"addLesson",value:function(e){this.lessons.some(function(n){return Object(_.d)(n,e)})||(this.lessons.push(e),this.updateId(),this.updateStudyClassNumbers(),this.updateEventDesignations())}},{key:"updateId",value:function(){this.id=i(new Set(this.lessons.map(function(e){return e.LessonRef.Id}).sort())).join("-")}},{key:"updateStudyClassNumbers",value:function(){this.studyClassNumbers=i(new Set(this.lessons.map(function(e){return e.StudyClassNumber}).sort(function(e,n){return e.localeCompare(n)}))).join(", ")}},{key:"updateEventDesignations",value:function(){this.eventDesignations=i(new Set(this.lessons.map(function(e){return e.EventDesignation}).sort())).join(", ")}}]),e}(),V=o("/Tr7");function N(e,n){Object(U.a)(2,arguments);var t=Object(V.a)(e),s=Object(V.a)(n);return t.getTime()<s.getTime()}function G(e,n){Object(U.a)(2,arguments);var t=Object(V.a)(e).getTime(),s=Object(V.a)(n.start).getTime(),c=Object(V.a)(n.end).getTime();if(!(s<=c))throw new RangeError("Invalid interval");return t>=s&&t<=c}function Z(e){return function(e){return e.reduce(function(e,n){return e.some(function(e){return Object(_.d)(e,n)})?e:[].concat(i(e),[n])},[])}(e).reduce(function(e,n,t){var s=e.find(function(e){return B(e,n)});if(s)return s.addLesson(Object(_.a)(n)),e;var c,r,o=(c=Object(_.a)(n),(r=new H(c.TeacherInformation,c.LessonDateTimeFrom,c.LessonDateTimeTo)).addLesson(c),r);return[].concat(i(e),[o])},[]).sort(_.c)}function q(e){if(0===e.length)return null;var n=new Date;if(e=i(e).sort(_.c),Object(A.a)(n,e[0].LessonDateTimeFrom)){var t,s=function(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=r(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var s=0,c=function(){};return{s:c,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,a=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){a=!0,i=e},f:function(){try{o||null==t.return||t.return()}finally{if(a)throw i}}}}(e);try{for(s.s();!(t=s.n()).done;){var c=t.value;if(N(n,c.LessonDateTimeFrom)||G(n,{start:c.LessonDateTimeFrom,end:c.LessonDateTimeTo}))return c}}catch(o){s.e(o)}finally{s.f()}return e[e.length-1]}return e[0]}var K,J,X,Q=o("mbak"),Y=o("t0ae"),W=o("LuCL"),ee=o("fXoL"),ne=o("tk/3"),te=((K=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}(c,e);var s=t(c);function c(e,n){return a(this,c),s.call(this,e,n,W.a,"LessonTeachers")}return l(c,[{key:"loadOtherTeachersLessonAbsences",value:function(e,n,t){var s="".concat(this.baseUrl,"/except/").concat(e,"/LessonAbsences?expand=LessonRef");return n&&n.length>0&&(s=s.concat("&filter.StudentRef=;"+n.join(";"))),this.http.get(s,{params:t}).pipe(Object(y.a)(Object(Y.b)(W.a)))}}]),c}(Q.a)).\u0275fac=function(e){return new(e||K)(ee.Zb(ne.b),ee.Zb(z.a))},K.\u0275prov=ee.Ib({token:K,factory:K.\u0275fac,providedIn:"root"}),K),se=o("xHFS"),ce=o("PYvG"),ie=o("kZPp"),re=o("AcjI"),oe=o("ofXK"),ae=function(e){return e.Grid="grid",e.List="list",e}({}),de=Object.keys(ae).map(function(e){return ae[e]}),le=((J=function(){function n(t,s,c,i,r,o,d,l,u){var v=this;a(this,n),this.settingsService=t,this.lessonPresencesService=s,this.lessonTeacherService=c,this.presenceTypesService=i,this.personsService=r,this.dropDownItemsService=o,this.loadingService=d,this.settings=l,this.location=u,this.selectedDateSubject$=new f.a(new Date),this.selectLesson$=new p.a,this.viewModeSubject$=new p.a,this.updateLessonPresences$=new p.a,this.lessonPresences$=Object(g.a)(this.selectedDateSubject$.pipe(Object(m.a)(j.a),Object(y.a)(this.loadLessonPresencesByDate.bind(this))),this.updateLessonPresences$).pipe(Object(O.a)(1)),this.presenceTypes$=this.loadPresenceTypes().pipe(Object(O.a)(1)),this.lessons$=this.lessonPresences$.pipe(Object(P.a)(Z),Object(O.a)(1)),this.currentLesson$=this.lessons$.pipe(Object(P.a)(q),Object(m.a)(B)),this.studentIdsWithUnconfirmedAbsences$=this.selectedDateSubject$.pipe(Object(y.a)(function(){return v.loadStudentIdsWithUnconfirmedAbsences()}),Object(O.a)(1)),this.loading$=this.loadingService.loading$,this.selectedLesson$=Object(g.a)(this.currentLesson$,this.selectLesson$).pipe(Object(O.a)(1)),this.absenceConfirmationStates$=this.dropDownItemsService.getAbsenceConfirmationStates().pipe(Object(O.a)(1)),this.selectedLessonStudentIds$=Object(h.a)([this.selectedLesson$,this.lessonPresences$]).pipe(Object(P.a)(function(n){var t=e(n,2),s=t[0];return t[1].filter(function(e){return e.LessonRef.Id===Number(null==s?void 0:s.id)})}),Object(P.a)(function(e){return e.map(function(e){return e.StudentRef.Id})}),Object(O.a)(1)),this.otherTeachersAbsences$=Object(h.a)([this.personsService.getMyself(),this.selectedLessonStudentIds$.pipe(Object(w.a)([]))]).pipe(Object(y.a)(function(n){var t=e(n,2),s=t[0],c=t[1];return v.lessonTeacherService.loadOtherTeachersLessonAbsences(s.Id,c)}),Object(O.a)(1)),this.selectedPresenceControlEntries$=Object(h.a)([this.selectedLesson$,this.lessonPresences$,this.presenceTypes$,this.absenceConfirmationStates$,this.otherTeachersAbsences$]).pipe(Object(P.a)(Object(L.a)(_.b)),Object(O.a)(1)),this.presentCount$=this.selectedPresenceControlEntries$.pipe(Object(P.a)($("present"))),this.absentCount$=this.selectedPresenceControlEntries$.pipe(Object(P.a)($("absent"))),this.unapprovedCount$=this.selectedPresenceControlEntries$.pipe(Object(P.a)($("unapproved"))),this.absentPrecedingCount$=this.selectedPresenceControlEntries$.pipe(Object(P.a)(function(e){return e.reduce(function(e,n){return e+(n.precedingAbsences&&n.precedingAbsences.length>0?1:0)},0)})),this.viewMode$=Object(g.a)(this.viewModeSubject$,this.getSavedViewMode().pipe(Object(C.a)(1))),this.selectedDate$=this.selectedDateSubject$.asObservable(),this.queryParams$=Object(h.a)([this.selectedDate$,this.selectedLesson$,this.viewMode$]).pipe(Object(P.a)(Object(L.a)(this.buildQueryParams.bind(this)))),this.queryParamsString$=Object(h.a)([this.selectedDate$,this.selectedLesson$,this.viewMode$]).pipe(Object(P.a)(Object(L.a)(this.buildQueryParams.bind(this))),Object(P.a)(E.c)),this.destroy$=new p.a,this.queryParamsString$.pipe(Object(b.a)(this.destroy$)).subscribe(function(e){v.location.replaceState("/presence-control",e),v.confirmBackLinkParams={returnparams:e}}),this.viewModeSubject$.pipe(Object(b.a)(this.destroy$),Object(m.a)(),Object(y.a)(function(e){return v.updateSavedViewMode(e)})).subscribe()}return l(n,[{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"setDate",value:function(e){this.selectedDateSubject$.next(e)}},{key:"setLesson",value:function(e){this.selectLesson$.next(e)}},{key:"setViewMode",value:function(e){this.viewModeSubject$.next(e)}},{key:"updateLessonPresencesTypes",value:function(n){var t=this;Object(h.a)([this.lessonPresences$.pipe(Object(C.a)(1)),this.presenceTypes$.pipe(Object(C.a)(1))]).pipe(Object(P.a)(function(s){var c=e(s,2),i=c[0],r=c[1];return function(e,n,t,s){return e.map(function(e){var c,i,r=n.find(function(n){return(t=n.presence).LessonRef.Id===(s=e).LessonRef.Id&&t.StudentRef.Id===s.StudentRef.Id;var t,s});return r?(c=!r.newPresenceTypeId&&e.Comment?t.find(function(e){return e.IsComment})||null:t.find(function(e){return e.Id===r.newPresenceTypeId})||null,Object.assign(Object.assign({},e),{TypeRef:(i=c,{Id:i?i.Id:null,HRef:null}),Date:null,Type:c?c.Designation:null,ConfirmationStateId:Object(x.b)(c,s)})):e})}(i,n,r,t.settings)})).subscribe(function(e){return t.updateLessonPresences$.next(e)})}},{key:"getNextPresenceType",value:function(e){return this.presenceTypes$.pipe(Object(C.a)(1),Object(P.a)(function(n){return e.getNextPresenceType(n)}))}},{key:"getPresenceControlEntry",value:function(e,n){return this.selectedPresenceControlEntries$.pipe(Object(C.a)(1),Object(P.a)(function(t){return t.find(function(t){return t.lessonPresence.StudentRef.Id===e&&t.lessonPresence.LessonRef.Id===n})||null}))}},{key:"hasUnconfirmedAbsences",value:function(e){return this.studentIdsWithUnconfirmedAbsences$.pipe(Object(P.a)(function(n){return n.includes(e.lessonPresence.StudentRef.Id)}))}},{key:"getBlockLessonPresences",value:function(n){var t=this;return Object(h.a)([this.lessonPresences$.pipe(Object(C.a)(1)),this.presenceTypes$.pipe(Object(C.a)(1))]).pipe(Object(P.a)(function(s){var c=e(s,2),i=c[0],r=c[1];return i.filter(function(e){return e.TeacherInformation===n.lessonPresence.TeacherInformation&&e.StudentRef.Id===n.lessonPresence.StudentRef.Id&&Object(x.a)(e,r.find(function(n){return n.Id===e.TypeRef.Id})||null,t.settings)}).sort(function(e,n){return e.LessonDateTimeFrom>n.LessonDateTimeFrom?1:-1}).reduce(function(e,s){return t.isPartOfBlock(s,e[e.length-1])?(e.push(s),e):e.find(function(e){return e.Id===n.lessonPresence.Id})?e:[s]},[])}))}},{key:"isPartOfBlock",value:function(e,n){return!n||e.LessonDateTimeFrom.getTime()-n.LessonDateTimeTo.getTime()<=18e5}},{key:"loadLessonPresencesByDate",value:function(e){return this.loadingService.load(function(e){return Object(U.a)(1,arguments),Object(A.a)(e,Date.now())}(e)?this.lessonPresencesService.getListForToday():this.lessonPresencesService.getListByDate(e))}},{key:"loadPresenceTypes",value:function(){return this.loadingService.load(this.presenceTypesService.presenceTypes$)}},{key:"loadStudentIdsWithUnconfirmedAbsences",value:function(){var e=this;return Object(v.a)(0,this.settings.unconfirmedAbsencesRefreshTime||void 0).pipe(Object(y.a)(function(){return e.lessonPresencesService.getListOfUnconfirmed()}),Object(P.a)(function(e){return Object(k.a)(e.map(function(e){return e.StudentRef.Id}))}))}},{key:"buildQueryParams",value:function(e,n,t){var s={date:Object(I.a)(e,"yyyy-MM-dd"),viewMode:t};return n&&(s.lesson=String(n.id)),s}},{key:"getSavedViewMode",value:function(){var e=this;return this.settingsService.getUserSettingsCst().pipe(Object(P.a)(function(e){return e.Settings}),Object(M.a)(),Object(S.a)(function(e){return"presenceControlViewMode"===e.Key}),Object(C.a)(1),Object(P.a)(function(e){return JSON.parse(e.Value)}),Object(y.a)(Object(Y.a)(ie.d)),Object(P.a)(function(n){return e.getViewModeForString(n.presenceControl)}),Object(O.a)())}},{key:"getViewModeForString",value:function(e){return e===ae.List?ae.List:ae.Grid}},{key:"updateSavedViewMode",value:function(e){var n={Key:"presenceControlViewMode",Value:JSON.stringify({presenceControl:e})},t=Object.assign({},Object(re.a)());return t.Settings.push(n),this.settingsService.updateUserSettingsCst(t)}}]),n}()).\u0275fac=function(e){return new(e||J)(ee.Zb(ce.a),ee.Zb(T.a),ee.Zb(te),ee.Zb(D.a),ee.Zb(se.a),ee.Zb(F.a),ee.Zb(R.a),ee.Zb(z.a),ee.Zb(oe.i))},J.\u0275prov=ee.Ib({token:J,factory:J.\u0275fac}),J),ue=o("LRne"),pe=o("Kqap"),be=o("w1tV"),fe=o("Kj3r"),ge=o("bOdf"),he=o("CqXF"),ve=o("JIr8"),me=o("PduT"),ye=o("8teX"),Oe=o("K+0v"),Pe=o("LpL1"),we=o("5eHb"),Ce=o("sYmb"),Me=function(e){return e.AddUpdateAction="ADD",e.RemoveUpdateAction="REMOVE",e}({}),Se=((X=function(){function e(n,t,s,c,i){a(this,e),this.toastr=n,this.translate=t,this.restService=s,this.presenceTypesService=c,this.settings=i,this.destroy$=new p.a,this.action$=new p.a,this.pendingUpdates$=this.action$.pipe(Object(pe.a)(this.reduceUpdates.bind(this),[]),Object(be.a)()),this.revertUpdates$=new p.a,this.performUpdates$=this.pendingUpdates$.pipe(Object(fe.a)(3e3),Object(S.a)(Object(Oe.d)(ye.b)),Object(ge.a)(this.performUpdates.bind(this))),this.stateUpdates$=Object(g.a)(this.pendingUpdates$,this.revertUpdates$).pipe(Object(fe.a)(20),Object(S.a)(Object(Oe.d)(ye.b))),this.performUpdates$.pipe(Object(b.a)(this.destroy$)).subscribe()}return l(e,[{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"updatePresenceTypes",value:function(e){var n=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.forEach(function(e){return n.dispatchAddUpdate(e,t)})}},{key:"performUpdates",value:function(e){var n=this,t=this.groupUpdates(e);return Object(h.a)(Object.keys(t).reduce(function(e,s){var c=t[s];return Object.keys(c).forEach(function(t){e.push(n.performUpdateForGroup(c[t]))}),e},[])).pipe(Object(he.a)(t))}},{key:"performUpdateForGroup",value:function(e){var n=this;return e.forEach(function(e){return n.dispatchRemoveUpdate(e.presence)}),this.performLessonPresencesUpdatesByIds(e[0].presence.LessonRef.Id,e.map(function(e){return e.presence.StudentRef.Id}),e[0].newPresenceTypeId).pipe(Object(ve.a)(function(t){return n.revertUpdatesAfterError(e,t)}))}},{key:"performLessonPresencesUpdatesByIds",value:function(e,n){var t=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return s?(s?this.presenceTypesService.getPresenceType(s):Object(ue.a)(null)).pipe(Object(y.a)(function(s){return t.restService.editLessonPresences([e],n,null==s?void 0:s.Id,Object(x.b)(s,t.settings)||void 0,Object(me.b)({disableErrorHandling:!0}))})):this.restService.removeLessonPresences([e],n,Object(me.b)({disableErrorHandling:!0}))}},{key:"revertUpdatesAfterError",value:function(e,n){return console.error("Bulk-update of lesson presences failed"),console.error(n),this.toastr.error(this.translate.instant("shared.lesson-presences-update.error")),this.revertUpdates$.next(e.map(function(e){return Object.assign(Object.assign({},e),{newPresenceTypeId:e.presence.TypeRef.Id})})),Object(ue.a)(void 0)}},{key:"groupUpdates",value:function(e){return e.reduce(function(e,n){var t=String(n.newPresenceTypeId&&n.newPresenceTypeId);return e[t]||(e[t]={}),Array.isArray(e[t][n.presence.LessonRef.Id])||(e[t][n.presence.LessonRef.Id]=[]),e[t][n.presence.LessonRef.Id].push(n),e},{})}},{key:"reduceUpdates",value:function(e,n){switch(n.type){case Me.AddUpdateAction:var t=n.payload,s=t.presence,c=t.newPresenceTypeId,r=e.findIndex(je(s));return-1===r?[].concat(i(e),[{presence:s,newPresenceTypeId:c}]):[].concat(i(e.slice(0,r)),[{presence:e[r].presence,newPresenceTypeId:c}],i(e.slice(r+1)));case Me.RemoveUpdateAction:return e.filter(Object(Oe.d)(je(n.payload)));default:return e}}},{key:"dispatchAddUpdate",value:function(e,n){this.action$.next({type:Me.AddUpdateAction,payload:{presence:e,newPresenceTypeId:n}})}},{key:"dispatchRemoveUpdate",value:function(e){this.action$.next({type:Me.RemoveUpdateAction,payload:e})}}]),e}()).\u0275fac=function(e){return new(e||X)(ee.Zb(we.b),ee.Zb(Ce.d),ee.Zb(Pe.a),ee.Zb(D.a),ee.Zb(z.a))},X.\u0275prov=ee.Ib({token:X,factory:X.\u0275fac,providedIn:"root"}),X);function je(e){return function(n){return n.presence.LessonRef.Id===e.LessonRef.Id&&n.presence.StudentRef.Id===e.StudentRef.Id}}var ke,Ie=o("qUtt"),Te=o("0HM3"),Re=((ke=function(){function e(n,t){a(this,e),this.state=n,this.lessonPresencesUpdateService=t,this.destroy$=new p.a}return l(e,[{key:"ngOnInit",value:function(){var e=this;this.lessonPresencesUpdateService.stateUpdates$.pipe(Object(b.a)(this.destroy$)).subscribe(function(n){return e.state.updateLessonPresencesTypes(n)})}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}}]),e}()).\u0275fac=function(e){return new(e||ke)(ee.Mb(le),ee.Mb(Se))},ke.\u0275cmp=ee.Gb({type:ke,selectors:[["erz-presence-control"]],features:[ee.yb([le,{provide:Ie.a,useExisting:le},{provide:Te.a,useValue:"/presence-control"}])],decls:1,vars:0,template:function(e,n){1&e&&ee.Nb(0,"router-outlet")},directives:[u.k],styles:[""],changeDetection:0}),ke),De=o("jiSq"),Le=(o("RYjX"),o("1kSV")),_e=o("3Pt+");function $e(e,n){if(1&e&&(ee.Sb(0,"div",5),ee.Sb(1,"input",6),ee.dc("change",function(){var e=n.$implicit;return e.selected=!e.selected}),ee.Rb(),ee.Sb(2,"label",7),ee.Dc(3),ee.gc(4,"date"),ee.gc(5,"date"),ee.Rb(),ee.Rb()),2&e){var t=n.$implicit,s=n.index,c=ee.fc();ee.zb(1),ee.nc("id","lesson-presence-",s,""),ee.lc("checked",t.selected),ee.zb(1),ee.Eb("font-weight-bold",t.lessonPresence.LessonDateTimeFrom===c.entry.lessonPresence.LessonDateTimeFrom),ee.nc("for","lesson-presence-",s,""),ee.zb(1),ee.Hc(" ",ee.ic(4,8,t.lessonPresence.LessonDateTimeFrom,"HH:mm"),"\u2013",ee.ic(5,11,t.lessonPresence.LessonDateTimeTo,"HH:mm")," ",t.lessonPresence.EventDesignation,"")}}var xe,ze=((xe=function(){function e(n){a(this,e),this.activeModal=n,this.lessonPresenceOptions=[]}return l(e,[{key:"ngOnInit",value:function(){var e=this;this.lessonPresenceOptions=this.blockLessonPresences.map(function(n){return e.createLessonPresenceOption(n)})}},{key:"getSelectedLessonPresences",value:function(){return this.lessonPresenceOptions.filter(function(e){return e.selected}).map(function(e){return e.lessonPresence})}},{key:"createLessonPresenceOption",value:function(e){return{lessonPresence:e,selected:!0}}}]),e}()).\u0275fac=function(e){return new(e||xe)(ee.Mb(Le.b))},xe.\u0275cmp=ee.Gb({type:xe,selectors:[["erz-presence-control-block-lesson-component"]],inputs:{entry:"entry",blockLessonPresences:"blockLessonPresences"},decls:13,vars:11,consts:[[1,"modal-body"],["class","form-group form-check",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"form-group","form-check"],["type","checkbox",1,"form-check-input",3,"id","checked","change"],[1,"form-check-label","d-block","text-truncate",3,"for"]],template:function(e,n){1&e&&(ee.Sb(0,"div",0),ee.Sb(1,"p"),ee.Dc(2),ee.gc(3,"translate"),ee.Rb(),ee.Sb(4,"form"),ee.Bc(5,$e,6,14,"div",1),ee.Rb(),ee.Rb(),ee.Sb(6,"div",2),ee.Sb(7,"button",3),ee.dc("click",function(){return n.activeModal.close()}),ee.Dc(8),ee.gc(9,"translate"),ee.Rb(),ee.Sb(10,"button",4),ee.dc("click",function(){return n.activeModal.close(n.getSelectedLessonPresences())}),ee.Dc(11),ee.gc(12,"translate"),ee.Rb(),ee.Rb()),2&e&&(ee.zb(2),ee.Fc(" ",ee.hc(3,5,"presence-control.block-lesson.text")," "),ee.zb(3),ee.lc("ngForOf",n.lessonPresenceOptions),ee.zb(3),ee.Fc(" ",ee.hc(9,7,"presence-control.block-lesson.cancel")," "),ee.zb(2),ee.lc("disabled",0===n.getSelectedLessonPresences().length),ee.zb(1),ee.Fc(" ",ee.hc(12,9,"presence-control.block-lesson.save")," "))},directives:[_e.r,_e.j,_e.k,oe.l],pipes:[Ce.c,oe.e],encapsulation:2}),xe),Ae=o("yl8S"),Ue=o("KCaQ");function Fe(e,n){if(1&e){var t=ee.Tb();ee.Sb(0,"div",5),ee.Sb(1,"input",6),ee.dc("change",function(){ee.vc(t);var e=n.$implicit;return ee.fc().onSelectionChange(e)}),ee.Rb(),ee.Sb(2,"label",7),ee.Dc(3),ee.Rb(),ee.Rb()}if(2&e){var s=n.$implicit,c=n.index,i=ee.fc();ee.zb(1),ee.nc("id","incident-",c,""),ee.lc("checked",s.id===i.selected.id)("value",s.id),ee.zb(1),ee.nc("for","incident-",c,""),ee.zb(1),ee.Fc(" ",s.label," ")}}var Ee,Be=((Ee=function(){function e(n,t){a(this,e),this.activeModal=n,this.translate=t,this.incidentOptions=[]}return l(e,[{key:"ngOnInit",value:function(){var e=this,n=this.createIncidentOption();this.incidentOptions=this.incidentTypes.map(function(n){return e.createIncidentOption(n)}),this.incidentOptions.unshift(n),this.selected=this.incidentOptions.find(function(n){var t;return n.id===(null===(t=e.incident)||void 0===t?void 0:t.Id)})||n}},{key:"createIncidentOption",value:function(e){return{id:e?e.Id:null,label:e?e.Designation:this.translate.instant("presence-control.incident.no-incident")}}},{key:"onSelectionChange",value:function(e){this.selected=e}},{key:"getSelectedIncident",value:function(){var e=this;return this.incidentTypes.find(function(n){var t;return n.Id===(null===(t=e.selected)||void 0===t?void 0:t.id)})||null}}]),e}()).\u0275fac=function(e){return new(e||Ee)(ee.Mb(Le.b),ee.Mb(Ce.d))},Ee.\u0275cmp=ee.Gb({type:Ee,selectors:[["erz-presence-control-incident"]],inputs:{incident:"incident",incidentTypes:"incidentTypes"},decls:13,vars:10,consts:[[1,"modal-body"],["class","form-group form-check",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"form-group","form-check"],["type","radio","name","incident",1,"form-check-input",3,"id","checked","value","change"],[1,"form-check-label",3,"for"]],template:function(e,n){1&e&&(ee.Sb(0,"div",0),ee.Sb(1,"p"),ee.Dc(2),ee.gc(3,"translate"),ee.Rb(),ee.Sb(4,"form"),ee.Bc(5,Fe,4,5,"div",1),ee.Rb(),ee.Rb(),ee.Sb(6,"div",2),ee.Sb(7,"button",3),ee.dc("click",function(){return n.activeModal.dismiss()}),ee.Dc(8),ee.gc(9,"translate"),ee.Rb(),ee.Sb(10,"button",4),ee.dc("click",function(){return n.activeModal.close(n.getSelectedIncident())}),ee.Dc(11),ee.gc(12,"translate"),ee.Rb(),ee.Rb()),2&e&&(ee.zb(2),ee.Fc(" ",ee.hc(3,4,"presence-control.incident.text")," "),ee.zb(3),ee.lc("ngForOf",n.incidentOptions),ee.zb(3),ee.Fc(" ",ee.hc(9,6,"presence-control.incident.cancel")," "),ee.zb(3),ee.Fc(" ",ee.hc(12,8,"presence-control.incident.save")," "))},directives:[_e.r,_e.j,_e.k,oe.l],pipes:[Ce.c],styles:["form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding-bottom:.75rem;border-bottom:1px solid #e9ecef}"]}),Ee),He=o("EOpz"),Ve=o("YDIV"),Ne=o("U+jE");function Ge(e,n){if(1&e){var t=ee.Tb();ee.Sb(0,"div",20),ee.dc("click",function(){return ee.vc(t),ee.fc().lessonDropdown.toggle()}),ee.Dc(1),ee.gc(2,"date"),ee.Sb(3,"span",21),ee.Dc(4),ee.gc(5,"date"),ee.Rb(),ee.Rb()}if(2&e){var s=ee.fc();ee.zb(1),ee.Fc(" ",ee.ic(2,2,s.selectedLesson.LessonDateTimeFrom,"HH:mm"),"\u2013"),ee.zb(3),ee.Ec(ee.ic(5,5,s.selectedLesson.LessonDateTimeTo,"HH:mm"))}}function Ze(e,n){if(1&e){var t=ee.Tb();ee.Sb(0,"div",27),ee.dc("click",function(){ee.vc(t);var e=n.$implicit;return ee.fc(2).selectLessonChange.emit(e)}),ee.Sb(1,"div",28),ee.Sb(2,"div"),ee.Dc(3),ee.gc(4,"date"),ee.gc(5,"date"),ee.Rb(),ee.Sb(6,"div",24),ee.Dc(7),ee.Rb(),ee.Sb(8,"div",24),ee.Dc(9),ee.Rb(),ee.Rb(),ee.Rb()}if(2&e){var s=n.$implicit,c=ee.fc(2);ee.Eb("active",s.id===c.selectedLesson.id),ee.zb(3),ee.Gc(" ",ee.ic(4,6,s.LessonDateTimeFrom,"HH:mm"),"\u2013",ee.ic(5,9,s.LessonDateTimeTo,"HH:mm")," "),ee.zb(4),ee.Ec(s.eventDesignations),ee.zb(2),ee.Ec(s.studyClassNumbers)}}function qe(e,n){if(1&e&&(ee.Sb(0,"div",22),ee.Sb(1,"div",23),ee.Sb(2,"div",24),ee.Dc(3),ee.Rb(),ee.Sb(4,"div",24),ee.Dc(5),ee.Rb(),ee.Rb(),ee.Sb(6,"div",25),ee.Bc(7,Ze,10,12,"div",26),ee.Rb(),ee.Rb()),2&e){var t=ee.fc();ee.zb(3),ee.Ec(t.selectedLesson.eventDesignations),ee.zb(2),ee.Ec(t.selectedLesson.studyClassNumbers),ee.zb(2),ee.lc("ngForOf",t.lessons)}}function Ke(e,n){if(1&e){var t=ee.Tb();ee.Sb(0,"button",29),ee.dc("click",function(){ee.vc(t);var e=ee.fc();return null==e.lessonDropdown?null:e.lessonDropdown.toggle()}),ee.Sb(1,"i",3),ee.Dc(2),ee.Rb(),ee.Rb()}if(2&e){var s=ee.fc();ee.zb(2),ee.Fc(" ",null!=s.lessonDropdown&&s.lessonDropdown.isOpen()?"keyboard_arrow_up":"keyboard_arrow_down"," ")}}function Je(e,n){if(1&e){var t=ee.Tb();ee.Sb(0,"button",30),ee.dc("click",function(){ee.vc(t);var e=n.$implicit;return ee.fc().viewModeChange.emit(e.viewMode)}),ee.Sb(1,"i",31),ee.Dc(2),ee.Rb(),ee.Rb()}if(2&e){var s=n.$implicit,c=ee.fc();ee.Eb("btn-secondary",s.viewMode===c.viewMode)("btn-link",s.viewMode!==c.viewMode)("active",s.viewMode===c.viewMode),ee.lc("disabled",!c.selectedLesson),ee.zb(2),ee.Ec(s.icon)}}var Xe=Le.f.prototype._positionMenu;Le.f.prototype._positionMenu=function(){for(var e,n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];var c=Xe.apply(this,t);if("lesson-dropdown"===this._anchor.nativeElement.id){var i=this._bodyContainer||this._menu.nativeElement,r=null===(e=i.style.transform)||void 0===e?void 0:e.match(/translate\(([0-9-\.]+)px, ([0-9-\.]+)px\)/);r&&parseFloat(r[1])<0&&(i.style.transform="translate(0px, ".concat(r[2],"px)"))}return c};var Qe,Ye=((Qe=function(){function e(){a(this,e),this.presentCount=null,this.absentCount=null,this.unapprovedCount=null,this.absentPrecedingCount=null,this.search="",this.selectLessonChange=new ee.n,this.selectDateChange=new ee.n,this.searchChange=new ee.n,this.viewModeChange=new ee.n,this.viewModeOptions=[{viewMode:ae.List,icon:"list"},{viewMode:ae.Grid,icon:"view_module"}]}return l(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||Qe)},Qe.\u0275cmp=ee.Gb({type:Qe,selectors:[["erz-presence-control-header"]],viewQuery:function(e,n){var t;1&e&&ee.Jc(Le.f,1),2&e&&ee.tc(t=ee.ec())&&(n.lessonDropdown=t.first)},inputs:{selectedLesson:"selectedLesson",lessons:"lessons",presentCount:"presentCount",absentCount:"absentCount",unapprovedCount:"unapprovedCount",absentPrecedingCount:"absentPrecedingCount",viewMode:"viewMode",selectDate:"selectDate",search:"search"},outputs:{selectLessonChange:"selectLessonChange",selectDateChange:"selectDateChange",searchChange:"searchChange",viewModeChange:"viewModeChange"},features:[ee.yb([{provide:Le.c,useClass:Le.d},{provide:Le.e,useClass:Ve.a}])],decls:37,vars:17,consts:[[1,"navigation"],[1,"lesson-date"],["type","button",1,"btn","btn-link",3,"click"],[1,"material-icons"],["placement","bottom","positionTarget",".lesson-date-input","ngbDatepicker","",1,"lesson-date-input",3,"ngModel","ngModelChange"],["d","ngbDatepicker"],["class","lesson-time",3,"click",4,"ngIf"],["ngbDropdown","","class","lesson-description","container","body","display","dynamic","placement","bottom",4,"ngIf"],["type","button","class","dropdown-caret btn btn-link",3,"click",4,"ngIf"],[1,"states"],[1,"state","present"],[1,"count"],[1,"state","absent"],[1,"state","unapproved"],[1,"state","previously-absent"],[1,"material-icons-outlined"],[1,"search-and-views"],[1,"search",3,"value","disabled","placeholder","label","valueChange"],[1,"views"],["type","button","class","view btn",3,"disabled","btn-secondary","btn-link","active","click",4,"ngFor","ngForOf"],[1,"lesson-time",3,"click"],[1,"lesson-time-to"],["ngbDropdown","","container","body","display","dynamic","placement","bottom",1,"lesson-description"],["id","lesson-dropdown","ngbDropdownToggle",""],[1,"text-truncate"],["ngbDropdownMenu","","aria-labelledby","lesson-dropdown"],["ngbDropdownItem","",3,"active","click",4,"ngFor","ngForOf"],["ngbDropdownItem","",3,"click"],[1,"lesson-entry"],["type","button",1,"dropdown-caret","btn","btn-link",3,"click"],["type","button",1,"view","btn",3,"disabled","click"],[1,"material-icons","align-middle"]],template:function(e,n){if(1&e){var t=ee.Tb();ee.Sb(0,"div",0),ee.Sb(1,"div",1),ee.Sb(2,"button",2),ee.dc("click",function(){return ee.vc(t),ee.uc(6).toggle()}),ee.Sb(3,"i",3),ee.Dc(4,"calendar_today"),ee.Rb(),ee.Rb(),ee.Sb(5,"input",4,5),ee.dc("ngModelChange",function(e){return n.selectDateChange.emit(e)}),ee.Rb(),ee.Rb(),ee.Bc(7,Ge,6,8,"div",6),ee.Bc(8,qe,8,3,"div",7),ee.Bc(9,Ke,3,1,"button",8),ee.Rb(),ee.Sb(10,"div",9),ee.Sb(11,"div",10),ee.Sb(12,"i",3),ee.Dc(13,"check_circle"),ee.Rb(),ee.Sb(14,"span",11),ee.Dc(15),ee.Rb(),ee.Rb(),ee.Sb(16,"div",12),ee.Sb(17,"i",3),ee.Dc(18,"cancel"),ee.Rb(),ee.Sb(19,"span",11),ee.Dc(20),ee.Rb(),ee.Rb(),ee.Sb(21,"div",13),ee.Sb(22,"i",3),ee.Dc(23,"help"),ee.Rb(),ee.Sb(24,"span",11),ee.Dc(25),ee.Rb(),ee.Rb(),ee.Sb(26,"div",14),ee.Sb(27,"i",15),ee.Dc(28,"info"),ee.Rb(),ee.Sb(29,"span",11),ee.Dc(30),ee.Rb(),ee.Rb(),ee.Rb(),ee.Sb(31,"div",16),ee.Sb(32,"erz-resettable-input",17),ee.dc("valueChange",function(e){return n.searchChange.emit(e)}),ee.gc(33,"translate"),ee.gc(34,"translate"),ee.Rb(),ee.Sb(35,"div",18),ee.Bc(36,Je,3,8,"button",19),ee.Rb(),ee.Rb()}2&e&&(ee.zb(5),ee.lc("ngModel",n.selectDate),ee.zb(2),ee.lc("ngIf",n.selectedLesson),ee.zb(1),ee.lc("ngIf",n.selectedLesson),ee.zb(1),ee.lc("ngIf",n.lessons.length>0),ee.zb(6),ee.Ec(null!=n.presentCount?n.presentCount:"?"),ee.zb(5),ee.Ec(null!=n.absentCount?n.absentCount:"?"),ee.zb(5),ee.Ec(null!=n.unapprovedCount?n.unapprovedCount:"?"),ee.zb(5),ee.Ec(null!=n.absentPrecedingCount?n.absentPrecedingCount:"?"),ee.zb(2),ee.lc("value",n.search)("disabled",!n.selectedLesson)("placeholder",ee.hc(33,13,"presence-control.header.search-by-name"))("label",ee.hc(34,15,"presence-control.header.search")),ee.zb(4),ee.lc("ngForOf",n.viewModeOptions))},directives:[Le.j,_e.b,_e.i,_e.l,oe.m,Ne.a,oe.l,Le.f,Le.i,Le.h,Le.g],pipes:[Ce.c,oe.e],styles:['[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1.125rem 1.5rem}.navigation[_ngcontent-%COMP%]{display:grid;grid-template-areas:". date time dropdown-caret" ". description description dropdown-caret";grid-template-columns:1fr auto auto 1fr}.lesson-date[_ngcontent-%COMP%]{grid-area:date;justify-self:end;display:flex;align-items:center;justify-content:end}.lesson-date[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0 .5ch 0 0}.lesson-date[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#33333d;position:relative;top:2px}.lesson-date-input[_ngcontent-%COMP%]{font-weight:600;background:transparent;border:none;width:11ch}.lesson-time[_ngcontent-%COMP%]{grid-area:time;cursor:pointer}.lesson-description[_ngcontent-%COMP%]{grid-area:description;overflow:hidden;text-align:center;cursor:pointer}.dropdown-toggle[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.dropdown-caret[_ngcontent-%COMP%]{grid-area:dropdown-caret;line-height:100%;text-align:left;color:#33333d}.dropdown-menu[_ngcontent-%COMP%]{width:50ch;padding:0;box-shadow:2px 2px 3px -1px rgba(0,0,0,.2)}@media (max-width:800px){.dropdown-menu[_ngcontent-%COMP%]{width:100vw}}.dropdown-item[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid #dee2e6}.states[_ngcontent-%COMP%]{margin:1.125rem 0;display:flex;justify-content:center}.state[_ngcontent-%COMP%]{margin-right:7%;display:flex}.state[_ngcontent-%COMP%]:last-child{margin-right:0}@media (min-width:1000px){.state[_ngcontent-%COMP%]{margin-right:6rem}}.state.present[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#28a745}.state.absent[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#dc3545}.state.unapproved[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#ffa814}.state.previously-absent[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:rgba(51,51,61,.5)}.state[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{margin-left:.3em;margin-top:1px}.search-and-views[_ngcontent-%COMP%]{padding-top:1.125rem;display:flex;justify-content:space-between;border-top:1px solid #e9ecef}.search[_ngcontent-%COMP%]{flex:auto;max-width:300px;margin-right:1.5rem}.views[_ngcontent-%COMP%]{display:flex}.view[_ngcontent-%COMP%]{padding:.25rem;color:#6c757d}.view.active[_ngcontent-%COMP%]{color:#33333d}@media (max-width:380px){[_nghost-%COMP%]{padding-left:.75rem;padding-right:.75rem}#search-addon[_ngcontent-%COMP%]{padding-left:.5rem;padding-right:.5rem}}@media (max-width:365px){.lesson-time[_ngcontent-%COMP%]{line-height:1}.lesson-time-to[_ngcontent-%COMP%]{display:block}.dropdown-caret[_ngcontent-%COMP%]{padding-left:0}}']}),Qe),We=o("jtHE");function en(e,n){if(1&e&&(ee.Sb(0,"div"),ee.Dc(1),ee.gc(2,"date"),ee.gc(3,"date"),ee.Rb()),2&e){var t=n.$implicit;ee.zb(1),ee.Ic(" ",ee.ic(2,4,t.LessonRef.From,"HH:mm"),"\u2013",ee.ic(3,7,t.LessonRef.To,"HH:mm")," ",t.LessonRef.EventDesignation,": ",t.Type," ")}}var nn,tn=((nn=function(){function e(n){a(this,e),this.activeModal=n}return l(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||nn)(ee.Mb(Le.b))},nn.\u0275cmp=ee.Gb({type:nn,selectors:[["erz-presence-control-preceding-absence"]],inputs:{precedingAbsences:"precedingAbsences"},decls:9,vars:7,consts:[[1,"modal-body"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(e,n){1&e&&(ee.Sb(0,"div",0),ee.Sb(1,"p"),ee.Dc(2),ee.gc(3,"translate"),ee.Rb(),ee.Bc(4,en,4,10,"div",1),ee.Rb(),ee.Sb(5,"div",2),ee.Sb(6,"button",3),ee.dc("click",function(){return n.activeModal.dismiss()}),ee.Dc(7),ee.gc(8,"translate"),ee.Rb(),ee.Rb()),2&e&&(ee.zb(2),ee.Fc(" ",ee.hc(3,3,"presence-control.preceding-absence.text")," "),ee.zb(2),ee.lc("ngForOf",n.precedingAbsences),ee.zb(3),ee.Fc(" ",ee.hc(8,5,"presence-control.preceding-absence.cancel")," "))},directives:[oe.l],pipes:[Ce.c,oe.e],styles:[""]}),nn),sn=o("PT0D"),cn=function(e){return["/presence-control/student",e]};function rn(e,n){if(1&e&&(ee.Nb(0,"erz-avatar",9),ee.gc(1,"async")),2&e){var t=ee.fc();ee.lc("studentId",ee.hc(1,3,t.studentId$))("link",ee.pc(5,cn,t.entry.lessonPresence.StudentRef.Id))("linkParams",t.profileReturnParams)}}function on(e,n){if(1&e&&(ee.Sb(0,"span"),ee.Dc(1),ee.Rb()),2&e){var t=ee.fc(2);ee.zb(1),ee.Ec(null==t.entry.presenceType?null:t.entry.presenceType.Designation)}}function an(e,n){if(1&e){var t=ee.Tb();ee.Sb(0,"button",10),ee.dc("click",function(){ee.vc(t);var e=ee.fc();return e.updatePresenceType(e.entry)}),ee.Bc(1,on,2,1,"span",11),ee.Rb()}if(2&e){var s=ee.fc();ee.zb(1),ee.lc("ngIf",!(null!=s.entry.presenceType&&s.entry.presenceType.IsIncident))}}function dn(e,n){if(1&e){var t=ee.Tb();ee.Sb(0,"button",12),ee.dc("click",function(){ee.vc(t);var e=ee.fc();return e.showPrecedingAbsences(e.entry)}),ee.Sb(1,"i",13),ee.Dc(2,"info"),ee.Rb(),ee.Rb()}}function ln(e,n){if(1&e){var t=ee.Tb();ee.Sb(0,"a",14),ee.dc("click",function(){ee.vc(t);var e=ee.fc();return e.updateIncident(e.entry)}),ee.Sb(1,"i",3),ee.Dc(2,"edit"),ee.Rb(),ee.Sb(3,"span"),ee.Dc(4),ee.gc(5,"translate"),ee.Rb(),ee.Rb()}if(2&e){var s=ee.fc();ee.zb(4),ee.Ec(ee.hc(5,1,(null==s.entry.presenceType?null:s.entry.presenceType.IsIncident)&&(null==s.entry.presenceType?null:s.entry.presenceType.Designation)||"presence-control.entry.incident"))}}var un,pn=((un=function(){function e(n,t,s){a(this,e),this.toastr=n,this.translate=t,this.modalService=s,this.hasUnconfirmedAbsences=!1,this.togglePresenceType=new ee.n,this.changeIncident=new ee.n,this.studentId$=new We.a(1)}return l(e,[{key:"classNames",get:function(){return[this.entry.presenceCategory,this.viewMode].join(" ")}},{key:"ngOnInit",value:function(){}},{key:"ngOnChanges",value:function(e){e.entry&&this.studentId$.next(e.entry.currentValue.lessonPresence.StudentRef.Id)}},{key:"isListViewMode",get:function(){return this.viewMode===ae.List}},{key:"updatePresenceType",value:function(e){e.canChangePresenceType?this.togglePresenceType.emit(e):this.toastr.warning(this.translate.instant("presence-control.entry.update-warning"))}},{key:"updateIncident",value:function(e){e.canChangeIncident&&this.changeIncident.emit(e)}},{key:"showPrecedingAbsences",value:function(e){this.modalService.open(tn).componentInstance.precedingAbsences=e.precedingAbsences}}]),e}()).\u0275fac=function(e){return new(e||un)(ee.Mb(we.b),ee.Mb(Ce.d),ee.Mb(Le.k))},un.\u0275cmp=ee.Gb({type:un,selectors:[["erz-presence-control-entry"]],hostVars:2,hostBindings:function(e,n){2&e&&ee.Bb(n.classNames)},inputs:{entry:"entry",hasUnconfirmedAbsences:"hasUnconfirmedAbsences",viewMode:"viewMode",profileReturnParams:"profileReturnParams"},outputs:{togglePresenceType:"togglePresenceType",changeIncident:"changeIncident"},features:[ee.xb],decls:13,vars:13,consts:[["class","avatar large",3,"studentId","link","linkParams",4,"ngIf"],["type","button","class","presence-category designation btn btn-link",3,"click",4,"ngIf"],["type","button",1,"presence-category","status","btn","btn-link",3,"click"],[1,"material-icons"],["type","button","class","previously-absent btn btn-link",3,"click",4,"ngIf"],[1,"student-name",3,"routerLink","queryParams"],[1,"text-truncate"],[1,"unconfirmed-absences"],["class","incident btn btn-link",3,"click",4,"ngIf"],[1,"avatar","large",3,"studentId","link","linkParams"],["type","button",1,"presence-category","designation","btn","btn-link",3,"click"],[4,"ngIf"],["type","button",1,"previously-absent","btn","btn-link",3,"click"],[1,"material-icons-outlined"],[1,"incident","btn","btn-link",3,"click"]],template:function(e,n){1&e&&(ee.Bc(0,rn,2,7,"erz-avatar",0),ee.Bc(1,an,2,1,"button",1),ee.Sb(2,"button",2),ee.dc("click",function(){return n.updatePresenceType(n.entry)}),ee.Sb(3,"i",3),ee.Dc(4),ee.Rb(),ee.Rb(),ee.Bc(5,dn,3,0,"button",4),ee.Sb(6,"a",5),ee.Sb(7,"span",6),ee.Dc(8),ee.Rb(),ee.Sb(9,"span",7),ee.Dc(10),ee.gc(11,"translate"),ee.Rb(),ee.Rb(),ee.Bc(12,ln,6,3,"a",8)),2&e&&(ee.lc("ngIf",!n.isListViewMode),ee.zb(1),ee.lc("ngIf",n.entry.showDesignation),ee.zb(3),ee.Ec(n.entry.presenceCategoryIcon),ee.zb(1),ee.lc("ngIf",(null==n.entry.precedingAbsences?null:n.entry.precedingAbsences.length)>0),ee.zb(1),ee.lc("routerLink",ee.pc(11,cn,n.entry.lessonPresence.StudentRef.Id))("queryParams",n.profileReturnParams),ee.zb(2),ee.Ec(n.entry.lessonPresence.StudentFullName),ee.zb(2),ee.Fc(" ",n.hasUnconfirmedAbsences?ee.hc(11,9,"presence-control.entry.unconfirmed-absences"):""," "),ee.zb(2),ee.lc("ngIf",n.entry.canChangeIncident))},directives:[oe.m,u.i,sn.a],pipes:[Ce.c,oe.b],styles:['[_nghost-%COMP%]{padding:3rem 1.5rem;background-color:#fff;display:grid;grid-template-areas:"avatar status designation previously-absent" "avatar student-name student-name student-name" "avatar incident incident incident";grid-template-columns:-webkit-min-content -webkit-min-content 3fr -webkit-min-content;grid-template-columns:min-content min-content 3fr min-content}[_nghost-%COMP%] > *[_ngcontent-%COMP%]{align-self:center}.presence-category[_ngcontent-%COMP%]{text-decoration:none}.presence-category[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{top:.1875rem}.absent[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#dc3545}.present[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#28a745}.unapproved[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#ffa814}.designation[_ngcontent-%COMP%], .incident[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .student-name[_ngcontent-%COMP%], a.incident[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.avatar[_ngcontent-%COMP%]{grid-area:avatar;margin-right:2.25rem}.status[_ngcontent-%COMP%]{grid-area:status}.status[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:2.75rem}.designation[_ngcontent-%COMP%]{grid-area:designation;text-align:left;line-height:3.125rem}.previously-absent[_ngcontent-%COMP%]{grid-area:previously-absent;text-decoration:none;color:rgba(51,51,61,.5);justify-self:end}.student-name[_ngcontent-%COMP%]{color:#33333d;grid-area:student-name;display:flex;flex-direction:column}.unconfirmed-absences[_ngcontent-%COMP%]{color:#dc3545;font-size:1.1rem;line-height:1}.incident[_ngcontent-%COMP%]{color:rgba(51,51,61,.5);padding-right:.75rem;grid-area:incident;display:flex}.incident[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.3em}.grid[_nghost-%COMP%]   .designation[_ngcontent-%COMP%], .grid[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{align-self:start;margin-left:-.75rem;margin-top:-.375rem}.grid[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{align-self:end;margin-left:-.75rem;margin-bottom:-.375rem}.grid[_nghost-%COMP%]   .previously-absent[_ngcontent-%COMP%]{padding-right:0;align-self:start}.grid[_nghost-%COMP%]   .unconfirmed-absences[_ngcontent-%COMP%]{height:1.1rem}.list[_nghost-%COMP%]{grid-template-areas:"student-name status designation incident previously-absent";grid-template-columns:3fr -webkit-min-content 3fr 2fr 3em;grid-template-columns:3fr min-content 3fr 2fr 3em;padding:.5rem .5rem .5rem 1rem}.list[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{justify-self:start}@media (max-width:750px){.list[_nghost-%COMP%]{grid-template-areas:"student-name student-name student-name previously-absent" "status incidentordesignation incidentordesignation incidentordesignation";grid-template-columns:-webkit-min-content 1fr 1fr -webkit-min-content;grid-template-columns:min-content 1fr 1fr min-content;row-gap:1.5rem}.list[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.list[_nghost-%COMP%]   .designation[_ngcontent-%COMP%], .list[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{grid-area:incidentordesignation}.list[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{justify-self:end}.list[_nghost-%COMP%]   .previously-absent[_ngcontent-%COMP%]{padding-top:0;align-self:start}}']}),un),bn=o("4Kj8"),fn=function(e){return{returnparams:e}};function gn(e,n){if(1&e){var t=ee.Tb();ee.Sb(0,"erz-presence-control-entry",7),ee.dc("togglePresenceType",function(e){return ee.vc(t),ee.fc(5).togglePresenceType(e)})("changeIncident",function(e){return ee.vc(t),ee.fc(5).changeIncident(e)}),ee.gc(1,"async"),ee.gc(2,"async"),ee.gc(3,"async"),ee.Rb()}if(2&e){var s=n.$implicit,c=ee.fc(5);ee.lc("entry",s)("hasUnconfirmedAbsences",ee.hc(1,4,c.state.hasUnconfirmedAbsences(s)))("viewMode",ee.hc(2,6,c.state.viewMode$))("profileReturnParams",ee.pc(10,fn,ee.hc(3,8,c.state.queryParamsString$)))}}function hn(e,n){if(1&e&&(ee.Qb(0),ee.Sb(1,"div"),ee.gc(2,"async"),ee.Bc(3,gn,4,12,"erz-presence-control-entry",6),ee.Rb(),ee.Pb()),2&e){var t=ee.fc(3).erzLet,s=ee.fc();ee.zb(1),ee.Cb("default-entries entries view-mode-",ee.hc(2,4,s.state.viewMode$),""),ee.zb(2),ee.lc("ngForOf",t.entries)}}function vn(e,n){1&e&&(ee.Sb(0,"p",8),ee.Dc(1),ee.gc(2,"translate"),ee.Rb()),2&e&&(ee.zb(1),ee.Fc(" ",ee.hc(2,1,"presence-control.no-lesson-presences")," "))}function mn(e,n){if(1&e&&(ee.Qb(0),ee.Bc(1,hn,4,6,"ng-container",1),ee.Bc(2,vn,3,3,"ng-template",null,5,ee.Cc),ee.Pb()),2&e){var t=ee.uc(3),s=ee.fc(2).erzLet;ee.zb(1),ee.lc("ngIf",(null==s.entries?null:s.entries.length)>0)("ngIfElse",t)}}function yn(e,n){1&e&&(ee.Sb(0,"p",9),ee.Dc(1),ee.gc(2,"translate"),ee.Rb()),2&e&&(ee.zb(1),ee.Ec(ee.hc(2,1,"presence-control.no-lessons")))}function On(e,n){if(1&e){var t=ee.Tb();ee.Qb(0),ee.Sb(1,"erz-presence-control-header",3),ee.dc("searchChange",function(e){return ee.vc(t),ee.fc(2).search$.next(e)})("viewModeChange",function(e){return ee.vc(t),ee.fc(2).state.setViewMode(e)})("selectDateChange",function(e){return ee.vc(t),ee.fc(2).state.setDate(e)})("selectLessonChange",function(e){return ee.vc(t),ee.fc(2).state.setLesson(e)}),ee.gc(2,"async"),ee.gc(3,"async"),ee.gc(4,"async"),ee.gc(5,"async"),ee.gc(6,"async"),ee.gc(7,"async"),ee.gc(8,"async"),ee.Rb(),ee.Bc(9,mn,4,2,"ng-container",1),ee.Bc(10,yn,3,3,"ng-template",null,4,ee.Cc),ee.Pb()}if(2&e){var s=ee.uc(11),c=ee.fc().erzLet,i=ee.fc();ee.zb(1),ee.lc("selectedLesson",c.lesson)("lessons",c.lessons)("presentCount",ee.hc(2,11,i.state.presentCount$))("absentCount",ee.hc(3,13,i.state.absentCount$))("unapprovedCount",ee.hc(4,15,i.state.unapprovedCount$))("absentPrecedingCount",ee.hc(5,17,i.state.absentPrecedingCount$))("viewMode",ee.hc(6,19,i.state.viewMode$))("selectDate",ee.hc(7,21,i.state.selectedDate$))("search",ee.hc(8,23,i.search$)),ee.zb(8),ee.lc("ngIf",c.lesson)("ngIfElse",s)}}function Pn(e,n){1&e&&ee.Nb(0,"erz-spinner")}function wn(e,n){if(1&e&&(ee.Qb(0),ee.Bc(1,On,12,25,"ng-container",1),ee.gc(2,"async"),ee.Bc(3,Pn,1,0,"ng-template",null,2,ee.Cc),ee.Pb()),2&e){var t=ee.uc(4),s=ee.fc();ee.zb(1),ee.lc("ngIf",!ee.hc(2,2,s.state.loading$))("ngIfElse",t)}}var Cn,Mn,Sn,jn=function(e,n,t){return{lesson:e,lessons:n,entries:t}},kn=((Cn=function(){function e(n,t,s,c,i,r){a(this,e),this.state=n,this.lessonPresencesUpdateService=t,this.presenceTypesService=s,this.modalService=c,this.scrollPosition=i,this.route=r,this.search$=new f.a(""),this.entries$=Object(h.a)([this.state.selectedPresenceControlEntries$,this.search$]).pipe(Object(P.a)(Object(L.a)(De.a)),Object(O.a)(1)),this.destroy$=new p.a}return l(e,[{key:"ngOnInit",value:function(){this.route.queryParams.pipe(Object(b.a)(this.destroy$)).subscribe(this.restoreStateFromParams.bind(this))}},{key:"ngAfterViewInit",value:function(){this.scrollPosition.restore()}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"doTogglePresenceType",value:function(e,n){var t=this;this.state.getNextPresenceType(e).subscribe(function(s){return t.lessonPresencesUpdateService.updatePresenceTypes(n||[e.lessonPresence],s?s.Id:null)})}},{key:"togglePresenceType",value:function(e){var n=this;this.state.getBlockLessonPresences(e).pipe(Object(C.a)(1)).subscribe(function(t){if(1===t.length)n.doTogglePresenceType(e);else{var s=n.modalService.open(ze);s.componentInstance.entry=e,s.componentInstance.blockLessonPresences=t,s.result.then(function(t){t&&n.doTogglePresenceType(e,t)},function(){})}})}},{key:"updateIncident",value:function(e,n){this.lessonPresencesUpdateService.updatePresenceTypes([e.lessonPresence],n)}},{key:"changeIncident",value:function(e){var n=this;this.presenceTypesService.incidentTypes$.subscribe(function(t){var s=n.modalService.open(Be);s.componentInstance.incident=t.find(function(n){var t;return n.Id===(null===(t=e.presenceType)||void 0===t?void 0:t.Id)})||null,s.componentInstance.incidentTypes=t,s.result.then(function(t){n.updateIncident(e,(null==t?void 0:t.Id)||null)},function(){})})}},{key:"restoreStateFromParams",value:function(e){var n=this;e.date&&this.state.setDate(Object(Ue.c)(e.date));var t=String(e.lesson);t&&this.state.lessons$.pipe(Object(C.a)(1)).subscribe(function(e){var s=e.find(function(e){return e.id===t});s&&n.state.setLesson(s)}),e.viewMode&&de.includes(e.viewMode)&&this.state.setViewMode(e.viewMode)}}]),e}()).\u0275fac=function(e){return new(e||Cn)(ee.Mb(le),ee.Mb(Se),ee.Mb(D.a),ee.Mb(Le.k),ee.Mb(Ae.a),ee.Mb(u.a))},Cn.\u0275cmp=ee.Gb({type:Cn,selectors:[["erz-presence-control-list"]],decls:4,vars:11,consts:[[4,"erzLet"],[4,"ngIf","ngIfElse"],["loading",""],[3,"selectedLesson","lessons","presentCount","absentCount","unapprovedCount","absentPrecedingCount","viewMode","selectDate","search","searchChange","viewModeChange","selectDateChange","selectLessonChange"],["noLessons",""],["noLessonPresences",""],[3,"entry","hasUnconfirmedAbsences","viewMode","profileReturnParams","togglePresenceType","changeIncident",4,"ngFor","ngForOf"],[3,"entry","hasUnconfirmedAbsences","viewMode","profileReturnParams","togglePresenceType","changeIncident"],[1,"mt-3","pl-3"],[1,"mt-3","px-3"]],template:function(e,n){1&e&&(ee.Bc(0,wn,5,4,"ng-container",0),ee.gc(1,"async"),ee.gc(2,"async"),ee.gc(3,"async")),2&e&&ee.lc("erzLet",ee.rc(7,jn,ee.hc(1,1,n.state.selectedLesson$),ee.hc(2,3,n.state.lessons$),ee.hc(3,5,n.entries$)))},directives:[He.a,oe.m,Ye,oe.l,pn,bn.a],pipes:[oe.b,Ce.c],styles:["erz-presence-control-entry[_ngcontent-%COMP%]{border-bottom:1px solid #e9ecef}.entries.view-mode-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}@media (min-width:400px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%;border-right:1px solid #e9ecef}}@media (min-width:800px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:50%;border-right:1px solid #e9ecef}}@media (min-width:1200px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:33.3333333333%;border-right:1px solid #e9ecef}}@media (min-width:1600px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:25%;border-right:1px solid #e9ecef}}@media (min-width:2000px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:20%;border-right:1px solid #e9ecef}}@media (min-width:2400px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:16.6666666667%;border-right:1px solid #e9ecef}}"],changeDetection:0}),Cn),In=o("hH5/"),Tn=[{path:"",component:Re,children:[{path:"",component:kn,data:{restoreScrollPositionFrom:["/presence-control/student/:id"]}},{path:"student/:id",children:[{path:"",component:o("ccj6").a},{path:"confirm",component:In.a}]}]}],Rn=((Sn=function e(){a(this,e)}).\u0275fac=function(e){return new(e||Sn)},Sn.\u0275mod=ee.Kb({type:Sn}),Sn.\u0275inj=ee.Jb({imports:[[u.j.forChild(Tn)],u.j]}),Sn),Dn=((Mn=function e(){a(this,e)}).\u0275fac=function(e){return new(e||Mn)},Mn.\u0275mod=ee.Kb({type:Mn}),Mn.\u0275inj=ee.Jb({imports:[[d.a,Rn]]}),Mn)}}])}();