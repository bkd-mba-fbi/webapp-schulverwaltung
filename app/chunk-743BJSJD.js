import{a as se,b as be}from"./chunk-I27QBANF.js";import{a as fn,b as bn}from"./chunk-OLKZTOFS.js";import{b as yn}from"./chunk-MEKBAWE7.js";import{b as _n}from"./chunk-G4BBF67E.js";import{a as vn}from"./chunk-ULG2PTMU.js";import{a as un,b as gn}from"./chunk-L4EIOU3Y.js";import{e as mn}from"./chunk-7TBS4XHE.js";import{c as Ze,g as ln}from"./chunk-E4XBZIF7.js";import"./chunk-XB5EAG3V.js";import{b as pn}from"./chunk-HQEU7IQK.js";import{a as on,b as rn}from"./chunk-EXHTRNRL.js";import"./chunk-XVWN6PY7.js";import{a as Pn}from"./chunk-D5RVOUSN.js";import{b as Ge,c as nn,e as je}from"./chunk-5VGCXJV7.js";import{B as tn,C as oe,E as tt,G as dn,H as Cn,b as Ht,f as Ce,g as zt,k as Yt,l as Ne,p as Ue,q as Jt,r as Xt,s as Xe,x as en}from"./chunk-CC2ZY7RA.js";import{a as jt}from"./chunk-I6B7SZW4.js";import"./chunk-JQMOLUIY.js";import{a as ie}from"./chunk-42VZKNAZ.js";import"./chunk-Y4QYVF5K.js";import"./chunk-QENSBOG3.js";import{e as Kt,p as Qt}from"./chunk-QGDSASTQ.js";import{f as Re,g as W}from"./chunk-2QS7YZBA.js";import{a as Nt}from"./chunk-7PYQWJKW.js";import{a as hn,b as He}from"./chunk-7UXNICGW.js";import{c as ve}from"./chunk-Z73OPYRC.js";import"./chunk-CDKWW32G.js";import{b as et}from"./chunk-MGLEQUF6.js";import{a as Zt}from"./chunk-YHCR7GAG.js";import"./chunk-FVPRCQLC.js";import{a as qt,e as sn,f as an,g as cn,i as _e}from"./chunk-YNODG5RP.js";import"./chunk-SNNR7FJ6.js";import{b as Ut}from"./chunk-EFJ6WEH7.js";import{h as Et,i as Bt,j as Ye,k as Vt,l as Ft,m as At,o as Rt,p as Gt,q as he,r as ne}from"./chunk-HVLHLZKP.js";import{b as Wt,d as Ae}from"./chunk-DQAQYQ7K.js";import{a as fe}from"./chunk-LYDHS67M.js";import{A as Je,G as Fe,N as Me,f as ze,h as Tt,q as Be,r as It,t as Ve,z as H}from"./chunk-ZXUJZ6KS.js";import{$ as Qe,$d as Lt,Ae as B,C as Pe,Cc as d,Dc as m,E as at,Ec as N,G as Y,Gb as T,H as Se,Ha as mt,Hb as Oe,Ia as ut,Ib as I,Kb as gt,L as ct,Lb as O,Mb as E,N as pt,Nb as y,O as xe,Ob as a,Pb as c,Pd as kt,Q as D,Qb as j,Qc as wt,Qd as $t,S as Le,Ub as P,Wb as C,Xb as f,Y as lt,Z as dt,_ as L,a as ae,aa as De,b as ce,ba as M,bd as Mt,cc as ht,ce as Dt,da as F,db as s,dc as ft,de as me,ec as Ct,ee as ue,fd as Ee,gc as K,ge as Ot,hc as pe,he as ge,ic as u,id as ee,j as w,ja as A,jc as S,jd as de,k as $e,kc as b,l as ye,lc as _t,mc as vt,nc as bt,oa as l,ob as k,oc as yt,pc as Pt,q as z,qc as St,rc as R,sc as X,tc as Q,ua as _,v as g,va as v,vc as G,w as x,wb as J,wc as le,we as te,xc as we,yc as Z,zc as xt,ze as q}from"./chunk-GP622B77.js";function Sn(i){return Re(i,Date.now())}function xn(i,n){return+W(i)<+W(n)}function wn(i,n){return+W(i)==+W(n)}function Mn(i,n){return Ge(Re(n?.in||i,i),Sn(n?.in||i))}function Tn(i,n,r){let e=+W(i,r?.in),[t,o]=[+W(n.start,r?.in),+W(n.end,r?.in)].sort((p,h)=>p-h);return e>=t&&e<=o}function In(i,n,r){let e=n.map(o=>({eventId:o,group:i})),t=r.map(o=>e.find(p=>p.eventId===o.eventId)||o);return[...new Set([...t,...e])].filter(o=>o.group!==null)}var nt=(()=>{let n=class n extends en{};n.\u0275fac=(()=>{let e;return function(o){return(e||(e=ut(n)))(o||n)}})(),n.\u0275prov=A({token:n,factory:n.\u0275fac});let i=n;return i})();function kn(i,n){return n?[...i].sort(Xn(n)):i}function Xn(i){return(n,r)=>{switch(i.primarySortKey){case"name":{let e=n.name.localeCompare(r.name);return i.ascending?e:e*-1}case"group":{let e=n.detail.Value?String(n.detail.Value):"",t=r.detail.Value?String(r.detail.Value):"",o=e.localeCompare(t);return i.ascending?o:o*-1}default:throw new Zt(i.primarySortKey,"Unhandled sort criteria")}}}function $n(i,n){return i.map(r=>Zn(r,n))}function Zn(i,n){return{id:i.IdPerson,name:n.find(r=>r.StudentRef.Id===i.IdPerson)?.StudentFullName||"",group:i.Value?String(i.Value):"",detail:i}}function Ln(i,n){return i.filter(r=>r.VssId===n.subscriptionDetailGroupId)}function it(i,n){return i.find(r=>r.VssId===n.subscriptionDetailGroupId)}var Dn="presence-control-group",re=(()=>{let n=class n{constructor(){this.userSettings=l(be),this.eventService=l(hn),this.subscriptionDetailsService=l(He),this.loadingService=l(ie),this.settings=l(H),this.selectGroup$=new w,this.selectedLesson$=new ye,this.lessonPresences$=new ye,this.reloadSubscriptionDetails$=new w,this.defaultGroup=null,this.savedGroup$=this.selectedLesson$.pipe(M(e=>this.userSettings.getPresenceControlGroupView().pipe(g(t=>this.findGroupByLesson(t,e))))),this.group$=Y(this.selectGroup$,this.savedGroup$).pipe(De(this.defaultGroup),L(1)),this.loading$=this.loadingService.loading(Dn),this.subscriptionDetailsDefinitions$=this.selectedLesson$.pipe(g(e=>e?.getEventIds()||[]),M(e=>Pe(e.map(t=>this.eventService.getSubscriptionDetailsDefinitions(t)))),L(1)),this.groupsAvailability$=this.subscriptionDetailsDefinitions$.pipe(g(e=>e.every(t=>it(t,this.settings))),L(1)),this.subscriptionDetails$=x([this.selectedLesson$,this.groupsAvailability$,this.reloadSubscriptionDetails$.pipe(g(()=>!1),De(!0))]).pipe(M(([e,t,o])=>e&&t?this.loadSubscriptionDetailsForLesson(e,o):z([])),g(e=>Ln(e,this.settings)),L(1)),this.subscriptionDetailPersonIds$=x([this.group$,this.subscriptionDetails$]).pipe(g(([e,t])=>t.filter(o=>o.Value===e).map(o=>o.IdPerson)),De([]))}selectGroup(e){this.selectGroup$.next(e)}setSelectedLesson(e){this.selectedLesson$.next(e)}setLessonPresences(e){this.lessonPresences$.next(e)}getSubscriptionDetailsDefinitions(){return this.subscriptionDetailsDefinitions$.pipe(g(Je),g(e=>it(e,this.settings)))}getSubscriptionDetailsForStudents(){return x([this.subscriptionDetails$,this.lessonPresences$]).pipe(g(oe($n)))}reloadSubscriptionDetails(){this.reloadSubscriptionDetails$.next(void 0)}loadSubscriptionDetailsForLesson(e,t=!0){return this.loadingService.load(Pe(Me(e.getEventIds()).map(o=>this.subscriptionDetailsService.getListForEvent(o))),t?void 0:Dn).pipe(g(Je))}findGroupByLesson(e,t){return e.find(p=>p.eventId===t?.getEventIds()[0])?.group||this.defaultGroup}};n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=A({token:n,factory:n.\u0275fac});let i=n;return i})();var On=(()=>{let n=class n extends qt{constructor(){let e=l(Tt),t=l(H);super(e,t,Ze,"LessonTeachers")}loadOtherTeachersLessonAbsences(e,t,o){let p=zt(new Date,60),h=`${this.baseUrl}/except/${e}/LessonAbsences?expand=LessonRef&filter.CreatedOn=>${$t(p)}`;return t&&t.length>0&&(h=h.concat("&filter.StudentRef=;"+t.join(";"))),this.http.get(h,{params:o}).pipe(M(Ut(Ze)))}};n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"});let i=n;return i})();function En(i,n){return i===null&&n===null||i!==null&&n!==null&&i.TeacherInformation===n.TeacherInformation&&i.LessonDateTimeFrom.getTime()===n.LessonDateTimeFrom.getTime()&&i.LessonDateTimeTo.getTime()===n.LessonDateTimeTo.getTime()}function Bn(i){let n=new ot(i.TeacherInformation,i.LessonDateTimeFrom,i.LessonDateTimeTo);return n.addLesson(i),n}var ot=class{constructor(n,r,e){this.TeacherInformation=n,this.LessonDateTimeFrom=r,this.LessonDateTimeTo=e,this.lessons=[]}addLesson(n){this.lessons.some(r=>Ue(r,n))||(this.lessons.push(n),this.updateId(),this.updateStudyClassNumbers(),this.updateEventDesignations())}getIds(){return[...new Set(this.lessons.map(n=>n.LessonRef.Id))]}getEventIds(){return[...new Set(this.lessons.map(n=>n.EventRef.Id))]}updateId(){this.id=[...new Set(this.lessons.map(n=>n.LessonRef.Id).sort())].join("-")}updateStudyClassNumbers(){this.studyClassNumbers=[...new Set(this.lessons.map(n=>n.StudyClassNumber).sort((n,r)=>n.localeCompare(r)))].join(", ")}updateEventDesignations(){this.eventDesignations=[...new Set(this.lessons.map(n=>n.EventDesignation).sort())].join(", ")}};function Vn(i){return ei(i).reduce((n,r)=>{let e=n.find(o=>En(o,r));if(e)return e.addLesson(r),n;let t=Bn(r);return[...n,t]},[]).sort(Xe)}function Fn(i){if(i.length===0)return null;let n=new Date;if(i=[...i].sort(Xe),Ge(n,i[0].LessonDateTimeFrom)){for(let r of i)if(xn(n,r.LessonDateTimeFrom)||Tn(n,{start:r.LessonDateTimeFrom,end:r.LessonDateTimeTo}))return r;return i[i.length-1]}return i[0]}function ei(i){return i.reduce((n,r)=>n.some(e=>Ue(e,r))?n:[...n,r],[])}function An(i,n,r,e){return i.map(t=>{let o=n.find(p=>ti(p.presence,t));if(o){let p;return!o.newPresenceTypeId&&t.Comment?p=r.find(h=>h.IsComment)||null:p=r.find(h=>h.Id===o.newPresenceTypeId)||null,ce(ae({},t),{TypeRef:ni(p),Date:null,Type:p?p.Designation:null,ConfirmationStateId:Ne(p,e)})}return t})}function ti(i,n){return i.LessonRef.Id===n.LessonRef.Id&&i.StudentRef.Id===n.StudentRef.Id}function ni(i){return{Id:i?i.Id:null,HRef:null}}function qe(i){return n=>n.reduce((r,e)=>r+(e.presenceCategory===i?1:0),0)}function Rn(){return i=>i.reduce((n,r)=>n+(r.precedingAbsences&&r.precedingAbsences.length>0?1:0),0)}var Gn=Object.values(se),U=(()=>{let n=class n{constructor(){this.userSettings=l(be),this.lessonPresencesService=l(je),this.lessonTeacherService=l(On),this.presenceTypesService=l(Ce),this.groupService=l(re),this.dropDownItemsService=l(jt),this.loadingService=l(ie),this.storageService=l(Nt),this.settings=l(H),this.location=l(Mt),this.selectedDateSubject$=new $e(new Date),this.selectedDate$=this.selectedDateSubject$.asObservable().pipe(g(e=>Kt(e)),Le(Fe)),this.viewModeSubject$=new w,this.viewMode$=Y(this.viewModeSubject$,this.userSettings.getPresenceControlViewMode().pipe(D(1))),this.lessons$=this.selectedDate$.pipe(M(e=>this.loadLessonsByDate(e)),L(1)),this.selectLessonId$=new w,this.selectLesson$=this.selectLessonId$.pipe(M(e=>this.getLessonById(e))),this.selectedLesson$=x([sn(this.selectLesson$.pipe(Le((e,t)=>Fe(e,t))),an(this.settings.lessonPresencesRefreshTime)),this.lessons$]).pipe(g(([e,t])=>t.find(o=>o.id===e.id)?e:null),L(1)),this.studyClassCount$=this.selectedLesson$.pipe(g(e=>e?.lessons.length||0)),this.updateLessonPresences$=new w,this.reloadLessonPresences$=new w,this.lessonPresences$=Y(cn(this.selectedLesson$,this.reloadLessonPresences$).pipe(M(e=>e?this.loadLessonPresencesByLesson(e):z([]))),this.updateLessonPresences$).pipe(L(1)),this.presenceTypes$=this.loadPresenceTypes().pipe(L(1)),this.reloadStudentIdsWithUnconfirmedAbsences$=new w,this.studentIdsWithUnconfirmedAbsences$=Y(this.selectedDate$,this.selectedLesson$.pipe(Qe(1)),this.reloadStudentIdsWithUnconfirmedAbsences$).pipe(M(()=>this.loadStudentIdsWithUnconfirmedAbsences()),L(1)),this.loading$=this.loadingService.loading$,this.absenceConfirmationStates$=this.dropDownItemsService.getAbsenceConfirmationStates().pipe(L(1)),this.studentIds$=this.lessonPresences$.pipe(g(e=>Me(e.map(t=>t.StudentRef.Id))),L(1)),this.otherTeachersAbsences$=x([this.studentIds$.pipe(Le(Fe)),this.selectedDate$]).pipe(M(([e,t])=>e.length>0&&Mn(t)?this.lessonTeacherService.loadOtherTeachersLessonAbsences(this.getMyself(),e):z([])),L(1)),this.groupsAvailability$=this.groupService.groupsAvailability$,this.presenceControlEntries$=x([this.selectedLesson$,this.lessonPresences$,this.presenceTypes$,this.absenceConfirmationStates$,this.otherTeachersAbsences$]).pipe(g(oe(Jt))),this.presenceControlEntriesByGroup$=x([this.groupService.group$,this.presenceControlEntries$,this.groupService.subscriptionDetailPersonIds$]).pipe(g(oe(yn)),L(1)),this.presentCount$=this.presenceControlEntriesByGroup$.pipe(g(qe("present"))),this.absentCount$=this.presenceControlEntriesByGroup$.pipe(g(qe("absent"))),this.unapprovedCount$=this.presenceControlEntriesByGroup$.pipe(g(qe("unapproved"))),this.absentPrecedingCount$=this.presenceControlEntriesByGroup$.pipe(g(Rn())),this.queryParamsString$=x([this.selectedDate$,this.selectedLesson$,this.viewMode$]).pipe(g(oe(this.buildQueryParams.bind(this))),g(rn)),this.destroy$=new w,this.queryParamsString$.pipe(F(this.destroy$)).subscribe(e=>{this.location.replaceState("/presence-control",e),this.confirmBackLinkParams={returnparams:e}}),this.viewMode$.pipe(Qe(1),M(e=>this.userSettings.savePresenceControlViewMode(e)),F(this.destroy$)).subscribe(),this.selectedLesson$.pipe(F(this.destroy$)).subscribe(e=>{this.groupService.setSelectedLesson(e)}),this.lessonPresences$.pipe(F(this.destroy$)).subscribe(e=>this.groupService.setLessonPresences(e))}ngOnDestroy(){this.destroy$.next()}setDate(e){this.selectedDateSubject$.next(e)}setLessonId(e){this.selectLessonId$.next(e)}setViewMode(e){this.viewModeSubject$.next(e)}updateLessonPresencesTypes(e){x([this.lessonPresences$.pipe(D(1)),this.presenceTypes$.pipe(D(1))]).pipe(g(([t,o])=>An(t,e,o,this.settings))).subscribe(t=>this.updateLessonPresences$.next(t))}getNextPresenceType(e){return this.presenceTypes$.pipe(D(1),g(t=>e.getNextPresenceType(t)))}hasUnconfirmedAbsences(e){return this.studentIdsWithUnconfirmedAbsences$.pipe(g(t=>t.includes(e.lessonPresence.StudentRef.Id)))}updateAfterConfirm(){this.reloadLessonPresences$.next(),this.reloadStudentIdsWithUnconfirmedAbsences$.next()}loadLessonPresencesByLesson(e){return this.loadingService.load(this.lessonPresencesService.getListByLessons(e.lessons))}loadLessonsByDate(e){return this.loadingService.load(this.lessonPresencesService.getLessonsByDate(e)).pipe(g(Vn))}loadPresenceTypes(){return this.loadingService.load(this.presenceTypesService.presenceTypes$)}loadStudentIdsWithUnconfirmedAbsences(){return at(0,this.settings.unconfirmedAbsencesRefreshTime||-1).pipe(M(()=>this.lessonPresencesService.getListOfUnconfirmed()),g(e=>Me(e.map(t=>t.StudentRef.Id))))}buildQueryParams(e,t,o){let p={date:Qt(e,"yyyy-MM-dd"),viewMode:o};return t&&(p.lesson=String(t.id)),p}getLessonById(e){let t=String(e);return this.lessons$.pipe(g(o=>t&&o.find(p=>p.id===t)||Fn(o)),Se(Boolean))}getMyself(){let e=this.storageService.getPayload();return Number(e?.holder_id||e?.id_person)}};n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=A({token:n,factory:n.\u0275fac});let i=n;return i})();var ii=(i,n)=>n.id;function oi(i,n){if(i&1){let r=P();a(0,"div",3)(1,"input",7),C("change",function(){let t=_(r).$implicit,o=f();return v(o.onSelectionChange(t))}),c(),a(2,"label",8),u(3),c()()}if(i&2){let r=n.$implicit,e=n.$index,t=f();s(),y("id",G("group-",e))("checked",r.id===t.selected.id)("value",r.id),s(),y("for",G("group-",e)),s(),b(" ",r.label," ")}}var Te=function(i){return i.Select="select",i.Assign="assign",i}(Te||{}),Nn=(()=>{let n=class n{constructor(){this.activeModal=l(ne),this.translate=l(q),this.groupOptions=[]}ngOnInit(){this.title=`presence-control.groups.${this.dialogMode}.title`;let e=this.createEmtpyOption();this.groupOptions=this.createGroupOptions(this.subscriptionDetailsDefinitions),this.groupOptions.unshift(e),this.selected=this.groupOptions.find(t=>t.id===this.group)||e}createEmtpyOption(){let e=this.dialogMode===Te.Select?"presence-control.groups.all":"presence-control.groups.none";return{id:null,label:this.translate.instant(e)}}createGroupOptions(e){return e.DropdownItems?e.DropdownItems.map(t=>({id:t.Key,label:`${this.translate.instant("presence-control.groups.group")} ${t.Value}`})):[]}getSelectedGroup(){return this.selected}onSelectionChange(e){this.selected=e}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=k({type:n,selectors:[["bkd-presence-control-group-dialog"]],inputs:{dialogMode:"dialogMode",subscriptionDetailsDefinitions:"subscriptionDetailsDefinitions",group:"group"},decls:15,vars:9,consts:[[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"form-check"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["type","radio","name","groups",1,"form-check-input",3,"change","id","checked","value"],[1,"form-check-label",3,"for"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"h5",1),u(2),d(3,"translate"),c()(),a(4,"div",2)(5,"form"),O(6,oi,4,7,"div",3,ii),c()(),a(8,"div",4)(9,"button",5),C("click",function(){return o.activeModal.dismiss()}),u(10),d(11,"translate"),c(),a(12,"button",6),C("click",function(){return o.activeModal.close(o.getSelectedGroup())}),u(13),d(14,"translate"),c()()),t&2&&(s(2),b(" ",m(3,3,o.title)," "),s(4),E(o.groupOptions),s(4),b(" ",m(11,5,"presence-control.groups.cancel")," "),s(3),b(" ",m(14,7,"presence-control.groups.save")," "))},dependencies:[te,ge,me,ue,B],encapsulation:2});let i=n;return i})();var ri=()=>[],si=()=>["/presence-control"],ai=(i,n)=>n.id;function ci(i,n){if(i&1){let r=P();a(0,"bkd-sortable-header",11),d(1,"translate"),St("sortCriteriaChange",function(t){_(r);let o=f();return Pt(o.sortCriteria,t)||(o.sortCriteria=t),v(t)}),c()}if(i&2){let r=n.$implicit,e=f();y("ngClass",r)("label",m(1,4,"presence-control.groups.list.header."+r))("sortKey",r),yt("sortCriteria",e.sortCriteria)}}function pi(i,n){i&1&&j(0,"bkd-spinner")}function li(i,n){i&1&&j(0,"bkd-spinner",17)}function di(i,n){if(i&1){let r=P();a(0,"div",12)(1,"div",13)(2,"input",14,0),d(4,"async"),C("change",function(){let t=_(r).$implicit,o=f(2);return v(o.selectionService.toggle(t))}),c()(),a(5,"div",15),u(6),c(),a(7,"div",16)(8,"span"),u(9),c(),T(10,li,1,0,"bkd-spinner",17),d(11,"async"),c()()}if(i&2){let r=n.$implicit,e=f(2);s(2),y("checked",m(4,4,e.selectionService.isSelected$(r))),s(4),b(" ",r.name," "),s(3),S(r.group?r.group:""),s(),I(m(11,6,e.groupService.loading$)?10:-1)}}function mi(i,n){if(i&1&&O(0,di,12,8,"div",12,ai),i&2){f();let r=Q(0);E(r)}}var ui=["name","group"],Un=(()=>{let n=class n{constructor(){this.route=l(Be),this.state=l(U),this.selectionService=l(nt),this.groupService=l(re),this.userSettings=l(be),this.subscriptionDetailService=l(He),this.toastService=l(fe),this.translate=l(q),this.modalService=l(ve),this.sortService=l(Cn),this.sortKeys=ui,this.backlinkQueryParams$=this.route.queryParams.pipe(g(({returnparams:e})=>e),g(on)),this.eventIds$=this.state.selectedLesson$.pipe(g(e=>e?.getEventIds()||[])),this.sortCriteria=this.sortService.sortCriteria,this.sortedEntries$=x([this.groupService.getSubscriptionDetailsForStudents(),this.sortService.sortCriteria$]).pipe(g(oe(kn))),this.selected=[],this.sortService.sortCriteria.set({primarySortKey:"name",ascending:!0})}ngOnInit(){this.selectionService.selection$.subscribe(e=>this.selected=e)}selectGroup(){this.openGroupModal(Te.Select,this.selectCallback.bind(this))}assignGroup(){this.openGroupModal(Te.Assign,this.assignCallback.bind(this))}openGroupModal(e,t){x([this.groupService.getSubscriptionDetailsDefinitions(),this.groupService.group$]).pipe(D(1)).subscribe(([o,p])=>{let h=this.modalService.open(Nn);h.componentInstance.dialogMode=e,h.componentInstance.subscriptionDetailsDefinitions=o,h.componentInstance.group=p,h.result.then($=>{t($)},()=>{})})}selectCallback(e){x([this.eventIds$,this.userSettings.getPresenceControlGroupView()]).pipe(D(1),M(([t,o])=>this.userSettings.savePresenceControlGroupView(In(e.id,t,o))),g(()=>e.id)).subscribe(t=>this.groupService.selectGroup(t))}assignCallback(e){Pe(this.selected.map(t=>this.subscriptionDetailService.update(t.detail,e.id))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.groupService.reloadSubscriptionDetails(),this.selectionService.clear(),this.toastService.success(this.translate.instant("presence-control.groups.notifications.save-success"))}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=k({type:n,selectors:[["bkd-presence-control-group"]],features:[le([nt])],decls:31,vars:29,consts:[["checkbox",""],[3,"link","params"],[1,"group-header","mb-2","d-flex","justify-content-between"],[1,"d-flex","align-items-baseline"],[1,"ps-3"],["type","button",1,"show","btn","btn-link",3,"click"],["aria-label","edit",1,"btn","btn-primary","btn-icon","me-2",3,"click"],[1,"material-icons"],[1,"group-list"],[1,"group-list-header"],[3,"ngClass","label","sortKey","sortCriteria"],[3,"sortCriteriaChange","ngClass","label","sortKey","sortCriteria"],[1,"group-list-entry"],[1,"checkbox"],["type","checkbox",1,"form-check-input",3,"change","checked"],[1,"name","pe-2"],[1,"group","d-flex","justify-content-between"],[1,"inline","small"]],template:function(t,o){if(t&1){let p=P();R(0),d(1,"async"),R(2),d(3,"async"),R(4),d(5,"async"),a(6,"div"),j(7,"bkd-backlink",1),d(8,"async"),a(9,"h1"),u(10),d(11,"translate"),c(),a(12,"div",2)(13,"div",3)(14,"span",4),u(15),d(16,"translate"),c(),a(17,"button",5),C("click",function(){return _(p),v(o.selectGroup())}),u(18),d(19,"translate"),d(20,"translate"),c()(),a(21,"a",6),C("click",function(){return _(p),v(o.assignGroup())}),a(22,"i",7),u(23,"edit"),c()()(),a(24,"div",8)(25,"div",9),O(26,ci,2,6,"bkd-sortable-header",10,gt),c(),T(28,pi,1,0,"bkd-spinner"),d(29,"async"),Oe(30,mi,2,0),c()()}if(t&2){X(m(1,8,o.sortedEntries$));let p=m(3,11,o.selectionService.selection$)??we(27,ri),h=m(5,13,o.groupService.group$);s(7),y("link",we(28,si))("params",m(8,15,o.backlinkQueryParams$)),s(3),S(m(11,17,"presence-control.groups.title")),s(5),S(m(16,19,"presence-control.groups.show")),s(3),b(" ",h?m(19,21,"presence-control.groups.group")+" "+h:m(20,23,"presence-control.groups.all")," "),s(3),K("disabled",p.length===0),s(5),E(o.sortKeys),s(2),I(m(29,25,o.state.loading$)?28:30)}},dependencies:[dn,_e,ee,B,vn,Ee],styles:['[_nghost-%COMP%]{display:block}.group-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#000;font-weight:300;text-decoration:underline;padding-left:.5rem}.group-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.group-list-header[_ngcontent-%COMP%]{cursor:pointer;padding:1rem;display:grid;grid-template-areas:"name group";grid-template-columns:3fr 2fr;border-top:1px solid #dee2e6;border-bottom:2px solid #dee2e6}.group-list-entry[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #dee2e6;display:grid;grid-template-areas:"checkbox name group";grid-template-columns:min-content 3fr 2fr}.checkbox[_ngcontent-%COMP%]{grid-area:checkbox;margin:0;padding:.3rem 1rem 0 0}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.name[_ngcontent-%COMP%]{grid-area:name;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.group[_ngcontent-%COMP%]{grid-area:group}@media (max-width: 750px){.group-list[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.group-list-header[_ngcontent-%COMP%]{grid-template-columns:3fr 1fr}.group-list-entry[_ngcontent-%COMP%]{grid-template-columns:min-content 3fr 1fr}}'],changeDetection:0});let i=n;return i})();var gi=20,hi=100,Ie=function(i){return i.AddUpdateAction="ADD",i.RemoveUpdateAction="REMOVE",i}(Ie||{}),We=(()=>{let n=class n{constructor(){this.toastService=l(fe),this.translate=l(q),this.restService=l(Ht),this.presenceTypesService=l(Ce),this.settings=l(H),this.destroy$=new w,this.action$=new w,this.pendingUpdates$=this.action$.pipe(lt(this.reduceUpdates.bind(this),[]),dt()),this.revertUpdates$=new w,this.performUpdates$=this.pendingUpdates$.pipe(xe(hi),Se(Ae(tt)),pt(this.performUpdates.bind(this))),this.stateUpdates$=Y(this.pendingUpdates$,this.revertUpdates$).pipe(xe(gi),Se(Ae(tt))),this.performUpdates$.pipe(F(this.destroy$)).subscribe()}ngOnDestroy(){this.destroy$.next()}updatePresenceType(e,t=null){this.dispatchAddUpdate(e.lessonPresence,t)}performUpdates(e){let t=this.groupUpdates(e);return x(Object.keys(t).reduce((o,p)=>{let h=t[p];return Object.keys(h).forEach($=>{let ke=h[$];o.push(this.performUpdateForGroup(ke))}),o},[])).pipe(g(()=>t))}performUpdateForGroup(e){return e.forEach(t=>this.dispatchRemoveUpdate(t.presence)),this.performLessonPresencesUpdatesByIds(e[0].presence.LessonRef.Id,e.map(t=>t.presence.StudentRef.Id),e[0].newPresenceTypeId).pipe(ct(t=>this.revertUpdatesAfterError(e,t)))}performLessonPresencesUpdatesByIds(e,t,o=null){return o?(o?this.presenceTypesService.getPresenceType(o):z(null)).pipe(M(h=>this.restService.editLessonPresences([e],t,h?.Id,Ne(h,this.settings)||void 0,{context:new ze().set(et,{disableErrorHandling:!0})}))):this.restService.removeLessonPresences([e],t,{context:new ze().set(et,{disableErrorHandling:!0})})}revertUpdatesAfterError(e,t){return console.error("Bulk-update of lesson presences failed"),console.error(t),this.toastService.error(this.translate.instant("shared.lesson-presences-update.error")),this.revertUpdates$.next(e.map(o=>ce(ae({},o),{newPresenceTypeId:o.presence.TypeRef.Id}))),z(void 0)}groupUpdates(e){return e.reduce((t,o)=>{let p=String(o.newPresenceTypeId&&o.newPresenceTypeId);return t[p]||(t[p]={}),Array.isArray(t[p][o.presence.LessonRef.Id])||(t[p][o.presence.LessonRef.Id]=[]),t[p][o.presence.LessonRef.Id].push(o),t},{})}reduceUpdates(e,t){switch(t.type){case Ie.AddUpdateAction:{let{presence:o,newPresenceTypeId:p}=t.payload,h=e.findIndex(jn(o));return h===-1?[...e,{presence:o,newPresenceTypeId:p}]:[...e.slice(0,h),{presence:e[h].presence,newPresenceTypeId:p},...e.slice(h+1)]}case Ie.RemoveUpdateAction:return e.filter(Ae(jn(t.payload)));default:return e}}dispatchAddUpdate(e,t){this.action$.next({type:Ie.AddUpdateAction,payload:{presence:e,newPresenceTypeId:t}})}dispatchRemoveUpdate(e){this.action$.next({type:Ie.RemoveUpdateAction,payload:e})}};n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"});let i=n;return i})();function jn(i){return n=>n.presence.LessonRef.Id===i.LessonRef.Id&&n.presence.StudentRef.Id===i.StudentRef.Id}var fi=30;function st(i){return`blockLesson${i.lessonPresence.Id}`}var Ke=(()=>{let n=class n{constructor(){this.state=l(U),this.lessonPresencesService=l(je),this.loadingService=l(ie),this.settings=l(H)}getBlockLessonPresenceControlEntries(e){return x([this.state.lessons$.pipe(D(1)),this.loadChangeableLessonPresences(e),this.state.presenceTypes$.pipe(D(1)),this.state.absenceConfirmationStates$.pipe(D(1)),this.state.otherTeachersAbsences$.pipe(D(1))]).pipe(g(([t,o,p,h,$])=>this.filterBlockLessonPresences(e,o).map(ke=>Xt(t.find(Jn=>Jn.id===ke.LessonRef.Id.toString()),ke,p,h,$))))}filterBlockLessonPresences(e,t){return[...t].sort((o,p)=>o.LessonDateTimeFrom>p.LessonDateTimeFrom?1:-1).reduce((o,p)=>{let h=o[o.length-1];return this.isWithinBlockTime(p,h)?(o.push(p),o):o.find($=>$.Id===e.lessonPresence.Id)?o:[p]},[])}isWithinBlockTime(e,t){return t?e.LessonDateTimeFrom.getTime()-t.LessonDateTimeTo.getTime()<=fi*60*1e3:!0}loadChangeableLessonPresences(e){return x([this.loadLessonPresences(e),this.state.presenceTypes$.pipe(D(1))]).pipe(g(([t,o])=>t.filter(p=>Yt(p,o.find(h=>h.Id===p.TypeRef.Id)||null,this.settings))))}loadLessonPresences(e){return this.loadingService.load(this.lessonPresencesService.getListByDateStudentClass(e.lessonPresence.LessonDateTimeFrom,e.lessonPresence.StudentRef.Id,e.lessonPresence.StudyClassRef.Id??void 0).pipe(g(t=>t.filter(o=>o.TeacherInformation===e.lessonPresence.TeacherInformation))),st(e))}};n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=A({token:n,factory:n.\u0275fac});let i=n;return i})();var Ci=(i,n)=>n.entry.id;function _i(i,n){if(i&1){let r=P();a(0,"div",1)(1,"input",5),C("change",function(){let t=_(r).$implicit;return v(t.selected=!t.selected)}),c(),a(2,"label",6)(3,"i"),u(4),c(),a(5,"div",7),u(6),d(7,"date"),d(8,"date"),c()()()}if(i&2){let r=n.$implicit,e=n.$index,t=f();s(),y("id",G("lesson-presence-",e))("checked",r.selected),s(),K("fw-bold",t.isCurrentLesson(r)),y("for",G("lesson-presence-",e)),s(),pe(G("",r.entry.presenceCategory," material-icons pe-2")),s(),S(r.entry.presenceCategoryIcon),s(2),vt(" ",N(7,14,r.entry.lessonPresence.LessonDateTimeFrom,"HH:mm"),"\u2013",N(8,17,r.entry.lessonPresence.LessonDateTimeTo,"HH:mm")," ",r.entry.lessonPresence.EventDesignation," ")}}var Hn=(()=>{let n=class n{constructor(){this.activeModal=l(ne),this.blockLessonOptions=[]}ngOnInit(){this.blockLessonOptions=this.buildLessonPresenceOptions()}getSelectedEntries(){return this.blockLessonOptions.filter(({selected:e})=>e).map(({entry:e})=>e)}isCurrentLesson(e){return wn(e.entry.lessonPresence.LessonDateTimeFrom,this.entry.lessonPresence.LessonDateTimeFrom)}buildLessonPresenceOptions(){return this.blockPresenceControlEntries.map(e=>({entry:e,selected:this.entry.confirmationState===e.confirmationState}))}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=k({type:n,selectors:[["bkd-presence-control-block-lesson-component"]],inputs:{entry:"entry",blockPresenceControlEntries:"blockPresenceControlEntries"},decls:15,vars:11,consts:[[1,"modal-body"],[1,"form-check"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["type","checkbox",1,"form-check-input",3,"change","id","checked"],[1,"form-check-label","d-flex",3,"for"],[1,"d-block","text-truncate"]],template:function(t,o){if(t&1){let p=P();a(0,"div",0)(1,"p"),u(2),d(3,"translate"),c(),a(4,"form"),O(5,_i,9,20,"div",1,Ci),c()(),R(7),a(8,"div",2)(9,"button",3),C("click",function(){return _(p),v(o.activeModal.close())}),u(10),d(11,"translate"),c(),a(12,"button",4),C("click",function(){_(p);let $=Q(7);return v(o.activeModal.close($))}),u(13),d(14,"translate"),c()()}if(t&2){s(2),b(" ",m(3,4,"presence-control.block-lesson.text")," "),s(3),E(o.blockLessonOptions),s(2);let p=X(o.getSelectedEntries());s(3),b(" ",m(11,7,"presence-control.block-lesson.cancel")," "),s(2),y("disabled",p.length===0),s(),b(" ",m(14,9,"presence-control.block-lesson.save")," ")}},dependencies:[te,ge,me,ue,de,B],styles:[".checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.absent[_ngcontent-%COMP%]{color:#ea161f}.present[_ngcontent-%COMP%]{color:#3d8608}.unapproved[_ngcontent-%COMP%]{color:#ffa814}"]});let i=n;return i})();var vi=(i,n)=>n.Id;function bi(i,n){if(i&1&&(a(0,"div"),u(1),d(2,"date"),d(3,"date"),d(4,"addSpace"),c()),i&2){let r=n.$implicit;s(),bt(" ",N(2,5,r.LessonRef.From,"HH:mm"),"\u2013",N(3,8,r.LessonRef.To,"HH:mm")," ",r.LessonRef.EventDesignation,"",N(4,11,":",":")," ",r.Type," ")}}var qn=(()=>{let n=class n{constructor(){this.activeModal=l(ne)}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=k({type:n,selectors:[["bkd-presence-control-preceding-absence"]],inputs:{precedingAbsences:"precedingAbsences"},decls:10,vars:6,consts:[[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"p"),u(2),d(3,"translate"),c(),O(4,bi,5,14,"div",null,vi),c(),a(6,"div",1)(7,"button",2),C("click",function(){return o.activeModal.dismiss()}),u(8),d(9,"translate"),c()()),t&2&&(s(2),b(" ",m(3,2,"presence-control.preceding-absence.text")," "),s(2),E(o.precedingAbsences),s(4),b(" ",m(9,4,"presence-control.preceding-absence.cancel")," "))},dependencies:[de,B,ln],encapsulation:2});let i=n;return i})();var yi=i=>["student",i,"absences"],Pi=i=>["/presence-control/student",i,"absences"];function Si(i,n){if(i&1&&(j(0,"bkd-avatar",0),d(1,"async")),i&2){let r=f();y("studentId",m(1,3,r.studentId$))("link",Z(5,Pi,r.entry.lessonPresence.StudentRef.Id.toString()))("linkParams",r.profileReturnParams)}}function xi(i,n){if(i&1&&(a(0,"span"),u(1),c()),i&2){let r=f(2);s(),S(r.entry.presenceType==null?null:r.entry.presenceType.Designation)}}function wi(i,n){if(i&1){let r=P();a(0,"button",12),C("click",function(){_(r);let t=f();return v(t.updatePresenceType(t.entry))}),T(1,xi,2,1,"span"),c()}if(i&2){let r=f();s(),I(r.entry.presenceType!=null&&r.entry.presenceType.IsIncident?-1:1)}}function Mi(i,n){i&1&&j(0,"bkd-spinner",5)}function Ti(i,n){if(i&1){let r=P();a(0,"button",13),C("click",function(){_(r);let t=f();return v(t.showPrecedingAbsences(t.entry))}),a(1,"i",14),u(2,"info"),c()()}}function Ii(i,n){if(i&1&&(a(0,"span",9),u(1),c()),i&2){let r=f();s(),b(" ",r.entry.lessonPresence.StudyClassNumber," ")}}function ki(i,n){if(i&1){let r=P();a(0,"a",15),C("click",function(){_(r);let t=f();return v(t.updateIncident(t.entry))}),a(1,"i",4),u(2,"edit"),c(),a(3,"span"),u(4),d(5,"translate"),c()()}if(i&2){let r=f();s(4),S(m(5,1,(r.entry.presenceType==null?null:r.entry.presenceType.IsIncident)&&(r.entry.presenceType==null?null:r.entry.presenceType.Designation)||"presence-control.entry.incident"))}}var Wn=(()=>{let n=class n{constructor(){this.toastService=l(fe),this.translate=l(q),this.modalService=l(ve),this.loadingService=l(ie),this.hasUnconfirmedAbsences=!1,this.showClassName=!1,this.togglePresenceType=new J,this.changeIncident=new J,this.entry$=new ye(1),this.studentId$=this.entry$.pipe(g(({lessonPresence:e})=>e.StudentRef.Id)),this.loading$=this.entry$.pipe(M(e=>this.loadingService.loading(st(e))))}get classNames(){return[this.entry.presenceCategory,this.viewMode].join(" ")}ngOnChanges(e){e.entry&&this.entry$.next(e.entry.currentValue)}get isListViewMode(){return this.viewMode===se.List}updatePresenceType(e){e.canChangePresenceType?this.togglePresenceType.emit(e):this.toastService.warning(this.translate.instant("presence-control.entry.update-warning"))}updateIncident(e){e.canChangeIncident&&this.changeIncident.emit(e)}showPrecedingAbsences(e){let t=this.modalService.open(qn);t.componentInstance.precedingAbsences=e.precedingAbsences}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=k({type:n,selectors:[["bkd-presence-control-entry"]],hostVars:2,hostBindings:function(t,o){t&2&&pe(o.classNames)},inputs:{entry:"entry",hasUnconfirmedAbsences:"hasUnconfirmedAbsences",viewMode:"viewMode",showClassName:"showClassName",profileReturnParams:"profileReturnParams"},outputs:{togglePresenceType:"togglePresenceType",changeIncident:"changeIncident"},features:[mt],decls:18,vars:20,consts:[[1,"avatar","large",3,"studentId","link","linkParams"],["type","button",1,"presence-category","designation","btn","btn-link"],["type","button",1,"presence-category","status","btn","btn-link",3,"click","disabled"],[1,"position-relative"],[1,"material-icons"],[1,"inline","small"],["type","button",1,"previously-absent","d-flex","btn","btn-link"],[1,"student-info",3,"routerLink","queryParams"],[1,"student-name","text-truncate"],[1,"study-class","text-truncate"],[1,"unconfirmed-absences"],[1,"incident","btn","btn-link"],["type","button",1,"presence-category","designation","btn","btn-link",3,"click"],["type","button",1,"previously-absent","d-flex","btn","btn-link",3,"click"],[1,"material-icons-outlined"],[1,"incident","btn","btn-link",3,"click"]],template:function(t,o){if(t&1){let p=P();T(0,Si,2,7,"bkd-avatar",0),T(1,wi,2,1,"button",1),R(2),d(3,"async"),a(4,"button",2),C("click",function(){return _(p),v(o.updatePresenceType(o.entry))}),a(5,"div",3)(6,"i",4),u(7),c(),T(8,Mi,1,0,"bkd-spinner",5),c()(),T(9,Ti,3,0,"button",6),a(10,"a",7)(11,"span",8),u(12),c(),T(13,Ii,2,1,"span",9),a(14,"span",10),u(15),d(16,"translate"),c()(),T(17,ki,6,3,"a",11)}if(t&2){I(o.isListViewMode?-1:0),s(),I(o.entry.showDesignation?1:-1);let p=m(3,14,o.loading$);s(3),y("disabled",p),s(2),K("invisible",p),s(),S(o.entry.presenceCategoryIcon),s(),I(p?8:-1),s(),I(o.entry.precedingAbsences!=null&&o.entry.precedingAbsences.length?9:-1),s(),y("routerLink",Z(18,yi,o.entry.lessonPresence.StudentRef.Id))("queryParams",o.profileReturnParams),s(2),S(o.entry.lessonPresence.StudentFullName),s(),I(o.isListViewMode&&o.showClassName?13:-1),s(2),b(" ",o.hasUnconfirmedAbsences?m(16,16,"presence-control.entry.unconfirmed-absences"):""," "),s(2),I(o.entry.canChangeIncident?17:-1)}},dependencies:[mn,_e,Ve,ee,B],styles:['[_nghost-%COMP%]{padding:2rem 1rem;background-color:#fff;display:grid;grid-template-areas:"avatar status designation previously-absent" "avatar student-info student-info student-info" "avatar incident incident incident";grid-template-columns:min-content min-content 3fr min-content}[_nghost-%COMP%] > *[_ngcontent-%COMP%]{align-self:center}.presence-category[_ngcontent-%COMP%]{text-decoration:none}.presence-category[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{top:.1875rem}.absent[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#ea161f}.present[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#3d8608}.unapproved[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#ffa814}.presence-category[_ngcontent-%COMP%]   bkd-spinner[_ngcontent-%COMP%]{color:#000;position:absolute;top:4px;left:5px}.designation[_ngcontent-%COMP%], .student-info[_ngcontent-%COMP%], a.incident[_ngcontent-%COMP%], .incident[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.avatar[_ngcontent-%COMP%]{grid-area:avatar;margin-right:1.5rem}.status[_ngcontent-%COMP%]{grid-area:status}.status[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:2rem}.designation[_ngcontent-%COMP%]{grid-area:designation;text-align:left;line-height:2.375rem}.previously-absent[_ngcontent-%COMP%]{grid-area:previously-absent;text-decoration:none;color:#00000080;justify-self:end}.student-info[_ngcontent-%COMP%]{grid-area:student-info;display:flex;flex-direction:column;text-decoration:none}.student-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{text-decoration:underline}.student-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}.unconfirmed-absences[_ngcontent-%COMP%]{color:#ea161f;font-size:.875rem;line-height:1}.study-class[_ngcontent-%COMP%]{font-size:.875rem;line-height:1}.incident[_ngcontent-%COMP%]{color:#00000080;padding-right:1.5rem;grid-area:incident;display:flex;text-decoration:none}.incident[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.incident[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.incident[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.3em}.grid[_nghost-%COMP%]   .status[_ngcontent-%COMP%], .grid[_nghost-%COMP%]   .designation[_ngcontent-%COMP%]{align-self:start;margin-left:-1.5rem;margin-top:-.375rem}.grid[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{align-self:end;margin-left:-1.5rem;margin-bottom:-.375rem}.grid[_nghost-%COMP%]   .previously-absent[_ngcontent-%COMP%]{padding-right:0;align-self:start}.grid[_nghost-%COMP%]   .unconfirmed-absences[_ngcontent-%COMP%]{height:.875rem}.list[_nghost-%COMP%]{grid-template-areas:"student-info status incidentordesignation previously-absent";grid-template-columns:3fr min-content 4fr 3em;padding:.5rem 1rem}.list[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{justify-self:start}.list[_nghost-%COMP%]   .student-name[_ngcontent-%COMP%]{line-height:1;margin-bottom:.5rem}.list[_nghost-%COMP%]   .incident[_ngcontent-%COMP%], .list[_nghost-%COMP%]   .designation[_ngcontent-%COMP%]{grid-area:incidentordesignation}.list[_nghost-%COMP%]   .previously-absent[_ngcontent-%COMP%]{padding-right:0}@media (max-width: 750px){.list[_nghost-%COMP%]{grid-template-areas:"student-info student-info student-info previously-absent" "status incidentordesignation incidentordesignation incidentordesignation";grid-template-columns:min-content 1fr 1fr min-content;row-gap:1rem}.list[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.list[_nghost-%COMP%]   .student-name[_ngcontent-%COMP%]{margin-top:.5rem}.list[_nghost-%COMP%]   .previously-absent[_ngcontent-%COMP%]{align-self:start}}']});let i=n;return i})();var $i=(i,n)=>({"btn-link":i,"btn-danger":n}),Li=i=>["groups",i],Di=i=>({returnparams:i}),Oi=(i,n)=>n.viewMode,Ei=(i,n)=>n.id;function Bi(i,n){if(i&1){let r=P();a(0,"div",22),C("click",function(){let t;_(r);let o=f();return v((t=o.lessonDropdown())==null?null:t.toggle())}),u(1),d(2,"date"),a(3,"span",23),u(4),d(5,"date"),c()()}if(i&2){let r=f();s(),b(" ",N(2,2,r.selectedLesson.LessonDateTimeFrom,"HH:mm"),"\u2013"),s(3),S(N(5,5,r.selectedLesson.LessonDateTimeTo,"HH:mm"))}}function Vi(i,n){if(i&1){let r=P();a(0,"div",28),C("click",function(){let t=_(r).$implicit,o=f(2);return v(o.selectLessonChange.emit(t))}),a(1,"div",29)(2,"div"),u(3),d(4,"date"),d(5,"date"),c(),a(6,"div",25),u(7),c(),a(8,"div",25),u(9),c()()()}if(i&2){let r=n.$implicit,e=f(2);K("active",r.id===e.selectedLesson.id),s(3),_t(" ",N(4,6,r.LessonDateTimeFrom,"HH:mm"),"\u2013",N(5,9,r.LessonDateTimeTo,"HH:mm")," "),s(4),b(" ",r.eventDesignations," "),s(2),b(" ",r.studyClassNumbers," ")}}function Fi(i,n){if(i&1&&(a(0,"div",7)(1,"div",24)(2,"div",25),u(3),c(),a(4,"div",25),u(5),c()(),a(6,"div",26),O(7,Vi,10,12,"div",27,Ei),c()()),i&2){let r=f();s(3),S(r.selectedLesson.eventDesignations),s(2),S(r.selectedLesson.studyClassNumbers),s(2),E(r.lessons)}}function Ai(i,n){if(i&1){let r=P();a(0,"bkd-caret",30),C("click",function(){let t;_(r);let o=f();return v((t=o.lessonDropdown())==null?null:t.toggle())}),c()}if(i&2){let r,e=f();y("expanded",((r=e.lessonDropdown())==null?null:r.isOpen())||!1)}}function Ri(i,n){if(i&1&&(a(0,"a",19),d(1,"async"),d(2,"async"),d(3,"async"),a(4,"i",31),u(5,"groups"),c()()),i&2){let r=f();y("ngClass",xt(9,$i,m(1,3,r.isGroupSelected$)===!1,m(2,5,r.isGroupSelected$)))("routerLink",Z(12,Li,r.selectedLesson.id))("queryParams",Z(14,Di,m(3,7,r.state.queryParamsString$)))}}function Gi(i,n){if(i&1){let r=P();a(0,"button",32),C("click",function(){let t=_(r).$implicit,o=f();return v(o.viewModeChange.emit(t.viewMode))}),a(1,"i",31),u(2),c()()}if(i&2){let r=n.$implicit,e=f();K("btn-outline-secondary",r.viewMode===e.viewMode)("btn-link",r.viewMode!==e.viewMode)("active",r.viewMode===e.viewMode),y("disabled",!e.selectedLesson),s(2),S(r.icon)}}var Ni=he.prototype._positionMenu;he.prototype._positionMenu=function(...n){let r=Ni.apply(this,n);if(this._anchor.nativeElement.id==="lesson-dropdown"){let e=this._bodyContainer||this._menu.nativeElement,t=e.style.transform?.match(/translate\(([0-9-.]+)px, ([0-9-.]+)px\)/);t&&parseFloat(t[1])<0&&(e.style.transform=`translate(0px, ${t[2]}px)`)}return r};var Ui=1e3,Kn=(()=>{let n=class n{constructor(){this.state=l(U),this.groupService=l(re),this.presentCount=null,this.absentCount=null,this.unapprovedCount=null,this.absentPrecedingCount=null,this.search="",this.selectLessonChange=new J,this.selectDateChange=new J,this.searchChange=new J,this.viewModeChange=new J,this.dateSubject=new w,this.destroy$=new w,this.lessonDropdown=wt(he),this.viewModeOptions=[{viewMode:se.List,icon:"list"},{viewMode:se.Grid,icon:"view_module"}],this.isGroupSelected$=this.groupService.group$.pipe(g(Wt));let e=l(Ye);e.popperOptions=t=>ce(ae({},t),{modifiers:t.modifiers?.map(o=>(o.name==="offset"&&(o.options={offset:({placement:p,reference:h,popper:$})=>p==="bottom-start"?[(window.innerWidth-$.width)/2-h.x,0]:[]}),o))})}ngOnInit(){this.dateSubject.pipe(xe(Ui),F(this.destroy$)).subscribe(e=>{this.selectDateChange.emit(e)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onDateChange(e){e instanceof Date&&(e.getFullYear()<1e3&&e.setFullYear(e.getFullYear()+2e3),this.dateSubject.next(e))}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=k({type:n,selectors:[["bkd-presence-control-header"]],viewQuery:function(t,o){t&1&&ht(o.lessonDropdown,he,5),t&2&&ft()},inputs:{selectedLesson:"selectedLesson",lessons:"lessons",presentCount:"presentCount",absentCount:"absentCount",unapprovedCount:"unapprovedCount",absentPrecedingCount:"absentPrecedingCount",viewMode:"viewMode",selectDate:"selectDate",search:"search"},outputs:{selectLessonChange:"selectLessonChange",selectDateChange:"selectDateChange",searchChange:"searchChange",viewModeChange:"viewModeChange"},features:[le([Ye,{provide:Et,useClass:Ft},{provide:Bt,useClass:_n}])],decls:41,vars:19,consts:[["d","ngbDatepicker"],[1,"navigation"],[1,"lesson-date"],["type","button",1,"btn","btn-link",3,"click"],[1,"material-icons"],["positionTarget",".lesson-date-input","ngbDatepicker","","placement","bottom-start",1,"lesson-date-input",3,"ngModelChange","ngModel"],[1,"lesson-time"],["ngbDropdown","","container","body","display","dynamic","placement","bottom",1,"lesson-description"],[1,"dropdown-caret",3,"expanded"],[1,"states"],[1,"state","present"],[1,"count"],[1,"state","absent"],[1,"state","unapproved"],[1,"state","previously-absent"],[1,"material-icons-outlined"],[1,"search-and-views"],[1,"search",3,"valueChange","value","disabled","placeholder","label"],[1,"group-and-views","d-flex","align-items-center"],["type","button",1,"group","btn","me-2","me-sm-4",3,"ngClass","routerLink","queryParams"],[1,"views"],["type","button",1,"view","btn","btn-primary","btn-icon",3,"disabled","btn-outline-secondary","btn-link","active"],[1,"lesson-time",3,"click"],[1,"lesson-time-to"],["id","lesson-dropdown","ngbDropdownToggle",""],[1,"text-truncate"],["ngbDropdownMenu","","aria-labelledby","lesson-dropdown"],["ngbDropdownItem","",3,"active"],["ngbDropdownItem","",3,"click"],[1,"lesson-entry"],[1,"dropdown-caret",3,"click","expanded"],[1,"material-icons","align-middle"],["type","button",1,"view","btn","btn-primary","btn-icon",3,"click","disabled"]],template:function(t,o){if(t&1){let p=P();a(0,"div",1)(1,"div",2)(2,"button",3),C("click",function(){_(p);let $=Ct(6);return v($.toggle())}),a(3,"i",4),u(4,"calendar_today"),c()(),a(5,"input",5,0),C("ngModelChange",function($){return _(p),v(o.onDateChange($))}),c()(),T(7,Bi,6,8,"div",6),T(8,Fi,9,2,"div",7),T(9,Ai,1,1,"bkd-caret",8),c(),a(10,"div",9)(11,"div",10)(12,"i",4),u(13,"check_circle"),c(),a(14,"span",11),u(15),c()(),a(16,"div",12)(17,"i",4),u(18,"cancel"),c(),a(19,"span",11),u(20),c()(),a(21,"div",13)(22,"i",4),u(23,"help"),c(),a(24,"span",11),u(25),c()(),a(26,"div",14)(27,"i",15),u(28,"info"),c(),a(29,"span",11),u(30),c()()(),a(31,"div",16)(32,"bkd-resettable-input",17),d(33,"translate"),d(34,"translate"),C("valueChange",function($){return _(p),v(o.searchChange.emit($))}),c(),a(35,"div",18),T(36,Ri,6,16,"a",19),d(37,"async"),a(38,"div",20),O(39,Gi,3,8,"button",21,Oi),c()()()}t&2&&(s(5),y("ngModel",o.selectDate),s(2),I(o.selectedLesson?7:-1),s(),I(o.selectedLesson?8:-1),s(),I(o.lessons.length>0?9:-1),s(6),S(o.presentCount!==null?o.presentCount:"?"),s(5),S(o.absentCount!==null?o.absentCount:"?"),s(5),S(o.unapprovedCount!==null?o.unapprovedCount:"?"),s(5),S(o.absentPrecedingCount!==null?o.absentPrecedingCount:"?"),s(2),y("value",o.search)("disabled",!o.selectedLesson)("placeholder",m(33,13,"presence-control.header.search-by-name"))("label",m(34,15,"presence-control.header.search")),s(4),I(m(37,17,o.selectedLesson&&o.state.groupsAvailability$)?36:-1),s(3),E(o.viewModeOptions))},dependencies:[Vt,te,Lt,Dt,Ot,he,Gt,Rt,At,pn,bn,Ee,Ve,ee,de,B],styles:['[_nghost-%COMP%]{display:flex;flex-direction:column;padding:.75rem 0}.navigation[_ngcontent-%COMP%]{display:grid;grid-template-areas:". date time dropdown-caret" ". description description dropdown-caret";grid-template-columns:1fr auto auto 1fr;align-items:center}.lesson-date[_ngcontent-%COMP%]{grid-area:date;justify-self:end;display:flex;align-items:center;justify-content:flex-end}.lesson-date[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0 .5ch 0 0}.lesson-date[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#000;position:relative}.lesson-date-input[_ngcontent-%COMP%]{font-weight:600;background:transparent;border:none;width:11ch}.lesson-time[_ngcontent-%COMP%]{grid-area:time;cursor:pointer}.lesson-description[_ngcontent-%COMP%]{grid-area:description;overflow:hidden;text-align:center;cursor:pointer}.dropdown-toggle[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.dropdown-caret[_ngcontent-%COMP%]{grid-area:dropdown-caret;line-height:100%;text-align:left;color:#000}.dropdown-menu[_ngcontent-%COMP%]{width:50ch;padding:0;box-shadow:2px 2px 3px -1px #0003}@media (max-width: 800px){.dropdown-menu[_ngcontent-%COMP%]{width:100vw}}.dropdown-item[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #dee2e6}.states[_ngcontent-%COMP%]{margin:.75rem 0;display:flex;justify-content:center}.state[_ngcontent-%COMP%]{margin-right:7%;display:flex}.state[_ngcontent-%COMP%]:last-child{margin-right:0}@media (min-width: 1000px){.state[_ngcontent-%COMP%]{margin-right:4rem}}.state.present[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#3d8608}.state.absent[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#ea161f}.state.unapproved[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#ffa814}.state.previously-absent[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#00000080}.state[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{margin-left:.3em;margin-top:1px}.search-and-views[_ngcontent-%COMP%]{padding-top:.75rem;display:flex;justify-content:space-between;border-top:1px solid #dee2e6}.search[_ngcontent-%COMP%]{flex:auto;max-width:300px;margin-right:1rem}.views[_ngcontent-%COMP%]{display:flex}.view[_ngcontent-%COMP%]{color:#4e4e4ef2;background-color:#fff}.view.active[_ngcontent-%COMP%]{color:#fff;background-color:#4e4e4ef2;border:none}.group[_ngcontent-%COMP%], .view[_ngcontent-%COMP%]{text-decoration:none;padding-left:0;padding-right:0;aspect-ratio:1/1;width:calc(.75rem + 2 * var(--bs-border-width) + 1.625rem);border-radius:50%}.group.btn-link[_ngcontent-%COMP%]{color:#000}@media (max-width: 380px){[_nghost-%COMP%]{padding-left:.5rem;padding-right:.5rem}#search-addon[_ngcontent-%COMP%]{padding-left:.5rem;padding-right:.5rem}}@media (max-width: 365px){.lesson-time[_ngcontent-%COMP%]{line-height:1}.lesson-time-to[_ngcontent-%COMP%]{display:block}.dropdown-caret[_ngcontent-%COMP%]{padding-left:0}}']});let i=n;return i})();var ji=(i,n)=>n.id;function Hi(i,n){if(i&1){let r=P();a(0,"div",3)(1,"input",7),C("change",function(){let t=_(r).$implicit,o=f();return v(o.onSelectionChange(t))}),c(),a(2,"label",8),u(3),c()()}if(i&2){let r=n.$implicit,e=n.$index,t=f();s(),y("id",G("incident-",e))("checked",r.id===t.selected.id)("value",r.id),s(),y("for",G("incident-",e)),s(),b(" ",r.label," ")}}var Qn=(()=>{let n=class n{constructor(){this.activeModal=l(ne),this.translate=l(q),this.incidentOptions=[]}ngOnInit(){let e=this.createIncidentOption();this.incidentOptions=this.incidentTypes.map(t=>this.createIncidentOption(t)),this.incidentOptions.unshift(e),this.selected=this.incidentOptions.find(t=>t.id===this.incident?.Id)||e}createIncidentOption(e){return{id:e?e.Id:null,label:e?e.Designation:this.translate.instant("presence-control.incident.no-incident")}}onSelectionChange(e){this.selected=e}getSelectedIncident(){return this.incidentTypes.find(e=>e.Id===this.selected?.id)||null}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=k({type:n,selectors:[["bkd-presence-control-incident"]],inputs:{incident:"incident",incidentTypes:"incidentTypes"},decls:15,vars:9,consts:[[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"form-check"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["type","radio","name","incident",1,"form-check-input",3,"change","id","checked","value"],[1,"form-check-label",3,"for"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"h5",1),u(2),d(3,"translate"),c()(),a(4,"div",2)(5,"form"),O(6,Hi,4,7,"div",3,ji),c()(),a(8,"div",4)(9,"button",5),C("click",function(){return o.activeModal.dismiss()}),u(10),d(11,"translate"),c(),a(12,"button",6),C("click",function(){return o.activeModal.close(o.getSelectedIncident())}),u(13),d(14,"translate"),c()()),t&2&&(s(2),b(" ",m(3,3,"presence-control.incident.text")," "),s(4),E(o.incidentOptions),s(4),b(" ",m(11,5,"presence-control.incident.cancel")," "),s(3),b(" ",m(14,7,"presence-control.incident.save")," "))},dependencies:[te,ge,me,ue,B],encapsulation:2});let i=n;return i})();var qi=()=>[],Wi=i=>({returnparams:i}),Ki=(i,n)=>n.id;function Qi(i,n){i&1&&j(0,"bkd-spinner")}function zi(i,n){i&1&&(a(0,"p",1),u(1),d(2,"translate"),c()),i&2&&(s(),S(m(2,1,"presence-control.no-lessons")))}function Yi(i,n){i&1&&(a(0,"p",1),u(1),d(2,"translate"),c()),i&2&&(s(),b(" ",m(2,1,"presence-control.no-lesson-presences")," "))}function Ji(i,n){if(i&1){let r=P();a(0,"bkd-presence-control-entry",4),d(1,"async"),d(2,"async"),d(3,"async"),d(4,"async"),C("togglePresenceType",function(t){_(r);let o=f(3);return v(o.togglePresenceType(t))})("changeIncident",function(t){_(r);let o=f(3);return v(o.changeIncident(t))}),c()}if(i&2){let r=n.$implicit,e=f(3);y("entry",r)("hasUnconfirmedAbsences",m(1,5,e.state.hasUnconfirmedAbsences(r)))("viewMode",m(2,7,e.state.viewMode$))("showClassName",(m(3,9,e.state.studyClassCount$)??0)>1)("profileReturnParams",Z(13,Wi,m(4,11,e.state.queryParamsString$)))}}function Xi(i,n){if(i&1&&(a(0,"div"),d(1,"async"),O(2,Ji,5,15,"bkd-presence-control-entry",3,Ki),c()),i&2){let r=f(2),e=Q(4);pe(G("default-entries entries view-mode-",m(1,3,r.state.viewMode$))),s(2),E(e)}}function Zi(i,n){if(i&1){let r=P();a(0,"bkd-presence-control-header",0),d(1,"async"),d(2,"async"),d(3,"async"),d(4,"async"),d(5,"async"),d(6,"async"),d(7,"async"),C("searchChange",function(t){_(r);let o=f();return v(o.search$.next(t))})("viewModeChange",function(t){_(r);let o=f();return v(o.state.setViewMode(t))})("selectDateChange",function(t){_(r);let o=f();return v(o.state.setDate(t))})("selectLessonChange",function(t){_(r);let o=f();return v(o.state.setLessonId(t.id))}),c(),T(8,zi,3,3,"p",1)(9,Yi,3,3,"p",1)(10,Xi,4,5,"div",2)}if(i&2){let r=f(),e=Q(0),t=Q(2),o=Q(4);y("selectedLesson",e)("lessons",t)("presentCount",m(1,10,r.state.presentCount$))("absentCount",m(2,12,r.state.absentCount$))("unapprovedCount",m(3,14,r.state.unapprovedCount$))("absentPrecedingCount",m(4,16,r.state.absentPrecedingCount$))("viewMode",m(5,18,r.state.viewMode$))("selectDate",m(6,20,r.state.selectedDate$))("search",m(7,22,r.search$)),s(8),I(e?o.length===0?9:10:8)}}var eo=["studentFullName"],zn=(()=>{let n=class n{constructor(){this.state=l(U),this.blockLessons=l(Ke),this.lessonPresencesUpdateService=l(We),this.presenceTypesService=l(Ce),this.modalService=l(ve),this.scrollPosition=l(Pn),this.route=l(Be),this.search$=new $e(""),this.entries$=x([this.state.presenceControlEntriesByGroup$,this.search$]).pipe(g(([e,t])=>fn(e,eo,t)),L(1)),this.destroy$=new w}ngOnInit(){this.route.queryParams.pipe(F(this.destroy$)).subscribe(this.restoreStateFromParams.bind(this))}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}doTogglePresenceType(e){e.forEach(t=>this.state.getNextPresenceType(t).subscribe(o=>this.lessonPresencesUpdateService.updatePresenceType(t,o?o.Id:null)))}togglePresenceType(e){this.blockLessons.getBlockLessonPresenceControlEntries(e).pipe(D(1)).subscribe(t=>{if(t.length===1){let o=t[0];this.doTogglePresenceType([o])}else{let o=this.modalService.open(Hn);o.componentInstance.entry=e,o.componentInstance.blockPresenceControlEntries=t,o.result.then(p=>{p&&this.doTogglePresenceType(p)},()=>{})}})}updateIncident(e,t){this.lessonPresencesUpdateService.updatePresenceType(e,t)}changeIncident(e){this.presenceTypesService.incidentTypes$.subscribe(t=>{let o=this.modalService.open(Qn);o.componentInstance.incident=t.find(p=>p.Id===e.presenceType?.Id)||null,o.componentInstance.incidentTypes=t,o.result.then(p=>{this.updateIncident(e,p?.Id||null)},()=>{})})}restoreStateFromParams(e){e.date&&this.state.setDate(kt(e.date));let t=String(e.lesson);t&&this.state.setLessonId(t),e.viewMode&&Gn.includes(e.viewMode)&&this.state.setViewMode(e.viewMode)}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=k({type:n,selectors:[["bkd-presence-control-list"]],decls:12,vars:16,consts:[[3,"searchChange","viewModeChange","selectDateChange","selectLessonChange","selectedLesson","lessons","presentCount","absentCount","unapprovedCount","absentPrecedingCount","viewMode","selectDate","search"],[1,"mt-3"],[3,"class"],[3,"entry","hasUnconfirmedAbsences","viewMode","showClassName","profileReturnParams"],[3,"togglePresenceType","changeIncident","entry","hasUnconfirmedAbsences","viewMode","showClassName","profileReturnParams"]],template:function(t,o){t&1&&(R(0),d(1,"async"),R(2),d(3,"async"),R(4),d(5,"async"),a(6,"h1"),u(7),d(8,"translate"),c(),T(9,Qi,1,0,"bkd-spinner"),d(10,"async"),Oe(11,Zi,11,24)),t&2&&(X(m(1,2,o.state.selectedLesson$)),s(2),X(m(3,5,o.state.lessons$)),s(2),X(m(5,8,o.entries$)??we(15,qi)),s(3),S(m(8,11,"presence-control.title")),s(2),I(m(10,13,o.state.loading$)?9:11))},dependencies:[Kn,Wn,_e,ee,B],styles:["bkd-presence-control-entry[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6}.entries.view-mode-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(400px,1fr))}.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{border-right:1px solid #dee2e6}[_nghost-%COMP%]{display:block;overflow:hidden;width:100%}.entries.view-mode-grid[_ngcontent-%COMP%]{width:calc(100% + 1px)}"],changeDetection:0});let i=n;return i})();var Yn=(()=>{let n=class n{constructor(){this.state=l(U),this.lessonPresencesUpdateService=l(We),this.destroy$=new w}ngOnInit(){this.lessonPresencesUpdateService.stateUpdates$.pipe(F(this.destroy$)).subscribe(e=>this.state.updateLessonPresencesTypes(e))}ngOnDestroy(){this.destroy$.next()}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=k({type:n,selectors:[["bkd-presence-control"]],features:[le([U,Ke,re,tn,{provide:nn,useExisting:U}])],decls:1,vars:0,template:function(t,o){t&1&&j(0,"router-outlet")},dependencies:[It],encapsulation:2,changeDetection:0});let i=n;return i})();var Sc=[{path:"",component:Yn,children:[{path:"",component:zn,data:{restoreScrollPositionFrom:gn.map(i=>`/presence-control/student/:id/${i}`)}},un,{path:"groups/:id",component:Un}]}];export{Sc as PRESENCE_CONTROL_ROUTES};
