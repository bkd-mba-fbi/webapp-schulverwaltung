"use strict";(self.webpackChunkwebapp_schulverwaltung=self.webpackChunkwebapp_schulverwaltung||[]).push([[14],{7113:(F,S,a)=>{a.d(S,{C7:()=>l,Eq:()=>D,TG:()=>h,bT:()=>t,m_:()=>C,my:()=>E,p6:()=>_,sU:()=>f,tb:()=>n,tj:()=>u,xk:()=>$,zs:()=>d});var e=a(9736);function n(o,c,m){return o?o.Tests?.reduce((O,T)=>O||T.Id===c&&T.Results?.find(I=>I.TestId===c&&I.StudentId===m)||null,null)??null:null}function l(o,c,m){return c.map(O=>O.Id===o.TestId?t(o,O,m):O)}function u(o,c,m){return m.map(O=>O.Id===o?function v(o,c){return{...c,Results:c.Results?.filter(m=>m.StudentId!==o)||[]}}(c,O):O)}function _(o,c){return c.map(m=>m.Id===o?{...m,IsPublished:!m.IsPublished}:m)}function d(o){const c=function x(o){return o.Results?.map(c=>null!==c.Points?c.Points:g).filter(c=>c>g)||[]}(o);if(0===c.length)throw new Error("unable to calculate averages without results");return(0,e.G)(c)}function f(o){return o.MaxPointsAdjusted||o.MaxPoints}function h(o){const c=function M(o){return o.Results?.filter(c=>null!==c.GradeDesignation).map(c=>Number(c.GradeDesignation)).filter(c=>!isNaN(c))||[]}(o);if(0===c.length)throw new Error("unable to calculate averages without results");return(0,e.G)(c)}function C(o,c){return c.Results?.find(m=>m.StudentId===o)}function $(o,c){return null===c?null:c.filter(m=>m.Id!==o)}function t(o,c,m){const O=m&&c.Results?.find(I=>I.TestId===o.TestId&&I.StudentId===o.StudentId),T=c.Results?.filter(I=>!(I.TestId===o.TestId&&I.StudentId===o.StudentId))||[];return O&&"grade"===m?o.GradeId=O.GradeId:O&&"points"===m&&(o.Points=O.Points),{...c,Results:[...T,o]}}function E(o){return o.slice().sort((c,m)=>m.Date.getTime()-c.Date.getTime())}function D(o,c){return c?.find(m=>m.Id===o.GradingScaleId)||null}const g=-1},2619:(F,S,a)=>{a.d(S,{w:()=>$});var e=a(177),n=a(4438),l=a(9417),u=a(3955),_=a(4412),d=a(4572),f=a(6354);function h(t,E){if(1&t&&(n.j41(0,"option",3),n.EFF(1),n.nI1(2,"translate"),n.k0s()),2&t){const D=n.XpG();n.Y8G("ngValue",null),n.R7$(),n.SpI(" ",n.bMT(2,2,D.emptyLabel)," ")}}function C(t,E){if(1&t&&(n.j41(0,"option",3),n.EFF(1),n.k0s()),2&t){const D=E.$implicit;n.Y8G("ngValue",D),n.R7$(),n.SpI(" ",D.Value," ")}}let $=(()=>{class t{constructor(){this.options=[],this.allowEmpty=!0,this.emptyLabel="",this.value=null,this.disabled=!1,this.tabindex=0,this.valueChange=new n.bkB,this.options$=new _.t([]),this.rawValue$=new _.t(null),this.value$=(0,d.z)([this.rawValue$,this.options$]).pipe((0,f.T)(([D,v])=>v&&v.find(M=>M.Key===D)||null))}ngOnChanges(D){D.value&&this.rawValue$.next(D.value.currentValue),D.options&&this.options$.next(D.options.currentValue)}static#t=this.\u0275fac=function(v){return new(v||t)};static#e=this.\u0275cmp=n.VBU({type:t,selectors:[["bkd-select"]],inputs:{options:"options",allowEmpty:"allowEmpty",emptyLabel:"emptyLabel",value:"value",disabled:"disabled",tabindex:"tabindex"},outputs:{valueChange:"valueChange"},standalone:!0,features:[n.OA$,n.aNF],decls:5,vars:7,consts:[[1,"form-select",3,"ngModelChange","tabindex","disabled","ngModel"],[3,"ngValue",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"]],template:function(v,M){1&v&&(n.j41(0,"select",0),n.nI1(1,"async"),n.bIt("ngModelChange",function(g){return M.valueChange.emit(g&&g.Key)}),n.DNE(2,h,3,4,"option",1)(3,C,2,2,"option",2),n.EFF(4," >\n"),n.k0s()),2&v&&(n.FS9("tabindex",M.tabindex),n.Y8G("disabled",M.disabled)("ngModel",n.bMT(1,5,M.value$)),n.R7$(2),n.Y8G("ngIf",M.allowEmpty),n.R7$(),n.Y8G("ngForOf",M.options))},dependencies:[l.YN,l.xH,l.y7,l.wz,l.BC,l.vS,e.bT,e.pM,e.Jj,u.h,u.D9],changeDetection:0})}return t})()},7014:(F,S,a)=>{a.d(S,{Q:()=>at});var e=a(177),n=a(1324),l=a(3955),u=a(4412),_=a(9736),d=a(7113),f=a(7887);function h(i,R,s){return R?R.Grade:function C(i,R){return R?.Grades.find(s=>s.Id===i?.GradeId)?.Designation}(i,s)||i?.GradeValue}var $=a(9082),t=a(4438);let E=(()=>{class i{constructor(){}getGradeForStudent(){return h(this.grading,this.finalGrade,this.gradingScale)}static#t=this.\u0275fac=function(r){return new(r||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-grades-final-grade"]],inputs:{finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},standalone:!0,features:[t.aNF],decls:14,vars:11,consts:[[1,"final-entry"],["data-testid","final-grade"],["data-testid","average-test-results"]],template:function(r,p){1&r&&(t.j41(0,"div",0)(1,"div"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",1)(5,"span"),t.EFF(6),t.k0s()(),t.j41(7,"div"),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.j41(10,"div",2)(11,"span"),t.EFF(12),t.nI1(13,"decimalOrDash"),t.k0s()()()),2&r&&(t.R7$(2),t.JRh(t.bMT(3,4,"dossier.grade")),t.R7$(4),t.JRh(p.getGradeForStudent()||"\u2013"),t.R7$(2),t.JRh(t.bMT(9,6,"dossier.average")),t.R7$(4),t.JRh(t.i5U(13,8,p.average,"1-3")))},dependencies:[l.h,l.D9,$.rv],styles:[".final-entry[_ngcontent-%COMP%]{padding:1rem;display:grid;grid-template-columns:repeat(2,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}"]})}return i})();var D=a(2771),v=a(6354);let M=(()=>{class i{constructor(s){this.translate=s}transform(s,r,p,j="tests.points"){return s.IsPointGrading&&(s.IsPublished||p)?`${(0,d.m_)(r,s)?.Points||"\u2013"} / ${s.MaxPointsAdjusted||s.MaxPoints} ${this.translate.instant(j)}`:""}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU(l.c$,16))};static#e=this.\u0275pipe=t.EJ8({name:"bkdTestPoints",type:i,pure:!0,standalone:!0})}return i})(),x=(()=>{class i{constructor(s){this.translate=s}transform(s){return`${this.translate.instant("tests.factor")} ${s.Weight} (${s.WeightPercent}%)`}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU(l.c$,16))};static#e=this.\u0275pipe=t.EJ8({name:"bkdTestWeight",type:i,pure:!0,standalone:!0})}return i})();var g=a(9417),o=a(1413),c=a(152),m=a(5964),O=a(6977),T=a(2619),I=a(5449);const P=i=>({maxPoints:i});function y(i,R){if(1&i&&(t.j41(0,"div",15),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i){const s=t.XpG(2);t.R7$(),t.SpI(" ",t.i5U(2,1,"global.validation-errors.invalidPoints",t.eq3(4,P,s.maxPoints))," ")}}function A(i,R){if(1&i){const s=t.RV6();t.j41(0,"div",11)(1,"label",12),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",6)(5,"input",13,0),t.bIt("input",function(){t.eBV(s);const p=t.sdS(6),j=t.XpG();return t.Njj(j.onPointsChange(p.value))}),t.k0s()(),t.DNE(7,y,3,6,"div",14),t.k0s()}if(2&i){const s=t.XpG();t.R7$(2),t.JRh(t.bMT(3,8,"dossier.dialog.points")),t.R7$(2),t.AVh("is-invalid",s.pointsInput.errors),t.R7$(),t.AVh("is-invalid",s.pointsInput.errors),t.FS9("max",s.maxPoints),t.Y8G("formControl",s.pointsInput),t.R7$(2),t.Y8G("ngIf",s.pointsInput.errors)}}let G=(()=>{class i{constructor(s,r){this.activeModal=s,this.courseService=r,this.maxPoints=0,this.gradeSubject$=new o.B,this.pointsSubject$=new o.B,this.closeButtonDisabled$=new u.t(!1),this.gradingScaleDisabled$=new u.t(!0),this.grade$=this.gradeSubject$.pipe((0,c.B)(500)),this.points$=this.pointsSubject$.pipe((0,c.B)(500),(0,m.p)(this.isValid.bind(this)),(0,v.T)(Number)),this.destroy$=new o.B}ngOnInit(){this.maxPoints=(0,d.sU)(this.test),this.pointsInput=new g.hs({value:this.points,disabled:!1},[g.k0.min(0),g.k0.pattern("[0-9]+([\\.][0-9]+)?"),this.maxPointValidator()]),this.gradingScaleDisabled$.next(this.test.IsPointGrading&&this.points>0),this.points$.pipe((0,O.Q)(this.destroy$)).subscribe(s=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,points:s})),this.grade$.pipe((0,O.Q)(this.destroy$)).subscribe(s=>this.updateTestResult({studentId:this.studentId,testId:this.test.Id,gradeId:s}))}onGradeChange(s){this.gradeSubject$.next(s)}onPointsChange(s){this.pointsSubject$.next(s),this.gradingScaleDisabled$.next(s.length>0)}updateTestResult(s){this.closeButtonDisabled$.next(!0),this.courseService.updateTestResult(this.test.CourseId,s).subscribe(({testResult:r})=>{this.gradeId=r?.GradeId??null,this.updatedTestResult=r,this.closeButtonDisabled$.next(!1)})}isValid(s){return""!==s&&!isNaN(Number(s))&&!(Number(s)<0||Number(s)>this.maxPoints)}maxPointValidator(){return s=>Number(s.value)>(0,d.sU)(this.test)?{customMax:!0}:null}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU(n.Lw),t.rXU(I.I))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-grades-edit"]],inputs:{test:"test",gradeId:"gradeId",gradeOptions:"gradeOptions",points:"points",studentId:"studentId"},standalone:!0,features:[t.aNF],decls:19,vars:20,consts:[["pointInput",""],[1,"modal-body"],[1,"mb-4"],["class","form-group row",4,"ngIf"],[1,"form-group","row","mt-2"],["for","grade",1,"col-6","col-form-label"],[1,"col-6"],["id","grade",3,"valueChange","options","value","allowEmpty","disabled"],[1,"text-muted","mt-4"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"form-group","row"],["for","points",1,"col-6","col-form-label"],["id","points","type","number","step","0.01","min","0",1,"form-control",3,"input","max","formControl"],["class","invalid-feedback col-6 offset-6","data-testid","validation-error-message",4,"ngIf"],["data-testid","validation-error-message",1,"invalid-feedback","col-6","offset-6"]],template:function(r,p){1&r&&(t.j41(0,"div",1)(1,"p",2),t.EFF(2),t.k0s(),t.DNE(3,A,8,10,"div",3),t.j41(4,"div",4)(5,"label",5),t.EFF(6),t.nI1(7,"translate"),t.k0s(),t.j41(8,"div",6)(9,"bkd-select",7),t.nI1(10,"async"),t.bIt("valueChange",function(U){return U&&p.onGradeChange(U)}),t.k0s()()(),t.j41(11,"p",8),t.EFF(12),t.nI1(13,"translate"),t.k0s()(),t.j41(14,"div",9)(15,"button",10),t.nI1(16,"async"),t.bIt("click",function(){return p.activeModal.close(p.updatedTestResult)}),t.EFF(17),t.nI1(18,"translate"),t.k0s()()),2&r&&(t.R7$(2),t.JRh(p.test.Designation),t.R7$(),t.Y8G("ngIf",p.test.IsPointGrading),t.R7$(3),t.JRh(t.bMT(7,10,"dossier.dialog.grade")),t.R7$(3),t.Y8G("options",p.gradeOptions)("value",p.gradeId)("allowEmpty",!1)("disabled",t.bMT(10,12,p.gradingScaleDisabled$)),t.R7$(3),t.SpI(" ",t.bMT(13,14,p.test.IsPointGrading?"dossier.dialog.hint.points":"dossier.dialog.hint.grade")," "),t.R7$(3),t.Y8G("disabled",t.bMT(16,16,p.closeButtonDisabled$)),t.R7$(2),t.SpI(" ",t.bMT(18,18,"dossier.dialog.close")," "))},dependencies:[e.bT,g.YN,g.me,g.Q0,g.BC,g.VZ,g.zX,g.X1,g.l_,T.w,e.Jj,l.h,l.D9]})}return i})();var b=a(8958),W=a(855);function K(i,R){if(1&i){const s=t.RV6();t.j41(0,"a",11),t.bIt("click",function(){t.eBV(s);const p=t.XpG().bkdLet,j=t.XpG();return t.Njj(j.editGrading(p))}),t.j41(1,"i",12),t.EFF(2,"edit"),t.k0s(),t.j41(3,"span",13),t.EFF(4),t.nI1(5,"async"),t.k0s()()}if(2&i){const s=t.XpG(2);t.R7$(4),t.JRh(t.bMT(5,1,s.grading$))}}function L(i,R){if(1&i&&(t.j41(0,"span",13),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&i){const s=t.XpG(2);t.R7$(),t.JRh(t.bMT(2,1,s.grading$))}}function Y(i,R){if(1&i&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i){const s=t.XpG().bkdLet;t.R7$(),t.SpI(" ",t.bMT(2,1,s.IsPublished?"tests.published":"tests.not-published")," ")}}function V(i,R){if(1&i&&(t.j41(0,"div",2)(1,"div",3),t.EFF(2),t.k0s(),t.j41(3,"div",4),t.EFF(4),t.nI1(5,"date"),t.k0s(),t.j41(6,"div",5),t.DNE(7,K,6,3,"a",6)(8,L,3,3,"ng-template",null,0,t.C5r),t.k0s(),t.j41(10,"div",7),t.EFF(11),t.nI1(12,"bkdTestWeight"),t.k0s(),t.j41(13,"div",8)(14,"span"),t.EFF(15),t.nI1(16,"bkdTestPoints"),t.k0s()(),t.j41(17,"div",9),t.EFF(18),t.k0s(),t.DNE(19,Y,3,3,"div",10),t.k0s()),2&i){const s=R.bkdLet,r=t.sdS(9),p=t.XpG();t.R7$(2),t.SpI(" ",s.Designation," "),t.R7$(2),t.SpI(" ",t.i5U(5,8,s.Date,"dd.MM.yyyy")," "),t.R7$(3),t.Y8G("ngIf",p.isEditable&&s.IsOwner)("ngIfElse",r),t.R7$(4),t.SpI(" ",t.bMT(12,11,s)," "),t.R7$(4),t.JRh(t.ii3(16,13,s,p.studentId,p.isEditable,"dossier.points")),t.R7$(3),t.SpI(" ",s.Owner," "),t.R7$(),t.Y8G("ngIf",p.isEditable)}}let N=(()=>{class i{constructor(s,r){this.gradeService=s,this.modalService=r,this.test$=new D.m(1),this.grading$=this.test$.pipe((0,v.T)(this.getGrading.bind(this)))}ngOnChanges(s){s.test&&this.test$.next(this.test)}editGrading(s){const r=this.modalService.open(G,{backdrop:"static"});r.componentInstance.test=s,r.componentInstance.gradeId=this.getGradeId(s),r.componentInstance.gradeOptions=i.mapToOptions(this.gradingScale),r.componentInstance.studentId=this.studentId,r.componentInstance.points=this.getPoints(s),r.result.then(p=>{p&&this.updateStudentGrade(p,s)},()=>{})}updateStudentGrade(s,r){const p=(0,d.bT)(s,r);this.gradeService.updateStudentCourses(p)}getGrading(s){return this.gradingScale?.Grades.find(r=>r.Id===this.getGradeId(s))?.Designation||"\u2013"}getGradeId(s){return(0,d.m_)(this.studentId,s)?.GradeId||null}getPoints(s){return(0,d.m_)(this.studentId,s)?.Points||null}static mapToOptions(s){return s?.Grades.map(r=>({Key:r.Id,Value:r.Designation}))||null}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU(b.p),t.rXU(W.y))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-single-test"]],inputs:{test:"test",studentId:"studentId",gradingScale:"gradingScale",isEditable:"isEditable"},standalone:!0,features:[t.OA$,t.aNF],decls:2,vars:3,consts:[["notEditable",""],["class","test-entry",4,"bkdLet"],[1,"test-entry"],["data-testid","test-designation",1,"designation"],["data-testid","test-date",1,"date"],[1,"grade"],["class","btn btn-link","aria-label","edit grade",3,"click",4,"ngIf","ngIfElse"],["data-testid","test-factor",1,"factor"],["data-testid","test-points",1,"points"],["data-testid","test-teacher",1,"teacher"],["class","state","data-testid","test-status",4,"ngIf"],["aria-label","edit grade",1,"btn","btn-link",3,"click"],["data-testid","test-grade-edit-icon",1,"material-icons"],["data-testid","test-grade"],["data-testid","test-status",1,"state"]],template:function(r,p){1&r&&(t.DNE(0,V,20,18,"div",1),t.nI1(1,"async")),2&r&&t.Y8G("bkdLet",t.bMT(1,1,p.test$))},dependencies:[f.N,e.bT,e.Jj,e.vh,l.h,l.D9,M,x],styles:['.test-entry[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1rem;display:grid;grid-template-areas:"designation designation grade factor" "date date points ." "teacher teacher . ." "state state . .";grid-template-columns:repeat(4,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}.designation[_ngcontent-%COMP%]{grid-area:designation}.date[_ngcontent-%COMP%]{grid-area:date}.grade[_ngcontent-%COMP%]{grid-area:grade}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;color:#000;padding:0;text-decoration:none}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.grade[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:-1em;color:#00000080}.points[_ngcontent-%COMP%]{grid-area:points;color:#00000080}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.state[_ngcontent-%COMP%]{grid-area:state}@media (max-width: 575.98px){.test-entry[_ngcontent-%COMP%]{grid-template-areas:"designation designation" "date grade" "factor points" "teacher teacher" "state state";grid-template-columns:repeat(2,1fr)}}']})}return i})();function w(i,R){if(1&i&&t.nrm(0,"bkd-dossier-single-test",5),2&i){const s=R.$implicit,r=t.XpG(3);t.Y8G("test",s)("studentId",r.studentId)("gradingScale",r.getGradingScaleOfTest(s))("isEditable",r.isEditable)}}function k(i,R){if(1&i&&(t.j41(0,"div"),t.nrm(1,"bkd-dossier-grades-final-grade",3),t.DNE(2,w,1,4,"bkd-dossier-single-test",4),t.k0s()),2&i){const s=t.XpG().bkdLet,r=t.XpG();t.R7$(),t.Y8G("finalGrade",r.decoratedCourse.finalGrade)("grading",r.decoratedCourse.grading)("gradingScale",r.decoratedCourse.gradingScale)("average",r.decoratedCourse.average),t.R7$(),t.Y8G("ngForOf",s)}}function H(i,R){1&i&&(t.j41(0,"p",6),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"dossier.no-tests")," "))}function X(i,R){if(1&i&&(t.qex(0),t.DNE(1,k,3,5,"div",2)(2,H,3,3,"ng-template",null,0,t.C5r),t.bVm()),2&i){const s=R.bkdLet,r=t.sdS(3);t.R7$(),t.Y8G("ngIf",s.length>0)("ngIfElse",r)}}let z=(()=>{class i{ngOnChanges(s){s.decoratedCourse&&this.sortedTests$.next(this.sortedTests())}constructor(){this.sortedTests$=new u.t([])}sortedTests(){return this.decoratedCourse.course.Tests?(0,d.my)(this.decoratedCourse.course.Tests):[]}getGradingScaleOfTest(s){return(0,d.Eq)(s,this.gradingScales)}static#t=this.\u0275fac=function(r){return new(r||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-course-tests"]],inputs:{studentId:"studentId",decoratedCourse:"decoratedCourse",gradingScales:"gradingScales",isEditable:"isEditable"},standalone:!0,features:[t.OA$,t.aNF],decls:2,vars:3,consts:[["noTests",""],[4,"bkdLet"],[4,"ngIf","ngIfElse"],[3,"finalGrade","grading","gradingScale","average"],[3,"test","studentId","gradingScale","isEditable",4,"ngFor","ngForOf"],[3,"test","studentId","gradingScale","isEditable"],["data-testid","message-no-tests",1,"p-3"]],template:function(r,p){1&r&&(t.DNE(0,X,4,2,"ng-container",1),t.nI1(1,"async")),2&r&&t.Y8G("bkdLet",t.bMT(1,1,p.sortedTests$))},dependencies:[f.N,e.bT,E,e.pM,N,e.Jj,l.h,l.D9]})}return i})();function J(i,R){if(1&i&&(t.j41(0,"span",2),t.EFF(1),t.k0s()),2&i){const s=t.XpG();t.R7$(),t.SpI(" (",s.grade,")")}}function Q(i,R){if(1&i&&(t.j41(0,"span",3),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&i){const s=t.XpG();t.R7$(),t.SpI(" (",t.i5U(2,1,s.average,"1.1-3"),")")}}let Z=(()=>{class i{constructor(){}get grade(){return this.getGradeForStudent()}getGradeForStudent(){return h(this.grading,this.finalGrade,this.gradingScale)}static#t=this.\u0275fac=function(r){return new(r||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-grades-course-header"]],inputs:{designation:"designation",finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},standalone:!0,features:[t.aNF],decls:3,vars:3,consts:[["class","grade","data-testId","grade",4,"ngIf"],["class","average","data-testId","average",4,"ngIf"],["data-testId","grade",1,"grade"],["data-testId","average",1,"average"]],template:function(r,p){1&r&&(t.EFF(0),t.DNE(1,J,2,1,"span",0)(2,Q,3,4,"span",1)),2&r&&(t.JRh(p.designation),t.R7$(),t.Y8G("ngIf",p.grade),t.R7$(),t.Y8G("ngIf",!p.grade&&p.average))},dependencies:[e.bT,e.QX],styles:[".average[_ngcontent-%COMP%]{color:#00000080}"]})}return i})();var q=a(3919);function tt(i,R){if(1&i&&t.nrm(0,"bkd-dossier-course-tests",11),2&i){const s=t.XpG().$implicit,r=t.XpG(2);t.Y8G("decoratedCourse",s)("studentId",r.studentId)("gradingScales",r.gradingScales)("isEditable",r.isEditable)}}function et(i,R){if(1&i){const s=t.RV6();t.j41(0,"div")(1,"div",4)(2,"div",5,1)(4,"div",6)(5,"bkd-student-dossier-entry-header",7),t.bIt("click",function(){t.eBV(s);const p=t.sdS(3);return t.Njj(p.toggle())}),t.nrm(6,"bkd-dossier-grades-course-header",8),t.k0s()(),t.j41(7,"div",9)(8,"div",10),t.DNE(9,tt,1,4,"ng-template"),t.k0s()()()()()}if(2&i){const s=R.$implicit,r=t.sdS(3);t.R7$(5),t.Y8G("opened",!r.collapsed),t.R7$(),t.Y8G("designation",s.course.Designation)("finalGrade",s.finalGrade)("grading",s.grading)("gradingScale",s.gradingScale)("average",s.average)}}function st(i,R){if(1&i&&(t.qex(0),t.DNE(1,et,10,6,"div",3),t.nI1(2,"async"),t.bVm()),2&i){const s=t.XpG();t.R7$(),t.Y8G("ngForOf",t.bMT(2,2,s.decoratedCoursesSubject$))("ngForTrackBy",s.trackByCourseId)}}function nt(i,R){1&i&&(t.j41(0,"p",12),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"dossier.no-courses")," "))}let at=(()=>{class i{constructor(s){this.dossierGradeService=s,this.isEditable=!0,this.decoratedCoursesSubject$=new u.t([])}ngOnChanges(){this.decoratedCoursesSubject$.next(this.decorateCourses())}trackByCourseId(s,r){return r.course.Id}decorateCourses(){return this.courses?.map(s=>{const r=this.dossierGradeService.getFinalGradeForStudent(s,this.studentId),p=this.dossierGradeService.getGradesForStudent(s,this.studentId,this.gradingScales);return{course:s,finalGrade:r,grading:this.dossierGradeService.getGradingForStudent(s,this.studentId),gradingScale:this.dossierGradeService.getGradingScaleOfCourse(s,this.gradingScales),average:r?.AverageTestResult||(0,_.L)(p)}})}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU(b.p))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-grades-view"]],inputs:{courses:"courses",studentId:"studentId",gradingScales:"gradingScales",isEditable:"isEditable"},standalone:!0,features:[t.OA$,t.aNF],decls:3,vars:2,consts:[["noCourses",""],["courses","ngbAccordionItem"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf","ngForTrackBy"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],[3,"designation","finalGrade","grading","gradingScale","average"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[3,"decoratedCourse","studentId","gradingScales","isEditable"],["data-testid","message-no-courses",1,"py-3"]],template:function(r,p){if(1&r&&t.DNE(0,st,3,4,"ng-container",2)(1,nt,3,3,"ng-template",null,0,t.C5r),2&r){let j;const U=t.sdS(2);t.Y8G("ngIf",(null!==(j=null==p.courses?null:p.courses.length)&&void 0!==j?j:0)>0)("ngIfElse",U)}},dependencies:[e.bT,e.pM,n.r6,n.tW,n.x7,q.$,Z,n.$R,n.UA,z,e.Jj,l.h,l.D9]})}return i})()},4456:(F,S,a)=>{a.d(S,{uz:()=>g,ae:()=>M,NL:()=>v,MA:()=>x});var e=a(5783),n=a(5306),l=a(9573),u=a(838);const _=e.NW({Id:e.Yj,TestId:e.ai,CourseRegistrationId:e.ai,GradeId:(0,n.c$)(e.ai),GradeValue:(0,n.c$)(e.ai),GradeDesignation:(0,n.c$)(e.Yj),Points:(0,n.c$)(e.ai),StudentId:e.ai}),d=e.NW({Id:e.ai,CourseId:e.ai,Date:n.iC,Designation:e.Yj,Weight:e.ai,WeightPercent:e.ai,IsPointGrading:e.zM,MaxPoints:(0,n.c$)(e.ai),MaxPointsAdjusted:(0,n.c$)(e.ai),IsPublished:e.zM,IsOwner:e.zM,Owner:(0,n.c$)(e.Yj),GradingScaleId:(0,n.c$)(e.ai),Results:(0,n.c$)(e.YO(_))}),f=e.NW({Id:e.ai}),h=e.OH({HRef:(0,n.c$)(e.Yj)}),C=e.OH({HasEvaluationStarted:e.zM,EvaluationUntil:(0,n.c$)(n.iC),HasReviewOfEvaluationStarted:e.zM,HasTestGrading:e.zM,Id:e.ai}),$=e.E$([f,h,C]),t=e.OH({Id:e.ai,StudentCount:e.ai}),E=e.E$([f,h,t]),D=e.NW({Grade:e.Yj,AverageTestResult:e.ai,Id:e.ai,StudentId:e.ai}),v=e.NW({AverageTestResult:e.ai,CanGrade:e.zM,EventId:e.ai,GradeId:(0,n.c$)(e.ai),GradeValue:(0,n.c$)(e.ai),Id:e.ai,StudentId:e.ai}),M=e.NW({HRef:e.Yj,Id:e.ai,Number:e.Yj,Designation:e.Yj,DateFrom:(0,n.c$)(n.iC),DateTo:(0,n.c$)(n.iC),StatusId:e.ai,GradingScaleId:(0,n.c$)(e.ai),FinalGrades:(0,n.c$)(e.YO(D)),Gradings:(0,n.c$)(e.YO(v)),Tests:(0,n.c$)(e.YO(d)),EvaluationStatusRef:$,AttendanceRef:E,ParticipatingStudents:(0,n.c$)(e.YO(l.o)),Classes:(0,n.c$)(e.YO(u.i))}),x=e.NW({TestResults:e.YO(_),Gradings:e.YO(v)}),g=e.NW({Gradings:e.YO(v)})},5666:(F,S,a)=>{a.d(S,{H:()=>n});var e=a(5783);const n=e.NW({Key:e.KC([e.ai,e.Yj]),Value:e.Yj})},838:(F,S,a)=>{a.d(S,{i:()=>n});var e=a(5783);const n=e.NW({Id:e.ai,Designation:e.Yj,StudentCount:e.ai,Number:e.Yj})},1015:(F,S,a)=>{a.d(S,{n:()=>_,t:()=>u});var e=a(5783),n=a(5306),l=a(5666);const u=e.NW({Id:e.Yj,SubscriptionId:e.ai,VssId:e.ai,EventId:e.ai,DropdownItems:(0,n.c$)(e.YO(l.H)),IdPerson:e.ai,ShowAsRadioButtons:e.zM,Value:(0,n.c$)(e.Yj)}),_=e.NW({Id:e.ai,CurrentWorkProgressId:(0,n.c$)(e.Yj||(0,n.c$)(e.ai)),EventId:(0,n.c$)(e.ai),PersonId:(0,n.c$)(e.ai),Status:e.Yj,StatusId:(0,n.c$)(e.ai),IsOkay:(0,n.c$)(e.zM),IsQueued:(0,n.c$)(e.zM),EventDesignation:(0,n.c$)(e.Yj),EventInformation:(0,n.c$)(e.Yj||e.ai),EventNotes:(0,n.c$)(e.Yj||e.ai),CheckPersonalInformation:(0,n.c$)(e.zM),CorrespondencePersonId:(0,n.c$)(e.ai),CorrespondenceAddressTypeId:(0,n.c$)(e.Yj||e.ai),Billing1PersonId:(0,n.c$)(e.ai),Billing1AddressTypeId:(0,n.c$)(e.Yj||e.ai),Billing2PersonId:(0,n.c$)(e.Yj||e.ai),Billing2AddressTypeId:(0,n.c$)(e.Yj||e.ai),KindOfPaymentId1:(0,n.c$)(e.Yj||e.ai),KindOfPaymentEmail1:(0,n.c$)(e.Yj||e.ai),KindOfPaymentId2:(0,n.c$)(e.Yj||e.ai),KindOfPaymentEmail2:(0,n.c$)(e.Yj||e.ai),IdObject:(0,n.c$)(e.ai),IdSubscription:(0,n.c$)(e.ai),IdStatus:(0,n.c$)(e.ai),AnsweredQuestions:(0,n.c$)(e.Yj||e.ai),Messages:(0,n.c$)(e.Yj||e.ai),SubscriptionDetails:(0,n.c$)(e.YO(u)),HRef:(0,n.c$)(e.Yj)})},9082:(F,S,a)=>{a.d(S,{jr:()=>u,rv:()=>_,yk:()=>d});var e=a(177),n=a(4438);const l="1-3",u="\u2013";let _=(()=>{class h{constructor($){this.locale=$}transform($,t,E){const D=Number($??null);return isNaN(D)?u:d(Number($??null),E??this.locale,t)}static#t=this.\u0275fac=function(t){return new(t||h)(n.rXU(n.xe9,16))};static#e=this.\u0275pipe=n.EJ8({name:"decimalOrDash",type:h,pure:!0,standalone:!0})}return h})();function d(h,C,$){return 0===h?u:(0,e.ZV)(h,C,`1.${function f(h){return h?String(h).includes("-")?String(h):`${h}-${h}`:l}($)}`)}},855:(F,S,a)=>{a.d(S,{y:()=>l});var e=a(4438),n=a(1324);let l=(()=>{class u{constructor(d){this.modal=d}open(...d){const f=this.modal.open(...d);return this.applyPortalOffsetAndMaxHeight(f),this.disablePortalScrolling(f),f}get activeInstances(){return this.modal.activeInstances}dismissAll(...d){return this.modal.dismissAll(...d)}hasOpenModals(...d){return this.modal.hasOpenModals(...d)}applyPortalOffsetAndMaxHeight(d){const f=this.getModalWindowElement(d);f?this.portalWindow&&(f.style.top=`${this.getModalIframeOffset()}px`,f.style.maxHeight=`${this.getModalHeight()}px`):console.warn("Trying to apply portal offset to <ngb-modal-window>, but element is not present!")}disablePortalScrolling(d){this.portalWindow&&this.portalDocument&&(this.portalDocument.style.paddingRight=this.portalWindow.innerWidth-this.portalDocument.clientWidth+"px",this.portalDocument.style.overflow="hidden"),d.hidden.subscribe(()=>{this.portalDocument&&(this.portalDocument.style.paddingRight="0px",this.portalDocument.style.overflow="auto")})}getModalWindowElement(d){return d._windowCmptRef?.instance?._elRef?.nativeElement??null}getModalIframeOffset(){return Math.max(this.getViewportTop()-this.getIframeTop(),0)}getIframeTop(){return this.portalQuerySelector("bkd-content")?.shadowRoot?.querySelector("iframe")?.offsetTop??0}getIFrameBottom(){const d=this.portalQuerySelector("bkd-content")?.shadowRoot?.querySelector("iframe");return d?d.offsetTop+d.offsetHeight:0}getModalTop(){return Math.max(this.getViewportTop(),this.getIframeTop())}getModalBottom(){return Math.min(this.getViewportBottom(),this.getIFrameBottom())}getModalHeight(){return this.getModalBottom()-this.getModalTop()}getViewportTop(){return this.portalWindow?.scrollY??0}getViewportBottom(){return this.getViewportTop()+this.getViewportHeight()}getViewportHeight(){return this.portalWindow?.innerHeight??0}portalQuerySelector(d){return this.portalWindow?.document?.querySelector("bkd-portal")?.shadowRoot?.querySelector(d)??null}get portalDocument(){return this.portalWindow?.document.documentElement??null}get portalWindow(){return window.parent===window?null:window.parent}static#t=this.\u0275fac=function(f){return new(f||u)(e.KVO(n.Bq))};static#e=this.\u0275prov=e.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()},5449:(F,S,a)=>{a.d(S,{I:()=>v});var e=a(5783),n=a(5558),l=a(6354),u=a(7673),_=a(8810),d=a(2809),f=a(4456),h=a(785),C=a(4297),$=a(5437),t=a(6952),E=a(4438),D=a(1626);let v=(()=>{class M extends t.G{constructor(g,o){super(g,o,f.ae,"Courses"),this.statusCodec=e.NW((0,$.U)(this.codec.props,["Id","StatusId","EvaluationStatusRef"]))}getNumberOfCoursesForRating(){return this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef&fields=Id,StatusId,EvaluationStatusRef&filter.StatusId=;10300;10240`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe((0,n.n)((0,h.k$)(this.statusCodec)),(0,l.T)(g=>g.filter(o=>!0===o.EvaluationStatusRef.HasEvaluationStarted)),(0,l.T)(g=>g.length))}getExpandedCourses(g){return(0,C.h)(g,"TeacherRole")?this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef,AttendanceRef,Classes,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe((0,n.n)((0,h.k$)(f.ae))):(0,u.of)([])}getExpandedCourse(g){return this.http.get(`${this.baseUrl}/${g}?expand=ParticipatingStudents,EvaluationStatusRef,Tests,Gradings,FinalGrades,Classes`).pipe((0,n.n)((0,h.D4)(f.ae)))}getExpandedCoursesForDossier(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades,EvaluationStatusRef,ParticipatingStudents,Classes&filter.StatusId=;${this.settings.eventlist.statusfilter}`).pipe((0,n.n)((0,h.k$)(f.ae)))}getExpandedCoursesForStudent(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"StudentRole"}}).pipe((0,n.n)((0,h.k$)(f.ae)))}add(g,o,c,m,O,T,I){return this.http.put(`${this.baseUrl}/${g}/Tests/New`,{Tests:[{Date:o,Designation:c,Weight:m,IsPointGrading:O,MaxPoints:T,MaxPointsAdjusted:I}]}).pipe((0,l.T)(()=>{}))}update(g,o,c,m,O,T,I,P){return this.http.put(`${this.baseUrl}/${g}/Tests/Update`,{Tests:[{Id:o,Designation:c,Date:m,Weight:O,IsPointGrading:T,MaxPoints:I,MaxPointsAdjusted:P}]}).pipe((0,l.T)(()=>{}))}delete(g,o){return this.http.put(`${this.baseUrl}/${g}/Tests/Delete`,{TestIds:[o]}).pipe((0,l.T)(()=>o))}updateTestResult(g,o){const{studentId:c,testId:m,...O}=o,T={StudentIds:[c],TestId:m},I="gradeId"in O?{...T,GradeId:O.gradeId}:{...T,Points:O.points};return this.http.put(`${this.baseUrl}/${g}/SetTestResult`,I).pipe((0,n.n)((0,h.D4)(f.MA)),(0,n.n)(({TestResults:P,Gradings:y})=>P.length<=1&&1===y.length?(0,u.of)({courseId:g,testResult:P[0]??null,grading:y[0]}):(0,_.$)(()=>new Error("`TestResults` or `Gradings` does not contain a single value"))))}setAverageAsFinalGrade(g){return this.http.put(`${this.baseUrl}/SetAverageTestResult`,g).pipe((0,n.n)((0,h.D4)(f.uz)))}publishTest(g){return this.http.put(`${this.baseUrl}/PublishTest`,{TestIds:[g]}).pipe((0,l.T)(()=>g))}unpublishTest(g){return this.http.put(`${this.baseUrl}/UnpublishTest`,{TestIds:[g]}).pipe((0,l.T)(()=>g))}static#t=this.\u0275fac=function(o){return new(o||M)(E.KVO(D.Qq),E.KVO(d.yy))};static#e=this.\u0275prov=E.jDH({token:M,factory:M.\u0275fac,providedIn:"root"})}return M})()},8958:(F,S,a)=>{a.d(S,{p:()=>c});var e=a(2771),n=a(3294),l=a(5558),u=a(6354),_=a(4668),d=a(7786),f=a(4572),h=a(7468),C=a(2816),$=a(2809),t=a(7113),E=a(9728),D=a(4438),v=a(5449),M=a(1937),x=a(5507),g=a(2673),o=a(1763);let c=(()=>{class m{constructor(T,I,P,y,A,B){this.coursesRestService=T,this.subscriptionRestService=I,this.reportsService=P,this.loadingService=y,this.gradingScalesRestService=A,this.settings=B,this.studentId$=new e.m(1),this.initialStudentCourses$=this.studentId$.pipe((0,n.F)(),(0,l.n)(this.loadCourses.bind(this)),(0,u.T)(G=>G.sort((b,W)=>b.Designation.localeCompare(W.Designation))),(0,_.t)(1)),this.action$=new e.m(1),this.studentCourses$=(0,d.h)(this.action$,this.initialStudentCourses$.pipe((0,u.T)(G=>({type:"initializeCourses",payload:G})))).pipe((0,C.S)(this.coursesReducer.bind(this),[]),(0,_.t)(1)),this.loading$=this.loadingService.loading$,this.studentCourseIds$=this.studentCourses$.pipe((0,u.T)(G=>G.flatMap(b=>b.Id))),this.idSubscriptions$=(0,f.z)([this.studentId$,this.studentCourseIds$]).pipe((0,l.n)(([G,b])=>this.subscriptionRestService.getIdSubscriptionsByStudentAndCourse(G,b))),this.ids$=this.idSubscriptions$.pipe((0,u.T)(G=>G.map(b=>b.Id))),this.testReports$=this.ids$.pipe((0,u.T)(G=>this.reportsService.getTeacherSubscriptionReports(G))),this.tests$=this.studentCourses$.pipe((0,u.T)(G=>G.flatMap(b=>b.Tests).filter(E.TM))),this.gradingScaleIdsFromTests$=this.tests$.pipe((0,u.T)(G=>[...G.map(b=>b.GradingScaleId)].filter(E.TM).filter(E.Am))),this.gradingScaleIdsFromCourses$=this.studentCourses$.pipe((0,u.T)(G=>G.flatMap(b=>b.GradingScaleId).filter(E.TM).filter(E.Am))),this.gradingScaleIds$=(0,f.z)([this.gradingScaleIdsFromCourses$,this.gradingScaleIdsFromTests$]).pipe((0,u.T)(([G,b])=>G.concat(b).filter(E.Am))),this.gradingScales$=this.gradingScaleIds$.pipe((0,l.n)(G=>(0,h.p)(G.map(b=>this.gradingScalesRestService.getGradingScale(b)))))}setStudentId(T){this.studentId$.next(T)}getFinalGradeForStudent(T,I){return T?.FinalGrades?.find(P=>P.StudentId===I)}getGradingForStudent(T,I){return T?.Gradings?.find(P=>P.StudentId===I)}getGradingScaleOfCourse(T,I){return I?.find(P=>P.Id===T.GradingScaleId)}getGradesForStudent(T,I,P){return T.Tests?.flatMap(y=>({value:Number((0,t.Eq)(y,P)?.Grades.find(B=>B.Id===(0,t.m_)(I,y)?.GradeId)?.Designation),weight:y.Weight})).filter(({value:y})=>!!y)||[]}updateStudentCourses(T){this.action$.next({type:"updateCourses",payload:T})}loadCourses(T){return this.loadingService.load(this.coursesRestService.getExpandedCoursesForDossier().pipe((0,u.T)(I=>I.filter(P=>P.ParticipatingStudents?.find(y=>y.Id===T)))))}coursesReducer(T,I){switch(I.type){case"initializeCourses":return I.payload;case"updateCourses":return this.updateCourses([...T],I.payload);default:return T}}updateCourses(T,I){return T.map(P=>({...P,Tests:null!==P.Tests?P.Tests.map(y=>y.Id===I.Id?I:y):null}))}static#t=this.\u0275fac=function(I){return new(I||m)(D.KVO(v.I),D.KVO(M.u),D.KVO(x.P),D.KVO(g.U),D.KVO(o.T),D.KVO($.yy))};static#e=this.\u0275prov=D.jDH({token:m,factory:m.\u0275fac})}return m})()},1763:(F,S,a)=>{a.d(S,{T:()=>t});var e=a(5558),n=a(7468),l=a(2809),u=a(5783);const _=u.NW({Id:u.ai,Designation:u.Yj}),d=u.NW({Id:u.ai,Grades:u.YO(_)});var f=a(785),h=a(6952),C=a(4438),$=a(1626);let t=(()=>{class E extends h.G{constructor(v,M){super(v,M,d,"GradingScales")}getGradingScale(v){return this.http.get(`${this.baseUrl}/${v}`).pipe((0,e.n)((0,f.D4)(d)))}getGradingScales(v){return(0,n.p)(v.map(this.getGradingScale.bind(this)))}static#t=this.\u0275fac=function(M){return new(M||E)(C.KVO($.Qq),C.KVO(l.yy))};static#e=this.\u0275prov=C.jDH({token:E,factory:E.\u0275fac,providedIn:"root"})}return E})()},1937:(F,S,a)=>{a.d(S,{u:()=>h});var e=a(5558),n=a(2809),l=a(1015),u=a(785),_=a(6952),d=a(4438),f=a(1626);let h=(()=>{class C extends _.G{constructor(t,E){super(t,E,l.t,"Subscriptions")}getIdSubscriptionsByStudentAndCourse(t,E){return this.http.get(`${this.settings.apiUrl}/Subscriptions/?filter.PersonId==${t}&filter.EventId=;${E}`).pipe((0,e.n)((0,u.k$)(l.n)))}static#t=this.\u0275fac=function(E){return new(E||C)(d.KVO(f.Qq),d.KVO(n.yy))};static#e=this.\u0275prov=d.jDH({token:C,factory:C.\u0275fac,providedIn:"root"})}return C})()},9736:(F,S,a)=>{function e(_){return 0===_.length?0:l(_.map(({value:d,weight:f})=>d*f))/l(_.map(({weight:d})=>d))}function n(_){return 0===_.length?0:Number(l(_)/_.length)}function l(_){return _.reduce(u,0)}function u(_,d){return _+d}a.d(S,{G:()=>n,L:()=>e})},4297:(F,S,a)=>{function e(l,u){return n(l).includes(u)}function n(l){return l?l.split(";"):[]}a.d(S,{O:()=>n,h:()=>e})},152:(F,S,a)=>{a.d(S,{B:()=>u});var e=a(3236),n=a(9974),l=a(4360);function u(_,d=e.E){return(0,n.N)((f,h)=>{let C=null,$=null,t=null;const E=()=>{if(C){C.unsubscribe(),C=null;const v=$;$=null,h.next(v)}};function D(){const v=t+_,M=d.now();if(M<v)return C=this.schedule(void 0,v-M),void h.add(C);E()}f.subscribe((0,l._)(h,v=>{$=v,t=d.now(),C||(C=d.schedule(D,_),h.add(C))},()=>{E(),h.complete()},void 0,()=>{$=C=null}))})}}}]);