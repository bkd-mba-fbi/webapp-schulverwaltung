"use strict";(self.webpackChunkwebapp_schulverwaltung=self.webpackChunkwebapp_schulverwaltung||[]).push([[14],{7113:(b,v,a)=>{a.d(v,{C7:()=>n,Eq:()=>D,TG:()=>m,bT:()=>C,m_:()=>_,my:()=>t,p6:()=>f,sU:()=>d,tj:()=>l,xk:()=>T,zs:()=>g});var e=a(9736);function n(o,u){return u.map(E=>E.Id===o.TestId?C(o,E):E)}function l(o,u,E){return E.map(F=>F.Id===o?function I(o,u){return{...u,Results:u.Results?.filter(E=>E.Id!==o)||[]}}(u,F):F)}function f(o,u){return u.map(E=>E.Id===o?{...E,IsPublished:!E.IsPublished}:E)}function g(o){const u=function R(o){return o.Results?.map(u=>null!==u.Points?u.Points:h).filter(u=>u>h)||[]}(o);if(0===u.length)throw new Error("unable to calculate averages without results");return(0,e.G)(u)}function d(o){return o.MaxPointsAdjusted||o.MaxPoints}function m(o){const u=function c(o){return o.Results?.filter(u=>null!==u.GradeDesignation).map(u=>Number(u.GradeDesignation)).filter(u=>!isNaN(u))||[]}(o);if(0===u.length)throw new Error("unable to calculate averages without results");return(0,e.G)(u)}function _(o,u){return u.Results?.find(E=>E.StudentId===o)}function T(o,u){return null===u?null:u.filter(E=>E.Id!==o)}function C(o,u){const E=u.Results?.filter(F=>o.Id!==F.Id)||[];return{...u,Results:[...E,o]}}function t(o){return o.slice().sort((u,E)=>E.Date.getTime()-u.Date.getTime())}function D(o,u){return u?.find(E=>E.Id===o.GradingScaleId)||null}const h=-1},2619:(b,v,a)=>{a.d(v,{w:()=>C});var e=a(177),n=a(4438),l=a(9417),f=a(3955),g=a(4412),d=a(4572),m=a(6354);function _(t,D){if(1&t&&(n.j41(0,"option",3),n.EFF(1),n.nI1(2,"translate"),n.k0s()),2&t){const I=n.XpG();n.Y8G("ngValue",null),n.R7$(),n.SpI(" ",n.bMT(2,2,I.emptyLabel)," ")}}function T(t,D){if(1&t&&(n.j41(0,"option",3),n.EFF(1),n.k0s()),2&t){const I=D.$implicit;n.Y8G("ngValue",I),n.R7$(),n.SpI(" ",I.Value," ")}}let C=(()=>{class t{constructor(){this.options=[],this.allowEmpty=!0,this.emptyLabel="",this.value=null,this.disabled=!1,this.tabindex=0,this.valueChange=new n.bkB,this.options$=new g.t([]),this.rawValue$=new g.t(null),this.value$=(0,d.z)([this.rawValue$,this.options$]).pipe((0,m.T)(([I,c])=>c&&c.find(R=>R.Key===I)||null))}ngOnChanges(I){I.value&&this.rawValue$.next(I.value.currentValue),I.options&&this.options$.next(I.options.currentValue)}static#t=this.\u0275fac=function(c){return new(c||t)};static#e=this.\u0275cmp=n.VBU({type:t,selectors:[["bkd-select"]],inputs:{options:"options",allowEmpty:"allowEmpty",emptyLabel:"emptyLabel",value:"value",disabled:"disabled",tabindex:"tabindex"},outputs:{valueChange:"valueChange"},standalone:!0,features:[n.OA$,n.aNF],decls:5,vars:7,consts:[[1,"form-select",3,"ngModelChange","tabindex","disabled","ngModel"],[3,"ngValue",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"]],template:function(c,R){1&c&&(n.j41(0,"select",0),n.nI1(1,"async"),n.bIt("ngModelChange",function(o){return R.valueChange.emit(o&&o.Key)}),n.DNE(2,_,3,4,"option",1)(3,T,2,2,"option",2),n.EFF(4," >\n"),n.k0s()),2&c&&(n.FS9("tabindex",R.tabindex),n.Y8G("disabled",R.disabled)("ngModel",n.bMT(1,5,R.value$)),n.R7$(2),n.Y8G("ngIf",R.allowEmpty),n.R7$(),n.Y8G("ngForOf",R.options))},dependencies:[l.YN,l.xH,l.y7,l.wz,l.BC,l.vS,e.bT,e.pM,e.Jj,f.h,f.D9]})}return t})()},7014:(b,v,a)=>{a.d(v,{Q:()=>at});var e=a(177),n=a(1324),l=a(3955),f=a(4412),g=a(9736),d=a(7113),m=a(7887);function _(i,O,s){return O?O.Grade:function T(i,O){return O?.Grades.find(s=>s.Id===i?.GradeId)?.Designation}(i,s)||i?.GradeValue}var C=a(9082),t=a(4438);let D=(()=>{class i{constructor(){}getGradeForStudent(){return _(this.grading,this.finalGrade,this.gradingScale)}static#t=this.\u0275fac=function(r){return new(r||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-grades-final-grade"]],inputs:{finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},standalone:!0,features:[t.aNF],decls:14,vars:11,consts:[[1,"final-entry"],["data-testid","final-grade"],["data-testid","average-test-results"]],template:function(r,p){1&r&&(t.j41(0,"div",0)(1,"div"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",1)(5,"span"),t.EFF(6),t.k0s()(),t.j41(7,"div"),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.j41(10,"div",2)(11,"span"),t.EFF(12),t.nI1(13,"decimalOrDash"),t.k0s()()()),2&r&&(t.R7$(2),t.JRh(t.bMT(3,4,"dossier.grade")),t.R7$(4),t.JRh(p.getGradeForStudent()||"\u2013"),t.R7$(2),t.JRh(t.bMT(9,6,"dossier.average")),t.R7$(4),t.JRh(t.i5U(13,8,p.average,"1-3")))},dependencies:[l.h,l.D9,C.rv],styles:[".final-entry[_ngcontent-%COMP%]{padding:1rem;display:grid;grid-template-columns:repeat(2,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}"]})}return i})();var I=a(2771),c=a(6354);let R=(()=>{class i{constructor(s){this.translate=s}transform(s,r,p,B="tests.points"){return s.IsPointGrading&&(s.IsPublished||p)?`${(0,d.m_)(r,s)?.Points||"\u2013"} / ${s.MaxPointsAdjusted||s.MaxPoints} ${this.translate.instant(B)}`:""}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU(l.c$,16))};static#e=this.\u0275pipe=t.EJ8({name:"bkdTestPoints",type:i,pure:!0,standalone:!0})}return i})(),h=(()=>{class i{constructor(s){this.translate=s}transform(s){return`${this.translate.instant("tests.factor")} ${s.Weight} (${s.WeightPercent}%)`}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU(l.c$,16))};static#e=this.\u0275pipe=t.EJ8({name:"bkdTestWeight",type:i,pure:!0,standalone:!0})}return i})();var o=a(9417),u=a(1413),E=a(152),F=a(5964),j=a(6977),x=a(2619),S=a(5449);const P=i=>({maxPoints:i});function G(i,O){if(1&i&&(t.j41(0,"div",15),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i){const s=t.XpG(2);t.R7$(),t.SpI(" ",t.i5U(2,1,"global.validation-errors.invalidPoints",t.eq3(4,P,s.maxPoints))," ")}}function y(i,O){if(1&i){const s=t.RV6();t.j41(0,"div",11)(1,"label",12),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",6)(5,"input",13,0),t.bIt("input",function(){t.eBV(s);const p=t.sdS(6),B=t.XpG();return t.Njj(B.onPointsChange(p.value))}),t.k0s()(),t.DNE(7,G,3,6,"div",14),t.k0s()}if(2&i){const s=t.XpG();t.R7$(2),t.JRh(t.bMT(3,8,"dossier.dialog.points")),t.R7$(2),t.AVh("is-invalid",s.pointsInput.errors),t.R7$(),t.AVh("is-invalid",s.pointsInput.errors),t.FS9("max",s.maxPoints),t.Y8G("formControl",s.pointsInput),t.R7$(2),t.Y8G("ngIf",s.pointsInput.errors)}}let U=(()=>{class i{constructor(s,r){this.activeModal=s,this.courseService=r,this.maxPoints=0,this.gradeSubject$=new u.B,this.pointsSubject$=new u.B,this.closeButtonDisabled$=new f.t(!1),this.gradingScaleDisabled$=new f.t(!0),this.grade$=this.gradeSubject$.pipe((0,E.B)(500)),this.points$=this.pointsSubject$.pipe((0,E.B)(500),(0,F.p)(this.isValid.bind(this)),(0,c.T)(Number)),this.destroy$=new u.B}ngOnInit(){this.maxPoints=(0,d.sU)(this.test),this.pointsInput=new o.hs({value:this.points,disabled:!1},[o.k0.min(0),o.k0.pattern("[0-9]+([\\.][0-9]+)?"),this.maxPointValidator()]),this.gradingScaleDisabled$.next(this.test.IsPointGrading&&this.points>0),this.grade$.pipe((0,j.Q)(this.destroy$),(0,c.T)(this.buildRuequestBodyForGradeChange.bind(this))).subscribe(s=>this.updateTestResult(s)),this.points$.pipe((0,j.Q)(this.destroy$),(0,c.T)(this.buildRequestBodyPointsChange.bind(this))).subscribe(s=>this.updateTestResult(s))}onGradeChange(s){this.gradeSubject$.next(s)}onPointsChange(s){this.pointsSubject$.next(s),this.gradingScaleDisabled$.next(s.length>0)}get updatedTestResult(){return this.updatedTest?.TestResults[0]}updateTestResult(s){this.closeButtonDisabled$.next(!0),this.courseService.updateTestResult(this.test.CourseId,s).subscribe(r=>{this.gradeId=r.body.TestResults[0]?.GradeId,this.updatedTest=r.body,this.closeButtonDisabled$.next(!1)})}buildRuequestBodyForGradeChange(s){return{StudentIds:[this.studentId],TestId:this.test.Id,GradeId:s}}buildRequestBodyPointsChange(s){return{StudentIds:[this.studentId],TestId:this.test.Id,Points:s}}isValid(s){return""!==s&&!isNaN(Number(s))&&!(Number(s)<0||Number(s)>this.maxPoints)}maxPointValidator(){return s=>Number(s.value)>(0,d.sU)(this.test)?{customMax:!0}:null}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU(n.Lw),t.rXU(S.I))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-grades-edit"]],inputs:{test:"test",gradeId:"gradeId",gradeOptions:"gradeOptions",points:"points",studentId:"studentId"},standalone:!0,features:[t.aNF],decls:19,vars:20,consts:[["pointInput",""],[1,"modal-body"],[1,"mb-4"],["class","form-group row",4,"ngIf"],[1,"form-group","row","mt-2"],["for","grade",1,"col-6","col-form-label"],[1,"col-6"],["id","grade",3,"valueChange","options","value","allowEmpty","disabled"],[1,"text-muted","mt-4"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"form-group","row"],["for","points",1,"col-6","col-form-label"],["id","points","type","number","step","0.01","min","0",1,"form-control",3,"input","max","formControl"],["class","invalid-feedback col-6 offset-6","data-testid","validation-error-message",4,"ngIf"],["data-testid","validation-error-message",1,"invalid-feedback","col-6","offset-6"]],template:function(r,p){1&r&&(t.j41(0,"div",1)(1,"p",2),t.EFF(2),t.k0s(),t.DNE(3,y,8,10,"div",3),t.j41(4,"div",4)(5,"label",5),t.EFF(6),t.nI1(7,"translate"),t.k0s(),t.j41(8,"div",6)(9,"bkd-select",7),t.nI1(10,"async"),t.bIt("valueChange",function(W){return W&&p.onGradeChange(W)}),t.k0s()()(),t.j41(11,"p",8),t.EFF(12),t.nI1(13,"translate"),t.k0s()(),t.j41(14,"div",9)(15,"button",10),t.nI1(16,"async"),t.bIt("click",function(){return p.activeModal.close(p.updatedTestResult)}),t.EFF(17),t.nI1(18,"translate"),t.k0s()()),2&r&&(t.R7$(2),t.JRh(p.test.Designation),t.R7$(),t.Y8G("ngIf",p.test.IsPointGrading),t.R7$(3),t.JRh(t.bMT(7,10,"dossier.dialog.grade")),t.R7$(3),t.Y8G("options",p.gradeOptions)("value",p.gradeId)("allowEmpty",!1)("disabled",t.bMT(10,12,p.gradingScaleDisabled$)),t.R7$(3),t.SpI(" ",t.bMT(13,14,p.test.IsPointGrading?"dossier.dialog.hint.points":"dossier.dialog.hint.grade")," "),t.R7$(3),t.Y8G("disabled",t.bMT(16,16,p.closeButtonDisabled$)),t.R7$(2),t.SpI(" ",t.bMT(18,18,"dossier.dialog.close")," "))},dependencies:[e.bT,o.YN,o.me,o.Q0,o.BC,o.VZ,o.zX,o.X1,o.l_,x.w,e.Jj,l.h,l.D9]})}return i})();var $=a(8958),M=a(855);function K(i,O){if(1&i){const s=t.RV6();t.j41(0,"a",11),t.bIt("click",function(){t.eBV(s);const p=t.XpG().bkdLet,B=t.XpG();return t.Njj(B.editGrading(p))}),t.j41(1,"i",12),t.EFF(2,"edit"),t.k0s(),t.j41(3,"span",13),t.EFF(4),t.nI1(5,"async"),t.k0s()()}if(2&i){const s=t.XpG(2);t.R7$(4),t.JRh(t.bMT(5,1,s.grading$))}}function L(i,O){if(1&i&&(t.j41(0,"span",13),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&i){const s=t.XpG(2);t.R7$(),t.JRh(t.bMT(2,1,s.grading$))}}function Y(i,O){if(1&i&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i){const s=t.XpG().bkdLet;t.R7$(),t.SpI(" ",t.bMT(2,1,s.IsPublished?"tests.published":"tests.not-published")," ")}}function N(i,O){if(1&i&&(t.j41(0,"div",2)(1,"div",3),t.EFF(2),t.k0s(),t.j41(3,"div",4),t.EFF(4),t.nI1(5,"date"),t.k0s(),t.j41(6,"div",5),t.DNE(7,K,6,3,"a",6)(8,L,3,3,"ng-template",null,0,t.C5r),t.k0s(),t.j41(10,"div",7),t.EFF(11),t.nI1(12,"bkdTestWeight"),t.k0s(),t.j41(13,"div",8)(14,"span"),t.EFF(15),t.nI1(16,"bkdTestPoints"),t.k0s()(),t.j41(17,"div",9),t.EFF(18),t.k0s(),t.DNE(19,Y,3,3,"div",10),t.k0s()),2&i){const s=O.bkdLet,r=t.sdS(9),p=t.XpG();t.R7$(2),t.SpI(" ",s.Designation," "),t.R7$(2),t.SpI(" ",t.i5U(5,8,s.Date,"dd.MM.yyyy")," "),t.R7$(3),t.Y8G("ngIf",p.isEditable&&s.IsOwner)("ngIfElse",r),t.R7$(4),t.SpI(" ",t.bMT(12,11,s)," "),t.R7$(4),t.JRh(t.ii3(16,13,s,p.studentId,p.isEditable,"dossier.points")),t.R7$(3),t.SpI(" ",s.Owner," "),t.R7$(),t.Y8G("ngIf",p.isEditable)}}let V=(()=>{class i{constructor(s,r){this.gradeService=s,this.modalService=r,this.test$=new I.m(1),this.grading$=this.test$.pipe((0,c.T)(this.getGrading.bind(this)))}ngOnChanges(s){s.test&&this.test$.next(this.test)}editGrading(s){const r=this.modalService.open(U,{backdrop:"static"});r.componentInstance.test=s,r.componentInstance.gradeId=this.getGradeId(s),r.componentInstance.gradeOptions=i.mapToOptions(this.gradingScale),r.componentInstance.studentId=this.studentId,r.componentInstance.points=this.getPoints(s),r.result.then(p=>{p&&this.updateStudentGrade(p,s)},()=>{})}updateStudentGrade(s,r){const p=(0,d.bT)(s,r);this.gradeService.updateTest$.next(p)}getGrading(s){return this.gradingScale?.Grades.find(r=>r.Id===this.getGradeId(s))?.Designation||"\u2013"}getGradeId(s){return(0,d.m_)(this.studentId,s)?.GradeId||null}getPoints(s){return(0,d.m_)(this.studentId,s)?.Points||null}static mapToOptions(s){return s?.Grades.map(r=>({Key:r.Id,Value:r.Designation}))||null}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU($.p),t.rXU(M.y))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-single-test"]],inputs:{test:"test",studentId:"studentId",gradingScale:"gradingScale",isEditable:"isEditable"},standalone:!0,features:[t.OA$,t.aNF],decls:2,vars:3,consts:[["notEditable",""],["class","test-entry",4,"bkdLet"],[1,"test-entry"],["data-testid","test-designation",1,"designation"],["data-testid","test-date",1,"date"],[1,"grade"],["class","btn btn-link","aria-label","edit grade",3,"click",4,"ngIf","ngIfElse"],["data-testid","test-factor",1,"factor"],["data-testid","test-points",1,"points"],["data-testid","test-teacher",1,"teacher"],["class","state","data-testid","test-status",4,"ngIf"],["aria-label","edit grade",1,"btn","btn-link",3,"click"],["data-testid","test-grade-edit-icon",1,"material-icons"],["data-testid","test-grade"],["data-testid","test-status",1,"state"]],template:function(r,p){1&r&&(t.DNE(0,N,20,18,"div",1),t.nI1(1,"async")),2&r&&t.Y8G("bkdLet",t.bMT(1,1,p.test$))},dependencies:[m.N,e.bT,e.Jj,e.vh,l.h,l.D9,R,h],styles:['.test-entry[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1rem;display:grid;grid-template-areas:"designation designation grade factor" "date date points ." "teacher teacher . ." "state state . .";grid-template-columns:repeat(4,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}.designation[_ngcontent-%COMP%]{grid-area:designation}.date[_ngcontent-%COMP%]{grid-area:date}.grade[_ngcontent-%COMP%]{grid-area:grade}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;color:#000;padding:0;text-decoration:none}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.grade[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:-1em;color:#00000080}.points[_ngcontent-%COMP%]{grid-area:points;color:#00000080}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.state[_ngcontent-%COMP%]{grid-area:state}@media (max-width: 575.98px){.test-entry[_ngcontent-%COMP%]{grid-template-areas:"designation designation" "date grade" "factor points" "teacher teacher" "state state";grid-template-columns:repeat(2,1fr)}}']})}return i})();function w(i,O){if(1&i&&t.nrm(0,"bkd-dossier-single-test",5),2&i){const s=O.$implicit,r=t.XpG(3);t.Y8G("test",s)("studentId",r.studentId)("gradingScale",r.getGradingScaleOfTest(s))("isEditable",r.isEditable)}}function k(i,O){if(1&i&&(t.j41(0,"div"),t.nrm(1,"bkd-dossier-grades-final-grade",3),t.DNE(2,w,1,4,"bkd-dossier-single-test",4),t.k0s()),2&i){const s=t.XpG().bkdLet,r=t.XpG();t.R7$(),t.Y8G("finalGrade",r.decoratedCourse.finalGrade)("grading",r.decoratedCourse.grading)("gradingScale",r.decoratedCourse.gradingScale)("average",r.decoratedCourse.average),t.R7$(),t.Y8G("ngForOf",s)}}function H(i,O){1&i&&(t.j41(0,"p",6),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"dossier.no-tests")," "))}function X(i,O){if(1&i&&(t.qex(0),t.DNE(1,k,3,5,"div",2)(2,H,3,3,"ng-template",null,0,t.C5r),t.bVm()),2&i){const s=O.bkdLet,r=t.sdS(3);t.R7$(),t.Y8G("ngIf",s.length>0)("ngIfElse",r)}}let z=(()=>{class i{ngOnChanges(s){s.decoratedCourse&&this.sortedTests$.next(this.sortedTests())}constructor(){this.sortedTests$=new f.t([])}sortedTests(){return this.decoratedCourse.course.Tests?(0,d.my)(this.decoratedCourse.course.Tests):[]}getGradingScaleOfTest(s){return(0,d.Eq)(s,this.gradingScales)}static#t=this.\u0275fac=function(r){return new(r||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-course-tests"]],inputs:{studentId:"studentId",decoratedCourse:"decoratedCourse",gradingScales:"gradingScales",isEditable:"isEditable"},standalone:!0,features:[t.OA$,t.aNF],decls:2,vars:3,consts:[["noTests",""],[4,"bkdLet"],[4,"ngIf","ngIfElse"],[3,"finalGrade","grading","gradingScale","average"],[3,"test","studentId","gradingScale","isEditable",4,"ngFor","ngForOf"],[3,"test","studentId","gradingScale","isEditable"],["data-testid","message-no-tests",1,"p-3"]],template:function(r,p){1&r&&(t.DNE(0,X,4,2,"ng-container",1),t.nI1(1,"async")),2&r&&t.Y8G("bkdLet",t.bMT(1,1,p.sortedTests$))},dependencies:[m.N,e.bT,D,e.pM,V,e.Jj,l.h,l.D9]})}return i})();function J(i,O){if(1&i&&(t.j41(0,"span",2),t.EFF(1),t.k0s()),2&i){const s=t.XpG();t.R7$(),t.SpI(" (",s.grade,")")}}function Q(i,O){if(1&i&&(t.j41(0,"span",3),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&i){const s=t.XpG();t.R7$(),t.SpI(" (",t.i5U(2,1,s.average,"1.1-3"),")")}}let Z=(()=>{class i{constructor(){}get grade(){return this.getGradeForStudent()}getGradeForStudent(){return _(this.grading,this.finalGrade,this.gradingScale)}static#t=this.\u0275fac=function(r){return new(r||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-grades-course-header"]],inputs:{designation:"designation",finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},standalone:!0,features:[t.aNF],decls:3,vars:3,consts:[["class","grade","data-testId","grade",4,"ngIf"],["class","average","data-testId","average",4,"ngIf"],["data-testId","grade",1,"grade"],["data-testId","average",1,"average"]],template:function(r,p){1&r&&(t.EFF(0),t.DNE(1,J,2,1,"span",0)(2,Q,3,4,"span",1)),2&r&&(t.JRh(p.designation),t.R7$(),t.Y8G("ngIf",p.grade),t.R7$(),t.Y8G("ngIf",!p.grade&&p.average))},dependencies:[e.bT,e.QX],styles:[".average[_ngcontent-%COMP%]{color:#00000080}"]})}return i})();var q=a(3919);function tt(i,O){if(1&i&&t.nrm(0,"bkd-dossier-course-tests",11),2&i){const s=t.XpG().$implicit,r=t.XpG(2);t.Y8G("decoratedCourse",s)("studentId",r.studentId)("gradingScales",r.gradingScales)("isEditable",r.isEditable)}}function et(i,O){if(1&i){const s=t.RV6();t.j41(0,"div")(1,"div",4)(2,"div",5,1)(4,"div",6)(5,"bkd-student-dossier-entry-header",7),t.bIt("click",function(){t.eBV(s);const p=t.sdS(3);return t.Njj(p.toggle())}),t.nrm(6,"bkd-dossier-grades-course-header",8),t.k0s()(),t.j41(7,"div",9)(8,"div",10),t.DNE(9,tt,1,4,"ng-template"),t.k0s()()()()()}if(2&i){const s=O.$implicit,r=t.sdS(3);t.R7$(5),t.Y8G("opened",!r.collapsed),t.R7$(),t.Y8G("designation",s.course.Designation)("finalGrade",s.finalGrade)("grading",s.grading)("gradingScale",s.gradingScale)("average",s.average)}}function st(i,O){if(1&i&&(t.qex(0),t.DNE(1,et,10,6,"div",3),t.nI1(2,"async"),t.bVm()),2&i){const s=t.XpG();t.R7$(),t.Y8G("ngForOf",t.bMT(2,2,s.decoratedCoursesSubject$))("ngForTrackBy",s.trackByCourseId)}}function nt(i,O){1&i&&(t.j41(0,"p",12),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"dossier.no-courses")," "))}let at=(()=>{class i{constructor(s){this.dossierGradeService=s,this.isEditable=!0,this.decoratedCoursesSubject$=new f.t([])}ngOnChanges(){this.decoratedCoursesSubject$.next(this.decorateCourses())}trackByCourseId(s,r){return r.course.Id}decorateCourses(){return this.courses?.map(s=>{const r=this.dossierGradeService.getFinalGradeForStudent(s,this.studentId),p=this.dossierGradeService.getGradesForStudent(s,this.studentId,this.gradingScales);return{course:s,finalGrade:r,grading:this.dossierGradeService.getGradingForStudent(s,this.studentId),gradingScale:this.dossierGradeService.getGradingScaleOfCourse(s,this.gradingScales),average:r?.AverageTestResult||(0,g.L)(p)}})}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU($.p))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-grades-view"]],inputs:{courses:"courses",studentId:"studentId",gradingScales:"gradingScales",isEditable:"isEditable"},standalone:!0,features:[t.OA$,t.aNF],decls:3,vars:2,consts:[["noCourses",""],["courses","ngbAccordionItem"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf","ngForTrackBy"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],[3,"designation","finalGrade","grading","gradingScale","average"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[3,"decoratedCourse","studentId","gradingScales","isEditable"],["data-testid","message-no-courses",1,"py-3"]],template:function(r,p){if(1&r&&t.DNE(0,st,3,4,"ng-container",2)(1,nt,3,3,"ng-template",null,0,t.C5r),2&r){let B;const W=t.sdS(2);t.Y8G("ngIf",(null!==(B=null==p.courses?null:p.courses.length)&&void 0!==B?B:0)>0)("ngIfElse",W)}},dependencies:[e.bT,e.pM,n.r6,n.tW,n.x7,q.$,Z,n.$R,n.UA,z,e.Jj,l.h,l.D9]})}return i})()},4456:(b,v,a)=>{a.d(v,{uz:()=>E,ae:()=>R,NL:()=>c,MA:()=>u});var e=a(5783),n=a(5306),l=a(9573),f=a(838);const g=e.NW({Id:e.Yj,TestId:e.ai,CourseRegistrationId:e.ai,GradeId:(0,n.c$)(e.ai),GradeValue:(0,n.c$)(e.ai),GradeDesignation:(0,n.c$)(e.Yj),Points:(0,n.c$)(e.ai),StudentId:e.ai}),d=e.NW({Id:e.ai,CourseId:e.ai,Date:n.iC,Designation:e.Yj,Weight:e.ai,WeightPercent:e.ai,IsPointGrading:e.zM,MaxPoints:(0,n.c$)(e.ai),MaxPointsAdjusted:(0,n.c$)(e.ai),IsPublished:e.zM,IsOwner:e.zM,Owner:(0,n.c$)(e.Yj),GradingScaleId:(0,n.c$)(e.ai),Results:(0,n.c$)(e.YO(g))}),m=e.NW({Id:e.ai}),_=e.OH({HRef:(0,n.c$)(e.Yj)}),T=e.OH({HasEvaluationStarted:e.zM,EvaluationUntil:(0,n.c$)(n.iC),HasReviewOfEvaluationStarted:e.zM,HasTestGrading:e.zM,Id:e.ai}),C=e.E$([m,_,T]),t=e.OH({Id:e.ai,StudentCount:e.ai}),D=e.E$([m,_,t]),I=e.NW({Grade:e.Yj,AverageTestResult:e.ai,Id:e.ai,StudentId:e.ai}),c=e.NW({AverageTestResult:e.ai,CanGrade:e.zM,EventId:e.ai,GradeId:(0,n.c$)(e.ai),GradeValue:(0,n.c$)(e.ai),Id:e.ai,StudentId:e.ai}),R=e.NW({HRef:e.Yj,Id:e.ai,Number:e.Yj,Designation:e.Yj,DateFrom:(0,n.c$)(n.iC),DateTo:(0,n.c$)(n.iC),StatusId:e.ai,GradingScaleId:(0,n.c$)(e.ai),FinalGrades:(0,n.c$)(e.YO(I)),Gradings:(0,n.c$)(e.YO(c)),Tests:(0,n.c$)(e.YO(d)),EvaluationStatusRef:C,AttendanceRef:D,ParticipatingStudents:(0,n.c$)(e.YO(l.o)),Classes:(0,n.c$)(e.YO(f.i))}),u=(e.NW({StudentIds:e.YO(e.ai),TestId:e.ai,Points:(0,n.c$)(e.ai)}),e.NW({StudentIds:e.YO(e.ai),TestId:e.ai,GradeId:(0,n.c$)(e.ai)}),e.NW({TestResults:e.YO(g),Gradings:e.YO(c)})),E=e.NW({Gradings:e.YO(c)})},5666:(b,v,a)=>{a.d(v,{H:()=>n});var e=a(5783);const n=e.NW({Key:e.KC([e.ai,e.Yj]),Value:e.Yj})},838:(b,v,a)=>{a.d(v,{i:()=>n});var e=a(5783);const n=e.NW({Id:e.ai,Designation:e.Yj,StudentCount:e.ai,Number:e.Yj})},1015:(b,v,a)=>{a.d(v,{n:()=>g,t:()=>f});var e=a(5783),n=a(5306),l=a(5666);const f=e.NW({Id:e.Yj,SubscriptionId:e.ai,VssId:e.ai,EventId:e.ai,DropdownItems:(0,n.c$)(e.YO(l.H)),IdPerson:e.ai,ShowAsRadioButtons:e.zM,Value:(0,n.c$)(e.Yj)}),g=e.NW({Id:e.ai,CurrentWorkProgressId:(0,n.c$)(e.Yj||(0,n.c$)(e.ai)),EventId:(0,n.c$)(e.ai),PersonId:(0,n.c$)(e.ai),Status:e.Yj,StatusId:(0,n.c$)(e.ai),IsOkay:(0,n.c$)(e.zM),IsQueued:(0,n.c$)(e.zM),EventDesignation:(0,n.c$)(e.Yj),EventInformation:(0,n.c$)(e.Yj||e.ai),EventNotes:(0,n.c$)(e.Yj||e.ai),CheckPersonalInformation:(0,n.c$)(e.zM),CorrespondencePersonId:(0,n.c$)(e.ai),CorrespondenceAddressTypeId:(0,n.c$)(e.Yj||e.ai),Billing1PersonId:(0,n.c$)(e.ai),Billing1AddressTypeId:(0,n.c$)(e.Yj||e.ai),Billing2PersonId:(0,n.c$)(e.Yj||e.ai),Billing2AddressTypeId:(0,n.c$)(e.Yj||e.ai),KindOfPaymentId1:(0,n.c$)(e.Yj||e.ai),KindOfPaymentEmail1:(0,n.c$)(e.Yj||e.ai),KindOfPaymentId2:(0,n.c$)(e.Yj||e.ai),KindOfPaymentEmail2:(0,n.c$)(e.Yj||e.ai),IdObject:(0,n.c$)(e.ai),IdSubscription:(0,n.c$)(e.ai),IdStatus:(0,n.c$)(e.ai),AnsweredQuestions:(0,n.c$)(e.Yj||e.ai),Messages:(0,n.c$)(e.Yj||e.ai),SubscriptionDetails:(0,n.c$)(e.YO(f)),HRef:(0,n.c$)(e.Yj)})},9082:(b,v,a)=>{a.d(v,{jr:()=>f,rv:()=>g,yk:()=>d});var e=a(177),n=a(4438);const l="1-3",f="\u2013";let g=(()=>{class _{constructor(C){this.locale=C}transform(C,t,D){const I=Number(C??null);return isNaN(I)?f:d(Number(C??null),D??this.locale,t)}static#t=this.\u0275fac=function(t){return new(t||_)(n.rXU(n.xe9,16))};static#e=this.\u0275pipe=n.EJ8({name:"decimalOrDash",type:_,pure:!0,standalone:!0})}return _})();function d(_,T,C){return 0===_?f:(0,e.ZV)(_,T,`1.${function m(_){return _?String(_).includes("-")?String(_):`${_}-${_}`:l}(C)}`)}},855:(b,v,a)=>{a.d(v,{y:()=>l});var e=a(4438),n=a(1324);let l=(()=>{class f{constructor(d){this.modal=d}open(...d){const m=this.modal.open(...d);return this.applyPortalOffsetAndMaxHeight(m),this.disablePortalScrolling(m),m}get activeInstances(){return this.modal.activeInstances}dismissAll(...d){return this.modal.dismissAll(...d)}hasOpenModals(...d){return this.modal.hasOpenModals(...d)}applyPortalOffsetAndMaxHeight(d){const m=this.getModalWindowElement(d);m?this.portalWindow&&(m.style.top=`${this.getModalIframeOffset()}px`,m.style.maxHeight=`${this.getModalHeight()}px`):console.warn("Trying to apply portal offset to <ngb-modal-window>, but element is not present!")}disablePortalScrolling(d){this.portalDocument&&(this.portalDocument.style.overflow="hidden"),d.hidden.subscribe(()=>{this.portalDocument&&(this.portalDocument.style.overflow="auto")})}getModalWindowElement(d){return d._windowCmptRef?.instance?._elRef?.nativeElement??null}getModalIframeOffset(){return Math.max(this.getViewportTop()-this.getIframeTop(),0)}getIframeTop(){return this.portalQuerySelector("bkd-content")?.shadowRoot?.querySelector("iframe")?.offsetTop??0}getIFrameBottom(){const d=this.portalQuerySelector("bkd-content")?.shadowRoot?.querySelector("iframe");return d?d.offsetTop+d.offsetHeight:0}getModalTop(){return Math.max(this.getViewportTop(),this.getIframeTop())}getModalBottom(){return Math.min(this.getViewportBottom(),this.getIFrameBottom())}getModalHeight(){return this.getModalBottom()-this.getModalTop()}getViewportTop(){return this.portalWindow?.scrollY??0}getViewportBottom(){return this.getViewportTop()+this.getViewportHeight()}getViewportHeight(){return this.portalWindow?.innerHeight??0}portalQuerySelector(d){return this.portalWindow?.document?.querySelector("bkd-portal")?.shadowRoot?.querySelector(d)??null}get portalDocument(){return this.portalWindow?.document.documentElement??null}get portalWindow(){return window.parent===window?null:window.parent}static#t=this.\u0275fac=function(m){return new(m||f)(e.KVO(n.Bq))};static#e=this.\u0275prov=e.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()},5449:(b,v,a)=>{a.d(v,{I:()=>I});var e=a(5783),n=a(5558),l=a(6354),f=a(7673),g=a(2809),d=a(4456),m=a(785),_=a(4297),T=a(5437),C=a(6952),t=a(4438),D=a(1626);let I=(()=>{class c extends C.G{constructor(h,o){super(h,o,d.ae,"Courses"),this.statusCodec=e.NW((0,T.U)(this.codec.props,["Id","StatusId","EvaluationStatusRef"]))}getNumberOfCoursesForRating(){return this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef&fields=Id,StatusId,EvaluationStatusRef&filter.StatusId=;10300;10240`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe((0,n.n)((0,m.k$)(this.statusCodec)),(0,l.T)(h=>h.filter(o=>!0===o.EvaluationStatusRef.HasEvaluationStarted)),(0,l.T)(h=>h.length))}getExpandedCourses(h){return(0,_.h)(h,"TeacherRole")?this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef,AttendanceRef,Classes,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe((0,n.n)((0,m.k$)(d.ae))):(0,f.of)([])}getExpandedCourse(h){return this.http.get(`${this.baseUrl}/${h}?expand=ParticipatingStudents,EvaluationStatusRef,Tests,Gradings,FinalGrades,Classes`).pipe((0,n.n)((0,m.D4)(d.ae)))}getExpandedCoursesForDossier(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades,EvaluationStatusRef,ParticipatingStudents,Classes&filter.StatusId=;${this.settings.eventlist.statusfilter}`).pipe((0,n.n)((0,m.k$)(d.ae)))}getExpandedCoursesForStudent(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"StudentRole"}}).pipe((0,n.n)((0,m.k$)(d.ae)))}add(h,o,u,E,F,j,x){return this.http.put(`${this.baseUrl}/${h}/Tests/New`,{Tests:[{Date:o,Designation:u,Weight:E,IsPointGrading:F,MaxPoints:j,MaxPointsAdjusted:x}]}).pipe((0,l.T)(()=>{}))}update(h,o,u,E,F,j,x,S){return this.http.put(`${this.baseUrl}/${h}/Tests/Update`,{Tests:[{Id:o,Designation:u,Date:E,Weight:F,IsPointGrading:j,MaxPoints:x,MaxPointsAdjusted:S}]}).pipe((0,l.T)(()=>{}))}delete(h,o){return this.http.put(`${this.baseUrl}/${h}/Tests/Delete`,{TestIds:[o]}).pipe((0,l.T)(()=>o))}updateTestResult(h,o){return this.http.put(`${this.baseUrl}/${h}/SetTestResult`,o).pipe((0,n.n)((0,m.D4)(d.MA)),(0,n.n)(u=>(0,f.of)({courseId:h,body:u})))}setAverageAsFinalGrade(h){return this.http.put(`${this.baseUrl}/SetAverageTestResult`,h).pipe((0,n.n)((0,m.D4)(d.uz)))}publishTest(h){return this.http.put(`${this.baseUrl}/PublishTest`,{TestIds:[h]}).pipe((0,l.T)(()=>h))}unpublishTest(h){return this.http.put(`${this.baseUrl}/UnpublishTest`,{TestIds:[h]}).pipe((0,l.T)(()=>h))}static#t=this.\u0275fac=function(o){return new(o||c)(t.KVO(D.Qq),t.KVO(g.yy))};static#e=this.\u0275prov=t.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})()},8958:(b,v,a)=>{a.d(v,{p:()=>F});var e=a(2771),n=a(1413),l=a(3294),f=a(5558),g=a(6354),d=a(4668),m=a(7786),_=a(4572),T=a(7468),C=a(3993),t=a(2809),D=a(7113),I=a(9728),c=a(4438),R=a(5449),h=a(1937),o=a(5507),u=a(2673),E=a(1763);let F=(()=>{class j{constructor(S,P,G,y,A,U){this.coursesRestService=S,this.subscriptionRestService=P,this.reportsService=G,this.loadingService=y,this.gradingScalesRestService=A,this.settings=U,this.studentId$=new e.m(1),this.updateTest$=new n.B,this.initialStudentCourses$=this.studentId$.pipe((0,l.F)(),(0,f.n)(this.loadCourses.bind(this)),(0,g.T)($=>$.sort((M,K)=>M.Designation.localeCompare(K.Designation))),(0,d.t)(1)),this.updatedStudentCourses$=this.updateTest$.pipe((0,C.E)(this.initialStudentCourses$),(0,g.T)(([$,M])=>this.updateCourses(M,$))),this.studentCourses$=(0,m.h)(this.initialStudentCourses$,this.updatedStudentCourses$).pipe((0,d.t)(1)),this.loading$=this.loadingService.loading$,this.studentCourseIds$=this.studentCourses$.pipe((0,g.T)($=>$.flatMap(M=>M.Id))),this.idSubscriptions$=(0,_.z)([this.studentId$,this.studentCourseIds$]).pipe((0,f.n)(([$,M])=>this.subscriptionRestService.getIdSubscriptionsByStudentAndCourse($,M))),this.ids$=this.idSubscriptions$.pipe((0,g.T)($=>$.map(M=>M.Id))),this.testReports$=this.ids$.pipe((0,g.T)($=>this.reportsService.getTeacherSubscriptionReports($))),this.tests$=this.studentCourses$.pipe((0,g.T)($=>$.flatMap(M=>M.Tests).filter(I.TM))),this.gradingScaleIdsFromTests$=this.tests$.pipe((0,g.T)($=>[...$.map(M=>M.GradingScaleId)].filter(I.TM).filter(I.Am))),this.gradingScaleIdsFromCourses$=this.studentCourses$.pipe((0,g.T)($=>$.flatMap(M=>M.GradingScaleId).filter(I.TM).filter(I.Am))),this.gradingScaleIds$=(0,_.z)([this.gradingScaleIdsFromCourses$,this.gradingScaleIdsFromTests$]).pipe((0,g.T)(([$,M])=>$.concat(M).filter(I.Am))),this.gradingScales$=this.gradingScaleIds$.pipe((0,f.n)($=>(0,T.p)($.map(M=>this.gradingScalesRestService.getGradingScale(M)))))}setStudentId(S){this.studentId$.next(S)}getFinalGradeForStudent(S,P){return S?.FinalGrades?.find(G=>G.StudentId===P)}getGradingForStudent(S,P){return S?.Gradings?.find(G=>G.StudentId===P)}getGradingScaleOfCourse(S,P){return P?.find(G=>G.Id===S.GradingScaleId)}getGradesForStudent(S,P,G){return S.Tests?.flatMap(y=>({value:Number((0,D.Eq)(y,G)?.Grades.find(U=>U.Id===(0,D.m_)(P,y)?.GradeId)?.Designation),weight:y.Weight})).filter(({value:y})=>!!y)||[]}loadCourses(S){return this.loadingService.load(this.coursesRestService.getExpandedCoursesForDossier().pipe((0,g.T)(P=>P.filter(G=>G.ParticipatingStudents?.find(y=>y.Id===S)))))}updateCourses(S,P){return S.map(G=>({...G,Tests:null!==G.Tests?G.Tests.map(y=>y.Id===P.Id?P:y):null}))}static#t=this.\u0275fac=function(P){return new(P||j)(c.KVO(R.I),c.KVO(h.u),c.KVO(o.P),c.KVO(u.U),c.KVO(E.T),c.KVO(t.yy))};static#e=this.\u0275prov=c.jDH({token:j,factory:j.\u0275fac})}return j})()},1763:(b,v,a)=>{a.d(v,{T:()=>I});var e=a(7673),n=a(5558),l=a(7468),f=a(4668),g=a(2809),d=a(5783);const m=d.NW({Id:d.ai,Designation:d.Yj}),_=d.NW({Id:d.ai,Grades:d.YO(m)});var T=a(785),C=a(6952),t=a(4438),D=a(1626);let I=(()=>{class c extends C.G{constructor(h,o){super(h,o,_,"GradingScales")}getGradingScale(h){return null===h?(0,e.of)(null):this.http.get(`${this.baseUrl}/${h}`).pipe((0,n.n)((0,T.D4)(_)))}loadGradingScales(h){return h.pipe((0,n.n)(o=>(0,l.p)(o.map(u=>this.getGradingScale(u)))),(0,f.t)(1))}static#t=this.\u0275fac=function(o){return new(o||c)(t.KVO(D.Qq),t.KVO(g.yy))};static#e=this.\u0275prov=t.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})()},1937:(b,v,a)=>{a.d(v,{u:()=>_});var e=a(5558),n=a(2809),l=a(1015),f=a(785),g=a(6952),d=a(4438),m=a(1626);let _=(()=>{class T extends g.G{constructor(t,D){super(t,D,l.t,"Subscriptions")}getIdSubscriptionsByStudentAndCourse(t,D){return this.http.get(`${this.settings.apiUrl}/Subscriptions/?filter.PersonId==${t}&filter.EventId=;${D}`).pipe((0,e.n)((0,f.k$)(l.n)))}static#t=this.\u0275fac=function(D){return new(D||T)(d.KVO(m.Qq),d.KVO(n.yy))};static#e=this.\u0275prov=d.jDH({token:T,factory:T.\u0275fac,providedIn:"root"})}return T})()},9736:(b,v,a)=>{function e(g){return 0===g.length?0:l(g.map(({value:d,weight:m})=>d*m))/l(g.map(({weight:d})=>d))}function n(g){return 0===g.length?0:Number(l(g)/g.length)}function l(g){return g.reduce(f,0)}function f(g,d){return g+d}a.d(v,{G:()=>n,L:()=>e})},4297:(b,v,a)=>{function e(l,f){return n(l).includes(f)}function n(l){return l?l.split(";"):[]}a.d(v,{O:()=>n,h:()=>e})},152:(b,v,a)=>{a.d(v,{B:()=>f});var e=a(3236),n=a(9974),l=a(4360);function f(g,d=e.E){return(0,n.N)((m,_)=>{let T=null,C=null,t=null;const D=()=>{if(T){T.unsubscribe(),T=null;const c=C;C=null,_.next(c)}};function I(){const c=t+g,R=d.now();if(R<c)return T=this.schedule(void 0,c-R),void _.add(T);D()}m.subscribe((0,l._)(_,c=>{C=c,t=d.now(),T||(T=d.schedule(I,g),_.add(T))},()=>{D(),_.complete()},void 0,()=>{C=T=null}))})}}}]);