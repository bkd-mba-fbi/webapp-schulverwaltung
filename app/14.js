"use strict";(self.webpackChunkwebapp_schulverwaltung=self.webpackChunkwebapp_schulverwaltung||[]).push([[14],{7113:(y,v,a)=>{a.d(v,{C7:()=>n,Eq:()=>C,TG:()=>h,bT:()=>D,m_:()=>m,my:()=>t,p6:()=>c,sU:()=>d,tj:()=>l,xk:()=>T,zs:()=>_});var e=a(9736);function n(o,u){return u.map(E=>E.Id===o.TestId?D(o,E):E)}function l(o,u,E){return E.map(G=>G.Id===o?function I(o,u){return{...u,Results:u.Results?.filter(E=>E.Id!==o)||[]}}(u,G):G)}function c(o,u){return u.map(E=>E.Id===o?{...E,IsPublished:!E.IsPublished}:E)}function _(o){const u=function R(o){return o.Results?.map(u=>null!==u.Points?u.Points:p).filter(u=>u>p)||[]}(o);if(0===u.length)throw new Error("unable to calculate averages without results");return(0,e.G)(u)}function d(o){return o.MaxPointsAdjusted||o.MaxPoints}function h(o){const u=function f(o){return o.Results?.filter(u=>null!==u.GradeDesignation).map(u=>Number(u.GradeDesignation)).filter(u=>!isNaN(u))||[]}(o);if(0===u.length)throw new Error("unable to calculate averages without results");return(0,e.G)(u)}function m(o,u){return u.Results?.find(E=>E.StudentId===o)}function T(o,u){return null===u?null:u.filter(E=>E.Id!==o)}function D(o,u){const E=u.Results?.filter(G=>o.Id!==G.Id)||[];return{...u,Results:[...E,o]}}function t(o){return o.slice().sort((u,E)=>E.Date.getTime()-u.Date.getTime())}function C(o,u){return u?.find(E=>E.Id===o.GradingScaleId)||null}const p=-1},2619:(y,v,a)=>{a.d(v,{w:()=>D});var e=a(177),n=a(4438),l=a(9417),c=a(3955),_=a(4412),d=a(4572),h=a(6354);function m(t,C){if(1&t&&(n.j41(0,"option",3),n.EFF(1),n.nI1(2,"translate"),n.k0s()),2&t){const I=n.XpG();n.Y8G("ngValue",null),n.R7$(),n.SpI(" ",n.bMT(2,2,I.emptyLabel)," ")}}function T(t,C){if(1&t&&(n.j41(0,"option",3),n.EFF(1),n.k0s()),2&t){const I=C.$implicit;n.Y8G("ngValue",I),n.R7$(),n.SpI(" ",I.Value," ")}}let D=(()=>{class t{constructor(){this.options=[],this.allowEmpty=!0,this.emptyLabel="",this.value=null,this.disabled=!1,this.tabindex=0,this.valueChange=new n.bkB,this.options$=new _.t([]),this.rawValue$=new _.t(null),this.value$=(0,d.z)([this.rawValue$,this.options$]).pipe((0,h.T)(([I,f])=>f&&f.find(R=>R.Key===I)||null))}ngOnChanges(I){I.value&&this.rawValue$.next(I.value.currentValue),I.options&&this.options$.next(I.options.currentValue)}static#t=this.\u0275fac=function(f){return new(f||t)};static#e=this.\u0275cmp=n.VBU({type:t,selectors:[["bkd-select"]],inputs:{options:"options",allowEmpty:"allowEmpty",emptyLabel:"emptyLabel",value:"value",disabled:"disabled",tabindex:"tabindex"},outputs:{valueChange:"valueChange"},standalone:!0,features:[n.OA$,n.aNF],decls:5,vars:7,consts:[[1,"form-select",3,"ngModelChange","tabindex","disabled","ngModel"],[3,"ngValue",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"]],template:function(f,R){1&f&&(n.j41(0,"select",0),n.nI1(1,"async"),n.bIt("ngModelChange",function(o){return R.valueChange.emit(o&&o.Key)}),n.DNE(2,m,3,4,"option",1)(3,T,2,2,"option",2),n.EFF(4," >\n"),n.k0s()),2&f&&(n.FS9("tabindex",R.tabindex),n.Y8G("disabled",R.disabled)("ngModel",n.bMT(1,5,R.value$)),n.R7$(2),n.Y8G("ngIf",R.allowEmpty),n.R7$(),n.Y8G("ngForOf",R.options))},dependencies:[l.YN,l.xH,l.y7,l.wz,l.BC,l.vS,e.bT,e.pM,e.Jj,c.h,c.D9]})}return t})()},7014:(y,v,a)=>{a.d(v,{Q:()=>at});var e=a(177),n=a(1324),l=a(3955),c=a(4412),_=a(9736),d=a(7113),h=a(7887);function m(i,O,s){return O?O.Grade:function T(i,O){return O?.Grades.find(s=>s.Id===i?.GradeId)?.Designation}(i,s)||i?.GradeValue}var D=a(9082),t=a(4438);let C=(()=>{class i{constructor(){}getGradeForStudent(){return m(this.grading,this.finalGrade,this.gradingScale)}static#t=this.\u0275fac=function(r){return new(r||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-grades-final-grade"]],inputs:{finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},standalone:!0,features:[t.aNF],decls:14,vars:11,consts:[[1,"final-entry"],["data-testid","final-grade"],["data-testid","average-test-results"]],template:function(r,g){1&r&&(t.j41(0,"div",0)(1,"div"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",1)(5,"span"),t.EFF(6),t.k0s()(),t.j41(7,"div"),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.j41(10,"div",2)(11,"span"),t.EFF(12),t.nI1(13,"decimalOrDash"),t.k0s()()()),2&r&&(t.R7$(2),t.JRh(t.bMT(3,4,"dossier.grade")),t.R7$(4),t.JRh(g.getGradeForStudent()||"\u2013"),t.R7$(2),t.JRh(t.bMT(9,6,"dossier.average")),t.R7$(4),t.JRh(t.i5U(13,8,g.average,"1-3")))},dependencies:[l.h,l.D9,D.rv],styles:[".final-entry[_ngcontent-%COMP%]{padding:1rem;display:grid;grid-template-columns:repeat(2,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}"]})}return i})();var I=a(2771),f=a(6354);let R=(()=>{class i{constructor(s){this.translate=s}transform(s,r,g,j="tests.points"){return s.IsPointGrading&&(s.IsPublished||g)?`${(0,d.m_)(r,s)?.Points||"\u2013"} / ${s.MaxPointsAdjusted||s.MaxPoints} ${this.translate.instant(j)}`:""}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU(l.c$,16))};static#e=this.\u0275pipe=t.EJ8({name:"bkdTestPoints",type:i,pure:!0,standalone:!0})}return i})(),p=(()=>{class i{constructor(s){this.translate=s}transform(s){return`${this.translate.instant("tests.factor")} ${s.Weight} (${s.WeightPercent}%)`}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU(l.c$,16))};static#e=this.\u0275pipe=t.EJ8({name:"bkdTestWeight",type:i,pure:!0,standalone:!0})}return i})();var o=a(9417),u=a(1413),E=a(152),G=a(5964),B=a(6977),S=a(2619),$=a(5449);const b=i=>({maxPoints:i});function F(i,O){if(1&i&&(t.j41(0,"div",15),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i){const s=t.XpG(2);t.R7$(),t.SpI(" ",t.i5U(2,1,"global.validation-errors.invalidPoints",t.eq3(4,b,s.maxPoints))," ")}}function A(i,O){if(1&i){const s=t.RV6();t.j41(0,"div",11)(1,"label",12),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",6)(5,"input",13,0),t.bIt("input",function(){t.eBV(s);const g=t.sdS(6),j=t.XpG();return t.Njj(j.onPointsChange(g.value))}),t.k0s()(),t.DNE(7,F,3,6,"div",14),t.k0s()}if(2&i){const s=t.XpG();t.R7$(2),t.JRh(t.bMT(3,8,"dossier.dialog.points")),t.R7$(2),t.AVh("is-invalid",s.pointsInput.errors),t.R7$(),t.AVh("is-invalid",s.pointsInput.errors),t.FS9("max",s.maxPoints),t.Y8G("formControl",s.pointsInput),t.R7$(2),t.Y8G("ngIf",s.pointsInput.errors)}}let M=(()=>{class i{constructor(s,r){this.activeModal=s,this.courseService=r,this.maxPoints=0,this.gradeSubject$=new u.B,this.pointsSubject$=new u.B,this.closeButtonDisabled$=new c.t(!1),this.gradingScaleDisabled$=new c.t(!0),this.grade$=this.gradeSubject$.pipe((0,E.B)(500)),this.points$=this.pointsSubject$.pipe((0,E.B)(500),(0,G.p)(this.isValid.bind(this)),(0,f.T)(Number)),this.destroy$=new u.B}ngOnInit(){this.maxPoints=(0,d.sU)(this.test),this.pointsInput=new o.hs({value:this.points,disabled:!1},[o.k0.min(0),o.k0.pattern("[0-9]+([\\.][0-9]+)?"),this.maxPointValidator()]),this.gradingScaleDisabled$.next(this.test.IsPointGrading&&this.points>0),this.grade$.pipe((0,B.Q)(this.destroy$),(0,f.T)(this.buildRuequestBodyForGradeChange.bind(this))).subscribe(s=>this.updateTestResult(s)),this.points$.pipe((0,B.Q)(this.destroy$),(0,f.T)(this.buildRequestBodyPointsChange.bind(this))).subscribe(s=>this.updateTestResult(s))}onGradeChange(s){this.gradeSubject$.next(s)}onPointsChange(s){this.pointsSubject$.next(s),this.gradingScaleDisabled$.next(s.length>0)}get updatedTestResult(){return this.updatedTest?.TestResults[0]}updateTestResult(s){this.closeButtonDisabled$.next(!0),this.courseService.updateTestResult(this.test.CourseId,s).subscribe(r=>{this.gradeId=r.body.TestResults[0]?.GradeId,this.updatedTest=r.body,this.closeButtonDisabled$.next(!1)})}buildRuequestBodyForGradeChange(s){return{StudentIds:[this.studentId],TestId:this.test.Id,GradeId:s}}buildRequestBodyPointsChange(s){return{StudentIds:[this.studentId],TestId:this.test.Id,Points:s}}isValid(s){return""!==s&&!isNaN(Number(s))&&!(Number(s)<0||Number(s)>this.maxPoints)}maxPointValidator(){return s=>Number(s.value)>(0,d.sU)(this.test)?{customMax:!0}:null}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU(n.Lw),t.rXU($.I))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-grades-edit"]],inputs:{test:"test",gradeId:"gradeId",gradeOptions:"gradeOptions",points:"points",studentId:"studentId"},standalone:!0,features:[t.aNF],decls:19,vars:20,consts:[["pointInput",""],[1,"modal-body"],[1,"mb-4"],["class","form-group row",4,"ngIf"],[1,"form-group","row","mt-2"],["for","grade",1,"col-6","col-form-label"],[1,"col-6"],["id","grade",3,"valueChange","options","value","allowEmpty","disabled"],[1,"text-muted","mt-4"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"form-group","row"],["for","points",1,"col-6","col-form-label"],["id","points","type","number","step","0.01","min","0",1,"form-control",3,"input","max","formControl"],["class","invalid-feedback col-6 offset-6","data-testid","validation-error-message",4,"ngIf"],["data-testid","validation-error-message",1,"invalid-feedback","col-6","offset-6"]],template:function(r,g){1&r&&(t.j41(0,"div",1)(1,"p",2),t.EFF(2),t.k0s(),t.DNE(3,A,8,10,"div",3),t.j41(4,"div",4)(5,"label",5),t.EFF(6),t.nI1(7,"translate"),t.k0s(),t.j41(8,"div",6)(9,"bkd-select",7),t.nI1(10,"async"),t.bIt("valueChange",function(U){return U&&g.onGradeChange(U)}),t.k0s()()(),t.j41(11,"p",8),t.EFF(12),t.nI1(13,"translate"),t.k0s()(),t.j41(14,"div",9)(15,"button",10),t.nI1(16,"async"),t.bIt("click",function(){return g.activeModal.close(g.updatedTestResult)}),t.EFF(17),t.nI1(18,"translate"),t.k0s()()),2&r&&(t.R7$(2),t.JRh(g.test.Designation),t.R7$(),t.Y8G("ngIf",g.test.IsPointGrading),t.R7$(3),t.JRh(t.bMT(7,10,"dossier.dialog.grade")),t.R7$(3),t.Y8G("options",g.gradeOptions)("value",g.gradeId)("allowEmpty",!1)("disabled",t.bMT(10,12,g.gradingScaleDisabled$)),t.R7$(3),t.SpI(" ",t.bMT(13,14,g.test.IsPointGrading?"dossier.dialog.hint.points":"dossier.dialog.hint.grade")," "),t.R7$(3),t.Y8G("disabled",t.bMT(16,16,g.closeButtonDisabled$)),t.R7$(2),t.SpI(" ",t.bMT(18,18,"dossier.dialog.close")," "))},dependencies:[e.bT,o.YN,o.me,o.Q0,o.BC,o.VZ,o.zX,o.X1,o.l_,S.w,e.Jj,l.h,l.D9]})}return i})();var P=a(8958),W=a(855);function K(i,O){if(1&i){const s=t.RV6();t.j41(0,"a",11),t.bIt("click",function(){t.eBV(s);const g=t.XpG().bkdLet,j=t.XpG();return t.Njj(j.editGrading(g))}),t.j41(1,"i",12),t.EFF(2,"edit"),t.k0s(),t.j41(3,"span",13),t.EFF(4),t.nI1(5,"async"),t.k0s()()}if(2&i){const s=t.XpG(2);t.R7$(4),t.JRh(t.bMT(5,1,s.grading$))}}function L(i,O){if(1&i&&(t.j41(0,"span",13),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&i){const s=t.XpG(2);t.R7$(),t.JRh(t.bMT(2,1,s.grading$))}}function Y(i,O){if(1&i&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i){const s=t.XpG().bkdLet;t.R7$(),t.SpI(" ",t.bMT(2,1,s.IsPublished?"tests.published":"tests.not-published")," ")}}function N(i,O){if(1&i&&(t.j41(0,"div",2)(1,"div",3),t.EFF(2),t.k0s(),t.j41(3,"div",4),t.EFF(4),t.nI1(5,"date"),t.k0s(),t.j41(6,"div",5),t.DNE(7,K,6,3,"a",6)(8,L,3,3,"ng-template",null,0,t.C5r),t.k0s(),t.j41(10,"div",7),t.EFF(11),t.nI1(12,"bkdTestWeight"),t.k0s(),t.j41(13,"div",8)(14,"span"),t.EFF(15),t.nI1(16,"bkdTestPoints"),t.k0s()(),t.j41(17,"div",9),t.EFF(18),t.k0s(),t.DNE(19,Y,3,3,"div",10),t.k0s()),2&i){const s=O.bkdLet,r=t.sdS(9),g=t.XpG();t.R7$(2),t.SpI(" ",s.Designation," "),t.R7$(2),t.SpI(" ",t.i5U(5,8,s.Date,"dd.MM.yyyy")," "),t.R7$(3),t.Y8G("ngIf",g.isEditable&&s.IsOwner)("ngIfElse",r),t.R7$(4),t.SpI(" ",t.bMT(12,11,s)," "),t.R7$(4),t.JRh(t.ii3(16,13,s,g.studentId,g.isEditable,"dossier.points")),t.R7$(3),t.SpI(" ",s.Owner," "),t.R7$(),t.Y8G("ngIf",g.isEditable)}}let V=(()=>{class i{constructor(s,r){this.gradeService=s,this.modalService=r,this.test$=new I.m(1),this.grading$=this.test$.pipe((0,f.T)(this.getGrading.bind(this)))}ngOnChanges(s){s.test&&this.test$.next(this.test)}editGrading(s){const r=this.modalService.open(M,{backdrop:"static"});r.componentInstance.test=s,r.componentInstance.gradeId=this.getGradeId(s),r.componentInstance.gradeOptions=i.mapToOptions(this.gradingScale),r.componentInstance.studentId=this.studentId,r.componentInstance.points=this.getPoints(s),r.result.then(g=>{g&&this.updateStudentGrade(g,s)},()=>{})}updateStudentGrade(s,r){const g=(0,d.bT)(s,r);this.gradeService.updateStudentCourses(g)}getGrading(s){return this.gradingScale?.Grades.find(r=>r.Id===this.getGradeId(s))?.Designation||"\u2013"}getGradeId(s){return(0,d.m_)(this.studentId,s)?.GradeId||null}getPoints(s){return(0,d.m_)(this.studentId,s)?.Points||null}static mapToOptions(s){return s?.Grades.map(r=>({Key:r.Id,Value:r.Designation}))||null}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU(P.p),t.rXU(W.y))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-single-test"]],inputs:{test:"test",studentId:"studentId",gradingScale:"gradingScale",isEditable:"isEditable"},standalone:!0,features:[t.OA$,t.aNF],decls:2,vars:3,consts:[["notEditable",""],["class","test-entry",4,"bkdLet"],[1,"test-entry"],["data-testid","test-designation",1,"designation"],["data-testid","test-date",1,"date"],[1,"grade"],["class","btn btn-link","aria-label","edit grade",3,"click",4,"ngIf","ngIfElse"],["data-testid","test-factor",1,"factor"],["data-testid","test-points",1,"points"],["data-testid","test-teacher",1,"teacher"],["class","state","data-testid","test-status",4,"ngIf"],["aria-label","edit grade",1,"btn","btn-link",3,"click"],["data-testid","test-grade-edit-icon",1,"material-icons"],["data-testid","test-grade"],["data-testid","test-status",1,"state"]],template:function(r,g){1&r&&(t.DNE(0,N,20,18,"div",1),t.nI1(1,"async")),2&r&&t.Y8G("bkdLet",t.bMT(1,1,g.test$))},dependencies:[h.N,e.bT,e.Jj,e.vh,l.h,l.D9,R,p],styles:['.test-entry[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;padding:1rem;display:grid;grid-template-areas:"designation designation grade factor" "date date points ." "teacher teacher . ." "state state . .";grid-template-columns:repeat(4,1fr)}span[_ngcontent-%COMP%]{margin-left:2em}.designation[_ngcontent-%COMP%]{grid-area:designation}.date[_ngcontent-%COMP%]{grid-area:date}.grade[_ngcontent-%COMP%]{grid-area:grade}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;color:#000;padding:0;text-decoration:none}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.grade[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.grade[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:-1em;color:#00000080}.points[_ngcontent-%COMP%]{grid-area:points;color:#00000080}.teacher[_ngcontent-%COMP%]{grid-area:teacher}.state[_ngcontent-%COMP%]{grid-area:state}@media (max-width: 575.98px){.test-entry[_ngcontent-%COMP%]{grid-template-areas:"designation designation" "date grade" "factor points" "teacher teacher" "state state";grid-template-columns:repeat(2,1fr)}}']})}return i})();function w(i,O){if(1&i&&t.nrm(0,"bkd-dossier-single-test",5),2&i){const s=O.$implicit,r=t.XpG(3);t.Y8G("test",s)("studentId",r.studentId)("gradingScale",r.getGradingScaleOfTest(s))("isEditable",r.isEditable)}}function k(i,O){if(1&i&&(t.j41(0,"div"),t.nrm(1,"bkd-dossier-grades-final-grade",3),t.DNE(2,w,1,4,"bkd-dossier-single-test",4),t.k0s()),2&i){const s=t.XpG().bkdLet,r=t.XpG();t.R7$(),t.Y8G("finalGrade",r.decoratedCourse.finalGrade)("grading",r.decoratedCourse.grading)("gradingScale",r.decoratedCourse.gradingScale)("average",r.decoratedCourse.average),t.R7$(),t.Y8G("ngForOf",s)}}function H(i,O){1&i&&(t.j41(0,"p",6),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"dossier.no-tests")," "))}function X(i,O){if(1&i&&(t.qex(0),t.DNE(1,k,3,5,"div",2)(2,H,3,3,"ng-template",null,0,t.C5r),t.bVm()),2&i){const s=O.bkdLet,r=t.sdS(3);t.R7$(),t.Y8G("ngIf",s.length>0)("ngIfElse",r)}}let z=(()=>{class i{ngOnChanges(s){s.decoratedCourse&&this.sortedTests$.next(this.sortedTests())}constructor(){this.sortedTests$=new c.t([])}sortedTests(){return this.decoratedCourse.course.Tests?(0,d.my)(this.decoratedCourse.course.Tests):[]}getGradingScaleOfTest(s){return(0,d.Eq)(s,this.gradingScales)}static#t=this.\u0275fac=function(r){return new(r||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-course-tests"]],inputs:{studentId:"studentId",decoratedCourse:"decoratedCourse",gradingScales:"gradingScales",isEditable:"isEditable"},standalone:!0,features:[t.OA$,t.aNF],decls:2,vars:3,consts:[["noTests",""],[4,"bkdLet"],[4,"ngIf","ngIfElse"],[3,"finalGrade","grading","gradingScale","average"],[3,"test","studentId","gradingScale","isEditable",4,"ngFor","ngForOf"],[3,"test","studentId","gradingScale","isEditable"],["data-testid","message-no-tests",1,"p-3"]],template:function(r,g){1&r&&(t.DNE(0,X,4,2,"ng-container",1),t.nI1(1,"async")),2&r&&t.Y8G("bkdLet",t.bMT(1,1,g.sortedTests$))},dependencies:[h.N,e.bT,C,e.pM,V,e.Jj,l.h,l.D9]})}return i})();function J(i,O){if(1&i&&(t.j41(0,"span",2),t.EFF(1),t.k0s()),2&i){const s=t.XpG();t.R7$(),t.SpI(" (",s.grade,")")}}function Q(i,O){if(1&i&&(t.j41(0,"span",3),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&i){const s=t.XpG();t.R7$(),t.SpI(" (",t.i5U(2,1,s.average,"1.1-3"),")")}}let Z=(()=>{class i{constructor(){}get grade(){return this.getGradeForStudent()}getGradeForStudent(){return m(this.grading,this.finalGrade,this.gradingScale)}static#t=this.\u0275fac=function(r){return new(r||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-grades-course-header"]],inputs:{designation:"designation",finalGrade:"finalGrade",grading:"grading",gradingScale:"gradingScale",average:"average"},standalone:!0,features:[t.aNF],decls:3,vars:3,consts:[["class","grade","data-testId","grade",4,"ngIf"],["class","average","data-testId","average",4,"ngIf"],["data-testId","grade",1,"grade"],["data-testId","average",1,"average"]],template:function(r,g){1&r&&(t.EFF(0),t.DNE(1,J,2,1,"span",0)(2,Q,3,4,"span",1)),2&r&&(t.JRh(g.designation),t.R7$(),t.Y8G("ngIf",g.grade),t.R7$(),t.Y8G("ngIf",!g.grade&&g.average))},dependencies:[e.bT,e.QX],styles:[".average[_ngcontent-%COMP%]{color:#00000080}"]})}return i})();var q=a(3919);function tt(i,O){if(1&i&&t.nrm(0,"bkd-dossier-course-tests",11),2&i){const s=t.XpG().$implicit,r=t.XpG(2);t.Y8G("decoratedCourse",s)("studentId",r.studentId)("gradingScales",r.gradingScales)("isEditable",r.isEditable)}}function et(i,O){if(1&i){const s=t.RV6();t.j41(0,"div")(1,"div",4)(2,"div",5,1)(4,"div",6)(5,"bkd-student-dossier-entry-header",7),t.bIt("click",function(){t.eBV(s);const g=t.sdS(3);return t.Njj(g.toggle())}),t.nrm(6,"bkd-dossier-grades-course-header",8),t.k0s()(),t.j41(7,"div",9)(8,"div",10),t.DNE(9,tt,1,4,"ng-template"),t.k0s()()()()()}if(2&i){const s=O.$implicit,r=t.sdS(3);t.R7$(5),t.Y8G("opened",!r.collapsed),t.R7$(),t.Y8G("designation",s.course.Designation)("finalGrade",s.finalGrade)("grading",s.grading)("gradingScale",s.gradingScale)("average",s.average)}}function st(i,O){if(1&i&&(t.qex(0),t.DNE(1,et,10,6,"div",3),t.nI1(2,"async"),t.bVm()),2&i){const s=t.XpG();t.R7$(),t.Y8G("ngForOf",t.bMT(2,2,s.decoratedCoursesSubject$))("ngForTrackBy",s.trackByCourseId)}}function nt(i,O){1&i&&(t.j41(0,"p",12),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"dossier.no-courses")," "))}let at=(()=>{class i{constructor(s){this.dossierGradeService=s,this.isEditable=!0,this.decoratedCoursesSubject$=new c.t([])}ngOnChanges(){this.decoratedCoursesSubject$.next(this.decorateCourses())}trackByCourseId(s,r){return r.course.Id}decorateCourses(){return this.courses?.map(s=>{const r=this.dossierGradeService.getFinalGradeForStudent(s,this.studentId),g=this.dossierGradeService.getGradesForStudent(s,this.studentId,this.gradingScales);return{course:s,finalGrade:r,grading:this.dossierGradeService.getGradingForStudent(s,this.studentId),gradingScale:this.dossierGradeService.getGradingScaleOfCourse(s,this.gradingScales),average:r?.AverageTestResult||(0,_.L)(g)}})}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU(P.p))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["bkd-dossier-grades-view"]],inputs:{courses:"courses",studentId:"studentId",gradingScales:"gradingScales",isEditable:"isEditable"},standalone:!0,features:[t.OA$,t.aNF],decls:3,vars:2,consts:[["noCourses",""],["courses","ngbAccordionItem"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf","ngForTrackBy"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],[3,"designation","finalGrade","grading","gradingScale","average"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[3,"decoratedCourse","studentId","gradingScales","isEditable"],["data-testid","message-no-courses",1,"py-3"]],template:function(r,g){if(1&r&&t.DNE(0,st,3,4,"ng-container",2)(1,nt,3,3,"ng-template",null,0,t.C5r),2&r){let j;const U=t.sdS(2);t.Y8G("ngIf",(null!==(j=null==g.courses?null:g.courses.length)&&void 0!==j?j:0)>0)("ngIfElse",U)}},dependencies:[e.bT,e.pM,n.r6,n.tW,n.x7,q.$,Z,n.$R,n.UA,z,e.Jj,l.h,l.D9]})}return i})()},4456:(y,v,a)=>{a.d(v,{uz:()=>E,ae:()=>R,NL:()=>f,MA:()=>u});var e=a(5783),n=a(5306),l=a(9573),c=a(838);const _=e.NW({Id:e.Yj,TestId:e.ai,CourseRegistrationId:e.ai,GradeId:(0,n.c$)(e.ai),GradeValue:(0,n.c$)(e.ai),GradeDesignation:(0,n.c$)(e.Yj),Points:(0,n.c$)(e.ai),StudentId:e.ai}),d=e.NW({Id:e.ai,CourseId:e.ai,Date:n.iC,Designation:e.Yj,Weight:e.ai,WeightPercent:e.ai,IsPointGrading:e.zM,MaxPoints:(0,n.c$)(e.ai),MaxPointsAdjusted:(0,n.c$)(e.ai),IsPublished:e.zM,IsOwner:e.zM,Owner:(0,n.c$)(e.Yj),GradingScaleId:(0,n.c$)(e.ai),Results:(0,n.c$)(e.YO(_))}),h=e.NW({Id:e.ai}),m=e.OH({HRef:(0,n.c$)(e.Yj)}),T=e.OH({HasEvaluationStarted:e.zM,EvaluationUntil:(0,n.c$)(n.iC),HasReviewOfEvaluationStarted:e.zM,HasTestGrading:e.zM,Id:e.ai}),D=e.E$([h,m,T]),t=e.OH({Id:e.ai,StudentCount:e.ai}),C=e.E$([h,m,t]),I=e.NW({Grade:e.Yj,AverageTestResult:e.ai,Id:e.ai,StudentId:e.ai}),f=e.NW({AverageTestResult:e.ai,CanGrade:e.zM,EventId:e.ai,GradeId:(0,n.c$)(e.ai),GradeValue:(0,n.c$)(e.ai),Id:e.ai,StudentId:e.ai}),R=e.NW({HRef:e.Yj,Id:e.ai,Number:e.Yj,Designation:e.Yj,DateFrom:(0,n.c$)(n.iC),DateTo:(0,n.c$)(n.iC),StatusId:e.ai,GradingScaleId:(0,n.c$)(e.ai),FinalGrades:(0,n.c$)(e.YO(I)),Gradings:(0,n.c$)(e.YO(f)),Tests:(0,n.c$)(e.YO(d)),EvaluationStatusRef:D,AttendanceRef:C,ParticipatingStudents:(0,n.c$)(e.YO(l.o)),Classes:(0,n.c$)(e.YO(c.i))}),u=(e.NW({StudentIds:e.YO(e.ai),TestId:e.ai,Points:(0,n.c$)(e.ai)}),e.NW({StudentIds:e.YO(e.ai),TestId:e.ai,GradeId:(0,n.c$)(e.ai)}),e.NW({TestResults:e.YO(_),Gradings:e.YO(f)})),E=e.NW({Gradings:e.YO(f)})},5666:(y,v,a)=>{a.d(v,{H:()=>n});var e=a(5783);const n=e.NW({Key:e.KC([e.ai,e.Yj]),Value:e.Yj})},838:(y,v,a)=>{a.d(v,{i:()=>n});var e=a(5783);const n=e.NW({Id:e.ai,Designation:e.Yj,StudentCount:e.ai,Number:e.Yj})},1015:(y,v,a)=>{a.d(v,{n:()=>_,t:()=>c});var e=a(5783),n=a(5306),l=a(5666);const c=e.NW({Id:e.Yj,SubscriptionId:e.ai,VssId:e.ai,EventId:e.ai,DropdownItems:(0,n.c$)(e.YO(l.H)),IdPerson:e.ai,ShowAsRadioButtons:e.zM,Value:(0,n.c$)(e.Yj)}),_=e.NW({Id:e.ai,CurrentWorkProgressId:(0,n.c$)(e.Yj||(0,n.c$)(e.ai)),EventId:(0,n.c$)(e.ai),PersonId:(0,n.c$)(e.ai),Status:e.Yj,StatusId:(0,n.c$)(e.ai),IsOkay:(0,n.c$)(e.zM),IsQueued:(0,n.c$)(e.zM),EventDesignation:(0,n.c$)(e.Yj),EventInformation:(0,n.c$)(e.Yj||e.ai),EventNotes:(0,n.c$)(e.Yj||e.ai),CheckPersonalInformation:(0,n.c$)(e.zM),CorrespondencePersonId:(0,n.c$)(e.ai),CorrespondenceAddressTypeId:(0,n.c$)(e.Yj||e.ai),Billing1PersonId:(0,n.c$)(e.ai),Billing1AddressTypeId:(0,n.c$)(e.Yj||e.ai),Billing2PersonId:(0,n.c$)(e.Yj||e.ai),Billing2AddressTypeId:(0,n.c$)(e.Yj||e.ai),KindOfPaymentId1:(0,n.c$)(e.Yj||e.ai),KindOfPaymentEmail1:(0,n.c$)(e.Yj||e.ai),KindOfPaymentId2:(0,n.c$)(e.Yj||e.ai),KindOfPaymentEmail2:(0,n.c$)(e.Yj||e.ai),IdObject:(0,n.c$)(e.ai),IdSubscription:(0,n.c$)(e.ai),IdStatus:(0,n.c$)(e.ai),AnsweredQuestions:(0,n.c$)(e.Yj||e.ai),Messages:(0,n.c$)(e.Yj||e.ai),SubscriptionDetails:(0,n.c$)(e.YO(c)),HRef:(0,n.c$)(e.Yj)})},9082:(y,v,a)=>{a.d(v,{jr:()=>c,rv:()=>_,yk:()=>d});var e=a(177),n=a(4438);const l="1-3",c="\u2013";let _=(()=>{class m{constructor(D){this.locale=D}transform(D,t,C){const I=Number(D??null);return isNaN(I)?c:d(Number(D??null),C??this.locale,t)}static#t=this.\u0275fac=function(t){return new(t||m)(n.rXU(n.xe9,16))};static#e=this.\u0275pipe=n.EJ8({name:"decimalOrDash",type:m,pure:!0,standalone:!0})}return m})();function d(m,T,D){return 0===m?c:(0,e.ZV)(m,T,`1.${function h(m){return m?String(m).includes("-")?String(m):`${m}-${m}`:l}(D)}`)}},855:(y,v,a)=>{a.d(v,{y:()=>l});var e=a(4438),n=a(1324);let l=(()=>{class c{constructor(d){this.modal=d}open(...d){const h=this.modal.open(...d);return this.applyPortalOffsetAndMaxHeight(h),this.disablePortalScrolling(h),h}get activeInstances(){return this.modal.activeInstances}dismissAll(...d){return this.modal.dismissAll(...d)}hasOpenModals(...d){return this.modal.hasOpenModals(...d)}applyPortalOffsetAndMaxHeight(d){const h=this.getModalWindowElement(d);h?this.portalWindow&&(h.style.top=`${this.getModalIframeOffset()}px`,h.style.maxHeight=`${this.getModalHeight()}px`):console.warn("Trying to apply portal offset to <ngb-modal-window>, but element is not present!")}disablePortalScrolling(d){this.portalDocument&&(this.portalDocument.style.overflow="hidden"),d.hidden.subscribe(()=>{this.portalDocument&&(this.portalDocument.style.overflow="auto")})}getModalWindowElement(d){return d._windowCmptRef?.instance?._elRef?.nativeElement??null}getModalIframeOffset(){return Math.max(this.getViewportTop()-this.getIframeTop(),0)}getIframeTop(){return this.portalQuerySelector("bkd-content")?.shadowRoot?.querySelector("iframe")?.offsetTop??0}getIFrameBottom(){const d=this.portalQuerySelector("bkd-content")?.shadowRoot?.querySelector("iframe");return d?d.offsetTop+d.offsetHeight:0}getModalTop(){return Math.max(this.getViewportTop(),this.getIframeTop())}getModalBottom(){return Math.min(this.getViewportBottom(),this.getIFrameBottom())}getModalHeight(){return this.getModalBottom()-this.getModalTop()}getViewportTop(){return this.portalWindow?.scrollY??0}getViewportBottom(){return this.getViewportTop()+this.getViewportHeight()}getViewportHeight(){return this.portalWindow?.innerHeight??0}portalQuerySelector(d){return this.portalWindow?.document?.querySelector("bkd-portal")?.shadowRoot?.querySelector(d)??null}get portalDocument(){return this.portalWindow?.document.documentElement??null}get portalWindow(){return window.parent===window?null:window.parent}static#t=this.\u0275fac=function(h){return new(h||c)(e.KVO(n.Bq))};static#e=this.\u0275prov=e.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})()},5449:(y,v,a)=>{a.d(v,{I:()=>I});var e=a(5783),n=a(5558),l=a(6354),c=a(7673),_=a(2809),d=a(4456),h=a(785),m=a(4297),T=a(5437),D=a(6952),t=a(4438),C=a(1626);let I=(()=>{class f extends D.G{constructor(p,o){super(p,o,d.ae,"Courses"),this.statusCodec=e.NW((0,T.U)(this.codec.props,["Id","StatusId","EvaluationStatusRef"]))}getNumberOfCoursesForRating(){return this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef&fields=Id,StatusId,EvaluationStatusRef&filter.StatusId=;10300;10240`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe((0,n.n)((0,h.k$)(this.statusCodec)),(0,l.T)(p=>p.filter(o=>!0===o.EvaluationStatusRef.HasEvaluationStarted)),(0,l.T)(p=>p.length))}getExpandedCourses(p){return(0,m.h)(p,"TeacherRole")?this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef,AttendanceRef,Classes,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe((0,n.n)((0,h.k$)(d.ae))):(0,c.of)([])}getExpandedCourse(p){return this.http.get(`${this.baseUrl}/${p}?expand=ParticipatingStudents,EvaluationStatusRef,Tests,Gradings,FinalGrades,Classes`).pipe((0,n.n)((0,h.D4)(d.ae)))}getExpandedCoursesForDossier(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades,EvaluationStatusRef,ParticipatingStudents,Classes&filter.StatusId=;${this.settings.eventlist.statusfilter}`).pipe((0,n.n)((0,h.k$)(d.ae)))}getExpandedCoursesForStudent(){return this.http.get(`${this.baseUrl}/?expand=Tests,Gradings,FinalGrades&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"StudentRole"}}).pipe((0,n.n)((0,h.k$)(d.ae)))}add(p,o,u,E,G,B,S){return this.http.put(`${this.baseUrl}/${p}/Tests/New`,{Tests:[{Date:o,Designation:u,Weight:E,IsPointGrading:G,MaxPoints:B,MaxPointsAdjusted:S}]}).pipe((0,l.T)(()=>{}))}update(p,o,u,E,G,B,S,$){return this.http.put(`${this.baseUrl}/${p}/Tests/Update`,{Tests:[{Id:o,Designation:u,Date:E,Weight:G,IsPointGrading:B,MaxPoints:S,MaxPointsAdjusted:$}]}).pipe((0,l.T)(()=>{}))}delete(p,o){return this.http.put(`${this.baseUrl}/${p}/Tests/Delete`,{TestIds:[o]}).pipe((0,l.T)(()=>o))}updateTestResult(p,o){return this.http.put(`${this.baseUrl}/${p}/SetTestResult`,o).pipe((0,n.n)((0,h.D4)(d.MA)),(0,n.n)(u=>(0,c.of)({courseId:p,body:u})))}setAverageAsFinalGrade(p){return this.http.put(`${this.baseUrl}/SetAverageTestResult`,p).pipe((0,n.n)((0,h.D4)(d.uz)))}publishTest(p){return this.http.put(`${this.baseUrl}/PublishTest`,{TestIds:[p]}).pipe((0,l.T)(()=>p))}unpublishTest(p){return this.http.put(`${this.baseUrl}/UnpublishTest`,{TestIds:[p]}).pipe((0,l.T)(()=>p))}static#t=this.\u0275fac=function(o){return new(o||f)(t.KVO(C.Qq),t.KVO(_.yy))};static#e=this.\u0275prov=t.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()},8958:(y,v,a)=>{a.d(v,{p:()=>E});var e=a(2771),n=a(3294),l=a(5558),c=a(6354),_=a(4668),d=a(7786),h=a(4572),m=a(7468),T=a(2816),D=a(2809),t=a(7113),C=a(9728),I=a(4438),f=a(5449),R=a(1937),p=a(5507),o=a(2673),u=a(1763);let E=(()=>{class G{constructor(S,$,b,F,A,x){this.coursesRestService=S,this.subscriptionRestService=$,this.reportsService=b,this.loadingService=F,this.gradingScalesRestService=A,this.settings=x,this.studentId$=new e.m(1),this.initialStudentCourses$=this.studentId$.pipe((0,n.F)(),(0,l.n)(this.loadCourses.bind(this)),(0,c.T)(M=>M.sort((P,W)=>P.Designation.localeCompare(W.Designation))),(0,_.t)(1)),this.action$=new e.m(1),this.studentCourses$=(0,d.h)(this.action$,this.initialStudentCourses$.pipe((0,c.T)(M=>({type:"initializeCourses",payload:M})))).pipe((0,T.S)(this.coursesReducer.bind(this),[]),(0,_.t)(1)),this.loading$=this.loadingService.loading$,this.studentCourseIds$=this.studentCourses$.pipe((0,c.T)(M=>M.flatMap(P=>P.Id))),this.idSubscriptions$=(0,h.z)([this.studentId$,this.studentCourseIds$]).pipe((0,l.n)(([M,P])=>this.subscriptionRestService.getIdSubscriptionsByStudentAndCourse(M,P))),this.ids$=this.idSubscriptions$.pipe((0,c.T)(M=>M.map(P=>P.Id))),this.testReports$=this.ids$.pipe((0,c.T)(M=>this.reportsService.getTeacherSubscriptionReports(M))),this.tests$=this.studentCourses$.pipe((0,c.T)(M=>M.flatMap(P=>P.Tests).filter(C.TM))),this.gradingScaleIdsFromTests$=this.tests$.pipe((0,c.T)(M=>[...M.map(P=>P.GradingScaleId)].filter(C.TM).filter(C.Am))),this.gradingScaleIdsFromCourses$=this.studentCourses$.pipe((0,c.T)(M=>M.flatMap(P=>P.GradingScaleId).filter(C.TM).filter(C.Am))),this.gradingScaleIds$=(0,h.z)([this.gradingScaleIdsFromCourses$,this.gradingScaleIdsFromTests$]).pipe((0,c.T)(([M,P])=>M.concat(P).filter(C.Am))),this.gradingScales$=this.gradingScaleIds$.pipe((0,l.n)(M=>(0,m.p)(M.map(P=>this.gradingScalesRestService.getGradingScale(P)))))}setStudentId(S){this.studentId$.next(S)}getFinalGradeForStudent(S,$){return S?.FinalGrades?.find(b=>b.StudentId===$)}getGradingForStudent(S,$){return S?.Gradings?.find(b=>b.StudentId===$)}getGradingScaleOfCourse(S,$){return $?.find(b=>b.Id===S.GradingScaleId)}getGradesForStudent(S,$,b){return S.Tests?.flatMap(F=>({value:Number((0,t.Eq)(F,b)?.Grades.find(x=>x.Id===(0,t.m_)($,F)?.GradeId)?.Designation),weight:F.Weight})).filter(({value:F})=>!!F)||[]}updateStudentCourses(S){this.action$.next({type:"updateCourses",payload:S})}loadCourses(S){return this.loadingService.load(this.coursesRestService.getExpandedCoursesForDossier().pipe((0,c.T)($=>$.filter(b=>b.ParticipatingStudents?.find(F=>F.Id===S)))))}coursesReducer(S,$){switch($.type){case"initializeCourses":return $.payload;case"updateCourses":return this.updateCourses([...S],$.payload);default:return S}}updateCourses(S,$){return S.map(b=>({...b,Tests:null!==b.Tests?b.Tests.map(F=>F.Id===$.Id?$:F):null}))}static#t=this.\u0275fac=function($){return new($||G)(I.KVO(f.I),I.KVO(R.u),I.KVO(p.P),I.KVO(o.U),I.KVO(u.T),I.KVO(D.yy))};static#e=this.\u0275prov=I.jDH({token:G,factory:G.\u0275fac})}return G})()},1763:(y,v,a)=>{a.d(v,{T:()=>I});var e=a(7673),n=a(5558),l=a(7468),c=a(4668),_=a(2809),d=a(5783);const h=d.NW({Id:d.ai,Designation:d.Yj}),m=d.NW({Id:d.ai,Grades:d.YO(h)});var T=a(785),D=a(6952),t=a(4438),C=a(1626);let I=(()=>{class f extends D.G{constructor(p,o){super(p,o,m,"GradingScales")}getGradingScale(p){return null===p?(0,e.of)(null):this.http.get(`${this.baseUrl}/${p}`).pipe((0,n.n)((0,T.D4)(m)))}loadGradingScales(p){return p.pipe((0,n.n)(o=>(0,l.p)(o.map(u=>this.getGradingScale(u)))),(0,c.t)(1))}static#t=this.\u0275fac=function(o){return new(o||f)(t.KVO(C.Qq),t.KVO(_.yy))};static#e=this.\u0275prov=t.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()},1937:(y,v,a)=>{a.d(v,{u:()=>m});var e=a(5558),n=a(2809),l=a(1015),c=a(785),_=a(6952),d=a(4438),h=a(1626);let m=(()=>{class T extends _.G{constructor(t,C){super(t,C,l.t,"Subscriptions")}getIdSubscriptionsByStudentAndCourse(t,C){return this.http.get(`${this.settings.apiUrl}/Subscriptions/?filter.PersonId==${t}&filter.EventId=;${C}`).pipe((0,e.n)((0,c.k$)(l.n)))}static#t=this.\u0275fac=function(C){return new(C||T)(d.KVO(h.Qq),d.KVO(n.yy))};static#e=this.\u0275prov=d.jDH({token:T,factory:T.\u0275fac,providedIn:"root"})}return T})()},9736:(y,v,a)=>{function e(_){return 0===_.length?0:l(_.map(({value:d,weight:h})=>d*h))/l(_.map(({weight:d})=>d))}function n(_){return 0===_.length?0:Number(l(_)/_.length)}function l(_){return _.reduce(c,0)}function c(_,d){return _+d}a.d(v,{G:()=>n,L:()=>e})},4297:(y,v,a)=>{function e(l,c){return n(l).includes(c)}function n(l){return l?l.split(";"):[]}a.d(v,{O:()=>n,h:()=>e})},152:(y,v,a)=>{a.d(v,{B:()=>c});var e=a(3236),n=a(9974),l=a(4360);function c(_,d=e.E){return(0,n.N)((h,m)=>{let T=null,D=null,t=null;const C=()=>{if(T){T.unsubscribe(),T=null;const f=D;D=null,m.next(f)}};function I(){const f=t+_,R=d.now();if(R<f)return T=this.schedule(void 0,f-R),void m.add(T);C()}h.subscribe((0,l._)(m,f=>{D=f,t=d.now(),T||(T=d.schedule(I,_),m.add(T))},()=>{C(),m.complete()},void 0,()=>{D=T=null}))})}}}]);