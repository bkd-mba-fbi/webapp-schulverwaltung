import{b as ae}from"./chunk-VMXYNWQX.js";import{a as Je}from"./chunk-VTECG2ZE.js";import{a as Qe}from"./chunk-7NNVHN3N.js";import{a as Ze}from"./chunk-SWW2IZXB.js";import"./chunk-QNGDMYF2.js";import{p as Ye}from"./chunk-5FFJJJZ5.js";import"./chunk-VMOOBKG2.js";import{e as ie}from"./chunk-VF44T6U3.js";import{b as Ge}from"./chunk-A4TCTMIL.js";import"./chunk-Y4QYVF5K.js";import"./chunk-TCEEBBQP.js";import{d as qe,f as z,g as We}from"./chunk-4QTA7R6W.js";import"./chunk-VNNH2VUZ.js";import{d as Ve}from"./chunk-HLEZ4C3Q.js";import"./chunk-5ZOEDVCI.js";import{L as He,b as Ne,g as me,p as ze,q as Ue}from"./chunk-G2L3C6GE.js";import"./chunk-2FCCHX6W.js";import{b as Ke}from"./chunk-KCOBA4SV.js";import{a as te,b as ne}from"./chunk-GWJDWK72.js";import{w as Fe}from"./chunk-7TIAFCYF.js";import"./chunk-LXT7D3OU.js";import{$a as d,Ab as R,Ac as Ae,Bb as V,Bc as X,Cb as q,Db as Me,Eb as x,Fb as j,Jc as Re,Kb as o,Kc as Oe,Kd as Le,La as p,Lb as r,Ld as we,M as y,Mb as O,O as _e,Ob as $e,Od as Be,P as M,Pa as se,Pc as ee,Qa as _,Ra as ve,Rd as I,Sd as E,Td as je,Va as m,X as F,Ya as ye,Za as Se,_ as T,_a as c,a as G,aa as S,ab as C,b as K,d as ue,da as Ce,db as de,dc as ke,eb as xe,ec as w,ed as B,fc as J,g as be,gb as N,h as fe,hb as f,ia as Y,ib as Te,ja as Z,jb as Pe,jc as pe,ka as ge,l as L,n as b,nc as Q,o as W,qb as ce,rb as l,sb as D,sc as Ie,tb as P,ub as le,vb as De,xa as H,ya as n,za as v,zc as Ee}from"./chunk-TTJNYD2F.js";var _t=["*"];function Ct(e,s){e&1&&de(0)}function gt(e,s){if(e&1&&(c(0,"a",1),p(1,Ct,1,0,"ng-container",3),d()),e&2){let t=f(),i=ce(3);_("routerLink",t.link)("queryParams",t.linkParams),n(),_("ngTemplateOutlet",i)}}function vt(e,s){e&1&&de(0)}function yt(e,s){if(e&1&&(c(0,"a",2),p(1,vt,1,0,"ng-container",3),d()),e&2){let t=f(),i=ce(3);_("href",t.externalLink,H),n(),_("ngTemplateOutlet",i)}}function St(e,s){if(e&1&&(c(0,"span",5),l(1),d()),e&2){let t=f(2);n(),D(t.count)}}function xt(e,s){e&1&&(ge(),c(0,"svg",6),C(1,"path",7),d())}function Tt(e,s){if(e&1&&(c(0,"span",4),l(1),o(2,"translate"),d(),c(3,"div"),Pe(4),p(5,St,2,1,"span",5)(6,xt,2,0,":svg:svg",6),d()),e&2){let t=f();n(),D(r(2,2,t.label)),n(4),m(t.hasCount(t.count)?5:6)}}var Xe=(()=>{class e{constructor(){}hasCount(t){return typeof t=="number"&&t>=0}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-dashboard-action"]],inputs:{label:"label",count:"count",link:"link",linkParams:"linkParams",externalLink:"externalLink"},standalone:!0,features:[x],ngContentSelectors:_t,decls:4,vars:2,consts:[["actionContent",""],[3,"routerLink","queryParams"],[3,"href"],[4,"ngTemplateOutlet"],[1,"label"],[1,"count"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none"],["fill","currentColor","d","m12 20-1.425-1.4 5.6-5.6H4v-2h12.175l-5.6-5.6L12 4l8 8-8 8Z"]],template:function(i,a){i&1&&(Te(),p(0,gt,2,3,"a",1)(1,yt,2,2,"a",2)(2,Tt,7,4,"ng-template",null,0,$e)),i&2&&(m(a.externalLink?-1:0),n(),m(a.externalLink?1:-1))},dependencies:[X,ke,E,I],styles:["a[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:space-between;align-items:center;padding:1rem 1.5rem;background:#f7e9d2;text-decoration:none;line-height:1}a[_ngcontent-%COMP%]:hover{background:#f2e0c3}a[_ngcontent-%COMP%]:focus-visible{outline-width:2px;outline-offset:-2px}div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:1rem}.label[_ngcontent-%COMP%]{font-weight:400}.count[_ngcontent-%COMP%]{font-size:1.5rem}"]})}}return e})();var et=(()=>{class e{constructor(){}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-dashboard-deadline"]],inputs:{count:"count"},standalone:!0,features:[x],decls:3,vars:8,template:function(i,a){i&1&&(l(0),o(1,"translate"),o(2,"addSpace")),i&2&&De("",r(1,3,"dashboard.actions.deadline"),"",O(2,5,": ",":"),"",a.count,`
`)},dependencies:[E,I,We],styles:["[_nghost-%COMP%]{background:#ea161f;color:#fff;white-space:nowrap;font-weight:500;font-size:.875rem;min-height:1.5rem;display:flex;padding:.375rem .5rem;align-items:center;border-radius:2.5rem}"]})}}return e})();var tt=ee({Id:Oe,Holder:Re});var it=(()=>{class e extends te{constructor(t,i){super(t,i,tt,"TeacherSubstitutions")}getTeacherSubstitution(t){return this.getList({params:{"filter.Id":`=${t}`}}).pipe(b(i=>i[0]||null))}static{this.\u0275fac=function(i){return new(i||e)(T(Q),T(B))}}static{this.\u0275prov=F({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var It=["LessonTeacherRole","ClassTeacherRole","TeacherRole","AbsenceAdministratorRole"],Et=["LessonTeacherRole","TeacherRole","StudentRole","SubstituteAdministratorRole"],At=["LessonTeacherRole","StudentRole"],A=(()=>{class e{constructor(t,i,a,h,u,$,U,ft){this.settingsService=t,this.lessonPresencesService=i,this.studentsService=a,this.courseService=h,this.teacherSubstitutionService=u,this.personService=$,this.storageService=U,this.settings=ft,this.rolesAndPermissions$=this.settingsService.getRolesAndPermissions(),this.userId$=new fe(1),this.lessonAbsences$=this.userId$.pipe(M(g=>this.studentsService.getLessonAbsences(g)),y(1)),this.lessonIncidents$=this.userId$.pipe(M(g=>this.studentsService.getLessonIncidents(g)),y(1)),this.loading$=this.rolesAndPermissions$.pipe(b(g=>g==null)),this.hasSearch$=this.rolesAndPermissions$.pipe(b(this.hasRoles(It))),this.hasActions$=this.rolesAndPermissions$.pipe(b(this.hasRoles(Et))),this.hasTimetable$=this.rolesAndPermissions$.pipe(b(this.hasRoles(At))),this.hasLessonTeacherRole$=this.rolesAndPermissions$.pipe(b(this.hasRoles(["LessonTeacherRole"])),y(1)),this.hasTeacherRole$=this.rolesAndPermissions$.pipe(b(this.hasRoles(["TeacherRole"])),y(1)),this.hasStudentRole$=this.rolesAndPermissions$.pipe(b(this.hasRoles(["StudentRole"])),y(1)),this.hasSubstituteAdministratorRole$=this.rolesAndPermissions$.pipe(b(this.hasRoles(["SubstituteAdministratorRole"])),y(1)),this.editAbsencesCount$=this.hasLessonTeacherRole$.pipe(M(g=>g?this.lessonPresencesService.checkableAbsencesCount():L(!1)),y(1)),this.openAbsencesCount$=this.rolesAndPermissions$.pipe(b(this.hasRoles(["LessonTeacherRole","ClassTeacherRole"])),M(g=>g?this.lessonPresencesService.getListOfUnconfirmed():L([])),b(g=>g.length),y(1)),this.myAbsencesCount$=this.hasStudentRole$.pipe(M(g=>g?this.getMyAbsences():L([])),b(this.getMyAbsencesCount.bind(this)),y(1)),this.coursesToRateCount$=this.courseService.getNumberOfCoursesForRating().pipe(_e(0),y(1)),this.hasPresenceControl$=this.hasLessonTeacherRole$.pipe(M(g=>g?this.lessonPresencesService.hasLessonsLessonTeacher():L(!1)),y(1)),this.hasOpenAbsences$=this.openAbsencesCount$.pipe(b(g=>g>0),y(1)),this.editAbsencesParams$=this.getFullName().pipe(b(g=>({confirmationStates:this.settings.checkableAbsenceStateId,teacher:g})),y(1));let he=this.storageService.getPayload()?.id_person;he&&this.userId$.next(Number(he))}hasRoles(t){return i=>(i??[]).some(a=>t.includes(a))}getMyAbsences(){return W([this.userId$,this.lessonAbsences$,this.lessonIncidents$]).pipe(M(([t,i,a])=>this.loadTimetableEntries(t,i,a).pipe(b(h=>[...i,...a].map(u=>this.withTimetableEntry(u,h)).filter(Fe)))))}getMyAbsencesCount(t){return t?.filter(i=>("ConfirmationStateId"in i?i.ConfirmationStateId:null)===this.settings.unconfirmedAbsenceStateId).length||0}getFullName(){let t=Number(this.storageService.getPayload()?.substitution_id)||null;return t?this.teacherSubstitutionService.getTeacherSubstitution(t).pipe(b(i=>i?.Holder)):this.personService.getMyself().pipe(b(i=>i.FullName))}withTimetableEntry(t,i){return i.find(a=>a.Id===t.LessonRef.Id)?t:null}loadTimetableEntries(t,i,a){return this.studentsService.getTimetableEntries(t,{"filter.Id":`;${[...i,...a].map(h=>h.LessonRef.Id).join(";")}`})}static{this.\u0275fac=function(i){return new(i||e)(T(ae),T(ie),T(z),T(Ye),T(it),T(Ge),T(je),T(B))}}static{this.\u0275prov=F({token:e,factory:e.\u0275fac})}}return e})();var Rt=()=>["/presence-control"],Ot=()=>["/edit-absences"],Lt=()=>["/open-absences"],wt=()=>["/events"],Bt=()=>["/my-absences","report"],jt=()=>["/my-absences"];function Ft(e,s){e&1&&C(0,"bkd-dashboard-action",0),e&2&&_("label","dashboard.actions.presence-control")("link",j(2,Rt))}function Nt(e,s){if(e&1&&(C(0,"bkd-dashboard-action",1),o(1,"async"),o(2,"async")),e&2){let t=f();_("label","dashboard.actions.edit-absences")("link",j(8,Ot))("linkParams",r(1,4,t.dashboardService.editAbsencesParams$))("count",r(2,6,t.dashboardService.editAbsencesCount$))}}function zt(e,s){if(e&1&&(C(0,"bkd-dashboard-action",2),o(1,"async")),e&2){let t=f();_("label","dashboard.actions.open-absences")("link",j(5,Lt))("count",r(1,3,t.dashboardService.openAbsencesCount$))}}function Ut(e,s){if(e&1&&(C(0,"bkd-dashboard-deadline",4),o(1,"async")),e&2){let t=f(2);_("count",r(1,1,t.dashboardService.coursesToRateCount$))}}function Ht(e,s){if(e&1&&(c(0,"bkd-dashboard-action",0),p(1,Ut,2,3,"bkd-dashboard-deadline",4),o(2,"async"),d()),e&2){let t,i=f();_("label","dashboard.actions.tests")("link",j(5,wt)),n(),m((t=r(2,3,i.dashboardService.coursesToRateCount$))!==null&&t!==void 0&&t?1:-1)}}function Vt(e,s){e&1&&C(0,"bkd-dashboard-action",0),e&2&&_("label","dashboard.actions.my-absences-report")("link",j(2,Bt))}function qt(e,s){if(e&1&&(C(0,"bkd-dashboard-action",2),o(1,"async")),e&2){let t=f();_("label","dashboard.actions.my-absences")("link",j(5,jt))("count",r(1,3,t.dashboardService.myAbsencesCount$))}}function Gt(e,s){if(e&1&&C(0,"bkd-dashboard-action",3),e&2){let t=f();_("label","dashboard.actions.substitutions")("externalLink",t.substitutionsAdminLink)}}var at=(()=>{class e{constructor(t,i){this.dashboardService=t,this.settings=i}get substitutionsAdminLink(){return this.settings.dashboard.substitutionsAdminLink}static{this.\u0275fac=function(i){return new(i||e)(v(A),v(B))}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-dashboard-actions"]],standalone:!0,features:[x],decls:15,vars:23,consts:[[3,"label","link"],[3,"label","link","linkParams","count"],[3,"label","link","count"],[3,"label","externalLink"],[3,"count"]],template:function(i,a){i&1&&(p(0,Ft,1,3,"bkd-dashboard-action",0),o(1,"async"),p(2,Nt,3,9,"bkd-dashboard-action",1),o(3,"async"),o(4,"async"),p(5,zt,2,6,"bkd-dashboard-action",2),o(6,"async"),p(7,Ht,3,6,"bkd-dashboard-action",0),o(8,"async"),p(9,Vt,1,3,"bkd-dashboard-action",0),o(10,"async"),p(11,qt,2,6,"bkd-dashboard-action",2),o(12,"async"),p(13,Gt,1,2,"bkd-dashboard-action",3),o(14,"async")),i&2&&(m(r(1,7,a.dashboardService.hasPresenceControl$)?0:-1),n(2),m(r(3,9,a.dashboardService.hasLessonTeacherRole$)&&r(4,11,a.dashboardService.editAbsencesParams$)?2:-1),n(3),m(r(6,13,a.dashboardService.hasOpenAbsences$)?5:-1),n(2),m(r(8,15,a.dashboardService.hasTeacherRole$)?7:-1),n(2),m(r(10,17,a.dashboardService.hasStudentRole$)?9:-1),n(2),m(r(12,19,a.dashboardService.hasStudentRole$)?11:-1),n(2),m(r(14,21,a.dashboardService.hasSubstituteAdministratorRole$)?13:-1))},dependencies:[Xe,et,w],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:.5rem}"]})}}return e})();var ot=(()=>{class e{constructor(t,i){this.studentsRestService=t,this.router=i}navigateToDossier(t){return ue(this,null,function*(){let i=Number(t);yield this.router.navigate(["dashboard","student",i,"addresses"])})}static{this.\u0275fac=function(i){return new(i||e)(v(z),v(Ae))}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-dashboard-search"]],standalone:!0,features:[x],decls:1,vars:2,consts:[[3,"valueChange","typeaheadService","placeholder"]],template:function(i,a){i&1&&(c(0,"bkd-typeahead",0),N("valueChange",function(u){return u&&a.navigateToDossier(u)}),d()),i&2&&_("typeaheadService",a.studentsRestService)("placeholder","dashboard.search.placeholder")},dependencies:[Je],styles:["[_nghost-%COMP%]{display:block;padding:.75rem;background:#f7e9d2}"]})}}return e})();var rt=(()=>{class e{constructor(t){this.sanitizer=t}transform(t,i){switch(i){case"html":return this.sanitizer.bypassSecurityTrustHtml(t);case"style":return this.sanitizer.bypassSecurityTrustStyle(t);case"script":return this.sanitizer.bypassSecurityTrustScript(t);case"url":return this.sanitizer.bypassSecurityTrustUrl(t);case"resourceUrl":return this.sanitizer.bypassSecurityTrustResourceUrl(t);default:throw new Error(`Invalid safe type specified: ${i}`)}}static{this.\u0275fac=function(i){return new(i||e)(v(Ie,16))}}static{this.\u0275pipe=Ce({name:"safe",type:e,pure:!0,standalone:!0})}}return e})();function st(e){return{id:lt(e.EventId,e.Id),from:e.From,until:e.To,eventId:e.EventId,subject:e.EventDesignation,room:e.EventLocation||void 0,teacher:e.EventManagerInformation||void 0}}function dt(e){let s=e.reduce((t,i)=>{let a=lt(i.EventRef.Id,i.LessonRef.Id);return K(G({},t),{[a]:[...t[a]??[],i.StudyClassNumber]})},{});return Object.keys(s).reduce((t,i)=>K(G({},t),{[i]:Le([...s[i]].sort())}),{})}function ct(e,s){return e.map(t=>K(G({},t),{studyClass:s[t.id]?.join(", ")}))}function lt(e,s){return`${e}-${s}`}var Kt=(e,s)=>s.id;function Wt(e,s){e&1&&(c(0,"th"),l(1),o(2,"translate"),d()),e&2&&(n(),P(" ",r(2,1,"dashboard.timetable.table.teacher")," "))}function Yt(e,s){if(e&1&&(R(0),c(1,"a",3),l(2),c(3,"span",8),l(4),d()()),e&2){let t=f().$implicit,i=f(2).buildLink(t.eventId);n(),_("routerLink",i.link)("queryParams",i.params),n(),P(" ",t.subject,""),n(2),P(", ",t.studyClass,"")}}function Zt(e,s){if(e&1&&l(0),e&2){let t=f().$implicit;P(" ",t.subject," ")}}function Jt(e,s){if(e&1&&(c(0,"td",4),l(1),o(2,"translate"),d()),e&2){let t=f().$implicit;n(),le(" ",r(2,2,"dashboard.timetable.table.study-class"),": ",t.studyClass," ")}}function Qt(e,s){if(e&1&&(c(0,"td",5),l(1),d()),e&2){let t=f().$implicit;n(),P(" ",t.teacher," ")}}function Xt(e,s){e&1&&(c(0,"span",7),l(1),o(2,"translate"),d()),e&2&&(n(),D(r(2,1,"dashboard.timetable.table.room")))}function ei(e,s){if(e&1&&(c(0,"tr")(1,"td",1),l(2),o(3,"date"),o(4,"date"),d(),c(5,"td",2),p(6,Yt,5,4,"a",3),o(7,"async"),p(8,Zt,1,1),d(),p(9,Jt,3,4,"td",4),o(10,"async"),p(11,Qt,2,1,"td",5),o(12,"async"),c(13,"td",6),p(14,Xt,3,3,"span",7),l(15),d()()),e&2){let t=s.$implicit,i=f(2);n(2),le(" ",O(3,7,t.from,"HH:mm"),"\u2013",O(4,10,t.until,"HH:mm")," "),n(4),m(r(7,13,i.isTeacher$)?6:8),n(3),m(r(10,15,i.isTeacher$)?9:-1),n(2),m(r(12,17,i.isStudent$)?11:-1),n(3),m(t.room?14:-1),n(),P(" ",t.room," ")}}function ti(e,s){if(e&1&&(c(0,"table",0)(1,"thead")(2,"tr")(3,"th"),l(4),o(5,"translate"),d(),c(6,"th"),l(7),o(8,"translate"),d(),p(9,Wt,3,3,"th"),o(10,"async"),c(11,"th"),l(12),o(13,"translate"),d()()(),c(14,"tbody"),ye(15,ei,16,19,"tr",null,Kt),d()()),e&2){let t=f();n(4),D(r(5,4,"dashboard.timetable.table.time")),n(3),D(r(8,6,"dashboard.timetable.table.subject")),n(2),m(r(10,8,t.isStudent$)?9:-1),n(3),P(" ",r(13,10,"dashboard.timetable.table.room")," "),n(3),Se(t.entries)}}function ii(e,s){e&1&&(c(0,"p"),l(1),o(2,"translate"),d()),e&2&&(n(),D(r(2,1,"dashboard.timetable.no-entries")))}var pt=(()=>{class e{constructor(t){this.dashboardService=t,this.entries=[],this.isStudent$=this.dashboardService.hasStudentRole$,this.isTeacher$=this.dashboardService.hasLessonTeacherRole$}buildLink(t){return Ve(Qe(t,"/dashboard"))}static{this.\u0275fac=function(i){return new(i||e)(v(A))}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-dashboard-timetable-table"]],inputs:{entries:"entries"},standalone:!0,features:[x],decls:2,vars:1,consts:[[1,"table"],[1,"time"],[1,"subject"],[3,"routerLink","queryParams"],[1,"study-class"],[1,"teacher"],[1,"room"],[1,"room-label"],[1,"subject-study-class"]],template:function(i,a){i&1&&p(0,ti,17,12,"table",0)(1,ii,3,3,"p"),i&2&&m(a.entries.length>0?0:1)},dependencies:[w,J,E,I,X],styles:['td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{padding:1rem 1.75rem}.room-label[_ngcontent-%COMP%], td.study-class[_ngcontent-%COMP%]{display:none}@media (max-width: 767.98px){table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{display:none}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]{border-top:1px solid var(--bs-border-color)}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-template-areas:"time room" "subject subject" "study-class study-class" "teacher teacher";gap:.5rem;padding:1rem;border-bottom:1px solid var(--bs-border-color)}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:0;padding:0}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.time[_ngcontent-%COMP%]{grid-area:time;font-size:.875rem;line-height:1.125rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.subject[_ngcontent-%COMP%]{grid-area:subject;font-size:1rem;line-height:1.25rem;font-weight:400}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.teacher[_ngcontent-%COMP%]{grid-area:teacher;font-size:.8125rem;line-height:1.0625rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.room[_ngcontent-%COMP%]{grid-area:room;text-align:right;font-size:.875rem;line-height:1.125rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.study-class[_ngcontent-%COMP%]{grid-area:study-class;font-size:.8125rem;line-height:1.0625rem;font-weight:300}td.study-class[_ngcontent-%COMP%]{display:block}.subject-study-class[_ngcontent-%COMP%]{display:none}.room-label[_ngcontent-%COMP%]{display:inline}}']})}}return e})();var ni=ee({}),mt=(()=>{class e extends te{constructor(t,i){super(t,i,ni,"Teachers")}getTimetableEntries(t,i={}){let a=i instanceof pe?i:new pe({fromObject:i});return a=a.set("fields","Id,From,To,EventId,EventNumber,EventDesignation,EventLocation"),this.http.get(`${this.baseUrl}/${t}/TimetableEntries/CurrentSemester`,{params:a}).pipe(M(Be(qe)))}static{this.\u0275fac=function(i){return new(i||e)(T(Q),T(B))}}static{this.\u0275prov=F({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function oi(e,s){e&1&&(c(0,"a",6),o(1,"safe"),l(2),o(3,"translate"),d()),e&2&&(_("href",O(1,2,s,"url"),H),n(2),P(" ",r(3,5,"dashboard.timetable.subscribe-calendar")," "))}function ri(e,s){e&1&&C(0,"bkd-spinner")}function si(e,s){e&1&&(c(0,"a",8),o(1,"safe"),l(2),o(3,"translate"),d()),e&2&&(_("href",O(1,2,s,"url"),H),n(2),P(" ",r(3,5,"dashboard.timetable.subscribe-calendar")," "))}function di(e,s){if(e&1&&(C(0,"bkd-dashboard-timetable-table",7),p(1,si,4,7,"a",8),o(2,"async")),e&2){let t,i=f(),a=q(18);_("entries",a),n(),m((t=r(2,2,i.getSubscribeCalendarUrl()))?1:-1,t)}}var ci="cal",ht=(()=>{class e{constructor(t,i,a,h,u,$){this.teachersService=t,this.studentsService=i,this.lessonPresencesService=a,this.userSettings=h,this.dashboardService=u,this.loadingService=$,this.userId$=this.dashboardService.userId$,this.isTeacher$=this.dashboardService.hasLessonTeacherRole$,this.isStudent$=this.dashboardService.hasStudentRole$,this.date$=new be(me(new Date)),this.loading$=this.loadingService.loading$,this.timetableEntries$=this.loadTimetableEntries()}gotoToday(){this.date$.next(me(new Date))}gotoPreviousDay(){this.date$.next(Ue(this.date$.getValue(),1))}gotoNextDay(){this.date$.next(Ne(this.date$.getValue(),1))}getSubscribeCalendarUrl(){return this.userSettings.getSetting(ci)}loadTimetableEntries(){return W([this.isTeacher$,this.isStudent$,this.userId$,this.date$]).pipe(M(([t,i,a,h])=>{let u=()=>t?this.fetchTimetableEntries("teacher",a,h):i?this.fetchTimetableEntries("student",a,h):L([]);return this.loadingService.load(u())}),y(1))}fetchTimetableEntries(t,i,a){let h={"filter.From":`=${ze(a,"yyyy-MM-dd")}`,sort:"From,To"};return(t==="teacher"?this.teachersService.getTimetableEntries(i,h):this.studentsService.getTimetableEntries(i,h)).pipe(b(u=>u.map(st)),b(u=>we(u,$=>$.id)),M(u=>t==="teacher"?this.loadStudyClasses(a).pipe(b($=>ct(u,$))):L(u)))}loadStudyClasses(t){return this.lessonPresencesService.getLessonStudyClassesByDate(t).pipe(b(dt))}static{this.\u0275fac=function(i){return new(i||e)(v(mt),v(z),v(ie),v(ae),v(A),v(Ke))}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-dashboard-timetable"]],standalone:!0,features:[x],decls:23,vars:24,consts:[[1,"header"],["type","button",1,"btn","btn-primary","today",3,"click"],["type","button",1,"btn","btn-secondary","previous-day",3,"click"],[1,"material-icons"],["type","button",1,"btn","btn-secondary","next-day",3,"click"],[1,"date"],["target","_parent",1,"btn","btn-secondary","subscribe-calendar-header",3,"href"],[3,"entries"],["target","_parent",1,"btn","btn-secondary","subscribe-calendar-bottom",3,"href"]],template:function(i,a){if(i&1){let h=xe();c(0,"div",0)(1,"button",1),N("click",function(){return Y(h),Z(a.gotoToday())}),l(2),o(3,"translate"),d(),c(4,"button",2),o(5,"translate"),N("click",function(){return Y(h),Z(a.gotoPreviousDay())}),c(6,"span",3),l(7,"chevron_left"),d()(),c(8,"button",4),o(9,"translate"),N("click",function(){return Y(h),Z(a.gotoNextDay())}),c(10,"span",3),l(11,"chevron_right"),d()(),c(12,"div",5),l(13),o(14,"async"),o(15,"date"),d(),p(16,oi,4,7,"a",6),o(17,"async"),d(),R(18),o(19,"async"),p(20,ri,1,0,"bkd-spinner"),o(21,"async"),p(22,di,3,4)}if(i&2){let h;n(2),P(" ",r(3,6,"dashboard.timetable.today")," "),n(2),se("aria-label",r(5,8,"dashboard.timetable.previousDay")),n(4),se("aria-label",r(9,10,"dashboard.timetable.nextDay")),n(5),D(O(15,14,r(14,12,a.date$),"E, dd. MMMM yyyy")),n(3),m((h=r(17,17,a.getSubscribeCalendarUrl()))?16:-1,h),n(2),V(r(19,19,a.timetableEntries$)),n(2),m(r(21,22,a.loading$)?20:22)}},dependencies:[pt,ne,w,J,E,I,rt],styles:["[_nghost-%COMP%]{display:block;margin-bottom:1rem}.header[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:2rem;display:flex;align-items:center;gap:1rem}.previous-day[_ngcontent-%COMP%], .next-day[_ngcontent-%COMP%]{padding-left:.375rem;padding-right:.375rem}.date[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600}.subscribe-calendar-header[_ngcontent-%COMP%]{margin-left:auto}.subscribe-calendar-bottom[_ngcontent-%COMP%]{display:none}a.btn[_ngcontent-%COMP%]{text-decoration:none}@media (max-width: 767.98px){.subscribe-calendar-header[_ngcontent-%COMP%]{display:none}.subscribe-calendar-bottom[_ngcontent-%COMP%]{display:block;margin-top:2rem}}@media (max-width: 767.98px) and (max-width: 575.98px){.header[_ngcontent-%COMP%]{flex-wrap:wrap-reverse}.header[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{width:100%}}"]})}}return e})();function li(e,s){e&1&&C(0,"bkd-spinner")}function pi(e,s){e&1&&(c(0,"p"),l(1),o(2,"translate"),d()),e&2&&(n(),P(" ",r(2,1,"dashboard.no-access")," "))}function mi(e,s){e&1&&(c(0,"div")(1,"h2"),l(2),o(3,"translate"),d(),C(4,"bkd-dashboard-search"),d()),e&2&&(n(2),D(r(3,1,"dashboard.search.title")))}function hi(e,s){e&1&&(c(0,"div")(1,"h2"),l(2),o(3,"translate"),d(),C(4,"bkd-dashboard-actions"),d()),e&2&&(n(2),D(r(3,1,"dashboard.actions.title")))}function ui(e,s){if(e&1&&(c(0,"div",1),p(1,mi,5,3,"div")(2,hi,5,3,"div"),d()),e&2){f();let t=q(2),i=q(4);n(),m(t?1:-1),n(),m(i?2:-1)}}function bi(e,s){e&1&&(c(0,"div",2)(1,"h2"),l(2),o(3,"translate"),d(),C(4,"bkd-dashboard-timetable"),d()),e&2&&(n(2),D(r(3,1,"dashboard.timetable.title")))}var ut=(()=>{class e{constructor(t){this.dashboardService=t}static{this.\u0275fac=function(i){return new(i||e)(v(A))}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-dashboard-layout"]],standalone:!0,features:[x],decls:17,vars:19,consts:[[1,"columns"],[1,"search-actions-column"],[1,"timetable-column"]],template:function(i,a){if(i&1&&(R(0),o(1,"async"),R(2),o(3,"async"),R(4),o(5,"async"),R(6),o(7,"async"),c(8,"div")(9,"h1"),l(10),o(11,"translate"),d(),p(12,li,1,0,"bkd-spinner")(13,pi,3,3,"p"),c(14,"div",0),p(15,ui,3,2,"div",1)(16,bi,5,3,"div",2),d()()),i&2){let h=r(1,7,a.dashboardService.loading$);n(2);let u=V(r(3,9,a.dashboardService.hasSearch$));n(2);let $=V(r(5,12,a.dashboardService.hasActions$)),U=r(7,15,a.dashboardService.hasTimetable$);n(5),ve("visually-hidden",h||u||$||U),n(),P(" ",r(11,17,"dashboard.heading")," "),n(2),m(h?12:-1),n(),m(!h&&!u&&!$&&!U?13:-1),n(2),m(u||$?15:-1),n(),m(U?16:-1)}},dependencies:[ne,ot,at,ht,w,E,I],styles:[".columns[_ngcontent-%COMP%]{display:flex;flex-direction:column}.columns[_ngcontent-%COMP%], .search-actions-column[_ngcontent-%COMP%]{gap:3rem}.search-actions-column[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;max-width:40rem}.timetable-column[_ngcontent-%COMP%]{flex:2}@media (min-width: 992px){.columns[_ngcontent-%COMP%]{flex-direction:row;gap:1.5rem}.search-actions-column[_ngcontent-%COMP%]{max-width:33%}}"],changeDetection:0})}}return e})();var bt=(()=>{class e{constructor(){}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=S({type:e,selectors:[["bkd-dashboard"]],standalone:!0,features:[Me([A,He]),x],decls:1,vars:0,template:function(i,a){i&1&&C(0,"router-outlet")},dependencies:[Ee],changeDetection:0})}}return e})();var An=[{path:"",component:bt,children:[{path:"",component:ut},Ze]}];export{An as DASHBOARD_ROUTES};
