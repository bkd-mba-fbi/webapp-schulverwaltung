import{a as oi}from"./chunk-MGID7RWQ.js";import{a as di,b as pi}from"./chunk-RQFEXCIP.js";import{a as mi}from"./chunk-4EXGKTN3.js";import{a as ai}from"./chunk-JV3CBBGP.js";import"./chunk-U4HODSW3.js";import{a as tt,b as zt,c as qt,d as Yt,e as Kt,f as We,g as ze,h as Jt,i as Qt,j as Xt,k as Zt,l as ei,m as Ie,o as ti,p as me,s as ni,u as ri,v as qe}from"./chunk-W7ASLXRM.js";import"./chunk-PSXDSPKS.js";import"./chunk-C7XT5XXE.js";import"./chunk-YMJC6QZX.js";import{a as Nt}from"./chunk-Y4QYVF5K.js";import"./chunk-HII3S2DL.js";import{a as li}from"./chunk-K3EEKOGY.js";import{a as ci}from"./chunk-XLPJMZ3E.js";import"./chunk-24AFRN2G.js";import{a as Wt,d as ii}from"./chunk-RFO4NYUO.js";import"./chunk-5RDJZAUT.js";import"./chunk-DB66EACG.js";import{P as Vt,Y as si,t as jt}from"./chunk-ZK2MNT7Z.js";import{a as Ce,c as At,e as ye}from"./chunk-AW7CSGKI.js";import{a as Ut,b as Ue}from"./chunk-FTDG26ID.js";import{a as Q,b as Ht,c as Se}from"./chunk-SOHFFTKU.js";import{f as Ot,g as Gt,i as $t,j as Ft,p as Ve,u as Ne}from"./chunk-C56YGDXA.js";import{a as He}from"./chunk-UX5TA32W.js";import{$ as C,$a as u,$c as De,A as ot,Ab as l,B as dt,Bb as c,Bd as Dt,C as lt,Cb as G,E as ne,Eb as se,Fd as ie,G as K,Ga as f,Gb as bt,Gd as k,Hd as P,I as Ge,Ia as p,Id as Lt,J as pt,Ja as re,L as J,N as ct,O as D,Q as de,Qb as ae,Rb as ce,Sa as o,Sb as R,Ta as d,Ua as E,Va as W,Vb as j,Vc as _e,W as ge,Wa as z,Wb as $e,Ya as M,Yc as Be,Z as U,_a as _,_c as xe,a as B,ab as ht,ad as yt,b as H,ba as mt,bb as vt,ca as ut,cb as le,dc as Ct,dd as St,e as ee,ed as It,f as L,fd as Le,g as Ze,ga as fe,gd as Tt,ha as I,ia as T,ib as A,id as wt,jb as m,jd as Et,k as Y,ka as gt,kb as x,l as at,lb as h,m as b,mb as et,n as te,nd as Ae,oc as ve,od as je,pc as Fe,pd as kt,qa as ft,qc as Re,qd as Pt,ra as X,rc as oe,rd as be,sb as pe,sd as Mt,ta as ke,tb as y,ua as a,ub as _t,v as Oe,va as v,vb as O,w as Ee,wb as Pe,xb as he,yd as Rt,zb as xt,zd as Bt}from"./chunk-XTHSYQMN.js";var Ji=i=>[i,"tests"];function Qi(i,n){if(i&1&&(o(0,"span"),m(1),l(2,"date"),E(3,"wbr"),m(4),l(5,"date"),d()),i&2){let s=u();a(),h("",G(2,2,s.event.dateFrom,"dd.MM.yyyy"),"\u2013"),a(3),x(G(5,5,s.event.dateTo,"dd.MM.yyyy"))}}function Xi(i,n){if(i&1&&(o(0,"a",10)(1,"i",11),m(2,"arrow_right_alt"),d(),o(3,"span",12),m(4),d()()),i&2){let s=u(2);p("routerLink",O(2,Ji,s.event.id)),a(4),x(s.event.evaluationText)}}function Zi(i,n){if(i&1&&(o(0,"a",13)(1,"i",11),m(2,"arrow_right_alt"),d(),o(3,"span",12),m(4),d()()),i&2){let s=u(2);p("href",s.event.evaluationLink,ke),a(4),h("",s.event.evaluationText," ")}}function en(i,n){if(i&1&&(o(0,"div",7),f(1,Xi,5,4,"a",8)(2,Zi,5,2,"a",9),d()),i&2){let s=u();a(),p("ngIf",!s.event.evaluationLink),a(),p("ngIf",s.event.evaluationLink)}}var ui=(()=>{let n=class n{constructor(){this.withRatings=!0}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=C({type:n,selectors:[["bkd-events-list-entry"]],inputs:{event:"event",withRatings:"withRatings"},standalone:!0,features:[y],decls:11,vars:8,consts:[[1,"designation"],[3,"href"],[1,"date"],[4,"ngIf"],[1,"registrations"],[1,"registrations-label"],["class","rating",4,"ngIf"],[1,"rating"],["class","d-flex",3,"routerLink",4,"ngIf"],["class","d-flex",3,"href",4,"ngIf"],[1,"d-flex",3,"routerLink"],[1,"material-icons"],[1,"ps-1"],[1,"d-flex",3,"href"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"a",1),m(2),d()(),o(3,"div",2),f(4,Qi,6,8,"span",3),d(),o(5,"div",4),m(6),o(7,"span",5),m(8),l(9,"translate"),d()(),f(10,en,3,2,"div",6)),t&2&&(a(),p("href",r.event.detailLink,ke),a(),x(r.event.designation),a(2),p("ngIf",r.event.dateFrom&&r.event.dateTo),a(2),h(" ",r.event.studentCount," "),a(2),x(c(9,6,r.event.studentCount===1?"events.registration":"events.registrations")),a(2),p("ngIf",r.withRatings&&r.event.evaluationText))},dependencies:[R,oe,$e,P,k],styles:['[_nghost-%COMP%]{display:grid;padding:1rem;border-bottom:1px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}.designation[_ngcontent-%COMP%]{grid-area:designation;padding-right:1rem}.date[_ngcontent-%COMP%]{grid-area:date;padding-right:1rem}.registrations[_ngcontent-%COMP%]{grid-area:registrations;padding-right:1rem}.rating[_ngcontent-%COMP%]{grid-area:rating}.rating[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.registrations-label[_ngcontent-%COMP%]{display:none}@media (max-width: 575.98px){.registrations-label[_ngcontent-%COMP%]{display:inline}.designation[_ngcontent-%COMP%], .date[_ngcontent-%COMP%], .registrations[_ngcontent-%COMP%]{padding-right:0}[_nghost-%COMP%]{grid-template-areas:"designation" "date" "registrations" "rating";grid-template-columns:1fr}}']});let i=n;return i})();var tn=10300,nn=10260,rn=10250,sn=14030,an=10350;function Ye(i){let{HasEvaluationStarted:n,EvaluationUntil:s,HasTestGrading:e}=i.EvaluationStatusRef;if(n===!0&&(i.StatusId===sn||i.StatusId===an))return{value:Z.Rating};if(n===!0&&e===!1){if(s)return{value:Z.RatingUntil};if(i.StatusId===tn)return{value:Z.IntermediateRating}}return n===!1&&e===!0&&i.StatusId!==nn&&i.StatusId!==rn?{value:Z.Tests}:n===!0&&e===!0?s?{value:Z.Tests,label:Z.RatingUntil}:{value:Z.Tests,label:Z.IntermediateRating}:null}function gi(i){return i.EvaluationStatusRef.HasEvaluationStarted===!0}function fi(i){return i.EvaluationStatusRef.HasReviewOfEvaluationStarted===!0&&!!i.FinalGrades?.length}function Ke(i){let n=i.Classes?i.Classes.map(s=>s.Number).join(", "):null;return n?i.Designation+", "+n:i.Designation}var Z=function(i){return i.Rating="rating",i.RatingUntil="rating-until",i.IntermediateRating="intermediate-rating",i.Tests="add-tests",i}(Z||{}),Te=(()=>{let n=class n{constructor(e,t,r,g,w,S){this.coursesRestService=e,this.eventsRestService=t,this.studyClassRestService=r,this.loadingService=g,this.translate=w,this.settings=S,this.loading$=this.loadingService.loading$,this.searchFields$=new L(["designation"]),this.searchSubject$=new L(""),this.search$=this.searchSubject$.asObservable(),this.roles$=new L(null),this.isClassTeacher$=this.roles$.pipe(b(F=>Nt(F,"ClassTeacherRole")),J(1)),this.withStudyCourses$=new L(!1),this.unratedCourses$=this.roles$.pipe(D(this.loadUnratedCourses.bind(this)),J(1)),this.studyCourses$=this.withStudyCourses$.pipe(D(this.loadStudyCourses.bind(this)),J(1)),this.formativeAssessments$=this.isClassTeacher$.pipe(D(this.loadFormativeAssessments.bind(this)),J(1)),this.studyClasses$=this.isClassTeacher$.pipe(D(this.loadStudyClasses.bind(this)),J(1)),this.events$=this.getEvents().pipe(J(1)),this.filteredEvents$=te([this.events$,this.searchFields$,this.search$]).pipe(b(ye(di)))}setSearch(e){this.searchSubject$.next(e)}setRoles(e){this.roles$.next(e)}setWithStudyCourses(e){this.withStudyCourses$.next(e)}setSearchFields(e){this.searchFields$.next(e)}getEntries(e=!1){return this.filteredEvents$.pipe(b(t=>e?t.filter(r=>r.evaluationText):t))}getEvents(){return this.loadingService.load(te([this.unratedCourses$,this.studyCourses$,this.formativeAssessments$,this.studyClasses$]),{stopOnFirstValue:!0}).pipe(b(ye(this.createAndSortEvents.bind(this))))}loadUnratedCourses(e){return this.coursesRestService.getExpandedCourses(e).pipe(b(t=>t.filter(r=>!fi(r))))}loadStudyCourses(e){return e?this.eventsRestService.getStudyCourseEvents():Y([])}loadFormativeAssessments(e){return e?this.studyClassRestService.getActiveFormativeAssessments():Y([])}loadStudyClasses(e){return e?this.studyClassRestService.getActive():Y([])}createAndSortEvents(e,t,r,g){let w=g.filter(S=>!r.map(F=>F.Id).includes(S.Id));return[...this.createFromCourses(e),...this.createFromStudyCourses(t),...this.createFromAssessments(r),...this.createFromStudyClasses(w)].sort((S,F)=>S.designation.localeCompare(F.designation))}createFromCourses(e){return e.map(t=>{let r=Ye(t);return{id:t.Id,designation:Ke(t),detailLink:this.buildLink(t.Id,"eventdetail"),studentCount:t.AttendanceRef.StudentCount||0,dateFrom:t.DateFrom,dateTo:t.DateTo,state:r?.value||null,evaluationText:this.getEvaluationText(r,t.EvaluationStatusRef.EvaluationUntil),evaluationLink:this.getEvaluationLink(r?.value,t)}})}createFromStudyCourses(e){return e.map(t=>({id:t.Id,designation:t.Designation,detailLink:this.buildLink(t.Id,"eventdetail"),studentCount:t.StudentCount,state:null}))}createFromAssessments(e){return this.createFromStudyClasses(e).map(r=>H(B({},r),{state:Z.Rating,evaluationText:this.translate.instant("events.state.rating"),evaluationLink:this.buildLink(r.id,"evaluation")}))}createFromStudyClasses(e){return e.map(t=>({id:t.Id,designation:t.Number,detailLink:this.buildLink(t.Id,"eventdetail"),studentCount:t.StudentCount,state:null}))}getEvaluationText(e,t){let r=e?.label||e?.value;return r?this.translate.instant(`events.state.${r}`)+(r===Z.RatingUntil?` ${t?jt(t,"dd.MM.yyyy"):""}`:""):""}getEvaluationLink(e,t){return e&&e!==Z.Tests?this.buildLink(t.Id,"evaluation"):null}buildLink(e,t){return(this.settings.eventlist[t]??"").replace(":id",String(e))}};n.\u0275fac=function(t){return new(t||n)(U(me),U(oi),U(mi),U(Ue),U(ie),U(_e))},n.\u0275prov=ge({token:n,factory:n.\u0275fac,providedIn:"root"});let i=n;return i})();var ln=i=>({events:i});function pn(i,n){i&1&&(o(0,"div",12),m(1),l(2,"translate"),d()),i&2&&(a(),h(" ",c(2,1,"events.rating")," "))}function cn(i,n){if(i&1&&E(0,"bkd-events-list-entry",13),i&2){let s=n.$implicit,e=u(4);p("event",s)("withRatings",e.withRatings)}}function mn(i,n){if(i&1&&(W(0),o(1,"div",6)(2,"div",7),m(3),l(4,"translate"),d(),o(5,"div",8),m(6),l(7,"translate"),d(),o(8,"div",9),m(9),l(10,"translate"),d(),f(11,pn,3,3,"div",10),d(),f(12,cn,1,2,"bkd-events-list-entry",11),z()),i&2){let s=u(2).bkdLet,e=u();a(3),x(c(4,5,"events.designation")),a(3),x(c(7,7,"events.date")),a(3),h(" ",c(10,9,"events.registrations")," "),a(2),p("ngIf",e.withRatings),a(),p("ngForOf",s.events)}}function un(i,n){i&1&&(o(0,"p",14),m(1),l(2,"translate"),d()),i&2&&(a(),x(c(2,1,"events.no-events")))}function gn(i,n){if(i&1&&(W(0),f(1,mn,13,11,"ng-container",5)(2,un,3,3,"ng-template",null,1,se),z()),i&2){let s=A(3),e=u().bkdLet;a(),p("ngIf",(e.events==null?null:e.events.length)>0)("ngIfElse",s)}}function fn(i,n){i&1&&E(0,"bkd-spinner")}function hn(i,n){if(i&1){let s=M();o(0,"div",3)(1,"bkd-resettable-input",4),l(2,"async"),l(3,"translate"),l(4,"translate"),_("valueChange",function(t){I(s);let r=u();return T(r.state.setSearch(t))}),d(),f(5,gn,4,2,"ng-container",5),l(6,"async"),f(7,fn,1,0,"ng-template",null,0,se),d()}if(i&2){let s=n.bkdLet,e=A(8),t=u();a(),p("value",c(2,6,t.state.search$))("placeholder",c(3,8,"events.search-by"))("label",c(4,10,"events.search"))("disabled",!s.events),a(4),p("ngIf",c(6,12,t.state.loading$)===!1)("ngIfElse",e)}}var hi=["designation"],vn=[...hi,"evaluationText"],Je=(()=>{let n=class n{constructor(e,t){this.state=e,this.storage=t,this.withStudyCourses=!1,this.withRatings=!0,this.state.setRoles(this.storage.getPayload()?.roles??null)}ngOnChanges(e){e.withStudyCourses&&this.state.setWithStudyCourses(e.withStudyCourses.currentValue),e.withRatings&&this.state.setSearchFields(e.withRatings.currentValue?vn:hi)}};n.\u0275fac=function(t){return new(t||n)(v(Te),v(Lt))},n.\u0275cmp=C({type:n,selectors:[["bkd-events-list"]],inputs:{withStudyCourses:"withStudyCourses",withRatings:"withRatings"},standalone:!0,features:[fe,y],decls:2,vars:5,consts:[["loading",""],["noEvents",""],["class","bkd-container",4,"bkdLet"],[1,"bkd-container"],[1,"d-flex","search",3,"valueChange","value","placeholder","label","disabled"],[4,"ngIf","ngIfElse"],[1,"event-header"],[1,"designation"],[1,"date"],[1,"registrations"],["class","rating",4,"ngIf"],[3,"event","withRatings",4,"ngFor","ngForOf"],[1,"rating"],[3,"event","withRatings"],[1,"mt-3"]],template:function(t,r){t&1&&(f(0,hn,9,14,"div",2),l(1,"async")),t&2&&p("bkdLet",O(3,ln,c(1,1,r.state.getEntries(r.withRatings))))},dependencies:[Q,pi,R,ce,Se,j,P,k,ui],styles:['.search[_ngcontent-%COMP%]{max-width:500px}.event-header[_ngcontent-%COMP%]{display:grid;padding:1rem;border-bottom:2px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}@media (max-width: 575.98px){.event-header[_ngcontent-%COMP%]{display:none}}']});let i=n;return i})();var vi=(()=>{let n=class n{constructor(){}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=C({type:n,selectors:[["bkd-events-current"]],standalone:!0,features:[y],decls:4,vars:5,consts:[[3,"withStudyCourses","withRatings"]],template:function(t,r){t&1&&(o(0,"h1"),m(1),l(2,"translate"),d(),E(3,"bkd-events-list",0)),t&2&&(a(),x(c(2,3,"events.current.title")),a(2),p("withStudyCourses",!0)("withRatings",!1))},dependencies:[Je,P,k]});let i=n;return i})();var _i=(()=>{let n=class n{constructor(){}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=C({type:n,selectors:[["bkd-events-tests"]],standalone:!0,features:[y],decls:4,vars:4,consts:[[3,"withRatings"]],template:function(t,r){t&1&&(o(0,"h1"),m(1),l(2,"translate"),d(),E(3,"bkd-events-list",0)),t&2&&(a(),x(c(2,2,"events.title")),a(2),p("withRatings",!0))},dependencies:[Je,P,k]});let i=n;return i})();var xi=(()=>{let n=class n{constructor(){}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=C({type:n,selectors:[["bkd-events"]],standalone:!0,features:[pe([Te,Vt]),y],decls:1,vars:0,template:function(t,r){t&1&&E(0,"router-outlet")},dependencies:[Fe]});let i=n;return i})();function bi(i){return n=>{let s=Number(n.value);return s<=i?{greaterThan:{value:s,greaterThanValue:i}}:null}}function nt(i){return i.map(({finalGrade:n})=>n).filter(_n)}function _n(i){return i!==null}function Si(i,n,s,e){return i?.map(t=>({student:t,finalGrade:bn(t,s,e),grades:xn(t,n)}))}function xn(i,n){return n.map(s=>{if(s.Results===void 0||s.Results?.length===0)return{kind:"no-result",test:s};let e=s.Results?.find(t=>t.StudentId===i.Id);return e!==void 0?{kind:"grade",result:e,test:s}:{kind:"no-result",test:s}})}function bn(i,n,s){let e=n.find(r=>r.StudentId===i.Id),t=s.find(r=>r.StudentId===i.Id);return e?{id:e.Id,average:Cn(e),finalGradeId:e.GradeId,freeHandGrade:t?Number(t.Grade):null,canGrade:e.CanGrade}:null}function Cn(i){return i.AverageTestResult===0?null:i.AverageTestResult}var Ii=({key:i,ascending:n})=>(s,e)=>{let t=n?1:-1;switch(i){case"FullName":return t*s.student.FullName.localeCompare(e.student.FullName);case"FinalGrade":return!s.finalGrade?.finalGradeId||!e.finalGrade?.finalGradeId?t*-1:t*Ci(s.finalGrade.finalGradeId,e.finalGrade.finalGradeId);case"TestsMean":return!s.finalGrade?.average||!e.finalGrade?.average?t*-1:t*Ci(s.finalGrade.average,e.finalGrade.average)}return t*yn(i,s,e)},yn=(i,n,s)=>{let e=n.grades.filter(yi).find(r=>r.test.Id===i.Id),t=s.grades.filter(yi).find(r=>r.test.Id===i.Id);return i.IsPointGrading&&e?.result.GradeId===t?.result.GradeId?(e?.result.Points??0)-(t?.result.Points??0):((e?.result.GradeId??Number.POSITIVE_INFINITY)-(t?.result.GradeId??Number.POSITIVE_INFINITY))*-1};function Ci(i,n){return i===n?0:i<n?-1:1}function yi(i){return i.kind==="grade"}function Ti(i){return(i?.test?.MaxPointsAdjusted||i?.test?.MaxPoints)??0}function wi(i){let n=i.map(s=>s.average).filter(s=>s!=null&&s!==0).map(Number);return tt(n)}function Ei(i,n){let s=i.map(t=>t.freeHandGrade).filter(t=>!!t),e=i.map(t=>t.finalGradeId).filter(t=>t!==null).map(t=>n.find(r=>r.Key===t)).filter(t=>t!==void 0).map(t=>t?.Value).filter(t=>t!==void 0).map(Number).filter(t=>!isNaN(t));return tt([...e,...s])}function rt(i,n){return[...n.filter(s=>s.Id!==i?.Id),i].filter(s=>s!=null)}function ki({id:i,selectedGradeId:n},s){return s.map(e=>e.Id!==i?e:H(B({},e),{GradeId:n}))}function Pi(i,n){switch(n.type){case"reset":return n.payload;case"updateResult":return i?H(B({},i),{Tests:qt(n.payload.testResult,i.Tests||[],n.payload.ignore),Gradings:n.payload.grading?rt(n.payload.grading,i.Gradings||[]):i.Gradings}):null;case"deleteResult":return i?H(B({},i),{Tests:Yt(n.payload.testId,n.payload.studentId,i.Tests||[]),Gradings:n.payload.grading?rt(n.payload.grading,i.Gradings||[]):i.Gradings||[]}):null;case"toggle-test-state":return i?H(B({},i),{Tests:Kt(n.payload,i.Tests||[])}):null;case"final-grade-overwritten":return i?H(B({},i),{Gradings:ki({id:n.payload.id,selectedGradeId:n.payload.selectedGradeId},i.Gradings||[])}):null;case"replace-grades":return i?H(B({},i),{Gradings:n.payload}):null;case"delete-test":return i?H(B({},i),{Tests:Jt(n.payload,i.Tests||[])}):null;default:return i}}var Mi=(()=>{let n=class n extends Ht{constructor(e,t){super(e,t,ti,"Gradings")}updateGrade(e,t){return this.http.put(`${this.baseUrl}/${e}`,{GradeId:t}).pipe(b(()=>e))}};n.\u0275fac=function(t){return new(t||n)(U(Ct),U(_e))},n.\u0275prov=ge({token:n,factory:n.\u0275fac,providedIn:"root"});let i=n;return i})();var st={onlyMine:!1,hidePublished:!1},V=(()=>{let n=class n{constructor(e,t,r,g,w){this.coursesRestService=e,this.gradingScalesRestService=t,this.gradingsRestService=r,this.loadingService=g,this.sortService=w,this.action$=new Ze(1),this.loading$=this.loadingService.loading$,this._courseId$=new Ze(1),this.courseId$=this._courseId$.asObservable(),this.fetchedCourse$=this._courseId$.pipe(D(S=>this.loadingService.load(this.coursesRestService.getExpandedCourse(S))),J(1)),this.course$=Oe(this.action$,this.fetchedCourse$.pipe(Ee(Ne),b(S=>({type:"reset",payload:S})))).pipe(pt(Pi,null),Ee(Ne),J(1)),this.tests$=this.course$.pipe(b(S=>S.Tests||[]),b(Qt)),this.hasTests$=this.tests$.pipe(b(S=>S.length>0)),this.filterSubject$=new L(st),this.filter$=this.filterSubject$.asObservable(),this.expandedHeaderSubject$=new L(!1),this.expandedHeader$=this.expandedHeaderSubject$.asObservable(),this.filteredTests$=te([this.tests$,this.filter$]).pipe(b(([S,F])=>S.filter(q=>(!F.onlyMine||q.IsOwner)&&(!F.hidePublished||!q.IsPublished)))),this.sorting$=this.sortService.sorting$,this.studentGrades$=te([this.course$,this.filteredTests$,this.sorting$]).pipe(b(ye(this.toStudentGrades.bind(this)))),this.canSetFinalGrade$=this.course$.pipe(b(gi)),this.gradingScaleIds$=this.course$.pipe(b(S=>Bt([...(S.Tests??[]).map(F=>F.GradingScaleId),S.GradingScaleId]).filter(Ne)),K(Rt),J(1)),this.gradingScales$=this.gradingScaleIds$.pipe(D(S=>this.gradingScalesRestService.getGradingScales(S)),J(1)),this.UNDEFINED_GRADINGSCALE_ID=-1,this.gradingScalesOptions$=this.gradingScales$.pipe(b(S=>S.map(F=>{let q=F?.Id||this.UNDEFINED_GRADINGSCALE_ID,we=F?.Grades.map(Me=>({Key:Me.Id,Value:Me.Designation}))||[];return{id:q,options:we}}).reduce((F,q)=>H(B({},F),{[q.id]:q.options}),{})),J(1)),this.meanOfStudentGradesForCourse$=this.studentGrades$.pipe(b(S=>wi(nt(S)))),this.meanOfFinalGradesForCourse$=te([this.gradingScalesOptions$,this.studentGrades$]).pipe(D(ye(this.meanOfOverwrittenGradesForCourse.bind(this))))}setCourseId(e){this._courseId$.next(e)}setFilter(e){this.filterSubject$.next(e)}gradingOptionsForTest$(e){return this.gradingOptions$(e.GradingScaleId)}gradingOptionsForCourse$(){return this.course$.pipe(D(e=>this.gradingOptions$(e.GradingScaleId)))}toStudentGrades(e,t=[],r){return Si(e.ParticipatingStudents??[],t,e.Gradings??[],e.FinalGrades??[]).sort(Ii(r))}setSorting(e){this.sortService.setSorting(e)}getSortingChar$(e){return this.sortService.getSortingChar$(e)}sortBy(e){this.sortService.toggleSorting(e)}toggleHeader(e){this.expandedHeaderSubject$.next(e)}optimisticallyUpdateGrade(e){return this.course$.pipe(ne(1),b(t=>{let{originalResult:r,updatedResult:g}=this.buildOptimisticResultUpdate(t,e);return this.updateTestResult(g,null),r}))}saveGrade(e,t){this.course$.pipe(ne(1),D(r=>this.coursesRestService.updateTestResult(r.Id,e).pipe(ot(g=>(t&&this.updateTestResult(B({},t),null),at(()=>g)))))).subscribe(({testResult:r,grading:g})=>this.updateOrDeleteTestResult(e.testId,e.studentId,r,g,"gradeId"in e?"grade":"points"))}publish(e){this.coursesRestService.publishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}unpublish(e){this.coursesRestService.unpublishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}deleteTest(e){this.action$.next({type:"delete-test",payload:e})}overwriteFinalGrade({id:e,selectedGradeId:t}){this.gradingsRestService.updateGrade(e,t).subscribe(()=>{this.action$.next({type:"final-grade-overwritten",payload:{id:e,selectedGradeId:t}})})}setAveragesAsFinalGrades(e){this.coursesRestService.setAverageAsFinalGrade(e).subscribe(t=>this.action$.next({type:"replace-grades",payload:t.Gradings}))}buildOptimisticResultUpdate(e,t){let r=zt(e,t.testId,t.studentId),g=r?B({},r):{Id:"",TestId:t.testId,StudentId:t.studentId,CourseRegistrationId:0,GradeId:null,GradeValue:null,GradeDesignation:null,Points:null};return g.GradeId="gradeId"in t?t.gradeId:r?.GradeId??null,g.Points="points"in t?t.points:r?.Points??null,{originalResult:r,updatedResult:g}}updateOrDeleteTestResult(e,t,r,g,w){r?this.updateTestResult(r,g,w):this.deleteTestResult(e,t,g)}updateTestResult(e,t,r){this.action$.next({type:"updateResult",payload:{testResult:e,grading:t??null,ignore:r}})}deleteTestResult(e,t,r){this.action$.next({type:"deleteResult",payload:{testId:e,studentId:t,grading:r}})}toggleTestPublishedState(e){this.action$.next({type:"toggle-test-state",payload:e})}gradingOptions$(e){return e===null?Y(null):this.gradingScalesOptions$.pipe(b(t=>t[e]),J(1))}meanOfOverwrittenGradesForCourse(e,t){return this.course$.pipe(b(r=>{if(r.GradingScaleId===null||e[r.GradingScaleId]===void 0)return null;let g=e[r.GradingScaleId];return Ei(nt(t),g)}))}};n.\u0275fac=function(t){return new(t||n)(U(me),U(ni),U(Mi),U(Ue),U(ci))},n.\u0275prov=ge({token:n,factory:n.\u0275fac});let i=n;return i})();var Tn=i=>({formGroup:i}),wn=i=>["/events",i,"tests"];function En(i,n){if(i&1&&(o(0,"div",31),m(1),l(2,"translate"),d()),i&2){let s=n.$implicit;a(),h(" ",G(2,1,"global.validation-errors."+s.error,s.params)," ")}}function kn(i,n){if(i&1&&(o(0,"div",31),m(1),l(2,"translate"),d()),i&2){let s=n.$implicit;a(),h(" ",G(2,1,"global.validation-errors."+s.error,s.params)," ")}}function Pn(i,n){if(i&1&&(o(0,"div",31),m(1),l(2,"translate"),d()),i&2){let s=n.$implicit;a(),h(" ",G(2,1,"global.validation-errors."+s.error,s.params)," ")}}function Mn(i,n){if(i&1&&(o(0,"div",31),m(1),l(2,"translate"),d()),i&2){let s=n.$implicit;a(),h(" ",G(2,1,"global.validation-errors."+s.error,s.params)," ")}}function On(i,n){if(i&1&&(o(0,"div",31),m(1),l(2,"translate"),d()),i&2){let s=n.$implicit;a(),h(" ",G(2,1,"global.validation-errors."+s.error,s.params)," ")}}function Gn(i,n){if(i&1&&(W(0),o(1,"div",32)(2,"div",33)(3,"div",17)(4,"label",34),m(5),l(6,"translate"),d(),o(7,"div",35),E(8,"input",36),l(9,"async"),f(10,Mn,3,4,"div",8),l(11,"async"),d()()(),o(12,"div",33)(13,"div",17)(14,"label",37),m(15),l(16,"translate"),d(),o(17,"div",35),E(18,"input",38),l(19,"async"),f(20,On,3,4,"div",8),l(21,"async"),d()()()(),o(22,"div",39),gt(),o(23,"math")(24,"mi"),m(25),l(26,"translate"),d(),o(27,"mo"),m(28,"="),d(),o(29,"mfrac")(30,"mrow")(31,"mi"),m(32),l(33,"translate"),d(),o(34,"mo"),m(35,"\xD7"),d(),o(36,"mn"),m(37,"5"),d()(),o(38,"mi"),m(39),l(40,"translate"),d()(),o(41,"mo"),m(42,"+"),d(),o(43,"mn"),m(44,"1"),d()()(),z()),i&2){let s,e,t=u(3);a(5),x(c(6,11,"tests.form.max-points")),a(3),re("is-invalid",((s=c(9,13,t.maxPointsErrors$))==null?null:s.length)||!1),a(2),p("ngForOf",c(11,15,t.maxPointsErrors$)),a(5),x(c(16,17,"tests.form.max-points-adjusted")),a(3),re("is-invalid",((e=c(19,19,t.maxPointsAdjustedErrors$))==null?null:e.length)||!1),a(2),p("ngForOf",c(21,21,t.maxPointsAdjustedErrors$)),a(5),h(" ",c(26,23,"tests.form.math.grade")," "),a(7),h(" ",c(33,25,"tests.form.math.points")," "),a(7),x(c(40,27,"tests.form.math.max-points"))}}function $n(i,n){i&1&&(o(0,"div",40)(1,"span",41),m(2,"Loading..."),d()())}function Fn(i,n){if(i&1){let s=M();o(0,"form",3),_("ngSubmit",function(){I(s);let t=u(2);return T(t.onSubmit())}),o(1,"div",4)(2,"div",5)(3,"label",6),m(4),l(5,"translate"),d(),E(6,"input",7),l(7,"async"),l(8,"translate"),f(9,En,3,4,"div",8),l(10,"async"),d(),o(11,"div",9)(12,"label",10),m(13),l(14,"translate"),d(),o(15,"div",11)(16,"span",12)(17,"i",13),m(18,"calendar_today"),d()(),o(19,"input",14,0),l(21,"async"),l(22,"translate"),_("click",function(){I(s);let t=A(20);return T(t.toggle())}),d(),f(23,kn,3,4,"div",8),l(24,"async"),d()()(),o(25,"div",15)(26,"label",16),m(27),l(28,"translate"),d(),o(29,"div",5)(30,"div",17)(31,"label",18),m(32),l(33,"translate"),d(),o(34,"div",19),E(35,"input",20),l(36,"async"),f(37,Pn,3,4,"div",8),l(38,"async"),d()()()(),o(39,"div")(40,"label",16),m(41),l(42,"translate"),d(),o(43,"div",21),E(44,"input",22),o(45,"label",23),m(46),l(47,"translate"),d()(),o(48,"div",21),E(49,"input",24),o(50,"label",25),m(51),l(52,"translate"),d()(),f(53,Gn,45,29,"ng-container",26),d(),o(54,"div",27)(55,"button",28),l(56,"async"),m(57),l(58,"translate"),d(),o(59,"button",29),m(60),l(61,"translate"),f(62,$n,3,0,"div",30),d()()()}if(i&2){let s,e,t,r=u().bkdLet,g=u();p("formGroup",r.formGroup),a(4),x(c(5,29,"tests.form.designation")),a(2),re("is-invalid",((s=c(7,31,g.designationErrors$))==null?null:s.length)||!1),p("placeholder",c(8,33,"tests.form.designation-placeholder")),a(3),p("ngForOf",c(10,35,g.designationErrors$)),a(4),x(c(14,37,"tests.form.date")),a(3),p("id",g.componentId),a(3),re("is-invalid",((e=c(21,39,g.dateErrors$))==null?null:e.length)||!1),p("placeholder",c(22,41,"shared.date-select.default-placeholder")),a(4),p("ngForOf",c(24,43,g.dateErrors$)),a(4),x(c(28,45,"tests.form.weight")),a(5),x(c(33,47,"tests.form.factor")),a(3),re("is-invalid",((t=c(36,49,g.weightErrors$))==null?null:t.length)||!1),a(2),p("ngForOf",c(38,51,g.weightErrors$)),a(4),x(c(42,53,"tests.form.grading-type")),a(3),p("value",!1),a(2),x(c(47,55,"tests.form.grades")),a(3),p("value",!0),a(2),x(c(52,57,"tests.form.points")),a(2),p("ngIf",r.formGroup.get("isPointGrading").value),a(2),p("disabled",g.saving)("routerLink",O(65,wn,c(56,59,g.courseId$))),a(2),h(" ",c(58,61,"tests.form.cancel")," "),a(2),p("disabled",g.saving),a(),h(" ",c(61,63,"tests.form.save")," "),a(2),p("ngIf",g.saving)}}function Rn(i,n){if(i&1&&(W(0),f(1,Fn,63,67,"form",2),z()),i&2){let s=n.bkdLet;a(),p("ngIf",s.formGroup)}}var Qe=(()=>{let n=class n{constructor(e,t,r){this.fb=e,this.translate=t,this.testStateService=r,this.test=null,this.saving=!1,this.save=new X,this.componentId=Dt("bkd-tests-edit-form"),this.formGroup=this.createFormGroup(),this.submitted$=new L(!1),this.destroy$=new ee,this.designationErrors$=Ce(Y(this.formGroup),this.submitted$,"designation"),this.dateErrors$=Ce(Y(this.formGroup),this.submitted$,"date"),this.maxPointsErrors$=Ce(Y(this.formGroup),this.submitted$,"maxPoints"),this.maxPointsAdjustedErrors$=Ce(Y(this.formGroup),this.submitted$,"maxPointsAdjusted"),this.weightErrors$=Ce(Y(this.formGroup),this.submitted$,"weight"),this.courseId$=this.testStateService.courseId$}ngOnInit(){this.test&&this.setInitialValues(this.test),At(Y(this.formGroup),"isPointGrading").pipe(de(this.destroy$)).subscribe(this.togglePointFieldsDisability.bind(this))}ngOnDestroy(){this.destroy$.next()}onSubmit(){this.submitted$.next(!0),this.formGroup.valid&&this.save.emit(this.formGroup.value)}createFormGroup(){return this.fb.group({designation:["",xe.required],date:[null,xe.required],weight:[1,xe.compose([xe.required,bi(0)])],isPointGrading:[!1],maxPoints:[{value:null,disabled:!0},xe.required],maxPointsAdjusted:[{value:null,disabled:!0},null]})}setInitialValues(e){this.formGroup.patchValue({designation:e.Designation,date:e.Date,weight:e.Weight,isPointGrading:e.IsPointGrading,maxPoints:e.MaxPoints,maxPointsAdjusted:e.MaxPointsAdjusted}),e.Results&&e.Results.length>0&&(this.formGroup.get("isPointGrading")?.disable(),this.formGroup.get("maxPoints")?.disable(),this.formGroup.get("maxPointsAdjusted")?.disable()),this.togglePointFieldsDisability()}togglePointFieldsDisability(){let e=this.formGroup.get("maxPoints"),t=this.formGroup.get("maxPointsAdjusted");this.formGroup.get("isPointGrading")?.value?(e?.enable(),t?.enable()):(e?.reset({value:this.test?.MaxPoints,disabled:!0}),t?.reset({value:this.test?.MaxPointsAdjusted,disabled:!0}))}};n.\u0275fac=function(t){return new(t||n)(v(Pt),v(ie),v(V))},n.\u0275cmp=C({type:n,selectors:[["bkd-tests-edit-form"]],inputs:{test:"test",saving:"saving"},outputs:{save:"save"},standalone:!0,features:[pe([{provide:Ot,useClass:Ft},{provide:Gt,useClass:li}]),y],decls:1,vars:3,consts:[["dp","ngbDatepicker"],[4,"bkdLet"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"row","g-3","mb-3"],[1,"col-md-6"],["for","designation",1,"form-label"],["id","designation","name","designation","type","text","formControlName","designation","required","",1,"form-control",3,"placeholder"],["class","invalid-feedback",4,"ngFor","ngForOf"],[1,"col-md-6","mb-3"],["for","date",1,"form-label"],[1,"input-group"],[1,"input-group-text",3,"id"],[1,"material-icons"],["id","date","name","date","type","text","ngbDatepicker","","formControlName","date","required","",1,"form-control",3,"click","placeholder"],[1,"row","mb-3"],[1,"form-label"],[1,"row"],["for","factor",1,"form-label","col-3","col-sm-2"],[1,"col-9","col-sm-10"],["id","factor","name","factor","type","number","formControlName","weight","step","0.05","min","0","required","",1,"form-control"],[1,"form-check"],["type","radio","formControlName","isPointGrading","id","type-grades",1,"form-check-input",3,"value"],["for","type-grades",1,"form-check-label"],["type","radio","formControlName","isPointGrading","id","type-points",1,"form-check-input",3,"value"],["for","type-points",1,"form-check-label"],[4,"ngIf"],[1,"d-flex","justify-content-end","mt-4"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","routerLink"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"invalid-feedback"],[1,"row","ms-4","mb-3","g-3"],[1,"col-sm-6","col-md-4"],["for","max-points",1,"ms-2","col-4","col-form-label"],[1,"col-6"],["type","number","name","maxPoints","id","max-points","formControlName","maxPoints","step","0.01","min","0","max","999","required","",1,"form-control"],["for","max-points-adjusted",1,"ms-2","col-4","col-form-label"],["type","number","name","maxPointsAdjusted","id","max-points-adjusted","formControlName","maxPointsAdjusted","step","0.01","min","0","max","999",1,"form-control"],[1,"ms-4","ps-3","py-3"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"visually-hidden"]],template:function(t,r){t&1&&f(0,Rn,2,1,"ng-container",1),t&2&&p("bkdLet",O(1,Tn,r.formGroup))},dependencies:[Q,R,be,It,Be,Le,Tt,De,yt,kt,je,Ae,Mt,wt,Et,ce,$t,oe,j,P,k],styles:["#factor[_ngcontent-%COMP%], #max-points[_ngcontent-%COMP%], #max-points-adjusted[_ngcontent-%COMP%]{width:5em}"]});let i=n;return i})();var Dn=(i,n)=>({courseId:i,saving:n});function Ln(i,n){if(i&1){let s=M();o(0,"div",1)(1,"bkd-tests-edit-form",2),_("save",function(t){I(s);let r=u();return T(r.save(t))}),d()()}if(i&2){let s=n.bkdLet;a(),p("saving",s.saving)}}var Gi=(()=>{let n=class n{constructor(e,t,r,g,w){this.route=e,this.courseService=t,this.toastService=r,this.translate=g,this.router=w,this.saving$=new L(!1),this.courseId$=this.route.paramMap.pipe(b(S=>Number(S.get("id"))),K())}save(e){this.saving$.next(!0);let{designation:t,date:r,weight:g,isPointGrading:w,maxPoints:S,maxPointsAdjusted:F}=e;this.courseId$.pipe(D(q=>this.courseService.add(q,r,t,g,w,S,F)),Ge(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}navigateBack(){this.courseId$.subscribe(e=>this.router.navigate(["events",e,"tests"]))}};n.\u0275fac=function(t){return new(t||n)(v(ve),v(me),v(He),v(ie),v(Re))},n.\u0275cmp=C({type:n,selectors:[["bkd-tests-add"]],standalone:!0,features:[y],decls:6,vars:11,consts:[["class","bkd-container bkd-container-limited",4,"bkdLet"],[1,"bkd-container","bkd-container-limited"],[3,"save","saving"]],template:function(t,r){t&1&&(o(0,"h1"),m(1),l(2,"translate"),d(),f(3,Ln,2,1,"div",0),l(4,"async"),l(5,"async")),t&2&&(a(),x(c(2,2,"tests.add-title")),a(2),p("bkdLet",Pe(8,Dn,c(4,4,r.courseId$),c(5,6,r.saving$))))},dependencies:[Q,Qe,j,P,k]});let i=n;return i})();var $i=(()=>{let n=class n{constructor(e){this.activeModal=e}get canDeleteTest(){return(this.test?.Results?.filter(t=>t.GradeId!==null||t.GradeValue!==null||t.Points!==null)||[]).length===0}};n.\u0275fac=function(t){return new(t||n)(v(Ve))},n.\u0275cmp=C({type:n,selectors:[["bkd-tests-delete"]],inputs:{test:"test"},standalone:!0,features:[y],decls:13,vars:10,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click","hidden"],[1,"px-2"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"],[1,"px-3"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"p",1),m(2),l(3,"translate"),d()(),o(4,"div",2)(5,"button",3),_("click",function(){return r.activeModal.dismiss()}),o(6,"span",4),m(7),l(8,"translate"),d()(),o(9,"button",5),_("click",function(){return r.activeModal.close(r.canDeleteTest?r.test:null)}),o(10,"span",6),m(11),l(12,"translate"),d()()()),t&2&&(a(2),h(" ",c(3,4,r.canDeleteTest?"tests.form.confirm":"tests.form.delete-not-allowed")," "),a(3),p("hidden",!r.canDeleteTest),a(2),h(" ",c(8,6,"tests.dialog.no")," "),a(4),h(" ",c(12,8,r.canDeleteTest?"tests.dialog.yes":"tests.dialog.ok")," "))},dependencies:[P,k]});let i=n;return i})();var Vn=(i,n,s)=>({courseId:i,test:n,saving:s}),Hn=i=>({test:i});function Nn(i,n){if(i&1){let s=M();W(0),o(1,"div",4)(2,"h1"),m(3),l(4,"translate"),d(),o(5,"button",5),_("click",function(){I(s);let t=u().bkdLet,r=u();return T(r.openDeleteModal(t.test))}),o(6,"i",6),m(7,"delete"),d()()(),o(8,"bkd-tests-edit-form",7),_("save",function(t){I(s);let r=u(2);return T(r.save(t))}),d(),z()}if(i&2){let s=u().bkdLet;a(3),h(" ",G(4,3,"tests.edit-title",O(6,Hn,s.test.Designation))," "),a(5),p("test",s.test)("saving",s.saving)}}function Un(i,n){i&1&&E(0,"bkd-spinner")}function Wn(i,n){if(i&1&&(o(0,"div",2),f(1,Nn,9,8,"ng-container",3),l(2,"async"),f(3,Un,1,0,"ng-template",null,0,se),d()),i&2){let s=A(4),e=u();a(),p("ngIf",c(2,2,e.state.loading$)===!1)("ngIfElse",s)}}var Fi=(()=>{let n=class n{constructor(e,t,r,g,w,S,F){this.state=e,this.courseService=t,this.route=r,this.toastService=g,this.translate=w,this.router=S,this.modalService=F,this.saving$=new L(!1),this.testId$=this.route.paramMap.pipe(b(q=>Number(q.get("testId"))),K()),this.test$=te([this.state.tests$,this.testId$]).pipe(b(([q,we])=>q.find(Me=>Me.Id===we)))}openDeleteModal(e){let t=this.modalService.open($i);t.componentInstance.test=e,t.result.then(r=>{r&&this.courseService.delete(e.CourseId,e.Id).subscribe(this.onDeleteSuccess.bind(this))},()=>{})}save(e){this.saving$.next(!0);let{designation:t,date:r,weight:g,isPointGrading:w,maxPoints:S,maxPointsAdjusted:F}=e;te([this.state.courseId$,this.testId$]).pipe(ne(1),D(([q,we])=>this.courseService.update(q,we,t,r,g,w,S,F)),Ge(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}onDeleteSuccess(e){this.toastService.success(this.translate.instant("tests.form.delete-success")),this.state.deleteTest(e),this.navigateBack()}navigateBack(){this.state.courseId$.pipe(ne(1)).subscribe(e=>this.router.navigate(["events",e,"tests"]))}};n.\u0275fac=function(t){return new(t||n)(v(V),v(me),v(ve),v(He),v(ie),v(Re),v(qe))},n.\u0275cmp=C({type:n,selectors:[["bkd-tests-edit"]],standalone:!0,features:[y],decls:4,vars:11,consts:[["loading",""],["class","bkd-container bkd-container-limited",4,"bkdLet"],[1,"bkd-container","bkd-container-limited"],[4,"ngIf","ngIfElse"],[1,"d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-primary","btn-icon",3,"click"],[1,"material-icons"],[3,"save","test","saving"]],template:function(t,r){t&1&&(f(0,Wn,5,4,"div",1),l(1,"async"),l(2,"async"),l(3,"async")),t&2&&p("bkdLet",he(7,Vn,c(1,1,r.state.courseId$),c(2,3,r.test$),c(3,5,r.saving$)))},dependencies:[Q,R,Qe,Se,j,P,k]});let i=n;return i})();var zn=i=>({designation:i}),Ri=(()=>{let n=class n{constructor(e){this.activeModal=e}};n.\u0275fac=function(t){return new(t||n)(v(Ve))},n.\u0275cmp=C({type:n,selectors:[["bkd-publish-test"]],inputs:{test:"test"},standalone:!0,features:[y],decls:11,vars:12,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"p",1),m(2),l(3,"translate"),d()(),o(4,"div",2)(5,"button",3),_("click",function(){return r.activeModal.dismiss()}),m(6),l(7,"translate"),d(),o(8,"button",4),_("click",function(){return r.activeModal.close(!0)}),m(9),l(10,"translate"),d()()),t&2&&(a(2),h(" ",G(3,3,r.test.IsPublished?"tests.publishing.unpublish":"tests.publishing.publish",O(10,zn,r.test.Designation))," "),a(4),h(" ",c(7,6,"tests.publishing.cancel")," "),a(3),h(" ",c(10,8,"tests.publishing.confirm")," "))},dependencies:[P,k],encapsulation:2});let i=n;return i})();var qn=i=>({maxPoints:i});function Yn(i,n){if(i&1&&(o(0,"div",8),m(1),l(2,"translate"),d()),i&2){let s=u(2);a(),h(" ",G(2,1,"global.validation-errors.invalidPoints",O(4,qn,s.maxPoints))," ")}}function Kn(i,n){if(i&1){let s=M();o(0,"div",5)(1,"input",6,0),_("ngModelChange",function(){I(s);let t=A(2),r=u();return T(r.onPointsChange(t.value))}),d(),f(3,Yn,3,6,"div",7),d()}if(i&2){let s=A(2),e=u();a(),re("is-invalid",s.errors),le("max",e.maxPoints),le("tabindex",e.tabIndex),p("disabled",e.grade.test.IsPublished)("ngModel",e.grade.kind==="grade"?e.grade.result.Points:null),a(2),p("ngIf",s.errors)}}var Jn=1250,Bi=(()=>{let n=class n{constructor(e){this.state=e,this.maxPoints=0,this.pointsSubject$=new ee,this.gradeSubject$=new ee,this.gradingScaleDisabledSubject$=new L(!0),this.gradingScaleDisabled$=this.gradingScaleDisabledSubject$.asObservable(),this.destroy$=new ee}ngOnInit(){this.gradingScaleDisabledSubject$.next(this.disableGradingScale()),this.maxPoints=Ti(this.grade),this.initSave(this.pointsSubject$.pipe(Ee(this.isValid.bind(this)),b(e=>({studentId:this.student.Id,testId:this.grade.test.Id,points:e?Number(e):null})))),this.initSave(this.gradeSubject$.pipe(b(e=>({studentId:this.student.Id,testId:this.grade.test.Id,gradeId:e}))))}ngOnChanges(){this.gradingScaleDisabledSubject$.next(this.disableGradingScale())}ngOnDestroy(){this.destroy$.next()}onPointsChange(e){this.pointsSubject$.next(e),this.gradingScaleDisabledSubject$.next(!(e===null||e===""))}onGradeChange(e){this.gradeSubject$.next(e)}isValid(e){return e===""||e===null?!0:isNaN(Number(e))?!1:!(Number(e)<0||Number(e)>this.maxPoints)}initSave(e){e.pipe(dt(t=>this.state.optimisticallyUpdateGrade(t).pipe(b(r=>({params:t,originalResult:r})))),lt(Jn),de(this.destroy$)).subscribe(({params:t,originalResult:r})=>this.state.saveGrade(t,r))}disableGradingScale(){return this.grade.test.IsPublished?!0:this.grade.kind==="no-result"?!1:this.grade.result.Points!=null&&this.grade.test.IsPointGrading}};n.\u0275fac=function(t){return new(t||n)(v(V))},n.\u0275cmp=C({type:n,selectors:[["bkd-grade"]],inputs:{grade:"grade",student:"student",tabIndex:"tabIndex",gradeOptions:"gradeOptions"},standalone:!0,features:[fe,y],decls:5,vars:8,consts:[["points","ngModel"],[1,"d-flex","flex-column","w-100"],[1,"d-flex","flex-row"],["class","point-input-container me-2 me-md-3",4,"ngIf"],["data-testid","grade-select",1,"grade-select",3,"valueChange","options","allowEmpty","value","disabled","tabindex"],[1,"point-input-container","me-2","me-md-3"],["type","number","step","0.01","min","0","data-testid","point-input",1,"form-control",3,"ngModelChange","max","disabled","tabindex","ngModel"],["class","invalid-feedback","data-testid","validation-error-message",4,"ngIf"],["data-testid","validation-error-message",1,"invalid-feedback"]],template:function(t,r){t&1&&(o(0,"div",1)(1,"div",2),f(2,Kn,4,7,"div",3),o(3,"bkd-select",4),l(4,"async"),_("valueChange",function(w){return r.onGradeChange(w)}),d()()()),t&2&&(a(2),p("ngIf",r.grade.test.IsPointGrading),a(),p("options",r.gradeOptions)("allowEmpty",!0)("value",r.grade.kind==="grade"?r.grade.result.GradeId:null)("disabled",c(4,6,r.gradingScaleDisabled$))("tabindex",r.tabIndex))},dependencies:[R,be,Be,Le,De,je,Ae,St,Ie,j,P,k],styles:[".point-input-container[_ngcontent-%COMP%]{width:4em}[_nghost-%COMP%]     select{min-width:13ch}@media (min-width: 576px){.point-input-container[_ngcontent-%COMP%]{width:5em}}"]});let i=n;return i})();function Qn(i,n){if(i&1&&(o(0,"span",3),m(1),d()),i&2){let s=u();a(),x(s.calculatePointsAverage(s.test))}}var Di=(()=>{let n=class n{constructor(e){this.locale=e}calculatePointsAverage(e){return this.safeAverage(e,2,We)}calculateGradeAverage(e){return this.safeAverage(e,3,ze)}safeAverage(e,t,r){try{return ei(r(e),this.locale,t)}catch{return Xt}}};n.\u0275fac=function(t){return new(t||n)(v(bt))},n.\u0275cmp=C({type:n,selectors:[["bkd-average-grades"]],inputs:{test:"test"},standalone:!0,features:[y],decls:4,vars:2,consts:[[1,"d-flex","flex-row","w-100"],["class","mr-2 mr-md-3 average-points","data-testid","average-points",4,"ngIf"],["data-testid","average-grade"],["data-testid","average-points",1,"mr-2","mr-md-3","average-points"]],template:function(t,r){t&1&&(o(0,"div",0),f(1,Qn,2,1,"span",1),o(2,"span",2),m(3),d()()),t&2&&(a(),p("ngIf",r.test.IsPointGrading),a(2),x(r.calculateGradeAverage(r.test)))},dependencies:[R],styles:[".average-points[_ngcontent-%COMP%]{min-width:4.5em}@media (min-width: 576px){.average-points[_ngcontent-%COMP%]{min-width:6em}}"]});let i=n;return i})();var Li=(()=>{let n=class n{constructor(){this.disabled=!1,this.width="13ch",this.gradeIdSelected=new X}onGradeChange(e){this.gradeId?.valueOf()!==void 0&&this.gradeIdSelected.emit({id:this.gradeId?.valueOf(),selectedGradeId:e})}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=C({type:n,selectors:[["bkd-grade-select"]],inputs:{options:"options",valueId:"valueId",gradeId:"gradeId",disabled:"disabled",width:"width"},outputs:{gradeIdSelected:"gradeIdSelected"},standalone:!0,features:[y],decls:1,vars:5,consts:[["data-testid","grade-select",3,"valueChange","options","allowEmpty","value","disabled","width"]],template:function(t,r){t&1&&(o(0,"bkd-select",0),_("valueChange",function(w){return r.onGradeChange(w)}),d()),t&2&&p("options",r.options)("allowEmpty",!0)("value",r.valueId)("disabled",r.disabled)("width",r.width)},dependencies:[Ie]});let i=n;return i})();var Xn=576,Ai=(()=>{let n=class n{constructor(e,t){this.portal=e,this.state=t,this.destroy$=new ee,this.handleWindowScroll=()=>{this.updateStickyVisibility(),this.updateStickyTopOffset()},this.handleWindowResize=()=>{this.updateStickyWidth(),this.updateStickyVisibility(),this.updateStickyTopOffset()},this.handleTableScroll=()=>{this.updateStickyLeftOffset()}}ngOnInit(){te([this.state.filteredTests$,this.state.expandedHeader$]).pipe(de(this.destroy$)).subscribe(()=>setTimeout(()=>this.updateStickyWidth()))}ngAfterViewInit(){this.handleWindowScroll(),this.handleTableScroll(),this.handleWindowResize(),this.window.addEventListener("scroll",this.handleWindowScroll),this.getTableScrollContainer()?.addEventListener("scroll",this.handleTableScroll),this.window.addEventListener("resize",this.handleWindowResize)}ngOnDestroy(){this.window.removeEventListener("scroll",this.handleWindowScroll),this.getTableScrollContainer()?.removeEventListener("scroll",this.handleTableScroll),this.window.removeEventListener("resize",this.handleWindowResize)}get window(){return this.portal.window??window}getTableScrollContainer(){return document.querySelector(".table-responsive-wrapper")??null}updateStickyVisibility(){if(this.isSmallBreakpointDown())return;let e=this.inlineHeader.getTop()+this.getIframeScrollY();this.stickyHeader.shown=this.getScrollTop()>e}updateStickyTopOffset(){this.isSmallBreakpointDown()||this.stickyHeader.setTopOffset(this.portal.inIframe?this.getScrollTop():0)}updateStickyLeftOffset(){this.isSmallBreakpointDown()||this.stickyHeader.setLeftOffset(this.inlineHeader.getLeft())}updateStickyWidth(){this.isSmallBreakpointDown()||(this.stickyHeader.setWidth(this.inlineHeader.getWidth()),this.stickyHeader.setColumnWidths(this.inlineHeader.getColumnWidths()),this.stickyHeader.setStickyColumnHeights(this.inlineHeader.getStickyColumnsHeights()))}getScrollTop(){return this.window.scrollY-this.portal.getIframeTop()}getIframeScrollY(){return window.scrollY}isSmallBreakpointDown(){return window.innerWidth<Xn}};n.\u0275fac=function(t){return new(t||n)(v(ri),v(V))},n.\u0275dir=mt({type:n,selectors:[["","bkdTestEditGradesHeaderSticky",""]],inputs:{inlineHeader:"inlineHeader",stickyHeader:"stickyHeader"},standalone:!0});let i=n;return i})();var ji=(i,n)=>({"btn-primary":i,"btn-outline-secondary":n}),Vi=(()=>{let n=class n{constructor(){this.filter=st,this.filterChange=new X}showOnlyMine(){this.filterChange.next(H(B({},this.filter),{onlyMine:!0}))}showAll(){this.filterChange.next(H(B({},this.filter),{onlyMine:!1}))}onHidePublishedChange(e){let t=(e.target&&e.target instanceof HTMLInputElement&&e.target?.checked)??!1;this.filterChange.next(H(B({},this.filter),{hidePublished:t}))}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=C({type:n,selectors:[["bkd-test-table-filter"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},standalone:!0,features:[y],decls:13,vars:18,consts:[[1,"only-mine-buttons"],["type","button",1,"btn","desktop",3,"click","ngClass"],["type","button",1,"btn","ms-2","desktop",3,"click","ngClass"],[1,"hide-published"],[1,"form-check"],["id","hide-published","type","checkbox",1,"form-check-input",3,"change","checked"],["for","hide-published",1,"form-check-label"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"button",1),_("click",function(){return r.showAll()}),m(2),l(3,"translate"),d(),o(4,"button",2),_("click",function(){return r.showOnlyMine()}),m(5),l(6,"translate"),d()(),o(7,"div",3)(8,"div",4)(9,"input",5),_("change",function(w){return r.onHidePublishedChange(w)}),d(),o(10,"label",6),m(11),l(12,"translate"),d()()()),t&2&&(a(),p("ngClass",Pe(12,ji,!r.filter.onlyMine,r.filter.onlyMine)),a(),h(" ",c(3,6,"tests.all-tests")," "),a(2),p("ngClass",Pe(15,ji,r.filter.onlyMine,!r.filter.onlyMine)),a(),h(" ",c(6,8,"tests.owned-tests")," "),a(4),p("checked",r.filter.hidePublished),a(2),h(" ",c(12,10,"tests.hide-published")," "))},dependencies:[ae,be,P,k],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:100%}.only-mine-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;height:3.625rem}.hide-published[_ngcontent-%COMP%]{display:flex;align-items:center;height:2.375rem;margin-bottom:1rem}.hide-published[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:300}.hide-published[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]{margin-bottom:0}"]});let i=n;return i})();var Zn=["*"],Hi=(()=>{let n=class n{};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=C({type:n,selectors:[["bkd-preserve-line-height"]],standalone:!0,features:[y],ngContentSelectors:Zn,decls:3,vars:0,template:function(t,r){t&1&&(ht(),o(0,"div"),vt(1),m(2,"\xA0"),d())},encapsulation:2});let i=n;return i})();var Ni=(()=>{let n=class n{constructor(e){this.translate=e}transform(e){return`${e.Weight} (${e.WeightPercent}%)${this.getPoints(e)}`}getPoints(e){return e.IsPointGrading?`, ${e.MaxPointsAdjusted??e.MaxPoints} ${this.translate.instant("tests.summary.points")}`:""}};n.\u0275fac=function(t){return new(t||n)(v(ie,16))},n.\u0275pipe=ut({name:"testSummaryShort",type:n,pure:!0,standalone:!0});let i=n;return i})();var er=i=>[i,"edit"];function tr(i,n){i&1&&(o(0,"i",12),m(1,"edit"),d())}function ir(i,n){if(i&1&&(o(0,"div",8)(1,"div",9)(2,"bkd-preserve-line-height"),m(3),l(4,"date"),d(),o(5,"a",10),f(6,tr,2,0,"i",11),d()(),o(7,"bkd-preserve-line-height"),m(8),l(9,"testSummaryShort"),d(),o(10,"bkd-preserve-line-height"),m(11),d()()),i&2){let s=u();a(3),x(G(4,5,s.test.Date,"dd.MM.yyyy")),a(2),p("routerLink",O(10,er,s.test.Id)),a(),p("ngIf",s.test.IsOwner&&s.test.IsPublished===!1),a(2),h(" ",c(9,8,s.test)," "),a(3),x(s.test.Owner)}}function nr(i,n){if(i&1){let s=M();o(0,"div",13)(1,"a",14),l(2,"translate"),_("click",function(){I(s);let t=u();return T(t.unpublishTest())}),o(3,"i",15),m(4,"lock"),d(),o(5,"span"),m(6),l(7,"translate"),d()(),o(8,"bkd-caret",16),_("click",function(){I(s);let t=u();return T(t.toggleHeader())}),d()()}if(i&2){let s=u();a(),le("title",c(2,3,"tests.edit")),a(5),x(c(7,5,"tests.published")),a(2),p("expanded",s.expanded)}}function rr(i,n){if(i&1){let s=M();o(0,"div",13)(1,"a",17),l(2,"translate"),_("click",function(){I(s);let t=u();return T(t.publishTest())}),o(3,"i",15),m(4,"lock_open"),d(),o(5,"span"),m(6),l(7,"translate"),d()(),o(8,"bkd-caret",16),_("click",function(){I(s);let t=u();return T(t.toggleHeader())}),d()()}if(i&2){let s=u();a(),le("title",c(2,3,"tests.publish")),a(5),x(c(7,5,"tests.not-published")),a(2),p("expanded",s.expanded)}}var Ui=(()=>{let n=class n{constructor(){this.toggle=new X,this.publish=new X,this.unpublish=new X}toggleHeader(){this.toggle.emit(!this.expanded)}publishTest(){this.publish.emit(this.test)}unpublishTest(){this.unpublish.emit(this.test)}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=C({type:n,selectors:[["bkd-test-table-header"]],inputs:{test:"test",expanded:"expanded"},outputs:{toggle:"toggle",publish:"publish",unpublish:"unpublish"},standalone:!0,features:[y],decls:10,vars:6,consts:[["notPublished",""],[1,"d-flex","flex-column","h-100","justify-content-between"],["role","button",1,"test-designation","d-flex","flex-row","my-3","align-items-end","justify-content-between",3,"click"],[3,"ngClass"],[1,"align-self-start",3,"expanded"],[1,"d-flex","flex-column"],["class","d-flex flex-column mb-3",4,"ngIf"],["class","d-flex align-items-center justify-content-between test-status",4,"ngIf","ngIfElse"],[1,"d-flex","flex-column","mb-3"],[1,"d-flex","flex-row","justify-content-between"],[1,"btn","btn-link","p-0","edit",3,"routerLink"],["class","material-icons",4,"ngIf"],[1,"material-icons"],[1,"d-flex","align-items-center","justify-content-between","test-status"],[1,"d-flex","btn","btn-link","ps-0","edit",3,"click","title"],[1,"material-icons","me-1"],[1,"expand-mobile",3,"click","expanded"],[1,"d-flex","btn","btn-link","ps-0",3,"click","title"]],template:function(t,r){if(t&1){let g=M();o(0,"div",1)(1,"div",2),_("click",function(){return I(g),T(r.toggleHeader())}),o(2,"div",3),m(3),d(),E(4,"bkd-caret",4),d(),o(5,"div",5),f(6,ir,12,12,"div",6)(7,nr,9,7,"div",7)(8,rr,9,7,"ng-template",null,0,se),d()()}if(t&2){let g=A(9);a(2),p("ngClass",r.expanded?"expanded":"collapsed"),a(),h(" ",r.test.Designation," "),a(),p("expanded",r.expanded),a(2),p("ngIf",r.expanded),a(),p("ngIf",r.test.IsPublished)("ngIfElse",g)}},dependencies:[ae,Wt,R,Hi,oe,$e,P,k,Ni],styles:["[_nghost-%COMP%]{font-weight:300}.collapsed[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.test-designation[_ngcontent-%COMP%]{display:none!important}.test-status[_ngcontent-%COMP%]{order:-1;padding-bottom:1rem}.test-status[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.test-status[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#000}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.edit[_ngcontent-%COMP%]{color:#00000080;text-decoration:none}@media (min-width: 811px){.test-designation[_ngcontent-%COMP%]{display:inherit!important}.test-status[_ngcontent-%COMP%]{order:initial}.expand-mobile[_ngcontent-%COMP%]{display:none!important}}"]});let i=n;return i})();var sr=["bkdTestEditGradesHeader",""],ar=(i,n,s)=>({tests:i,filter:n,expanded:s}),or=i=>({selected:i});function dr(i,n){if(i&1){let s=M();o(0,"th",13)(1,"bkd-test-table-header",14),_("toggle",function(t){I(s);let r=u(2);return T(r.state.toggleHeader(t))})("publish",function(t){I(s);let r=u(2);return T(r.publish.emit(t))})("unpublish",function(t){I(s);let r=u(2);return T(r.unpublish.emit(t))}),d()()}if(i&2){let s=n.$implicit,e=u().bkdLet,t=u();p("ngClass",s.Id===(t.selectedTest==null?null:t.selectedTest.Id)?"selected":""),a(),p("test",s)("expanded",e.expanded)}}function lr(i,n){if(i&1){let s=M();o(0,"th",15)(1,"bkd-test-table-header",14),_("toggle",function(t){I(s);let r=u(2);return T(r.state.toggleHeader(t))})("publish",function(t){I(s);let r=u(2);return T(r.publish.emit(t))})("unpublish",function(t){I(s);let r=u(2);return T(r.unpublish.emit(t))}),d()()}if(i&2){let s=n.$implicit,e=u().bkdLet,t=u();p("ngClass",s.Id===(t.selectedTest==null?null:t.selectedTest.Id)?"selected":""),a(),p("test",s)("expanded",e.expanded)}}function pr(i,n){if(i&1){let s=M();o(0,"div",19)(1,"span",18),_("click",function(){I(s);let t=u().$implicit,r=u(2);return T(r.state.sortBy(t))}),m(2),l(3,"translate"),d()()}i&2&&(a(2),h("",c(3,1,"tests.points")," "))}function cr(i,n){if(i&1){let s=M();o(0,"th",16)(1,"div",7),f(2,pr,4,3,"div",17),o(3,"div",8)(4,"span",18),_("click",function(){let t=I(s).$implicit,r=u(2);return T(r.state.sortBy(t))}),m(5),l(6,"translate"),d()(),o(7,"div",9),m(8),l(9,"async"),d()()()}if(i&2){let s=n.$implicit,e=u(2);p("ngClass",s.Id===(e.selectedTest==null?null:e.selectedTest.Id)?"selected":""),a(2),p("ngIf",s.IsPointGrading),a(3),x(c(6,4,"tests.grade")),a(3),h(" ",c(9,6,e.state.getSortingChar$(s))," ")}}function mr(i,n){if(i&1){let s=M();W(0),o(1,"tr",1)(2,"th",2)(3,"bkd-test-table-filter",3),_("filterChange",function(t){I(s);let r=u();return T(r.state.setFilter(t))}),d()(),f(4,dr,2,3,"th",4)(5,lr,2,3,"th",5),d(),o(6,"tr")(7,"th",6),_("click",function(){I(s);let t=u();return T(t.state.sortBy("FullName"))}),o(8,"div",7)(9,"div",8),m(10),l(11,"translate"),d(),o(12,"div",9),m(13),l(14,"async"),d()()(),o(15,"th",10),_("click",function(){I(s);let t=u();return T(t.state.sortBy("FinalGrade"))}),o(16,"div",7)(17,"div",8),m(18),l(19,"translate"),d(),o(20,"div",9),m(21),l(22,"async"),d()()(),o(23,"th",11),_("click",function(){I(s);let t=u();return T(t.state.sortBy("TestsMean"))}),o(24,"div",7)(25,"div",8),m(26),l(27,"translate"),d(),o(28,"div",9),m(29),l(30,"async"),d()()(),f(31,cr,10,8,"th",12),d(),z()}if(i&2){let s=n.bkdLet,e=u();a(3),p("filter",s.filter),a(),p("ngForOf",s.tests),a(),p("ngForOf",s.tests),a(5),h(" ",c(11,11,"tests.student.name")," "),a(3),h(" ",c(14,13,e.state.getSortingChar$("FullName"))," "),a(2),p("ngClass",O(23,or,e.selectedTest===void 0)),a(3),h(" ",c(19,15,"tests.grade")," "),a(3),h(" ",c(22,17,e.state.getSortingChar$("FinalGrade"))," "),a(5),h(" ",c(27,19,"tests.mean")," "),a(3),h(" ",c(30,21,e.state.getSortingChar$("TestsMean"))," "),a(2),p("ngForOf",s.tests)}}var Wi=(()=>{let n=class n{set shown(e){let t=this.element.nativeElement.classList;e?t.add("shown"):t.remove("shown")}constructor(e,t){this.state=e,this.element=t,this.sticky=!1,this.publish=new X,this.unpublish=new X}getTop(){return this.element.nativeElement.getBoundingClientRect().top}getLeft(){return this.element.nativeElement.getBoundingClientRect().left}setTopOffset(e){this.element.nativeElement.style.top=`${e}px`}setLeftOffset(e){this.element.nativeElement.style.left=`${e}px`}getWidth(){return this.element.nativeElement.getBoundingClientRect().width}setWidth(e){this.element.nativeElement.style.width=`${e}px`}getColumnWidths(){return this.getRowsAndColumns().map(e=>e.map(t=>t.getBoundingClientRect().width))}setColumnWidths(e){let t=this.getRowsAndColumns();if(t.length!==e.length||!t.every((r,g)=>r.length===e[g].length))throw new Error("Given column widths do not match number of header rows/columns");t.forEach((r,g)=>r.forEach((w,S)=>{w.style.width=`${e[g][S]}px`,w.style.minWidth=`${e[g][S]}px`}))}getStickyColumnsHeights(){return this.getRowsAndColumns(".sticky").map(e=>e.map(t=>t.getBoundingClientRect().height))}setStickyColumnHeights(e){let t=this.getRowsAndColumns(".sticky");if(t.length!==e.length||!t.every((r,g)=>r.length===e[g].length))throw new Error("Given column heights do not match number of sticky header columns");t.forEach((r,g)=>r.forEach((w,S)=>{w.style.height=`${e[g][S]}px`})),this.getRows().forEach((r,g)=>{let w=e[g].reduce((S,F)=>Math.max(S,F),0);r.style.height=`${w}px`})}getRowsAndColumns(e){return this.getRows().map(t=>Array.from(t.querySelectorAll(`th:not(.header-mobile)${e??""}`)))}getRows(){return Array.from(this.element.nativeElement.querySelectorAll("tr"))}};n.\u0275fac=function(t){return new(t||n)(v(V),v(ft))},n.\u0275cmp=C({type:n,selectors:[["thead","bkdTestEditGradesHeader",""]],hostVars:2,hostBindings:function(t,r){t&2&&re("sticky",r.sticky)},inputs:{selectedTest:"selectedTest",sticky:"sticky",shown:"shown"},outputs:{publish:"publish",unpublish:"unpublish"},standalone:!0,features:[y],attrs:sr,decls:4,vars:11,consts:[[4,"bkdLet"],[1,"header-collapsible"],["colspan","3",1,"desktop","sticky"],[3,"filterChange","filter"],["container","body","class","test-grade grade test-info-desktop",3,"ngClass",4,"ngFor","ngForOf"],["container","body","class","test-grade header-mobile test-info-mobile","colspan","3",3,"ngClass",4,"ngFor","ngForOf"],[1,"sticky","student-name",3,"click"],[1,"d-flex"],[1,"column-title"],[1,"sort-direction","ms-1"],[1,"sticky","student-grade","desktop",3,"click","ngClass"],[1,"border-end","sticky","student-average","desktop",3,"click"],["container","body","class","test-grade",3,"ngClass",4,"ngFor","ngForOf"],["container","body",1,"test-grade","grade","test-info-desktop",3,"ngClass"],[3,"toggle","publish","unpublish","test","expanded"],["container","body","colspan","3",1,"test-grade","header-mobile","test-info-mobile",3,"ngClass"],["container","body",1,"test-grade",3,"ngClass"],["class","column-title me-3 point-input-container",4,"ngIf"],[3,"click"],[1,"column-title","me-3","point-input-container"]],template:function(t,r){t&1&&(f(0,mr,32,25,"ng-container",0),l(1,"async"),l(2,"async"),l(3,"async")),t&2&&p("bkdLet",he(7,ar,c(1,1,r.state.filteredTests$),c(2,3,r.state.filter$),c(3,5,r.state.expandedHeader$)))},dependencies:[Q,j,ae,ce,R,P,k,Vi,Ui],styles:["[_nghost-%COMP%]{--student-name-column-width: 225px;--student-grade-column-width: 147px;--student-average-column-width: 100px;--test-grade-column-width: 300px;--point-input-size: 4em;--student-grade-column-offset: var(--student-name-column-width);--student-average-column-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) );--test-columns-offset: calc( var(--student-average-column-offset) + var(--student-average-column-width) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (min-width: 576px){[_nghost-%COMP%]{--point-input-size: 5em}}tr[_ngcontent-%COMP%]:not(.header-collapsible)   th.test-grade[_ngcontent-%COMP%]{width:calc(var(--point-input-size) + 13ch + 3rem)}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-average[_ngcontent-%COMP%], .test-grade[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex;width:100%}.student-name[_ngcontent-%COMP%]{flex:1;display:block}.test-grade[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}.student-average[_ngcontent-%COMP%]{width:var(--student-average-column-width);min-width:var(--student-average-column-width);max-width:var(--student-average-column-width)}.test-grade[_ngcontent-%COMP%]{min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}th.sticky.student-average[_ngcontent-%COMP%], td.sticky.student-average[_ngcontent-%COMP%]{left:var(--student-average-column-offset)}}@media (max-width: 1200px){[_nghost-%COMP%]{--student-average-column-width: 1px}.student-average[_ngcontent-%COMP%]{padding:0;overflow:hidden}}@media (min-width: 1201px){.student-average-inline[_ngcontent-%COMP%]{display:none}}.sticky[_nghost-%COMP%]{position:fixed;top:0;left:0;z-index:1000;display:none}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;vertical-align:top}.header-collapsible[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:0 1rem}tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:none!important}@media (min-width: 811px){.sticky.shown[_nghost-%COMP%]{display:table-header-group}tr[_ngcontent-%COMP%]   th.test-info-mobile[_ngcontent-%COMP%]{display:none!important}tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:table-cell!important}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;padding-top:.25rem;padding-bottom:.25rem;border-top:initial}.sticky[_nghost-%COMP%]{margin-left:var(--test-columns-offset)}.sticky[_nghost-%COMP%]   th.sticky[_ngcontent-%COMP%]{position:fixed}}"],changeDetection:0});let i=n;return i})();var ur=(i,n,s)=>({tests:i,hasTests:n,studentGrades:s}),zi=i=>({selected:i}),gr=i=>["student",i,"grades"],fr=i=>({"visible-on-mobile":i});function hr(i,n){if(i&1){let s=M();o(0,"bkd-grade-select",22),l(1,"async"),l(2,"async"),_("gradeIdSelected",function(t){I(s);let r=u(3);return T(r.state.overwriteFinalGrade(t))}),d()}if(i&2){let s=u().$implicit,e=u(2);p("options",c(1,4,e.state.gradingOptionsForCourse$()))("valueId",s.finalGrade.finalGradeId)("gradeId",s.finalGrade.id)("disabled",c(2,6,e.isEditFinalGradesAllowed(s))===!1)}}function vr(i,n){if(i&1&&(o(0,"div"),m(1),d()),i&2){let s=u().$implicit;a(),h(" ",s.finalGrade.freeHandGrade," ")}}function _r(i,n){if(i&1&&(o(0,"td",23),E(1,"bkd-grade",24),l(2,"async"),d()),i&2){let s=n.$implicit,e=n.index,t=u(),r=t.$implicit,g=t.index,w=u(2);p("ngClass",w.selectedTest!==void 0&&s.test.Id===w.selectedTest.Id?"selected":""),a(),p("grade",s)("gradeOptions",c(2,5,w.state.gradingOptionsForTest$(s.test)))("student",r.student)("tabIndex",(1+e)*1e3+g)}}function xr(i,n){if(i&1&&(o(0,"tr")(1,"td",8)(2,"a",16)(3,"div"),m(4),d(),o(5,"div",10),m(6),l(7,"translate"),l(8,"decimalOrDash"),d()()(),o(9,"td",17),f(10,hr,3,8,"bkd-grade-select",18)(11,vr,2,1,"div",19),d(),o(12,"td",20),m(13),l(14,"decimalOrDash"),d(),f(15,_r,3,7,"td",21),d()),i&2){let s=n.$implicit,e=u(2);a(2),p("routerLink",O(18,gr,s.student.Id)),a(2),x(s.student.FullName),a(2),et(" ",c(7,10,"tests.mean"),": ",G(8,12,s.finalGrade==null?null:s.finalGrade.average,"1-3")," "),a(3),p("ngClass",O(20,zi,e.selectedTest===void 0)),a(),p("ngIf",s.finalGrade&&!s.finalGrade.freeHandGrade),a(),p("ngIf",s.finalGrade&&s.finalGrade.freeHandGrade),a(2),h(" ",G(14,15,s.finalGrade==null?null:s.finalGrade.average,"1-3")," "),a(2),p("ngForOf",s.grades)("ngForTrackBy",e.trackGradeOf(s.student))}}function br(i,n){if(i&1&&(o(0,"td",23),E(1,"bkd-average-grades",25),d()),i&2){let s=n.$implicit,e=u(2);p("ngClass",s.Id===(e.selectedTest==null?null:e.selectedTest.Id)||s.Id===(e.selectedTest==null?null:e.selectedTest.Id)?"selected":""),a(),p("test",s)}}function Cr(i,n){if(i&1){let s=M();o(0,"button",26),_("click",function(){I(s);let t=u(2);return T(t.setAverageAsFinalGrade())}),m(1),l(2,"translate"),d()}if(i&2){let s=u().bkdLet,e=u();p("ngClass",O(4,fr,!s.hasTests||!e.selectedTest)),a(),h(" ",c(2,2,"tests.set-final-grade")," ")}}function yr(i,n){if(i&1){let s=M();W(0),o(1,"div",3)(2,"table",4)(3,"thead",5,0),_("publish",function(t){I(s);let r=u();return T(r.publish(t))})("unpublish",function(t){I(s);let r=u();return T(r.unpublish(t))}),d(),o(5,"thead",6,1),_("publish",function(t){I(s);let r=u();return T(r.publish(t))})("unpublish",function(t){I(s);let r=u();return T(r.unpublish(t))}),d(),o(7,"tbody"),f(8,xr,16,22,"tr",7),o(9,"tr")(10,"td",8)(11,"div",9)(12,"div"),m(13),l(14,"translate"),d(),o(15,"div",10),m(16),l(17,"translate"),l(18,"async"),l(19,"decimalOrDash"),d()()(),o(20,"td",11),m(21),l(22,"async"),l(23,"decimalOrDash"),d(),o(24,"td",12),m(25),l(26,"async"),l(27,"decimalOrDash"),d(),f(28,br,2,2,"td",13),d()()(),o(29,"div",14),f(30,Cr,3,6,"button",15),l(31,"async"),d()(),z()}if(i&2){let s=n.bkdLet,e=A(4),t=A(6),r=u();a(2),p("inlineHeader",e)("stickyHeader",t),a(),p("selectedTest",r.selectedTest),a(2),p("sticky",!0)("selectedTest",r.selectedTest),a(3),p("ngForOf",s.studentGrades)("ngForTrackBy",r.trackStudentGrade),a(5),x(c(14,15,"tests.average")),a(3),et(" ",c(17,17,"tests.mean"),": ",G(19,21,c(18,19,r.state.meanOfStudentGradesForCourse$),"1-3")," "),a(4),p("ngClass",O(36,zi,r.selectedTest===void 0)),a(),h(" ",G(23,26,c(22,24,r.state.meanOfFinalGradesForCourse$),"1-3")," "),a(4),h(" ",G(27,31,c(26,29,r.state.meanOfStudentGradesForCourse$),"1-3")," "),a(3),p("ngForOf",s.tests),a(2),p("ngIf",c(31,34,r.state.canSetFinalGrade$))}}var qi=(()=>{let n=class n{constructor(e,t){this.state=e,this.modalService=t}ngOnInit(){this.state.setSorting({key:"FullName",ascending:!0})}setAverageAsFinalGrade(){this.state.course$.pipe(ne(1)).subscribe(e=>this.state.setAveragesAsFinalGrades({CourseIds:[e.Id]}))}isEditFinalGradesAllowed(e){return this.state.course$.pipe(b(t=>!!(Ye(t)?.value&&e.finalGrade?.canGrade)))}publish(e){let t=this.openModal(e);this.onCloseModal(t,()=>this.state.publish(e))}unpublish(e){let t=this.openModal(e);this.onCloseModal(t,()=>this.state.unpublish(e))}trackStudentGrade(e){return e}trackGradeOf(e){return function(t,r){return`${e.Id}_${r.test.Id}`}}calculatePointsAverage(e){return this.safeAverage(e,We)}calculateGradeAverage(e){return this.safeAverage(e,ze)}safeAverage(e,t){try{return t(e).toString()}catch{return"\u2013"}}openModal(e){let t=this.modalService.open(Ri);return t.componentInstance.test=e,t}onCloseModal(e,t){e.result.then(r=>{r&&t()},()=>{})}};n.\u0275fac=function(t){return new(t||n)(v(V),v(qe))},n.\u0275cmp=C({type:n,selectors:[["bkd-test-edit-grades"]],inputs:{selectedTest:"selectedTest"},standalone:!0,features:[pe([Te]),y],decls:4,vars:11,consts:[["inlineHeader",""],["stickyHeader",""],[4,"bkdLet"],[1,"table-responsive-wrapper"],["bkdTestEditGradesHeaderSticky","",1,"table","table-hover","h-100",3,"inlineHeader","stickyHeader"],["bkdTestEditGradesHeader","",3,"publish","unpublish","selectedTest"],["bkdTestEditGradesHeader","",3,"publish","unpublish","sticky","selectedTest"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"sticky","student-name"],[1,"d-flex","flex-column"],[1,"student-average-inline"],[1,"desktop","sticky","student-grade",3,"ngClass"],[1,"desktop","border-end","sticky","student-average"],["class","test-grade",3,"ngClass",4,"ngFor","ngForOf"],[1,"action-buttons"],["data-testId","apply-average-button","class","apply-average-button btn btn-primary m-3","type","button",3,"ngClass","click",4,"ngIf"],[3,"routerLink"],[1,"sticky","student-grade",3,"ngClass"],[3,"options","valueId","gradeId","disabled","gradeIdSelected",4,"ngIf"],[4,"ngIf"],[1,"border-end","sticky","student-average"],["class","test-grade",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[3,"gradeIdSelected","options","valueId","gradeId","disabled"],[1,"test-grade",3,"ngClass"],[3,"grade","gradeOptions","student","tabIndex"],[3,"test"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"click","ngClass"]],template:function(t,r){t&1&&(f(0,yr,32,38,"ng-container",2),l(1,"async"),l(2,"async"),l(3,"async")),t&2&&p("bkdLet",he(7,ur,c(1,1,r.state.filteredTests$),c(2,3,r.state.hasTests$),c(3,5,r.state.studentGrades$)))},dependencies:[Q,ae,ce,R,oe,Li,Bi,Di,j,P,k,Zt,Ai,Wi],styles:["[_nghost-%COMP%]{--student-name-column-width: 225px;--student-grade-column-width: 147px;--student-average-column-width: 100px;--test-grade-column-width: 300px;--point-input-size: 4em;--student-grade-column-offset: var(--student-name-column-width);--student-average-column-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) );--test-columns-offset: calc( var(--student-average-column-offset) + var(--student-average-column-width) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (min-width: 576px){[_nghost-%COMP%]{--point-input-size: 5em}}tr[_ngcontent-%COMP%]:not(.header-collapsible)   th.test-grade[_ngcontent-%COMP%]{width:calc(var(--point-input-size) + 13ch + 3rem)}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-average[_ngcontent-%COMP%], .test-grade[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex;width:100%}.student-name[_ngcontent-%COMP%]{flex:1;display:block}.test-grade[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}.student-average[_ngcontent-%COMP%]{width:var(--student-average-column-width);min-width:var(--student-average-column-width);max-width:var(--student-average-column-width)}.test-grade[_ngcontent-%COMP%]{min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}th.sticky.student-average[_ngcontent-%COMP%], td.sticky.student-average[_ngcontent-%COMP%]{left:var(--student-average-column-offset)}}@media (max-width: 1200px){[_nghost-%COMP%]{--student-average-column-width: 1px}.student-average[_ngcontent-%COMP%]{padding:0;overflow:hidden}}@media (min-width: 1201px){.student-average-inline[_ngcontent-%COMP%]{display:none}}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]{padding-right:0}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child{text-decoration:underline}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}.student-average-inline[_ngcontent-%COMP%]{color:#4e4e4ef2;font-size:.875rem;line-height:1}@media (min-width: 811px){.table-responsive-wrapper[_ngcontent-%COMP%]{display:block;overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.action-buttons[_ngcontent-%COMP%]{position:sticky;left:0}}@media (max-width: 810px){.apply-average-button[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]});let i=n;return i})();var Sr=()=>["/events"],Ir=i=>({count:i});function Tr(i,n){if(i&1&&(o(0,"div",8),m(1),l(2,"translate"),d()),i&2){let s=u();a(),h(" ",G(2,1,s.course.ParticipatingStudents.length===1?"courses.registration":"courses.registrations",O(4,Ir,s.course.ParticipatingStudents.length))," ")}}var Yi=(()=>{let n=class n{constructor(e){this.reportsService=e,this.course$=new L(null),this.reports$=this.course$.pipe(b(t=>t?.Id),K(),D(t=>t?this.reportsService.getCourseReports(t):Y([])),ct([]))}ngOnChanges(e){e.course&&this.course$.next(e.course.currentValue)}getDesignation(){return Ke(this.course)}};n.\u0275fac=function(t){return new(t||n)(v(ii))},n.\u0275cmp=C({type:n,selectors:[["bkd-tests-header"]],inputs:{course:"course"},standalone:!0,features:[fe,y],decls:12,vars:7,consts:[[3,"link"],[1,"d-flex"],["routerLink","add",1,"edit","btn","btn-primary","btn-icon","ms-2"],[1,"material-icons"],[1,"ms-2",3,"reports"],["id","excel-import"],[1,"d-flex","flex-column","header"],["class","additional-info",4,"ngIf"],[1,"additional-info"]],template:function(t,r){t&1&&(o(0,"bkd-backlink",0)(1,"div",1)(2,"a",2)(3,"i",3),m(4,"add"),d()(),E(5,"bkd-reports-link",4),l(6,"async"),E(7,"div",5),d()(),o(8,"div",6)(9,"h1"),m(10),d(),f(11,Tr,3,6,"div",7),d()),t&2&&(p("link",_t(6,Sr)),a(5),p("reports",c(6,4,r.reports$)),a(5),x(r.getDesignation()),a(),p("ngIf",r.course.ParticipatingStudents))},dependencies:[si,oe,Ut,R,j,P,k],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem;border-bottom:1px solid #dee2e6}h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"]});let i=n;return i})();var wr=(i,n,s,e,t,r)=>({course:i,tests:n,hasTests:s,testOptions:e,selectedTestId:t,selectedTest:r}),Er=i=>({"visible-on-mobile":i});function kr(i,n){if(i&1){let s=M();W(0),o(1,"bkd-select",7),_("valueChange",function(t){I(s);let r=u(3);return T(t&&r.testSelected(t))}),d(),E(2,"bkd-test-edit-grades",8),z()}if(i&2){let s=u(2).bkdLet;a(),p("options",s.testOptions)("value",s.selectedTestId)("allowEmpty",!1),a(),p("selectedTest",s.selectedTest)}}function Pr(i,n){if(i&1&&(o(0,"a",9),l(1,"async"),o(2,"i",10),m(3,"arrow_right_alt"),d(),o(4,"span",11),m(5),l(6,"translate"),d()()),i&2){let s=u(2).bkdLet,e=u();le("href",c(1,3,e.buildLinkToRatingOverview()),ke),p("ngClass",O(7,Er,!s.hasTests||!s.selectedTest)),a(5),x(c(6,5,"tests.link-to-rating-overview"))}}function Mr(i,n){if(i&1&&(W(0),E(1,"bkd-tests-header",5),f(2,kr,3,4,"ng-container",4)(3,Pr,7,9,"a",6),l(4,"async"),z()),i&2){let s=u().bkdLet,e=u(),t=A(9);a(),p("course",s.course),a(),p("ngIf",s.tests.length>0)("ngIfElse",t),a(),p("ngIf",c(4,4,e.state.canSetFinalGrade$))}}function Or(i,n){if(i&1&&(W(0),f(1,Mr,5,6,"ng-container",4),l(2,"async"),z()),i&2){let s=u(),e=A(11);a(),p("ngIf",c(2,2,s.state.loading$)===!1)("ngIfElse",e)}}function Gr(i,n){i&1&&(o(0,"p",12),m(1),l(2,"translate"),d()),i&2&&(a(),x(c(2,1,"tests.no-tests")))}function $r(i,n){i&1&&E(0,"bkd-spinner")}var Ki=(()=>{let n=class n{constructor(e,t,r){this.settings=e,this.state=t,this.translate=r,this.selectTest$=new ee,this.testOptions$=this.state.tests$.pipe(b(g=>[{Key:-1,Value:this.translate.instant("tests.grade")},...g.map(w=>({Key:w.Id,Value:w.Designation}))]),K()),this.selectedTestId$=Oe(this.selectTest$,this.state.tests$.pipe(ne(1),b(g=>g[0]?.Id))).pipe(K()),this.selectedTest$=this.selectedTestId$.pipe(D(g=>this.state.tests$.pipe(b(w=>w.find(S=>S.Id===g)))),K())}testSelected(e){this.selectTest$.next(e)}buildLinkToRatingOverview(){return this.state.course$.pipe(ne(1),b(e=>this.settings.eventlist.evaluation.replace(":id",String(e.Id))))}};n.\u0275fac=function(t){return new(t||n)(v(_e),v(V),v(ie))},n.\u0275cmp=C({type:n,selectors:[["bkd-tests-list"]],standalone:!0,features:[y],decls:12,vars:20,consts:[["noTests",""],["loading",""],[1,"bkd-container"],[4,"bkdLet"],[4,"ngIf","ngIfElse"],[3,"course"],["class","rating-overview d-flex justify-content-end pe-3 border-top pt-3",3,"ngClass","href",4,"ngIf"],["width","100%",1,"tests-dropdown",3,"valueChange","options","value","allowEmpty"],[3,"selectedTest"],[1,"rating-overview","d-flex","justify-content-end","pe-3","border-top","pt-3",3,"ngClass","href"],[1,"material-icons","fw-bold"],[1,"ps-1"],[1,"mt-3","px-3"]],template:function(t,r){t&1&&(o(0,"div",2),f(1,Or,3,4,"ng-container",3),l(2,"async"),l(3,"async"),l(4,"async"),l(5,"async"),l(6,"async"),l(7,"async"),f(8,Gr,3,3,"ng-template",null,0,se)(10,$r,1,0,"ng-template",null,1,se),d()),t&2&&(a(),p("bkdLet",xt(13,wr,c(2,1,r.state.course$),c(3,3,r.state.tests$),c(4,5,r.state.hasTests$),c(5,7,r.testOptions$),c(6,9,r.selectedTestId$),c(7,11,r.selectedTest$))))},dependencies:[Q,R,Yi,Ie,qi,ae,Se,j,P,k],styles:[".tests-dropdown[_ngcontent-%COMP%]{display:block;padding:1rem 0}@media (min-width: 811px){.tests-dropdown[_ngcontent-%COMP%]{display:none}}a.rating-overview[_ngcontent-%COMP%]{text-decoration:none}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}@media (max-width: 810px){a.rating-overview[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]});let i=n;return i})();var Xe=(()=>{let n=class n{constructor(e,t){this.state=e,this.route=t,this.courseId$=this.route.paramMap.pipe(b(r=>Number(r.get("id"))),K()),this.destroy$=new ee}ngOnInit(){this.courseId$.pipe(de(this.destroy$)).subscribe(e=>this.state.setCourseId(e))}ngOnDestroy(){this.destroy$.next()}};n.\u0275fac=function(t){return new(t||n)(v(V),v(ve))},n.\u0275cmp=C({type:n,selectors:[["bkd-tests"]],standalone:!0,features:[pe([V]),y],decls:1,vars:0,template:function(t,r){t&1&&E(0,"router-outlet")},dependencies:[Fe]});let i=n;return i})();var kd=[{path:"",component:xi,children:[{path:"",component:_i},{path:"current",component:vi},{path:":id",component:Xe,children:[{path:"tests",component:Ki}]},{path:":id/tests/:testId/edit",component:Xe,children:[{path:"",component:Fi}]},{path:":id/tests/add",component:Xe,children:[{path:"",component:Gi}]},{path:":id/tests",children:[ai]}]}];export{kd as EVENTS_ROUTES};
