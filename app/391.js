"use strict";(self.webpackChunkwebapp_schulverwaltung=self.webpackChunkwebapp_schulverwaltung||[]).push([[391],{3391:(Zt,J,l)=>{l.r(J),l.d(J,{EventsModule:()=>Sn});var Y=l(9121),v=l(5357),H=l(634),b=l(1135),C=l(9841),u=l(4004),S=l(8029),G=l(6478),y=l(5255);function N(n){const i=n.EvaluationStatusRef;if(!0===i.HasTestGrading)return A.Tests;if(!0===i.HasEvaluationStarted){if(null==i.EvaluationUntil)return A.IntermediateRating;if(i.EvaluationUntil>=new Date)return A.RatingUntil}return null}var t=l(5e3),Z=l(3900),P=l(9718),a=l(9928),p=l(5030),bt=l(803),Ct=l(8210);const it=a.dt({TestId:a.pk,CourseRegistrationId:a.pk,GradeId:a.pk,GradeValue:(0,p.Wx)(a.pk),GradeDesignation:a.Z_,Points:(0,p.Wx)(a.pk),StudentId:a.pk,Id:a.Z_}),At=a.dt({Id:a.pk,CourseId:a.pk,Date:p.L9,Designation:a.Z_,Weight:a.pk,WeightPercent:a.pk,IsPointGrading:a.O7,MaxPoints:(0,p.Wx)(a.pk),MaxPointsAdjusted:(0,p.Wx)(a.pk),IsPublished:a.O7,IsOwner:a.O7,Owner:(0,p.Wx)(a.Z_),Creation:a.Z_,GradingScaleId:a.pk,GradingScale:a.Z_,Results:(0,p.Wx)(a.IX(it))}),ot=a.dt({Id:a.pk}),at=a.r$({HRef:(0,p.Wx)(a.Z_)}),yt=a.r$({HasEvaluationStarted:a.O7,EvaluationUntil:(0,p.Wx)(p.L9),HasReviewOfEvaluationStarted:a.O7,HasTestGrading:a.O7,Id:a.pk}),It=a.jV([ot,at,yt]),Ot=a.r$({Id:a.pk,StudentCount:a.pk}),St=a.jV([ot,at,Ot]),R=a.dt({AverageTestResult:a.pk,CanGrade:a.O7,EventDesignation:a.Z_,EventId:a.pk,EventNumber:a.Z_,GradeComment:(0,p.Wx)(a.Z_),GradeId:(0,p.Wx)(a.pk),GradeValue:(0,p.Wx)(a.pk),Id:a.pk,StudentFullName:a.Z_,StudentId:a.pk,StudentMatriculationNumber:(0,p.Wx)(a.pk),StudentNameTooltip:a.Z_}),B=a.dt({HRef:a.Z_,Id:a.pk,Number:a.Z_,Designation:a.Z_,DateFrom:(0,p.Wx)(p.L9),DateTo:(0,p.Wx)(p.L9),StatusId:a.pk,GradingScaleId:a.pk,Gradings:(0,p.Wx)(a.IX(R)),Tests:(0,p.Wx)(a.IX(At)),EvaluationStatusRef:It,AttendanceRef:St,ParticipatingStudents:(0,p.Wx)(a.IX(bt.Z)),Classes:(0,p.Wx)(a.IX(Ct.y))}),Gt=(a.dt({StudentIds:a.IX(a.pk),TestId:a.pk,Points:(0,p.Wx)(a.pk)}),a.dt({StudentIds:a.IX(a.pk),TestId:a.pk,GradeId:(0,p.Wx)(a.pk)}),a.dt({TestResults:a.IX(it),Gradings:a.IX(R)})),Pt=a.dt({Gradings:a.IX(R)});var M=l(2786),W=l(2671),X=l(520);let $=(()=>{class n extends W.v{constructor(e,s){super(e,s,B,"Courses")}getExpandedCourses(){return this.http.get(`${this.baseUrl}/?expand=EvaluationStatusRef,AttendanceRef,Classes&filter.StatusId=;${this.settings.eventlist.statusfilter}`,{headers:{"X-Role-Restriction":"TeacherRole"}}).pipe((0,Z.w)((0,M.Y0)(B)))}getExpandedCourse(e){return this.http.get(`${this.baseUrl}/${e}?expand=ParticipatingStudents,EvaluationStatusRef,Tests,Gradings,FinalGrades,Classes`).pipe((0,Z.w)((0,M.Jx)(B)))}add(e,s,o,r,d,c,_){return this.http.put(`${this.baseUrl}/${e}/Tests/New`,{Tests:[{Date:s,Designation:o,Weight:r,IsPointGrading:d,MaxPoints:c,MaxPointsAdjusted:_}]}).pipe((0,P.h)(void 0))}update(e,s,o,r,d,c,_,h){return this.http.put(`${this.baseUrl}/${e}/Tests/Update`,{Tests:[{Id:s,Designation:o,Date:r,Weight:d,IsPointGrading:c,MaxPoints:_,MaxPointsAdjusted:h}]}).pipe((0,P.h)(void 0))}delete(e,s){return this.http.put(`${this.baseUrl}/${e}/Tests/Delete`,{TestIds:[s]}).pipe((0,P.h)(void 0))}updateTestResult(e,s){return this.http.put(`${this.baseUrl}/${e.Id}/SetTestResult`,s).pipe((0,Z.w)((0,M.Jx)(Gt)))}setAverageAsFinalGrade(e){return this.http.put(`${this.baseUrl}/SetAverageTestResult`,e).pipe((0,Z.w)((0,M.Jx)(Pt)))}publishTest(e){return this.http.put(`${this.baseUrl}/PublishTest`,{TestIds:[e]}).pipe((0,P.h)(e))}unpublishTest(e){return this.http.put(`${this.baseUrl}/UnpublishTest`,{TestIds:[e]}).pipe((0,P.h)(e))}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(X.eN),t.LFG(S.L))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var $t=l(7283),rt=l(2024),Lt=l(1303),f=l(8995),A=(()=>{return(n=A||(A={})).Rating="rating",n.RatingUntil="rating-until",n.IntermediateRating="intermediate-rating",n.Tests="add-tests",A;var n})();let K=(()=>{class n{constructor(e,s,o,r,d,c){this.coursesRestService=e,this.studyClassRestService=s,this.loadingService=o,this.storage=r,this.translate=d,this.settings=c,this.loading$=this.loadingService.loading$,this.search$=new b.X(""),this.courses$=this.coursesRestService.getExpandedCourses(),this.formativeAssessments$=this.studyClassRestService.getActiveFormativeAssessments(),this.studyClasses$=this.studyClassRestService.getActive(),this.events$=this.loadEvents(),this.filteredEvents$=(0,C.a)([this.events$,this.search$]).pipe((0,u.U)((0,G.h)(y.P)))}loadEvents(){return this.loadingService.load(this.hasClassTeacherRole()?(0,C.a)([this.courses$,this.formativeAssessments$,this.studyClasses$]).pipe((0,u.U)((0,G.h)(this.createAndSortEvents.bind(this)))):this.courses$.pipe((0,u.U)(e=>this.createAndSortEvents(e))))}createAndSortEvents(e,s=[],o=[]){const r=o.filter(d=>!s.map(c=>c.Id).includes(d.Id));return[...this.createFromCourses(e),...this.createFromAssessments(s),...this.createFromStudyClasses(r)].sort((d,c)=>d.Designation.localeCompare(c.Designation))}createFromStudyClasses(e){return e.map(s=>({id:s.Id,Designation:s.Number,detailLink:this.buildLink(s.Id,"eventdetail"),studentCount:s.StudentCount,state:null}))}createFromAssessments(e){return this.createFromStudyClasses(e).map(o=>Object.assign(Object.assign({},o),{state:A.Rating,evaluationText:this.translate.instant("events.state.rating"),evaluationLink:this.buildLink(o.id,"evaluation")}))}createFromCourses(e){return e.map(s=>{const o=N(s);return{id:s.Id,Designation:this.getDesignation(s),detailLink:this.buildLink(s.Id,"eventdetail"),studentCount:s.AttendanceRef.StudentCount||0,dateFrom:s.DateFrom,dateTo:s.DateTo,state:o,evaluationText:this.getEvaluationText(o,s.EvaluationStatusRef.EvaluationUntil),evaluationLink:this.getEvaluationLink(s,o)}})}getDesignation(e){const s=e.Classes?e.Classes.map(o=>o.Number).join(", "):null;return s?e.Designation+", "+s:e.Designation}getEvaluationText(e,s){return null===e?"":this.translate.instant(`events.state.${e}`)+(e===A.RatingUntil?` ${s?(0,H.Z)(s,"dd.MM.yyyy"):""}`:"")}getEvaluationLink(e,s){return null===s||s===A.Tests?null:this.buildLink(e.Id,"evaluation")}buildLink(e,s){return`${this.settings.eventlist[s]}=${e}`}hasClassTeacherRole(){const e=this.storage.getPayload();return!!e&&e.roles.indexOf("ClassTeacherRole")>=0}}return n.\u0275fac=function(e){return new(e||n)(t.LFG($),t.LFG($t.R),t.LFG(rt.b),t.LFG(Lt.V),t.LFG(f.sK),t.LFG(S.L))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})(),qt=(()=>{class n{constructor(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-events"]],features:[t._Bn([K])],decls:1,vars:0,template:function(e,s){1&e&&t._UZ(0,"router-outlet")},directives:[v.lC],styles:[""]}),n})(),j=(()=>{class n{constructor(e,s){this.coursesRestService=e,this.loadingService=s,this.loading$=this.loadingService.loading$}getCourse(e){return this.loadingService.load(this.coursesRestService.getExpandedCourse(e))}}return n.\u0275fac=function(e){return new(e||n)(t.LFG($),t.LFG(rt.b))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})(),Et=(()=>{class n{constructor(e){this.state=e}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(j))},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-tests"]],features:[t._Bn([j])],decls:1,vars:0,template:function(e,s){1&e&&t._UZ(0,"router-outlet")},directives:[v.lC],styles:[""]}),n})();var k=l(7579),z=l(4782),Mt=l(6451),I=l(1884),L=l(1104),g=l(9808),kt=l(6401);const wt=function(n){return{count:n}};function Ft(n,i){if(1&n&&(t.TgZ(0,"div",9),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",t.xi3(2,1,1===e.course.ParticipatingStudents.length?"courses.registration":"courses.registrations",t.VKq(4,wt,e.course.ParticipatingStudents.length))," ")}}const Ut=function(){return["/events"]};let Jt=(()=>{class n{constructor(e){this.reportsService=e}loadReportUrl(){return this.reportsService.getEventReportUrl(this.course.Id)}getDesignation(){return this.course.Designation+this.getClassDesignation()}getClassDesignation(){return this.course.Classes?`, ${this.course.Classes[0].Designation}`:""}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(kt.F))},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-tests-header"]],inputs:{course:"course"},decls:16,vars:5,consts:[[1,"d-flex","align-items-center","justify-content-between","header"],["type","button",1,"back","btn","btn-link","py-0","px-0",3,"routerLink"],[1,"d-flex"],[1,"material-icons","btn"],[1,"text-justify"],["class","font-color-light-gray",4,"ngIf"],["routerLink","add",1,"edit","btn","btn-primary","ml-2"],[1,"material-icons"],["target","_blank",1,"edit","btn","btn-primary","ml-2",3,"href"],[1,"font-color-light-gray"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"button",1),t.TgZ(2,"div",2),t.TgZ(3,"i",3),t._uU(4,"navigate_before"),t.qZA(),t.TgZ(5,"div",4),t.TgZ(6,"div"),t._uU(7),t.qZA(),t.YNc(8,Ft,3,6,"div",5),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"div",2),t.TgZ(10,"a",6),t.TgZ(11,"i",7),t._uU(12,"add"),t.qZA(),t.qZA(),t.TgZ(13,"a",8),t.TgZ(14,"i",7),t._uU(15,"description"),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(1),t.Q6J("routerLink",t.DdM(4,Ut)),t.xp6(6),t.hij(" ",s.getDesignation()," "),t.xp6(1),t.Q6J("ngIf",s.course.ParticipatingStudents),t.xp6(5),t.Q6J("href",s.loadReportUrl(),t.LSH))},directives:[v.rH,g.O5,v.yS],pipes:[f.X$],styles:[".back[_ngcontent-%COMP%]{color:#33333d;text-decoration:none}.font-color-light-gray[_ngcontent-%COMP%]{color:#adb5bd}.header[_ngcontent-%COMP%]{padding-bottom:1.5rem;border-bottom:1px solid #e9ecef}@media (max-width: 750px){.header[_ngcontent-%COMP%]{padding-right:1.5rem}}"]}),n})();var V=l(9092),O=l(1504);const Nt=function(n){return{designation:n}};let Rt=(()=>{class n{constructor(e){this.activeModal=e}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(O.Kz))},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-publish-test"]],inputs:{test:"test"},decls:11,vars:12,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-secondary",3,"click"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"p",1),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA(),t.TgZ(4,"div",2),t.TgZ(5,"button",3),t.NdJ("click",function(){return s.activeModal.dismiss()}),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"button",4),t.NdJ("click",function(){return s.activeModal.close(!0)}),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.hij(" ",t.xi3(3,3,s.test.IsPublished?"tests.publishing.unpublish":"tests.publishing.publish",t.VKq(10,Nt,s.test.Designation))," "),t.xp6(4),t.hij(" ",t.lcZ(7,6,"tests.publishing.cancel")," "),t.xp6(3),t.hij(" ",t.lcZ(10,8,"tests.publishing.confirm")," "))},pipes:[f.X$],encapsulation:2}),n})();function D(n){return Number(function jt(n){return n.reduce(zt,0)}(n)/n.length)}function zt(n,i){return n+i}function dt(n){const i=function Bt(n){var i;return(null===(i=n.Results)||void 0===i?void 0:i.map(e=>null!==e.Points?e.Points:ct).filter(e=>e>ct))||[]}(n);if(0===i.length)throw new Error("unable to calculate averages without results");return D(i)}function lt(n){const i=function Ht(n){var i;return(null===(i=n.Results)||void 0===i?void 0:i.filter(e=>null!==e.GradeDesignation).map(e=>Number(e.GradeDesignation)).filter(e=>!isNaN(e)))||[]}(n);if(0===i.length)throw new Error("unable to calculate averages without results");return D(i)}const ct=-1;var Wt=l(4707),Xt=l(5026),Kt=l(4128),Vt=l(5698);function ee(n,i){return i.map(e=>{var s,o;if(void 0===e.Results||0===(null===(s=e.Results)||void 0===s?void 0:s.length))return{kind:"no-result",test:e};const r=null===(o=e.Results)||void 0===o?void 0:o.find(d=>d.StudentId===n.Id);return void 0!==r?{kind:"grade",result:r,test:e}:{kind:"no-result",test:e}})}function ne(n,i){const e=i.find(s=>s.StudentId===n.Id);return{id:null==e?void 0:e.Id,average:se(e),finalGradeId:null==e?void 0:e.GradeId,canGrade:(null==e?void 0:e.CanGrade)||!1}}function se(n){return void 0===n||0===n.AverageTestResult?null:n.AverageTestResult}function ut(n){return"grade"===n.kind}function pt(n){return(null==n?void 0:n.test.MaxPointsAdjusted)||(null==n?void 0:n.test.MaxPoints)}var de=l(4379);const le=a.dt({Id:a.pk,IdGradingScale:a.pk,Designation:a.Z_,Value:a.pk,Sufficient:a.O7,Sort:a.Z_,IdObject:a.pk,HRef:(0,p.Wx)(a.Z_)}),gt=a.dt({Id:a.pk,Designation:a.Z_,MinGrade:a.pk,MaxGrade:a.pk,CommentsAllowed:a.O7,LowestSufficientGrade:a.pk,RisingGrades:a.O7,Grades:a.IX(le),IdObject:a.pk,FreeGrading:a.O7,HRef:a.Z_});let ce=(()=>{class n extends W.v{constructor(e,s){super(e,s,gt,"GradingScales")}getGradingScale(e){return this.http.get(`${this.baseUrl}/${e}`).pipe((0,Z.w)((0,M.Jx)(gt)))}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(X.eN),t.LFG(S.L))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),ue=(()=>{class n extends W.v{constructor(e,s){super(e,s,R,"Gradings")}updateGrade(e,s){return this.http.put(`${this.baseUrl}/${e}`,{GradeId:s}).pipe((0,P.h)(e))}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(X.eN),t.LFG(S.L))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),mt=(()=>{class n{constructor(e,s,o,r){this.sortService=e,this.courseRestService=s,this.gradingScalesRestService=o,this.gradingsRestService=r,this.action$=new Wt.t(1),this.tests$=this.action$.pipe((0,Xt.R)((d,c)=>{switch(c.type){case"updateResult":return function Dt(n,i){return i.map(e=>e.Id===n.TestId?function Yt(n,i){var e;const s=(null===(e=i.Results)||void 0===e?void 0:e.filter(o=>n.Id!==o.Id))||[];return Object.assign(Object.assign({},i),{Results:[...s,n]})}(n,e):e)}(c.payload,d);case"reset":return c.payload;case"toggle-test-state":return function Qt(n,i){return i.map(e=>e.Id===n?Object.assign(Object.assign({},e),{IsPublished:!e.IsPublished}):e)}(c.payload,d);default:return d}},[])),this.filter$=new b.X("all-tests"),this.expandedHeader$=new b.X(!1),this.filteredTests$=(0,C.a)([this.tests$,this.filter$]).pipe((0,u.U)(([d,c])=>d.filter(_=>"all-tests"===c||_.IsOwner))),this.sorting$=this.sortService.sorting$,this.studentGrades$=(0,C.a)([this.filteredTests$,this.sorting$]).pipe((0,u.U)((0,G.h)(this.toStudentGrades.bind(this)))),this.gradingScaleIds$=this.tests$.pipe((0,Vt.q)(1),(0,u.U)(d=>[...d.map(c=>c.GradingScaleId),this.course.GradingScaleId].filter((c,_,h)=>h.indexOf(c)===_))),this.gradingScales$=this.gradingScaleIds$.pipe((0,Z.w)(d=>(0,Kt.D)(d.map(c=>this.gradingScalesRestService.getGradingScale(c)))),(0,z.d)(1)),this.gradingScalesOptions$=this.gradingScales$.pipe((0,u.U)(d=>d.map(c=>({id:c.Id,options:c.Grades.map(_=>({Key:_.Id,Value:_.Designation}))})).reduce((c,_)=>Object.assign(Object.assign({},c),{[_.id]:_.options}),{})),(0,z.d)(1)),this.meanOfStudentGradesForCourse$=this.studentGrades$.pipe((0,u.U)(d=>function ae(n){return D(n.map(e=>e.average).filter(e=>null!=e&&0!==e).map(Number))}(d.map(c=>c.finalGrade)))),this.meanOfFinalGradesForCourse$=(0,C.a)([this.gradingScalesOptions$,this.studentGrades$]).pipe((0,u.U)((0,G.h)(this.meanOfOverwrittenGradesForCourse.bind(this))))}gradingOptionsForTest$(e){return this.gradingOptions$(e.GradingScaleId)}gradingOptionsForCourse$(){return this.gradingOptions$(this.course.GradingScaleId)}setTests(e){this.action$.next({type:"reset",payload:e})}toStudentGrades(e=[],s){var o,r;return function te(n,i,e){return null==n?void 0:n.map(s=>({student:s,finalGrade:ne(s,e),grades:ee(s,i)}))}(null!==(o=this.course.ParticipatingStudents)&&void 0!==o?o:[],e,null!==(r=this.course.Gradings)&&void 0!==r?r:[]).sort((({key:n,ascending:i})=>(e,s)=>{const o=i?1:-1;return"FullName"===n?o*e.student.FullName.localeCompare(s.student.FullName):o*((n,i,e)=>{var s,o,r,d,c,_,h,x,U,nt;const q=i.grades.filter(ut).find(st=>st.test.Id===n.Id),E=e.grades.filter(ut).find(st=>st.test.Id===n.Id);return n.IsPointGrading?(null!==(o=null===(s=null==E?void 0:E.result)||void 0===s?void 0:s.Points)&&void 0!==o?o:0)-(null!==(d=null===(r=null==q?void 0:q.result)||void 0===r?void 0:r.Points)&&void 0!==d?d:0):(null!==(h=null===(_=null===(c=null==E?void 0:E.result)||void 0===c?void 0:c.GradeValue)||void 0===_?void 0:_.valueOf())&&void 0!==h?h:0)-(null!==(nt=null===(U=null===(x=null==q?void 0:q.result)||void 0===x?void 0:x.GradeValue)||void 0===U?void 0:U.valueOf())&&void 0!==nt?nt:0)})(n,e,s)})(s))}setSorting(e){this.sortService.setSorting(e)}getSortingChar$(e){return this.sortService.getSortingChar$(e)}sortBy(e){this.sortService.toggleSorting(e)}toggleHeader(e){this.expandedHeader$.next(e)}saveGrade(e){this.courseRestService.updateTestResult(this.course,e).subscribe(s=>this.updateStudentGrades(s))}publish(e){this.courseRestService.publishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}unpublish(e){this.courseRestService.unpublishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}overwriteFinalGrade({id:e,selectedGradeId:s}){this.gradingsRestService.updateGrade(e,s).subscribe(()=>{})}updateStudentGrades(e){this.action$.next({type:"updateResult",payload:e.TestResults[0]})}toggleTestPublishedState(e){this.action$.next({type:"toggle-test-state",payload:e})}gradingOptions$(e){return this.gradingScalesOptions$.pipe((0,u.U)(s=>s[e]),(0,z.d)(1))}meanOfOverwrittenGradesForCourse(e,s){if(void 0===e[this.course.GradingScaleId])return"";const o=e[this.course.GradingScaleId];return function re(n,i){return D(n.map(s=>s.finalGradeId).filter(s=>null!==s).map(s=>i.find(o=>o.Key===s)).filter(s=>void 0!==s).map(s=>null==s?void 0:s.Value).filter(s=>void 0!==s).map(Number).filter(s=>!isNaN(s)))}(s.map(d=>d.finalGrade),o)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(de.K),t.LFG($),t.LFG(ce),t.LFG(ue))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var pe=l(5149);let ge=(()=>{class n{constructor(e){this.translate=e}transform(e){return`${e.Weight} (${e.WeightPercent}%)${this.getPoints(e)}`}getPoints(e){var s;return e.IsPointGrading?`, ${null!==(s=e.MaxPointsAdjusted)&&void 0!==s?s:e.MaxPoints} ${this.translate.instant("tests.points")}`:""}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(f.sK,16))},n.\u0275pipe=t.Yjl({name:"testSummaryShort",type:n,pure:!0}),n})();function me(n,i){1&n&&(t.TgZ(0,"i",12),t._uU(1,"edit"),t.qZA())}const _e=function(n){return[n,"edit"]};function he(n,i){if(1&n&&(t.TgZ(0,"div",8),t.TgZ(1,"div",9),t.TgZ(2,"erz-preserve-line-height"),t._uU(3),t.ALo(4,"date"),t.qZA(),t.TgZ(5,"a",10),t.YNc(6,me,2,0,"i",11),t.qZA(),t.qZA(),t.TgZ(7,"erz-preserve-line-height"),t._uU(8),t.ALo(9,"testSummaryShort"),t.qZA(),t.TgZ(10,"erz-preserve-line-height"),t._uU(11),t.qZA(),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.Oqu(t.xi3(4,5,e.test.Date,"dd.MM.yyyy")),t.xp6(2),t.Q6J("routerLink",t.VKq(10,_e,e.test.Id)),t.xp6(1),t.Q6J("ngIf",e.test.IsOwner&&!1===e.test.IsPublished),t.xp6(2),t.hij(" ",t.lcZ(9,8,e.test)," "),t.xp6(3),t.Oqu(e.test.Owner)}}function ve(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"div",13),t.TgZ(1,"a",14),t.NdJ("click",function(){return t.CHM(e),t.oxw().unpublishTest()}),t.ALo(2,"translate"),t.TgZ(3,"i",15),t._uU(4,"lock"),t.qZA(),t.TgZ(5,"span"),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.qZA(),t.TgZ(8,"i",16),t.NdJ("click",function(){return t.CHM(e),t.oxw().toggleHeader()}),t._uU(9),t.qZA(),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.s9C("title",t.lcZ(2,3,"tests.edit")),t.xp6(5),t.Oqu(t.lcZ(7,5,"tests.published")),t.xp6(3),t.Oqu(e.expanded?"expand_more":"expand_less")}}function fe(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"div",13),t.TgZ(1,"a",17),t.NdJ("click",function(){return t.CHM(e),t.oxw().publishTest()}),t.ALo(2,"translate"),t.TgZ(3,"i",15),t._uU(4,"lock_open"),t.qZA(),t.TgZ(5,"span"),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.qZA(),t.TgZ(8,"i",18),t.NdJ("click",function(){return t.CHM(e),t.oxw().toggleHeader()}),t._uU(9),t.qZA(),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.s9C("title",t.lcZ(2,3,"tests.publish")),t.xp6(5),t.Oqu(t.lcZ(7,5,"tests.not-published")),t.xp6(3),t.Oqu(e.expanded?"expand_more":"expand_less")}}let xe=(()=>{class n{constructor(){this.toggle=new t.vpe,this.publish=new t.vpe,this.unpublish=new t.vpe}toggleHeader(){this.toggle.emit(!this.expanded)}publishTest(){this.publish.emit(this.test)}unpublishTest(){this.unpublish.emit(this.test)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-test-table-header"]],inputs:{test:"test",expanded:"expanded"},outputs:{toggle:"toggle",publish:"publish",unpublish:"unpublish"},decls:11,vars:6,consts:[[1,"d-flex","flex-column","h-100","justify-content-between"],["role","button",1,"test-designation","d-flex","flex-row","my-3","align-items-end","justify-content-between",3,"click"],[3,"ngClass"],[1,"material-icons","align-self-start"],[1,"d-flex","flex-column"],["class","d-flex flex-column mb-3",4,"ngIf"],["class","d-flex align-items-center justify-content-between test-status",4,"ngIf","ngIfElse"],["notPublished",""],[1,"d-flex","flex-column","mb-3"],[1,"d-flex","flex-row","justify-content-between"],[1,"btn","btn-link","p-0","edit",3,"routerLink"],["class","material-icons",4,"ngIf"],[1,"material-icons"],[1,"d-flex","align-items-center","justify-content-between","test-status"],[1,"d-flex","btn","btn-link","pl-0","edit",3,"title","click"],[1,"material-icons","mr-1"],["role","button",1,"material-icons","expand-mobile",3,"click"],[1,"d-flex","btn","btn-link","pl-0",3,"title","click"],[1,"material-icons","expand-mobile",3,"click"]],template:function(e,s){if(1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.NdJ("click",function(){return s.toggleHeader()}),t.TgZ(2,"div",2),t._uU(3),t.qZA(),t.TgZ(4,"i",3),t._uU(5),t.qZA(),t.qZA(),t.TgZ(6,"div",4),t.YNc(7,he,12,12,"div",5),t.YNc(8,ve,10,7,"div",6),t.YNc(9,fe,10,7,"ng-template",null,7,t.W1O),t.qZA(),t.qZA()),2&e){const o=t.MAs(10);t.xp6(2),t.Q6J("ngClass",s.expanded?"expanded":"collapsed"),t.xp6(1),t.hij(" ",s.test.Designation," "),t.xp6(2),t.Oqu(s.expanded?"expand_more":"expand_less"),t.xp6(2),t.Q6J("ngIf",s.expanded),t.xp6(1),t.Q6J("ngIf",s.test.IsPublished)("ngIfElse",o)}},directives:[g.mk,g.O5,pe.r,v.yS],pipes:[g.uU,ge,f.X$],styles:[".collapsed[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.test-designation[_ngcontent-%COMP%]{display:none!important}.test-status[_ngcontent-%COMP%]{order:-1;padding-bottom:1.5rem}.edit[_ngcontent-%COMP%]{color:#33333d80}@media (min-width: 750px){.test-designation[_ngcontent-%COMP%]{display:inherit!important}.test-status[_ngcontent-%COMP%]{order:initial}.expand-mobile[_ngcontent-%COMP%]{display:none!important}}"]}),n})(),Te=(()=>{class n{constructor(){this.disabled=!1,this.gradeIdSelected=new t.vpe}onGradeChange(e){var s,o;void 0!==(null===(s=this.gradeId)||void 0===s?void 0:s.valueOf())&&this.gradeIdSelected.emit({id:null===(o=this.gradeId)||void 0===o?void 0:o.valueOf(),selectedGradeId:e})}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-grade-select"]],inputs:{options:"options",valueId:"valueId",gradeId:"gradeId",disabled:"disabled"},outputs:{gradeIdSelected:"gradeIdSelected"},decls:1,vars:4,consts:[["data-testid","grade-select",3,"options","allowEmpty","value","disabled","valueChange"]],template:function(e,s){1&e&&(t.TgZ(0,"erz-select",0),t.NdJ("valueChange",function(r){return s.onGradeChange(r)}),t.qZA()),2&e&&t.Q6J("options",s.options)("allowEmpty",!0)("value",s.valueId)("disabled",s.disabled)},directives:[V.H],styles:["[_nghost-%COMP%]     select{min-width:13ch}"]}),n})();var m=l(3075),_t=l(8372),Ze=l(9300),tt=l(2722);function be(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"div",5),t.TgZ(1,"input",6,7),t.NdJ("input",function(){t.CHM(e);const o=t.MAs(2);return t.oxw().onPointsChange(o.value)}),t.qZA(),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.s9C("max",e.maxPoints),t.s9C("tabindex",e.tabIndex),t.Q6J("formControl",e.pointsInput)}}const Ce=function(n){return{maxPoints:n}};function Ae(n,i){if(1&n&&(t.TgZ(0,"div",8),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",t.xi3(2,1,"global.validation-errors.invalidPoints",t.VKq(4,Ce,e.maxPoints))," ")}}let ye=(()=>{class n{constructor(e){this.state=e,this.gradeChanged=new t.vpe,this.pointsInput=new m.NI({value:"",disabled:!1},[m.kI.min(0),m.kI.pattern("[0-9]+([\\.][0-9]+)?"),this.maxPointValidator()]),this.maxPoints=0,this.pointsSubject$=new k.x,this.gradeSubject$=new k.x,this.gradingScaleDisabledSubject$=new b.X(!0),this.gradingScaleDisabled$=this.gradingScaleDisabledSubject$.asObservable(),this.points$=this.pointsSubject$.pipe((0,_t.b)(500),(0,Ze.h)(this.isValid.bind(this)),(0,u.U)(Number)),this.grade$=this.gradeSubject$.pipe((0,_t.b)(500)),this.destroy$=new k.x}ngOnInit(){"grade"===this.grade.kind&&this.pointsInput.setValue(this.grade.result.Points),this.gradingScaleDisabledSubject$.next(this.disableGradingScale()),this.maxPoints=pt(this.grade),this.points$.pipe((0,tt.R)(this.destroy$),(0,u.U)(this.buildRequestBodyPointsChange.bind(this))).subscribe(e=>this.gradeChanged.emit(e)),this.grade$.pipe((0,tt.R)(this.destroy$),(0,u.U)(this.buildRuequestBodyForGradeChange.bind(this))).subscribe(e=>this.gradeChanged.emit(e))}ngOnDestroy(){this.destroy$.next()}onPointsChange(e){this.pointsSubject$.next(e),this.gradingScaleDisabledSubject$.next(e.length>0)}onGradeChange(e){this.gradeSubject$.next(e)}maxPointValidator(){return e=>Number(e.value)>pt(this.grade)?{customMax:!0}:null}isValid(e){return""!==e&&!isNaN(Number(e))&&!(Number(e)<0||Number(e)>this.maxPoints)}buildRequestBodyPointsChange(e){return{StudentIds:[this.student.Id],TestId:this.grade.test.Id,Points:e}}buildRuequestBodyForGradeChange(e){return{StudentIds:[this.student.Id],TestId:this.grade.test.Id,GradeId:e}}disableGradingScale(){return"no-result"!==this.grade.kind&&null!=this.grade.result.Points&&this.grade.test.IsPointGrading}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(mt))},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-grade"]],inputs:{grade:"grade",student:"student",tabIndex:"tabIndex",gradeOptions:"gradeOptions"},outputs:{gradeChanged:"gradeChanged"},decls:6,vars:11,consts:[[1,"d-flex","flex-column","w-100"],[1,"d-flex","flex-row"],["class","point-input-container mr-3",4,"ngIf"],["data-testid","grade-select",1,"grade-select",3,"options","allowEmpty","value","disabled","tabindex","valueChange"],["class","invalid-feedback","data-testid","validation-error-message",4,"ngIf"],[1,"point-input-container","mr-3"],["type","number","step","0.01","min","0","data-testid","point-input",1,"form-control",3,"max","tabindex","formControl","input"],["pointInput",""],["data-testid","validation-error-message",1,"invalid-feedback"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.YNc(2,be,3,3,"div",2),t.TgZ(3,"erz-select",3),t.NdJ("valueChange",function(r){return s.onGradeChange(r)}),t.ALo(4,"async"),t.qZA(),t.qZA(),t.YNc(5,Ae,3,6,"div",4),t.qZA()),2&e&&(t.xp6(1),t.ekj("is-invalid",s.pointsInput.errors),t.xp6(1),t.Q6J("ngIf",s.grade.test.IsPointGrading),t.xp6(1),t.Q6J("options",s.gradeOptions)("allowEmpty","no-result"===s.grade.kind)("value","grade"===s.grade.kind?s.grade.result.GradeId:null)("disabled",t.lcZ(4,9,s.gradingScaleDisabled$))("tabindex",s.tabIndex),t.xp6(2),t.Q6J("ngIf",s.pointsInput.errors))},directives:[g.O5,m.qQ,m.Fd,m.wV,m.Fj,m.JJ,m.oH,V.H],pipes:[g.Ov,f.X$],styles:[".point-input-container[_ngcontent-%COMP%]{width:5em}[_nghost-%COMP%]     select{min-width:13ch}"]}),n})();function Ie(n,i){if(1&n&&(t.TgZ(0,"span",3),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Oqu(e.calculatePointsAverage(e.test))}}let Oe=(()=>{class n{constructor(){}calculatePointsAverage(e){return this.safeAverage(e,2,dt)}calculateGradeAverage(e){return this.safeAverage(e,3,lt)}safeAverage(e,s,o){try{return o(e).toFixed(s).toString()}catch(r){return"-"}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-average-grades"]],inputs:{test:"test"},decls:4,vars:2,consts:[[1,"d-flex","flex-row","w-100"],["class","mr-3 average-points","data-testid","average-points",4,"ngIf"],["data-testid","average-grade"],["data-testid","average-points",1,"mr-3","average-points"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0),t.YNc(1,Ie,2,1,"span",1),t.TgZ(2,"span",2),t._uU(3),t.qZA(),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",s.test.IsPointGrading),t.xp6(2),t.Oqu(s.calculateGradeAverage(s.test)))},directives:[g.O5],styles:[".average-points[_ngcontent-%COMP%]{min-width:9ch}"]}),n})();function Se(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"th",26),t.TgZ(1,"erz-test-table-header",27),t.NdJ("toggle",function(o){return t.CHM(e),t.oxw(2).state.toggleHeader(o)})("publish",function(o){return t.CHM(e),t.oxw(2).publish(o)})("unpublish",function(o){return t.CHM(e),t.oxw(2).unpublish(o)}),t.qZA(),t.qZA()}if(2&n){const e=i.$implicit,s=t.oxw().erzLet,o=t.oxw();t.Q6J("ngClass",e.Id===(null==o.selectedTest?null:o.selectedTest.Id)?"selected":""),t.xp6(1),t.Q6J("test",e)("expanded",s.expanded)}}function Ge(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"th",28),t.TgZ(1,"erz-test-table-header",27),t.NdJ("toggle",function(o){return t.CHM(e),t.oxw(2).state.toggleHeader(o)})("publish",function(o){return t.CHM(e),t.oxw(2).publish(o)})("unpublish",function(o){return t.CHM(e),t.oxw(2).unpublish(o)}),t.qZA(),t.qZA()}if(2&n){const e=i.$implicit,s=t.oxw().erzLet,o=t.oxw();t.Q6J("ngClass",e.Id===(null==o.selectedTest?null:o.selectedTest.Id)?"selected":""),t.xp6(1),t.Q6J("test",e)("expanded",s.expanded)}}function Pe(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"div",32),t.TgZ(1,"span",31),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw(2).state.sortBy(o)}),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA()}2&n&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"tests.points")))}function $e(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"th",29),t.TgZ(1,"div",11),t.YNc(2,Pe,4,3,"div",30),t.TgZ(3,"div",12),t.TgZ(4,"span",31),t.NdJ("click",function(){const r=t.CHM(e).$implicit;return t.oxw(2).state.sortBy(r)}),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.qZA(),t.TgZ(7,"div",13),t._uU(8),t.ALo(9,"async"),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=i.$implicit,s=t.oxw(2);t.Q6J("ngClass",e.Id===(null==s.selectedTest?null:s.selectedTest.Id)?"selected":""),t.xp6(2),t.Q6J("ngIf",e.IsPointGrading),t.xp6(3),t.Oqu(t.lcZ(6,4,"tests.grade")),t.xp6(3),t.hij(" ",t.lcZ(9,6,s.state.getSortingChar$(e))," ")}}function Le(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"td",40),t.TgZ(1,"erz-grade",41),t.NdJ("gradeChanged",function(o){return t.CHM(e),t.oxw(3).saveGrade(o)}),t.ALo(2,"async"),t.qZA(),t.qZA()}if(2&n){const e=i.$implicit,s=i.index,o=t.oxw(),r=o.$implicit,d=o.index,c=t.oxw(2);t.Q6J("ngClass",void 0!==c.selectedTest&&e.test.Id===(null==c.selectedTest?null:c.selectedTest.Id)?"selected":""),t.xp6(1),t.Q6J("grade",e)("gradeOptions",t.lcZ(2,5,c.state.gradingOptionsForTest$(e.test)))("student",r.student)("tabIndex",1e3*(1+s)+d)}}const Q=function(n){return{selected:n}};function qe(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"tr"),t.TgZ(1,"td",33),t.TgZ(2,"a",34),t.TgZ(3,"span",35),t._uU(4),t.qZA(),t.TgZ(5,"span",20),t._uU(6),t.ALo(7,"translate"),t.ALo(8,"number"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"td",36),t.TgZ(10,"erz-grade-select",37),t.NdJ("gradeIdSelected",function(o){return t.CHM(e),t.oxw(2).state.overwriteFinalGrade(o)}),t.ALo(11,"async"),t.qZA(),t.qZA(),t.TgZ(12,"td",38),t._uU(13),t.ALo(14,"number"),t.qZA(),t.YNc(15,Le,3,7,"td",39),t.qZA()}if(2&n){const e=i.$implicit,s=t.oxw(2);t.xp6(2),t.Q6J("routerLink","#"),t.xp6(2),t.Oqu(e.student.FullName),t.xp6(2),t.AsE(" ",t.lcZ(7,13,"tests.mean"),": ",t.xi3(8,15,e.finalGrade.average,"1.0-3")," "),t.xp6(3),t.Q6J("ngClass",t.VKq(23,Q,void 0===s.selectedTest)),t.xp6(1),t.Q6J("options",t.lcZ(11,18,s.state.gradingOptionsForCourse$()))("valueId",e.finalGrade.finalGradeId)("gradeId",e.finalGrade.id)("disabled",!s.isEditFinalGradesAllowed(e)),t.xp6(2),t.Q6J("ngClass",t.VKq(25,Q,void 0===s.selectedTest)),t.xp6(1),t.hij(" ",t.xi3(14,20,e.finalGrade.average,"1.0-3")," "),t.xp6(2),t.Q6J("ngForOf",e.grades)("ngForTrackBy",s.trackGradeOf(e.student))}}function Ee(n,i){if(1&n&&(t.TgZ(0,"td",40),t._UZ(1,"erz-average-grades",42),t.qZA()),2&n){const e=i.$implicit,s=t.oxw(2);t.Q6J("ngClass",e.Id===(null==s.selectedTest?null:s.selectedTest.Id)||e.Id===(null==s.selectedTest?null:s.selectedTest.Id)?"selected":""),t.xp6(1),t.Q6J("test",e)}}function Me(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"button",43),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).setAverageAsFinalGrade()}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"tests.set-final-grade")," "))}function ke(n,i){if(1&n&&(t.TgZ(0,"a",44),t.TgZ(1,"i",45),t._uU(2,"arrow_right_alt"),t.qZA(),t.TgZ(3,"span",46),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.s9C("href",e.buildLinkToRatingOverview(),t.LSH),t.xp6(4),t.Oqu(t.lcZ(5,2,"tests.link-to-rating-overview"))}}const vt=function(n,i){return{"btn-primary":n,"btn-outline-primary":i}};function we(n,i){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",1),t.TgZ(2,"table",2),t.TgZ(3,"thead",3),t.TgZ(4,"tr",4),t.TgZ(5,"th",5),t.TgZ(6,"button",6),t.NdJ("click",function(){return t.CHM(e),t.oxw().changeFilter("all-tests")}),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.TgZ(9,"button",7),t.NdJ("click",function(){return t.CHM(e),t.oxw().changeFilter("my-tests")}),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.qZA(),t.YNc(12,Se,2,3,"th",8),t.YNc(13,Ge,2,3,"th",9),t.qZA(),t.TgZ(14,"tr"),t.TgZ(15,"th",10),t.NdJ("click",function(){return t.CHM(e),t.oxw().state.sortBy("FullName")}),t.TgZ(16,"div",11),t.TgZ(17,"div",12),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.TgZ(20,"div",13),t._uU(21),t.ALo(22,"async"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(23,"th",14),t.TgZ(24,"div",11),t.TgZ(25,"div",12),t._uU(26),t.ALo(27,"translate"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(28,"th",15),t.TgZ(29,"div",11),t.TgZ(30,"div",12),t._uU(31),t.ALo(32,"translate"),t.qZA(),t.qZA(),t.qZA(),t.YNc(33,$e,10,8,"th",16),t.qZA(),t.qZA(),t.TgZ(34,"tbody"),t.YNc(35,qe,16,27,"tr",17),t.TgZ(36,"tr"),t.TgZ(37,"td",18),t.TgZ(38,"div",19),t.TgZ(39,"div"),t._uU(40),t.ALo(41,"translate"),t.qZA(),t.TgZ(42,"div",20),t._uU(43),t.ALo(44,"translate"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(45,"td",21),t._uU(46),t.ALo(47,"number"),t.ALo(48,"async"),t.qZA(),t.TgZ(49,"td",22),t._uU(50),t.ALo(51,"number"),t.ALo(52,"async"),t.qZA(),t.YNc(53,Ee,2,2,"td",23),t.qZA(),t.TgZ(54,"td",18),t.YNc(55,Me,3,3,"button",24),t.qZA(),t.qZA(),t.qZA(),t.YNc(56,ke,6,4,"a",25),t.qZA(),t.BQk()}if(2&n){const e=i.erzLet,s=t.oxw();t.xp6(6),t.Q6J("ngClass",t.WLB(48,vt,"all-tests"===e.filter,"all-tests"!==e.filter)),t.xp6(1),t.hij(" ",t.lcZ(8,22,"tests.all-tests")," "),t.xp6(2),t.Q6J("ngClass",t.WLB(51,vt,"my-tests"===e.filter,"my-tests"!==e.filter)),t.xp6(1),t.hij(" ",t.lcZ(11,24,"tests.owned-tests")," "),t.xp6(2),t.Q6J("ngForOf",e.tests),t.xp6(1),t.Q6J("ngForOf",e.tests),t.xp6(5),t.hij(" ",t.lcZ(19,26,"tests.student.name")," "),t.xp6(3),t.hij(" ",t.lcZ(22,28,s.state.getSortingChar$("FullName"))," "),t.xp6(2),t.Q6J("ngClass",t.VKq(54,Q,void 0===s.selectedTest)),t.xp6(3),t.hij(" ",t.lcZ(27,30,"tests.grade")," "),t.xp6(2),t.Q6J("ngClass",t.VKq(56,Q,void 0===s.selectedTest)),t.xp6(3),t.hij(" ",t.lcZ(32,32,"tests.mean")," "),t.xp6(2),t.Q6J("ngForOf",e.tests),t.xp6(2),t.Q6J("ngForOf",e.studentGrades)("ngForTrackBy",s.trackStudentGrade),t.xp6(5),t.Oqu(t.lcZ(41,34,"tests.average")),t.xp6(3),t.hij(" ",t.lcZ(44,36,"tests.mean"),": 4.75 "),t.xp6(3),t.hij(" ",t.xi3(47,38,t.lcZ(48,41,s.state.meanOfFinalGradesForCourse$),"1.0-3")," "),t.xp6(4),t.hij(" ",t.xi3(51,43,t.lcZ(52,46,s.state.meanOfStudentGradesForCourse$),"1.0-3")," "),t.xp6(3),t.Q6J("ngForOf",e.tests),t.xp6(2),t.Q6J("ngIf",s.canSetFinalGrade()),t.xp6(1),t.Q6J("ngIf",s.canSetFinalGrade())}}const Fe=function(n,i,e,s){return{tests:n,studentGrades:i,filter:e,expanded:s}};let Ue=(()=>{class n{constructor(e,s,o,r){this.settings=e,this.state=s,this.modalService=o,this.coursesRestService=r}ngOnInit(){this.state.setSorting({key:"FullName",ascending:!0})}ngOnChanges(e){e.course&&(this.state.course=this.course),e.tests&&this.state.setTests(this.tests)}canSetFinalGrade(){return function T(n){const i=n.EvaluationStatusRef;return!0===i.HasEvaluationStarted&&((null==i?void 0:i.EvaluationUntil)&&(null==i?void 0:i.EvaluationUntil)>=new Date||null==i.EvaluationUntil)}(this.course)}changeFilter(e){this.state.filter$.next(e)}saveGrade(e){this.state.saveGrade(e)}setAverageAsFinalGrade(){this.coursesRestService.setAverageAsFinalGrade({CourseIds:[this.course.Id]}).subscribe(console.log)}isEditFinalGradesAllowed(e){return N(this.course)&&e.finalGrade.canGrade}publish(e){const s=this.openModal(e);this.onCloseModal(s,()=>this.state.publish(e))}unpublish(e){const s=this.openModal(e);this.onCloseModal(s,()=>this.state.unpublish(e))}trackStudentGrade(e){return e}trackGradeOf(e){return function(s,o){return`${e.Id}_${o.test.Id}`}}calculatePointsAverage(e){return this.safeAverage(e,dt)}calculateGradeAverage(e){return this.safeAverage(e,lt)}safeAverage(e,s){try{return s(e).toString()}catch(o){return"-"}}openModal(e){const s=this.modalService.open(Rt);return s.componentInstance.test=e,s}onCloseModal(e,s){e.result.then(o=>{o&&s()},()=>{})}buildLinkToRatingOverview(){return`${this.settings.eventlist.evaluation}=${this.course.Id}`}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(S.L),t.Y36(mt),t.Y36(O.FF),t.Y36($))},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-test-edit-grades"]],inputs:{course:"course",tests:"tests",selectedTest:"selectedTest"},features:[t._Bn([K]),t.TTD],decls:5,vars:14,consts:[[4,"erzLet"],[1,"table-responsive-wrapper"],[1,"table","table-hover","h-100"],[1,"h-100"],[1,"h-100","header-collapsible"],["colspan","3",1,"desktop","pt-3","sticky"],["type","button",1,"btn","desktop",3,"ngClass","click"],["type","button",1,"btn","ml-2","desktop",3,"ngClass","click"],["container","body","class","grade h-100 test-info-desktop",3,"ngClass",4,"ngFor","ngForOf"],["container","body","class","grade h-100 header-mobile test-info-mobile","colspan","3",3,"ngClass",4,"ngFor","ngForOf"],[1,"primary-column-width","sticky",3,"click"],[1,"d-flex"],[1,"column-title"],[1,"sort-direction","ml-1"],[1,"secondary-column-width","sticky","sticky-col-2","desktop",3,"ngClass"],[1,"secondary-column-width","border-right","sticky","sticky-col-3","desktop",3,"ngClass"],["container","body","class","grade h-100",3,"ngClass",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"sticky"],[1,"d-flex","flex-column"],[1,"mobile","mean"],[1,"desktop","sticky","sticky","sticky-col-2"],[1,"desktop","border-right","sticky","sticky-col-3"],["class","grade",3,"ngClass",4,"ngFor","ngForOf"],["data-testId","apply-average-button","class","btn btn-primary","type","button",3,"click",4,"ngIf"],["class","d-flex justify-content-end pr-3 border-top pt-3","data-testId","link-to-rating-overview",3,"href",4,"ngIf"],["container","body",1,"grade","h-100","test-info-desktop",3,"ngClass"],[3,"test","expanded","toggle","publish","unpublish"],["container","body","colspan","3",1,"grade","h-100","header-mobile","test-info-mobile",3,"ngClass"],["container","body",1,"grade","h-100",3,"ngClass"],["class","w-25 column-title",4,"ngIf"],[3,"click"],[1,"w-25","column-title"],[1,"primary-column-width","sticky"],[3,"routerLink"],[1,"text-body","text-truncate"],[1,"grade","sticky","sticky-col-2",3,"ngClass"],[3,"options","valueId","gradeId","disabled","gradeIdSelected"],[1,"grade","border-right","sticky","sticky-col-3",3,"ngClass"],["class","grade",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"grade",3,"ngClass"],[3,"grade","gradeOptions","student","tabIndex","gradeChanged"],[3,"test"],["data-testId","apply-average-button","type","button",1,"btn","btn-primary",3,"click"],["data-testId","link-to-rating-overview",1,"d-flex","justify-content-end","pr-3","border-top","pt-3",3,"href"],[1,"material-icons","font-weight-bold"],[1,"pl-1"]],template:function(e,s){1&e&&(t.YNc(0,we,57,58,"ng-container",0),t.ALo(1,"async"),t.ALo(2,"async"),t.ALo(3,"async"),t.ALo(4,"async")),2&e&&t.Q6J("erzLet",t.l5B(9,Fe,t.lcZ(1,1,s.state.tests$),t.lcZ(2,3,s.state.studentGrades$),t.lcZ(3,5,s.state.filter$),t.lcZ(4,7,s.state.expandedHeader$)))},directives:[L.e,g.mk,g.sg,xe,g.O5,v.yS,Te,ye,Oe],pipes:[g.Ov,f.X$,g.JJ],styles:[".filter-hover[_ngcontent-%COMP%]:hover{background-color:#8a8a8a}table[_ngcontent-%COMP%]   th.grade.selected[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td.grade.selected[_ngcontent-%COMP%]{display:table-cell!important}table[_ngcontent-%COMP%]   th.grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td.grade[_ngcontent-%COMP%], .desktop[_ngcontent-%COMP%]{display:none!important}.desktop.selected[_ngcontent-%COMP%]{display:table-cell!important}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;vertical-align:top}.header-collapsible[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:0 1.5rem}.mobile[_ngcontent-%COMP%]{display:block!important}.mean[_ngcontent-%COMP%]{color:#005189;font-size:1.1rem;line-height:1}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:none!important}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1.5rem}@media (min-width: 576px){.table-responsive-wrapper[_ngcontent-%COMP%]{display:block;overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th.test-info-mobile[_ngcontent-%COMP%]{display:none!important}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   th.grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td.grade[_ngcontent-%COMP%], .desktop[_ngcontent-%COMP%]{display:table-cell!important}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;padding-top:.375rem;padding-bottom:.375rem;border-top:initial;min-width:100px;max-width:100px}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th.grade[_ngcontent-%COMP%]{min-width:300px;max-width:300px}.mobile[_ngcontent-%COMP%]{display:none!important}.primary-column-width[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-width:300px;max-width:300px}.secondary-column-width[_ngcontent-%COMP%]{min-width:100px;max-width:100px}table[_ngcontent-%COMP%]   .sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}table[_ngcontent-%COMP%]   .sticky.sticky-col-2[_ngcontent-%COMP%]{left:300px}table[_ngcontent-%COMP%]   .sticky.sticky-col-3[_ngcontent-%COMP%]{left:452px}}"]}),n})();var et=l(2925);function Je(n,i){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"erz-select",6),t.NdJ("valueChange",function(o){return t.CHM(e),t.oxw(3).testSelected(o)}),t.qZA(),t._UZ(2,"erz-test-edit-grades",7),t.BQk()}if(2&n){const e=t.oxw(2).erzLet,s=t.oxw();t.xp6(1),t.Q6J("options",e.testOptions)("additionalOption",s.gradeOption)("additionalOptionKey","tests.grade")("value",e.selectedTestId)("allowEmpty",!1),t.xp6(1),t.Q6J("course",e.course)("tests",e.tests)("selectedTest",e.selectedTest)}}function Ne(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"erz-tests-header",5),t.YNc(2,Je,3,8,"ng-container",4),t.BQk()),2&n){const e=t.oxw().erzLet;t.oxw();const s=t.MAs(8);t.xp6(1),t.Q6J("course",e.course),t.xp6(1),t.Q6J("ngIf",e.tests.length>0)("ngIfElse",s)}}function Re(n,i){if(1&n&&(t.ynx(0),t.YNc(1,Ne,3,3,"ng-container",4),t.ALo(2,"async"),t.BQk()),2&n){const e=t.oxw(),s=t.MAs(10);t.xp6(1),t.Q6J("ngIf",!1===t.lcZ(2,2,e.state.loading$))("ngIfElse",s)}}function je(n,i){1&n&&(t.TgZ(0,"p",8),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"tests.no-tests")))}function ze(n,i){1&n&&t._UZ(0,"erz-spinner")}const De=function(n,i,e,s,o){return{course:n,tests:i,testOptions:e,selectedTestId:s,selectedTest:o}};let Qe=(()=>{class n{constructor(e,s,o){this.state=e,this.translate=s,this.route=o,this.selectTest$=new k.x,this.courseId$=this.route.paramMap.pipe((0,u.U)(r=>Number(r.get("id"))),(0,I.x)()),this.course$=this.courseId$.pipe((0,Z.w)(r=>this.state.getCourse(r)),(0,z.d)(1)),this.tests$=this.course$.pipe((0,u.U)(r=>{var d;return null!==(d=r.Tests)&&void 0!==d?d:[]}),(0,u.U)(r=>r.slice().sort((d,c)=>c.Date.getTime()-d.Date.getTime())),(0,I.x)()),this.testOptions$=this.tests$.pipe((0,u.U)(r=>[{Key:-1,Value:this.translate.instant("tests.grade")},...r.map(d=>({Key:d.Id,Value:d.Designation}))]),(0,I.x)()),this.selectedTestId$=(0,Mt.T)(this.selectTest$,this.tests$.pipe((0,u.U)(r=>{var d;return null===(d=r[0])||void 0===d?void 0:d.Id}))).pipe((0,I.x)()),this.selectedTest$=this.selectedTestId$.pipe((0,Z.w)(r=>this.tests$.pipe((0,u.U)(d=>d.find(c=>c.Id===r)))),(0,I.x)())}testSelected(e){this.selectTest$.next(e)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(j),t.Y36(f.sK),t.Y36(v.gz))},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-tests-list"]],decls:11,vars:17,consts:[[1,"erz-container","erz-container-padding-y","erz-container-padding-x-responsive"],[4,"erzLet"],["noTests",""],["loading",""],[4,"ngIf","ngIfElse"],[3,"course"],[1,"tests-dropdown",3,"options","additionalOption","additionalOptionKey","value","allowEmpty","valueChange"],[3,"course","tests","selectedTest"],[1,"mt-3","px-3"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0),t.YNc(1,Re,3,4,"ng-container",1),t.ALo(2,"async"),t.ALo(3,"async"),t.ALo(4,"async"),t.ALo(5,"async"),t.ALo(6,"async"),t.YNc(7,je,3,3,"ng-template",null,2,t.W1O),t.YNc(9,ze,1,0,"ng-template",null,3,t.W1O),t.qZA()),2&e&&(t.xp6(1),t.Q6J("erzLet",t.qbA(11,De,t.lcZ(2,1,s.course$),t.lcZ(3,3,s.tests$),t.lcZ(4,5,s.testOptions$),t.lcZ(5,7,s.selectedTestId$),t.lcZ(6,9,s.selectedTest$))))},directives:[L.e,g.O5,Jt,V.H,Ue,et.O],pipes:[g.Ov,f.X$],styles:[".tests-dropdown[_ngcontent-%COMP%]{display:block;padding:1.5rem}@media (min-width: 576px){.tests-dropdown[_ngcontent-%COMP%]{display:none}}"]}),n})();var Ye=l(368);function He(n,i){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"date"),t._UZ(3,"wbr"),t._uU(4),t.ALo(5,"date"),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij("",t.xi3(2,2,e.dateFrom,"dd.MM.yyyy"),"\u2013"),t.xp6(3),t.Oqu(t.xi3(5,5,e.dateTo,"dd.MM.yyyy"))}}const Be=function(n){return[n,"tests"]};function We(n,i){if(1&n&&(t.TgZ(0,"a",18),t.TgZ(1,"i",19),t._uU(2,"arrow_right_alt"),t.qZA(),t.TgZ(3,"span",20),t._uU(4),t.qZA(),t.qZA()),2&n){const e=t.oxw().$implicit;t.Q6J("routerLink",t.VKq(2,Be,e.id)),t.xp6(4),t.Oqu(e.evaluationText)}}function Xe(n,i){if(1&n&&(t.TgZ(0,"a",21),t.TgZ(1,"i",19),t._uU(2,"arrow_right_alt"),t.qZA(),t.TgZ(3,"span",20),t._uU(4),t.qZA(),t.qZA()),2&n){const e=t.oxw().$implicit;t.Q6J("href",e.evaluationLink,t.LSH),t.xp6(4),t.hij("",e.evaluationText," ")}}function Ke(n,i){if(1&n&&(t.TgZ(0,"div",12),t.TgZ(1,"div",7),t.TgZ(2,"a",13),t._uU(3),t.qZA(),t.qZA(),t.TgZ(4,"div",8),t.YNc(5,He,6,8,"span",14),t.qZA(),t.TgZ(6,"div",9),t._uU(7),t.TgZ(8,"span",15),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.qZA(),t.TgZ(11,"div",10),t.YNc(12,We,5,4,"a",16),t.YNc(13,Xe,5,2,"a",17),t.qZA(),t.qZA()),2&n){const e=i.$implicit;t.xp6(2),t.Q6J("href",e.detailLink,t.LSH),t.xp6(1),t.Oqu(e.Designation),t.xp6(2),t.Q6J("ngIf",e.dateFrom&&e.dateTo),t.xp6(2),t.hij(" ",e.studentCount," "),t.xp6(2),t.Oqu(t.lcZ(10,7,1===e.studentCount?"events.registration":"events.registrations")),t.xp6(3),t.Q6J("ngIf","add-tests"===e.state),t.xp6(1),t.Q6J("ngIf",e.evaluationText&&e.evaluationLink)}}function Ve(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"div",6),t.TgZ(2,"div",7),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"div",8),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"div",9),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"div",10),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.qZA(),t.YNc(14,Ke,14,9,"div",11),t.BQk()),2&n){const e=t.oxw(2).erzLet;t.xp6(3),t.Oqu(t.lcZ(4,5,"events.designation")),t.xp6(3),t.Oqu(t.lcZ(7,7,"events.date")),t.xp6(3),t.hij(" ",t.lcZ(10,9,"events.registrations")," "),t.xp6(3),t.Oqu(t.lcZ(13,11,"events.rating")),t.xp6(2),t.Q6J("ngForOf",e.events)}}function tn(n,i){1&n&&(t.TgZ(0,"p",22),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"events.no-events")))}function en(n,i){if(1&n&&(t.ynx(0),t.YNc(1,Ve,15,13,"ng-container",3),t.YNc(2,tn,3,3,"ng-template",null,5,t.W1O),t.BQk()),2&n){const e=t.MAs(3),s=t.oxw().erzLet;t.xp6(1),t.Q6J("ngIf",(null==s.events?null:s.events.length)>0)("ngIfElse",e)}}function nn(n,i){1&n&&t._UZ(0,"erz-spinner")}function sn(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"div",1),t.TgZ(1,"erz-resettable-input",2),t.NdJ("valueChange",function(o){return t.CHM(e),t.oxw().state.search$.next(o)}),t.ALo(2,"async"),t.ALo(3,"translate"),t.ALo(4,"translate"),t.qZA(),t.YNc(5,en,4,2,"ng-container",3),t.ALo(6,"async"),t.YNc(7,nn,1,0,"ng-template",null,4,t.W1O),t.qZA()}if(2&n){const e=i.erzLet,s=t.MAs(8),o=t.oxw();t.xp6(1),t.Q6J("value",t.lcZ(2,6,o.state.search$))("placeholder",t.lcZ(3,8,"events.search-by"))("label",t.lcZ(4,10,"events.search"))("disabled",!e.events),t.xp6(4),t.Q6J("ngIf",!1===t.lcZ(6,12,o.state.loading$))("ngIfElse",s)}}const on=function(n){return{events:n}};let an=(()=>{class n{constructor(e){this.state=e}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(K))},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-events-list"]],decls:2,vars:5,consts:[["class","erz-container erz-container-padding-y erz-container-padding-x-responsive",4,"erzLet"],[1,"erz-container","erz-container-padding-y","erz-container-padding-x-responsive"],[1,"d-flex","search",3,"value","placeholder","label","disabled","valueChange"],[4,"ngIf","ngIfElse"],["loading",""],["noEvents",""],[1,"event-header"],[1,"designation"],[1,"date"],[1,"registrations"],[1,"rating"],["class","event-entry",4,"ngFor","ngForOf"],[1,"event-entry"],[3,"href"],[4,"ngIf"],[1,"registrations-label"],["class","d-flex",3,"routerLink",4,"ngIf"],["class","d-flex",3,"href",4,"ngIf"],[1,"d-flex",3,"routerLink"],[1,"material-icons"],[1,"pl-1"],[1,"d-flex",3,"href"],[1,"mt-3"]],template:function(e,s){1&e&&(t.YNc(0,sn,9,14,"div",0),t.ALo(1,"async")),2&e&&t.Q6J("erzLet",t.VKq(3,on,t.lcZ(1,1,s.state.filteredEvents$)))},directives:[L.e,Ye.w,g.O5,g.sg,v.yS,et.O],pipes:[g.Ov,f.X$,g.uU],styles:['.search[_ngcontent-%COMP%]{max-width:500px}.event-header[_ngcontent-%COMP%]{display:grid;padding:1.5rem;border-bottom:2px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}.event-entry[_ngcontent-%COMP%]{display:grid;padding:1.5rem;border-bottom:1px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}.designation[_ngcontent-%COMP%]{grid-area:designation;padding-right:1.5rem}.date[_ngcontent-%COMP%]{grid-area:date;padding-right:1.5rem}.registrations[_ngcontent-%COMP%]{grid-area:registrations;padding-right:1.5rem}.rating[_ngcontent-%COMP%]{grid-area:rating}.registrations-label[_ngcontent-%COMP%]{display:none}@media (max-width: 767.98px){.search[_ngcontent-%COMP%]{padding:0 1.5rem}.event-header[_ngcontent-%COMP%]{display:none}.registrations-label[_ngcontent-%COMP%]{display:inline}.designation[_ngcontent-%COMP%], .date[_ngcontent-%COMP%], .registrations[_ngcontent-%COMP%]{padding-right:0}.event-entry[_ngcontent-%COMP%]{grid-template-areas:"designation" "date" "registrations" "rating";grid-template-columns:1fr}}']}),n})();var ft=l(8746);let rn=(()=>{class n{constructor(e){this.activeModal=e}get canDeleteTest(){var e;return!((null===(e=this.test)||void 0===e?void 0:e.Results)&&this.test.Results.length>0)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(O.Kz))},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-tests-delete"]],inputs:{test:"test"},decls:13,vars:10,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-secondary",3,"hidden","click"],[1,"px-2"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"],[1,"px-3"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"p",1),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.qZA(),t.TgZ(4,"div",2),t.TgZ(5,"button",3),t.NdJ("click",function(){return s.activeModal.dismiss()}),t.TgZ(6,"span",4),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.qZA(),t.TgZ(9,"button",5),t.NdJ("click",function(){return s.activeModal.close(s.canDeleteTest?s.test:null)}),t.TgZ(10,"span",6),t._uU(11),t.ALo(12,"translate"),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.hij(" ",t.lcZ(3,4,s.canDeleteTest?"tests.form.confirm":"tests.form.delete-not-allowed")," "),t.xp6(3),t.Q6J("hidden",!s.canDeleteTest),t.xp6(2),t.hij(" ",t.lcZ(8,6,"tests.dialog.no")," "),t.xp6(4),t.hij(" ",t.lcZ(12,8,s.canDeleteTest?"tests.dialog.yes":"tests.dialog.ok")," "))},pipes:[f.X$],styles:[""]}),n})();var xt=l(2290),w=l(9646),dn=l(6124),F=l(2103);function ln(n,i){if(1&n&&(t.TgZ(0,"div",32),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,"global.validation-errors."+e.error,e.params)," ")}}function cn(n,i){if(1&n&&(t.TgZ(0,"div",32),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,"global.validation-errors."+e.error,e.params)," ")}}function un(n,i){if(1&n&&(t.TgZ(0,"div",32),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,"global.validation-errors."+e.error,e.params)," ")}}function pn(n,i){if(1&n&&(t.TgZ(0,"div",32),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,"global.validation-errors."+e.error,e.params)," ")}}function gn(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"div",33),t.TgZ(2,"div",34),t.TgZ(3,"div",17),t.TgZ(4,"label",35),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"div",36),t._UZ(8,"input",37),t.ALo(9,"async"),t.YNc(10,pn,3,4,"div",7),t.ALo(11,"async"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(12,"div",34),t.TgZ(13,"div",17),t.TgZ(14,"label",38),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"div",36),t._UZ(18,"input",39),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(19,"div",40),t.pZz(),t.TgZ(20,"math"),t.TgZ(21,"mi"),t._uU(22),t.ALo(23,"translate"),t.qZA(),t.TgZ(24,"mo"),t._uU(25,"="),t.qZA(),t.TgZ(26,"mfrac"),t.TgZ(27,"mrow"),t.TgZ(28,"mi"),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.TgZ(31,"mo"),t._uU(32,"\xd7"),t.qZA(),t.TgZ(33,"mn"),t._uU(34,"5"),t.qZA(),t.qZA(),t.TgZ(35,"mi"),t._uU(36),t.ALo(37,"translate"),t.qZA(),t.qZA(),t.TgZ(38,"mo"),t._uU(39,"+"),t.qZA(),t.TgZ(40,"mn"),t._uU(41,"1"),t.qZA(),t.qZA(),t.qZA(),t.BQk()),2&n){const e=t.oxw(3);t.xp6(5),t.Oqu(t.lcZ(6,8,"tests.form.max-points")),t.xp6(3),t.ekj("is-invalid",t.lcZ(9,10,e.maxPointsErrors$).length>0),t.xp6(2),t.Q6J("ngForOf",t.lcZ(11,12,e.maxPointsErrors$)),t.xp6(5),t.Oqu(t.lcZ(16,14,"tests.form.max-points-adjusted")),t.xp6(7),t.hij(" ",t.lcZ(23,16,"tests.form.math.grade")," "),t.xp6(7),t.hij(" ",t.lcZ(30,18,"tests.form.math.points")," "),t.xp6(7),t.Oqu(t.lcZ(37,20,"tests.form.math.max-points"))}}function mn(n,i){1&n&&(t.TgZ(0,"div",41),t.TgZ(1,"span",42),t._uU(2,"Loading..."),t.qZA(),t.qZA())}const _n=function(n){return["/events",n,"tests"]};function hn(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"form",2),t.NdJ("ngSubmit",function(){return t.CHM(e),t.oxw(2).onSubmit()}),t.TgZ(1,"div",3),t.TgZ(2,"div",4),t.TgZ(3,"label",5),t._uU(4),t.ALo(5,"translate"),t.qZA(),t._UZ(6,"input",6),t.ALo(7,"async"),t.ALo(8,"translate"),t.YNc(9,ln,3,4,"div",7),t.ALo(10,"async"),t.qZA(),t.TgZ(11,"div",4),t.TgZ(12,"label",8),t._uU(13),t.ALo(14,"translate"),t.qZA(),t.TgZ(15,"div",9),t.TgZ(16,"div",10),t.TgZ(17,"span",11),t.TgZ(18,"i",12),t._uU(19,"calendar_today"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(20,"input",13,14),t.NdJ("click",function(){return t.CHM(e),t.MAs(21).toggle()}),t.ALo(22,"async"),t.ALo(23,"translate"),t.qZA(),t.YNc(24,cn,3,4,"div",7),t.ALo(25,"async"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(26,"label"),t._uU(27),t.ALo(28,"translate"),t.qZA(),t.TgZ(29,"div",15),t.TgZ(30,"div",16),t.TgZ(31,"div",17),t.TgZ(32,"label",18),t._uU(33),t.ALo(34,"translate"),t.qZA(),t.TgZ(35,"div",19),t._UZ(36,"input",20),t.ALo(37,"async"),t.YNc(38,un,3,4,"div",7),t.ALo(39,"async"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(40,"label"),t._uU(41),t.ALo(42,"translate"),t.qZA(),t.TgZ(43,"div",21),t.TgZ(44,"div",22),t._UZ(45,"input",23),t.TgZ(46,"label",24),t._uU(47),t.ALo(48,"translate"),t.qZA(),t.qZA(),t.TgZ(49,"div",22),t._UZ(50,"input",25),t.TgZ(51,"label",26),t._uU(52),t.ALo(53,"translate"),t.qZA(),t.qZA(),t.YNc(54,gn,42,22,"ng-container",27),t.qZA(),t.TgZ(55,"div",28),t.TgZ(56,"button",29),t._uU(57),t.ALo(58,"translate"),t.qZA(),t.TgZ(59,"button",30),t._uU(60),t.ALo(61,"translate"),t.YNc(62,mn,3,0,"div",31),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw().erzLet,s=t.oxw();t.Q6J("formGroup",e.formGroup),t.xp6(4),t.Oqu(t.lcZ(5,29,"tests.form.designation")),t.xp6(2),t.ekj("is-invalid",t.lcZ(7,31,s.designationErrors$).length>0),t.Q6J("placeholder",t.lcZ(8,33,"tests.form.designation-placeholder")),t.xp6(3),t.Q6J("ngForOf",t.lcZ(10,35,s.designationErrors$)),t.xp6(4),t.Oqu(t.lcZ(14,37,"tests.form.date")),t.xp6(4),t.Q6J("id",s.componentId),t.xp6(3),t.ekj("is-invalid",t.lcZ(22,39,s.dateErrors$).length>0),t.Q6J("placeholder",t.lcZ(23,41,"shared.date-select.default-placeholder")),t.xp6(4),t.Q6J("ngForOf",t.lcZ(25,43,s.dateErrors$)),t.xp6(3),t.Oqu(t.lcZ(28,45,"tests.form.weight")),t.xp6(6),t.Oqu(t.lcZ(34,47,"tests.form.factor")),t.xp6(3),t.ekj("is-invalid",t.lcZ(37,49,s.weightErrors$).length>0),t.xp6(2),t.Q6J("ngForOf",t.lcZ(39,51,s.weightErrors$)),t.xp6(3),t.Oqu(t.lcZ(42,53,"tests.form.grading-type")),t.xp6(4),t.Q6J("value",!1),t.xp6(2),t.Oqu(t.lcZ(48,55,"tests.form.grades")),t.xp6(3),t.Q6J("value",!0),t.xp6(2),t.Oqu(t.lcZ(53,57,"tests.form.points")),t.xp6(2),t.Q6J("ngIf",e.formGroup.get("isPointGrading").value),t.xp6(2),t.Q6J("disabled",s.saving)("routerLink",t.VKq(63,_n,s.courseId)),t.xp6(1),t.hij(" ",t.lcZ(58,59,"tests.form.cancel")," "),t.xp6(2),t.Q6J("disabled",s.saving),t.xp6(1),t.hij(" ",t.lcZ(61,61,"tests.form.save")," "),t.xp6(2),t.Q6J("ngIf",s.saving)}}function vn(n,i){if(1&n&&(t.ynx(0),t.YNc(1,hn,63,65,"form",1),t.BQk()),2&n){const e=i.erzLet;t.xp6(1),t.Q6J("ngIf",e.formGroup)}}const fn=function(n){return{formGroup:n}};let Tt=(()=>{class n{constructor(e,s){this.fb=e,this.translate=s,this.save=new t.vpe,this.formGroup=this.createFormGroup(),this.submitted$=new b.X(!1),this.destroy$=new k.x,this.designationErrors$=(0,F.Z6)((0,w.of)(this.formGroup),this.submitted$,"designation"),this.dateErrors$=(0,F.Z6)((0,w.of)(this.formGroup),this.submitted$,"date"),this.maxPointsErrors$=(0,F.Z6)((0,w.of)(this.formGroup),this.submitted$,"maxPoints"),this.weightErrors$=(0,F.Z6)((0,w.of)(this.formGroup),this.submitted$,"weight")}ngOnInit(){this.test&&this.setInitialValues(this.test),(0,F.ZX)((0,w.of)(this.formGroup),"isPointGrading").pipe((0,tt.R)(this.destroy$)).subscribe(this.togglePointFieldsDisability.bind(this))}ngOnDestroy(){this.destroy$.next()}onSubmit(){this.submitted$.next(!0),this.formGroup.valid&&this.save.emit(this.formGroup.value)}createFormGroup(){return this.fb.group({designation:["",m.kI.required],date:[null,m.kI.required],weight:[1,m.kI.required],isPointGrading:[!1],maxPoints:[{value:null,disabled:!0},m.kI.required],maxPointsAdjusted:[{value:null,disabled:!0},null]})}setInitialValues(e){var s,o,r;this.formGroup.patchValue({designation:e.Designation,date:e.Date,weight:e.Weight,isPointGrading:e.IsPointGrading,maxPoints:e.MaxPoints,maxPointsAdjusted:e.MaxPointsAdjusted}),e.Results&&e.Results.length>0&&(null===(s=this.formGroup.get("isPointGrading"))||void 0===s||s.disable(),null===(o=this.formGroup.get("maxPoints"))||void 0===o||o.disable(),null===(r=this.formGroup.get("maxPointsAdjusted"))||void 0===r||r.disable()),this.togglePointFieldsDisability()}togglePointFieldsDisability(){var e,s,o;const r=this.formGroup.get("maxPoints"),d=this.formGroup.get("maxPointsAdjusted");(null===(e=this.formGroup.get("isPointGrading"))||void 0===e?void 0:e.value)?(null==r||r.enable(),null==d||d.enable()):(null==r||r.reset({value:null===(s=this.test)||void 0===s?void 0:s.MaxPoints,disabled:!0}),null==d||d.reset({value:null===(o=this.test)||void 0===o?void 0:o.MaxPointsAdjusted,disabled:!0}))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(m.qu),t.Y36(f.sK))},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-tests-edit-form"]],inputs:{courseId:"courseId",test:"test",saving:"saving"},outputs:{save:"save"},features:[t._Bn([{provide:O.DO,useClass:O.s5},{provide:O.NG,useClass:dn.n}])],decls:1,vars:3,consts:[[4,"erzLet"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"form-row","my-3"],[1,"form-group","col-md-6"],["for","designation"],["id","designation","name","designation","type","text","formControlName","designation","required","",1,"form-control",3,"placeholder"],["class","invalid-feedback",4,"ngFor","ngForOf"],["for","date"],[1,"input-group"],[1,"input-group-prepend"],[1,"input-group-text",3,"id"],[1,"material-icons"],["id","date","name","date","type","text","ngbDatepicker","","formControlName","date","required","",1,"form-control",3,"placeholder","click"],["dp","ngbDatepicker"],[1,"form-row","mb-3"],[1,"col-md-6"],[1,"form-group","row"],["for","factor",1,"col-3","col-sm-2"],[1,"col-9","col-sm-10"],["id","factor","name","factor","type","number","formControlName","weight","step","0.05","min","0","required","",1,"form-control"],[1,"form-group","mb-3"],[1,"form-check"],["type","radio","formControlName","isPointGrading","id","type-grades",1,"form-check-input",3,"value"],["for","type-grades",1,"form-check-label"],["type","radio","formControlName","isPointGrading","id","type-points",1,"form-check-input",3,"value"],["for","type-points",1,"form-check-label"],[4,"ngIf"],[1,"d-flex","justify-content-end","mt-4"],["type","button",1,"btn","btn-secondary",3,"disabled","routerLink"],["type","submit",1,"btn","btn-primary","ml-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"invalid-feedback"],[1,"form-row","ml-4","mb-3"],[1,"col-sm-6","col-md-4"],["for","max-points",1,"col-4","col-form-label"],[1,"col-6"],["type","number","name","maxPoints","id","max-points","formControlName","maxPoints","step","0.01","min","0","required","",1,"form-control"],["for","max-points-adjusted",1,"col-4","col-form-label"],["type","number","name","maxPointsAdjusted","id","max-points-adjusted","formControlName","maxPointsAdjusted","step","0.01","min","0",1,"form-control"],[1,"ml-4","pl-2"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"sr-only"]],template:function(e,s){1&e&&t.YNc(0,vn,2,1,"ng-container",0),2&e&&t.Q6J("erzLet",t.VKq(1,fn,s.formGroup))},directives:[L.e,g.O5,m._Y,m.JL,m.sg,m.Fj,m.JJ,m.u,m.Q7,g.sg,O.J4,m.wV,m.qQ,m._,v.rH],pipes:[f.X$,g.Ov],styles:["#factor[_ngcontent-%COMP%], #max-points[_ngcontent-%COMP%], #max-points-adjusted[_ngcontent-%COMP%]{width:5em}"]}),n})();function xn(n,i){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",4),t._uU(2),t.TgZ(3,"button",5),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().erzLet;return t.oxw().openDeleteModal(o.test)}),t.TgZ(4,"i",6),t._uU(5,"delete"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(6,"erz-tests-edit-form",7),t.NdJ("save",function(o){return t.CHM(e),t.oxw(2).save(o)}),t.qZA(),t.BQk()}if(2&n){const e=t.oxw().erzLet;t.xp6(2),t.hij(" ",e.test.Designation," "),t.xp6(4),t.Q6J("courseId",e.courseId)("test",e.test)("saving",e.saving)}}function Tn(n,i){1&n&&t._UZ(0,"erz-spinner")}function Zn(n,i){if(1&n&&(t.TgZ(0,"div",1),t.YNc(1,xn,7,4,"ng-container",2),t.ALo(2,"async"),t.YNc(3,Tn,1,0,"ng-template",null,3,t.W1O),t.qZA()),2&n){const e=t.MAs(4),s=t.oxw();t.xp6(1),t.Q6J("ngIf",!1===t.lcZ(2,2,s.state.loading$))("ngIfElse",e)}}const bn=function(n,i,e){return{courseId:n,test:i,saving:e}};let Cn=(()=>{class n{constructor(e,s,o,r,d,c,_){this.state=e,this.courseService=s,this.route=o,this.toastr=r,this.translate=d,this.router=c,this.modalService=_,this.saving$=new b.X(!1),this.courseId$=this.route.paramMap.pipe((0,u.U)(h=>Number(h.get("id"))),(0,I.x)()),this.testId$=this.route.paramMap.pipe((0,u.U)(h=>Number(h.get("testId"))),(0,I.x)()),this.tests$=this.courseId$.pipe((0,Z.w)(h=>this.state.getCourse(h)),(0,u.U)(h=>{var x;return null!==(x=h.Tests)&&void 0!==x?x:[]})),this.test$=(0,C.a)([this.tests$,this.testId$]).pipe((0,u.U)(([h,x])=>h.find(U=>U.Id===x)))}openDeleteModal(e){const s=this.modalService.open(rn);s.componentInstance.test=e,s.result.then(o=>{o&&this.courseService.delete(e.CourseId,e.Id).subscribe(this.onDeleteSuccess.bind(this))},()=>{})}save(e){this.saving$.next(!0);const{designation:s,date:o,weight:r,isPointGrading:d,maxPoints:c,maxPointsAdjusted:_}=e;(0,C.a)([this.courseId$,this.testId$]).pipe((0,Z.w)(([h,x])=>this.courseService.update(h,x,s,o,r,d,c,_)),(0,ft.x)(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastr.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}onDeleteSuccess(){this.toastr.success(this.translate.instant("tests.form.delete-success")),this.navigateBack()}navigateBack(){this.courseId$.subscribe(e=>this.router.navigate(["events",e,"tests"]))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(j),t.Y36($),t.Y36(v.gz),t.Y36(xt._W),t.Y36(f.sK),t.Y36(v.F0),t.Y36(O.FF))},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-tests-edit"]],decls:4,vars:11,consts:[["class","erz-container erz-container-limited erz-container-padding-y",4,"erzLet"],[1,"erz-container","erz-container-limited","erz-container-padding-y"],[4,"ngIf","ngIfElse"],["loading",""],[1,"d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-primary",3,"click"],[1,"material-icons"],[3,"courseId","test","saving","save"]],template:function(e,s){1&e&&(t.YNc(0,Zn,5,4,"div",0),t.ALo(1,"async"),t.ALo(2,"async"),t.ALo(3,"async")),2&e&&t.Q6J("erzLet",t.kEZ(7,bn,t.lcZ(1,1,s.courseId$),t.lcZ(2,3,s.test$),t.lcZ(3,5,s.saving$)))},directives:[L.e,g.O5,Tt,et.O],pipes:[g.Ov],styles:[""]}),n})();function An(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"div",1),t.TgZ(1,"erz-tests-edit-form",2),t.NdJ("save",function(o){return t.CHM(e),t.oxw().save(o)}),t.qZA(),t.qZA()}if(2&n){const e=i.erzLet;t.xp6(1),t.Q6J("courseId",e.courseId)("saving",e.saving)}}const yn=function(n,i){return{courseId:n,saving:i}},In=[{path:"",component:qt,children:[{path:"",component:an}]},{path:"",component:Et,children:[{path:":id/tests",component:Qe},{path:":id/tests/add",component:(()=>{class n{constructor(e,s,o,r,d){this.route=e,this.courseService=s,this.toastr=o,this.translate=r,this.router=d,this.saving$=new b.X(!1),this.courseId$=this.route.paramMap.pipe((0,u.U)(c=>Number(c.get("id"))),(0,I.x)())}save(e){this.saving$.next(!0);const{designation:s,date:o,weight:r,isPointGrading:d,maxPoints:c,maxPointsAdjusted:_}=e;this.courseId$.pipe((0,Z.w)(h=>this.courseService.add(h,o,s,r,d,c,_)),(0,ft.x)(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastr.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}navigateBack(){this.courseId$.subscribe(e=>this.router.navigate(["events",e,"tests"]))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(v.gz),t.Y36($),t.Y36(xt._W),t.Y36(f.sK),t.Y36(v.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-tests-add"]],decls:3,vars:8,consts:[["class","erz-container erz-container-limited erz-container-padding-y",4,"erzLet"],[1,"erz-container","erz-container-limited","erz-container-padding-y"],[3,"courseId","saving","save"]],template:function(e,s){1&e&&(t.YNc(0,An,2,2,"div",0),t.ALo(1,"async"),t.ALo(2,"async")),2&e&&t.Q6J("erzLet",t.WLB(5,yn,t.lcZ(1,1,s.courseId$),t.lcZ(2,3,s.saving$)))},directives:[L.e,Tt],pipes:[g.Ov],styles:[""]}),n})()},{path:":id/tests/:testId/edit",component:Cn}]}];let On=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[v.Bz.forChild(In)],v.Bz]}),n})(),Sn=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[Y.m,On]]}),n})()},4379:(Zt,J,l)=>{l.d(J,{K:()=>G});var Y=l(1854),v=l(1135),H=l(1884),b=l(4782),C=l(4004),u=l(5698),S=l(5e3);let G=(()=>{class y{constructor(){this.sortingSubject$=new v.X(null),this.sorting$=this.sortingSubject$.asObservable().pipe((0,H.x)(Y.Z),(0,b.d)(1))}getSortingChar$(T){return this.sorting$.pipe((0,C.U)(t=>t&&T===t.key?t.ascending?"\u2193":"\u2191":""))}setSorting(T){this.sortingSubject$.next(T)}toggleSorting(T){this.sorting$.pipe((0,u.q)(1)).subscribe(t=>{this.sortingSubject$.next(t&&t.key===T?{key:T,ascending:!t.ascending}:{key:T,ascending:!0})})}}return y.\u0275fac=function(T){return new(T||y)},y.\u0275prov=S.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})()}}]);