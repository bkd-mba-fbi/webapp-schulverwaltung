import{a as _e}from"./chunk-ULG2PTMU.js";import{a as ve,b as be,c as he}from"./chunk-UILPWDDC.js";import{a as Ce}from"./chunk-IM5APYHC.js";import{a as pe}from"./chunk-KEBBLHYI.js";import{a as ue,b as me}from"./chunk-LMQAXXHO.js";import{a as de}from"./chunk-JR5GMW5F.js";import"./chunk-3DWQRMU4.js";import{e as re}from"./chunk-I5JSV7AG.js";import"./chunk-KTRR6JQM.js";import{d as ce}from"./chunk-E3MRLVGK.js";import"./chunk-EXHTRNRL.js";import"./chunk-ZAGM2WJU.js";import{a as fe}from"./chunk-D5RVOUSN.js";import{c as oe,e as V}from"./chunk-SJA6MAWE.js";import{B as ae,f as ne}from"./chunk-IG4JFLD5.js";import"./chunk-I6B7SZW4.js";import"./chunk-JQMOLUIY.js";import{b as le}from"./chunk-TN3HRY7Y.js";import"./chunk-Y4QYVF5K.js";import"./chunk-QENSBOG3.js";import"./chunk-QGDSASTQ.js";import"./chunk-2QS7YZBA.js";import"./chunk-56A7FKFV.js";import"./chunk-DCZMTIC7.js";import"./chunk-AQYFD262.js";import"./chunk-MGLEQUF6.js";import"./chunk-YHCR7GAG.js";import"./chunk-2N7K67C6.js";import"./chunk-W3YEYO67.js";import{i as se}from"./chunk-YNODG5RP.js";import"./chunk-SNNR7FJ6.js";import"./chunk-EFJ6WEH7.js";import{u as ie}from"./chunk-HVLHLZKP.js";import"./chunk-DQAQYQ7K.js";import"./chunk-LYDHS67M.js";import{q as Z,r as ee,t as te}from"./chunk-ZXUJZ6KS.js";import{Ae as D,Cc as c,Dc as d,Eb as X,Gb as f,Hb as N,Ib as v,Lb as I,Mb as R,Nb as C,Ob as l,Pb as s,Q as j,Qb as g,Ub as w,Wb as x,Xb as u,_ as q,ba as M,da as U,db as r,fd as Q,ic as _,id as Y,ja as K,jc as b,kc as h,oa as p,ob as S,oc as E,pc as k,qc as A,rc as B,sc as $,tc as y,ua as P,v as H,va as F,wb as G,wc as z,xc as J,yc as W}from"./chunk-GP622B77.js";var T=(()=>{let t=class t extends me{constructor(){super("/evaluate-absences"),this.lessonPresenceService=p(V),this.queryParamsString$.pipe(U(this.destroy$)).subscribe(i=>this.confirmBackLinkParams={returnparams:i})}updateAfterConfirm(){this.resetEntries()}getInitialFilter(){return{student:null,educationalEvent:null,studyClass:null}}isValidFilter(i){return!!(i.student||i.educationalEvent||i.studyClass)}getInitialSortCriteria(){return{primarySortKey:"StudentFullName",ascending:!0}}loadEntries(i,n,a){return this.loadingService.load(this.lessonPresenceService.getStatistics(i,n,a),ue)}buildParamsFromFilter(i){return ve(i)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=K({token:t,factory:t.\u0275fac});let e=t;return e})();var ye=(()=>{let t=class t{constructor(){this.studentsService=p(re),this.educationalEventsService=p(he),this.studyClassesService=p(pe),this.filter={student:null,educationalEvent:null,studyClass:null},this.filterChange=new G,this.classesHttpFilter={params:{fields:"IsActive","filter.IsActive":"=true"}}}show(){this.filterChange.emit(this.filter)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=S({type:t,selectors:[["bkd-evaluate-absences-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},decls:20,vars:19,consts:[[1,"row","g-3","align-items-end"],[1,"col-sm-12","col-md"],[1,"form-label"],[3,"valueChange","typeaheadService","value"],[3,"valueChange","typeaheadService","value","additionalHttpParams"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(n,a){n&1&&(l(0,"div",0)(1,"div",1)(2,"label",2),_(3),c(4,"translate"),s(),l(5,"bkd-typeahead",3),A("valueChange",function(m){return k(a.filter.student,m)||(a.filter.student=m),m}),s()(),l(6,"div",1)(7,"label",2),_(8),c(9,"translate"),s(),l(10,"bkd-typeahead",3),A("valueChange",function(m){return k(a.filter.educationalEvent,m)||(a.filter.educationalEvent=m),m}),s()(),l(11,"div",1)(12,"label",2),_(13),c(14,"translate"),s(),l(15,"bkd-typeahead",4),A("valueChange",function(m){return k(a.filter.studyClass,m)||(a.filter.studyClass=m),m}),s()(),l(16,"div",5)(17,"button",6),x("click",function(){return a.show()}),_(18),c(19,"translate"),s()()()),n&2&&(r(3),b(d(4,11,"evaluate-absences.header.student")),r(2),C("typeaheadService",a.studentsService),E("value",a.filter.student),r(3),b(d(9,13,"evaluate-absences.header.module-instance")),r(2),C("typeaheadService",a.educationalEventsService),E("value",a.filter.educationalEvent),r(3),b(d(14,15,"evaluate-absences.header.study-class")),r(2),C("typeaheadService",a.studyClassesService),E("value",a.filter.studyClass),C("additionalHttpParams",a.classesHttpFilter),r(3),h(" ",d(19,17,"evaluate-absences.header.show")," "))},dependencies:[Ce,D],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1rem 1rem 1rem 0;border-bottom:1px solid #dee2e6}"],changeDetection:0});let e=t;return e})();var ke=()=>[],Ae=e=>["student",e,"absences"],Te=e=>({returnparams:e}),Se=(e,t)=>t.key,Le=(e,t)=>t.StudentRef.Id;function Pe(e,t){e&1&&g(0,"bkd-spinner")}function Fe(e,t){if(e&1){let o=w();l(0,"th",6)(1,"bkd-sortable-header",9),c(2,"translate"),c(3,"translate"),A("sortCriteriaChange",function(n){P(o);let a=u(4);return k(a.state.sortCriteria,n)||(a.state.sortCriteria=n),F(n)}),s()()}if(e&2){let o=t.$implicit,i=u(4);r(),C("ngClass",o.label)("label",d(2,5,"evaluate-absences.list.header."+o.label))("sortKey",o.key),E("sortCriteria",i.state.sortCriteria),C("ngbTooltip",d(3,7,"evaluate-absences.list.header."+o.label))}}function we(e,t){if(e&1&&(l(0,"a",10),c(1,"async"),_(2),s()),e&2){let o=u().$implicit,i=u().$implicit,n=u(5);C("routerLink",W(5,Ae,i.StudentRef.Id))("queryParams",W(7,Te,d(1,3,n.profileReturnParams$))),r(2),h(" ",i[o.key]," ")}}function Ie(e,t){if(e&1&&_(0),e&2){let o=u().$implicit,i=u().$implicit;h(" ",i[o.key]," ")}}function Re(e,t){if(e&1&&(l(0,"td"),c(1,"translate"),f(2,we,3,9,"a",10)(3,Ie,1,1),s()),e&2){let o=t.$implicit;X("data-label",d(1,2,"evaluate-absences.list.header."+o.label)),r(2),v(o.key==="StudentFullName"?2:3)}}function Be(e,t){if(e&1&&(l(0,"tr"),I(1,Re,4,4,"td",null,Se),s()),e&2){let o=u(5);r(),R(o.columns)}}function $e(e,t){if(e&1&&(l(0,"tbody"),I(1,Be,3,0,"tr",null,Le),s()),e&2){u(4);let o=y(0);r(),R(o)}}function De(e,t){e&1&&g(0,"bkd-spinner",7)}function Ve(e,t){if(e&1){let o=w();l(0,"button",11),x("click",function(){P(o);let n=u(4);return F(n.state.nextPage())}),_(1),c(2,"translate"),s()}e&2&&(r(),h(" ",d(2,1,"global.pagination.load-more")," "))}function Me(e,t){if(e&1){let o=w();l(0,"div",2)(1,"div",3),g(2,"bkd-reports-link",4),c(3,"async"),s(),l(4,"table",5),x("scrolled",function(){P(o);let n=u(3);return F(n.onScroll())}),l(5,"thead")(6,"tr"),I(7,Fe,4,9,"th",6,Se),s()(),f(9,$e,3,0,"tbody"),s(),f(10,De,1,0,"bkd-spinner",7),f(11,Ve,3,3,"button",8),s()}if(e&2){let o=u(3),i=y(0),n=y(2),a=y(4);r(2),C("reports",d(3,4,o.reports$)??J(6,ke)),r(5),R(o.columns),r(2),v(i&&i.length>0?9:-1),r(),v(a?10:-1),r(),v(n&&!a?11:-1)}}function Ne(e,t){e&1&&(l(0,"p",1),_(1),c(2,"translate"),s()),e&2&&(r(),h(" ",d(2,1,"evaluate-absences.no-entries")," "))}function We(e,t){if(e&1&&f(0,Me,12,7,"div",2)(1,Ne,3,3,"p",1),e&2){u(2);let o=y(0),i=y(4);v(o&&o.length>0||i?0:1)}}function Oe(e,t){if(e&1&&(f(0,Pe,1,0,"bkd-spinner"),c(1,"async"),N(2,We,2,1)),e&2){let o=u();v(d(1,1,o.state.loading$)?0:2)}}function He(e,t){e&1&&(l(0,"p",1),_(1),c(2,"translate"),s()),e&2&&(r(),b(d(2,1,"evaluate-absences.no-filter")))}var ge=(()=>{let t=class t{constructor(){this.state=p(T),this.scrollPosition=p(fe),this.route=p(Z),this.presenceTypesService=p(ne),this.reportsService=p(ce),this.lessonPresencesService=p(V),this.reports$=this.loadReports(),this.columns=[{key:"StudentFullName",label:"student"},{key:"TotalAbsences",label:"total"},{key:"TotalAbsencesValidExcuse",label:"valid-excuse"},{key:"TotalAbsencesWithoutExcuse",label:"without-excuse"},{key:"TotalAbsencesUnconfirmed",label:"unconfirmed"},{key:"TotalAbsencesUnchecked",label:"unchecked"},{key:"TotalIncidents",label:"incident"}],this.filterFromParams$=this.route.queryParams.pipe(H(je)),this.profileReturnParams$=this.state.queryParamsString$}ngOnInit(){this.filterFromParams$.pipe(j(1)).subscribe(i=>this.state.setFilter(i)),this.presenceTypesService.halfDayActive$.subscribe(i=>{i&&(this.columns=[...this.columns,{key:"TotalHalfDays",label:"halfday"}])})}ngAfterViewInit(){this.scrollPosition.restore()}onScroll(){this.state.nextPage()}loadReports(){return this.state.validFilter$.pipe(M(i=>this.lessonPresencesService.getLessonRefs(i)),M(i=>i.length>0?this.reportsService.getEvaluateAbsencesReports(this.getReportRecordIds(i)):[]),q(1))}getReportRecordIds(i){return i.map(n=>`${n.LessonRef.Id}_${n.RegistrationRef.Id}`)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=S({type:t,selectors:[["bkd-evaluate-absences-list"]],decls:14,vars:18,consts:[[3,"filterChange","filter"],[1,"mt-3"],[1,"py-3"],[1,"buttons"],[1,"mb-2",3,"reports"],["infiniteScroll","",1,"table","table-striped","table-fixed",3,"scrolled"],["scope","col"],[1,"inline"],["type","button",1,"btn","btn-outline-secondary","btn-sm","d-block","mx-auto"],[3,"sortCriteriaChange","ngClass","label","sortKey","sortCriteria","ngbTooltip"],[1,"student",3,"routerLink","queryParams"],["type","button",1,"btn","btn-outline-secondary","btn-sm","d-block","mx-auto",3,"click"]],template:function(n,a){if(n&1){let L=w();B(0),c(1,"async"),B(2),c(3,"async"),B(4),c(5,"async"),l(6,"h1"),_(7),c(8,"translate"),s(),l(9,"bkd-evaluate-absences-header",0),c(10,"async"),x("filterChange",function(Ee){return P(L),F(a.state.setFilter(Ee))}),s(),f(11,Oe,3,3),c(12,"async"),N(13,He,3,3,"p",1)}n&2&&($(d(1,3,a.state.entries$)),r(2),$(d(3,6,a.state.hasMore$)),r(2),$(d(5,9,a.state.loadingPage$)),r(3),b(d(8,12,"evaluate-absences.title")),r(2),C("filter",d(10,14,a.filterFromParams$)),r(2),v(d(12,16,a.state.isFilterValid$)?11:13))},dependencies:[ye,le,be,ie,te,se,Y,D,_e,Q],styles:["th[_ngcontent-%COMP%]{cursor:pointer}th.student[_ngcontent-%COMP%]{width:30%}.buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"],changeDetection:0});let e=t;return e})();function je(e){return{student:e.student?Number(e.student):null,educationalEvent:e.educationalEvent?Number(e.educationalEvent):null,studyClass:e.studyClass?Number(e.studyClass):null}}var xe=(()=>{let t=class t{constructor(){this.state=p(T)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=S({type:t,selectors:[["bkd-evaluate-absences"]],features:[z([T,{provide:oe,useExisting:T},ae])],decls:1,vars:0,template:function(n,a){n&1&&g(0,"router-outlet")},dependencies:[ee],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0});let e=t;return e})();var Mt=[{path:"",component:xe,children:[{path:"",component:ge,data:{restoreScrollPositionFrom:["/evaluate-absences/student/:id"]}},de]}];export{Mt as EVALUATE_ABSENCES_ROUTES};
