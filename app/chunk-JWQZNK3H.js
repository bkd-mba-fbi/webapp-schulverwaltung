import{a as Ke,c as We}from"./chunk-7MNYHWH7.js";import"./chunk-JQSRZZRL.js";import{b as ie}from"./chunk-I27QBANF.js";import"./chunk-OLKZTOFS.js";import"./chunk-G4BBF67E.js";import"./chunk-ULG2PTMU.js";import{a as Xe}from"./chunk-IM5APYHC.js";import"./chunk-AQPISA56.js";import"./chunk-43OAUXMT.js";import{a as Ge}from"./chunk-4JM46VRG.js";import"./chunk-VQXX7J5W.js";import{d as Ue,f as j,g as Ve}from"./chunk-CFWZHBTA.js";import{l as qe}from"./chunk-63NXKJIP.js";import"./chunk-BHASDBIA.js";import{d as Ne}from"./chunk-EXHTRNRL.js";import"./chunk-AONRG2H4.js";import{e as ee}from"./chunk-TK2JEDAD.js";import{B as Fe,g as je}from"./chunk-P2WZY5ZW.js";import"./chunk-I6B7SZW4.js";import"./chunk-JQMOLUIY.js";import{a as He}from"./chunk-2JKGIYT3.js";import"./chunk-Y4QYVF5K.js";import{a as we}from"./chunk-QENSBOG3.js";import{e as de,p as Be}from"./chunk-QGDSASTQ.js";import"./chunk-2QS7YZBA.js";import{a as Ae}from"./chunk-DQZMQ4YX.js";import"./chunk-YOBKMKR7.js";import"./chunk-DCZMTIC7.js";import"./chunk-AQYFD262.js";import"./chunk-MGLEQUF6.js";import"./chunk-YHCR7GAG.js";import{d as ze}from"./chunk-FVPRCQLC.js";import{a as Q,i as te}from"./chunk-YNODG5RP.js";import"./chunk-SNNR7FJ6.js";import{b as Ie}from"./chunk-EFJ6WEH7.js";import"./chunk-HVLHLZKP.js";import{b as Le}from"./chunk-DQAQYQ7K.js";import"./chunk-LYDHS67M.js";import{N as Re,O as Oe,d as ce,h as Y,k as $e,r as ke,s as De,t as Z,z as O}from"./chunk-ZXUJZ6KS.js";import{Ae as k,Cc as a,Cd as Me,Dc as s,Dd as Ee,Eb as oe,Ec as M,Gb as h,Gc as Te,Hb as W,Ib as b,Id as J,Lb as fe,Mb as Ce,Nb as C,Ob as l,Pb as d,Qb as y,Tb as ae,Ub as _e,Wb as B,Xb as f,Yb as ge,Zb as ye,_ as v,a as U,aa as he,ab as F,b as H,ba as P,d as le,db as o,ec as re,gc as ve,hd as Pe,ic as m,id as R,ja as w,jc as T,jd as X,k as pe,kc as x,l as me,lc as se,mc as Se,oa as p,ob as S,q as E,rb as ue,rc as I,sc as N,tc as z,ua as q,ub as K,v as u,va as G,w as V,wa as be,wc as xe,xc as L}from"./chunk-GP622B77.js";var Ye=J({Id:Ee,Holder:Me});var Ze=(()=>{let t=class t extends Q{constructor(){let n=p(Y),i=p(O);super(n,i,Ye,"TeacherSubstitutions")}getTeacherSubstitution(n){return this.getList({params:{"filter.Id":`=${n}`}}).pipe(u(i=>i[0]||null))}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=w({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var ht=["LessonTeacherRole","ClassTeacherRole","TeacherRole","AbsenceAdministratorRole"],bt=["LessonTeacherRole","TeacherRole","StudentRole","SubstituteAdministratorRole"],ut=["LessonTeacherRole","StudentRole"],D=(()=>{let t=class t{constructor(){this.settingsService=p(ie),this.lessonPresencesService=p(ee),this.studentsService=p(j),this.courseService=p(qe),this.teacherSubstitutionService=p(Ze),this.personService=p(ze),this.storageService=p(Ae),this.settings=p(O),this.rolesAndPermissions$=this.settingsService.getRolesAndPermissions(),this.userId$=new me(1),this.lessonAbsences$=this.userId$.pipe(P(i=>this.studentsService.getLessonAbsences(i)),v(1)),this.lessonIncidents$=this.userId$.pipe(P(i=>this.studentsService.getLessonIncidents(i)),v(1)),this.loading$=this.rolesAndPermissions$.pipe(u(i=>i==null)),this.hasSearch$=this.rolesAndPermissions$.pipe(u(this.hasRoles(ht))),this.hasActions$=this.rolesAndPermissions$.pipe(u(this.hasRoles(bt))),this.hasTimetable$=this.rolesAndPermissions$.pipe(u(this.hasRoles(ut))),this.hasLessonTeacherRole$=this.rolesAndPermissions$.pipe(u(this.hasRoles(["LessonTeacherRole"])),v(1)),this.hasTeacherRole$=this.rolesAndPermissions$.pipe(u(this.hasRoles(["TeacherRole"])),v(1)),this.hasStudentRole$=this.rolesAndPermissions$.pipe(u(this.hasRoles(["StudentRole"])),v(1)),this.hasSubstituteAdministratorRole$=this.rolesAndPermissions$.pipe(u(this.hasRoles(["SubstituteAdministratorRole"])),v(1)),this.editAbsencesCount$=this.hasLessonTeacherRole$.pipe(P(i=>i?this.lessonPresencesService.checkableAbsencesCount():E(!1)),v(1)),this.openAbsencesCount$=this.rolesAndPermissions$.pipe(u(this.hasRoles(["LessonTeacherRole","ClassTeacherRole"])),P(i=>i?this.lessonPresencesService.getListOfUnconfirmed():E([])),u(i=>i.length),v(1)),this.myAbsencesCount$=this.hasStudentRole$.pipe(P(i=>i?this.getMyAbsences():E([])),u(this.getMyAbsencesCount.bind(this)),v(1)),this.coursesToRateCount$=this.courseService.getNumberOfCoursesForRating().pipe(he(0),v(1)),this.hasPresenceControl$=this.hasLessonTeacherRole$.pipe(P(i=>i?this.lessonPresencesService.hasLessonsLessonTeacher():E(!1)),v(1)),this.hasOpenAbsences$=this.openAbsencesCount$.pipe(u(i=>i>0),v(1)),this.editAbsencesParams$=this.getFullName().pipe(u(i=>({confirmationStates:this.settings.checkableAbsenceStateId,teacher:i})),v(1));let n=this.storageService.getPayload()?.id_person;n&&this.userId$.next(Number(n))}hasRoles(n){return i=>(i??[]).some(c=>n.includes(c))}getMyAbsences(){return V([this.userId$,this.lessonAbsences$,this.lessonIncidents$]).pipe(P(([n,i,c])=>this.loadTimetableEntries(n,i,c).pipe(u(_=>[...i,...c].map(g=>this.withTimetableEntry(g,_)).filter(Le)))))}getMyAbsencesCount(n){return n?.filter(i=>("ConfirmationStateId"in i?i.ConfirmationStateId:null)===this.settings.unconfirmedAbsenceStateId).length||0}getFullName(){let n=Number(this.storageService.getPayload()?.substitution_id)||null;return n?this.teacherSubstitutionService.getTeacherSubstitution(n).pipe(u(i=>i?.Holder)):this.personService.getMyself().pipe(u(i=>i.FullName))}withTimetableEntry(n,i){return i.find(c=>c.Id===n.LessonRef.Id)?n:null}loadTimetableEntries(n,i,c){return this.studentsService.getTimetableEntries(n,{"filter.Id":`;${[...i,...c].map(_=>_.LessonRef.Id).join(";")}`})}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=w({token:t,factory:t.\u0275fac});let e=t;return e})();var ft=["*"];function Ct(e,t){e&1&&ae(0)}function _t(e,t){if(e&1&&(l(0,"a",1),K(1,Ct,1,0,"ng-container",3),d()),e&2){let r=f(),n=re(3);C("routerLink",r.link)("queryParams",r.linkParams),o(),C("ngTemplateOutlet",n)}}function gt(e,t){e&1&&ae(0)}function yt(e,t){if(e&1&&(l(0,"a",2),K(1,gt,1,0,"ng-container",3),d()),e&2){let r=f(),n=re(3);C("href",r.externalLink,F),o(),C("ngTemplateOutlet",n)}}function vt(e,t){if(e&1&&(l(0,"span",5),m(1),d()),e&2){let r=f(2);o(),T(r.count)}}function St(e,t){e&1&&(be(),l(0,"svg",6),y(1,"path",7),d())}function xt(e,t){if(e&1&&(l(0,"span",4),m(1),a(2,"translate"),d(),l(3,"div"),ye(4),h(5,vt,2,1,"span",5)(6,St,2,0,":svg:svg",6),d()),e&2){let r=f();o(),T(s(2,2,r.label)),o(4),b(r.hasCount(r.count)?5:6)}}var Je=(()=>{let t=class t{constructor(){}hasCount(n){return typeof n=="number"&&n>=0}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=S({type:t,selectors:[["bkd-dashboard-action"]],inputs:{label:"label",count:"count",link:"link",linkParams:"linkParams",externalLink:"externalLink"},ngContentSelectors:ft,decls:4,vars:2,consts:[["actionContent",""],[3,"routerLink","queryParams"],[3,"href"],[4,"ngTemplateOutlet"],[1,"label"],[1,"count"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none"],["fill","currentColor","d","m12 20-1.425-1.4 5.6-5.6H4v-2h12.175l-5.6-5.6L12 4l8 8-8 8Z"]],template:function(i,c){i&1&&(ge(),h(0,_t,2,3,"a",1),h(1,yt,2,2,"a",2),K(2,xt,7,4,"ng-template",null,0,Te)),i&2&&(b(c.externalLink?-1:0),o(),b(c.externalLink?1:-1))},dependencies:[Z,Pe,k],styles:["a[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:space-between;align-items:center;padding:1rem 1.5rem;background:#f7e9d2;text-decoration:none;line-height:1}a[_ngcontent-%COMP%]:hover{background:#f2e0c3}a[_ngcontent-%COMP%]:focus-visible{outline-width:2px;outline-offset:-2px}div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:1rem}.label[_ngcontent-%COMP%]{font-weight:400}.count[_ngcontent-%COMP%]{font-size:1.5rem}"]});let e=t;return e})();var Qe=(()=>{let t=class t{constructor(){}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=S({type:t,selectors:[["bkd-dashboard-deadline"]],inputs:{count:"count"},decls:3,vars:8,template:function(i,c){i&1&&(m(0),a(1,"translate"),a(2,"addSpace")),i&2&&Se("",s(1,3,"dashboard.actions.deadline"),"",M(2,5,": ",":"),"",c.count,`
`)},dependencies:[k,Ve],styles:["[_nghost-%COMP%]{background:#ea161f;color:#fff;white-space:nowrap;font-weight:500;font-size:.875rem;min-height:1.5rem;display:flex;padding:.375rem .5rem;align-items:center;border-radius:2.5rem}"]});let e=t;return e})();var Tt=()=>["/presence-control"],Pt=()=>["/edit-absences"],$t=()=>["/open-absences"],kt=()=>["/events"],Dt=()=>["/my-absences","report"],Mt=()=>["/my-absences"];function Et(e,t){e&1&&y(0,"bkd-dashboard-action",0),e&2&&C("label","dashboard.actions.presence-control")("link",L(2,Tt))}function Rt(e,t){if(e&1&&(y(0,"bkd-dashboard-action",1),a(1,"async"),a(2,"async")),e&2){let r=f();C("label","dashboard.actions.edit-absences")("link",L(8,Pt))("linkParams",s(1,4,r.dashboardService.editAbsencesParams$))("count",s(2,6,r.dashboardService.editAbsencesCount$))}}function Ot(e,t){if(e&1&&(y(0,"bkd-dashboard-action",2),a(1,"async")),e&2){let r=f();C("label","dashboard.actions.open-absences")("link",L(5,$t))("count",s(1,3,r.dashboardService.openAbsencesCount$))}}function At(e,t){if(e&1&&(y(0,"bkd-dashboard-deadline",4),a(1,"async")),e&2){let r=f(2);C("count",s(1,1,r.dashboardService.coursesToRateCount$))}}function It(e,t){if(e&1&&(l(0,"bkd-dashboard-action",0),h(1,At,2,3,"bkd-dashboard-deadline",4),a(2,"async"),d()),e&2){let r=f();C("label","dashboard.actions.tests")("link",L(5,kt)),o(),b(s(2,3,r.dashboardService.coursesToRateCount$)??!1?1:-1)}}function Lt(e,t){e&1&&y(0,"bkd-dashboard-action",0),e&2&&C("label","dashboard.actions.my-absences-report")("link",L(2,Dt))}function wt(e,t){if(e&1&&(y(0,"bkd-dashboard-action",2),a(1,"async")),e&2){let r=f();C("label","dashboard.actions.my-absences")("link",L(5,Mt))("count",s(1,3,r.dashboardService.myAbsencesCount$))}}function Bt(e,t){if(e&1&&y(0,"bkd-dashboard-action",3),e&2){let r=f();C("label","dashboard.actions.substitutions")("externalLink",r.substitutionsAdminLink)}}var et=(()=>{let t=class t{constructor(){this.dashboardService=p(D),this.settings=p(O)}get substitutionsAdminLink(){return this.settings.dashboard.substitutionsAdminLink}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=S({type:t,selectors:[["bkd-dashboard-actions"]],decls:15,vars:23,consts:[[3,"label","link"],[3,"label","link","linkParams","count"],[3,"label","link","count"],[3,"label","externalLink"],[3,"count"]],template:function(i,c){i&1&&(h(0,Et,1,3,"bkd-dashboard-action",0),a(1,"async"),h(2,Rt,3,9,"bkd-dashboard-action",1),a(3,"async"),a(4,"async"),h(5,Ot,2,6,"bkd-dashboard-action",2),a(6,"async"),h(7,It,3,6,"bkd-dashboard-action",0),a(8,"async"),h(9,Lt,1,3,"bkd-dashboard-action",0),a(10,"async"),h(11,wt,2,6,"bkd-dashboard-action",2),a(12,"async"),h(13,Bt,1,2,"bkd-dashboard-action",3),a(14,"async")),i&2&&(b(s(1,7,c.dashboardService.hasPresenceControl$)?0:-1),o(2),b(s(3,9,c.dashboardService.hasLessonTeacherRole$)&&s(4,11,c.dashboardService.editAbsencesParams$)?2:-1),o(3),b(s(6,13,c.dashboardService.hasOpenAbsences$)?5:-1),o(2),b(s(8,15,c.dashboardService.hasTeacherRole$)?7:-1),o(2),b(s(10,17,c.dashboardService.hasStudentRole$)?9:-1),o(2),b(s(12,19,c.dashboardService.hasStudentRole$)?11:-1),o(2),b(s(14,21,c.dashboardService.hasSubstituteAdministratorRole$)?13:-1))},dependencies:[Je,Qe,R],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:.5rem}"]});let e=t;return e})();var tt=(()=>{let t=class t{constructor(){this.studentsRestService=p(j),this.router=p(De)}navigateToDossier(n){return le(this,null,function*(){let i=Number(n);yield this.router.navigate(["dashboard","student",i,"contact"])})}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=S({type:t,selectors:[["bkd-dashboard-search"]],decls:1,vars:2,consts:[[3,"valueChange","typeaheadService","placeholder"]],template:function(i,c){i&1&&(l(0,"bkd-typeahead",0),B("valueChange",function(g){return g&&c.navigateToDossier(g)}),d()),i&2&&C("typeaheadService",c.studentsRestService)("placeholder","dashboard.search.placeholder")},dependencies:[Xe],styles:["[_nghost-%COMP%]{display:block;padding:.75rem;background:#f7e9d2}"]});let e=t;return e})();var jt=J({}),it=(()=>{let t=class t extends Q{constructor(){let n=p(Y),i=p(O);super(n,i,jt,"Teachers")}getTimetableEntries(n,i={}){let c=i instanceof ce?i:new ce({fromObject:i});return c=c.set("fields","Id,From,To,EventId,EventNumber,EventDesignation,EventLocation"),this.http.get(`${this.baseUrl}/${n}/TimetableEntries/CurrentSemester`,{params:c,headers:{"X-Role-Restriction":"LessonTeacherRole"}}).pipe(P(Ie(Ue)))}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=w({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var nt=(()=>{let t=class t{constructor(){this.sanitizer=p($e)}transform(n,i){switch(i){case"html":return this.sanitizer.bypassSecurityTrustHtml(n);case"style":return this.sanitizer.bypassSecurityTrustStyle(n);case"script":return this.sanitizer.bypassSecurityTrustScript(n);case"url":return this.sanitizer.bypassSecurityTrustUrl(n);case"resourceUrl":return this.sanitizer.bypassSecurityTrustResourceUrl(n);default:throw new Error(`Invalid safe type specified: ${i}`)}}};t.\u0275fac=function(i){return new(i||t)},t.\u0275pipe=ue({name:"safe",type:t,pure:!0});let e=t;return e})();function ot(e){return{id:st(e.EventId,e.Id),from:e.From,until:e.To,eventId:e.EventId,subject:e.EventDesignation,room:e.EventLocation||void 0,teacher:e.EventManagerInformation||void 0}}function at(e){let t=e.reduce((r,n)=>{let i=st(n.EventRef.Id,n.LessonRef.Id);return H(U({},r),{[i]:[...r[i]??[],n.StudyClassNumber]})},{});return Object.keys(t).reduce((r,n)=>H(U({},r),{[n]:Re([...t[n]].sort())}),{})}function rt(e,t){return e.map(r=>H(U({},r),{studyClass:t[r.id]?.join(", ")}))}function st(e,t){return`${e}-${t}`}var Ft=(e,t)=>t.id;function Nt(e,t){e&1&&(l(0,"th"),m(1),a(2,"translate"),d()),e&2&&(o(),x(" ",s(2,1,"dashboard.timetable.table.teacher")," "))}function zt(e,t){if(e&1&&(l(0,"a",3),m(1),l(2,"span",8),m(3),d()()),e&2){let r=f().$implicit,n=f(2).buildLink(r.eventId);C("routerLink",n.link)("queryParams",n.params),o(),x(" ",r.subject),o(2),x(", ",r.studyClass)}}function Ut(e,t){if(e&1&&m(0),e&2){let r=f().$implicit;x(" ",r.subject," ")}}function Ht(e,t){if(e&1&&(l(0,"td",4),m(1),a(2,"translate"),d()),e&2){let r=f().$implicit;o(),se(" ",s(2,2,"dashboard.timetable.table.study-class"),": ",r.studyClass," ")}}function Vt(e,t){if(e&1&&(l(0,"td",5),m(1),d()),e&2){let r=f().$implicit;o(),x(" ",r.teacher," ")}}function qt(e,t){e&1&&(l(0,"span",7),m(1),a(2,"translate"),d()),e&2&&(o(),T(s(2,1,"dashboard.timetable.table.room")))}function Gt(e,t){if(e&1&&(l(0,"tr")(1,"td",1),m(2),a(3,"date"),a(4,"date"),d(),l(5,"td",2),h(6,zt,4,4,"a",3),a(7,"async"),W(8,Ut,1,1),d(),h(9,Ht,3,4,"td",4),a(10,"async"),h(11,Vt,2,1,"td",5),a(12,"async"),l(13,"td",6),h(14,qt,3,3,"span",7),m(15),d()()),e&2){let r=t.$implicit,n=f(2);o(2),se(" ",M(3,7,r.from,"HH:mm"),"\u2013",M(4,10,r.until,"HH:mm")," "),o(4),b(s(7,13,n.isTeacher$)?6:8),o(3),b(s(10,15,n.isTeacher$)?9:-1),o(2),b(s(12,17,n.isStudent$)?11:-1),o(3),b(r.room?14:-1),o(),x(" ",r.room," ")}}function Kt(e,t){if(e&1&&(l(0,"table",0)(1,"thead")(2,"tr")(3,"th"),m(4),a(5,"translate"),d(),l(6,"th"),m(7),a(8,"translate"),d(),h(9,Nt,3,3,"th"),a(10,"async"),l(11,"th"),m(12),a(13,"translate"),d()()(),l(14,"tbody"),fe(15,Gt,16,19,"tr",null,Ft),d()()),e&2){let r=f();o(4),T(s(5,4,"dashboard.timetable.table.time")),o(3),T(s(8,6,"dashboard.timetable.table.subject")),o(2),b(s(10,8,r.isStudent$)?9:-1),o(3),x(" ",s(13,10,"dashboard.timetable.table.room")," "),o(3),Ce(r.entries)}}function Wt(e,t){e&1&&(l(0,"p"),m(1),a(2,"translate"),d()),e&2&&(o(),T(s(2,1,"dashboard.timetable.no-entries")))}var ct=(()=>{let t=class t{constructor(){this.dashboardService=p(D),this.entries=[],this.isStudent$=this.dashboardService.hasStudentRole$,this.isTeacher$=this.dashboardService.hasLessonTeacherRole$}buildLink(n){return Ne(Ke(n,"/dashboard"))}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=S({type:t,selectors:[["bkd-dashboard-timetable-table"]],inputs:{entries:"entries"},decls:2,vars:1,consts:[[1,"table"],[1,"time"],[1,"subject"],[3,"routerLink","queryParams"],[1,"study-class"],[1,"teacher"],[1,"room"],[1,"room-label"],[1,"subject-study-class"]],template:function(i,c){i&1&&h(0,Kt,17,12,"table",0)(1,Wt,3,3,"p"),i&2&&b(c.entries.length>0?0:1)},dependencies:[R,X,k,Z],styles:['td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{padding:1rem 1.75rem}.room-label[_ngcontent-%COMP%], td.study-class[_ngcontent-%COMP%]{display:none}@media (max-width: 767.98px){table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{display:none}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]{border-top:1px solid var(--bs-border-color)}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-template-areas:"time room" "subject subject" "study-class study-class" "teacher teacher";gap:.5rem;padding:1rem;border-bottom:1px solid var(--bs-border-color)}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:0;padding:0}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.time[_ngcontent-%COMP%]{grid-area:time;font-size:.875rem;line-height:1.125rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.subject[_ngcontent-%COMP%]{grid-area:subject;font-size:1rem;line-height:1.25rem;font-weight:400}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.teacher[_ngcontent-%COMP%]{grid-area:teacher;font-size:.8125rem;line-height:1.0625rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.room[_ngcontent-%COMP%]{grid-area:room;text-align:right;font-size:.875rem;line-height:1.125rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.study-class[_ngcontent-%COMP%]{grid-area:study-class;font-size:.8125rem;line-height:1.0625rem;font-weight:300}td.study-class[_ngcontent-%COMP%]{display:block}.subject-study-class[_ngcontent-%COMP%]{display:none}.room-label[_ngcontent-%COMP%]{display:inline}}']});let e=t;return e})();function Xt(e,t){e&1&&(l(0,"a",6),a(1,"safe"),m(2),a(3,"translate"),d()),e&2&&(C("href",M(1,2,t,"url"),F),o(2),x(" ",s(3,5,"dashboard.timetable.subscribe-calendar")," "))}function Yt(e,t){e&1&&y(0,"bkd-spinner")}function Zt(e,t){e&1&&(l(0,"a",8),a(1,"safe"),m(2),a(3,"translate"),d()),e&2&&(C("href",M(1,2,t,"url"),F),o(2),x(" ",s(3,5,"dashboard.timetable.subscribe-calendar")," "))}function Jt(e,t){if(e&1&&(y(0,"bkd-dashboard-timetable-table",7),h(1,Zt,4,7,"a",8),a(2,"async")),e&2){let r,n=f(),i=z(18);C("entries",i),o(),b((r=s(2,2,n.getSubscribeCalendarUrl()))?1:-1,r)}}var Qt="cal",dt=(()=>{let t=class t{constructor(){this.teachersService=p(it),this.studentsService=p(j),this.lessonPresencesService=p(ee),this.userSettings=p(ie),this.dashboardService=p(D),this.loadingService=p(He),this.userId$=this.dashboardService.userId$,this.isTeacher$=this.dashboardService.hasLessonTeacherRole$,this.isStudent$=this.dashboardService.hasStudentRole$,this.date$=new pe(de(new Date)),this.loading$=this.loadingService.loading$,this.timetableEntries$=this.loadTimetableEntries()}gotoToday(){this.date$.next(de(new Date))}gotoPreviousDay(){this.date$.next(je(this.date$.getValue(),1))}gotoNextDay(){this.date$.next(we(this.date$.getValue(),1))}getSubscribeCalendarUrl(){return this.userSettings.getSetting(Qt)}loadTimetableEntries(){return V([this.isTeacher$,this.isStudent$,this.userId$,this.date$]).pipe(P(([n,i,c,_])=>{let g=()=>n?this.fetchTimetableEntries("teacher",c,_):i?this.fetchTimetableEntries("student",c,_):E([]);return this.loadingService.load(g())}),v(1))}fetchTimetableEntries(n,i,c){let _={"filter.From":`=${Be(c,"yyyy-MM-dd")}`,sort:"From,To"};return(n==="teacher"?this.teachersService.getTimetableEntries(i,_):this.studentsService.getTimetableEntries(i,_)).pipe(u(g=>g.map(ot)),u(g=>Oe(g,A=>A.id)),P(g=>n==="teacher"?this.loadStudyClasses(c).pipe(u(A=>rt(g,A))):E(g)))}loadStudyClasses(n){return this.lessonPresencesService.getLessonStudyClassesByDate(n).pipe(u(at))}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=S({type:t,selectors:[["bkd-dashboard-timetable"]],decls:23,vars:24,consts:[[1,"header"],["type","button",1,"btn","btn-primary","today",3,"click"],["type","button",1,"btn","btn-secondary","previous-day",3,"click"],[1,"material-icons"],["type","button",1,"btn","btn-secondary","next-day",3,"click"],[1,"date"],["target","_parent",1,"btn","btn-secondary","subscribe-calendar-header",3,"href"],[3,"entries"],["target","_parent",1,"btn","btn-secondary","subscribe-calendar-bottom",3,"href"]],template:function(i,c){if(i&1){let _=_e();l(0,"div",0)(1,"button",1),B("click",function(){return q(_),G(c.gotoToday())}),m(2),a(3,"translate"),d(),l(4,"button",2),a(5,"translate"),B("click",function(){return q(_),G(c.gotoPreviousDay())}),l(6,"span",3),m(7,"chevron_left"),d()(),l(8,"button",4),a(9,"translate"),B("click",function(){return q(_),G(c.gotoNextDay())}),l(10,"span",3),m(11,"chevron_right"),d()(),l(12,"div",5),m(13),a(14,"async"),a(15,"date"),d(),h(16,Xt,4,7,"a",6),a(17,"async"),d(),I(18),a(19,"async"),h(20,Yt,1,0,"bkd-spinner"),a(21,"async"),W(22,Jt,3,4)}if(i&2){let _;o(2),x(" ",s(3,6,"dashboard.timetable.today")," "),o(2),oe("aria-label",s(5,8,"dashboard.timetable.previousDay")),o(4),oe("aria-label",s(9,10,"dashboard.timetable.nextDay")),o(5),T(M(15,14,s(14,12,c.date$),"E, dd. MMMM yyyy")),o(3),b((_=s(17,17,c.getSubscribeCalendarUrl()))?16:-1,_),o(2),N(s(19,19,c.timetableEntries$)),o(2),b(s(21,22,c.loading$)?20:22)}},dependencies:[ct,te,R,X,k,nt],styles:["[_nghost-%COMP%]{display:block;margin-bottom:1rem}.header[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:2rem;display:flex;align-items:center;gap:1rem}.previous-day[_ngcontent-%COMP%], .next-day[_ngcontent-%COMP%]{padding-left:.375rem;padding-right:.375rem}.date[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600}.subscribe-calendar-header[_ngcontent-%COMP%]{margin-left:auto}.subscribe-calendar-bottom[_ngcontent-%COMP%]{display:none}a.btn[_ngcontent-%COMP%]{text-decoration:none}@media (max-width: 767.98px){.subscribe-calendar-header[_ngcontent-%COMP%]{display:none}.subscribe-calendar-bottom[_ngcontent-%COMP%]{display:block;margin-top:2rem}}@media (max-width: 767.98px) and (max-width: 575.98px){.header[_ngcontent-%COMP%]{flex-wrap:wrap-reverse}.header[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{width:100%}}"]});let e=t;return e})();function ei(e,t){e&1&&y(0,"bkd-spinner")}function ti(e,t){e&1&&(l(0,"p"),m(1),a(2,"translate"),d()),e&2&&(o(),x(" ",s(2,1,"dashboard.no-access")," "))}function ii(e,t){e&1&&(l(0,"div")(1,"h2"),m(2),a(3,"translate"),d(),y(4,"bkd-dashboard-search"),d()),e&2&&(o(2),T(s(3,1,"dashboard.search.title")))}function ni(e,t){e&1&&(l(0,"div")(1,"h2"),m(2),a(3,"translate"),d(),y(4,"bkd-dashboard-actions"),d()),e&2&&(o(2),T(s(3,1,"dashboard.actions.title")))}function oi(e,t){if(e&1&&(l(0,"div",1),h(1,ii,5,3,"div"),h(2,ni,5,3,"div"),d()),e&2){f();let r=z(2),n=z(4);o(),b(r?1:-1),o(),b(n?2:-1)}}function ai(e,t){e&1&&(l(0,"div",2)(1,"h2"),m(2),a(3,"translate"),d(),y(4,"bkd-dashboard-timetable"),d()),e&2&&(o(2),T(s(3,1,"dashboard.timetable.title")))}var lt=(()=>{let t=class t{constructor(){this.dashboardService=p(D)}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=S({type:t,selectors:[["bkd-dashboard-layout"]],decls:17,vars:19,consts:[[1,"columns"],[1,"search-actions-column"],[1,"timetable-column"]],template:function(i,c){if(i&1&&(I(0),a(1,"async"),I(2),a(3,"async"),I(4),a(5,"async"),I(6),a(7,"async"),l(8,"div")(9,"h1"),m(10),a(11,"translate"),d(),h(12,ei,1,0,"bkd-spinner"),h(13,ti,3,3,"p"),l(14,"div",0),h(15,oi,3,2,"div",1),h(16,ai,5,3,"div",2),d()()),i&2){let _=s(1,7,c.dashboardService.loading$);o(2);let g=N(s(3,9,c.dashboardService.hasSearch$));o(2);let A=N(s(5,12,c.dashboardService.hasActions$)),ne=s(7,15,c.dashboardService.hasTimetable$);o(5),ve("visually-hidden",_||g||A||ne),o(),x(" ",s(11,17,"dashboard.heading")," "),o(2),b(_?12:-1),o(),b(!_&&!g&&!A&&!ne?13:-1),o(2),b(g||A?15:-1),o(),b(ne?16:-1)}},dependencies:[te,tt,et,dt,R,k],styles:[".columns[_ngcontent-%COMP%]{display:flex;flex-direction:column}.columns[_ngcontent-%COMP%], .search-actions-column[_ngcontent-%COMP%]{gap:3rem}.search-actions-column[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;max-width:40rem}.timetable-column[_ngcontent-%COMP%]{flex:2}@media (min-width: 992px){.columns[_ngcontent-%COMP%]{flex-direction:row;gap:1.5rem}.search-actions-column[_ngcontent-%COMP%]{max-width:33%}}"],changeDetection:0});let e=t;return e})();var pt=(()=>{let t=class t{constructor(){}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=S({type:t,selectors:[["bkd-dashboard"]],features:[xe([D,Fe])],decls:1,vars:0,template:function(i,c){i&1&&y(0,"router-outlet")},dependencies:[ke],encapsulation:2,changeDetection:0});let e=t;return e})();var ro=[{path:"",component:pt,children:[{path:"",component:lt},Ge,We("students/:id")]}];export{ro as DASHBOARD_ROUTES};
