import{b as P}from"./chunk-EXHTRNRL.js";import{C as I,H as R}from"./chunk-IG4JFLD5.js";import{a as E}from"./chunk-TN3HRY7Y.js";import{D as x,G as C,z as v}from"./chunk-ZXUJZ6KS.js";import{G as s,H as d,N as m,O as g,Q as f,S as u,Y as l,_ as o,bd as F,da as S,j as n,ja as b,jb as y,k as c,oa as a,v as i,w as $}from"./chunk-GP622B77.js";var L="page",_=(()=>{let r=class r{constructor(e){this.location=a(F),this.loadingService=a(E),this.settings=a(v),this.sortService=a(R),this.loading$=this.loadingService.loading$,this.loadingPage$=this.loadingService.loading(L),this.sortCriteria$=this.sortService.sortCriteria$,this.sortCriteria=this.sortService.sortCriteria,this.filter$=new c(this.getInitialFilter()),this.isFilterValid$=this.filter$.pipe(i(this.isValidFilter.bind(this))),this.validFilter$=this.filter$.pipe(d(this.isValidFilter.bind(this)),u(C),o(1)),this.resetEntries$=new n,this.nextPage$=new n,this.page$=s(this.nextPage$.pipe(i(()=>"next")),s(this.resetEntries$,this.validFilter$,this.sortCriteria$).pipe(i(()=>"reset"))).pipe(l((t,p)=>p==="next"?t+1:0,0)),this.offset$=this.page$.pipe(i(t=>t*this.settings.paginationLimit)),this.pageResult$=$([this.validFilter$,this.sortCriteria$,this.offset$]).pipe(g(10),m(I(this.loadEntries.bind(this))),o(1)),this.entries$=s(s(this.resetEntries$,this.validFilter$,this.sortCriteria$).pipe(i(()=>({action:"reset"}))),this.pageResult$.pipe(i(t=>t.offset===0?{action:"reset",entries:t.entries}:{action:"append",entries:t.entries}))).pipe(l(this.entriesActionReducer.bind(this),[]),o(1)),this.total$=this.pageResult$.pipe(i(({total:t})=>t)),this.hasMore$=this.pageResult$.pipe(i(({offset:t,total:p})=>t<p-this.settings.paginationLimit)),this.queryParams$=this.filter$.pipe(i(this.buildParamsFromFilter.bind(this))),this.queryParamsString$=this.queryParams$.pipe(i(P)),this.destroy$=new n,this.queryParamsString$.pipe(S(this.destroy$)).subscribe(t=>this.location.replaceState(e,t)),this.sortService.sortCriteria.set(this.getInitialSortCriteria())}ngOnDestroy(){this.destroy$.next()}setFilter(e){this.filter$.next(x(e))}nextPage(){this.hasMore$.pipe(f(1)).subscribe(e=>{e&&this.nextPage$.next()})}resetEntries(){this.resetEntries$.next()}getInitialSortCriteria(){return null}entriesActionReducer(e,t){switch(t.action){case"append":return[...e,...t.entries];case"reset":return t.entries?t.entries:[];default:return e}}};r.\u0275fac=function(t){y()},r.\u0275prov=b({token:r,factory:r.\u0275fac});let h=r;return h})();export{L as a,_ as b};
