import{a as we,b as Ee,c as je,d as Ve,e as Me}from"./chunk-AXC265QM.js";import{t as R,w as Fe}from"./chunk-LY5STZD6.js";import{d as $e,e as Te}from"./chunk-TMXWSOGF.js";import{b as te}from"./chunk-UN6AN2DI.js";import{a as Be}from"./chunk-CXJU4L5R.js";import{C as Z,G as Le,H as Re,y as Ie}from"./chunk-W6XALPR5.js";import{i as Pe}from"./chunk-2AZMKO7X.js";import{b as ee}from"./chunk-HLAFRD2O.js";import{c as Y,d as z,e as J,f as K,g as X}from"./chunk-QTBTUQ3W.js";import{a as ke}from"./chunk-HVJBOTRL.js";import{$a as a,Ab as g,Ac as ye,Bb as y,Bc as Se,Cb as v,Db as W,Eb as re,Fb as ae,Ga as I,Jb as d,Kb as m,L as me,Lb as ve,M as ue,Na as c,O as oe,P as E,Pd as De,Qa as p,Qd as M,R as U,Ra as fe,Va as _,Wa as _e,X as Q,Ya as N,Za as O,_ as L,_a as r,a as j,ab as b,b as V,cc as w,dc as Ce,dd as Ae,ea as k,eb as F,f as q,fa as D,g as ce,gb as $,h as se,hb as l,ib as be,jb as he,k as de,l as pe,n as P,o as le,qb as h,rb as u,sb as H,tb as f,xc as xe,ya as n,yc as ge,za as x}from"./chunk-S3H6YSFW.js";var ie=(()=>{class e{constructor(t,i,s,C,B){this.settings=t,this.lessonPresencesService=i,this.presenceTypesService=s,this.toastService=C,this.translate=B,this.studentId$=new se(1),this.checkableAbsences$=this.getAbsences(this.loadCheckableAbsences.bind(this)),this.openAbsences$=this.getAbsences(this.loadOpenAbsences.bind(this)),this.excusedAbsences$=this.getAbsences(this.loadExcusedAbsences.bind(this)),this.unexcusedAbsences$=this.getAbsences(this.loadUnexcusedAbsences.bind(this)),this.incidents$=this.getAbsences(this.loadIncidents.bind(this)),this.halfDays$=this.getAbsences(this.loadHalfDays.bind(this)),this.counts$=this.getCounts()}setStudentId(t){this.studentId$.next(t)}getAbsences(t){return this.studentId$.pipe(E(t),oe(null),me({connector:()=>new se(1)}))}getCounts(){return this.studentId$.pipe(E(t=>le([this.loadStatistics(t).pipe(oe(null)),this.openAbsences$.pipe(P(i=>i?.length??null)),this.checkableAbsences$.pipe(P(i=>i?.length??null))])),P(([t,i,s])=>({openAbsences:i,checkableAbsences:s,excusedAbsences:t?.TotalAbsencesValidExcuse??null,unexcusedAbsences:t?.TotalAbsencesWithoutExcuse??null,incidents:t?.TotalIncidents??null,halfDays:t?.TotalHalfDays??null})))}loadStatistics(t){return this.lessonPresencesService.getStatistics({student:t,educationalEvent:null,studyClass:null},null,0).pipe(E(({entries:i})=>i.length>0?pe(i[0]):(this.toastService.error(this.translate.instant("global.rest-errors.notfound-message"),this.translate.instant("global.rest-errors.notfound-title")),de)))}loadOpenAbsences(t){return this.lessonPresencesService.getListOfUnconfirmed(this.getBaseParams(t))}loadCheckableAbsences(t){return this.lessonPresencesService.getList({params:V(j({},this.getBaseParams(t)),{"filter.ConfirmationStateId":`=${this.settings.checkableAbsenceStateId}`})})}loadExcusedAbsences(t){return this.lessonPresencesService.getList({params:V(j({},this.getBaseParams(t)),{"filter.ConfirmationStateId":`=${this.settings.excusedAbsenceStateId}`})})}loadUnexcusedAbsences(t){return this.lessonPresencesService.getList({params:V(j({},this.getBaseParams(t)),{"filter.ConfirmationStateId":`=${this.settings.unexcusedAbsenceStateId}`})})}loadIncidents(t){return this.presenceTypesService.incidentTypes$.pipe(P(i=>V(j({},this.getBaseParams(t)),{"filter.TypeRef":`;${i.map(s=>s.Id).join(";")}`})),E(i=>this.lessonPresencesService.getList({params:i})))}loadHalfDays(t){return this.lessonPresencesService.getList({params:V(j({},this.getBaseParams(t)),{"filter.TypeRef":`=${this.settings.halfDayPresenceTypeId}`})})}getBaseParams(t){return{sort:"LessonDateTimeFrom.asc","filter.StudentRef":`=${t}`}}static{this.\u0275fac=function(i){return new(i||e)(L(Ae),L(Te),L(Z),L(ke),L(De))}}static{this.\u0275prov=Q({token:e,factory:e.\u0275fac})}}return e})();var T=(()=>{class e{constructor(t,i){this.profileService=t,this.route=i,this.currentDossier$=new ce("addresses"),this.studentId$=this.route.paramMap.pipe(P(s=>Number(s.get("id")))),this.profile$=this.studentId$.pipe(E(s=>this.profileService.getProfile(s)),ue(1)),this.returnParams$=this.route.queryParams.pipe(P(({returnparams:s})=>s)),this.backlinkQueryParams$=this.returnParams$.pipe(P(Be)),this.loading$=this.profileService.loading$}static{this.\u0275fac=function(i){return new(i||e)(L(we),L(xe))}}static{this.\u0275prov=Q({token:e,factory:e.\u0275fac})}}return e})();function ze(e,o){if(e&1&&u(0),e&2){l();let t=v(0);f(" (",t==null?null:t.checkableAbsences,") ")}}function Je(e,o){if(e&1&&b(0,"bkd-student-dossier-absences",13),e&2){let t=l();p("absences$",t.absencesService.checkableAbsences$)}}function Ke(e,o){if(e&1&&u(0),e&2){l();let t=v(0);f(" (",t==null?null:t.openAbsences,") ")}}function Xe(e,o){if(e&1&&b(0,"bkd-student-dossier-absences",14),e&2){let t=l();p("absences$",t.absencesService.openAbsences$)("selectionService",t.absencesSelectionService)}}function Ze(e,o){if(e&1&&u(0),e&2){l();let t=v(0);f(" (",t==null?null:t.excusedAbsences,") ")}}function et(e,o){if(e&1&&b(0,"bkd-student-dossier-absences",13),e&2){let t=l();p("absences$",t.absencesService.excusedAbsences$)}}function tt(e,o){if(e&1&&u(0),e&2){l();let t=v(0);f(" (",t==null?null:t.unexcusedAbsences,") ")}}function it(e,o){if(e&1&&b(0,"bkd-student-dossier-absences",15),e&2){let t=l();p("absences$",t.absencesService.unexcusedAbsences$)("displayPresenceType",!1)}}function nt(e,o){if(e&1&&u(0),e&2){l();let t=v(0);f(" (",t==null?null:t.incidents,") ")}}function st(e,o){if(e&1&&b(0,"bkd-student-dossier-absences",13),e&2){let t=l();p("absences$",t.absencesService.incidents$)}}function ot(e,o){if(e&1&&u(0),e&2){l(2);let t=v(0);f(" (",t==null?null:t.halfDays,") ")}}function rt(e,o){if(e&1&&b(0,"bkd-student-dossier-absences",15),e&2){let t=l(2);p("absences$",t.absencesService.halfDays$)("displayPresenceType",!1)}}function at(e,o){if(e&1){let t=F();r(0,"div",12,5)(2,"div",8)(3,"bkd-student-dossier-entry-header",9),$("click",function(){k(t);let s=h(1);return D(s.toggle())}),u(4),d(5,"translate"),c(6,ot,1,1),a()(),r(7,"div",10)(8,"div",11),c(9,rt,1,2,"ng-template"),a()()()}if(e&2){let t=h(1);l();let i=v(0);n(3),p("opened",!t.collapsed),n(),f(" ",m(5,3,"shared.profile.half-days")," "),n(2),_((i==null?null:i.halfDays)!==null?6:-1)}}var Ge=(()=>{class e{constructor(t,i,s,C){this.state=t,this.presenceTypesService=i,this.absencesService=s,this.absencesSelectionService=C,this.halfDayActive$=this.presenceTypesService.halfDayActive$,this.destroy$=new q,this.state.currentDossier$.next("absences")}ngOnInit(){this.state.studentId$.pipe(U(this.destroy$)).subscribe(t=>this.absencesService.setStudentId(t))}ngOnDestroy(){this.destroy$.next()}static{this.\u0275fac=function(i){return new(i||e)(x(T),x(Z),x(ie),x(Ie))}}static{this.\u0275cmp=I({type:e,selectors:[["bkd-dossier-absences"]],features:[W([ie])],decls:55,vars:31,consts:[["checkableAbsences","ngbAccordionItem"],["openAbsences","ngbAccordionItem"],["excusedAbsences","ngbAccordionItem"],["unexcusedAbsences","ngbAccordionItem"],["incidents","ngbAccordionItem"],["halfDays","ngbAccordionItem"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],["ngbAccordionItem","","id","half-days"],[3,"absences$"],[3,"absences$","selectionService"],[3,"absences$","displayPresenceType"]],template:function(i,s){if(i&1){let C=F();g(0),d(1,"async"),r(2,"div",6)(3,"div",7,0)(5,"div",8)(6,"bkd-student-dossier-entry-header",9),$("click",function(){k(C);let S=h(4);return D(S.toggle())}),u(7),d(8,"translate"),c(9,ze,1,1),a()(),r(10,"div",10)(11,"div",11),c(12,Je,1,1,"ng-template"),a()()(),r(13,"div",7,1)(15,"div",8)(16,"bkd-student-dossier-entry-header",9),$("click",function(){k(C);let S=h(14);return D(S.toggle())}),u(17),d(18,"translate"),c(19,Ke,1,1),a()(),r(20,"div",10)(21,"div",11),c(22,Xe,1,2,"ng-template"),a()()(),r(23,"div",7,2)(25,"div",8)(26,"bkd-student-dossier-entry-header",9),$("click",function(){k(C);let S=h(24);return D(S.toggle())}),u(27),d(28,"translate"),c(29,Ze,1,1),a()(),r(30,"div",10)(31,"div",11),c(32,et,1,1,"ng-template"),a()()(),r(33,"div",7,3)(35,"div",8)(36,"bkd-student-dossier-entry-header",9),$("click",function(){k(C);let S=h(34);return D(S.toggle())}),u(37),d(38,"translate"),c(39,tt,1,1),a()(),r(40,"div",10)(41,"div",11),c(42,it,1,2,"ng-template"),a()()(),r(43,"div",7,4)(45,"div",8)(46,"bkd-student-dossier-entry-header",9),$("click",function(){k(C);let S=h(44);return D(S.toggle())}),u(47),d(48,"translate"),c(49,nt,1,1),a()(),r(50,"div",10)(51,"div",11),c(52,st,1,1,"ng-template"),a()()(),c(53,at,10,5,"div",12),d(54,"async"),a()}if(i&2){let C=h(4),B=h(14),S=h(24),Ue=h(34),Qe=h(44),A=y(m(1,16,s.absencesService.counts$));n(6),p("opened",!C.collapsed),n(),f(" ",m(8,19,"shared.profile.checkable-absences")," "),n(2),_((A==null?null:A.checkableAbsences)!==null?9:-1),n(7),p("opened",!B.collapsed),n(),f(" ",m(18,21,"shared.profile.open-absences")," "),n(2),_((A==null?null:A.openAbsences)!==null?19:-1),n(7),p("opened",!S.collapsed),n(),f(" ",m(28,23,"shared.profile.excused-absences")," "),n(2),_((A==null?null:A.excusedAbsences)!==null?29:-1),n(7),p("opened",!Ue.collapsed),n(),f(" ",m(38,25,"shared.profile.unexcused-absences")," "),n(2),_((A==null?null:A.unexcusedAbsences)!==null?39:-1),n(7),p("opened",!Qe.collapsed),n(),f(" ",m(48,27,"shared.profile.incidents")," "),n(2),_((A==null?null:A.incidents)!==null?49:-1),n(4),_(m(54,29,s.halfDayActive$)?53:-1)}},dependencies:[X,K,J,te,z,Y,Le,w,M],encapsulation:2,changeDetection:0})}}return e})();var ct=(e,o)=>o.apprenticeshipContract.Id,dt=(e,o)=>o.Id;function pt(e,o){if(e&1&&b(0,"bkd-student-dossier-legal-representative",9),e&2){let t=o.$implicit;p("person",t)}}function lt(e,o){if(e&1&&N(0,pt,1,1,"bkd-student-dossier-legal-representative",9,dt),e&2){l(3);let t=v(0);O(t.legalRepresentativePersons)}}function mt(e,o){if(e&1){let t=F();r(0,"div",4,0)(2,"div",5)(3,"bkd-student-dossier-entry-header",6),$("click",function(){k(t);let s=h(1);return D(s.toggle())}),u(4),d(5,"translate"),a()(),r(6,"div",7)(7,"div",8),c(8,lt,2,0,"ng-template"),a()()()}if(e&2){let t=h(1);n(3),p("opened",!t.collapsed),n(),f(" ",m(5,2,"shared.profile.legal-representation")," ")}}function ut(e,o){if(e&1&&u(0),e&2){let t=l().$index;f(" ",t+1," ")}}function ft(e,o){if(e&1&&b(0,"bkd-student-dossier-apprenticeship-company",10),e&2){let t=l().$implicit;p("company",t)}}function _t(e,o){if(e&1){let t=F();r(0,"div",4,1)(2,"div",5)(3,"bkd-student-dossier-entry-header",6),$("click",function(){k(t);let s=h(1);return D(s.toggle())}),u(4),d(5,"translate"),c(6,ut,1,1),a()(),r(7,"div",7)(8,"div",8),c(9,ft,1,1,"ng-template"),a()()()}if(e&2){let t=h(1);l(2);let i=v(0);n(3),p("opened",!t.collapsed),n(),f(" ",m(5,3,"shared.profile.apprenticeship-company")," "),n(2),_(i.apprenticeshipCompanies.length>1?6:-1)}}function bt(e,o){if(e&1&&(b(0,"bkd-student-dossier-address",2),r(1,"div",3),c(2,mt,9,4,"div",4),N(3,_t,10,5,"div",4,ct),a()),e&2){l();let t=v(0);p("student",t.student),n(2),_(t.legalRepresentativePersons.length>0?2:-1),n(),O(t.apprenticeshipCompanies)}}var Ne=(()=>{class e{constructor(t){this.state=t,this.state.currentDossier$.next("addresses")}static{this.\u0275fac=function(i){return new(i||e)(x(T))}}static{this.\u0275cmp=I({type:e,selectors:[["bkd-dossier-addresses"]],decls:3,vars:4,consts:[["legalRepresentatives","ngbAccordionItem"],["apprenticeshipCompanies","ngbAccordionItem"],[1,"profile-entry",3,"student"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],[3,"click","opened"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[1,"profile-entry",3,"person"],[1,"profile-entry",3,"company"]],template:function(i,s){if(i&1&&(g(0),d(1,"async"),c(2,bt,5,2)),i&2){let C=y(m(1,1,s.state.profile$));n(2),_(C?2:-1)}},dependencies:[Ee,X,K,J,te,z,Y,Ve,je,w,M],styles:[".profile-entry[_ngcontent-%COMP%]{display:block;padding:0 1rem}"],changeDetection:0})}}return e})();function vt(e,o){e&1&&b(0,"bkd-spinner")}function Ct(e,o){if(e&1&&b(0,"bkd-dossier-grades-view",0),e&2){l();let t=v(0),i=v(2),s=v(4);p("courses",t)("studentId",i)("gradingScales",s)}}var Oe=(()=>{class e{constructor(t,i){this.state=t,this.dossierGradesService=i,this.destroy$=new q}ngOnInit(){this.state.currentDossier$.next("grades"),this.state.studentId$.pipe(U(this.destroy$)).subscribe(t=>this.dossierGradesService.setStudentId(t))}ngOnDestroy(){this.destroy$.next()}static{this.\u0275fac=function(i){return new(i||e)(x(T),x(R))}}static{this.\u0275cmp=I({type:e,selectors:[["bkd-dossier-grades"]],decls:9,vars:12,consts:[[3,"courses","studentId","gradingScales"]],template:function(i,s){i&1&&(g(0),d(1,"async"),g(2),d(3,"async"),g(4),d(5,"async"),c(6,vt,1,0,"bkd-spinner"),d(7,"async"),c(8,Ct,1,3,"bkd-dossier-grades-view",0)),i&2&&(y(m(1,1,s.dossierGradesService.studentCourses$)),n(2),y(m(3,4,s.state.studentId$)),n(2),y(m(5,7,s.dossierGradesService.gradingScales$)),n(2),_(m(7,10,s.dossierGradesService.loading$)?6:8))},dependencies:[Fe,ee,w],encapsulation:2})}}return e})();var xt=["*"];function gt(e,o){if(e&1&&(r(0,"div",5)(1,"span",6),u(2),d(3,"date"),a(),r(4,"span",7),u(5),a()()),e&2){let t=l();n(2),H(ve(3,2,t.student.Birthdate,"dd.MM.yyyy")),n(3),f("(",t.student.Gender,")")}}var He=(()=>{class e{constructor(){this.link="/"}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=I({type:e,selectors:[["bkd-student-backlink"]],inputs:{link:"link",queryParams:"queryParams",studentId:"studentId",studentName:"studentName",student:"student"},ngContentSelectors:xt,decls:9,vars:5,consts:[[1,"d-flex","flex-column","w-100"],[3,"link","params"],[1,"d-flex","flex-row","align-items-start"],[1,"me-3","medium",3,"studentId"],[1,"d-flex","flex-column"],[1,"additional-info"],[1,"birthday"],[1,"gender"]],template:function(i,s){i&1&&(be(),r(0,"div",0)(1,"bkd-backlink",1),he(2),a(),r(3,"div",2),b(4,"bkd-avatar",3),r(5,"div",4)(6,"h1"),u(7),a(),c(8,gt,6,5,"div",5),a()()()),i&2&&(n(),p("link",s.link)("params",s.queryParams),n(3),p("studentId",s.studentId),n(3),H(s.student?s.student.FullName:s.studentName),n(),_(s.student?8:-1))},dependencies:[Re,Me,Ce],styles:["[_nghost-%COMP%]{display:flex;align-items:center;width:100%}h1[_ngcontent-%COMP%]{margin:-3px 0 0;display:flex;align-items:baseline;line-height:1}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}.gender[_ngcontent-%COMP%]{margin-left:.8ch}"],changeDetection:0})}}return e})();var yt=()=>["addresses","absences","grades"],St=()=>[],At=e=>({returnparams:e}),kt=e=>[e];function Dt(e,o){e&1&&b(0,"bkd-spinner")}function It(e,o){if(e&1&&b(0,"bkd-reports-link",3),e&2){let t;l(2);let i=v(4);p("reports",(t=i)!==null&&t!==void 0?t:re(1,St))}}function $t(e,o){if(e&1&&(r(0,"a",5),d(1,"async"),r(2,"button",6,0),u(4),d(5,"translate"),a()()),e&2){let t=o.$implicit,i=h(3),s=l(2);p("queryParams",ae(9,At,m(1,5,s.state.returnParams$)))("routerLink",ae(11,kt,t)),n(2),fe("btn-outline-secondary",!i.isActive),n(2),f(" ",m(5,7,"dossier."+t)," ")}}function Tt(e,o){e&1&&(r(0,"div"),b(1,"router-outlet"),a())}function Pt(e,o){e&1&&(r(0,"p"),u(1),d(2,"translate"),a()),e&2&&(n(),H(m(2,1,"shared.profile.no-profile")))}function Lt(e,o){if(e&1&&(r(0,"bkd-student-backlink",2),d(1,"async"),d(2,"async"),c(3,It,1,2,"bkd-reports-link",3),a(),r(4,"div",4),N(5,$t,6,13,"a",5,_e),a(),c(7,Tt,2,0,"div")(8,Pt,3,3,"p")),e&2){let t=l(),i=v(0),s=v(2);p("link","../..")("queryParams",m(1,6,t.state.backlinkQueryParams$))("studentId",m(2,8,t.state.studentId$))("student",i&&i.student),n(3),_(s==="grades"?3:-1),n(2),O(re(10,yt)),n(2),_(i?7:8)}}var qe=(()=>{class e{constructor(t,i){this.state=t,this.dossierGradesService=i,this.state.currentDossier$.next("addresses")}static{this.\u0275fac=function(i){return new(i||e)(x(T),x(R))}}static{this.\u0275cmp=I({type:e,selectors:[["bkd-student-dossier"]],features:[W([T,R])],decls:10,vars:12,consts:[["rla","routerLinkActive"],[1,"bkd-container","bkd-container-limited"],[1,"mb-2",3,"link","queryParams","studentId","student"],[1,"ms-2",3,"reports"],[1,"d-flex","flex-row","py-3","flex-wrap"],[1,"me-1","mt-1","me-sm-2",3,"queryParams","routerLink"],["data-test-id","dossier-section-button","type","button","routerLinkActive","btn-primary",1,"btn","btn-outline-secondary"]],template:function(i,s){i&1&&(g(0),d(1,"async"),g(2),d(3,"async"),g(4),d(5,"async"),r(6,"div",1),c(7,Dt,1,0,"bkd-spinner"),d(8,"async"),c(9,Lt,9,11),a()),i&2&&(y(m(1,1,s.state.profile$)),n(2),y(m(3,4,s.state.currentDossier$)),n(2),y(m(5,7,s.dossierGradesService.testReports$)),n(3),_(m(8,10,s.state.loading$)?7:9))},dependencies:[He,Pe,ye,Se,ge,ee,w,M],encapsulation:2,changeDetection:0})}}return e})();var Li={path:"student/:id",children:[{path:"",component:qe,children:[{path:"addresses",component:Ne},{path:"absences",component:Ge},{path:"grades",component:Oe}]},{path:"absences/confirm",component:$e}]};export{Li as a};
