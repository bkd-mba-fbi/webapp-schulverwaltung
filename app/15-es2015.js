(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"2TIA":function(e,t,n){"use strict";n.r(t),n.d(t,"PresenceControlModule",function(){return Ht});var s=n("PCNd"),c=n("tyNb"),i=n("XNiG"),r=n("1G5W"),o=n("G6Tw"),a=n("jIYg"),d=n("sWYD"),l=n("Muja"),p=n("BeL+"),b=n("2Vo4"),u=n("VRyK"),g=n("itXk"),h=n("PqYM"),f=n("/uUt"),m=n("eIep"),v=n("UXun"),O=n("lJxs"),y=n("JX91"),S=n("IzEk"),P=n("xbPD"),w=n("bHdf"),C=n("pLZG"),M=n("Xr/R"),j=n("kZPp"),I=n("PYvG"),$=n("t0ae"),D=n("AEFh"),k=n("AcjI"),R=n("v6cN"),L=n("CCnw"),T=n("mbak"),_=n("LuCL"),x=n("fXoL"),z=n("tk/3");let F=(()=>{class e extends T.a{constructor(e,t){super(e,t,_.a,"LessonTeachers")}loadOtherTeachersLessonAbsences(e,t,n){let s=`${this.baseUrl}/except/${e}/LessonAbsences?expand=LessonRef`;return t&&t.length>0&&(s=s.concat("&filter.StudentRef=;"+t.join(";"))),this.http.get(s,{params:n}).pipe(Object(m.a)(Object($.b)(_.a)))}}return e.\u0275fac=function(t){return new(t||e)(x.Zb(z.b),x.Zb(M.a))},e.\u0275prov=x.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var E=n("CqUA"),U=n("xHFS"),V=n("KJh6"),G=n("eB9A"),A=n("2jKe"),B=n("BzUC");function N(e,t){return null===e&&null===t||null!==e&&null!==t&&e.TeacherInformation===t.TeacherInformation&&e.LessonDateTimeFrom.getTime()===t.LessonDateTimeFrom.getTime()&&e.LessonDateTimeTo.getTime()===t.LessonDateTimeTo.getTime()}class Z{constructor(e,t,n){this.TeacherInformation=e,this.LessonDateTimeFrom=t,this.LessonDateTimeTo=n,this.lessons=[]}addLesson(e){this.lessons.some(t=>Object(B.d)(t,e))||(this.lessons.push(e),this.updateId(),this.updateStudyClassNumbers(),this.updateEventDesignations())}updateId(){this.id=[...new Set(this.lessons.map(e=>e.LessonRef.Id).sort())].join("-")}updateStudyClassNumbers(){this.studyClassNumbers=[...new Set(this.lessons.map(e=>e.StudyClassNumber).sort((e,t)=>e.localeCompare(t)))].join(", ")}updateEventDesignations(){this.eventDesignations=[...new Set(this.lessons.map(e=>e.EventDesignation).sort())].join(", ")}}var H=n("/Tr7");function K(e,t){Object(a.a)(2,arguments);var n=Object(H.a)(e),s=Object(H.a)(t);return n.getTime()<s.getTime()}function q(e,t){Object(a.a)(2,arguments);var n=Object(H.a)(e).getTime(),s=Object(H.a)(t.start).getTime(),c=Object(H.a)(t.end).getTime();if(!(s<=c))throw new RangeError("Invalid interval");return n>=s&&n<=c}function J(e){return function(e){return e.reduce((e,t)=>e.some(e=>Object(B.d)(e,t))?e:[...e,t],[])}(e).reduce((e,t,n)=>{const s=e.find(e=>N(e,t));if(s)return s.addLesson(Object(B.a)(t)),e;const c=function(e){const t=new Z(e.TeacherInformation,e.LessonDateTimeFrom,e.LessonDateTimeTo);return t.addLesson(e),t}(Object(B.a)(t));return[...e,c]},[]).sort(B.c)}function Q(e){if(0===e.length)return null;const t=new Date;if(e=[...e].sort(B.c),Object(o.a)(t,e[0].LessonDateTimeFrom)){for(const n of e)if(K(t,n.LessonDateTimeFrom)||q(t,{start:n.LessonDateTimeFrom,end:n.LessonDateTimeTo}))return n;return e[e.length-1]}return e[0]}var X=n("vlqf");function Y(e){return t=>t.reduce((t,n)=>t+(n.presenceCategory===e?1:0),0)}var W=n("jtHE"),ee=n("cp0P");function te(e,t){return[...e].sort(function(e){return(t,n)=>{switch(e.primarySortKey){case"name":const s=t.name.localeCompare(n.name);return e.ascending?-1*s:s;case"group":const c=(t.detail.Value||"").localeCompare(n.detail.Value||"");return e.ascending?-1*c:c}}}(t))}function ne(e,t){return e.map(e=>function(e,t){var n;return{id:e.IdPerson,name:(null===(n=t.find(t=>t.StudentRef.Id===e.IdPerson))||void 0===n?void 0:n.StudentFullName)||"",group:e.Value,detail:e}}(e,t))}function se(e,t){return e.find(e=>e.VssId===t.subscriptionDetailGroupId)}var ce=n("j+Kt"),ie=n("KVDH");const re=ce.p({Key:ce.n,Value:ce.n}),oe=ce.p({Id:ce.n,SubscriptionId:ce.k,VssId:ce.k,EventId:ce.k,DropdownItems:Object(ie.d)(ce.b(re)),IdPerson:ce.k,ShowAsRadioButtons:ce.c,Value:Object(ie.d)(ce.n)});let ae=(()=>{class e extends T.a{constructor(e,t){super(e,t,oe,"Events")}getSubscriptionDetails(e){return this.http.get(`${this.baseUrl}/${e}/SubscriptionDetails`).pipe(Object(m.a)(Object($.b)(this.codec)))}}return e.\u0275fac=function(t){return new(t||e)(x.Zb(z.b),x.Zb(M.a))},e.\u0275prov=x.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),de=(()=>{class e extends T.a{constructor(e,t){super(e,t,oe,"Subscriptions")}getListByRegistrationId(e){return this.http.get(`${this.baseUrl}/${e}/SubscriptionDetails`).pipe(Object(m.a)(Object($.b)(this.codec)))}}return e.\u0275fac=function(t){return new(t||e)(x.Zb(z.b),x.Zb(M.a))},e.\u0275prov=x.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var le=n("xWuZ");let pe=(()=>{class e{constructor(e,t,n,s,c){this.settingsService=e,this.eventService=t,this.subscriptionService=n,this.loadingService=s,this.settings=c,this.selectGroupView$=new i.a,this.selectedLesson$=new W.a,this.lessonPresences$=new W.a,this.reloadSubscriptionDetails$=new i.a,this.defaultGroupView={lessonId:null,group:null},this.savedGroupView$=this.loadSavedGroupView().pipe(Object(y.a)(this.defaultGroupView)),this.subscriptionsDetailsByEvents$=this.selectedLesson$.pipe(Object(O.a)(e=>[...new Set(null==e?void 0:e.lessons.map(e=>e.EventRef.Id))]),Object(m.a)(e=>Object(ee.a)(e.map(e=>this.eventService.getSubscriptionDetails(e)))),Object(v.a)(1)),this.selectedLessonRegistrationIds$=Object(g.a)([this.selectedLesson$,this.lessonPresences$]).pipe(Object(O.a)(([e,t])=>t.filter(t=>t.LessonRef.Id===Number(null==e?void 0:e.id))),Object(O.a)(e=>e.map(e=>e.RegistrationRef.Id).filter(e=>e))),this.subscriptionsDetailsByRegistrations$=Object(g.a)([this.selectedLessonRegistrationIds$,this.reloadSubscriptionDetails$.pipe(Object(y.a)(void 0))]).pipe(Object(m.a)(([e])=>Object(ee.a)(e.map(e=>this.loadSubscriptionDetails(e))))),this.subscriptionDetails$=this.subscriptionsDetailsByRegistrations$.pipe(Object(O.a)(le.a),Object(O.a)(e=>function(e,t){return e.filter(e=>e.VssId===t.subscriptionDetailGroupId)}(e,this.settings)),Object(v.a)(1)),this.groupView$=Object(u.a)(this.selectGroupView$,this.savedGroupView$).pipe(Object(v.a)(1)),this.subscriptionDetailPersonIds$=Object(g.a)([this.groupView$,this.subscriptionDetails$]).pipe(Object(O.a)(([e,t])=>t.filter(t=>t.Value===(null==e?void 0:e.group)).map(e=>e.IdPerson)),Object(y.a)([])),this.groupsAvailability$=this.subscriptionsDetailsByEvents$.pipe(Object(O.a)(e=>e.every(e=>se(e,this.settings))),Object(v.a)(1))}selectGroupView(e){this.selectGroupView$.next(e)}setSelectedLesson(e){this.selectedLesson$.next(e)}setLessonPresences(e){this.lessonPresences$.next(e)}getSubscriptionDetailForGroupEvent(){return this.subscriptionsDetailsByEvents$.pipe(Object(O.a)(le.a),Object(O.a)(e=>se(e,this.settings)))}getSubscriptionDetailsForStudents(){return Object(g.a)([this.subscriptionDetails$,this.lessonPresences$]).pipe(Object(O.a)(Object(G.a)(ne)))}reloadSubscriptionDetails(){this.reloadSubscriptionDetails$.next(void 0)}loadSubscriptionDetails(e){return this.loadingService.load(this.subscriptionService.getListByRegistrationId(e))}loadSavedGroupView(){return this.settingsService.getUserSettingsCst().pipe(Object(O.a)(e=>e.Settings),Object(w.a)(),Object(C.a)(e=>"presenceControlGroupView"===e.Key),Object(O.a)(e=>JSON.parse(e.Value)),Object(m.a)(Object($.a)(j.a)))}}return e.\u0275fac=function(t){return new(t||e)(x.Zb(I.a),x.Zb(ae),x.Zb(de),x.Zb(E.a),x.Zb(M.a))},e.\u0275prov=x.Ib({token:e,factory:e.\u0275fac}),e})();var be=n("ofXK"),ue=function(e){return e.Grid="grid",e.List="list",e}({});const ge=Object.keys(ue).map(e=>ue[e]);let he=(()=>{class e{constructor(e,t,n,s,c,o,a,d,p,h){this.settingsService=e,this.lessonPresencesService=t,this.lessonTeacherService=n,this.presenceTypesService=s,this.personsService=c,this.groupService=o,this.dropDownItemsService=a,this.loadingService=d,this.settings=p,this.location=h,this.selectedDateSubject$=new b.a(new Date),this.selectLesson$=new i.a,this.viewModeSubject$=new i.a,this.updateLessonPresences$=new i.a,this.lessonPresences$=Object(u.a)(this.selectedDateSubject$.pipe(Object(f.a)(l.a),Object(m.a)(this.loadLessonPresencesByDate.bind(this))),this.updateLessonPresences$).pipe(Object(v.a)(1)),this.presenceTypes$=this.loadPresenceTypes().pipe(Object(v.a)(1)),this.lessons$=this.lessonPresences$.pipe(Object(O.a)(J),Object(v.a)(1)),this.currentLesson$=this.lessons$.pipe(Object(O.a)(Q),Object(f.a)(N)),this.studentIdsWithUnconfirmedAbsences$=this.selectedDateSubject$.pipe(Object(m.a)(()=>this.loadStudentIdsWithUnconfirmedAbsences()),Object(v.a)(1)),this.loading$=this.loadingService.loading$,this.selectedLesson$=Object(u.a)(this.currentLesson$,this.selectLesson$).pipe(Object(v.a)(1)),this.absenceConfirmationStates$=this.dropDownItemsService.getAbsenceConfirmationStates().pipe(Object(v.a)(1)),this.selectedLessonStudentIds$=Object(g.a)([this.selectLesson$,this.lessonPresences$]).pipe(Object(O.a)(([e,t])=>t.filter(t=>t.LessonRef.Id===Number(null==e?void 0:e.id))),Object(O.a)(e=>e.map(e=>e.StudentRef.Id)),Object(v.a)(1)),this.otherTeachersAbsences$=Object(g.a)([this.personsService.getMyself(),this.selectedLessonStudentIds$.pipe(Object(y.a)([]))]).pipe(Object(m.a)(([e,t])=>this.lessonTeacherService.loadOtherTeachersLessonAbsences(e.Id,t)),Object(v.a)(1)),this.groupsAvailability$=this.groupService.groupsAvailability$,this.selectedPresenceControlEntries$=Object(g.a)([this.selectedLesson$,this.lessonPresences$,this.presenceTypes$,this.absenceConfirmationStates$,this.otherTeachersAbsences$]).pipe(Object(O.a)(Object(G.a)(B.b))),this.selectedPresenceControlEntriesByGroup$=Object(g.a)([this.groupService.groupView$,this.selectedPresenceControlEntries$,this.groupService.subscriptionDetailPersonIds$,this.selectedLesson$]).pipe(Object(O.a)(Object(G.a)(A.b)),Object(v.a)(1)),this.presentCount$=this.selectedPresenceControlEntriesByGroup$.pipe(Object(O.a)(Y("present"))),this.absentCount$=this.selectedPresenceControlEntriesByGroup$.pipe(Object(O.a)(Y("absent"))),this.unapprovedCount$=this.selectedPresenceControlEntriesByGroup$.pipe(Object(O.a)(Y("unapproved"))),this.absentPrecedingCount$=this.selectedPresenceControlEntriesByGroup$.pipe(Object(O.a)(e=>e.reduce((e,t)=>e+(t.precedingAbsences&&t.precedingAbsences.length>0?1:0),0))),this.viewMode$=Object(u.a)(this.viewModeSubject$,this.getSavedViewMode().pipe(Object(S.a)(1),Object(P.a)(ue.Grid))),this.selectedDate$=this.selectedDateSubject$.asObservable(),this.queryParamsString$=Object(g.a)([this.selectedDate$,this.selectedLesson$,this.viewMode$]).pipe(Object(O.a)(Object(G.a)(this.buildQueryParams.bind(this))),Object(O.a)(D.c)),this.destroy$=new i.a,this.queryParamsString$.pipe(Object(r.a)(this.destroy$)).subscribe(e=>{this.location.replaceState("/presence-control",e),this.confirmBackLinkParams={returnparams:e}}),this.viewModeSubject$.pipe(Object(r.a)(this.destroy$),Object(f.a)(),Object(m.a)(e=>this.updateSavedViewMode(e))).subscribe(),this.selectedLesson$.pipe(Object(r.a)(this.destroy$)).subscribe(e=>this.groupService.setSelectedLesson(e)),this.lessonPresences$.pipe(Object(r.a)(this.destroy$)).subscribe(e=>this.groupService.setLessonPresences(e))}ngOnDestroy(){this.destroy$.next()}setDate(e){this.selectedDateSubject$.next(e)}setLesson(e){this.selectLesson$.next(e)}setViewMode(e){this.viewModeSubject$.next(e)}updateLessonPresencesTypes(e){Object(g.a)([this.lessonPresences$.pipe(Object(S.a)(1)),this.presenceTypes$.pipe(Object(S.a)(1))]).pipe(Object(O.a)(([t,n])=>function(e,t,n,s){return e.map(e=>{const c=t.find(t=>{return(n=t.presence).LessonRef.Id===(s=e).LessonRef.Id&&n.StudentRef.Id===s.StudentRef.Id;var n,s});if(c){let t;return t=!c.newPresenceTypeId&&e.Comment?n.find(e=>e.IsComment)||null:n.find(e=>e.Id===c.newPresenceTypeId)||null,Object.assign(Object.assign({},e),{TypeRef:(i=t,{Id:i?i.Id:null,HRef:null}),Date:null,Type:t?t.Designation:null,ConfirmationStateId:Object(X.b)(t,s)})}var i;return e})}(t,e,n,this.settings))).subscribe(e=>this.updateLessonPresences$.next(e))}getNextPresenceType(e){return this.presenceTypes$.pipe(Object(S.a)(1),Object(O.a)(t=>e.getNextPresenceType(t)))}hasUnconfirmedAbsences(e){return this.studentIdsWithUnconfirmedAbsences$.pipe(Object(O.a)(t=>t.includes(e.lessonPresence.StudentRef.Id)))}getBlockLessonPresences(e){return Object(g.a)([this.lessonPresences$.pipe(Object(S.a)(1)),this.presenceTypes$.pipe(Object(S.a)(1))]).pipe(Object(O.a)(([t,n])=>t.filter(t=>t.TeacherInformation===e.lessonPresence.TeacherInformation&&t.StudentRef.Id===e.lessonPresence.StudentRef.Id&&Object(X.a)(t,n.find(e=>e.Id===t.TypeRef.Id)||null,this.settings)).sort((e,t)=>e.LessonDateTimeFrom>t.LessonDateTimeFrom?1:-1).reduce((t,n)=>this.isPartOfBlock(n,t[t.length-1])?(t.push(n),t):t.find(t=>t.Id===e.lessonPresence.Id)?t:[n],[])))}isPartOfBlock(e,t){return!t||e.LessonDateTimeFrom.getTime()-t.LessonDateTimeTo.getTime()<=18e5}loadLessonPresencesByDate(e){return this.loadingService.load(function(e){return Object(a.a)(1,arguments),Object(o.a)(e,Date.now())}(e)?this.lessonPresencesService.getListForToday():this.lessonPresencesService.getListByDate(e))}loadPresenceTypes(){return this.loadingService.load(this.presenceTypesService.presenceTypes$)}loadStudentIdsWithUnconfirmedAbsences(){return Object(h.a)(0,this.settings.unconfirmedAbsencesRefreshTime||void 0).pipe(Object(m.a)(()=>this.lessonPresencesService.getListOfUnconfirmed()),Object(O.a)(e=>Object(p.a)(e.map(e=>e.StudentRef.Id))))}buildQueryParams(e,t,n){const s={date:Object(d.a)(e,"yyyy-MM-dd"),viewMode:n};return t&&(s.lesson=String(t.id)),s}getSavedViewMode(){return this.settingsService.getUserSettingsCst().pipe(Object(O.a)(e=>e.Settings),Object(w.a)(),Object(C.a)(e=>"presenceControlViewMode"===e.Key),Object(S.a)(1),Object(O.a)(e=>JSON.parse(e.Value)),Object(m.a)(Object($.a)(j.e)),Object(O.a)(e=>this.getViewModeForString(e.presenceControl)),Object(v.a)())}getViewModeForString(e){return e===ue.List?ue.List:ue.Grid}updateSavedViewMode(e){const t={Key:"presenceControlViewMode",Value:JSON.stringify({presenceControl:e})},n=Object.assign({},Object(k.a)());return n.Settings.push(t),this.settingsService.updateUserSettingsCst(n)}}return e.\u0275fac=function(t){return new(t||e)(x.Zb(I.a),x.Zb(L.a),x.Zb(F),x.Zb(V.a),x.Zb(U.a),x.Zb(pe),x.Zb(R.a),x.Zb(E.a),x.Zb(M.a),x.Zb(be.i))},e.\u0275prov=x.Ib({token:e,factory:e.\u0275fac}),e})();var fe=n("LRne"),me=n("Kqap"),ve=n("w1tV"),Oe=n("Kj3r"),ye=n("bOdf"),Se=n("CqXF"),Pe=n("JIr8"),we=n("PduT"),Ce=n("8teX"),Me=n("K+0v"),je=n("LpL1"),Ie=n("5eHb"),$e=n("sYmb"),De=function(e){return e.AddUpdateAction="ADD",e.RemoveUpdateAction="REMOVE",e}({});let ke=(()=>{class e{constructor(e,t,n,s,c){this.toastr=e,this.translate=t,this.restService=n,this.presenceTypesService=s,this.settings=c,this.destroy$=new i.a,this.action$=new i.a,this.pendingUpdates$=this.action$.pipe(Object(me.a)(this.reduceUpdates.bind(this),[]),Object(ve.a)()),this.revertUpdates$=new i.a,this.performUpdates$=this.pendingUpdates$.pipe(Object(Oe.a)(3e3),Object(C.a)(Object(Me.d)(Ce.b)),Object(ye.a)(this.performUpdates.bind(this))),this.stateUpdates$=Object(u.a)(this.pendingUpdates$,this.revertUpdates$).pipe(Object(Oe.a)(20),Object(C.a)(Object(Me.d)(Ce.b))),this.performUpdates$.pipe(Object(r.a)(this.destroy$)).subscribe()}ngOnDestroy(){this.destroy$.next()}updatePresenceTypes(e,t=null){e.forEach(e=>this.dispatchAddUpdate(e,t))}performUpdates(e){const t=this.groupUpdates(e);return Object(g.a)(Object.keys(t).reduce((e,n)=>{const s=t[n];return Object.keys(s).forEach(t=>{e.push(this.performUpdateForGroup(s[t]))}),e},[])).pipe(Object(Se.a)(t))}performUpdateForGroup(e){return e.forEach(e=>this.dispatchRemoveUpdate(e.presence)),this.performLessonPresencesUpdatesByIds(e[0].presence.LessonRef.Id,e.map(e=>e.presence.StudentRef.Id),e[0].newPresenceTypeId).pipe(Object(Pe.a)(t=>this.revertUpdatesAfterError(e,t)))}performLessonPresencesUpdatesByIds(e,t,n=null){return n?(n?this.presenceTypesService.getPresenceType(n):Object(fe.a)(null)).pipe(Object(m.a)(n=>this.restService.editLessonPresences([e],t,null==n?void 0:n.Id,Object(X.b)(n,this.settings)||void 0,Object(we.b)({disableErrorHandling:!0})))):this.restService.removeLessonPresences([e],t,Object(we.b)({disableErrorHandling:!0}))}revertUpdatesAfterError(e,t){return console.error("Bulk-update of lesson presences failed"),console.error(t),this.toastr.error(this.translate.instant("shared.lesson-presences-update.error")),this.revertUpdates$.next(e.map(e=>Object.assign(Object.assign({},e),{newPresenceTypeId:e.presence.TypeRef.Id}))),Object(fe.a)(void 0)}groupUpdates(e){return e.reduce((e,t)=>{const n=String(t.newPresenceTypeId&&t.newPresenceTypeId);return e[n]||(e[n]={}),Array.isArray(e[n][t.presence.LessonRef.Id])||(e[n][t.presence.LessonRef.Id]=[]),e[n][t.presence.LessonRef.Id].push(t),e},{})}reduceUpdates(e,t){switch(t.type){case De.AddUpdateAction:const{presence:n,newPresenceTypeId:s}=t.payload,c=e.findIndex(Re(n));return-1===c?[...e,{presence:n,newPresenceTypeId:s}]:[...e.slice(0,c),{presence:e[c].presence,newPresenceTypeId:s},...e.slice(c+1)];case De.RemoveUpdateAction:return e.filter(Object(Me.d)(Re(t.payload)));default:return e}}dispatchAddUpdate(e,t){this.action$.next({type:De.AddUpdateAction,payload:{presence:e,newPresenceTypeId:t}})}dispatchRemoveUpdate(e){this.action$.next({type:De.RemoveUpdateAction,payload:e})}}return e.\u0275fac=function(t){return new(t||e)(x.Zb(Ie.b),x.Zb($e.d),x.Zb(je.a),x.Zb(V.a),x.Zb(M.a))},e.\u0275prov=x.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Re(e){return t=>t.presence.LessonRef.Id===e.LessonRef.Id&&t.presence.StudentRef.Id===e.StudentRef.Id}var Le=n("qUtt"),Te=n("0HM3");let _e=(()=>{class e{constructor(e,t){this.state=e,this.lessonPresencesUpdateService=t,this.destroy$=new i.a}ngOnInit(){this.lessonPresencesUpdateService.stateUpdates$.pipe(Object(r.a)(this.destroy$)).subscribe(e=>this.state.updateLessonPresencesTypes(e))}ngOnDestroy(){this.destroy$.next()}}return e.\u0275fac=function(t){return new(t||e)(x.Mb(he),x.Mb(ke))},e.\u0275cmp=x.Gb({type:e,selectors:[["erz-presence-control"]],features:[x.yb([he,pe,{provide:Le.a,useExisting:he},{provide:Te.a,useValue:"/presence-control"}])],decls:1,vars:0,template:function(e,t){1&e&&x.Nb(0,"router-outlet")},directives:[c.k],styles:[""],changeDetection:0}),e})();var xe=n("jiSq"),ze=(n("RYjX"),n("1kSV")),Fe=n("3Pt+");function Ee(e,t){if(1&e&&(x.Sb(0,"div",5),x.Sb(1,"input",6),x.dc("change",function(){const e=t.$implicit;return e.selected=!e.selected}),x.Rb(),x.Sb(2,"label",7),x.Dc(3),x.gc(4,"date"),x.gc(5,"date"),x.Rb(),x.Rb()),2&e){const e=t.$implicit,n=t.index,s=x.fc();x.zb(1),x.nc("id","lesson-presence-",n,""),x.lc("checked",e.selected),x.zb(1),x.Eb("font-weight-bold",e.lessonPresence.LessonDateTimeFrom===s.entry.lessonPresence.LessonDateTimeFrom),x.nc("for","lesson-presence-",n,""),x.zb(1),x.Hc(" ",x.ic(4,8,e.lessonPresence.LessonDateTimeFrom,"HH:mm"),"\u2013",x.ic(5,11,e.lessonPresence.LessonDateTimeTo,"HH:mm")," ",e.lessonPresence.EventDesignation,"")}}let Ue=(()=>{class e{constructor(e){this.activeModal=e,this.lessonPresenceOptions=[]}ngOnInit(){this.lessonPresenceOptions=this.blockLessonPresences.map(e=>this.createLessonPresenceOption(e))}getSelectedLessonPresences(){return this.lessonPresenceOptions.filter(e=>e.selected).map(e=>e.lessonPresence)}createLessonPresenceOption(e){return{lessonPresence:e,selected:!0}}}return e.\u0275fac=function(t){return new(t||e)(x.Mb(ze.b))},e.\u0275cmp=x.Gb({type:e,selectors:[["erz-presence-control-block-lesson-component"]],inputs:{entry:"entry",blockLessonPresences:"blockLessonPresences"},decls:13,vars:11,consts:[[1,"modal-body"],["class","form-group form-check",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"form-group","form-check"],["type","checkbox",1,"form-check-input",3,"id","checked","change"],[1,"form-check-label","d-block","text-truncate",3,"for"]],template:function(e,t){1&e&&(x.Sb(0,"div",0),x.Sb(1,"p"),x.Dc(2),x.gc(3,"translate"),x.Rb(),x.Sb(4,"form"),x.Bc(5,Ee,6,14,"div",1),x.Rb(),x.Rb(),x.Sb(6,"div",2),x.Sb(7,"button",3),x.dc("click",function(){return t.activeModal.close()}),x.Dc(8),x.gc(9,"translate"),x.Rb(),x.Sb(10,"button",4),x.dc("click",function(){return t.activeModal.close(t.getSelectedLessonPresences())}),x.Dc(11),x.gc(12,"translate"),x.Rb(),x.Rb()),2&e&&(x.zb(2),x.Fc(" ",x.hc(3,5,"presence-control.block-lesson.text")," "),x.zb(3),x.lc("ngForOf",t.lessonPresenceOptions),x.zb(3),x.Fc(" ",x.hc(9,7,"presence-control.block-lesson.cancel")," "),x.zb(2),x.lc("disabled",0===t.getSelectedLessonPresences().length),x.zb(1),x.Fc(" ",x.hc(12,9,"presence-control.block-lesson.save")," "))},directives:[Fe.r,Fe.j,Fe.k,be.l],pipes:[$e.c,be.e],encapsulation:2}),e})();var Ve=n("yl8S"),Ge=n("KCaQ");function Ae(e,t){if(1&e){const e=x.Tb();x.Sb(0,"div",5),x.Sb(1,"input",6),x.dc("change",function(){x.vc(e);const n=t.$implicit;return x.fc().onSelectionChange(n)}),x.Rb(),x.Sb(2,"label",7),x.Dc(3),x.Rb(),x.Rb()}if(2&e){const e=t.$implicit,n=t.index,s=x.fc();x.zb(1),x.nc("id","incident-",n,""),x.lc("checked",e.id===s.selected.id)("value",e.id),x.zb(1),x.nc("for","incident-",n,""),x.zb(1),x.Fc(" ",e.label," ")}}let Be=(()=>{class e{constructor(e,t){this.activeModal=e,this.translate=t,this.incidentOptions=[]}ngOnInit(){const e=this.createIncidentOption();this.incidentOptions=this.incidentTypes.map(e=>this.createIncidentOption(e)),this.incidentOptions.unshift(e),this.selected=this.incidentOptions.find(e=>{var t;return e.id===(null===(t=this.incident)||void 0===t?void 0:t.Id)})||e}createIncidentOption(e){return{id:e?e.Id:null,label:e?e.Designation:this.translate.instant("presence-control.incident.no-incident")}}onSelectionChange(e){this.selected=e}getSelectedIncident(){return this.incidentTypes.find(e=>{var t;return e.Id===(null===(t=this.selected)||void 0===t?void 0:t.id)})||null}}return e.\u0275fac=function(t){return new(t||e)(x.Mb(ze.b),x.Mb($e.d))},e.\u0275cmp=x.Gb({type:e,selectors:[["erz-presence-control-incident"]],inputs:{incident:"incident",incidentTypes:"incidentTypes"},decls:13,vars:10,consts:[[1,"modal-body"],["class","form-group form-check",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"form-group","form-check"],["type","radio","name","incident",1,"form-check-input",3,"id","checked","value","change"],[1,"form-check-label",3,"for"]],template:function(e,t){1&e&&(x.Sb(0,"div",0),x.Sb(1,"p"),x.Dc(2),x.gc(3,"translate"),x.Rb(),x.Sb(4,"form"),x.Bc(5,Ae,4,5,"div",1),x.Rb(),x.Rb(),x.Sb(6,"div",2),x.Sb(7,"button",3),x.dc("click",function(){return t.activeModal.dismiss()}),x.Dc(8),x.gc(9,"translate"),x.Rb(),x.Sb(10,"button",4),x.dc("click",function(){return t.activeModal.close(t.getSelectedIncident())}),x.Dc(11),x.gc(12,"translate"),x.Rb(),x.Rb()),2&e&&(x.zb(2),x.Fc(" ",x.hc(3,4,"presence-control.incident.text")," "),x.zb(3),x.lc("ngForOf",t.incidentOptions),x.zb(3),x.Fc(" ",x.hc(9,6,"presence-control.incident.cancel")," "),x.zb(3),x.Fc(" ",x.hc(12,8,"presence-control.incident.save")," "))},directives:[Fe.r,Fe.j,Fe.k,be.l],pipes:[$e.c],styles:["form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding-bottom:.75rem;border-bottom:1px solid #e9ecef}"]}),e})();var Ne=n("EOpz"),Ze=n("YDIV"),He=n("U+jE");function Ke(e,t){if(1&e){const e=x.Tb();x.Sb(0,"div",22),x.dc("click",function(){return x.vc(e),x.fc().lessonDropdown.toggle()}),x.Dc(1),x.gc(2,"date"),x.Sb(3,"span",23),x.Dc(4),x.gc(5,"date"),x.Rb(),x.Rb()}if(2&e){const e=x.fc();x.zb(1),x.Fc(" ",x.ic(2,2,e.selectedLesson.LessonDateTimeFrom,"HH:mm"),"\u2013"),x.zb(3),x.Ec(x.ic(5,5,e.selectedLesson.LessonDateTimeTo,"HH:mm"))}}function qe(e,t){if(1&e){const e=x.Tb();x.Sb(0,"div",29),x.dc("click",function(){x.vc(e);const n=t.$implicit;return x.fc(2).selectLessonChange.emit(n)}),x.Sb(1,"div",30),x.Sb(2,"div"),x.Dc(3),x.gc(4,"date"),x.gc(5,"date"),x.Rb(),x.Sb(6,"div",26),x.Dc(7),x.Rb(),x.Sb(8,"div",26),x.Dc(9),x.Rb(),x.Rb(),x.Rb()}if(2&e){const e=t.$implicit,n=x.fc(2);x.Eb("active",e.id===n.selectedLesson.id),x.zb(3),x.Gc(" ",x.ic(4,6,e.LessonDateTimeFrom,"HH:mm"),"\u2013",x.ic(5,9,e.LessonDateTimeTo,"HH:mm")," "),x.zb(4),x.Ec(e.eventDesignations),x.zb(2),x.Ec(e.studyClassNumbers)}}function Je(e,t){if(1&e&&(x.Sb(0,"div",24),x.Sb(1,"div",25),x.Sb(2,"div",26),x.Dc(3),x.Rb(),x.Sb(4,"div",26),x.Dc(5),x.Rb(),x.Rb(),x.Sb(6,"div",27),x.Bc(7,qe,10,12,"div",28),x.Rb(),x.Rb()),2&e){const e=x.fc();x.zb(3),x.Ec(e.selectedLesson.eventDesignations),x.zb(2),x.Ec(e.selectedLesson.studyClassNumbers),x.zb(2),x.lc("ngForOf",e.lessons)}}function Qe(e,t){if(1&e){const e=x.Tb();x.Sb(0,"button",31),x.dc("click",function(){x.vc(e);const t=x.fc();return null==t.lessonDropdown?null:t.lessonDropdown.toggle()}),x.Sb(1,"i",3),x.Dc(2),x.Rb(),x.Rb()}if(2&e){const e=x.fc();x.zb(2),x.Fc(" ",null!=e.lessonDropdown&&e.lessonDropdown.isOpen()?"keyboard_arrow_up":"keyboard_arrow_down"," ")}}const Xe=function(e){return["groups",e]},Ye=function(e){return{returnparams:e}};function We(e,t){if(1&e&&(x.Sb(0,"a",32),x.gc(1,"async"),x.Sb(2,"i",33),x.Dc(3,"groups"),x.Rb(),x.Rb()),2&e){const e=x.fc();x.lc("routerLink",x.pc(4,Xe,e.selectedLesson.id))("queryParams",x.pc(6,Ye,x.hc(1,2,e.state.queryParamsString$)))}}function et(e,t){if(1&e){const e=x.Tb();x.Sb(0,"button",34),x.dc("click",function(){x.vc(e);const n=t.$implicit;return x.fc().viewModeChange.emit(n.viewMode)}),x.Sb(1,"i",33),x.Dc(2),x.Rb(),x.Rb()}if(2&e){const e=t.$implicit,n=x.fc();x.Eb("btn-secondary",e.viewMode===n.viewMode)("btn-link",e.viewMode!==n.viewMode)("active",e.viewMode===n.viewMode),x.lc("disabled",!n.selectedLesson),x.zb(2),x.Ec(e.icon)}}const tt=ze.f.prototype._positionMenu;ze.f.prototype._positionMenu=function(...e){var t;const n=tt.apply(this,e);if("lesson-dropdown"===this._anchor.nativeElement.id){const e=this._bodyContainer||this._menu.nativeElement,n=null===(t=e.style.transform)||void 0===t?void 0:t.match(/translate\(([0-9-\.]+)px, ([0-9-\.]+)px\)/);n&&parseFloat(n[1])<0&&(e.style.transform=`translate(0px, ${n[2]}px)`)}return n};let nt=(()=>{class e{constructor(e){this.state=e,this.presentCount=null,this.absentCount=null,this.unapprovedCount=null,this.absentPrecedingCount=null,this.search="",this.selectLessonChange=new x.n,this.selectDateChange=new x.n,this.searchChange=new x.n,this.viewModeChange=new x.n,this.viewModeOptions=[{viewMode:ue.List,icon:"list"},{viewMode:ue.Grid,icon:"view_module"}]}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(x.Mb(he))},e.\u0275cmp=x.Gb({type:e,selectors:[["erz-presence-control-header"]],viewQuery:function(e,t){if(1&e&&x.Jc(ze.f,1),2&e){let e;x.tc(e=x.ec())&&(t.lessonDropdown=e.first)}},inputs:{selectedLesson:"selectedLesson",lessons:"lessons",presentCount:"presentCount",absentCount:"absentCount",unapprovedCount:"unapprovedCount",absentPrecedingCount:"absentPrecedingCount",viewMode:"viewMode",selectDate:"selectDate",search:"search"},outputs:{selectLessonChange:"selectLessonChange",selectDateChange:"selectDateChange",searchChange:"searchChange",viewModeChange:"viewModeChange"},features:[x.yb([{provide:ze.c,useClass:ze.d},{provide:ze.e,useClass:Ze.a}])],decls:40,vars:20,consts:[[1,"navigation"],[1,"lesson-date"],["type","button",1,"btn","btn-link",3,"click"],[1,"material-icons"],["placement","bottom","positionTarget",".lesson-date-input","ngbDatepicker","",1,"lesson-date-input",3,"ngModel","ngModelChange"],["d","ngbDatepicker"],["class","lesson-time",3,"click",4,"ngIf"],["ngbDropdown","","class","lesson-description","container","body","display","dynamic","placement","bottom",4,"ngIf"],["type","button","class","dropdown-caret btn btn-link",3,"click",4,"ngIf"],[1,"states"],[1,"state","present"],[1,"count"],[1,"state","absent"],[1,"state","unapproved"],[1,"state","previously-absent"],[1,"material-icons-outlined"],[1,"search-and-views"],[1,"search",3,"value","disabled","placeholder","label","valueChange"],[1,"group-and-views","d-flex"],["type","button","class","group btn btn-link pr-xs-0 pr-sm-4",3,"routerLink","queryParams",4,"ngIf"],[1,"views"],["type","button","class","view btn",3,"disabled","btn-secondary","btn-link","active","click",4,"ngFor","ngForOf"],[1,"lesson-time",3,"click"],[1,"lesson-time-to"],["ngbDropdown","","container","body","display","dynamic","placement","bottom",1,"lesson-description"],["id","lesson-dropdown","ngbDropdownToggle",""],[1,"text-truncate"],["ngbDropdownMenu","","aria-labelledby","lesson-dropdown"],["ngbDropdownItem","",3,"active","click",4,"ngFor","ngForOf"],["ngbDropdownItem","",3,"click"],[1,"lesson-entry"],["type","button",1,"dropdown-caret","btn","btn-link",3,"click"],["type","button",1,"group","btn","btn-link","pr-xs-0","pr-sm-4",3,"routerLink","queryParams"],[1,"material-icons","align-middle"],["type","button",1,"view","btn",3,"disabled","click"]],template:function(e,t){if(1&e){const e=x.Tb();x.Sb(0,"div",0),x.Sb(1,"div",1),x.Sb(2,"button",2),x.dc("click",function(){return x.vc(e),x.uc(6).toggle()}),x.Sb(3,"i",3),x.Dc(4,"calendar_today"),x.Rb(),x.Rb(),x.Sb(5,"input",4,5),x.dc("ngModelChange",function(e){return t.selectDateChange.emit(e)}),x.Rb(),x.Rb(),x.Bc(7,Ke,6,8,"div",6),x.Bc(8,Je,8,3,"div",7),x.Bc(9,Qe,3,1,"button",8),x.Rb(),x.Sb(10,"div",9),x.Sb(11,"div",10),x.Sb(12,"i",3),x.Dc(13,"check_circle"),x.Rb(),x.Sb(14,"span",11),x.Dc(15),x.Rb(),x.Rb(),x.Sb(16,"div",12),x.Sb(17,"i",3),x.Dc(18,"cancel"),x.Rb(),x.Sb(19,"span",11),x.Dc(20),x.Rb(),x.Rb(),x.Sb(21,"div",13),x.Sb(22,"i",3),x.Dc(23,"help"),x.Rb(),x.Sb(24,"span",11),x.Dc(25),x.Rb(),x.Rb(),x.Sb(26,"div",14),x.Sb(27,"i",15),x.Dc(28,"info"),x.Rb(),x.Sb(29,"span",11),x.Dc(30),x.Rb(),x.Rb(),x.Rb(),x.Sb(31,"div",16),x.Sb(32,"erz-resettable-input",17),x.dc("valueChange",function(e){return t.searchChange.emit(e)}),x.gc(33,"translate"),x.gc(34,"translate"),x.Rb(),x.Sb(35,"div",18),x.Bc(36,We,4,8,"a",19),x.gc(37,"async"),x.Sb(38,"div",20),x.Bc(39,et,3,8,"button",21),x.Rb(),x.Rb(),x.Rb()}2&e&&(x.zb(5),x.lc("ngModel",t.selectDate),x.zb(2),x.lc("ngIf",t.selectedLesson),x.zb(1),x.lc("ngIf",t.selectedLesson),x.zb(1),x.lc("ngIf",t.lessons.length>0),x.zb(6),x.Ec(null!=t.presentCount?t.presentCount:"?"),x.zb(5),x.Ec(null!=t.absentCount?t.absentCount:"?"),x.zb(5),x.Ec(null!=t.unapprovedCount?t.unapprovedCount:"?"),x.zb(5),x.Ec(null!=t.absentPrecedingCount?t.absentPrecedingCount:"?"),x.zb(2),x.lc("value",t.search)("disabled",!t.selectedLesson)("placeholder",x.hc(33,14,"presence-control.header.search-by-name"))("label",x.hc(34,16,"presence-control.header.search")),x.zb(4),x.lc("ngIf",x.hc(37,18,t.state.groupsAvailability$)),x.zb(3),x.lc("ngForOf",t.viewModeOptions))},directives:[ze.j,Fe.b,Fe.i,Fe.l,be.m,He.a,be.l,ze.f,ze.i,ze.h,ze.g,c.i],pipes:[$e.c,be.b,be.e],styles:['[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1.125rem 1.5rem}.navigation[_ngcontent-%COMP%]{display:grid;grid-template-areas:". date time dropdown-caret" ". description description dropdown-caret";grid-template-columns:1fr auto auto 1fr}.lesson-date[_ngcontent-%COMP%]{grid-area:date;justify-self:end;display:flex;align-items:center;justify-content:end}.lesson-date[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0 .5ch 0 0}.lesson-date[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#33333d;position:relative;top:2px}.lesson-date-input[_ngcontent-%COMP%]{font-weight:600;background:transparent;border:none;width:11ch}.lesson-time[_ngcontent-%COMP%]{grid-area:time;cursor:pointer}.lesson-description[_ngcontent-%COMP%]{grid-area:description;overflow:hidden;text-align:center;cursor:pointer}.dropdown-toggle[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.dropdown-caret[_ngcontent-%COMP%]{grid-area:dropdown-caret;line-height:100%;text-align:left;color:#33333d}.dropdown-menu[_ngcontent-%COMP%]{width:50ch;padding:0;box-shadow:2px 2px 3px -1px rgba(0,0,0,.2)}@media (max-width:800px){.dropdown-menu[_ngcontent-%COMP%]{width:100vw}}.dropdown-item[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid #dee2e6}.states[_ngcontent-%COMP%]{margin:1.125rem 0;display:flex;justify-content:center}.state[_ngcontent-%COMP%]{margin-right:7%;display:flex}.state[_ngcontent-%COMP%]:last-child{margin-right:0}@media (min-width:1000px){.state[_ngcontent-%COMP%]{margin-right:6rem}}.state.present[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#28a745}.state.absent[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#dc3545}.state.unapproved[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#ffa814}.state.previously-absent[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:rgba(51,51,61,.5)}.state[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{margin-left:.3em;margin-top:1px}.search-and-views[_ngcontent-%COMP%]{padding-top:1.125rem;display:flex;justify-content:space-between;border-top:1px solid #e9ecef}.search[_ngcontent-%COMP%]{flex:auto;max-width:300px;margin-right:1.5rem}.views[_ngcontent-%COMP%]{display:flex}.view[_ngcontent-%COMP%]{padding:.25rem;color:#6c757d}.view.active[_ngcontent-%COMP%]{color:#33333d}.group[_ngcontent-%COMP%]{color:#6c757d}@media (max-width:380px){[_nghost-%COMP%]{padding-left:.75rem;padding-right:.75rem}#search-addon[_ngcontent-%COMP%]{padding-left:.5rem;padding-right:.5rem}}@media (max-width:365px){.lesson-time[_ngcontent-%COMP%]{line-height:1}.lesson-time-to[_ngcontent-%COMP%]{display:block}.dropdown-caret[_ngcontent-%COMP%]{padding-left:0}}']}),e})();var st=n("6UOe");function ct(e,t){if(1&e&&(x.Sb(0,"div"),x.Dc(1),x.gc(2,"date"),x.gc(3,"date"),x.gc(4,"addSpace"),x.Rb()),2&e){const e=t.$implicit;x.zb(1),x.Ic(" ",x.ic(2,5,e.LessonRef.From,"HH:mm"),"\u2013",x.ic(3,8,e.LessonRef.To,"HH:mm")," ",e.LessonRef.EventDesignation,"",x.ic(4,11,":",":")," ",e.Type," ")}}let it=(()=>{class e{constructor(e){this.activeModal=e}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(x.Mb(ze.b))},e.\u0275cmp=x.Gb({type:e,selectors:[["erz-presence-control-preceding-absence"]],inputs:{precedingAbsences:"precedingAbsences"},decls:9,vars:7,consts:[[1,"modal-body"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(e,t){1&e&&(x.Sb(0,"div",0),x.Sb(1,"p"),x.Dc(2),x.gc(3,"translate"),x.Rb(),x.Bc(4,ct,5,14,"div",1),x.Rb(),x.Sb(5,"div",2),x.Sb(6,"button",3),x.dc("click",function(){return t.activeModal.dismiss()}),x.Dc(7),x.gc(8,"translate"),x.Rb(),x.Rb()),2&e&&(x.zb(2),x.Fc(" ",x.hc(3,3,"presence-control.preceding-absence.text")," "),x.zb(2),x.lc("ngForOf",t.precedingAbsences),x.zb(3),x.Fc(" ",x.hc(8,5,"presence-control.preceding-absence.cancel")," "))},directives:[be.l],pipes:[$e.c,be.e,st.a],styles:[""]}),e})();var rt=n("PT0D");const ot=function(e){return["/presence-control/student",e]};function at(e,t){if(1&e&&(x.Nb(0,"erz-avatar",9),x.gc(1,"async")),2&e){const e=x.fc();x.lc("studentId",x.hc(1,3,e.studentId$))("link",x.pc(5,ot,e.entry.lessonPresence.StudentRef.Id))("linkParams",e.profileReturnParams)}}function dt(e,t){if(1&e&&(x.Sb(0,"span"),x.Dc(1),x.Rb()),2&e){const e=x.fc(2);x.zb(1),x.Ec(null==e.entry.presenceType?null:e.entry.presenceType.Designation)}}function lt(e,t){if(1&e){const e=x.Tb();x.Sb(0,"button",10),x.dc("click",function(){x.vc(e);const t=x.fc();return t.updatePresenceType(t.entry)}),x.Bc(1,dt,2,1,"span",11),x.Rb()}if(2&e){const e=x.fc();x.zb(1),x.lc("ngIf",!(null!=e.entry.presenceType&&e.entry.presenceType.IsIncident))}}function pt(e,t){if(1&e){const e=x.Tb();x.Sb(0,"button",12),x.dc("click",function(){x.vc(e);const t=x.fc();return t.showPrecedingAbsences(t.entry)}),x.Sb(1,"i",13),x.Dc(2,"info"),x.Rb(),x.Rb()}}function bt(e,t){if(1&e){const e=x.Tb();x.Sb(0,"a",14),x.dc("click",function(){x.vc(e);const t=x.fc();return t.updateIncident(t.entry)}),x.Sb(1,"i",3),x.Dc(2,"edit"),x.Rb(),x.Sb(3,"span"),x.Dc(4),x.gc(5,"translate"),x.Rb(),x.Rb()}if(2&e){const e=x.fc();x.zb(4),x.Ec(x.hc(5,1,(null==e.entry.presenceType?null:e.entry.presenceType.IsIncident)&&(null==e.entry.presenceType?null:e.entry.presenceType.Designation)||"presence-control.entry.incident"))}}let ut=(()=>{class e{constructor(e,t,n){this.toastr=e,this.translate=t,this.modalService=n,this.hasUnconfirmedAbsences=!1,this.togglePresenceType=new x.n,this.changeIncident=new x.n,this.studentId$=new W.a(1)}get classNames(){return[this.entry.presenceCategory,this.viewMode].join(" ")}ngOnInit(){}ngOnChanges(e){e.entry&&this.studentId$.next(e.entry.currentValue.lessonPresence.StudentRef.Id)}get isListViewMode(){return this.viewMode===ue.List}updatePresenceType(e){e.canChangePresenceType?this.togglePresenceType.emit(e):this.toastr.warning(this.translate.instant("presence-control.entry.update-warning"))}updateIncident(e){e.canChangeIncident&&this.changeIncident.emit(e)}showPrecedingAbsences(e){this.modalService.open(it).componentInstance.precedingAbsences=e.precedingAbsences}}return e.\u0275fac=function(t){return new(t||e)(x.Mb(Ie.b),x.Mb($e.d),x.Mb(ze.k))},e.\u0275cmp=x.Gb({type:e,selectors:[["erz-presence-control-entry"]],hostVars:2,hostBindings:function(e,t){2&e&&x.Bb(t.classNames)},inputs:{entry:"entry",hasUnconfirmedAbsences:"hasUnconfirmedAbsences",viewMode:"viewMode",profileReturnParams:"profileReturnParams"},outputs:{togglePresenceType:"togglePresenceType",changeIncident:"changeIncident"},features:[x.xb],decls:13,vars:13,consts:[["class","avatar large",3,"studentId","link","linkParams",4,"ngIf"],["type","button","class","presence-category designation btn btn-link",3,"click",4,"ngIf"],["type","button",1,"presence-category","status","btn","btn-link",3,"click"],[1,"material-icons"],["type","button","class","previously-absent btn btn-link",3,"click",4,"ngIf"],[1,"student-name",3,"routerLink","queryParams"],[1,"text-truncate"],[1,"unconfirmed-absences"],["class","incident btn btn-link",3,"click",4,"ngIf"],[1,"avatar","large",3,"studentId","link","linkParams"],["type","button",1,"presence-category","designation","btn","btn-link",3,"click"],[4,"ngIf"],["type","button",1,"previously-absent","btn","btn-link",3,"click"],[1,"material-icons-outlined"],[1,"incident","btn","btn-link",3,"click"]],template:function(e,t){1&e&&(x.Bc(0,at,2,7,"erz-avatar",0),x.Bc(1,lt,2,1,"button",1),x.Sb(2,"button",2),x.dc("click",function(){return t.updatePresenceType(t.entry)}),x.Sb(3,"i",3),x.Dc(4),x.Rb(),x.Rb(),x.Bc(5,pt,3,0,"button",4),x.Sb(6,"a",5),x.Sb(7,"span",6),x.Dc(8),x.Rb(),x.Sb(9,"span",7),x.Dc(10),x.gc(11,"translate"),x.Rb(),x.Rb(),x.Bc(12,bt,6,3,"a",8)),2&e&&(x.lc("ngIf",!t.isListViewMode),x.zb(1),x.lc("ngIf",t.entry.showDesignation),x.zb(3),x.Ec(t.entry.presenceCategoryIcon),x.zb(1),x.lc("ngIf",(null==t.entry.precedingAbsences?null:t.entry.precedingAbsences.length)>0),x.zb(1),x.lc("routerLink",x.pc(11,ot,t.entry.lessonPresence.StudentRef.Id))("queryParams",t.profileReturnParams),x.zb(2),x.Ec(t.entry.lessonPresence.StudentFullName),x.zb(2),x.Fc(" ",t.hasUnconfirmedAbsences?x.hc(11,9,"presence-control.entry.unconfirmed-absences"):""," "),x.zb(2),x.lc("ngIf",t.entry.canChangeIncident))},directives:[be.m,c.i,rt.a],pipes:[$e.c,be.b],styles:['[_nghost-%COMP%]{padding:3rem 1.5rem;background-color:#fff;display:grid;grid-template-areas:"avatar status designation previously-absent" "avatar student-name student-name student-name" "avatar incident incident incident";grid-template-columns:-webkit-min-content -webkit-min-content 3fr -webkit-min-content;grid-template-columns:min-content min-content 3fr min-content}[_nghost-%COMP%] > *[_ngcontent-%COMP%]{align-self:center}.presence-category[_ngcontent-%COMP%]{text-decoration:none}.presence-category[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{top:.1875rem}.absent[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#dc3545}.present[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#28a745}.unapproved[_nghost-%COMP%]   .presence-category[_ngcontent-%COMP%]{color:#ffa814}.designation[_ngcontent-%COMP%], .incident[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .student-name[_ngcontent-%COMP%], a.incident[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.avatar[_ngcontent-%COMP%]{grid-area:avatar;margin-right:2.25rem}.status[_ngcontent-%COMP%]{grid-area:status}.status[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:2.75rem}.designation[_ngcontent-%COMP%]{grid-area:designation;text-align:left;line-height:3.125rem}.previously-absent[_ngcontent-%COMP%]{grid-area:previously-absent;text-decoration:none;color:rgba(51,51,61,.5);justify-self:end}.student-name[_ngcontent-%COMP%]{color:#33333d;grid-area:student-name;display:flex;flex-direction:column}.unconfirmed-absences[_ngcontent-%COMP%]{color:#dc3545;font-size:1.1rem;line-height:1}.incident[_ngcontent-%COMP%]{color:rgba(51,51,61,.5);padding-right:.75rem;grid-area:incident;display:flex}.incident[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.3em}.grid[_nghost-%COMP%]   .designation[_ngcontent-%COMP%], .grid[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{align-self:start;margin-left:-.75rem;margin-top:-.375rem}.grid[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{align-self:end;margin-left:-.75rem;margin-bottom:-.375rem}.grid[_nghost-%COMP%]   .previously-absent[_ngcontent-%COMP%]{padding-right:0;align-self:start}.grid[_nghost-%COMP%]   .unconfirmed-absences[_ngcontent-%COMP%]{height:1.1rem}.list[_nghost-%COMP%]{grid-template-areas:"student-name status designation incident previously-absent";grid-template-columns:3fr -webkit-min-content 3fr 2fr 3em;grid-template-columns:3fr min-content 3fr 2fr 3em;padding:.5rem .5rem .5rem 1rem}.list[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{justify-self:start}@media (max-width:750px){.list[_nghost-%COMP%]{grid-template-areas:"student-name student-name student-name previously-absent" "status incidentordesignation incidentordesignation incidentordesignation";grid-template-columns:-webkit-min-content 1fr 1fr -webkit-min-content;grid-template-columns:min-content 1fr 1fr min-content;row-gap:1.5rem}.list[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.list[_nghost-%COMP%]   .designation[_ngcontent-%COMP%], .list[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{grid-area:incidentordesignation}.list[_nghost-%COMP%]   .incident[_ngcontent-%COMP%]{justify-self:end}.list[_nghost-%COMP%]   .previously-absent[_ngcontent-%COMP%]{padding-top:0;align-self:start}}']}),e})();var gt=n("4Kj8");const ht=function(e){return{returnparams:e}};function ft(e,t){if(1&e){const e=x.Tb();x.Sb(0,"erz-presence-control-entry",7),x.dc("togglePresenceType",function(t){return x.vc(e),x.fc(5).togglePresenceType(t)})("changeIncident",function(t){return x.vc(e),x.fc(5).changeIncident(t)}),x.gc(1,"async"),x.gc(2,"async"),x.gc(3,"async"),x.Rb()}if(2&e){const e=t.$implicit,n=x.fc(5);x.lc("entry",e)("hasUnconfirmedAbsences",x.hc(1,4,n.state.hasUnconfirmedAbsences(e)))("viewMode",x.hc(2,6,n.state.viewMode$))("profileReturnParams",x.pc(10,ht,x.hc(3,8,n.state.queryParamsString$)))}}function mt(e,t){if(1&e&&(x.Qb(0),x.Sb(1,"div"),x.gc(2,"async"),x.Bc(3,ft,4,12,"erz-presence-control-entry",6),x.Rb(),x.Pb()),2&e){const e=x.fc(3).erzLet,t=x.fc();x.zb(1),x.Cb("default-entries entries view-mode-",x.hc(2,4,t.state.viewMode$),""),x.zb(2),x.lc("ngForOf",e.entries)}}function vt(e,t){1&e&&(x.Sb(0,"p",8),x.Dc(1),x.gc(2,"translate"),x.Rb()),2&e&&(x.zb(1),x.Fc(" ",x.hc(2,1,"presence-control.no-lesson-presences")," "))}function Ot(e,t){if(1&e&&(x.Qb(0),x.Bc(1,mt,4,6,"ng-container",1),x.Bc(2,vt,3,3,"ng-template",null,5,x.Cc),x.Pb()),2&e){const e=x.uc(3),t=x.fc(2).erzLet;x.zb(1),x.lc("ngIf",(null==t.entries?null:t.entries.length)>0)("ngIfElse",e)}}function yt(e,t){1&e&&(x.Sb(0,"p",9),x.Dc(1),x.gc(2,"translate"),x.Rb()),2&e&&(x.zb(1),x.Ec(x.hc(2,1,"presence-control.no-lessons")))}function St(e,t){if(1&e){const e=x.Tb();x.Qb(0),x.Sb(1,"erz-presence-control-header",3),x.dc("searchChange",function(t){return x.vc(e),x.fc(2).search$.next(t)})("viewModeChange",function(t){return x.vc(e),x.fc(2).state.setViewMode(t)})("selectDateChange",function(t){return x.vc(e),x.fc(2).state.setDate(t)})("selectLessonChange",function(t){return x.vc(e),x.fc(2).state.setLesson(t)}),x.gc(2,"async"),x.gc(3,"async"),x.gc(4,"async"),x.gc(5,"async"),x.gc(6,"async"),x.gc(7,"async"),x.gc(8,"async"),x.Rb(),x.Bc(9,Ot,4,2,"ng-container",1),x.Bc(10,yt,3,3,"ng-template",null,4,x.Cc),x.Pb()}if(2&e){const e=x.uc(11),t=x.fc().erzLet,n=x.fc();x.zb(1),x.lc("selectedLesson",t.lesson)("lessons",t.lessons)("presentCount",x.hc(2,11,n.state.presentCount$))("absentCount",x.hc(3,13,n.state.absentCount$))("unapprovedCount",x.hc(4,15,n.state.unapprovedCount$))("absentPrecedingCount",x.hc(5,17,n.state.absentPrecedingCount$))("viewMode",x.hc(6,19,n.state.viewMode$))("selectDate",x.hc(7,21,n.state.selectedDate$))("search",x.hc(8,23,n.search$)),x.zb(8),x.lc("ngIf",t.lesson)("ngIfElse",e)}}function Pt(e,t){1&e&&x.Nb(0,"erz-spinner")}function wt(e,t){if(1&e&&(x.Qb(0),x.Bc(1,St,12,25,"ng-container",1),x.gc(2,"async"),x.Bc(3,Pt,1,0,"ng-template",null,2,x.Cc),x.Pb()),2&e){const e=x.uc(4),t=x.fc();x.zb(1),x.lc("ngIf",!x.hc(2,2,t.state.loading$))("ngIfElse",e)}}const Ct=function(e,t,n){return{lesson:e,lessons:t,entries:n}};let Mt=(()=>{class e{constructor(e,t,n,s,c,r){this.state=e,this.lessonPresencesUpdateService=t,this.presenceTypesService=n,this.modalService=s,this.scrollPosition=c,this.route=r,this.search$=new b.a(""),this.entries$=Object(g.a)([this.state.selectedPresenceControlEntriesByGroup$,this.search$]).pipe(Object(O.a)(Object(G.a)(xe.a)),Object(v.a)(1)),this.destroy$=new i.a}ngOnInit(){this.route.queryParams.pipe(Object(r.a)(this.destroy$)).subscribe(this.restoreStateFromParams.bind(this))}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}doTogglePresenceType(e,t){this.state.getNextPresenceType(e).subscribe(n=>this.lessonPresencesUpdateService.updatePresenceTypes(t||[e.lessonPresence],n?n.Id:null))}togglePresenceType(e){this.state.getBlockLessonPresences(e).pipe(Object(S.a)(1)).subscribe(t=>{if(1===t.length)this.doTogglePresenceType(e);else{const n=this.modalService.open(Ue);n.componentInstance.entry=e,n.componentInstance.blockLessonPresences=t,n.result.then(t=>{t&&this.doTogglePresenceType(e,t)},()=>{})}})}updateIncident(e,t){this.lessonPresencesUpdateService.updatePresenceTypes([e.lessonPresence],t)}changeIncident(e){this.presenceTypesService.incidentTypes$.subscribe(t=>{const n=this.modalService.open(Be);n.componentInstance.incident=t.find(t=>{var n;return t.Id===(null===(n=e.presenceType)||void 0===n?void 0:n.Id)})||null,n.componentInstance.incidentTypes=t,n.result.then(t=>{this.updateIncident(e,(null==t?void 0:t.Id)||null)},()=>{})})}restoreStateFromParams(e){e.date&&this.state.setDate(Object(Ge.c)(e.date));const t=String(e.lesson);t&&this.state.lessons$.pipe(Object(S.a)(1)).subscribe(e=>{const n=e.find(e=>e.id===t);n&&this.state.setLesson(n)}),e.viewMode&&ge.includes(e.viewMode)&&this.state.setViewMode(e.viewMode)}}return e.\u0275fac=function(t){return new(t||e)(x.Mb(he),x.Mb(ke),x.Mb(V.a),x.Mb(ze.k),x.Mb(Ve.a),x.Mb(c.a))},e.\u0275cmp=x.Gb({type:e,selectors:[["erz-presence-control-list"]],decls:4,vars:11,consts:[[4,"erzLet"],[4,"ngIf","ngIfElse"],["loading",""],[3,"selectedLesson","lessons","presentCount","absentCount","unapprovedCount","absentPrecedingCount","viewMode","selectDate","search","searchChange","viewModeChange","selectDateChange","selectLessonChange"],["noLessons",""],["noLessonPresences",""],[3,"entry","hasUnconfirmedAbsences","viewMode","profileReturnParams","togglePresenceType","changeIncident",4,"ngFor","ngForOf"],[3,"entry","hasUnconfirmedAbsences","viewMode","profileReturnParams","togglePresenceType","changeIncident"],[1,"mt-3","pl-3"],[1,"mt-3","px-3"]],template:function(e,t){1&e&&(x.Bc(0,wt,5,4,"ng-container",0),x.gc(1,"async"),x.gc(2,"async"),x.gc(3,"async")),2&e&&x.lc("erzLet",x.rc(7,Ct,x.hc(1,1,t.state.selectedLesson$),x.hc(2,3,t.state.lessons$),x.hc(3,5,t.entries$)))},directives:[Ne.a,be.m,nt,be.l,ut,gt.a],pipes:[be.b,$e.c],styles:["erz-presence-control-entry[_ngcontent-%COMP%]{border-bottom:1px solid #e9ecef}.entries.view-mode-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}@media (min-width:400px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%;border-right:1px solid #e9ecef}}@media (min-width:800px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:50%;border-right:1px solid #e9ecef}}@media (min-width:1200px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:33.3333333333%;border-right:1px solid #e9ecef}}@media (min-width:1600px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:25%;border-right:1px solid #e9ecef}}@media (min-width:2000px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:20%;border-right:1px solid #e9ecef}}@media (min-width:2400px){.entries.view-mode-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:16.6666666667%;border-right:1px solid #e9ecef}}"],changeDetection:0}),e})();var jt=n("hH5/"),It=n("ccj6"),$t=n("EY2u"),Dt=n("wO+i");let kt=(()=>{class e extends T.a{constructor(e,t){super(e,t,oe,"SubscriptionDetails")}update(e,t){return this.http.put(`${this.baseUrl}/${t.Id}`,{IdPerson:t.IdPerson,EventId:t.EventId,Value:e}).pipe(Object(Se.a)(void 0))}}return e.\u0275fac=function(t){return new(t||e)(x.Zb(z.b),x.Zb(M.a))},e.\u0275prov=x.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Rt=n("ulei");let Lt=(()=>{class e extends Rt.a{}return e.\u0275fac=function(t){return Tt(t||e)},e.\u0275prov=x.Ib({token:e,factory:e.\u0275fac}),e})();const Tt=x.Ub(Lt);function _t(e,t){if(1&e){const e=x.Tb();x.Sb(0,"div",5),x.Sb(1,"input",6),x.dc("change",function(){x.vc(e);const n=t.$implicit;return x.fc().onSelectionChange(n)}),x.Rb(),x.Sb(2,"label",7),x.Dc(3),x.Rb(),x.Rb()}if(2&e){const e=t.$implicit,n=t.index,s=x.fc();x.zb(1),x.nc("id","group-",n,""),x.lc("checked",e.id===s.selected.id)("value",e.id),x.zb(1),x.nc("for","group-",n,""),x.zb(1),x.Fc(" ",e.label," ")}}let xt=(()=>{class e{constructor(e,t){this.activeModal=e,this.translate=t,this.groupOptions=[]}ngOnInit(){const e={id:null,label:this.translate.instant(this.emptyLabel)};this.groupOptions=this.createGroupOptions(this.subscriptionDetail),this.groupOptions.unshift(e),this.selected=this.groupOptions.find(e=>e.id===this.savedGroupView.group)||e}createGroupOptions(e){return e.DropdownItems?e.DropdownItems.map(e=>({id:e.Key,label:`${this.translate.instant("presence-control.groups.group")} ${e.Value}`})):[]}getSelectedGroup(){return this.selected}onSelectionChange(e){this.selected=e}}return e.\u0275fac=function(t){return new(t||e)(x.Mb(ze.b),x.Mb($e.d))},e.\u0275cmp=x.Gb({type:e,selectors:[["erz-presence-control-group-dialog"]],inputs:{title:"title",emptyLabel:"emptyLabel",subscriptionDetail:"subscriptionDetail",savedGroupView:"savedGroupView"},decls:13,vars:10,consts:[[1,"modal-body"],["class","form-group form-check",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"form-group","form-check"],["type","radio","name","groups",1,"form-check-input",3,"id","checked","value","change"],[1,"form-check-label",3,"for"]],template:function(e,t){1&e&&(x.Sb(0,"div",0),x.Sb(1,"p"),x.Dc(2),x.gc(3,"translate"),x.Rb(),x.Sb(4,"form"),x.Bc(5,_t,4,5,"div",1),x.Rb(),x.Rb(),x.Sb(6,"div",2),x.Sb(7,"button",3),x.dc("click",function(){return t.activeModal.dismiss()}),x.Dc(8),x.gc(9,"translate"),x.Rb(),x.Sb(10,"button",4),x.dc("click",function(){return t.activeModal.close(t.getSelectedGroup())}),x.Dc(11),x.gc(12,"translate"),x.Rb(),x.Rb()),2&e&&(x.zb(2),x.Fc(" ",x.hc(3,4,t.title)," "),x.zb(3),x.lc("ngForOf",t.groupOptions),x.zb(3),x.Fc(" ",x.hc(9,6,"presence-control.groups.cancel")," "),x.zb(3),x.Fc(" ",x.hc(12,8,"presence-control.groups.save")," "))},directives:[Fe.r,Fe.j,Fe.k,be.l],pipes:[$e.c],styles:[""]}),e})();function zt(e,t){if(1&e){const e=x.Tb();x.Sb(0,"div",15),x.dc("click",function(){x.vc(e);const n=t.$implicit;return x.fc(2).toggleSort(n)}),x.Dc(1),x.gc(2,"translate"),x.Sb(3,"span",16),x.Dc(4),x.Rb(),x.Rb()}if(2&e){const e=t.$implicit,n=x.fc().erzLet,s=x.fc();x.lc("className",e),x.zb(1),x.Fc(" ",x.hc(2,3,"presence-control.groups.list.header."+e)," "),x.zb(3),x.Ec(s.getSortDirectionCharacter(n.sortCriteria,e))}}function Ft(e,t){if(1&e){const e=x.Tb();x.Qb(0),x.Sb(1,"div",18),x.Sb(2,"div",19),x.Sb(3,"input",20,21),x.dc("change",function(){x.vc(e);const n=t.$implicit;return x.fc(3).selectionService.toggle(n)}),x.gc(5,"async"),x.Rb(),x.Rb(),x.Sb(6,"div",22),x.Dc(7),x.Rb(),x.Sb(8,"div",23),x.Dc(9),x.Rb(),x.Rb(),x.Pb()}if(2&e){const e=t.$implicit,n=x.fc(3);x.zb(3),x.lc("checked",x.hc(5,3,n.selectionService.isSelected$(e))),x.zb(4),x.Fc(" ",e.name," "),x.zb(2),x.Fc(" ",e.group?e.group:""," ")}}function Et(e,t){if(1&e&&(x.Qb(0),x.Bc(1,Ft,10,5,"ng-container",17),x.Pb()),2&e){const e=x.fc().erzLet;x.zb(1),x.lc("ngForOf",e.sortedEntries)}}function Ut(e,t){1&e&&x.Nb(0,"erz-spinner")}const Vt=function(){return["/presence-control"]},Gt=function(){return["name","group"]};function At(e,t){if(1&e){const e=x.Tb();x.Sb(0,"div"),x.Sb(1,"a",1),x.gc(2,"async"),x.Sb(3,"div",2),x.Sb(4,"i",3),x.Dc(5,"navigate_before"),x.Rb(),x.Sb(6,"span",4),x.Dc(7),x.gc(8,"translate"),x.Rb(),x.Rb(),x.Rb(),x.Sb(9,"div",5),x.Sb(10,"div",6),x.Sb(11,"span",7),x.Dc(12),x.gc(13,"translate"),x.Rb(),x.Sb(14,"button",8),x.dc("click",function(){return x.vc(e),x.fc().selectGroup()}),x.Dc(15),x.gc(16,"translate"),x.gc(17,"translate"),x.Rb(),x.Rb(),x.Sb(18,"a",9),x.dc("click",function(){return x.vc(e),x.fc().assignGroup()}),x.Sb(19,"i",3),x.Dc(20,"edit"),x.Rb(),x.Rb(),x.Rb(),x.Sb(21,"div",10),x.Sb(22,"div",11),x.Bc(23,zt,5,5,"div",12),x.Rb(),x.Bc(24,Et,2,1,"ng-container",13),x.gc(25,"async"),x.Bc(26,Ut,1,0,"ng-template",null,14,x.Cc),x.Rb(),x.Rb()}if(2&e){const e=t.erzLet,n=x.uc(27),s=x.fc();x.zb(1),x.lc("routerLink",x.oc(22,Vt))("queryParams",x.hc(2,10,s.backlinkQueryParams$)),x.zb(6),x.Ec(x.hc(8,12,"presence-control.groups.title")),x.zb(5),x.Ec(x.hc(13,14,"presence-control.groups.show")),x.zb(3),x.Fc(" ",e.groupView&&e.groupView.group?x.hc(16,16,"presence-control.groups.group")+" "+e.groupView.group:x.hc(17,18,"presence-control.groups.all")," "),x.zb(3),x.Eb("disabled",0===e.selection.length),x.zb(5),x.lc("ngForOf",x.oc(23,Gt)),x.zb(1),x.lc("ngIf",!x.hc(25,20,s.state.loading$))("ngIfElse",n)}}const Bt=function(e,t,n,s){return{sortCriteria:e,sortedEntries:t,selection:n,groupView:s}},Nt=[{path:"",component:_e,children:[{path:"",component:Mt,data:{restoreScrollPositionFrom:["/presence-control/student/:id"]}},{path:"student/:id",children:[{path:"",component:It.a},{path:"confirm",component:jt.a}]},{path:"groups/:id",component:(()=>{class e{constructor(e,t,n,s,c,i,r,o,a){this.route=e,this.state=t,this.selectionService=n,this.groupService=s,this.settingsService=c,this.subscriptionDetailService=i,this.toastr=r,this.translate=o,this.modalService=a,this.backlinkQueryParams$=this.route.queryParams.pipe(Object(Dt.a)("returnparams"),Object(O.a)(D.b)),this.lessonId$=this.route.paramMap.pipe(Object(O.a)(e=>Number(e.get("id")))),this.sortCriteriaSubject$=new b.a({primarySortKey:"name",ascending:!1}),this.sortCriteria$=this.sortCriteriaSubject$.asObservable(),this.sortedEntries$=Object(g.a)([this.groupService.getSubscriptionDetailsForStudents(),this.sortCriteria$]).pipe(Object(O.a)(Object(G.a)(te))),this.selected=[]}ngOnInit(){this.selectionService.selection$.subscribe(e=>this.selected=e)}selectGroup(){this.openGroupModal("presence-control.groups.all",this.selectCallback.bind(this))}assignGroup(){this.openGroupModal("presence-control.groups.none",this.assignCallback.bind(this))}openGroupModal(e,t){Object(g.a)([this.groupService.getSubscriptionDetailForGroupEvent(),this.groupService.groupView$]).pipe(Object(S.a)(1)).subscribe(([n,s])=>{const c=this.modalService.open(xt);c.componentInstance.title="presence-control.groups.assign.title",c.componentInstance.emptyLabel=e,c.componentInstance.subscriptionDetail=n,c.componentInstance.savedGroupView=s,c.result.then(e=>{t(e)},()=>{})})}selectCallback(e){this.lessonId$.pipe(Object(S.a)(1),Object(m.a)(t=>{if(t){const n={lessonId:String(t),group:e.id},s=function(e,t){const n={Key:"presenceControlGroupView",Value:JSON.stringify(t)},s=Object.assign({},Object(k.a)());return s.Settings.push(n),s}(0,n);return this.settingsService.updateUserSettingsCst(s).pipe(Object(Se.a)(n))}return $t.a})).subscribe(e=>e&&this.groupService.selectGroupView(e))}assignCallback(e){Object(ee.a)(this.selected.map(t=>this.subscriptionDetailService.update(e.id,t.detail))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.groupService.reloadSubscriptionDetails(),this.selectionService.clear(),this.toastr.success(this.translate.instant("presence-control.groups.notifications.save-success"))}getSortDirectionCharacter(e,t){return e.primarySortKey!==t?"":e.ascending?"\u2193":"\u2191"}toggleSort(e){this.sortCriteriaSubject$.pipe(Object(S.a)(1)).subscribe(t=>{this.sortCriteriaSubject$.next(t.primarySortKey===e?{primarySortKey:e,ascending:!t.ascending}:{primarySortKey:e,ascending:"name"===e})})}}return e.\u0275fac=function(t){return new(t||e)(x.Mb(c.a),x.Mb(he),x.Mb(Lt),x.Mb(pe),x.Mb(I.a),x.Mb(kt),x.Mb(Ie.b),x.Mb($e.d),x.Mb(ze.k))},e.\u0275cmp=x.Gb({type:e,selectors:[["erz-presence-control-group"]],features:[x.yb([Lt])],decls:5,vars:14,consts:[[4,"erzLet"],[1,"back","btn","btn-link","p-3",3,"routerLink","queryParams"],[1,"d-flex","align-items-center"],[1,"material-icons"],[1,"ml-3"],[1,"group-header","mb-2","d-flex","justify-content-between"],[1,"d-flex","align-items-baseline"],[1,"pl-3"],["type","button",1,"show","btn","btn-link",3,"click"],["aria-label","edit",1,"btn","btn-primary","mr-2",3,"click"],[1,"group-list"],[1,"group-list-header"],[3,"className","click",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["loading",""],[3,"className","click"],[1,"sort-direction"],[4,"ngFor","ngForOf"],[1,"group-list-entry"],[1,"checkbox"],["type","checkbox",1,"form-check-input",3,"checked","change"],["checkbox",""],[1,"name","pr-2"],[1,"group"]],template:function(e,t){1&e&&(x.Bc(0,At,28,24,"div",0),x.gc(1,"async"),x.gc(2,"async"),x.gc(3,"async"),x.gc(4,"async")),2&e&&x.lc("erzLet",x.sc(9,Bt,x.hc(1,1,t.sortCriteria$),x.hc(2,3,t.sortedEntries$),x.hc(3,5,t.selectionService.selection$),x.hc(4,7,t.groupService.groupView$)))},directives:[Ne.a,c.i,be.l,be.m,gt.a],pipes:[be.b,$e.c],styles:['.back[_ngcontent-%COMP%]{color:#33333d;text-decoration:none}.back[_ngcontent-%COMP%]:active   span[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%]{text-decoration:underline}.group-list[_ngcontent-%COMP%]{padding-left:1.5rem;padding-right:1.5rem}.group-list-header[_ngcontent-%COMP%]{cursor:pointer;padding:1.5rem;display:grid;grid-template-areas:"name group";grid-template-columns:3fr 2fr;border-top:1px solid #dee2e6;border-bottom:2px solid #dee2e6}.group-list-entry[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid #e9ecef;display:grid;grid-template-areas:"checkbox name group";grid-template-columns:-webkit-min-content 3fr 2fr;grid-template-columns:min-content 3fr 2fr}.checkbox[_ngcontent-%COMP%]{grid-area:checkbox;margin:0;padding:.6rem .75rem 0 0}.checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important;display:block}.name[_ngcontent-%COMP%]{grid-area:name;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.group[_ngcontent-%COMP%]{grid-area:group}@media (max-width:750px){.group-list[_ngcontent-%COMP%]{padding-left:0;padding-right:0}.group-list-header[_ngcontent-%COMP%]{grid-template-columns:3fr 1fr}.group-list-entry[_ngcontent-%COMP%]{grid-template-columns:-webkit-min-content 3fr 1fr;grid-template-columns:min-content 3fr 1fr}}'],changeDetection:0}),e})()}]}];let Zt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=x.Kb({type:e}),e.\u0275inj=x.Jb({imports:[[c.j.forChild(Nt)],c.j]}),e})(),Ht=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=x.Kb({type:e}),e.\u0275inj=x.Jb({imports:[[s.a,Zt]]}),e})()}}]);