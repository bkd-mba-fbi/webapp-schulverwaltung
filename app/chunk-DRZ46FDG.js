import{a as ri}from"./chunk-IOJSQGH6.js";import{a as oi,b as li}from"./chunk-32LHGY5Z.js";import{a as ci}from"./chunk-GKHN5TVX.js";import{a as ai}from"./chunk-24TK3FB4.js";import"./chunk-7VKKHU7R.js";import{a as it,b as Wt,c as zt,d as qt,e as Yt,f as We,g as ze,h as Kt,i as Jt,j as Qt,k as Xt,l as Zt,m as Te,o as ei,p as ce,s as ii,u as ni,v as qe}from"./chunk-LLGOVPQJ.js";import"./chunk-2H6IFZM2.js";import"./chunk-QOR23F4L.js";import"./chunk-7FRZV7VF.js";import{a as Vt}from"./chunk-Y4QYVF5K.js";import"./chunk-OFB4XAK2.js";import{a as di}from"./chunk-6YG4BOT7.js";import{a as pi}from"./chunk-2U5ENDJH.js";import"./chunk-VUPOI3TG.js";import{a as Ut,d as ti}from"./chunk-WACRWBCS.js";import"./chunk-MIRGHONI.js";import"./chunk-YUHFF3NM.js";import{L as jt,U as si,p as At}from"./chunk-H6G6Q6V6.js";import{a as xe,c as Lt,l as ye}from"./chunk-NL5E3FC5.js";import{a as Nt,b as Ue}from"./chunk-YD3RJIHU.js";import{a as Ht,b as Se}from"./chunk-KK2SHN2W.js";import{f as Ot,g as Gt,i as $t,j as Ft,p as je,u as Ne}from"./chunk-AP373D4K.js";import{a as He}from"./chunk-B6WYZ7BT.js";import{$c as Re,Ab as y,B as lt,Bb as fe,Bd as Rt,C as pt,Cb as F,Cd as Bt,D as ct,Db as tt,Ed as Dt,F as ne,Gb as o,H as J,Ha as I,Hb as p,Ib as O,Id as ie,J as Oe,Jd as P,K as mt,Kd as k,Ld as Ve,M as Q,Ma as m,Mb as bt,Na as se,O as ut,P as L,R as oe,Ra as w,Ta as ge,Ua as z,Va as q,Wa as a,Wb as ae,X as ue,Xa as r,Ya as E,Yc as _e,Zb as j,_ as U,_b as Ge,a as D,aa as x,ab as $,b as N,bd as Ce,ca as ht,cb as _,cd as Be,da as gt,db as h,dd as yt,eb as _t,f as ee,fb as Ct,g as A,gb as de,gc as xt,gd as St,h as Ze,ha as he,hd as Tt,ia as S,id as De,ja as T,jd as wt,l as K,la as ft,ld as It,m as dt,mb as le,md as Et,n as b,nb as c,o as te,ob as C,pb as f,qa as X,qb as et,qd as Le,rc as ve,rd as Ae,sc as $e,sd as Pt,ta as vt,tc as Fe,td as kt,uc as re,ud as be,va as Pe,vd as Mt,w as Me,wa as s,wb as R,x as Ee,xa as v,xb as Y,yb as B,zb as pe}from"./chunk-IFJN5CDK.js";var Ji=t=>[t,"tests"];function Qi(t,l){if(t&1&&(a(0,"span"),c(1),o(2,"date"),E(3,"wbr"),c(4),o(5,"date"),r()),t&2){let e=h();s(),f("",O(2,2,e.event.dateFrom,"dd.MM.yyyy"),"\u2013"),s(3),C(O(5,5,e.event.dateTo,"dd.MM.yyyy"))}}function Xi(t,l){if(t&1&&(a(0,"a",6)(1,"i",8),c(2,"arrow_right_alt"),r(),a(3,"span",9),c(4),r()()),t&2){let e=h(2);m("routerLink",F(2,Ji,e.event.id)),s(4),C(e.event.evaluationText)}}function Zi(t,l){if(t&1&&(a(0,"a",7)(1,"i",8),c(2,"arrow_right_alt"),r(),a(3,"span",9),c(4),r()()),t&2){let e=h(2);m("href",e.event.evaluationLink,Pe),s(4),f("",e.event.evaluationText," ")}}function en(t,l){if(t&1&&(a(0,"div",5),I(1,Xi,5,4,"a",6)(2,Zi,5,2,"a",7),r()),t&2){let e=h();s(),w(e.event.evaluationLink?-1:1),s(),w(e.event.evaluationLink?2:-1)}}var mi=(()=>{class t{constructor(){this.withRatings=!0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-events-list-entry"]],inputs:{event:"event",withRatings:"withRatings"},standalone:!0,features:[y],decls:11,vars:8,consts:[[1,"designation"],[3,"href"],[1,"date"],[1,"registrations"],[1,"registrations-label"],[1,"rating"],[1,"d-flex",3,"routerLink"],[1,"d-flex",3,"href"],[1,"material-icons"],[1,"ps-1"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"a",1),c(2),r()(),a(3,"div",2),I(4,Qi,6,8,"span"),r(),a(5,"div",3),c(6),a(7,"span",4),c(8),o(9,"translate"),r()(),I(10,en,3,2,"div",5)),i&2&&(s(),m("href",n.event.detailLink,Pe),s(),C(n.event.designation),s(2),w(n.event.dateFrom&&n.event.dateTo?4:-1),s(2),f(" ",n.event.studentCount," "),s(2),C(p(9,6,n.event.studentCount===1?"events.registration":"events.registrations")),s(2),w(n.withRatings&&n.event.evaluationText?10:-1))},dependencies:[re,Ge,k,P],styles:['[_nghost-%COMP%]{display:grid;padding:1rem;border-bottom:1px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}.designation[_ngcontent-%COMP%]{grid-area:designation;padding-right:1rem}.date[_ngcontent-%COMP%]{grid-area:date;padding-right:1rem}.registrations[_ngcontent-%COMP%]{grid-area:registrations;padding-right:1rem}.rating[_ngcontent-%COMP%]{grid-area:rating}.rating[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.registrations-label[_ngcontent-%COMP%]{display:none}@media (max-width: 575.98px){.registrations-label[_ngcontent-%COMP%]{display:inline}.designation[_ngcontent-%COMP%], .date[_ngcontent-%COMP%], .registrations[_ngcontent-%COMP%]{padding-right:0}[_nghost-%COMP%]{grid-template-areas:"designation" "date" "registrations" "rating";grid-template-columns:1fr}}']})}}return t})();var tn=10300,nn=10260,sn=10250,an=14030,rn=10350;function Ye(t){let{HasEvaluationStarted:l,EvaluationUntil:e,HasTestGrading:i}=t.EvaluationStatusRef;if(l===!0&&(t.StatusId===an||t.StatusId===rn))return{value:Z.Rating};if(l===!0&&i===!1){if(e)return{value:Z.RatingUntil};if(t.StatusId===tn)return{value:Z.IntermediateRating}}return l===!1&&i===!0&&t.StatusId!==nn&&t.StatusId!==sn?{value:Z.Tests}:l===!0&&i===!0?e?{value:Z.Tests,label:Z.RatingUntil}:{value:Z.Tests,label:Z.IntermediateRating}:null}function ui(t){return t.EvaluationStatusRef.HasEvaluationStarted===!0}function hi(t){return t.EvaluationStatusRef.HasReviewOfEvaluationStarted===!0&&!!t.FinalGrades?.length}function Ke(t){let l=t.Classes?t.Classes.map(e=>e.Number).join(", "):null;return l?t.Designation+", "+l:t.Designation}function gi(t,l){return t?(l.Leadership??"").split(",").some(e=>e.trim()===t.fullname):!1}var Z=function(t){return t.Rating="rating",t.RatingUntil="rating-until",t.IntermediateRating="intermediate-rating",t.Tests="add-tests",t}(Z||{}),we=(()=>{class t{constructor(e,i,n,d,u,g,M){this.coursesRestService=e,this.eventsRestService=i,this.studyClassRestService=n,this.loadingService=d,this.storageService=u,this.translate=g,this.settings=M,this.loading$=this.loadingService.loading$,this.searchFields$=new A(["designation"]),this.searchSubject$=new A(""),this.search$=this.searchSubject$.asObservable(),this.roles$=new A(null),this.isClassTeacher$=this.roles$.pipe(b(V=>Vt(V,"ClassTeacherRole")),Q(1)),this.withStudyCourses$=new A(!1),this.unratedCourses$=this.roles$.pipe(L(this.loadUnratedCourses.bind(this)),Q(1)),this.studyCourses$=this.withStudyCourses$.pipe(L(this.loadStudyCourses.bind(this)),Q(1)),this.formativeAssessments$=this.isClassTeacher$.pipe(L(this.loadFormativeAssessments.bind(this)),Q(1)),this.studyClasses$=this.isClassTeacher$.pipe(L(this.loadStudyClasses.bind(this)),Q(1)),this.events$=this.getEvents().pipe(Q(1)),this.filteredEvents$=te([this.events$,this.searchFields$,this.search$]).pipe(b(ye(oi)))}setSearch(e){this.searchSubject$.next(e)}setRoles(e){this.roles$.next(e)}setWithStudyCourses(e){this.withStudyCourses$.next(e)}setSearchFields(e){this.searchFields$.next(e)}getEntries(e=!1){return this.filteredEvents$.pipe(b(i=>e?i.filter(n=>n.evaluationText):i))}getEvents(){return this.loadingService.load(te([this.unratedCourses$,this.studyCourses$,this.formativeAssessments$,this.studyClasses$]),{stopOnFirstValue:!0}).pipe(b(ye(this.createAndSortEvents.bind(this))))}loadUnratedCourses(e){return this.coursesRestService.getExpandedCourses(e).pipe(b(i=>i.filter(n=>!hi(n))))}loadStudyCourses(e){return e?this.eventsRestService.getStudyCourseEvents():K([])}loadFormativeAssessments(e){return e?this.studyClassRestService.getActiveFormativeAssessments():K([])}loadStudyClasses(e){return e?this.studyClassRestService.getActive():K([])}createAndSortEvents(e,i,n,d){let u=d.filter(g=>!n.map(M=>M.Id).includes(g.Id));return[...this.createFromCourses(e),...this.createFromStudyCourses(i),...this.createFromAssessments(n),...this.createFromStudyClasses(u)].sort((g,M)=>g.designation.localeCompare(M.designation))}createFromCourses(e){return e.map(i=>{let n=Ye(i);return{id:i.Id,designation:Ke(i),detailLink:this.buildLink(i.Id,"eventdetail"),studentCount:i.AttendanceRef.StudentCount||0,dateFrom:i.DateFrom,dateTo:i.DateTo,state:n?.value||null,evaluationText:this.getEvaluationText(n,i.EvaluationStatusRef.EvaluationUntil),evaluationLink:this.getEvaluationLink(n?.value,i)}})}createFromStudyCourses(e){let i=this.storageService.getPayload();return e.filter(n=>gi(i,n)).map(n=>({id:n.Id,designation:n.Designation,detailLink:this.buildLink(n.Id,"eventdetail"),studentCount:n.StudentCount,state:null}))}createFromAssessments(e){return this.createFromStudyClasses(e).map(n=>N(D({},n),{state:Z.Rating,evaluationText:this.translate.instant("events.state.rating"),evaluationLink:this.buildLink(n.id,"evaluation")}))}createFromStudyClasses(e){return e.map(i=>({id:i.Id,designation:i.Number,detailLink:this.buildLink(i.Id,"eventdetail"),studentCount:i.StudentCount,state:null}))}getEvaluationText(e,i){let n=e?.label||e?.value;return n?this.translate.instant(`events.state.${n}`)+(n===Z.RatingUntil?` ${i?At(i,"dd.MM.yyyy"):""}`:""):""}getEvaluationLink(e,i){return e&&e!==Z.Tests?this.buildLink(i.Id,"evaluation"):null}buildLink(e,i){return(this.settings.eventlist[i]??"").replace(":id",String(e))}static{this.\u0275fac=function(i){return new(i||t)(U(ce),U(ri),U(ci),U(Ue),U(Ve),U(ie),U(_e))}}static{this.\u0275prov=ue({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var pn=(t,l)=>l.id,cn=()=>[];function mn(t,l){t&1&&E(0,"bkd-spinner")}function un(t,l){t&1&&(a(0,"div",7),c(1),o(2,"translate"),r()),t&2&&(s(),f(" ",p(2,1,"events.rating")," "))}function hn(t,l){if(t&1&&E(0,"bkd-events-list-entry",8),t&2){let e=l.$implicit,i=h(3);m("event",e)("withRatings",i.withRatings)}}function gn(t,l){if(t&1&&(a(0,"div",3)(1,"div",4),c(2),o(3,"translate"),r(),a(4,"div",5),c(5),o(6,"translate"),r(),a(7,"div",6),c(8),o(9,"translate"),r(),I(10,un,3,3,"div",7),r(),z(11,hn,1,2,"bkd-events-list-entry",8,pn)),t&2){let e=h(2),i=B(0);s(2),C(p(3,4,"events.designation")),s(3),C(p(6,6,"events.date")),s(3),f(" ",p(9,8,"events.registrations")," "),s(2),w(e.withRatings?10:-1),s(),q(i)}}function fn(t,l){t&1&&(a(0,"p",2),c(1),o(2,"translate"),r()),t&2&&(s(),C(p(2,1,"events.no-events")))}function vn(t,l){if(t&1&&I(0,gn,13,10)(1,fn,3,3,"p",2),t&2){h();let e=B(0);w(e.length>0?0:1)}}var fi=["designation"],_n=[...fi,"evaluationText"],Je=(()=>{class t{constructor(e,i){this.state=e,this.storage=i,this.withStudyCourses=!1,this.withRatings=!0,this.state.setRoles(this.storage.getPayload()?.roles??null)}ngOnChanges(e){e.withStudyCourses&&this.state.setWithStudyCourses(e.withStudyCourses.currentValue),e.withRatings&&this.state.setSearchFields(e.withRatings.currentValue?_n:fi)}static{this.\u0275fac=function(i){return new(i||t)(v(we),v(Ve))}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-events-list"]],inputs:{withStudyCourses:"withStudyCourses",withRatings:"withRatings"},standalone:!0,features:[he,y],decls:10,vars:17,consts:[[1,"bkd-container"],[1,"d-flex","search",3,"valueChange","value","placeholder","label","disabled"],[1,"mt-3"],[1,"event-header"],[1,"designation"],[1,"date"],[1,"registrations"],[1,"rating"],[3,"event","withRatings"]],template:function(i,n){if(i&1){let d=$();R(0),o(1,"async"),a(2,"div",0)(3,"bkd-resettable-input",1),o(4,"async"),o(5,"translate"),o(6,"translate"),_("valueChange",function(g){return S(d),T(n.state.setSearch(g))}),r(),I(7,mn,1,0,"bkd-spinner"),o(8,"async"),I(9,vn,2,1),r()}if(i&2){let d,u=Y((d=p(1,5,n.state.getEntries(n.withRatings)))!==null&&d!==void 0?d:fe(16,cn));s(3),m("value",p(4,8,n.state.search$))("placeholder",p(5,10,"events.search-by"))("label",p(6,12,"events.search"))("disabled",!u),s(4),w(p(8,14,n.state.loading$)?7:9)}},dependencies:[li,Se,j,k,P,mi],styles:['.search[_ngcontent-%COMP%]{max-width:500px}.event-header[_ngcontent-%COMP%]{display:grid;padding:1rem;border-bottom:2px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}@media (max-width: 575.98px){.event-header[_ngcontent-%COMP%]{display:none}}']})}}return t})();var vi=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-events-current"]],standalone:!0,features:[y],decls:4,vars:5,consts:[[3,"withStudyCourses","withRatings"]],template:function(i,n){i&1&&(a(0,"h1"),c(1),o(2,"translate"),r(),E(3,"bkd-events-list",0)),i&2&&(s(),C(p(2,3,"events.current.title")),s(2),m("withStudyCourses",!0)("withRatings",!1))},dependencies:[Je,k,P]})}}return t})();var _i=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-events-tests"]],standalone:!0,features:[y],decls:4,vars:4,consts:[[3,"withRatings"]],template:function(i,n){i&1&&(a(0,"h1"),c(1),o(2,"translate"),r(),E(3,"bkd-events-list",0)),i&2&&(s(),C(p(2,2,"events.title")),s(2),m("withRatings",!0))},dependencies:[Je,k,P]})}}return t})();var Ci=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-events"]],standalone:!0,features:[pe([we,jt]),y],decls:1,vars:0,template:function(i,n){i&1&&E(0,"router-outlet")},dependencies:[$e]})}}return t})();function bi(t){return l=>{let e=Number(l.value);return e<=t?{greaterThan:{value:e,greaterThanValue:t}}:null}}function st(t){return t.map(({finalGrade:l})=>l).filter(Cn)}function Cn(t){return t!==null}function Si(t,l,e,i){return t?.map(n=>({student:n,finalGrade:xn(n,e,i),grades:bn(n,l)}))}function bn(t,l){return l.map(e=>{if(e.Results===void 0||e.Results?.length===0)return{kind:"no-result",test:e};let i=e.Results?.find(n=>n.StudentId===t.Id);return i!==void 0?{kind:"grade",result:i,test:e}:{kind:"no-result",test:e}})}function xn(t,l,e){let i=l.find(d=>d.StudentId===t.Id),n=e.find(d=>d.StudentId===t.Id);return i?{id:i.Id,average:yn(i),finalGradeId:i.GradeId,freeHandGrade:n?Number(n.Grade):null,canGrade:i.CanGrade}:null}function yn(t){return t.AverageTestResult===0?null:t.AverageTestResult}var Ti=({key:t,ascending:l})=>(e,i)=>{let n=l?1:-1;switch(t){case"FullName":return n*e.student.FullName.localeCompare(i.student.FullName);case"FinalGrade":return!e.finalGrade?.finalGradeId||!i.finalGrade?.finalGradeId?n*-1:n*xi(e.finalGrade.finalGradeId,i.finalGrade.finalGradeId);case"TestsMean":return!e.finalGrade?.average||!i.finalGrade?.average?n*-1:n*xi(e.finalGrade.average,i.finalGrade.average)}return n*Sn(t,e,i)},Sn=(t,l,e)=>{let i=l.grades.filter(yi).find(d=>d.test.Id===t.Id),n=e.grades.filter(yi).find(d=>d.test.Id===t.Id);return t.IsPointGrading&&i?.result.GradeId===n?.result.GradeId?(i?.result.Points??0)-(n?.result.Points??0):((i?.result.GradeId??Number.POSITIVE_INFINITY)-(n?.result.GradeId??Number.POSITIVE_INFINITY))*-1};function xi(t,l){return t===l?0:t<l?-1:1}function yi(t){return t.kind==="grade"}function wi(t){return(t?.test?.MaxPointsAdjusted||t?.test?.MaxPoints)??0}function Ii(t){let l=t.map(e=>e.average).filter(e=>e!=null&&e!==0).map(Number);return it(l)}function Ei(t,l){let e=t.map(n=>n.freeHandGrade).filter(n=>!!n),i=t.map(n=>n.finalGradeId).filter(n=>n!==null).map(n=>l.find(d=>d.Key===n)).filter(n=>n!==void 0).map(n=>n?.Value).filter(n=>n!==void 0).map(Number).filter(n=>!isNaN(n));return it([...i,...e])}function at(t,l){return[...l.filter(e=>e.Id!==t?.Id),t].filter(e=>e!=null)}function Pi({id:t,selectedGradeId:l},e){return e.map(i=>i.Id!==t?i:N(D({},i),{GradeId:l}))}function ki(t,l){switch(l.type){case"reset":return l.payload;case"updateResult":return t?N(D({},t),{Tests:zt(l.payload.testResult,t.Tests||[],l.payload.ignore),Gradings:l.payload.grading?at(l.payload.grading,t.Gradings||[]):t.Gradings}):null;case"deleteResult":return t?N(D({},t),{Tests:qt(l.payload.testId,l.payload.studentId,t.Tests||[]),Gradings:l.payload.grading?at(l.payload.grading,t.Gradings||[]):t.Gradings||[]}):null;case"toggle-test-state":return t?N(D({},t),{Tests:Yt(l.payload,t.Tests||[])}):null;case"final-grade-overwritten":return t?N(D({},t),{Gradings:Pi({id:l.payload.id,selectedGradeId:l.payload.selectedGradeId},t.Gradings||[])}):null;case"replace-grades":return t?N(D({},t),{Gradings:l.payload}):null;case"delete-test":return t?N(D({},t),{Tests:Kt(l.payload,t.Tests||[])}):null;default:return t}}var Mi=(()=>{class t extends Ht{constructor(e,i){super(e,i,ei,"Gradings")}updateGrade(e,i){return this.http.put(`${this.baseUrl}/${e}`,{GradeId:i}).pipe(b(()=>e))}static{this.\u0275fac=function(i){return new(i||t)(U(xt),U(_e))}}static{this.\u0275prov=ue({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var rt={onlyMine:!1,hidePublished:!1},H=(()=>{class t{constructor(e,i,n,d,u){this.coursesRestService=e,this.gradingScalesRestService=i,this.gradingsRestService=n,this.loadingService=d,this.sortService=u,this.action$=new Ze(1),this.loading$=this.loadingService.loading$,this._courseId$=new Ze(1),this.courseId$=this._courseId$.asObservable(),this.fetchedCourse$=this._courseId$.pipe(L(g=>this.loadingService.load(this.coursesRestService.getExpandedCourse(g))),Q(1)),this.course$=Me(this.action$,this.fetchedCourse$.pipe(Ee(Ne),b(g=>({type:"reset",payload:g})))).pipe(mt(ki,null),Ee(Ne),Q(1)),this.tests$=this.course$.pipe(b(g=>g.Tests||[]),b(Jt)),this.hasTests$=this.tests$.pipe(b(g=>g.length>0)),this.filterSubject$=new A(rt),this.filter$=this.filterSubject$.asObservable(),this.expandedHeaderSubject$=new A(!1),this.expandedHeader$=this.expandedHeaderSubject$.asObservable(),this.filteredTests$=te([this.tests$,this.filter$]).pipe(b(([g,M])=>g.filter(V=>(!M.onlyMine||V.IsOwner)&&(!M.hidePublished||!V.IsPublished)))),this.sorting$=this.sortService.sorting$,this.studentGrades$=te([this.course$,this.filteredTests$,this.sorting$]).pipe(b(ye(this.toStudentGrades.bind(this)))),this.canSetFinalGrade$=this.course$.pipe(b(ui)),this.gradingScaleIds$=this.course$.pipe(b(g=>Bt([...(g.Tests??[]).map(M=>M.GradingScaleId),g.GradingScaleId]).filter(Ne)),J(Rt),Q(1)),this.gradingScales$=this.gradingScaleIds$.pipe(L(g=>this.gradingScalesRestService.getGradingScales(g)),Q(1)),this.UNDEFINED_GRADINGSCALE_ID=-1,this.gradingScalesOptions$=this.gradingScales$.pipe(b(g=>g.map(M=>{let V=M?.Id||this.UNDEFINED_GRADINGSCALE_ID,Ie=M?.Grades.map(ke=>({Key:ke.Id,Value:ke.Designation}))||[];return{id:V,options:Ie}}).reduce((M,V)=>N(D({},M),{[V.id]:V.options}),{})),Q(1)),this.meanOfStudentGradesForCourse$=this.studentGrades$.pipe(b(g=>Ii(st(g)))),this.meanOfFinalGradesForCourse$=te([this.gradingScalesOptions$,this.studentGrades$]).pipe(L(ye(this.meanOfOverwrittenGradesForCourse.bind(this))))}setCourseId(e){this._courseId$.next(e)}setFilter(e){this.filterSubject$.next(e)}gradingOptionsForTest$(e){return this.gradingOptions$(e.GradingScaleId)}gradingOptionsForCourse$(){return this.course$.pipe(L(e=>this.gradingOptions$(e.GradingScaleId)))}toStudentGrades(e,i=[],n){return Si(e.ParticipatingStudents??[],i,e.Gradings??[],e.FinalGrades??[]).sort(Ti(n))}setSorting(e){this.sortService.setSorting(e)}getSortingChar$(e){return this.sortService.getSortingChar$(e)}sortBy(e){this.sortService.toggleSorting(e)}toggleHeader(e){this.expandedHeaderSubject$.next(e)}optimisticallyUpdateGrade(e){return this.course$.pipe(ne(1),b(i=>{let{originalResult:n,updatedResult:d}=this.buildOptimisticResultUpdate(i,e);return this.updateTestResult(d,null),n}))}saveGrade(e,i){this.course$.pipe(ne(1),L(n=>this.coursesRestService.updateTestResult(n.Id,e).pipe(lt(d=>(i&&this.updateTestResult(D({},i),null),dt(()=>d)))))).subscribe(({testResult:n,grading:d})=>this.updateOrDeleteTestResult(e.testId,e.studentId,n,d,"gradeId"in e?"grade":"points"))}publish(e){this.coursesRestService.publishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}unpublish(e){this.coursesRestService.unpublishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}deleteTest(e){this.action$.next({type:"delete-test",payload:e})}overwriteFinalGrade({id:e,selectedGradeId:i}){this.gradingsRestService.updateGrade(e,i).subscribe(()=>{this.action$.next({type:"final-grade-overwritten",payload:{id:e,selectedGradeId:i}})})}setAveragesAsFinalGrades(e){this.coursesRestService.setAverageAsFinalGrade(e).subscribe(i=>this.action$.next({type:"replace-grades",payload:i.Gradings}))}buildOptimisticResultUpdate(e,i){let n=Wt(e,i.testId,i.studentId),d=n?D({},n):{Id:"",TestId:i.testId,StudentId:i.studentId,CourseRegistrationId:0,GradeId:null,GradeValue:null,GradeDesignation:null,Points:null};return d.GradeId="gradeId"in i?i.gradeId:n?.GradeId??null,d.Points="points"in i?i.points:n?.Points??null,{originalResult:n,updatedResult:d}}updateOrDeleteTestResult(e,i,n,d,u){n?this.updateTestResult(n,d,u):this.deleteTestResult(e,i,d)}updateTestResult(e,i,n){this.action$.next({type:"updateResult",payload:{testResult:e,grading:i??null,ignore:n}})}deleteTestResult(e,i,n){this.action$.next({type:"deleteResult",payload:{testId:e,studentId:i,grading:n}})}toggleTestPublishedState(e){this.action$.next({type:"toggle-test-state",payload:e})}gradingOptions$(e){return e===null?K(null):this.gradingScalesOptions$.pipe(b(i=>i[e]),Q(1))}meanOfOverwrittenGradesForCourse(e,i){return this.course$.pipe(b(n=>{if(n.GradingScaleId===null||e[n.GradingScaleId]===void 0)return null;let d=e[n.GradingScaleId];return Ei(st(i),d)}))}static{this.\u0275fac=function(i){return new(i||t)(U(ce),U(ii),U(Mi),U(Ue),U(pi))}}static{this.\u0275prov=ue({token:t,factory:t.\u0275fac})}}return t})();var In=t=>["/events",t,"tests"];function En(t,l){if(t&1&&(a(0,"div",7),c(1),o(2,"translate"),r()),t&2){let e=l.$implicit;s(),f(" ",O(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Pn(t,l){if(t&1&&(a(0,"div",7),c(1),o(2,"translate"),r()),t&2){let e=l.$implicit;s(),f(" ",O(2,1,"global.validation-errors."+e.error,e.params)," ")}}function kn(t,l){if(t&1&&(a(0,"div",7),c(1),o(2,"translate"),r()),t&2){let e=l.$implicit;s(),f(" ",O(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Mn(t,l){if(t&1&&(a(0,"div",7),c(1),o(2,"translate"),r()),t&2){let e=l.$implicit;s(),f(" ",O(2,1,"global.validation-errors."+e.error,e.params)," ")}}function On(t,l){if(t&1&&(a(0,"div",7),c(1),o(2,"translate"),r()),t&2){let e=l.$implicit;s(),f(" ",O(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Gn(t,l){if(t&1&&(a(0,"div",29)(1,"div",30)(2,"div",16)(3,"label",31),c(4),o(5,"translate"),r(),a(6,"div",32),E(7,"input",33),o(8,"async"),z(9,Mn,3,4,"div",7,ge),o(11,"async"),r()()(),a(12,"div",30)(13,"div",16)(14,"label",34),c(15),o(16,"translate"),r(),a(17,"div",32),E(18,"input",35),o(19,"async"),z(20,On,3,4,"div",7,ge),o(22,"async"),r()()()(),a(23,"div",36),ft(),a(24,"math")(25,"mi"),c(26),o(27,"translate"),r(),a(28,"mo"),c(29,"="),r(),a(30,"mfrac")(31,"mrow")(32,"mi"),c(33),o(34,"translate"),r(),a(35,"mo"),c(36,"\xD7"),r(),a(37,"mn"),c(38,"5"),r()(),a(39,"mi"),c(40),o(41,"translate"),r()(),a(42,"mo"),c(43,"+"),r(),a(44,"mn"),c(45,"1"),r()()()),t&2){let e,i,n=h(2);s(4),C(p(5,9,"tests.form.max-points")),s(3),se("is-invalid",((e=p(8,11,n.maxPointsErrors$))==null?null:e.length)||!1),s(2),q(p(11,13,n.maxPointsErrors$)),s(6),C(p(16,15,"tests.form.max-points-adjusted")),s(3),se("is-invalid",((i=p(19,17,n.maxPointsAdjustedErrors$))==null?null:i.length)||!1),s(2),q(p(22,19,n.maxPointsAdjustedErrors$)),s(6),f(" ",p(27,21,"tests.form.math.grade")," "),s(7),f(" ",p(34,23,"tests.form.math.points")," "),s(7),C(p(41,25,"tests.form.math.max-points"))}}function $n(t,l){t&1&&(a(0,"div",28)(1,"span",37),c(2,"Loading..."),r()())}function Fn(t,l){if(t&1){let e=$();a(0,"form",2),_("ngSubmit",function(){S(e);let n=h();return T(n.onSubmit())}),a(1,"div",3)(2,"div",4)(3,"label",5),c(4),o(5,"translate"),r(),E(6,"input",6),o(7,"async"),o(8,"translate"),z(9,En,3,4,"div",7,ge),o(11,"async"),r(),a(12,"div",8)(13,"label",9),c(14),o(15,"translate"),r(),a(16,"div",10)(17,"span",11)(18,"i",12),c(19,"calendar_today"),r()(),a(20,"input",13,0),o(22,"async"),o(23,"translate"),_("click",function(){S(e);let n=le(21);return T(n.toggle())}),r(),z(24,Pn,3,4,"div",7,ge),o(26,"async"),r()()(),a(27,"div",14)(28,"label",15),c(29),o(30,"translate"),r(),a(31,"div",4)(32,"div",16)(33,"label",17),c(34),o(35,"translate"),r(),a(36,"div",18),E(37,"input",19),o(38,"async"),z(39,kn,3,4,"div",7,ge),o(41,"async"),r()()()(),a(42,"div")(43,"label",15),c(44),o(45,"translate"),r(),a(46,"div",20),E(47,"input",21),a(48,"label",22),c(49),o(50,"translate"),r()(),a(51,"div",20),E(52,"input",23),a(53,"label",24),c(54),o(55,"translate"),r()(),I(56,Gn,46,27),r(),a(57,"div",25)(58,"button",26),o(59,"async"),c(60),o(61,"translate"),r(),a(62,"button",27),c(63),o(64,"translate"),I(65,$n,3,0,"div",28),r()()()}if(t&2){let e,i,n,d,u=h();m("formGroup",u.formGroup),s(4),C(p(5,26,"tests.form.designation")),s(2),se("is-invalid",((e=p(7,28,u.designationErrors$))==null?null:e.length)||!1),m("placeholder",p(8,30,"tests.form.designation-placeholder")),s(3),q(p(11,32,u.designationErrors$)),s(5),C(p(15,34,"tests.form.date")),s(3),m("id",u.componentId),s(3),se("is-invalid",((i=p(22,36,u.dateErrors$))==null?null:i.length)||!1),m("placeholder",p(23,38,"shared.date-select.default-placeholder")),s(4),q(p(26,40,u.dateErrors$)),s(5),C(p(30,42,"tests.form.weight")),s(5),C(p(35,44,"tests.form.factor")),s(3),se("is-invalid",((n=p(38,46,u.weightErrors$))==null?null:n.length)||!1),s(2),q(p(41,48,u.weightErrors$)),s(5),C(p(45,50,"tests.form.grading-type")),s(3),m("value",!1),s(2),C(p(50,52,"tests.form.grades")),s(3),m("value",!0),s(2),C(p(55,54,"tests.form.points")),s(2),w((d=u.formGroup.get("isPointGrading"))!=null&&d.value?56:-1),s(2),m("disabled",u.saving)("routerLink",F(62,In,p(59,56,u.courseId$))),s(2),f(" ",p(61,58,"tests.form.cancel")," "),s(2),m("disabled",u.saving),s(),f(" ",p(64,60,"tests.form.save")," "),s(2),w(u.saving?65:-1)}}var Qe=(()=>{class t{constructor(e,i,n){this.fb=e,this.translate=i,this.testStateService=n,this.test=null,this.saving=!1,this.save=new X,this.componentId=Dt("bkd-tests-edit-form"),this.formGroup=this.createFormGroup(),this.submitted$=new A(!1),this.destroy$=new ee,this.designationErrors$=xe(K(this.formGroup),this.submitted$,"designation"),this.dateErrors$=xe(K(this.formGroup),this.submitted$,"date"),this.maxPointsErrors$=xe(K(this.formGroup),this.submitted$,"maxPoints"),this.maxPointsAdjustedErrors$=xe(K(this.formGroup),this.submitted$,"maxPointsAdjusted"),this.weightErrors$=xe(K(this.formGroup),this.submitted$,"weight"),this.courseId$=this.testStateService.courseId$}ngOnInit(){this.test&&this.setInitialValues(this.test),Lt(K(this.formGroup),"isPointGrading").pipe(oe(this.destroy$)).subscribe(this.togglePointFieldsDisability.bind(this))}ngOnDestroy(){this.destroy$.next()}onSubmit(){this.submitted$.next(!0),this.formGroup.valid&&this.save.emit(this.formGroup.value)}createFormGroup(){return this.fb.group({designation:["",Ce.required],date:[null,Ce.required],weight:[1,Ce.compose([Ce.required,bi(0)])],isPointGrading:[!1],maxPoints:[{value:null,disabled:!0},Ce.required],maxPointsAdjusted:[{value:null,disabled:!0},null]})}setInitialValues(e){this.formGroup.patchValue({designation:e.Designation,date:e.Date,weight:e.Weight,isPointGrading:e.IsPointGrading,maxPoints:e.MaxPoints,maxPointsAdjusted:e.MaxPointsAdjusted}),e.Results&&e.Results.length>0&&(this.formGroup.get("isPointGrading")?.disable(),this.formGroup.get("maxPoints")?.disable(),this.formGroup.get("maxPointsAdjusted")?.disable()),this.togglePointFieldsDisability()}togglePointFieldsDisability(){let e=this.formGroup.get("maxPoints"),i=this.formGroup.get("maxPointsAdjusted");this.formGroup.get("isPointGrading")?.value?(e?.enable(),i?.enable()):(e?.reset({value:this.test?.MaxPoints,disabled:!0}),i?.reset({value:this.test?.MaxPointsAdjusted,disabled:!0}))}static{this.\u0275fac=function(i){return new(i||t)(v(kt),v(ie),v(H))}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-tests-edit-form"]],inputs:{test:"test",saving:"saving"},outputs:{save:"save"},standalone:!0,features:[pe([{provide:Ot,useClass:Ft},{provide:Gt,useClass:di}]),y],decls:1,vars:1,consts:[["dp","ngbDatepicker"],[3,"formGroup"],[3,"ngSubmit","formGroup"],[1,"row","g-3","mb-3"],[1,"col-md-6"],["for","designation",1,"form-label"],["id","designation","name","designation","type","text","formControlName","designation","required","",1,"form-control",3,"placeholder"],[1,"invalid-feedback"],[1,"col-md-6","mb-3"],["for","date",1,"form-label"],[1,"input-group"],[1,"input-group-text",3,"id"],[1,"material-icons"],["id","date","name","date","type","text","ngbDatepicker","","formControlName","date","required","",1,"form-control",3,"click","placeholder"],[1,"row","mb-3"],[1,"form-label"],[1,"row"],["for","factor",1,"form-label","col-3","col-sm-2"],[1,"col-9","col-sm-10"],["id","factor","name","factor","type","number","formControlName","weight","step","0.05","min","0","required","",1,"form-control"],[1,"form-check"],["type","radio","formControlName","isPointGrading","id","type-grades",1,"form-check-input",3,"value"],["for","type-grades",1,"form-check-label"],["type","radio","formControlName","isPointGrading","id","type-points",1,"form-check-input",3,"value"],["for","type-points",1,"form-check-label"],[1,"d-flex","justify-content-end","mt-4"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","routerLink"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"row","ms-4","mb-3","g-3"],[1,"col-sm-6","col-md-4"],["for","max-points",1,"ms-2","col-4","col-form-label"],[1,"col-6"],["type","number","name","maxPoints","id","max-points","formControlName","maxPoints","step","0.01","min","0","max","999","required","",1,"form-control"],["for","max-points-adjusted",1,"ms-2","col-4","col-form-label"],["type","number","name","maxPointsAdjusted","id","max-points-adjusted","formControlName","maxPointsAdjusted","step","0.01","min","0","max","999",1,"form-control"],[1,"ms-4","ps-3","py-3"],[1,"visually-hidden"]],template:function(i,n){i&1&&I(0,Fn,66,64,"form",1),i&2&&w(n.formGroup?0:-1)},dependencies:[be,Tt,Re,De,wt,Be,yt,Pt,Ae,Le,Mt,It,Et,$t,re,j,k,P],styles:["#factor[_ngcontent-%COMP%], #max-points[_ngcontent-%COMP%], #max-points-adjusted[_ngcontent-%COMP%]{width:5em}"]})}}return t})();var Gi=(()=>{class t{constructor(e,i,n,d,u){this.route=e,this.courseService=i,this.toastService=n,this.translate=d,this.router=u,this.saving$=new A(!1),this.courseId$=this.route.paramMap.pipe(b(g=>Number(g.get("id"))),J())}save(e){this.saving$.next(!0);let{designation:i,date:n,weight:d,isPointGrading:u,maxPoints:g,maxPointsAdjusted:M}=e;this.courseId$.pipe(L(V=>this.courseService.add(V,n,i,d,u,g,M)),Oe(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}navigateBack(){this.courseId$.subscribe(e=>void this.router.navigate(["events",e,"tests"]))}static{this.\u0275fac=function(i){return new(i||t)(v(ve),v(ce),v(He),v(ie),v(Fe))}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-tests-add"]],standalone:!0,features:[y],decls:6,vars:6,consts:[[1,"bkd-container","bkd-container-limited"],[3,"save","saving"]],template:function(i,n){i&1&&(a(0,"h1"),c(1),o(2,"translate"),r(),a(3,"div",0)(4,"bkd-tests-edit-form",1),o(5,"async"),_("save",function(u){return n.save(u)}),r()()),i&2&&(s(),C(p(2,2,"tests.add-title")),s(3),m("saving",p(5,4,n.saving$)))},dependencies:[Qe,j,k,P]})}}return t})();var $i=(()=>{class t{constructor(e){this.activeModal=e}get canDeleteTest(){return(this.test?.Results?.filter(i=>i.GradeId!==null||i.GradeValue!==null||i.Points!==null)||[]).length===0}static{this.\u0275fac=function(i){return new(i||t)(v(je))}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-tests-delete"]],inputs:{test:"test"},standalone:!0,features:[y],decls:13,vars:10,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click","hidden"],[1,"px-2"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"],[1,"px-3"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"p",1),c(2),o(3,"translate"),r()(),a(4,"div",2)(5,"button",3),_("click",function(){return n.activeModal.dismiss()}),a(6,"span",4),c(7),o(8,"translate"),r()(),a(9,"button",5),_("click",function(){return n.activeModal.close(n.canDeleteTest?n.test:null)}),a(10,"span",6),c(11),o(12,"translate"),r()()()),i&2&&(s(2),f(" ",p(3,4,n.canDeleteTest?"tests.form.confirm":"tests.form.delete-not-allowed")," "),s(3),m("hidden",!n.canDeleteTest),s(2),f(" ",p(8,6,"tests.dialog.no")," "),s(4),f(" ",p(12,8,n.canDeleteTest?"tests.dialog.yes":"tests.dialog.ok")," "))},dependencies:[k,P]})}}return t})();var Ln=t=>({test:t});function An(t,l){t&1&&E(0,"bkd-spinner")}function jn(t,l){if(t&1){let e=$();a(0,"div",1)(1,"h1"),c(2),o(3,"translate"),r(),a(4,"button",2),_("click",function(){S(e);let n=h(),d=B(0);return T(n.openDeleteModal(d))}),a(5,"i",3),c(6,"delete"),r()()(),a(7,"bkd-tests-edit-form",4),_("save",function(n){S(e);let d=h();return T(d.save(n))}),r()}if(t&2){h();let e=B(0),i=B(2);s(2),f(" ",O(3,3,"tests.edit-title",F(6,Ln,e.Designation))," "),s(5),m("test",e)("saving",i)}}var Fi=(()=>{class t{constructor(e,i,n,d,u,g,M){this.state=e,this.courseService=i,this.route=n,this.toastService=d,this.translate=u,this.router=g,this.modalService=M,this.saving$=new A(!1),this.testId$=this.route.paramMap.pipe(b(V=>Number(V.get("testId"))),J()),this.test$=te([this.state.tests$,this.testId$]).pipe(b(([V,Ie])=>V.find(ke=>ke.Id===Ie)))}openDeleteModal(e){let i=this.modalService.open($i);i.componentInstance.test=e,i.result.then(n=>{n&&this.courseService.delete(e.CourseId,e.Id).subscribe(this.onDeleteSuccess.bind(this))},()=>{})}save(e){this.saving$.next(!0);let{designation:i,date:n,weight:d,isPointGrading:u,maxPoints:g,maxPointsAdjusted:M}=e;te([this.state.courseId$,this.testId$]).pipe(ne(1),L(([V,Ie])=>this.courseService.update(V,Ie,i,n,d,u,g,M)),Oe(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}onDeleteSuccess(e){this.toastService.success(this.translate.instant("tests.form.delete-success")),this.state.deleteTest(e),this.navigateBack()}navigateBack(){this.state.courseId$.pipe(ne(1)).subscribe(e=>void this.router.navigate(["events",e,"tests"]))}static{this.\u0275fac=function(i){return new(i||t)(v(H),v(ce),v(ve),v(He),v(ie),v(Fe),v(qe))}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-tests-edit"]],standalone:!0,features:[y],decls:8,vars:9,consts:[[1,"bkd-container","bkd-container-limited"],[1,"d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-primary","btn-icon",3,"click"],[1,"material-icons"],[3,"save","test","saving"]],template:function(i,n){if(i&1&&(R(0),o(1,"async"),R(2),o(3,"async"),a(4,"div",0),I(5,An,1,0,"bkd-spinner"),o(6,"async"),I(7,jn,8,8),r()),i&2){let d=Y(p(1,1,n.test$));s(2),Y(p(3,4,n.saving$)),s(3),w(p(6,7,n.state.loading$)?5:d?7:-1)}},dependencies:[Qe,Se,j,k,P]})}}return t})();var Hn=t=>({designation:t}),Ri=(()=>{class t{constructor(e){this.activeModal=e}static{this.\u0275fac=function(i){return new(i||t)(v(je))}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-publish-test"]],inputs:{test:"test"},standalone:!0,features:[y],decls:11,vars:12,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"p",1),c(2),o(3,"translate"),r()(),a(4,"div",2)(5,"button",3),_("click",function(){return n.activeModal.dismiss()}),c(6),o(7,"translate"),r(),a(8,"button",4),_("click",function(){return n.activeModal.close(!0)}),c(9),o(10,"translate"),r()()),i&2&&(s(2),f(" ",O(3,3,n.test.IsPublished?"tests.publishing.unpublish":"tests.publishing.publish",F(10,Hn,n.test.Designation))," "),s(4),f(" ",p(7,6,"tests.publishing.cancel")," "),s(3),f(" ",p(10,8,"tests.publishing.confirm")," "))},dependencies:[k,P],encapsulation:2})}}return t})();var Vn=t=>({maxPoints:t});function Nn(t,l){if(t&1&&(a(0,"div",6),c(1),o(2,"translate"),r()),t&2){let e=h(2);s(),f(" ",O(2,1,"global.validation-errors.invalidPoints",F(4,Vn,e.maxPoints))," ")}}function Un(t,l){if(t&1){let e=$();a(0,"div",3)(1,"input",5,0),_("ngModelChange",function(){S(e);let n=le(2),d=h();return T(d.onPointsChange(n.value))}),r(),I(3,Nn,3,6,"div",6),r()}if(t&2){let e=le(2),i=h();s(),se("is-invalid",e.errors),de("max",i.maxPoints),de("tabindex",i.tabIndex),m("disabled",i.grade.test.IsPublished)("ngModel",i.grade.kind==="grade"?i.grade.result.Points:null),s(2),w(e.errors?3:-1)}}var Wn=1250,Bi=(()=>{class t{constructor(e){this.state=e,this.maxPoints=0,this.pointsSubject$=new ee,this.gradeSubject$=new ee,this.gradingScaleDisabledSubject$=new A(!0),this.gradingScaleDisabled$=this.gradingScaleDisabledSubject$.asObservable(),this.destroy$=new ee}ngOnInit(){this.gradingScaleDisabledSubject$.next(this.disableGradingScale()),this.maxPoints=wi(this.grade),this.initSave(this.pointsSubject$.pipe(Ee(this.isValid.bind(this)),b(e=>({studentId:this.student.Id,testId:this.grade.test.Id,points:e?Number(e):null})))),this.initSave(this.gradeSubject$.pipe(b(e=>({studentId:this.student.Id,testId:this.grade.test.Id,gradeId:e}))))}ngOnChanges(){this.gradingScaleDisabledSubject$.next(this.disableGradingScale())}ngOnDestroy(){this.destroy$.next()}onPointsChange(e){this.pointsSubject$.next(e),this.gradingScaleDisabledSubject$.next(!(e===null||e===""))}onGradeChange(e){this.gradeSubject$.next(e)}isValid(e){return e===""||e===null?!0:isNaN(Number(e))?!1:!(Number(e)<0||Number(e)>this.maxPoints)}initSave(e){e.pipe(pt(i=>this.state.optimisticallyUpdateGrade(i).pipe(b(n=>({params:i,originalResult:n})))),ct(Wn),oe(this.destroy$)).subscribe(({params:i,originalResult:n})=>this.state.saveGrade(i,n))}disableGradingScale(){return this.grade.test.IsPublished?!0:this.grade.kind==="no-result"?!1:this.grade.result.Points!=null&&this.grade.test.IsPointGrading}static{this.\u0275fac=function(i){return new(i||t)(v(H))}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-grade"]],inputs:{grade:"grade",student:"student",tabIndex:"tabIndex",gradeOptions:"gradeOptions"},standalone:!0,features:[he,y],decls:5,vars:8,consts:[["points","ngModel"],[1,"d-flex","flex-column","w-100"],[1,"d-flex","flex-row"],[1,"point-input-container","me-2","me-md-3"],["data-testid","grade-select",1,"grade-select",3,"valueChange","options","allowEmpty","value","disabled","tabindex"],["type","number","step","0.01","min","0","data-testid","point-input",1,"form-control",3,"ngModelChange","max","disabled","tabindex","ngModel"],["data-testid","validation-error-message",1,"invalid-feedback"]],template:function(i,n){i&1&&(a(0,"div",1)(1,"div",2),I(2,Un,4,7,"div",3),a(3,"bkd-select",4),o(4,"async"),_("valueChange",function(u){return n.onGradeChange(u)}),r()()()),i&2&&(s(2),w(n.grade.test.IsPointGrading?2:-1),s(),m("options",n.gradeOptions)("allowEmpty",!0)("value",n.grade.kind==="grade"?n.grade.result.GradeId:null)("disabled",p(4,6,n.gradingScaleDisabled$))("tabindex",n.tabIndex))},dependencies:[be,Re,De,Be,Ae,Le,St,Te,j,k,P],styles:[".point-input-container[_ngcontent-%COMP%]{width:4em}[_nghost-%COMP%]     select{min-width:13ch}@media (min-width: 576px){.point-input-container[_ngcontent-%COMP%]{width:5em}}"]})}}return t})();function zn(t,l){if(t&1&&(a(0,"span",1),c(1),r()),t&2){let e=h();s(),C(e.calculatePointsAverage(e.test))}}var Di=(()=>{class t{constructor(e){this.locale=e}calculatePointsAverage(e){return this.safeAverage(e,2,We)}calculateGradeAverage(e){return this.safeAverage(e,3,ze)}safeAverage(e,i,n){try{return Zt(n(e),this.locale,i)}catch{return Qt}}static{this.\u0275fac=function(i){return new(i||t)(v(bt))}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-average-grades"]],inputs:{test:"test"},standalone:!0,features:[y],decls:4,vars:2,consts:[[1,"d-flex","flex-row","w-100"],["data-testid","average-points",1,"mr-2","mr-md-3","average-points"],["data-testid","average-grade"]],template:function(i,n){i&1&&(a(0,"div",0),I(1,zn,2,1,"span",1),a(2,"span",2),c(3),r()()),i&2&&(s(),w(n.test.IsPointGrading?1:-1),s(2),C(n.calculateGradeAverage(n.test)))},styles:[".average-points[_ngcontent-%COMP%]{min-width:4.5em}@media (min-width: 576px){.average-points[_ngcontent-%COMP%]{min-width:6em}}"]})}}return t})();var Li=(()=>{class t{constructor(){this.disabled=!1,this.width="13ch",this.gradeIdSelected=new X}onGradeChange(e){this.gradeId?.valueOf()!==void 0&&this.gradeIdSelected.emit({id:this.gradeId?.valueOf(),selectedGradeId:e})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-grade-select"]],inputs:{options:"options",valueId:"valueId",gradeId:"gradeId",disabled:"disabled",width:"width"},outputs:{gradeIdSelected:"gradeIdSelected"},standalone:!0,features:[y],decls:1,vars:5,consts:[["data-testid","grade-select",3,"valueChange","options","allowEmpty","value","disabled","width"]],template:function(i,n){i&1&&(a(0,"bkd-select",0),_("valueChange",function(u){return n.onGradeChange(u)}),r()),i&2&&m("options",n.options)("allowEmpty",!0)("value",n.valueId)("disabled",n.disabled)("width",n.width)},dependencies:[Te]})}}return t})();var qn=576,Ai=(()=>{class t{constructor(e,i){this.portal=e,this.state=i,this.destroy$=new ee,this.handleWindowScroll=()=>{this.updateStickyVisibility(),this.updateStickyTopOffset()},this.handleWindowResize=()=>{this.updateStickyWidth(),this.updateStickyVisibility(),this.updateStickyTopOffset()},this.handleTableScroll=()=>{this.updateStickyLeftOffset()}}ngOnInit(){te([this.state.filteredTests$,this.state.expandedHeader$]).pipe(oe(this.destroy$)).subscribe(()=>setTimeout(()=>this.updateStickyWidth()))}ngAfterViewInit(){this.handleWindowScroll(),this.handleTableScroll(),this.handleWindowResize(),this.window.addEventListener("scroll",this.handleWindowScroll),this.getTableScrollContainer()?.addEventListener("scroll",this.handleTableScroll),this.window.addEventListener("resize",this.handleWindowResize)}ngOnDestroy(){this.window.removeEventListener("scroll",this.handleWindowScroll),this.getTableScrollContainer()?.removeEventListener("scroll",this.handleTableScroll),this.window.removeEventListener("resize",this.handleWindowResize)}get window(){return this.portal.window??window}getTableScrollContainer(){return document.querySelector(".table-responsive-wrapper")??null}updateStickyVisibility(){if(this.isSmallBreakpointDown())return;let e=this.inlineHeader.getTop()+this.getIframeScrollY();this.stickyHeader.shown=this.getScrollTop()>e}updateStickyTopOffset(){this.isSmallBreakpointDown()||this.stickyHeader.setTopOffset(this.portal.inIframe?this.getScrollTop():0)}updateStickyLeftOffset(){this.isSmallBreakpointDown()||this.stickyHeader.setLeftOffset(this.inlineHeader.getLeft())}updateStickyWidth(){this.isSmallBreakpointDown()||(this.stickyHeader.setWidth(this.inlineHeader.getWidth()),this.stickyHeader.setColumnWidths(this.inlineHeader.getColumnWidths()),this.stickyHeader.setStickyColumnHeights(this.inlineHeader.getStickyColumnsHeights()))}getScrollTop(){return this.window.scrollY-this.portal.getIframeTop()}getIframeScrollY(){return window.scrollY}isSmallBreakpointDown(){return window.innerWidth<qn}static{this.\u0275fac=function(i){return new(i||t)(v(ni),v(H))}}static{this.\u0275dir=ht({type:t,selectors:[["","bkdTestEditGradesHeaderSticky",""]],inputs:{inlineHeader:"inlineHeader",stickyHeader:"stickyHeader"},standalone:!0})}}return t})();var ji=(t,l)=>({"btn-primary":t,"btn-outline-secondary":l}),Hi=(()=>{class t{constructor(){this.filter=rt,this.filterChange=new X}showOnlyMine(){this.filterChange.next(N(D({},this.filter),{onlyMine:!0}))}showAll(){this.filterChange.next(N(D({},this.filter),{onlyMine:!1}))}onHidePublishedChange(e){let i=(e.target&&e.target instanceof HTMLInputElement&&e.target?.checked)??!1;this.filterChange.next(N(D({},this.filter),{hidePublished:i}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-test-table-filter"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},standalone:!0,features:[y],decls:13,vars:18,consts:[[1,"only-mine-buttons"],["type","button",1,"btn","desktop",3,"click","ngClass"],["type","button",1,"btn","ms-2","desktop",3,"click","ngClass"],[1,"hide-published"],[1,"form-check"],["id","hide-published","type","checkbox",1,"form-check-input",3,"change","checked"],["for","hide-published",1,"form-check-label"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"button",1),_("click",function(){return n.showAll()}),c(2),o(3,"translate"),r(),a(4,"button",2),_("click",function(){return n.showOnlyMine()}),c(5),o(6,"translate"),r()(),a(7,"div",3)(8,"div",4)(9,"input",5),_("change",function(u){return n.onHidePublishedChange(u)}),r(),a(10,"label",6),c(11),o(12,"translate"),r()()()),i&2&&(s(),m("ngClass",tt(12,ji,!n.filter.onlyMine,n.filter.onlyMine)),s(),f(" ",p(3,6,"tests.all-tests")," "),s(2),m("ngClass",tt(15,ji,n.filter.onlyMine,!n.filter.onlyMine)),s(),f(" ",p(6,8,"tests.owned-tests")," "),s(4),m("checked",n.filter.hidePublished),s(2),f(" ",p(12,10,"tests.hide-published")," "))},dependencies:[ae,be,k,P],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:100%}.only-mine-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;height:3.625rem}.hide-published[_ngcontent-%COMP%]{display:flex;align-items:center;height:2.375rem;margin-bottom:1rem}.hide-published[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:300}.hide-published[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]{margin-bottom:0}"]})}}return t})();var Yn=["*"],Vi=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-preserve-line-height"]],standalone:!0,features:[y],ngContentSelectors:Yn,decls:3,vars:0,template:function(i,n){i&1&&(_t(),a(0,"div"),Ct(1),c(2,"\xA0"),r())},encapsulation:2})}}return t})();var Ni=(()=>{class t{constructor(e){this.translate=e}transform(e){return`${e.Weight} (${e.WeightPercent}%)${this.getPoints(e)}`}getPoints(e){return e.IsPointGrading?`, ${e.MaxPointsAdjusted??e.MaxPoints} ${this.translate.instant("tests.summary.points")}`:""}static{this.\u0275fac=function(i){return new(i||t)(v(ie,16))}}static{this.\u0275pipe=gt({name:"testSummaryShort",type:t,pure:!0,standalone:!0})}}return t})();var Kn=t=>[t,"edit"];function Jn(t,l){t&1&&(a(0,"i",9),c(1,"edit"),r())}function Qn(t,l){if(t&1&&(a(0,"div",5)(1,"div",7)(2,"bkd-preserve-line-height"),c(3),o(4,"date"),r(),a(5,"a",8),I(6,Jn,2,0,"i",9),r()(),a(7,"bkd-preserve-line-height"),c(8),o(9,"testSummaryShort"),r(),a(10,"bkd-preserve-line-height"),c(11),r()()),t&2){let e=h();s(3),C(O(4,5,e.test.Date,"dd.MM.yyyy")),s(2),m("routerLink",F(10,Kn,e.test.Id)),s(),w(e.test.IsOwner&&e.test.IsPublished===!1?6:-1),s(2),f(" ",p(9,8,e.test)," "),s(3),C(e.test.Owner)}}function Xn(t,l){if(t&1){let e=$();a(0,"div",6)(1,"a",10),o(2,"translate"),_("click",function(){S(e);let n=h();return T(n.unpublishTest())}),a(3,"i",11),c(4,"lock"),r(),a(5,"span"),c(6),o(7,"translate"),r()(),a(8,"bkd-caret",12),_("click",function(){S(e);let n=h();return T(n.emitToggleHeader())}),r()()}if(t&2){let e=h();s(),de("title",p(2,3,"tests.edit")),s(5),C(p(7,5,"tests.published")),s(2),m("expanded",e.expanded)}}function Zn(t,l){if(t&1){let e=$();a(0,"div",6)(1,"a",13),o(2,"translate"),_("click",function(){S(e);let n=h();return T(n.publishTest())}),a(3,"i",11),c(4,"lock_open"),r(),a(5,"span"),c(6),o(7,"translate"),r()(),a(8,"bkd-caret",12),_("click",function(){S(e);let n=h();return T(n.emitToggleHeader())}),r()()}if(t&2){let e=h();s(),de("title",p(2,3,"tests.publish")),s(5),C(p(7,5,"tests.not-published")),s(2),m("expanded",e.expanded)}}var Ui=(()=>{class t{constructor(){this.toggleHeader=new X,this.publish=new X,this.unpublish=new X}emitToggleHeader(){this.toggleHeader.emit(!this.expanded)}publishTest(){this.publish.emit(this.test)}unpublishTest(){this.unpublish.emit(this.test)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-test-table-header"]],inputs:{test:"test",expanded:"expanded"},outputs:{toggleHeader:"toggleHeader",publish:"publish",unpublish:"unpublish"},standalone:!0,features:[y],decls:9,vars:5,consts:[[1,"d-flex","flex-column","h-100","justify-content-between"],["role","button",1,"test-designation","d-flex","flex-row","my-3","align-items-end","justify-content-between",3,"click"],[3,"ngClass"],[1,"align-self-start",3,"expanded"],[1,"d-flex","flex-column"],[1,"d-flex","flex-column","mb-3"],[1,"d-flex","align-items-center","justify-content-between","test-status"],[1,"d-flex","flex-row","justify-content-between"],[1,"btn","btn-link","p-0","edit",3,"routerLink"],[1,"material-icons"],[1,"d-flex","btn","btn-link","ps-0","edit",3,"click","title"],[1,"material-icons","me-1"],[1,"expand-mobile",3,"click","expanded"],[1,"d-flex","btn","btn-link","ps-0",3,"click","title"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"div",1),_("click",function(){return n.emitToggleHeader()}),a(2,"div",2),c(3),r(),E(4,"bkd-caret",3),r(),a(5,"div",4),I(6,Qn,12,12,"div",5)(7,Xn,9,7,"div",6)(8,Zn,9,7,"div",6),r()()),i&2&&(s(2),m("ngClass",n.expanded?"expanded":"collapsed"),s(),f(" ",n.test.Designation," "),s(),m("expanded",n.expanded),s(2),w(n.expanded?6:-1),s(),w(n.test.IsPublished?7:8))},dependencies:[ae,Ut,Vi,re,Ge,k,P,Ni],styles:["[_nghost-%COMP%]{font-weight:300}.collapsed[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.test-designation[_ngcontent-%COMP%]{display:none!important}.test-status[_ngcontent-%COMP%]{order:-1;padding-bottom:1rem}.test-status[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.test-status[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#000}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.edit[_ngcontent-%COMP%]{color:#00000080;text-decoration:none}@media (min-width: 811px){.test-designation[_ngcontent-%COMP%]{display:inherit!important}.test-status[_ngcontent-%COMP%]{order:initial}.expand-mobile[_ngcontent-%COMP%]{display:none!important}}"]})}}return t})();var es=["bkdTestEditGradesHeader",""],ot=(t,l)=>l.Id,ts=t=>({selected:t});function is(t,l){if(t&1){let e=$();a(0,"th",3)(1,"bkd-test-table-header",12),_("toggleHeader",function(n){S(e);let d=h();return T(d.state.toggleHeader(n))})("publish",function(n){S(e);let d=h();return T(d.publish.emit(n))})("unpublish",function(n){S(e);let d=h();return T(d.unpublish.emit(n))}),r()()}if(t&2){let e=l.$implicit,i=h(),n=B(4);m("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),s(),m("test",e)("expanded",n)}}function ns(t,l){if(t&1){let e=$();a(0,"th",4)(1,"bkd-test-table-header",12),_("toggleHeader",function(n){S(e);let d=h();return T(d.state.toggleHeader(n))})("publish",function(n){S(e);let d=h();return T(d.publish.emit(n))})("unpublish",function(n){S(e);let d=h();return T(d.unpublish.emit(n))}),r()()}if(t&2){let e=l.$implicit,i=h(),n=B(4);m("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),s(),m("test",e)("expanded",n)}}function ss(t,l){if(t&1){let e=$();a(0,"div",13)(1,"span",14),_("click",function(){S(e);let n=h().$implicit,d=h();return T(d.state.sortBy(n))}),c(2),o(3,"translate"),r()()}t&2&&(s(2),f("",p(3,1,"tests.points")," "))}function as(t,l){if(t&1){let e=$();a(0,"th",11)(1,"div",6),I(2,ss,4,3,"div",13),a(3,"div",7)(4,"span",14),_("click",function(){let n=S(e).$implicit,d=h();return T(d.state.sortBy(n))}),c(5),o(6,"translate"),r()(),a(7,"div",8),c(8),o(9,"async"),r()()()}if(t&2){let e=l.$implicit,i=h();m("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),s(2),w(e.IsPointGrading?2:-1),s(3),C(p(6,4,"tests.grade")),s(3),f(" ",p(9,6,i.state.getSortingChar$(e))," ")}}var Wi=(()=>{class t{set shown(e){let i=this.element.nativeElement.classList;e?i.add("shown"):i.remove("shown")}constructor(e,i){this.state=e,this.element=i,this.sticky=!1,this.publish=new X,this.unpublish=new X}getTop(){return this.element.nativeElement.getBoundingClientRect().top}getLeft(){return this.element.nativeElement.getBoundingClientRect().left}setTopOffset(e){this.element.nativeElement.style.top=`${e}px`}setLeftOffset(e){this.element.nativeElement.style.left=`${e}px`}getWidth(){return this.element.nativeElement.getBoundingClientRect().width}setWidth(e){this.element.nativeElement.style.width=`${e}px`}getColumnWidths(){return this.getRowsAndColumns().map(e=>e.map(i=>i.getBoundingClientRect().width))}setColumnWidths(e){let i=this.getRowsAndColumns();if(i.length!==e.length||!i.every((n,d)=>n.length===e[d].length))throw new Error("Given column widths do not match number of header rows/columns");i.forEach((n,d)=>n.forEach((u,g)=>{u.style.width=`${e[d][g]}px`,u.style.minWidth=`${e[d][g]}px`}))}getStickyColumnsHeights(){return this.getRowsAndColumns(".sticky").map(e=>e.map(i=>i.getBoundingClientRect().height))}setStickyColumnHeights(e){let i=this.getRowsAndColumns(".sticky");if(i.length!==e.length||!i.every((n,d)=>n.length===e[d].length))throw new Error("Given column heights do not match number of sticky header columns");i.forEach((n,d)=>n.forEach((u,g)=>{u.style.height=`${e[d][g]}px`})),this.getRows().forEach((n,d)=>{let u=e[d].reduce((g,M)=>Math.max(g,M),0);n.style.height=`${u}px`})}getRowsAndColumns(e){return this.getRows().map(i=>Array.from(i.querySelectorAll(`th:not(.header-mobile)${e??""}`)))}getRows(){return Array.from(this.element.nativeElement.querySelectorAll("tr"))}static{this.\u0275fac=function(i){return new(i||t)(v(H),v(vt))}}static{this.\u0275cmp=x({type:t,selectors:[["thead","bkdTestEditGradesHeader",""]],hostVars:2,hostBindings:function(i,n){i&2&&se("sticky",n.sticky)},inputs:{selectedTest:"selectedTest",sticky:"sticky",shown:"shown"},outputs:{publish:"publish",unpublish:"unpublish"},standalone:!0,features:[y],attrs:es,decls:40,vars:29,consts:[[1,"header-collapsible"],["colspan","3",1,"desktop","sticky"],[3,"filterChange","filter"],["container","body",1,"test-grade","grade","test-info-desktop",3,"ngClass"],["container","body","colspan","3",1,"test-grade","header-mobile","test-info-mobile",3,"ngClass"],[1,"student-name",3,"click"],[1,"d-flex"],[1,"column-title"],[1,"sort-direction","ms-1"],[1,"student-grade","desktop",3,"click","ngClass"],[1,"border-end","student-average","desktop",3,"click"],["container","body",1,"test-grade",3,"ngClass"],[3,"toggleHeader","publish","unpublish","test","expanded"],[1,"column-title","me-3","point-input-container"],[3,"click"]],template:function(i,n){if(i&1){let d=$();R(0),o(1,"async"),R(2),o(3,"async"),R(4),o(5,"async"),a(6,"tr",0)(7,"th",1)(8,"bkd-test-table-filter",2),_("filterChange",function(g){return S(d),T(n.state.setFilter(g))}),r()(),z(9,is,2,3,"th",3,ot),z(11,ns,2,3,"th",4,ot),r(),a(13,"tr")(14,"th",5),_("click",function(){return S(d),T(n.state.sortBy("FullName"))}),a(15,"div",6)(16,"div",7),c(17),o(18,"translate"),r(),a(19,"div",8),c(20),o(21,"async"),r()()(),a(22,"th",9),_("click",function(){return S(d),T(n.state.sortBy("FinalGrade"))}),a(23,"div",6)(24,"div",7),c(25),o(26,"translate"),r(),a(27,"div",8),c(28),o(29,"async"),r()()(),a(30,"th",10),_("click",function(){return S(d),T(n.state.sortBy("TestsMean"))}),a(31,"div",6)(32,"div",7),c(33),o(34,"translate"),r(),a(35,"div",8),c(36),o(37,"async"),r()()(),z(38,as,10,8,"th",11,ot),r()}if(i&2){let d=p(1,8,n.state.filteredTests$),u=p(3,10,n.state.filter$);s(4),Y(p(5,12,n.state.expandedHeader$)),s(4),m("filter",u),s(),q(d),s(2),q(d),s(6),f(" ",p(18,15,"tests.student.name")," "),s(3),f(" ",p(21,17,n.state.getSortingChar$("FullName"))," "),s(2),m("ngClass",F(27,ts,n.selectedTest===void 0)),s(3),f(" ",p(26,19,"tests.grade")," "),s(3),f(" ",p(29,21,n.state.getSortingChar$("FinalGrade"))," "),s(5),f(" ",p(34,23,"tests.mean")," "),s(3),f(" ",p(37,25,n.state.getSortingChar$("TestsMean"))," "),s(2),q(d)}},dependencies:[j,ae,k,P,Hi,Ui],styles:["[_nghost-%COMP%]{--student-name-column-width: 225px;--student-grade-column-width: 147px;--student-average-column-width: 100px;--test-grade-column-width: 300px;--point-input-size: 4em;--student-grade-column-offset: var(--student-name-column-width);--student-average-column-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) );--test-columns-offset: calc( var(--student-average-column-offset) + var(--student-average-column-width) )}[_nghost-%COMP%]   #stickyHeader[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .scroll-test-table[_ngcontent-%COMP%]{display:table-caption;overflow-y:auto;height:auto}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (min-width: 576px){[_nghost-%COMP%]{--point-input-size: 5em}}tr[_ngcontent-%COMP%]:not(.header-collapsible)   th.test-grade[_ngcontent-%COMP%], td.test-grade[_ngcontent-%COMP%], th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%]{width:calc(var(--point-input-size) + 13ch + 3rem)}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-average[_ngcontent-%COMP%], .test-grade[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex;width:100%}.student-name[_ngcontent-%COMP%]{flex:1;display:block}.test-grade[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}.student-average[_ngcontent-%COMP%]{width:var(--student-average-column-width);min-width:var(--student-average-column-width);max-width:var(--student-average-column-width)}.test-grade[_ngcontent-%COMP%]{min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}th.sticky.student-average[_ngcontent-%COMP%], td.sticky.student-average[_ngcontent-%COMP%]{left:var(--student-average-column-offset)}}@media (max-width: 1200px){[_nghost-%COMP%]{--student-average-column-width: 1px}.student-average[_ngcontent-%COMP%]{padding:0;overflow:hidden}}@media (min-width: 1201px){.student-average-inline[_ngcontent-%COMP%]{display:none}}.sticky[_nghost-%COMP%]{position:fixed;top:0;left:0;z-index:1000;display:none}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;vertical-align:top}.header-collapsible[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:0 1rem}tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:none!important}@media (min-width: 811px){.sticky.shown[_nghost-%COMP%]{display:table-header-group}tr[_ngcontent-%COMP%]   th.test-info-mobile[_ngcontent-%COMP%]{display:none!important}tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:table-cell!important}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;padding-top:.25rem;padding-bottom:.25rem;border-top:initial}.sticky[_nghost-%COMP%]{margin-left:var(--test-columns-offset)}.sticky[_nghost-%COMP%]   th.sticky[_ngcontent-%COMP%]{position:fixed}}"],changeDetection:0})}}return t})();var rs=(t,l)=>l.student.Id,os=(t,l)=>l.Id,ds=(t,l)=>l.id,zi=t=>({selected:t}),ls=t=>["student",t,"grades"],ps=t=>({"visible-on-mobile":t});function cs(t,l){if(t&1){let e=$();a(0,"bkd-grade-select",20),o(1,"async"),o(2,"async"),_("gradeIdSelected",function(n){S(e);let d=h(2);return T(d.state.overwriteFinalGrade(n))}),r()}if(t&2){let e=h().$implicit,i=h();m("options",p(1,4,i.state.gradingOptionsForCourse$()))("valueId",e.finalGrade.finalGradeId)("gradeId",e.finalGrade.id)("disabled",p(2,6,i.isEditFinalGradesAllowed(e))===!1)}}function ms(t,l){if(t&1&&(a(0,"div"),c(1),r()),t&2){let e=h().$implicit;s(),f(" ",e.finalGrade.freeHandGrade," ")}}function us(t,l){if(t&1&&(R(0),a(1,"td",12),E(2,"bkd-grade",21),o(3,"async"),r()),t&2){let e=l.$implicit,i=l.$index,n=h(),d=n.$implicit,u=n.$index,g=h(),M=e.grade;s(),m("ngClass",g.selectedTest!==void 0&&M.test.Id===g.selectedTest.Id?"selected":""),s(),m("grade",M)("gradeOptions",p(3,5,g.state.gradingOptionsForTest$(M.test)))("student",d.student)("tabIndex",(1+i)*1e3+u)}}function hs(t,l){if(t&1&&(a(0,"tr")(1,"td",15)(2,"a",16)(3,"div"),c(4),r(),a(5,"div",9),c(6),o(7,"translate"),o(8,"decimalOrDash"),r()()(),a(9,"td",17),I(10,cs,3,8,"bkd-grade-select",18)(11,ms,2,1,"div"),r(),a(12,"td",19),c(13),o(14,"decimalOrDash"),r(),z(15,us,4,7,"td",12,ds),r()),t&2){let e=l.$implicit,i=h();s(2),m("routerLink",F(16,ls,e.student.Id)),s(2),C(e.student.FullName),s(2),et(" ",p(7,8,"tests.mean"),": ",O(8,10,e.finalGrade==null?null:e.finalGrade.average,"1-3")," "),s(3),m("ngClass",F(18,zi,i.selectedTest===void 0)),s(),w(e.finalGrade&&!e.finalGrade.freeHandGrade?10:-1),s(),w(e.finalGrade&&e.finalGrade.freeHandGrade?11:-1),s(2),f(" ",O(14,13,e.finalGrade==null?null:e.finalGrade.average,"1-3")," "),s(2),q(i.getGrades(e))}}function gs(t,l){if(t&1&&(a(0,"td",12),E(1,"bkd-average-grades",22),r()),t&2){let e=l.$implicit,i=h();m("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)||e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),s(),m("test",e)}}function fs(t,l){if(t&1){let e=$();a(0,"button",23),_("click",function(){S(e);let n=h();return T(n.setAverageAsFinalGrade())}),c(1),o(2,"translate"),r()}if(t&2){let e=h(),i=B(2);m("ngClass",F(4,ps,!i||!e.selectedTest)),s(),f(" ",p(2,2,"tests.set-final-grade")," ")}}var qi=(()=>{class t{constructor(e,i){this.state=e,this.modalService=i}ngOnInit(){this.state.setSorting({key:"FullName",ascending:!0})}setAverageAsFinalGrade(){this.state.course$.pipe(ne(1)).subscribe(e=>this.state.setAveragesAsFinalGrades({CourseIds:[e.Id]}))}isEditFinalGradesAllowed(e){return this.state.course$.pipe(b(i=>!!(Ye(i)?.value&&e.finalGrade?.canGrade)))}getGrades(e){return e.grades.flatMap(i=>({id:`${e.student.Id}-${i.test.Id}`,grade:i}))}publish(e){let i=this.openModal(e);this.onCloseModal(i,()=>this.state.publish(e))}unpublish(e){let i=this.openModal(e);this.onCloseModal(i,()=>this.state.unpublish(e))}calculatePointsAverage(e){return this.safeAverage(e,We)}calculateGradeAverage(e){return this.safeAverage(e,ze)}safeAverage(e,i){try{return i(e).toString()}catch{return"\u2013"}}openModal(e){let i=this.modalService.open(Ri);return i.componentInstance.test=e,i}onCloseModal(e,i){e.result.then(n=>{n&&i()},()=>{})}static{this.\u0275fac=function(i){return new(i||t)(v(H),v(qe))}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-test-edit-grades"]],inputs:{selectedTest:"selectedTest"},standalone:!0,features:[pe([we]),y],decls:39,vars:42,consts:[["inlineHeader",""],["stickyHeader",""],[1,"table-responsive-wrapper"],["bkdTestEditGradesHeaderSticky","",1,"table","table-hover","h-100",3,"inlineHeader","stickyHeader"],["bkdTestEditGradesHeader","",2,"display","block",3,"publish","unpublish","selectedTest"],["id","stickyHeader","bkdTestEditGradesHeader","",3,"publish","unpublish","sticky","selectedTest"],["id","scrollTestTable",1,"scroll-test-table"],[1,"sticky","student-name"],[1,"d-flex","flex-column"],[1,"student-average-inline"],[1,"desktop","sticky","student-grade",3,"ngClass"],[1,"desktop","border-end","sticky","student-average"],[1,"test-grade",3,"ngClass"],[1,"action-buttons"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"ngClass"],[1,"student-name"],[3,"routerLink"],[1,"student-grade",3,"ngClass"],[3,"options","valueId","gradeId","disabled"],[1,"border-end","sticky","student-average"],[3,"gradeIdSelected","options","valueId","gradeId","disabled"],[3,"grade","gradeOptions","student","tabIndex"],[3,"test"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"click","ngClass"]],template:function(i,n){if(i&1){let d=$();R(0),o(1,"async"),R(2),o(3,"async"),R(4),o(5,"async"),a(6,"div",2)(7,"table",3)(8,"thead",4,0),_("publish",function(g){return S(d),T(n.publish(g))})("unpublish",function(g){return S(d),T(n.unpublish(g))}),r(),a(10,"thead",5,1),_("publish",function(g){return S(d),T(n.publish(g))})("unpublish",function(g){return S(d),T(n.unpublish(g))}),r(),a(12,"tbody",6),z(13,hs,17,20,"tr",null,rs),a(15,"tr")(16,"td",7)(17,"div",8)(18,"div"),c(19),o(20,"translate"),r(),a(21,"div",9),c(22),o(23,"translate"),o(24,"async"),o(25,"decimalOrDash"),r()()(),a(26,"td",10),c(27),o(28,"async"),o(29,"decimalOrDash"),r(),a(30,"td",11),c(31),o(32,"async"),o(33,"decimalOrDash"),r(),z(34,gs,2,2,"td",12,os),r()()(),a(36,"div",13),I(37,fs,3,6,"button",14),o(38,"async"),r()()}if(i&2){let d=le(9),u=le(11),g=p(1,12,n.state.filteredTests$);s(2),Y(p(3,14,n.state.hasTests$));let M=p(5,17,n.state.studentGrades$);s(5),m("inlineHeader",d)("stickyHeader",u),s(),m("selectedTest",n.selectedTest),s(2),m("sticky",!0)("selectedTest",n.selectedTest),s(3),q(M),s(6),C(p(20,19,"tests.average")),s(3),et(" ",p(23,21,"tests.mean"),": ",O(25,25,p(24,23,n.state.meanOfStudentGradesForCourse$),"1-3")," "),s(4),m("ngClass",F(40,zi,n.selectedTest===void 0)),s(),f(" ",O(29,30,p(28,28,n.state.meanOfFinalGradesForCourse$),"1-3")," "),s(4),f(" ",O(33,35,p(32,33,n.state.meanOfStudentGradesForCourse$),"1-3")," "),s(3),q(g),s(3),w(p(38,38,n.state.canSetFinalGrade$)?37:-1)}},dependencies:[ae,re,Li,Bi,Di,j,k,P,Xt,Ai,Wi],styles:["[_nghost-%COMP%]{--student-name-column-width: 225px;--student-grade-column-width: 147px;--student-average-column-width: 100px;--test-grade-column-width: 300px;--point-input-size: 4em;--student-grade-column-offset: var(--student-name-column-width);--student-average-column-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) );--test-columns-offset: calc( var(--student-average-column-offset) + var(--student-average-column-width) )}[_nghost-%COMP%]   #stickyHeader[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .scroll-test-table[_ngcontent-%COMP%]{display:table-caption;overflow-y:auto;height:auto}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (min-width: 576px){[_nghost-%COMP%]{--point-input-size: 5em}}tr[_ngcontent-%COMP%]:not(.header-collapsible)   th.test-grade[_ngcontent-%COMP%], td.test-grade[_ngcontent-%COMP%], th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%]{width:calc(var(--point-input-size) + 13ch + 3rem)}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-average[_ngcontent-%COMP%], .test-grade[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex;width:100%}.student-name[_ngcontent-%COMP%]{flex:1;display:block}.test-grade[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}.student-average[_ngcontent-%COMP%]{width:var(--student-average-column-width);min-width:var(--student-average-column-width);max-width:var(--student-average-column-width)}.test-grade[_ngcontent-%COMP%]{min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}th.sticky.student-average[_ngcontent-%COMP%], td.sticky.student-average[_ngcontent-%COMP%]{left:var(--student-average-column-offset)}}@media (max-width: 1200px){[_nghost-%COMP%]{--student-average-column-width: 1px}.student-average[_ngcontent-%COMP%]{padding:0;overflow:hidden}}@media (min-width: 1201px){.student-average-inline[_ngcontent-%COMP%]{display:none}}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]{padding-right:0}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child{text-decoration:underline}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}.student-average-inline[_ngcontent-%COMP%]{color:#4e4e4ef2;font-size:.875rem;line-height:1}@media (min-width: 811px){.table-responsive-wrapper[_ngcontent-%COMP%]{display:block;overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.action-buttons[_ngcontent-%COMP%]{position:sticky;left:0}}@media (max-width: 810px){.apply-average-button[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]})}}return t})();var vs=()=>["/events"],_s=t=>({count:t});function Cs(t,l){if(t&1&&(a(0,"div",7),c(1),o(2,"translate"),r()),t&2){let e=h();s(),f(" ",O(2,1,e.course.ParticipatingStudents.length===1?"courses.registration":"courses.registrations",F(4,_s,e.course.ParticipatingStudents.length))," ")}}var Yi=(()=>{class t{constructor(e){this.reportsService=e,this.course$=new A(null),this.reports$=this.course$.pipe(b(i=>i?.Id),J(),L(i=>i?this.reportsService.getCourseReports(i):K([])),ut([]))}ngOnChanges(e){e.course&&this.course$.next(e.course.currentValue)}getDesignation(){return Ke(this.course)}static{this.\u0275fac=function(i){return new(i||t)(v(ti))}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-tests-header"]],inputs:{course:"course"},standalone:!0,features:[he,y],decls:12,vars:7,consts:[[3,"link"],[1,"d-flex"],["routerLink","add",1,"edit","btn","btn-primary","btn-icon","ms-2"],[1,"material-icons"],[1,"ms-2",3,"reports"],["id","excel-import"],[1,"d-flex","flex-column","header"],[1,"additional-info"]],template:function(i,n){i&1&&(a(0,"bkd-backlink",0)(1,"div",1)(2,"a",2)(3,"i",3),c(4,"add"),r()(),E(5,"bkd-reports-link",4),o(6,"async"),E(7,"div",5),r()(),a(8,"div",6)(9,"h1"),c(10),r(),I(11,Cs,3,6,"div",7),r()),i&2&&(m("link",fe(6,vs)),s(5),m("reports",p(6,4,n.reports$)),s(5),C(n.getDesignation()),s(),w(n.course.ParticipatingStudents?11:-1))},dependencies:[si,re,Nt,j,k,P],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem;border-bottom:1px solid #dee2e6}h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"]})}}return t})();var bs=()=>[],xs=t=>({"visible-on-mobile":t});function ys(t,l){t&1&&E(0,"bkd-spinner")}function Ss(t,l){if(t&1){let e=$();a(0,"bkd-select",4),_("valueChange",function(n){S(e);let d=h(2);return T(n&&d.testSelected(n))}),r(),E(1,"bkd-test-edit-grades",5)}if(t&2){h(2);let e=B(6),i=B(8),n=B(10);m("options",e)("value",i)("allowEmpty",!1),s(),m("selectedTest",n)}}function Ts(t,l){t&1&&(a(0,"p",2),c(1),o(2,"translate"),r()),t&2&&(s(),C(p(2,1,"tests.no-tests")))}function ws(t,l){if(t&1&&(a(0,"a",3),o(1,"async"),a(2,"i",6),c(3,"arrow_right_alt"),r(),a(4,"span",7),c(5),o(6,"translate"),r()()),t&2){let e=h(2),i=B(4),n=B(10);de("href",p(1,3,e.buildLinkToRatingOverview()),Pe),m("ngClass",F(7,xs,!i||!n)),s(5),C(p(6,5,"tests.link-to-rating-overview"))}}function Is(t,l){if(t&1&&(E(0,"bkd-tests-header",1),I(1,Ss,2,4)(2,Ts,3,3,"p",2)(3,ws,7,9,"a",3),o(4,"async")),t&2){let e=h(),i=B(0),n=B(2);m("course",i),s(),w(n.length>0?1:2),s(2),w(p(4,3,e.state.canSetFinalGrade$)?3:-1)}}var Ki=(()=>{class t{constructor(e,i,n){this.settings=e,this.state=i,this.translate=n,this.selectTest$=new ee,this.testOptions$=this.state.tests$.pipe(b(d=>[{Key:-1,Value:this.translate.instant("tests.grade")},...d.map(u=>({Key:u.Id,Value:u.Designation}))]),J()),this.selectedTestId$=Me(this.selectTest$,this.state.tests$.pipe(ne(1),b(d=>d[0]?.Id))).pipe(J()),this.selectedTest$=this.selectedTestId$.pipe(L(d=>this.state.tests$.pipe(b(u=>u.find(g=>g.Id===d)))),J())}testSelected(e){this.selectTest$.next(e)}buildLinkToRatingOverview(){return this.state.course$.pipe(ne(1),b(e=>this.settings.eventlist.evaluation.replace(":id",String(e.Id))))}static{this.\u0275fac=function(i){return new(i||t)(v(_e),v(H),v(ie))}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-tests-list"]],standalone:!0,features:[y],decls:16,vars:22,consts:[[1,"bkd-container"],[3,"course"],[1,"mt-3","px-3"],[1,"rating-overview","d-flex","justify-content-end","pe-3","border-top","pt-3",3,"ngClass","href"],["width","100%",1,"tests-dropdown",3,"valueChange","options","value","allowEmpty"],[3,"selectedTest"],[1,"material-icons","fw-bold"],[1,"ps-1"]],template:function(i,n){if(i&1&&(R(0),o(1,"async"),R(2),o(3,"async"),R(4),o(5,"async"),R(6),o(7,"async"),R(8),o(9,"async"),R(10),o(11,"async"),a(12,"div",0),I(13,ys,1,0,"bkd-spinner"),o(14,"async"),I(15,Is,5,5),r()),i&2){let d;Y(p(1,1,n.state.course$)),s(2),Y((d=p(3,4,n.state.tests$))!==null&&d!==void 0?d:fe(21,bs)),s(2),Y(p(5,7,n.state.hasTests$)),s(2),Y(p(7,10,n.testOptions$)),s(2),Y(p(9,13,n.selectedTestId$)),s(2),Y(p(11,16,n.selectedTest$)),s(3),w(p(14,19,n.state.loading$)?13:15)}},dependencies:[Yi,Te,qi,ae,Se,j,k,P],styles:[".tests-dropdown[_ngcontent-%COMP%]{display:block;padding:1rem 0}@media (min-width: 811px){.tests-dropdown[_ngcontent-%COMP%]{display:none}}a.rating-overview[_ngcontent-%COMP%]{text-decoration:none}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}@media (max-width: 810px){a.rating-overview[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]})}}return t})();var Xe=(()=>{class t{constructor(e,i){this.state=e,this.route=i,this.courseId$=this.route.paramMap.pipe(b(n=>Number(n.get("id"))),J()),this.destroy$=new ee}ngOnInit(){this.courseId$.pipe(oe(this.destroy$)).subscribe(e=>this.state.setCourseId(e))}ngOnDestroy(){this.destroy$.next()}static{this.\u0275fac=function(i){return new(i||t)(v(H),v(ve))}}static{this.\u0275cmp=x({type:t,selectors:[["bkd-tests"]],standalone:!0,features:[pe([H]),y],decls:1,vars:0,template:function(i,n){i&1&&E(0,"router-outlet")},dependencies:[$e]})}}return t})();var md=[{path:"",component:Ci,children:[{path:"",component:_i},{path:"current",component:vi},{path:":id",component:Xe,children:[{path:"tests",component:Ki}]},{path:":id/tests/:testId/edit",component:Xe,children:[{path:"",component:Fi}]},{path:":id/tests/add",component:Xe,children:[{path:"",component:Gi}]},{path:":id/tests",children:[ai]}]}];export{md as EVENTS_ROUTES};
