"use strict";(self.webpackChunkwebapp_schulverwaltung=self.webpackChunkwebapp_schulverwaltung||[]).push([[769],{4150:(ue,g,i)=>{i.r(g),i.d(g,{EVALUATE_ABSENCES_ROUTES:()=>ce});var h=i(6407),c=i(177),_=i(5539),y=i(1324),u=i(3955),v=i(6820),E=i(6354),C=i(6697),m=i(5558),I=i(4668),T=i(8667),k=i(1517),F=i(7887),e=i(4438),R=i(1861),S=i(2949),$=i(2612),A=i(9483);let G=(()=>{class t{constructor(n,s,a){this.studentsService=n,this.educationalEventsService=s,this.studyClassesService=a,this.filter={student:null,educationalEvent:null,studyClass:null},this.filterChange=new e.bkB,this.classesHttpFilter={params:{fields:"IsActive","filter.IsActive":"=true"}}}show(){this.filterChange.emit(this.filter)}static#e=this.\u0275fac=function(s){return new(s||t)(e.rXU(S.y),e.rXU($.e),e.rXU(A.r))};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["bkd-evaluate-absences-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},standalone:!0,features:[e.aNF],decls:20,vars:19,consts:[[1,"row","g-3","align-items-end"],[1,"col-sm-12","col-md"],[1,"form-label"],[3,"valueChange","typeaheadService","value"],[3,"valueChange","typeaheadService","value","additionalHttpParams"],[1,"col-auto"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(s,a){1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"label",2),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"bkd-typeahead",3),e.mxI("valueChange",function(o){return e.DH7(a.filter.student,o)||(a.filter.student=o),o}),e.k0s()(),e.j41(6,"div",1)(7,"label",2),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"bkd-typeahead",3),e.mxI("valueChange",function(o){return e.DH7(a.filter.educationalEvent,o)||(a.filter.educationalEvent=o),o}),e.k0s()(),e.j41(11,"div",1)(12,"label",2),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"bkd-typeahead",4),e.mxI("valueChange",function(o){return e.DH7(a.filter.studyClass,o)||(a.filter.studyClass=o),o}),e.k0s()(),e.j41(16,"div",5)(17,"button",6),e.bIt("click",function(){return a.show()}),e.EFF(18),e.nI1(19,"translate"),e.k0s()()()),2&s&&(e.R7$(3),e.JRh(e.bMT(4,11,"evaluate-absences.header.student")),e.R7$(2),e.Y8G("typeaheadService",a.studentsService),e.R50("value",a.filter.student),e.R7$(3),e.JRh(e.bMT(9,13,"evaluate-absences.header.module-instance")),e.R7$(2),e.Y8G("typeaheadService",a.educationalEventsService),e.R50("value",a.filter.educationalEvent),e.R7$(3),e.JRh(e.bMT(14,15,"evaluate-absences.header.study-class")),e.R7$(2),e.Y8G("typeaheadService",a.studyClassesService),e.R50("value",a.filter.studyClass),e.Y8G("additionalHttpParams",a.classesHttpFilter),e.R7$(3),e.SpI(" ",e.bMT(19,17,"evaluate-absences.header.show")," "))},dependencies:[R.V,u.h,u.D9],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1rem 1rem 1rem 0;border-bottom:1px solid #dee2e6}"],changeDetection:0})}return t})();var P=i(6977),L=i(2809),b=i(2915),x=i(1369),j=i(2673),f=i(9067),M=i(4814);let d=(()=>{class t extends b.z{constructor(n,s,a,r,o){super(n,s,o,a,"/evaluate-absences"),this.lessonPresenceService=r,this.queryParamsString$.pipe((0,P.Q)(this.destroy$)).subscribe(p=>this.confirmBackLinkParams={returnparams:p})}updateAfterConfirm(){this.resetEntries()}getInitialFilter(){return{student:null,educationalEvent:null,studyClass:null}}isValidFilter(n){return!!(n.student||n.educationalEvent||n.studyClass)}getInitialSorting(){return{key:"StudentFullName",ascending:!0}}loadEntries(n,s,a){return this.loadingService.load(this.lessonPresenceService.getStatistics(n,s,a),b.b)}buildParamsFromFilter(n){return(0,x.G)(n)}static#e=this.\u0275fac=function(s){return new(s||t)(e.KVO(c.aZ),e.KVO(j.U),e.KVO(L.yy),e.KVO(f.g),e.KVO(M.a))};static#t=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac})}return t})();var N=i(1769),X=i(8413),D=i(5507);const V=(t,l,n)=>({entries:t,hasMore:l,loadingPage:n}),U=()=>[],Y=t=>["student",t,"absences"],O=t=>({returnparams:t});function H(t,l){if(1&t){const n=e.RV6();e.j41(0,"th",16),e.bIt("click",function(){const a=e.eBV(n).$implicit,r=e.XpG(5);return e.Njj(r.state.sortService.toggleSorting(a.key))}),e.j41(1,"div",17)(2,"div",18),e.nI1(3,"translate"),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"div",19),e.EFF(7),e.nI1(8,"async"),e.k0s()()()}if(2&t){const n=l.$implicit,s=e.XpG(5);e.Y8G("ngClass",n.label),e.R7$(2),e.Y8G("ngbTooltip",e.bMT(3,4,"evaluate-absences.list.header."+n.label)),e.R7$(2),e.SpI(" ",e.bMT(5,6,"evaluate-absences.list.header."+n.label)," "),e.R7$(3),e.SpI(" ",e.bMT(8,8,s.state.sortService.getSortingChar$(n.key))," ")}}function B(t,l){if(1&t&&(e.j41(0,"a",22),e.nI1(1,"async"),e.EFF(2),e.k0s()),2&t){const n=e.XpG().$implicit,s=e.XpG().$implicit,a=e.XpG(6);e.Y8G("routerLink",e.eq3(5,Y,s.StudentRef.Id))("queryParams",e.eq3(7,O,e.bMT(1,3,a.profileReturnParams$))),e.R7$(2),e.SpI(" ",s[n.key]," ")}}function J(t,l){if(1&t&&e.EFF(0),2&t){const n=e.XpG().$implicit,s=e.XpG().$implicit;e.SpI(" ",s[n.key]," ")}}function K(t,l){if(1&t&&(e.j41(0,"td"),e.nI1(1,"translate"),e.DNE(2,B,3,9,"a",21)(3,J,1,1,"ng-template",null,3,e.C5r),e.k0s()),2&t){const n=l.$implicit,s=e.sdS(4);e.BMQ("data-label",e.bMT(1,3,"evaluate-absences.list.header."+n.label)),e.R7$(2),e.Y8G("ngIf","StudentFullName"===n.key)("ngIfElse",s)}}function W(t,l){if(1&t&&(e.j41(0,"tr"),e.DNE(1,K,5,5,"td",20),e.k0s()),2&t){const n=e.XpG(6);e.R7$(),e.Y8G("ngForOf",n.columns)}}function Q(t,l){if(1&t&&(e.j41(0,"tbody"),e.DNE(1,W,2,1,"tr",20),e.k0s()),2&t){const n=e.XpG(4).bkdLet;e.R7$(),e.Y8G("ngForOf",n.entries)}}function Z(t,l){1&t&&e.nrm(0,"bkd-spinner",23)}function z(t,l){if(1&t){const n=e.RV6();e.j41(0,"button",24),e.bIt("click",function(){e.eBV(n);const a=e.XpG(5);return e.Njj(a.state.nextPage())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&t&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"global.pagination.load-more")," "))}function w(t,l){if(1&t){const n=e.RV6();e.j41(0,"div",8)(1,"div",9),e.nrm(2,"bkd-reports-link",10),e.nI1(3,"async"),e.k0s(),e.j41(4,"table",11),e.bIt("scrolled",function(){e.eBV(n);const a=e.XpG(4);return e.Njj(a.onScroll())}),e.j41(5,"thead")(6,"tr"),e.DNE(7,H,9,10,"th",12),e.k0s()(),e.DNE(8,Q,2,1,"tbody",13),e.k0s(),e.DNE(9,Z,1,0,"bkd-spinner",14)(10,z,3,3,"button",15),e.k0s()}if(2&t){let n;const s=e.XpG(3).bkdLet,a=e.XpG();e.R7$(2),e.Y8G("reports",null!==(n=e.bMT(3,5,a.reports$))&&void 0!==n?n:e.lJ4(7,U)),e.R7$(5),e.Y8G("ngForOf",a.columns),e.R7$(),e.Y8G("ngIf",s.entries&&s.entries.length>0),e.R7$(),e.Y8G("ngIf",s.loadingPage),e.R7$(),e.Y8G("ngIf",s.hasMore&&!s.loadingPage)}}function q(t,l){1&t&&(e.j41(0,"p",25),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&t&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"evaluate-absences.no-entries")," "))}function ee(t,l){if(1&t&&(e.qex(0),e.DNE(1,w,11,8,"div",7)(2,q,3,3,"ng-template",null,2,e.C5r),e.bVm()),2&t){const n=e.sdS(3),s=e.XpG(2).bkdLet;e.R7$(),e.Y8G("ngIf",s.entries&&s.entries.length>0||s.loadingPage)("ngIfElse",n)}}function te(t,l){1&t&&e.nrm(0,"bkd-spinner")}function ne(t,l){if(1&t&&(e.qex(0),e.DNE(1,ee,4,2,"ng-container",6),e.nI1(2,"async"),e.DNE(3,te,1,0,"ng-template",null,1,e.C5r),e.bVm()),2&t){const n=e.sdS(4),s=e.XpG(2);e.R7$(),e.Y8G("ngIf",!1===e.bMT(2,2,s.state.loading$))("ngIfElse",n)}}function se(t,l){1&t&&(e.j41(0,"p",25),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&t&&(e.R7$(),e.JRh(e.bMT(2,1,"evaluate-absences.no-filter")))}function ae(t,l){if(1&t){const n=e.RV6();e.qex(0),e.j41(1,"bkd-evaluate-absences-header",5),e.nI1(2,"async"),e.bIt("filterChange",function(a){e.eBV(n);const r=e.XpG();return e.Njj(r.state.setFilter(a))}),e.k0s(),e.DNE(3,ne,5,4,"ng-container",6),e.nI1(4,"async"),e.DNE(5,se,3,3,"ng-template",null,0,e.C5r),e.bVm()}if(2&t){const n=e.sdS(6),s=e.XpG();e.R7$(),e.Y8G("filter",e.bMT(2,3,s.filterFromParams$)),e.R7$(2),e.Y8G("ngIf",e.bMT(4,5,s.state.isFilterValid$))("ngIfElse",n)}}let ie=(()=>{class t{constructor(n,s,a,r,o,p){this.state=n,this.scrollPosition=s,this.route=a,this.presenceTypesService=r,this.reportsService=o,this.lessonPresencesService=p,this.reports$=this.loadReports(),this.columns=[{key:"StudentFullName",label:"student"},{key:"TotalAbsences",label:"total"},{key:"TotalAbsencesValidExcuse",label:"valid-excuse"},{key:"TotalAbsencesWithoutExcuse",label:"without-excuse"},{key:"TotalAbsencesUnconfirmed",label:"unconfirmed"},{key:"TotalAbsencesUnchecked",label:"unchecked"},{key:"TotalIncidents",label:"incident"}],this.filterFromParams$=this.route.queryParams.pipe((0,E.T)(le)),this.profileReturnParams$=this.state.queryParamsString$}ngOnInit(){this.filterFromParams$.pipe((0,C.s)(1)).subscribe(n=>this.state.setFilter(n)),this.presenceTypesService.halfDayActive$.subscribe(n=>{n&&(this.columns=[...this.columns,{key:"TotalHalfDays",label:"halfday"}])})}ngAfterViewInit(){this.scrollPosition.restore()}onScroll(){this.state.nextPage()}loadReports(){return this.state.validFilter$.pipe((0,m.n)(n=>this.lessonPresencesService.getLessonRefs(n)),(0,m.n)(n=>n.length>0?this.reportsService.getEvaluateAbsencesReports(this.getReportRecordIds(n)):[]),(0,I.t)(1))}getReportRecordIds(n){return n.map(s=>`${s.LessonRef.Id}_${s.RegistrationRef.Id}`)}static#e=this.\u0275fac=function(s){return new(s||t)(e.rXU(d),e.rXU(N.W),e.rXU(_.nX),e.rXU(X._),e.rXU(D.P),e.rXU(f.g))};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["bkd-evaluate-absences-list"]],standalone:!0,features:[e.aNF],decls:7,vars:14,consts:[["noFilter",""],["loading",""],["noEntries",""],["noLink",""],[4,"bkdLet"],[3,"filterChange","filter"],[4,"ngIf","ngIfElse"],["class","py-3",4,"ngIf","ngIfElse"],[1,"py-3"],[1,"buttons"],[1,"mb-2",3,"reports"],["infiniteScroll","",1,"table","table-striped","table-fixed",3,"scrolled"],["scope","col",3,"ngClass","click",4,"ngFor","ngForOf"],[4,"ngIf"],["class","inline",4,"ngIf"],["type","button","class","btn btn-outline-secondary btn-sm d-block mx-auto",3,"click",4,"ngIf"],["scope","col",3,"click","ngClass"],[1,"d-flex"],[1,"column-title",3,"ngbTooltip"],[1,"sort-direction"],[4,"ngFor","ngForOf"],["class","student",3,"routerLink","queryParams",4,"ngIf","ngIfElse"],[1,"student",3,"routerLink","queryParams"],[1,"inline"],["type","button",1,"btn","btn-outline-secondary","btn-sm","d-block","mx-auto",3,"click"],[1,"mt-3"]],template:function(s,a){1&s&&(e.j41(0,"h1"),e.EFF(1),e.nI1(2,"translate"),e.k0s(),e.DNE(3,ae,7,7,"ng-container",4),e.nI1(4,"async"),e.nI1(5,"async"),e.nI1(6,"async")),2&s&&(e.R7$(),e.JRh(e.bMT(2,2,"evaluate-absences.title")),e.R7$(2),e.Y8G("bkdLet",e.sMw(10,V,e.bMT(4,4,a.state.entries$),e.bMT(5,6,a.state.hasMore$),e.bMT(6,8,a.state.loadingPage$))))},dependencies:[F.N,G,c.bT,T.Z,v.eO,v.DP,c.pM,c.YU,y.md,_.Wk,k.t,c.Jj,u.h,u.D9],styles:["th[_ngcontent-%COMP%]{cursor:pointer}th.student[_ngcontent-%COMP%]{width:30%}.column-title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"],changeDetection:0})}return t})();function le(t){return{student:t.student?Number(t.student):null,educationalEvent:t.educationalEvent?Number(t.educationalEvent):null,studyClass:t.studyClass?Number(t.studyClass):null}}var oe=i(9366),re=i(1876);const ce=[{path:"",component:(()=>{class t{constructor(n){this.state=n}static#e=this.\u0275fac=function(s){return new(s||t)(e.rXU(d))};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["bkd-evaluate-absences"]],standalone:!0,features:[e.Jv_([d,{provide:re.G,useExisting:d},oe.s]),e.aNF],decls:1,vars:0,template:function(s,a){1&s&&e.nrm(0,"router-outlet")},dependencies:[_.n3],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}return t})(),children:[{path:"",component:ie,data:{restoreScrollPositionFrom:["/evaluate-absences/student/:id"]}},h.R]}]}}]);