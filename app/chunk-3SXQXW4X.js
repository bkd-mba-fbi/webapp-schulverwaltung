import{a as Ge,c as Ke}from"./chunk-5NBAMED5.js";import"./chunk-2ALKCRZO.js";import{b as te}from"./chunk-GZOANHXY.js";import"./chunk-YU2OE6DK.js";import"./chunk-GXPKR22I.js";import"./chunk-MOUU4NVJ.js";import"./chunk-VGYWDNUP.js";import{a as We}from"./chunk-DPEWBBYN.js";import"./chunk-VN3OWFXO.js";import"./chunk-4AD6ZYJB.js";import"./chunk-XVSXXWST.js";import{a as qe}from"./chunk-WYN4IZCG.js";import"./chunk-E4SARKOR.js";import{d as ze,f as B,g as He}from"./chunk-RDNZARDR.js";import{l as Ve}from"./chunk-6TCJNTKT.js";import"./chunk-XWISOVKN.js";import{d as Fe}from"./chunk-3DIISX7M.js";import"./chunk-6A3MULQJ.js";import{e as Q}from"./chunk-GOVFDFD6.js";import{B as je,g as Be}from"./chunk-BQGWWMPT.js";import"./chunk-C4EQUSNO.js";import"./chunk-WORSXEGE.js";import{e as Ue}from"./chunk-6LRQCBUO.js";import"./chunk-Y4QYVF5K.js";import{a as Le}from"./chunk-UOIIL2R2.js";import{e as ce,p as we}from"./chunk-JE6RMKPQ.js";import"./chunk-RXV77OBQ.js";import"./chunk-M3VKTN3S.js";import{a as Ae}from"./chunk-USF5QQBL.js";import"./chunk-QLQ6HFBO.js";import"./chunk-RWAE7AP7.js";import"./chunk-GXPB5I4C.js";import"./chunk-D2H555EG.js";import"./chunk-KZWEGXU2.js";import"./chunk-YHCR7GAG.js";import{d as Ne}from"./chunk-KFP6476W.js";import{a as J,i as ee}from"./chunk-QWYAXZZX.js";import"./chunk-KKDVS2NL.js";import{b as Oe}from"./chunk-WNZFLLQC.js";import"./chunk-DVBPCEX4.js";import{b as Ie}from"./chunk-GH7I4V3C.js";import"./chunk-M732YBIP.js";import{A as R,O as Ee,P as Re,f as se,i as X,l as Pe,s as De,t as $e,u as Y}from"./chunk-RYYQAFJB.js";import{$b as Ce,Ab as G,Ac as O,Bc as F,Cc as N,Fb as ne,Fc as Se,Gc as I,Hb as m,Ib as K,Jb as h,Lc as o,Mb as ue,Mc as r,Md as ke,Nb as fe,Nc as k,Nd as Me,Ob as f,Pb as d,Pc as xe,Qb as c,Rb as g,Sd as Z,X as y,Xb as oe,Z as me,_ as T,a as z,b as U,bc as w,cb as j,d as de,dc as u,ec as _e,fb as n,fc as ge,ha as L,i as le,j as pe,je as D,ma as l,nc as ae,o as M,pc as ye,rc as p,sa as V,sc as x,sd as Te,t as b,ta as q,tc as S,td as E,u as H,ua as he,ub as v,uc as re,ud as W,vc as ve,xb as be}from"./chunk-CHBP6U4G.js";var Xe=Z({Id:Me,Holder:ke});var Ye=(()=>{class e extends J{constructor(){let i=l(X),t=l(R);super(i,t,Xe,"TeacherSubstitutions")}getTeacherSubstitution(i){return this.getList({params:{"filter.Id":`=${i}`}}).pipe(b(t=>t[0]||null))}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275prov=L({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var mt=["LessonTeacherRole","ClassTeacherRole","TeacherRole","AbsenceAdministratorRole"],ht=["LessonTeacherRole","TeacherRole","StudentRole","SubstituteAdministratorRole"],bt=["LessonTeacherRole","StudentRole"],$=(()=>{class e{constructor(){this.settingsService=l(te),this.lessonPresencesService=l(Q),this.studentsService=l(B),this.courseService=l(Ve),this.teacherSubstitutionService=l(Ye),this.personService=l(Ne),this.storageService=l(Ae),this.settings=l(R),this.rolesAndPermissions$=this.settingsService.getRolesAndPermissions(),this.userId$=new pe(1),this.lessonAbsences$=this.userId$.pipe(T(t=>this.studentsService.getLessonAbsences(t)),y(1)),this.lessonIncidents$=this.userId$.pipe(T(t=>this.studentsService.getLessonIncidents(t)),y(1)),this.loading$=this.rolesAndPermissions$.pipe(b(t=>t==null)),this.hasSearch$=this.rolesAndPermissions$.pipe(b(this.hasRoles(mt))),this.hasActions$=this.rolesAndPermissions$.pipe(b(this.hasRoles(ht))),this.hasTimetable$=this.rolesAndPermissions$.pipe(b(this.hasRoles(bt))),this.hasLessonTeacherRole$=this.rolesAndPermissions$.pipe(b(this.hasRoles(["LessonTeacherRole"])),y(1)),this.hasTeacherRole$=this.rolesAndPermissions$.pipe(b(this.hasRoles(["TeacherRole"])),y(1)),this.hasStudentRole$=this.rolesAndPermissions$.pipe(b(this.hasRoles(["StudentRole"])),y(1)),this.hasSubstituteAdministratorRole$=this.rolesAndPermissions$.pipe(b(this.hasRoles(["SubstituteAdministratorRole"])),y(1)),this.editAbsencesCount$=this.hasLessonTeacherRole$.pipe(T(t=>t?this.lessonPresencesService.checkableAbsencesCount():M(!1)),y(1)),this.openAbsencesCount$=this.rolesAndPermissions$.pipe(b(this.hasRoles(["LessonTeacherRole","ClassTeacherRole"])),T(t=>t?this.lessonPresencesService.getListOfUnconfirmed():M([])),b(t=>t.length),y(1)),this.myAbsencesCount$=this.hasStudentRole$.pipe(T(t=>t?this.getMyAbsences():M([])),b(this.getMyAbsencesCount.bind(this)),y(1)),this.coursesToRateCount$=this.courseService.getNumberOfCoursesForRating().pipe(me(0),y(1)),this.hasPresenceControl$=this.hasLessonTeacherRole$.pipe(T(t=>t?this.lessonPresencesService.hasLessonsLessonTeacher():M(!1)),y(1)),this.hasOpenAbsences$=this.openAbsencesCount$.pipe(b(t=>t>0),y(1)),this.editAbsencesParams$=this.getFullName().pipe(b(t=>({confirmationStates:this.settings.checkableAbsenceStateId,teacher:t})),y(1));let i=this.storageService.getPayload()?.id_person;i&&this.userId$.next(Number(i))}hasRoles(i){return t=>(t??[]).some(a=>i.includes(a))}getMyAbsences(){return H([this.userId$,this.lessonAbsences$,this.lessonIncidents$]).pipe(T(([i,t,a])=>this.loadTimetableEntries(i,t,a).pipe(b(C=>[...t,...a].map(_=>this.withTimetableEntry(_,C)).filter(Ie)))))}getMyAbsencesCount(i){return i?.filter(t=>("ConfirmationStateId"in t?t.ConfirmationStateId:null)===this.settings.unconfirmedAbsenceStateId).length||0}getFullName(){let i=Number(this.storageService.getPayload()?.substitution_id)||null;return i?this.teacherSubstitutionService.getTeacherSubstitution(i).pipe(b(t=>t?.Holder)):this.personService.getMyself().pipe(b(t=>t.FullName))}withTimetableEntry(i,t){return t.find(a=>a.Id===i.LessonRef.Id)?i:null}loadTimetableEntries(i,t,a){return this.studentsService.getTimetableEntries(i,{"filter.Id":`;${[...t,...a].map(C=>C.LessonRef.Id).join(";")}`})}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275prov=L({token:e,factory:e.\u0275fac})}}return e})();var ut=["*"];function ft(e,s){e&1&&oe(0)}function Ct(e,s){if(e&1&&(d(0,"a",1),G(1,ft,1,0,"ng-container",3),c()),e&2){let i=u(),t=ae(3);f("routerLink",i.link)("queryParams",i.linkParams),n(),f("ngTemplateOutlet",t)}}function _t(e,s){e&1&&oe(0)}function gt(e,s){if(e&1&&(d(0,"a",2),G(1,_t,1,0,"ng-container",3),c()),e&2){let i=u(),t=ae(3);f("href",i.externalLink,j),n(),f("ngTemplateOutlet",t)}}function yt(e,s){if(e&1&&(d(0,"span",5),p(1),c()),e&2){let i=u(2);n(),x(i.count)}}function vt(e,s){e&1&&(he(),d(0,"svg",6),g(1,"path",7),c())}function St(e,s){if(e&1&&(d(0,"span",4),p(1),o(2,"translate"),c(),d(3,"div"),ge(4),m(5,yt,2,1,"span",5)(6,vt,2,0,":svg:svg",6),c()),e&2){let i=u();n(),x(r(2,2,i.label)),n(4),h(i.hasCount(i.count)?5:6)}}var Ze=(()=>{class e{constructor(){}hasCount(i){return typeof i=="number"&&i>=0}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=v({type:e,selectors:[["bkd-dashboard-action"]],inputs:{label:"label",count:"count",link:"link",linkParams:"linkParams",externalLink:"externalLink"},ngContentSelectors:ut,decls:4,vars:2,consts:[["actionContent",""],[3,"routerLink","queryParams"],[3,"href"],[4,"ngTemplateOutlet"],[1,"label"],[1,"count"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none"],["fill","currentColor","d","m12 20-1.425-1.4 5.6-5.6H4v-2h12.175l-5.6-5.6L12 4l8 8-8 8Z"]],template:function(t,a){t&1&&(_e(),m(0,Ct,2,3,"a",1),m(1,gt,2,2,"a",2),G(2,St,7,4,"ng-template",null,0,xe)),t&2&&(h(a.externalLink?-1:0),n(),h(a.externalLink?1:-1))},dependencies:[Y,Te,D],styles:["a[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:space-between;align-items:center;padding:1rem 1.5rem;background:#f7e9d2;text-decoration:none;line-height:1}a[_ngcontent-%COMP%]:hover{background:#f2e0c3}a[_ngcontent-%COMP%]:focus-visible{outline-width:2px;outline-offset:-2px}div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:1rem}.label[_ngcontent-%COMP%]{font-weight:400}.count[_ngcontent-%COMP%]{font-size:1.5rem}"]})}}return e})();var Je=(()=>{class e{constructor(){}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=v({type:e,selectors:[["bkd-dashboard-deadline"]],inputs:{count:"count"},decls:3,vars:8,template:function(t,a){t&1&&(p(0),o(1,"translate"),o(2,"addSpace")),t&2&&ve("",r(1,3,"dashboard.actions.deadline"),"",k(2,5,": ",":"),"",a.count,`
`)},dependencies:[D,He],styles:["[_nghost-%COMP%]{background:#ea161f;color:#fff;white-space:nowrap;font-weight:500;font-size:.875rem;min-height:1.5rem;display:flex;padding:.375rem .5rem;align-items:center;border-radius:2.5rem}"]})}}return e})();var xt=()=>["/presence-control"],Tt=()=>["/edit-absences"],Pt=()=>["/open-absences"],Dt=()=>["/events"],$t=()=>["/my-absences","report"],kt=()=>["/my-absences"];function Mt(e,s){e&1&&g(0,"bkd-dashboard-action",0),e&2&&f("label","dashboard.actions.presence-control")("link",I(2,xt))}function Et(e,s){if(e&1&&(g(0,"bkd-dashboard-action",1),o(1,"async"),o(2,"async")),e&2){let i=u();f("label","dashboard.actions.edit-absences")("link",I(8,Tt))("linkParams",r(1,4,i.dashboardService.editAbsencesParams$))("count",r(2,6,i.dashboardService.editAbsencesCount$))}}function Rt(e,s){if(e&1&&(g(0,"bkd-dashboard-action",2),o(1,"async")),e&2){let i=u();f("label","dashboard.actions.open-absences")("link",I(5,Pt))("count",r(1,3,i.dashboardService.openAbsencesCount$))}}function At(e,s){if(e&1&&(g(0,"bkd-dashboard-deadline",4),o(1,"async")),e&2){let i=u(2);f("count",r(1,1,i.dashboardService.coursesToRateCount$))}}function Ot(e,s){if(e&1&&(d(0,"bkd-dashboard-action",0),m(1,At,2,3,"bkd-dashboard-deadline",4),o(2,"async"),c()),e&2){let i=u();f("label","dashboard.actions.tests")("link",I(5,Dt)),n(),h(r(2,3,i.dashboardService.coursesToRateCount$)??!1?1:-1)}}function It(e,s){e&1&&g(0,"bkd-dashboard-action",0),e&2&&f("label","dashboard.actions.my-absences-report")("link",I(2,$t))}function Lt(e,s){if(e&1&&(g(0,"bkd-dashboard-action",2),o(1,"async")),e&2){let i=u();f("label","dashboard.actions.my-absences")("link",I(5,kt))("count",r(1,3,i.dashboardService.myAbsencesCount$))}}function wt(e,s){if(e&1&&g(0,"bkd-dashboard-action",3),e&2){let i=u();f("label","dashboard.actions.substitutions")("externalLink",i.substitutionsAdminLink)}}var Qe=(()=>{class e{constructor(){this.dashboardService=l($),this.settings=l(R)}get substitutionsAdminLink(){return this.settings.dashboard.substitutionsAdminLink}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=v({type:e,selectors:[["bkd-dashboard-actions"]],decls:15,vars:23,consts:[[3,"label","link"],[3,"label","link","linkParams","count"],[3,"label","link","count"],[3,"label","externalLink"],[3,"count"]],template:function(t,a){t&1&&(m(0,Mt,1,3,"bkd-dashboard-action",0),o(1,"async"),m(2,Et,3,9,"bkd-dashboard-action",1),o(3,"async"),o(4,"async"),m(5,Rt,2,6,"bkd-dashboard-action",2),o(6,"async"),m(7,Ot,3,6,"bkd-dashboard-action",0),o(8,"async"),m(9,It,1,3,"bkd-dashboard-action",0),o(10,"async"),m(11,Lt,2,6,"bkd-dashboard-action",2),o(12,"async"),m(13,wt,1,2,"bkd-dashboard-action",3),o(14,"async")),t&2&&(h(r(1,7,a.dashboardService.hasPresenceControl$)?0:-1),n(2),h(r(3,9,a.dashboardService.hasLessonTeacherRole$)&&r(4,11,a.dashboardService.editAbsencesParams$)?2:-1),n(3),h(r(6,13,a.dashboardService.hasOpenAbsences$)?5:-1),n(2),h(r(8,15,a.dashboardService.hasTeacherRole$)?7:-1),n(2),h(r(10,17,a.dashboardService.hasStudentRole$)?9:-1),n(2),h(r(12,19,a.dashboardService.hasStudentRole$)?11:-1),n(2),h(r(14,21,a.dashboardService.hasSubstituteAdministratorRole$)?13:-1))},dependencies:[Ze,Je,E],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:.5rem}"]})}}return e})();var et=(()=>{class e{constructor(){this.studentsRestService=l(B),this.router=l($e)}navigateToDossier(i){return de(this,null,function*(){let t=Number(i);yield this.router.navigate(["dashboard","student",t,"contact"])})}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=v({type:e,selectors:[["bkd-dashboard-search"]],decls:1,vars:2,consts:[[3,"valueChange","typeaheadService","placeholder"]],template:function(t,a){t&1&&(d(0,"bkd-typeahead",0),w("valueChange",function(_){return _&&a.navigateToDossier(_)}),c()),t&2&&f("typeaheadService",a.studentsRestService)("placeholder","dashboard.search.placeholder")},dependencies:[We],styles:["[_nghost-%COMP%]{display:block;padding:.75rem;background:#f7e9d2}"]})}}return e})();var Bt=Z({}),tt=(()=>{class e extends J{constructor(){let i=l(X),t=l(R);super(i,t,Bt,"Teachers")}getTimetableEntries(i,t={}){let a=t instanceof se?t:new se({fromObject:t});return a=a.set("fields","Id,From,To,EventId,EventNumber,EventDesignation,EventLocation"),this.http.get(`${this.baseUrl}/${i}/TimetableEntries/CurrentSemester`,{params:a,headers:{"X-Role-Restriction":"LessonTeacherRole"}}).pipe(T(Oe(ze)))}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275prov=L({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var it=(()=>{class e{constructor(){this.sanitizer=l(Pe)}transform(i,t){switch(t){case"html":return this.sanitizer.bypassSecurityTrustHtml(i);case"style":return this.sanitizer.bypassSecurityTrustStyle(i);case"script":return this.sanitizer.bypassSecurityTrustScript(i);case"url":return this.sanitizer.bypassSecurityTrustUrl(i);case"resourceUrl":return this.sanitizer.bypassSecurityTrustResourceUrl(i);default:throw new Error(`Invalid safe type specified: ${t}`)}}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275pipe=be({name:"safe",type:e,pure:!0})}}return e})();function nt(e){return{id:rt(e.EventId,e.Id),from:e.From,until:e.To,eventId:e.EventId,subject:e.EventDesignation,room:e.EventLocation||void 0,teacher:e.EventManagerInformation||void 0}}function ot(e){let s=e.reduce((i,t)=>{let a=rt(t.EventRef.Id,t.LessonRef.Id);return U(z({},i),{[a]:[...i[a]??[],t.StudyClassNumber]})},{});return Object.keys(s).reduce((i,t)=>U(z({},i),{[t]:Ee([...s[t]].sort())}),{})}function at(e,s){return e.map(i=>U(z({},i),{studyClass:s[i.id]?.join(", ")}))}function rt(e,s){return`${e}-${s}`}var jt=(e,s)=>s.id;function Ft(e,s){e&1&&(d(0,"th"),p(1),o(2,"translate"),c()),e&2&&(n(),S(" ",r(2,1,"dashboard.timetable.table.teacher")," "))}function Nt(e,s){if(e&1&&(d(0,"a",3),p(1),d(2,"span",8),p(3),c()()),e&2){let i=u().$implicit,t=u(2).buildLink(i.eventId);f("routerLink",t.link)("queryParams",t.params),n(),S(" ",i.subject),n(2),S(", ",i.studyClass)}}function zt(e,s){if(e&1&&p(0),e&2){let i=u().$implicit;S(" ",i.subject," ")}}function Ut(e,s){if(e&1&&(d(0,"td",4),p(1),o(2,"translate"),c()),e&2){let i=u().$implicit;n(),re(" ",r(2,2,"dashboard.timetable.table.study-class"),": ",i.studyClass," ")}}function Ht(e,s){if(e&1&&(d(0,"td",5),p(1),c()),e&2){let i=u().$implicit;n(),S(" ",i.teacher," ")}}function Vt(e,s){e&1&&(d(0,"span",7),p(1),o(2,"translate"),c()),e&2&&(n(),x(r(2,1,"dashboard.timetable.table.room")))}function qt(e,s){if(e&1&&(d(0,"tr")(1,"td",1),p(2),o(3,"date"),o(4,"date"),c(),d(5,"td",2),m(6,Nt,4,4,"a",3),o(7,"async"),K(8,zt,1,1),c(),m(9,Ut,3,4,"td",4),o(10,"async"),m(11,Ht,2,1,"td",5),o(12,"async"),d(13,"td",6),m(14,Vt,3,3,"span",7),p(15),c()()),e&2){let i=s.$implicit,t=u(2);n(2),re(" ",k(3,7,i.from,"HH:mm"),"\u2013",k(4,10,i.until,"HH:mm")," "),n(4),h(r(7,13,t.isTeacher$)?6:8),n(3),h(r(10,15,t.isTeacher$)?9:-1),n(2),h(r(12,17,t.isStudent$)?11:-1),n(3),h(i.room?14:-1),n(),S(" ",i.room," ")}}function Gt(e,s){if(e&1&&(d(0,"table",0)(1,"thead")(2,"tr")(3,"th"),p(4),o(5,"translate"),c(),d(6,"th"),p(7),o(8,"translate"),c(),m(9,Ft,3,3,"th"),o(10,"async"),d(11,"th"),p(12),o(13,"translate"),c()()(),d(14,"tbody"),ue(15,qt,16,19,"tr",null,jt),c()()),e&2){let i=u();n(4),x(r(5,4,"dashboard.timetable.table.time")),n(3),x(r(8,6,"dashboard.timetable.table.subject")),n(2),h(r(10,8,i.isStudent$)?9:-1),n(3),S(" ",r(13,10,"dashboard.timetable.table.room")," "),n(3),fe(i.entries)}}function Kt(e,s){e&1&&(d(0,"p"),p(1),o(2,"translate"),c()),e&2&&(n(),x(r(2,1,"dashboard.timetable.no-entries")))}var st=(()=>{class e{constructor(){this.dashboardService=l($),this.entries=[],this.isStudent$=this.dashboardService.hasStudentRole$,this.isTeacher$=this.dashboardService.hasLessonTeacherRole$}buildLink(i){return Fe(Ge(i,"/dashboard"))}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=v({type:e,selectors:[["bkd-dashboard-timetable-table"]],inputs:{entries:"entries"},decls:2,vars:1,consts:[[1,"table"],[1,"time"],[1,"subject"],[3,"routerLink","queryParams"],[1,"study-class"],[1,"teacher"],[1,"room"],[1,"room-label"],[1,"subject-study-class"]],template:function(t,a){t&1&&m(0,Gt,17,12,"table",0)(1,Kt,3,3,"p"),t&2&&h(a.entries.length>0?0:1)},dependencies:[Y,E,W,D],styles:['td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{padding:1rem 1.75rem}.room-label[_ngcontent-%COMP%], td.study-class[_ngcontent-%COMP%]{display:none}@media(max-width:767.98px){table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{display:none}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]{border-top:1px solid var(--bs-border-color)}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-template-areas:"time room" "subject subject" "study-class study-class" "teacher teacher";gap:.5rem;padding:1rem;border-bottom:1px solid var(--bs-border-color)}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:0;padding:0}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.time[_ngcontent-%COMP%]{grid-area:time;font-size:.875rem;line-height:1.125rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.subject[_ngcontent-%COMP%]{grid-area:subject;font-size:1rem;line-height:1.25rem;font-weight:400}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.teacher[_ngcontent-%COMP%]{grid-area:teacher;font-size:.8125rem;line-height:1.0625rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.room[_ngcontent-%COMP%]{grid-area:room;text-align:right;font-size:.875rem;line-height:1.125rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.study-class[_ngcontent-%COMP%]{grid-area:study-class;font-size:.8125rem;line-height:1.0625rem;font-weight:300}td.study-class[_ngcontent-%COMP%]{display:block}.subject-study-class[_ngcontent-%COMP%]{display:none}.room-label[_ngcontent-%COMP%]{display:inline}}']})}}return e})();function Wt(e,s){e&1&&(d(0,"a",6),o(1,"safe"),p(2),o(3,"translate"),c()),e&2&&(f("href",k(1,2,s,"url"),j),n(2),S(" ",r(3,5,"dashboard.timetable.subscribe-calendar")," "))}function Xt(e,s){e&1&&g(0,"bkd-spinner")}function Yt(e,s){e&1&&(d(0,"a",8),o(1,"safe"),p(2),o(3,"translate"),c()),e&2&&(f("href",k(1,2,s,"url"),j),n(2),S(" ",r(3,5,"dashboard.timetable.subscribe-calendar")," "))}function Zt(e,s){if(e&1&&(g(0,"bkd-dashboard-timetable-table",7),m(1,Yt,4,7,"a",8),o(2,"async")),e&2){let i,t=u(),a=N(18);f("entries",a),n(),h((i=r(2,2,t.getSubscribeCalendarUrl()))?1:-1,i)}}var Jt="cal",ct=(()=>{class e{constructor(){this.teachersService=l(tt),this.studentsService=l(B),this.lessonPresencesService=l(Q),this.userSettings=l(te),this.dashboardService=l($),this.loadingService=l(Ue),this.userId$=this.dashboardService.userId$,this.isTeacher$=this.dashboardService.hasLessonTeacherRole$,this.isStudent$=this.dashboardService.hasStudentRole$,this.date$=new le(ce(new Date)),this.loading$=this.loadingService.loading$,this.timetableEntries$=this.loadTimetableEntries()}gotoToday(){this.date$.next(ce(new Date))}gotoPreviousDay(){this.date$.next(Be(this.date$.getValue(),1))}gotoNextDay(){this.date$.next(Le(this.date$.getValue(),1))}getSubscribeCalendarUrl(){return this.userSettings.getSetting(Jt)}loadTimetableEntries(){return H([this.isTeacher$,this.isStudent$,this.userId$,this.date$]).pipe(T(([i,t,a,C])=>{let _=()=>i?this.fetchTimetableEntries("teacher",a,C):t?this.fetchTimetableEntries("student",a,C):M([]);return this.loadingService.load(_())}),y(1))}fetchTimetableEntries(i,t,a){let C={"filter.From":`=${we(a,"yyyy-MM-dd")}`,sort:"From,To"};return(i==="teacher"?this.teachersService.getTimetableEntries(t,C):this.studentsService.getTimetableEntries(t,C)).pipe(b(_=>_.map(nt)),b(_=>Re(_,A=>A.id)),T(_=>i==="teacher"?this.loadStudyClasses(a).pipe(b(A=>at(_,A))):M(_)))}loadStudyClasses(i){return this.lessonPresencesService.getLessonStudyClassesByDate(i).pipe(b(ot))}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=v({type:e,selectors:[["bkd-dashboard-timetable"]],decls:23,vars:24,consts:[[1,"header"],["type","button",1,"btn","btn-primary","today",3,"click"],["type","button",1,"btn","btn-secondary","previous-day",3,"click"],[1,"material-icons"],["type","button",1,"btn","btn-secondary","next-day",3,"click"],[1,"date"],["target","_parent",1,"btn","btn-secondary","subscribe-calendar-header",3,"href"],[3,"entries"],["target","_parent",1,"btn","btn-secondary","subscribe-calendar-bottom",3,"href"]],template:function(t,a){if(t&1){let C=Ce();d(0,"div",0)(1,"button",1),w("click",function(){return V(C),q(a.gotoToday())}),p(2),o(3,"translate"),c(),d(4,"button",2),o(5,"translate"),w("click",function(){return V(C),q(a.gotoPreviousDay())}),d(6,"span",3),p(7,"chevron_left"),c()(),d(8,"button",4),o(9,"translate"),w("click",function(){return V(C),q(a.gotoNextDay())}),d(10,"span",3),p(11,"chevron_right"),c()(),d(12,"div",5),p(13),o(14,"async"),o(15,"date"),c(),m(16,Wt,4,7,"a",6),o(17,"async"),c(),O(18),o(19,"async"),m(20,Xt,1,0,"bkd-spinner"),o(21,"async"),K(22,Zt,3,4)}if(t&2){let C;n(2),S(" ",r(3,6,"dashboard.timetable.today")," "),n(2),ne("aria-label",r(5,8,"dashboard.timetable.previousDay")),n(4),ne("aria-label",r(9,10,"dashboard.timetable.nextDay")),n(5),x(k(15,14,r(14,12,a.date$),"E, dd. MMMM yyyy")),n(3),h((C=r(17,17,a.getSubscribeCalendarUrl()))?16:-1,C),n(2),F(r(19,19,a.timetableEntries$)),n(2),h(r(21,22,a.loading$)?20:22)}},dependencies:[st,ee,E,W,D,it],styles:["[_nghost-%COMP%]{display:block;margin-bottom:1rem}.header[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:2rem;display:flex;align-items:center;gap:1rem}.previous-day[_ngcontent-%COMP%], .next-day[_ngcontent-%COMP%]{padding-left:.375rem;padding-right:.375rem}.date[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600}.subscribe-calendar-header[_ngcontent-%COMP%]{margin-left:auto}.subscribe-calendar-bottom[_ngcontent-%COMP%]{display:none}a.btn[_ngcontent-%COMP%]{text-decoration:none}@media(max-width:767.98px){.subscribe-calendar-header[_ngcontent-%COMP%]{display:none}.subscribe-calendar-bottom[_ngcontent-%COMP%]{display:block;margin-top:2rem}}@media(max-width:767.98px)and (max-width:575.98px){.header[_ngcontent-%COMP%]{flex-wrap:wrap-reverse}.header[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{width:100%}}"]})}}return e})();function Qt(e,s){e&1&&g(0,"bkd-spinner")}function ei(e,s){e&1&&(d(0,"p"),p(1),o(2,"translate"),c()),e&2&&(n(),S(" ",r(2,1,"dashboard.no-access")," "))}function ti(e,s){e&1&&(d(0,"div")(1,"h2"),p(2),o(3,"translate"),c(),g(4,"bkd-dashboard-search"),c()),e&2&&(n(2),x(r(3,1,"dashboard.search.title")))}function ii(e,s){e&1&&(d(0,"div")(1,"h2"),p(2),o(3,"translate"),c(),g(4,"bkd-dashboard-actions"),c()),e&2&&(n(2),x(r(3,1,"dashboard.actions.title")))}function ni(e,s){if(e&1&&(d(0,"div",1),m(1,ti,5,3,"div"),m(2,ii,5,3,"div"),c()),e&2){u();let i=N(2),t=N(4);n(),h(i?1:-1),n(),h(t?2:-1)}}function oi(e,s){e&1&&(d(0,"div",2)(1,"h2"),p(2),o(3,"translate"),c(),g(4,"bkd-dashboard-timetable"),c()),e&2&&(n(2),x(r(3,1,"dashboard.timetable.title")))}var dt=(()=>{class e{constructor(){this.dashboardService=l($)}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=v({type:e,selectors:[["bkd-dashboard-layout"]],decls:17,vars:19,consts:[[1,"columns"],[1,"search-actions-column"],[1,"timetable-column"]],template:function(t,a){if(t&1&&(O(0),o(1,"async"),O(2),o(3,"async"),O(4),o(5,"async"),O(6),o(7,"async"),d(8,"div")(9,"h1"),p(10),o(11,"translate"),c(),m(12,Qt,1,0,"bkd-spinner"),m(13,ei,3,3,"p"),d(14,"div",0),m(15,ni,3,2,"div",1),m(16,oi,5,3,"div",2),c()()),t&2){let C=r(1,7,a.dashboardService.loading$);n(2);let _=F(r(3,9,a.dashboardService.hasSearch$));n(2);let A=F(r(5,12,a.dashboardService.hasActions$)),ie=r(7,15,a.dashboardService.hasTimetable$);n(5),ye("visually-hidden",C||_||A||ie),n(),S(" ",r(11,17,"dashboard.heading")," "),n(2),h(C?12:-1),n(),h(!C&&!_&&!A&&!ie?13:-1),n(2),h(_||A?15:-1),n(),h(ie?16:-1)}},dependencies:[ee,et,Qe,ct,E,D],styles:[".columns[_ngcontent-%COMP%]{display:flex;flex-direction:column}.columns[_ngcontent-%COMP%], .search-actions-column[_ngcontent-%COMP%]{gap:3rem}.search-actions-column[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;max-width:40rem}.timetable-column[_ngcontent-%COMP%]{flex:2}@media(min-width:992px){.columns[_ngcontent-%COMP%]{flex-direction:row;gap:1.5rem}.search-actions-column[_ngcontent-%COMP%]{max-width:33%}}"],changeDetection:0})}}return e})();var lt=(()=>{class e{constructor(){}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=v({type:e,selectors:[["bkd-dashboard"]],features:[Se([$,je])],decls:1,vars:0,template:function(t,a){t&1&&g(0,"router-outlet")},dependencies:[De],encapsulation:2,changeDetection:0})}}return e})();var ao=[{path:"",component:lt,children:[{path:"",component:dt},qe,Ke("students/:id")]}];export{ao as DASHBOARD_ROUTES};
