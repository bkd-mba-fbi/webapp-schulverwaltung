import{a as mt}from"./chunk-QE74EW6O.js";import{a as pt,b as ct}from"./chunk-NK7SMC5C.js";import{a as Ui}from"./chunk-TO3HOIOR.js";import{a as It}from"./chunk-DQSLVCJO.js";import{e as Ni}from"./chunk-AXC265QM.js";import{a as wt,b as Oi,c as $i,d as Di,e as Li,f as at,g as ot,h as Gi,i as Fi,j as Ri,k as Bi,l as ji,m as Be,o as Vi,p as ge,r as je,s as Ai,u as Hi,v as lt}from"./chunk-LY5STZD6.js";import{e as Ei}from"./chunk-TMXWSOGF.js";import{b as st}from"./chunk-UPTESATB.js";import{a as Ti}from"./chunk-Y4QYVF5K.js";import{a as Wi}from"./chunk-KV3V2W4Q.js";import{a as ut,c as zi}from"./chunk-3PSL2UAK.js";import{a as Pi,b as Mi}from"./chunk-LZEJSWWW.js";import{a as wi,d as dt}from"./chunk-UN6AN2DI.js";import{a as Ii,d as ki}from"./chunk-CXJU4L5R.js";import{H as Ve,p as xi,y as bi}from"./chunk-W6XALPR5.js";import{a as Fe,c as Si,d as Re}from"./chunk-XBIMNMBY.js";import{o as yi}from"./chunk-A7CCEKNQ.js";import{i as rt,j as be}from"./chunk-2AZMKO7X.js";import{a as nt,b as he}from"./chunk-HLAFRD2O.js";import{a as ti,b as se,h as ci,i as mi,k as ui,l as hi,r as tt,w as _i,x as ue}from"./chunk-QTBTUQ3W.js";import{a as it}from"./chunk-HVJBOTRL.js";import{$ as At,$a as a,$b as ce,Ab as F,Ac as X,Ad as li,B as Ft,Bb as A,Bd as Le,C as Rt,Cb as P,Cd as pi,D as Bt,Db as ne,Eb as Oe,F as oe,Fa as Pe,Fb as G,Ga as _,Gb as Et,H as Z,Ia as Kt,Id as gi,J as Ke,Ja as Yt,Jb as p,Jd as fi,K as jt,Kb as c,Lb as D,Ld as vi,M as Q,Na as T,Nd as Ci,O as Vt,Ob as Xt,P as O,Pd as ae,Qa as h,Qd as I,R as _e,Ra as le,Sb as U,Sd as Ge,Tb as Jt,Va as S,X as de,Xa as Me,Ya as H,Za as N,_ as $,_a as s,a as R,ab as C,b as B,ba as Ht,ca as Nt,cc as K,da as ke,dc as ye,dd as me,ea as E,eb as L,f as te,fa as w,fc as ei,g as z,gb as b,gd as Ze,h as bt,ha as Ut,hb as m,ib as Zt,id as De,jb as Qt,jd as Qe,ka as Wt,kb as pe,kd as ii,l as V,lb as Ne,m as Gt,ma as J,mc as Ye,n as y,nd as ni,o as q,od as ri,pa as zt,pd as Xe,qa as j,qb as Se,qd as si,ra as qt,rb as l,sb as v,sd as ai,ta as Tt,tb as f,td as oi,ub as Ue,w as qe,x as ve,xa as ie,xb as Ee,xc as re,xd as Je,ya as r,yb as we,yc as xe,yd as et,za as x,zb as Ie,zc as $e,zd as di}from"./chunk-S3H6YSFW.js";var Yn=t=>[t,"tests"];function Zn(t,o){if(t&1&&(s(0,"span"),l(1),p(2,"date"),C(3,"wbr"),l(4),p(5,"date"),a()),t&2){let e=m();r(),f("",D(2,2,e.event().dateFrom,"dd.MM.yyyy"),"\u2013"),r(3),v(D(5,5,e.event().dateTo,"dd.MM.yyyy"))}}function Qn(t,o){if(t&1&&(s(0,"a",6)(1,"i",8),l(2,"arrow_right_alt"),a(),s(3,"span",9),l(4),a()()),t&2){let e=m(2);h("routerLink",G(2,Yn,e.event().id)),r(4),v(e.event().evaluationText)}}function Xn(t,o){if(t&1&&(s(0,"a",7)(1,"i",8),l(2,"arrow_right_alt"),a(),s(3,"span",9),l(4),a()()),t&2){let e=m(2);h("href",e.event().evaluationLink,ie),r(4),f("",e.event().evaluationText," ")}}function Jn(t,o){if(t&1&&(s(0,"div",5),T(1,Qn,5,4,"a",6)(2,Xn,5,2,"a",7),a()),t&2){let e=m();r(),S(e.event().evaluationLink?-1:1),r(),S(e.event().evaluationLink?2:-1)}}var qi=(()=>{class t{constructor(){this.event=j.required(),this.withRatings=j(!0),this.link=U(()=>ki(this.event().detailLink))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-list-entry"]],inputs:{event:[1,"event"],withRatings:[1,"withRatings"]},decls:11,vars:9,consts:[[1,"designation"],[3,"routerLink","queryParams"],[1,"date"],[1,"registrations"],[1,"registrations-label"],[1,"rating"],[1,"d-flex",3,"routerLink"],[1,"d-flex",3,"href"],[1,"material-icons"],[1,"ps-1"]],template:function(i,n){i&1&&(s(0,"div",0)(1,"a",1),l(2),a()(),s(3,"div",2),T(4,Zn,6,8,"span"),a(),s(5,"div",3),l(6),s(7,"span",4),l(8),p(9,"translate"),a()(),T(10,Jn,3,2,"div",5)),i&2&&(r(),h("routerLink",n.link().link)("queryParams",n.link().params),r(),v(n.event().designation),r(2),S(n.event().dateFrom&&n.event().dateTo?4:-1),r(2),f(" ",n.event().studentCount," "),r(2),v(c(9,7,n.event().studentCount===1?"events.registration":"events.registrations")),r(2),S(n.withRatings()&&n.event().evaluationText?10:-1))},dependencies:[X,ye,I],styles:['[_nghost-%COMP%]{display:grid;padding:1rem;border-bottom:1px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}.designation[_ngcontent-%COMP%]{grid-area:designation;padding-right:1rem}.date[_ngcontent-%COMP%]{grid-area:date;padding-right:1rem}.registrations[_ngcontent-%COMP%]{grid-area:registrations;padding-right:1rem}.rating[_ngcontent-%COMP%]{grid-area:rating}.rating[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.registrations-label[_ngcontent-%COMP%]{display:none}@media (max-width: 575.98px){.registrations-label[_ngcontent-%COMP%]{display:inline}.designation[_ngcontent-%COMP%], .date[_ngcontent-%COMP%], .registrations[_ngcontent-%COMP%]{padding-right:0}[_nghost-%COMP%]{grid-template-areas:"designation" "date" "registrations" "rating";grid-template-columns:1fr}}']})}}return t})();var er=10300,tr=10260,ir=10250,nr=14030,rr=10350;function ht(t){let{HasEvaluationStarted:o,EvaluationUntil:e,HasTestGrading:i}=t.EvaluationStatusRef;if(o===!0&&(t.StatusId===nr||t.StatusId===rr))return{value:ee.Rating};if(o===!0&&i===!1){if(e)return{value:ee.RatingUntil};if(t.StatusId===er)return{value:ee.IntermediateRating}}return o===!1&&i===!0&&t.StatusId!==tr&&t.StatusId!==ir?{value:ee.Tests}:o===!0&&i===!0?e?{value:ee.Tests,label:ee.RatingUntil}:{value:ee.Tests,label:ee.IntermediateRating}:null}function Ki(t){return t.EvaluationStatusRef.HasEvaluationStarted===!0}function Yi(t){return t.EvaluationStatusRef.HasReviewOfEvaluationStarted===!0&&!!t.FinalGrades?.length}function gt(t){let o=t.Classes?t.Classes.map(e=>e.Number).join(", "):null;return o?t.Designation+", "+o:t.Designation}function Zi(t,o){return t?(o.Leadership??"").split(",").some(e=>e.trim()===t.fullname):!1}function Qi(t,o){let e=new URLSearchParams({returnlink:o});return o.startsWith("/dashboard")?`/dashboard/students/${t}?${e}`:o.startsWith("/events/current")?`/events/current/${t}?${e}`:`/events/${t}/students?${e}`}function Xi(t){let o=t.ParticipatingStudents?.map(e=>({id:e.Id,name:e.FullName,email:e.DisplayEmail??void 0}))??[];return{eventId:t.Id,eventDesignation:t.Designation,studyClasses:(t.Classes??[]).map(e=>e.Designation).sort(),entries:o}}function kt(t,o){return B(R({},t),{entries:t.entries.map(e=>{let i=o.find(d=>d.StudentId===e.id),n=i?[i.CompanyName,i.CompanyNameAddition].filter(Boolean).join(" \u2013 "):void 0;return B(R({},e),{company:n})})})}function Pt(t,o,e,{eventDesignation:i,emailFallback:n}={}){return{eventId:t,eventDesignation:i??e[0]?.EventDesignation??"",studyClasses:[],entries:o.map(d=>{let u=e.find(g=>g.PersonId===d.Id);return{id:d.Id,subscriptionId:u?.Id,name:d.FullName,email:(n?d.DisplayEmail??d.Email:d.DisplayEmail)??void 0,status:u?.Status,registrationDate:u?.RegistrationDate??void 0}})}}function Ji(t,o){return B(R({},t),{entries:t.entries.map(e=>B(R({},e),{studyClass:o.find(i=>i.StudentRef.Id===e.id)?.StudyClassNumber}))})}var ee=function(t){return t.Rating="rating",t.RatingUntil="rating-until",t.IntermediateRating="intermediate-rating",t.Tests="add-tests",t}(ee||{}),He=(()=>{class t{constructor(e,i,n,d,u,g,k,W,fe){this.coursesRestService=e,this.eventsRestService=i,this.studyClassRestService=n,this.subscriptionsRestService=d,this.loadingService=u,this.storageService=g,this.translate=k,this.router=W,this.settings=fe,this.loading$=this.loadingService.loading$,this.searchFields$=new z(["designation"]),this.searchSubject$=new z(""),this.search$=this.searchSubject$.asObservable(),this.roles$=new z(null),this.isClassTeacher$=this.roles$.pipe(y(Ce=>Ti(Ce,"ClassTeacherRole")),Q(1)),this.withStudyCourses$=new z(!1),this.unratedCourses$=this.roles$.pipe(O(this.loadUnratedCourses.bind(this)),Q(1)),this.studyCourses$=this.withStudyCourses$.pipe(O(this.loadStudyCourses.bind(this)),Q(1)),this.formativeAssessments$=this.isClassTeacher$.pipe(O(this.loadFormativeAssessments.bind(this)),Q(1)),this.studyClasses$=this.isClassTeacher$.pipe(O(this.loadStudyClasses.bind(this)),Q(1)),this.events$=this.getEvents().pipe(Q(1)),this.filteredEvents$=q([this.events$,this.searchFields$,this.search$]).pipe(y(Re(ct)))}setSearch(e){this.searchSubject$.next(e)}setRoles(e){this.roles$.next(e)}setWithStudyCourses(e){this.withStudyCourses$.next(e)}setSearchFields(e){this.searchFields$.next(e)}getEntries(e=!1){return this.filteredEvents$.pipe(y(i=>e?i.filter(n=>n.evaluationText):i))}getEvents(){return this.loadingService.load(q([this.unratedCourses$,this.studyCourses$,this.formativeAssessments$,this.studyClasses$]),{stopOnFirstValue:!0}).pipe(y(Re(this.createAndSortEvents.bind(this))))}loadUnratedCourses(e){return this.coursesRestService.getExpandedCourses(e).pipe(y(i=>i.filter(n=>!Yi(n))))}loadStudyCourses(e){if(!e)return V([]);let i=this.storageService.getPayload();return this.eventsRestService.getStudyCourseEvents().pipe(y(n=>n.filter(d=>Zi(i,d))),O(n=>this.subscriptionsRestService.getSubscriptionCountsByEvents(n.map(d=>d.Id)).pipe(y(d=>n.map(u=>B(R({},u),{StudentCount:d[u.Id]??0}))))))}loadFormativeAssessments(e){return e?this.studyClassRestService.getActiveFormativeAssessments():V([])}loadStudyClasses(e){return e?this.studyClassRestService.getActive():V([])}createAndSortEvents(e,i,n,d){let u=d.filter(g=>!n.map(k=>k.Id).includes(g.Id));return[...this.createFromCourses(e),...this.createFromStudyCourses(i),...this.createFromAssessments(n),...this.createFromStudyClasses(u)].sort((g,k)=>g.designation.localeCompare(k.designation))}createFromCourses(e){return e.map(i=>{let n=ht(i);return{id:i.Id,designation:gt(i),detailLink:this.buildStudentsLink(i.Id),studentCount:i.AttendanceRef.StudentCount||0,dateFrom:i.DateFrom,dateTo:i.DateTo,state:n?.value||null,evaluationText:this.getEvaluationText(n,i.EvaluationStatusRef.EvaluationUntil),evaluationLink:n?.value&&n?.value!==ee.Tests?this.buildEvaluationLink(i.Id):null}})}createFromStudyCourses(e){return e.map(i=>({id:i.Id,designation:i.Designation,detailLink:this.buildStudentsLink(i.Id),studentCount:i.StudentCount,state:null}))}createFromAssessments(e){return this.createFromStudyClasses(e).map(n=>B(R({},n),{state:ee.Rating,evaluationText:this.translate.instant("events.state.rating"),evaluationLink:this.buildEvaluationLink(n.id)}))}createFromStudyClasses(e){return e.map(i=>({id:i.Id,designation:i.Number,detailLink:this.buildStudentsLink(i.Id),studentCount:i.StudentCount,state:null}))}getEvaluationText(e,i){let n=e?.label||e?.value;return n?this.translate.instant(`events.state.${n}`)+(n===ee.RatingUntil?` ${i?yi(i,"dd.MM.yyyy"):""}`:""):""}buildStudentsLink(e){return Qi(e,this.router.url)}buildEvaluationLink(e){return(this.settings.eventlist.evaluation??"").replace(":id",String(e))}static{this.\u0275fac=function(i){return new(i||t)($(ge),$(mt),$(Ui),$(je),$(be),$(Ge),$(ae),$($e),$(me))}}static{this.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var or=(t,o)=>o.id,dr=()=>[];function lr(t,o){t&1&&C(0,"bkd-spinner")}function pr(t,o){t&1&&(s(0,"div",7),l(1),p(2,"translate"),a()),t&2&&(r(),f(" ",c(2,1,"events.rating")," "))}function cr(t,o){if(t&1&&C(0,"bkd-events-list-entry",8),t&2){let e=o.$implicit,i=m(3);h("event",e)("withRatings",i.withRatings)}}function mr(t,o){if(t&1&&(s(0,"div",3)(1,"div",4),l(2),p(3,"translate"),a(),s(4,"div",5),l(5),p(6,"translate"),a(),s(7,"div",6),l(8),p(9,"translate"),a(),T(10,pr,3,3,"div",7),a(),H(11,cr,1,2,"bkd-events-list-entry",8,or)),t&2){let e=m(2),i=P(0);r(2),v(c(3,4,"events.designation")),r(3),v(c(6,6,"events.date")),r(3),f(" ",c(9,8,"events.registrations")," "),r(2),S(e.withRatings?10:-1),r(),N(i)}}function ur(t,o){t&1&&(s(0,"p",2),l(1),p(2,"translate"),a()),t&2&&(r(),v(c(2,1,"events.no-events")))}function hr(t,o){if(t&1&&T(0,mr,13,10)(1,ur,3,3,"p",2),t&2){m();let e=P(0);S(e.length>0?0:1)}}var nn=["designation"],gr=[...nn,"evaluationText"],vt=(()=>{class t{constructor(e,i){this.state=e,this.storage=i,this.withStudyCourses=!1,this.withRatings=!0,this.state.setRoles(this.storage.getPayload()?.roles??null)}ngOnChanges(e){e.withStudyCourses&&this.state.setWithStudyCourses(e.withStudyCourses.currentValue),e.withRatings&&this.state.setSearchFields(e.withRatings.currentValue?gr:nn)}static{this.\u0275fac=function(i){return new(i||t)(x(He),x(Ge))}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-list"]],inputs:{withStudyCourses:"withStudyCourses",withRatings:"withRatings"},features:[ke],decls:10,vars:17,consts:[[1,"bkd-container"],[1,"d-flex","search",3,"valueChange","value","placeholder","label","disabled"],[1,"mt-3"],[1,"event-header"],[1,"designation"],[1,"date"],[1,"registrations"],[1,"rating"],[3,"event","withRatings"]],template:function(i,n){if(i&1){let d=L();F(0),p(1,"async"),s(2,"div",0)(3,"bkd-resettable-input",1),p(4,"async"),p(5,"translate"),p(6,"translate"),b("valueChange",function(g){return E(d),w(n.state.setSearch(g))}),a(),T(7,lr,1,0,"bkd-spinner"),p(8,"async"),T(9,hr,2,1),a()}if(i&2){let d,u=A((d=c(1,5,n.state.getEntries(n.withRatings)))!==null&&d!==void 0?d:Oe(16,dr));r(3),h("value",c(4,8,n.state.search$))("placeholder",c(5,10,"events.search-by"))("label",c(6,12,"events.search"))("disabled",!u),r(4),S(c(8,14,n.state.loading$)?7:9)}},dependencies:[pt,he,K,I,qi],styles:['.search[_ngcontent-%COMP%]{max-width:500px}.event-header[_ngcontent-%COMP%]{display:grid;padding:1rem;border-bottom:2px solid #dee2e6;grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}@media (max-width: 575.98px){.event-header[_ngcontent-%COMP%]{display:none}}']})}}return t})();var rn=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-current-list"]],decls:4,vars:5,consts:[[3,"withStudyCourses","withRatings"]],template:function(i,n){i&1&&(s(0,"h1"),l(1),p(2,"translate"),a(),C(3,"bkd-events-list",0)),i&2&&(r(),v(c(2,3,"events.current.title")),r(2),h("withStudyCourses",!0)("withRatings",!1))},dependencies:[vt,I],encapsulation:2,changeDetection:0})}}return t})();var sn=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-current"]],decls:1,vars:0,template:function(i,n){i&1&&C(0,"router-outlet")},dependencies:[xe],encapsulation:2})}}return t})();var an=(()=>{class t{constructor(){this.entry=j.required(),this.multipleStudyClasses=j(!1),this.returnLink=j(null),this.link=U(()=>["student",this.entry().id,"addresses"]),this.linkParams=U(()=>{let e=this.returnLink();return e?{returnparams:new URLSearchParams({returnlink:e}).toString()}:{}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-course-entry"]],inputs:{entry:[1,"entry"],multipleStudyClasses:[1,"multipleStudyClasses"],returnLink:[1,"returnLink"]},decls:7,vars:10,consts:[[1,"avatar","large",3,"studentId","link","linkParams"],[1,"name",3,"title","routerLink","queryParams"],[1,"study-class"],[1,"company",3,"title"]],template:function(i,n){i&1&&(C(0,"bkd-avatar",0),s(1,"a",1),l(2),a(),s(3,"div",2),l(4),a(),s(5,"div",3),l(6),a()),i&2&&(h("studentId",n.entry().id)("link",n.link())("linkParams",n.linkParams()),r(),h("title",n.entry().name)("routerLink",n.link())("queryParams",n.linkParams()),r(),v(n.entry().name),r(2),f(" ",n.multipleStudyClasses()?n.entry().studyClass:"",`
`),r(),h("title",n.entry().company),r(),v(n.entry().company))},dependencies:[X,Ni],styles:['[_nghost-%COMP%]{display:grid;grid-template-columns:min-content 1fr;grid-template-rows:min-content min-content 1fr;grid-template-areas:"avatar name" "avatar study-class" "avatar company";padding:2rem 1rem}.avatar[_ngcontent-%COMP%]{grid-area:avatar;margin-right:1.5rem}.name[_ngcontent-%COMP%]{grid-area:name}.study-class[_ngcontent-%COMP%]{grid-area:study-class;font-size:.875rem}.company[_ngcontent-%COMP%]{grid-area:company;align-content:end;padding-bottom:1.5rem}.name[_ngcontent-%COMP%], .company[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}'],changeDetection:0})}}return t})();var fr=t=>({count:t});function vr(t,o){if(t&1&&(s(0,"div",0),l(1),p(2,"translate"),a()),t&2){m();let e=P(2);r(),f(" ",D(2,1,e===1?"events-students.registration":"events-students.registrations",G(4,fr,e))," ")}}var Ct=(()=>{class t{constructor(){this.title=j.required(),this.count=j(null),this.searchTerm=Pe()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-header"]],inputs:{title:[1,"title"],count:[1,"count"],searchTerm:[1,"searchTerm"]},outputs:{searchTerm:"searchTermChange"},decls:7,vars:10,consts:[[1,"additional-info"],[1,"search",3,"valueChange","value","placeholder","label"]],template:function(i,n){if(i&1){let d=L();s(0,"h1"),l(1),a(),F(2),T(3,vr,3,6,"div",0),s(4,"bkd-resettable-input",1),p(5,"translate"),p(6,"translate"),b("valueChange",function(g){return E(d),w(n.searchTerm.set(g))}),a()}if(i&2){r(),v(n.title()),r();let d=A(n.count());r(),S(d!==null?3:-1),r(),h("value",n.searchTerm())("placeholder",c(5,6,"events-students.search-placeholder"))("label",c(6,8,"events-students.search"))}},dependencies:[I,pt],styles:["h1[_ngcontent-%COMP%]{margin-bottom:0}.search[_ngcontent-%COMP%]{margin-top:1rem;display:flex;max-width:300px}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"],changeDetection:0})}}return t})();var Cr=(t,o)=>o.id;function _r(t,o){t&1&&(s(0,"p"),l(1),p(2,"translate"),a()),t&2&&(r(),v(c(2,1,"events-students.no-entries")))}function Sr(t,o){if(t&1&&C(0,"bkd-events-students-course-entry",2),t&2){let e=o.$implicit,i=m();h("entry",e)("multipleStudyClasses",i.multipleStudyClasses())("returnLink",i.returnLink())}}var on=(()=>{class t{constructor(){this.title=j.required(),this.count=j.required(),this.entries=j.required(),this.multipleStudyClasses=j(!1),this.returnLink=j(null),this.searchTerm=Pe()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-course-list"]],inputs:{title:[1,"title"],count:[1,"count"],entries:[1,"entries"],multipleStudyClasses:[1,"multipleStudyClasses"],returnLink:[1,"returnLink"],searchTerm:[1,"searchTerm"]},outputs:{searchTerm:"searchTermChange"},decls:5,vars:4,consts:[[3,"searchTermChange","title","count","searchTerm"],[1,"list"],[3,"entry","multipleStudyClasses","returnLink"]],template:function(i,n){i&1&&(s(0,"bkd-events-students-header",0),Ie("searchTermChange",function(u){return we(n.searchTerm,u)||(n.searchTerm=u),u}),a(),s(1,"section",1),T(2,_r,3,3,"p"),H(3,Sr,1,3,"bkd-events-students-course-entry",2,Cr),a()),i&2&&(h("title",n.title())("count",n.count()),Ee("searchTerm",n.searchTerm),r(2),S(n.entries().length===0?2:-1),r(),N(n.entries()))},dependencies:[I,Ct,an],styles:["[_nghost-%COMP%]{display:block;overflow:hidden}section.list[_ngcontent-%COMP%]{width:calc(100% + 1px);margin-top:1rem;display:grid;grid-template-columns:repeat(auto-fill,minmax(400px,1fr))}bkd-events-students-course-entry[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;border-right:1px solid #dee2e6}"],changeDetection:0})}}return t})();var dn=(()=>{class t{constructor(){this.entry=j.required(),this.returnLink=j(null),this.link=U(()=>["study-course-student",this.entry().id]),this.linkParams=U(()=>{let e=this.returnLink();return e?{returnparams:new URLSearchParams({returnlink:e}).toString()}:{}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-study-course-entry"]],inputs:{entry:[1,"entry"],returnLink:[1,"returnLink"]},decls:7,vars:8,consts:[[1,"name",3,"routerLink","queryParams"],[1,"status"],[1,"registration-date"]],template:function(i,n){i&1&&(s(0,"a",0),l(1),a(),s(2,"div",1),l(3),a(),s(4,"div",2),l(5),p(6,"date"),a()),i&2&&(h("routerLink",n.link())("queryParams",n.linkParams()),r(),v(n.entry().name),r(2),v(n.entry().status),r(2),f(" ",D(6,5,n.entry().registrationDate,"dd.MM.yyyy"),`
`))},dependencies:[X,ei,ye],styles:['[_nghost-%COMP%]{display:grid;align-items:center;grid-template-areas:"name status registration-date";grid-template-columns:2fr 1fr 1fr;border-bottom:1px solid #dee2e6}.name[_ngcontent-%COMP%], .status[_ngcontent-%COMP%], .registration-date[_ngcontent-%COMP%]{padding:1rem}.name[_ngcontent-%COMP%]{grid-area:name;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.status[_ngcontent-%COMP%]{grid-area:status;padding-left:0}.registration-date[_ngcontent-%COMP%]{grid-area:registration-date}@media (max-width: 750px){[_nghost-%COMP%]{grid-template-areas:"name registration-date" "status registration-date";grid-template-columns:2fr 1fr}.name[_ngcontent-%COMP%]{padding-bottom:0}.status[_ngcontent-%COMP%]{padding-top:0;padding-left:1rem;font-size:.875rem}}'],changeDetection:0})}}return t})();var yr=(t,o)=>o.id;function xr(t,o){if(t&1){let e=L();s(0,"div",2)(1,"div",4),b("click",function(){E(e);let n=m();return w(n.toggleSort.emit("name"))}),l(2),p(3,"translate"),s(4,"span",5),l(5),a()(),s(6,"div",6),b("click",function(){E(e);let n=m();return w(n.toggleSort.emit("registrationDate"))}),l(7),p(8,"translate"),s(9,"span",5),l(10),a()()()}if(t&2){let e=m();r(),h("className",e.primarySortKey),r(),f(" ",c(3,5,"events-students.list.header.name")," "),r(3),v(e.getSortDirectionCharacter("name")),r(2),f(" ",c(8,7,"events-students.list.header.registration-date")," "),r(3),v(e.getSortDirectionCharacter("registrationDate"))}}function br(t,o){t&1&&(s(0,"p"),l(1),p(2,"translate"),a()),t&2&&(r(),v(c(2,1,"events-students.no-entries")))}function Tr(t,o){if(t&1&&C(0,"bkd-events-students-study-course-entry",3),t&2){let e=o.$implicit,i=m();h("entry",e)("returnLink",i.returnLink())}}var ln=(()=>{class t{constructor(){this.title=j.required(),this.count=j.required(),this.entries=j.required(),this.returnLink=j(null),this.sortCriteria=j.required(),this.toggleSort=zt(),this.searchTerm=Pe()}getSortDirectionCharacter(e){return this.sortCriteria().primarySortKey!==e?"":this.sortCriteria().ascending?"\u2191":"\u2193"}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-study-course-list"]],inputs:{title:[1,"title"],count:[1,"count"],entries:[1,"entries"],returnLink:[1,"returnLink"],sortCriteria:[1,"sortCriteria"],searchTerm:[1,"searchTerm"]},outputs:{toggleSort:"toggleSort",searchTerm:"searchTermChange"},features:[ne([])],decls:6,vars:4,consts:[[3,"searchTermChange","title","count","searchTerm"],[1,"list"],[1,"list-header"],[3,"entry","returnLink"],[1,"name",3,"click","className"],[1,"sort-direction"],[1,"registration-date",3,"click"]],template:function(i,n){i&1&&(s(0,"bkd-events-students-header",0),Ie("searchTermChange",function(u){return we(n.searchTerm,u)||(n.searchTerm=u),u}),a(),s(1,"section",1),T(2,xr,11,9,"div",2)(3,br,3,3,"p"),H(4,Tr,1,2,"bkd-events-students-study-course-entry",3,yr),a()),i&2&&(h("title",n.title())("count",n.count()),Ee("searchTerm",n.searchTerm),r(2),S(n.entries().length>0?2:3),r(2),N(n.entries()))},dependencies:[I,Ct,dn],styles:[".list-header[_ngcontent-%COMP%]{cursor:pointer;display:grid;grid-template-columns:3fr 1fr;align-items:center;border-bottom:2px solid #dee2e6}.name[_ngcontent-%COMP%], .registration-date[_ngcontent-%COMP%]{padding:1rem}.name[_ngcontent-%COMP%]{flex:3}.registration-date[_ngcontent-%COMP%]{flex:1}@media (max-width: 750px){.list-header[_ngcontent-%COMP%]{grid-template-columns:2fr 1fr}.name[_ngcontent-%COMP%]{flex:2}.registration-date[_ngcontent-%COMP%]{flex:1;white-space:nowrap}}"],changeDetection:0})}}return t})();function pn(t,o,e){o||Nt(t);let i=o??At(Wt);return e?Ht(i,e):i}function ze(t,o){let e=pn(ze,o?.injector),i;return U(()=>(i||(i=Jt(()=>se(t,B(R({},o),{injector:e})))),i()))}var cn=(()=>{class t extends nt{constructor(e,i){super(e,i,Pi,"ApprenticeshipContracts")}getCompaniesForStudents(e){if(e.length===0)return V([]);let i=new Date,n={"filter.StudentId":`;${e.join(";")}`,"filter.ApprenticeshipDateFrom":`<${i.toISOString()}`,"filter.ApprenticeshipDateTo":`>${i.toISOString()}`,fields:"Id,StudentId,CompanyName,CompanyNameAddition"};return this.http.get(`${this.baseUrl}/`,{params:n}).pipe(O(Ci(Mi)))}static{this.\u0275fac=function(i){return new(i||t)($(Ye),$(me))}}static{this.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var _t=1;var mn=10,St=(()=>{class t{constructor(e,i,n,d,u,g,k,W,fe){this.route=e,this.loadingService=i,this.eventsService=n,this.coursesService=d,this.subscriptionsService=u,this.personsService=g,this.apprenticeshipContractsService=k,this.lessonPresencesService=W,this.reportsService=fe,this.eventId$=q([this.route.paramMap,this.route.parent?.paramMap??V(null)]).pipe(y(([Ce,Kn])=>Number(Ce.get("id")||Kn?.get("id"))),Z()),this.eventSummary$=this.eventId$.pipe(O(this.loadEventSummary.bind(this)),Q(1)),this.eventSummary=ze(this.eventSummary$,{initialValue:null}),this.eventTypeId=U(()=>this.eventSummary()?.EventTypeId??null),this.studentEntries=ze(this.loadStudentEntries(),{initialValue:null}),this.isStudyCourse=U(()=>this.eventTypeId()===_t),this.loading=se(this.loadingService.loading(ut)),this.title=U(()=>this.getTitle(this.studentEntries())),this.multipleStudyClasses=U(()=>(this.studentEntries()?.studyClasses?.length??0)>1),this.searchTerm=Tt(""),this.sortCriteria=Tt({primarySortKey:"name",ascending:!0}),this.entries=U(()=>this.studentEntries()?.entries??[]),this.sortedEntries=U(()=>this.sortStudentEntries(this.entries(),this.sortCriteria())),this.filteredEntries=U(()=>ct(this.sortedEntries(),["name","status","company","studyClass"],this.searchTerm())),this.mailtoLink=U(()=>this.getMailtoLink(this.eventTypeId(),this.entries())),this.reports=ze(this.eventSummary$.pipe(ve(ue)).pipe(O(this.loadReports.bind(this))),{initialValue:[]})}loadEventSummary(e){return this.loadingService.load(this.eventsService.getEventSummary(e),ut)}loadStudentEntries(){return this.eventSummary$.pipe(O(e=>{let i=()=>{if(!e)return V(null);switch(e.EventTypeId){case _t:return this.loadStudyCourseStudents(e);case mn:return this.loadStudyClassStudents(e.Id);default:return this.loadCourseStudents(e.Id)}};return this.loadingService.load(i(),ut)}))}toggleSort(e){this.sortCriteria.set({primarySortKey:e,ascending:this.sortCriteria().primarySortKey===e?!this.sortCriteria().ascending:!0})}loadStudyCourseStudents({Id:e,Designation:i}){return this.subscriptionsService.getSubscriptionsByCourse(e).pipe(O(n=>this.personsService.getSummaries(n.map(({PersonId:d})=>d).filter(ue)).pipe(y(d=>Pt(e,d,n,{eventDesignation:i})))))}loadStudyClassStudents(e){return this.subscriptionsService.getSubscriptionsByCourse(e,{"filter.IsOkay":"=1"}).pipe(O(i=>{let n=i.map(({PersonId:d})=>d).filter(ue);return q([this.personsService.getSummaries(n),this.apprenticeshipContractsService.getCompaniesForStudents(n)]).pipe(y(([d,u])=>{let g=Pt(e,d,i,{emailFallback:!0});return kt(g,u)}))}))}loadCourseStudents(e){return this.coursesService.getExpandedCourseWithParticipants(e).pipe(y(Xi),O(i=>q([this.apprenticeshipContractsService.getCompaniesForStudents(i.entries.map(({id:n})=>n)),this.lessonPresencesService.getLessonStudyClassesByEvent(e)]).pipe(y(([n,d])=>{let u=kt(i,n);return Ji(u,d)}))))}getTitle(e){if(!e||!e.eventDesignation)return null;let{eventDesignation:i,studyClasses:n}=e;return[i,...n].join(", ")}getMailtoLink(e,i){if(e===null||e===_t)return null;let n=i.map(d=>d.email).filter(Boolean);return n.length>0?`mailto:${n.join(";")}`:null}loadReports({Id:e,EventTypeId:i}){switch(i){case null:case _t:return V([]);case mn:return this.reportsService.getStudyClassStudentsReports(e);default:return this.reportsService.getCourseStudentsReports(e)}}sortStudentEntries(e,i){return[...e].sort(Pr(i))}static{this.\u0275fac=function(i){return new(i||t)($(re),$(be),$(mt),$(ge),$(je),$(st),$(cn),$(Ei),$(dt))}}static{this.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Pr(t){return(o,e)=>{switch(t.primarySortKey){case"registrationDate":return Mr(o,e,t);case"name":return Or(t,o,e);default:throw new xi(t.primarySortKey,"Unhandled sort criteria")}}}function Mr(t,o,e){let i=t.registrationDate?new Date(t.registrationDate).getTime():0,n=o.registrationDate?new Date(o.registrationDate).getTime():0;return e.ascending?i-n:n-i}function Or(t,o,e){return t.ascending?o.name.localeCompare(e.name):e.name.localeCompare(o.name)}var Dr=t=>[t];function Lr(t,o){if(t&1&&(s(0,"a",4)(1,"i",6),l(2,"mail"),a()()),t&2){let e=m(2);h("href",e.state.mailtoLink(),ie)}}function Gr(t,o){if(t&1&&(s(0,"bkd-backlink",0)(1,"div",3),T(2,Lr,3,1,"a",4),C(3,"bkd-reports-link",5),a()()),t&2){let e=m(),i=P(0);h("link",G(3,Dr,i)),r(2),S(e.state.mailtoLink()?2:-1),r(),h("reports",e.state.reports())}}function Fr(t,o){t&1&&C(0,"bkd-spinner")}function Rr(t,o){t&1&&(s(0,"p"),l(1),p(2,"translate"),a()),t&2&&(r(),v(c(2,1,"events-students.no-entries")))}function Br(t,o){if(t&1){let e=L();s(0,"bkd-events-students-study-course-list",7),b("toggleSort",function(n){E(e);let d=m();return w(d.state.toggleSort(n))}),Ie("searchTermChange",function(n){E(e);let d=m();return we(d.state.searchTerm,n)||(d.state.searchTerm=n),w(n)}),a()}if(t&2){let e=m();h("title",e.state.title())("count",e.state.entries().length)("entries",e.state.filteredEntries())("returnLink",e.returnLink())("sortCriteria",e.state.sortCriteria()),Ee("searchTerm",e.state.searchTerm)}}function jr(t,o){if(t&1){let e=L();s(0,"bkd-events-students-course-list",8),Ie("searchTermChange",function(n){E(e);let d=m();return we(d.state.searchTerm,n)||(d.state.searchTerm=n),w(n)}),a()}if(t&2){let e=m();h("title",e.state.title())("count",e.state.entries().length)("entries",e.state.filteredEntries())("multipleStudyClasses",e.state.multipleStudyClasses())("returnLink",e.returnLink()),Ee("searchTerm",e.state.searchTerm)}}var un=(()=>{class t{constructor(e,i){this.state=e,this.route=i,this.returnLink=se(this.route.queryParams.pipe(y(({returnlink:n})=>n?decodeURIComponent(n):null)))}static{this.\u0275fac=function(i){return new(i||t)(x(St),x(re))}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-list"]],decls:6,vars:3,consts:[[3,"link"],[3,"title","count","entries","returnLink","sortCriteria","searchTerm"],[3,"title","count","entries","multipleStudyClasses","returnLink","searchTerm"],[1,"d-flex"],["target","_blank",1,"mail","btn","btn-primary","btn-icon","me-2",3,"href"],[1,"ms-2",3,"reports"],[1,"material-icons"],[3,"toggleSort","searchTermChange","title","count","entries","returnLink","sortCriteria","searchTerm"],[3,"searchTermChange","title","count","entries","multipleStudyClasses","returnLink","searchTerm"]],template:function(i,n){if(i&1&&(F(0),T(1,Gr,4,5,"bkd-backlink",0)(2,Fr,1,0,"bkd-spinner")(3,Rr,3,3,"p")(4,Br,1,6,"bkd-events-students-study-course-list",1)(5,jr,1,6,"bkd-events-students-course-list",2)),i&2){let d=A(n.returnLink());r(),S(d?1:-1),r(),S(n.state.loading()?2:n.state.entries().length===0?3:n.state.isStudyCourse()?4:5)}},dependencies:[I,he,Ve,rt,on,ln],encapsulation:2,changeDetection:0})}}return t})();var Vr=(t,o)=>o.id;function Ar(t,o){if(t&1&&(l(0),p(1,"date")),t&2){m(2);let e=P(2);f(" ",D(1,1,e.Birthdate,"dd.MM.yyyy")," ")}}function Hr(t,o){if(t&1&&l(0),t&2){m(2);let e=P(2);f(" (",e.Gender,") ")}}function Nr(t,o){if(t&1&&(l(0),C(1,"br")),t&2){m(2);let e=P(2);f(" ",e.AddressLine1,"")}}function Ur(t,o){if(t&1&&(l(0),C(1,"br")),t&2){m(2);let e=P(2);f(" ",e.AddressLine2,"")}}function Wr(t,o){if(t&1&&(l(0),C(1,"br")),t&2){m(2);let e=P(2);Ue(" ",e.Zip," ",e.Location,"")}}function zr(t,o){if(t&1&&(s(0,"a",4),l(1),a(),C(2,"br")),t&2){m(2);let e=P(2);Ne("href","tel:",e.PhonePrivate,"",ie),r(),v(e.PhonePrivate)}}function qr(t,o){if(t&1&&(s(0,"a",4),l(1),a(),C(2,"br")),t&2){m(2);let e=P(2);Ne("href","tel:",e.PhoneMobile,"",ie),r(),v(e.PhoneMobile)}}function Kr(t,o){if(t&1&&(s(0,"a",4),l(1),a(),C(2,"br")),t&2){m(2);let e=P(2);Ne("href","mailto:",e.Email,"",ie),r(),f(" ",e.Email," ")}}function Yr(t,o){if(t&1&&(s(0,"a",4),l(1),a(),C(2,"br")),t&2){m(2);let e=P(2);Ne("href","mailto:",e.Email2,"",ie),r(),f(" ",e.Email2," ")}}function Zr(t,o){if(t&1&&(s(0,"h1"),l(1),a(),s(2,"span",3),T(3,Ar,2,4)(4,Hr,1,1),a(),s(5,"address"),T(6,Nr,2,1)(7,Ur,2,1)(8,Wr,2,2)(9,zr,3,3)(10,qr,3,3)(11,Kr,3,3)(12,Yr,3,3),a()),t&2){m();let e=P(2);r(),v(e.FullName),r(2),S(e.Birthdate?3:-1),r(),S(e.Gender?4:-1),r(2),S(e.AddressLine1?6:-1),r(),S(e.AddressLine2?7:-1),r(),S(e.Zip&&e.Location?8:-1),r(),S(e.PhonePrivate?9:-1),r(),S(e.PhoneMobile?10:-1),r(),S(e.Email?11:-1),r(),S(e.Email2?12:-1)}}function Qr(t,o){if(t&1&&(s(0,"div",2),l(1),p(2,"translate"),s(3,"span",5),l(4),a()()),t&2){m();let e=P(4);r(),f(" ",c(2,2,"events-students.study-course-detail.status"),": "),r(3),v(e)}}function Xr(t,o){if(t&1&&(s(0,"div",6)(1,"h2"),l(2),a()()),t&2){let e=m().$implicit;r(2),v(e.label)}}function Jr(t,o){if(t&1&&(s(0,"a",7),l(1),a()),t&2){let e=m(2).$implicit;pe("href",e.file,ie),r(),v(e.value)}}function es(t,o){if(t&1&&l(0),t&2){let e=m(2).$implicit;f(" ",e.value," ")}}function ts(t,o){if(t&1&&(s(0,"div",6)(1,"div"),l(2),a(),T(3,Jr,2,2,"a",7)(4,es,1,1),a()),t&2){let e=m().$implicit;r(2),v(e.label),r(),S(e.file!==null?3:4)}}function is(t,o){if(t&1&&T(0,Xr,3,1,"div",6)(1,ts,5,2,"div",6),t&2){let e=o.$implicit;S(e.heading?0:e.value?1:-1)}}function ns(t,o){t&1&&C(0,"bkd-spinner")}var hn=(()=>{class t{constructor(e,i,n,d,u,g){this.settings=e,this.route=i,this.personsService=n,this.subscriptionsService=d,this.storageService=u,this.loadingService=g,this.eventId$=this.route.parent?.paramMap.pipe(y(k=>Number(k.get("id"))))??V(0),this.personId$=this.route.paramMap.pipe(y(k=>Number(k.get("id")))),this.person=se(this.personId$.pipe(O(k=>this.personsService.get(k))),{initialValue:null}),this.subscription=se(this.loadSubscription()),this.subscriptionId=U(()=>this.subscription()?.Id??null),this.subscriptionDetails=se(this.loadSubscriptionDetails(),{initialValue:[]}),this.backLink=se(this.route.queryParams.pipe(y(({returnparams:k})=>k),y(Ii))),this.loading=se(this.loadingService.loading$,{initialValue:!0})}loadSubscription(){return this.loadingService.load(q([this.eventId$,this.personId$]).pipe(O(([e,i])=>this.subscriptionsService.getSubscriptionsByCourse(e,{"filter.PersonId":`=${i}`})),y(e=>e[0]??null)),{stopOnFirstValue:!0})}loadSubscriptionDetails(){return this.loadingService.load(ti(this.subscriptionId).pipe(ve(ue),O(e=>this.subscriptionsService.getSubscriptionDetailsById(e)),y(e=>e.map(i=>this.toSubscriptionDetailsEntry(i)))),{stopOnFirstValue:!0})}toSubscriptionDetailsEntry(e){let i=e.Value??"";return i=this.normalizeSubscriptionDetailsDropdownValue(e,i),{id:e.Id,label:e.VssDesignation,value:i,file:this.buildFileUrl(e),heading:e.VssStyle==="HE"}}normalizeSubscriptionDetailsDropdownValue(e,i){return e.DropdownItems&&e.VssStyle!=="CB"?e.DropdownItems.find(n=>String(n.Key)===i)?.Value??i:i}buildFileUrl(e){if(e.VssStyle==="PD"||e.VssStyle==="PF"||e.VssStyle==="DA"){let i=this.storageService.getAccessToken()||"";return`${this.settings.apiUrl}/Files/SubscriptionDetails/${e.Id}?token=${i}`}return null}static{this.\u0275fac=function(i){return new(i||t)(x(me),x(re),x(st),x(je),x(Ge),x(be))}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-study-course-detail"]],decls:9,vars:6,consts:[[1,"bkd-container","bkd-container-limited"],["link","../..",3,"params"],[1,"status"],[1,"additional-info"],[3,"href"],[1,"ms-2"],[1,"detail"],["target","_blank",3,"href"]],template:function(i,n){if(i&1&&(s(0,"div",0),C(1,"bkd-backlink",1),F(2),T(3,Zr,13,10),F(4),T(5,Qr,5,4,"div",2),H(6,is,2,1,null,null,Vr),T(8,ns,1,0,"bkd-spinner"),a()),i&2){let d;r(),h("params",n.backLink()),r();let u=A(n.person());r(),S(u?3:-1),r();let g=A((d=n.subscription())==null?null:d.Status);r(),S(g?5:-1),r(),N(n.subscriptionDetails()),r(2),S(n.loading()?8:-1)}},dependencies:[I,ye,Ve,he],styles:["h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}address[_ngcontent-%COMP%]{margin:1rem 0}.status[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem 0;border-top:1px solid #dee2e6;border-bottom:1px solid #dee2e6}.detail[_ngcontent-%COMP%]{max-width:70ch;padding-top:1rem}.detail[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.detail[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-weight:400;color:#00000080}"],changeDetection:0})}}return t})();var gn=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students"]],features:[ne([St])],decls:1,vars:0,template:function(i,n){i&1&&C(0,"router-outlet")},dependencies:[xe],encapsulation:2,changeDetection:0})}}return t})();var fn=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-tests"]],decls:4,vars:4,consts:[[3,"withRatings"]],template:function(i,n){i&1&&(s(0,"h1"),l(1),p(2,"translate"),a(),C(3,"bkd-events-list",0)),i&2&&(r(),v(c(2,2,"events.title")),r(2),h("withRatings",!0))},dependencies:[vt,I],encapsulation:2})}}return t})();var vn=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events"]],features:[ne([He,bi])],decls:1,vars:0,template:function(i,n){i&1&&C(0,"router-outlet")},dependencies:[xe],encapsulation:2})}}return t})();function Cn(t){return o=>{let e=Number(o.value);return e<=t?{greaterThan:{value:e,greaterThanValue:t}}:null}}function Ot(t){return t.map(({finalGrade:o})=>o).filter(rs)}function rs(t){return t!==null}function yn(t,o,e,i){return t?.map(n=>({student:n,finalGrade:as(n,e,i),grades:ss(n,o)}))}function ss(t,o){return o.map(e=>{if(e.Results===void 0||e.Results?.length===0)return{kind:"no-result",test:e};let i=e.Results?.find(n=>n.StudentId===t.Id);return i!==void 0?{kind:"grade",result:i,test:e}:{kind:"no-result",test:e}})}function as(t,o,e){let i=o.find(d=>d.StudentId===t.Id);if(i)return{gradingId:i.Id,gradeId:i.GradeId??void 0,average:i.AverageTestResult||void 0,canGrade:i.CanGrade};let n=e.find(d=>d.StudentId===t.Id);if(n)return{finalGradeValue:n.Grade,average:n.AverageTestResult||void 0,canGrade:!1};throw new Error(`Student ${t.FullName} has neither a grading and nor a final grade, this should not happen`)}var xn=({key:t,ascending:o})=>(e,i)=>{let n=o?1:-1;switch(t){case"FullName":return n*e.student.FullName.localeCompare(i.student.FullName);case"FinalGrade":return!e.finalGrade?.gradeId||!i.finalGrade?.gradeId?n*-1:n*_n(e.finalGrade.gradeId,i.finalGrade.gradeId);case"TestsMean":return!e.finalGrade?.average||!i.finalGrade?.average?n*-1:n*_n(e.finalGrade.average,i.finalGrade.average)}return n*os(t,e,i)},os=(t,o,e)=>{let i=o.grades.filter(Sn).find(d=>d.test.Id===t.Id),n=e.grades.filter(Sn).find(d=>d.test.Id===t.Id);return t.IsPointGrading&&i?.result.GradeId===n?.result.GradeId?(i?.result.Points??0)-(n?.result.Points??0):((i?.result.GradeId??Number.POSITIVE_INFINITY)-(n?.result.GradeId??Number.POSITIVE_INFINITY))*-1};function _n(t,o){return t===o?0:t<o?-1:1}function Sn(t){return t.kind==="grade"}function bn(t){return(t?.test?.MaxPointsAdjusted||t?.test?.MaxPoints)??0}function Tn(t){let o=t.map(e=>e.average).filter(e=>e!=null&&e!==0).map(Number);return wt(o)}function En(t,o){return wt(t.map(e=>ds(e,o)).filter(_i))}function ds({gradeId:t,finalGradeValue:o},e){let i;t?i=e.find(u=>u.Key===t)?.Value:i=o;let n=Number(i);return isNaN(n)?0:n}function $t(t,o){return[...o.filter(e=>e.Id!==t?.Id),t].filter(e=>e!=null)}function wn({id:t,selectedGradeId:o},e){return e.map(i=>i.Id!==t?i:B(R({},i),{GradeId:o}))}function In(t,o){switch(o.type){case"reset":return o.payload;case"updateResult":return t?B(R({},t),{Tests:$i(o.payload.testResult,t.Tests||[],o.payload.ignore),Gradings:o.payload.grading?$t(o.payload.grading,t.Gradings||[]):t.Gradings}):null;case"deleteResult":return t?B(R({},t),{Tests:Di(o.payload.testId,o.payload.studentId,t.Tests||[]),Gradings:o.payload.grading?$t(o.payload.grading,t.Gradings||[]):t.Gradings||[]}):null;case"toggle-test-state":return t?B(R({},t),{Tests:Li(o.payload,t.Tests||[])}):null;case"final-grade-overwritten":return t?B(R({},t),{Gradings:wn({id:o.payload.id,selectedGradeId:o.payload.selectedGradeId},t.Gradings||[])}):null;case"replace-grades":return t?B(R({},t),{Gradings:o.payload}):null;case"delete-test":return t?B(R({},t),{Tests:Gi(o.payload,t.Tests||[])}):null;default:return t}}var kn=(()=>{class t extends nt{constructor(e,i){super(e,i,Vi,"Gradings")}updateGrade(e,i){return this.http.put(`${this.baseUrl}/${e}`,{GradeId:i}).pipe(y(()=>e))}static{this.\u0275fac=function(i){return new(i||t)($(Ye),$(me))}}static{this.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Dt={onlyMine:!1,hidePublished:!1},Y=(()=>{class t{constructor(e,i,n,d,u){this.coursesRestService=e,this.gradingScalesRestService=i,this.gradingsRestService=n,this.loadingService=d,this.sortService=u,this.action$=new bt(1),this.loading$=this.loadingService.loading$,this._courseId$=new bt(1),this.courseId$=this._courseId$.asObservable(),this.fetchedCourse$=this._courseId$.pipe(O(g=>this.loadingService.load(this.coursesRestService.getExpandedCourse(g))),Q(1)),this.course$=qe(this.action$,this.fetchedCourse$.pipe(ve(ue),y(g=>({type:"reset",payload:g})))).pipe(jt(In,null),ve(ue),Q(1)),this.tests$=this.course$.pipe(y(g=>g.Tests||[]),y(Fi)),this.hasTests$=this.tests$.pipe(y(g=>g.length>0)),this.filterSubject$=new z(Dt),this.filter$=this.filterSubject$.asObservable(),this.expandedHeaderSubject$=new z(!1),this.expandedHeader$=this.expandedHeaderSubject$.asObservable(),this.filteredTests$=q([this.tests$,this.filter$]).pipe(y(([g,k])=>g.filter(W=>(!k.onlyMine||W.IsOwner)&&(!k.hidePublished||!W.IsPublished)))),this.sorting$=this.sortService.sorting$,this.studentGrades$=q([this.course$,this.filteredTests$,this.sorting$]).pipe(y(Re(this.toStudentGrades.bind(this)))),this.canSetFinalGrade$=this.course$.pipe(y(Ki)),this.gradingScaleIds$=this.course$.pipe(y(g=>fi([...(g.Tests??[]).map(k=>k.GradingScaleId),g.GradingScaleId]).filter(ue)),Z(gi),Q(1)),this.gradingScales$=this.gradingScaleIds$.pipe(O(g=>this.gradingScalesRestService.getGradingScales(g)),Q(1)),this.UNDEFINED_GRADINGSCALE_ID=-1,this.gradingScalesOptions$=this.gradingScales$.pipe(y(g=>g.map(k=>{let W=k?.Id||this.UNDEFINED_GRADINGSCALE_ID,fe=k?.Grades.map(Ce=>({Key:Ce.Id,Value:Ce.Designation}))||[];return{id:W,options:fe}}).reduce((k,W)=>B(R({},k),{[W.id]:W.options}),{})),Q(1)),this.meanOfStudentGradesForCourse$=this.studentGrades$.pipe(y(g=>Tn(Ot(g)))),this.meanOfFinalGradesForCourse$=q([this.gradingScalesOptions$,this.studentGrades$]).pipe(O(Re(this.meanOfOverwrittenGradesForCourse.bind(this))))}setCourseId(e){this._courseId$.next(e)}setFilter(e){this.filterSubject$.next(e)}gradingOptionsForTest$(e){return this.gradingOptions$(e.GradingScaleId)}gradingOptionsForCourse$(){return this.course$.pipe(O(e=>this.gradingOptions$(e.GradingScaleId)))}toStudentGrades(e,i=[],n){return yn(e.ParticipatingStudents??[],i,e.Gradings??[],e.FinalGrades??[]).sort(xn(n))}setSorting(e){this.sortService.setSorting(e)}getSortingChar$(e){return this.sortService.getSortingChar$(e)}sortBy(e){this.sortService.toggleSorting(e)}toggleHeader(e){this.expandedHeaderSubject$.next(e)}optimisticallyUpdateGrade(e){return this.course$.pipe(oe(1),y(i=>{let{originalResult:n,updatedResult:d}=this.buildOptimisticResultUpdate(i,e);return this.updateTestResult(d,null),n}))}saveGrade(e,i){this.course$.pipe(oe(1),O(n=>this.coursesRestService.updateTestResult(n.Id,e).pipe(Ft(d=>(i&&this.updateTestResult(R({},i),null),Gt(()=>d)))))).subscribe(({testResult:n,grading:d})=>this.updateOrDeleteTestResult(e.testId,e.studentId,n,d,"gradeId"in e?"grade":"points"))}publish(e){this.coursesRestService.publishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}unpublish(e){this.coursesRestService.unpublishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}deleteTest(e){this.action$.next({type:"delete-test",payload:e})}overwriteFinalGrade({id:e,selectedGradeId:i}){this.gradingsRestService.updateGrade(e,i).subscribe(()=>{this.action$.next({type:"final-grade-overwritten",payload:{id:e,selectedGradeId:i}})})}setAveragesAsFinalGrades(e){this.coursesRestService.setAverageAsFinalGrade(e).subscribe(i=>this.action$.next({type:"replace-grades",payload:i.Gradings}))}buildOptimisticResultUpdate(e,i){let n=Oi(e,i.testId,i.studentId),d=n?R({},n):{Id:"",TestId:i.testId,StudentId:i.studentId,CourseRegistrationId:0,GradeId:null,GradeValue:null,GradeDesignation:null,Points:null};return d.GradeId="gradeId"in i?i.gradeId:n?.GradeId??null,d.Points="points"in i?i.points:n?.Points??null,{originalResult:n,updatedResult:d}}updateOrDeleteTestResult(e,i,n,d,u){n?this.updateTestResult(n,d,u):this.deleteTestResult(e,i,d)}updateTestResult(e,i,n){this.action$.next({type:"updateResult",payload:{testResult:e,grading:i??null,ignore:n}})}deleteTestResult(e,i,n){this.action$.next({type:"deleteResult",payload:{testId:e,studentId:i,grading:n}})}toggleTestPublishedState(e){this.action$.next({type:"toggle-test-state",payload:e})}gradingOptions$(e){return e===null?V(null):this.gradingScalesOptions$.pipe(y(i=>i[e]),Q(1))}meanOfOverwrittenGradesForCourse(e,i){return this.course$.pipe(y(n=>{if(n.GradingScaleId===null||e[n.GradingScaleId]===void 0)return null;let d=e[n.GradingScaleId];return En(Ot(i),d)}))}static{this.\u0275fac=function(i){return new(i||t)($(ge),$(Ai),$(kn),$(be),$(zi))}}static{this.\u0275prov=de({token:t,factory:t.\u0275fac})}}return t})();var cs=t=>["/events",t,"tests"];function ms(t,o){if(t&1&&(s(0,"div",7),l(1),p(2,"translate"),a()),t&2){let e=o.$implicit;r(),f(" ",D(2,1,"global.validation-errors."+e.error,e.params)," ")}}function us(t,o){if(t&1&&(s(0,"div",7),l(1),p(2,"translate"),a()),t&2){let e=o.$implicit;r(),f(" ",D(2,1,"global.validation-errors."+e.error,e.params)," ")}}function hs(t,o){if(t&1&&(s(0,"div",7),l(1),p(2,"translate"),a()),t&2){let e=o.$implicit;r(),f(" ",D(2,1,"global.validation-errors."+e.error,e.params)," ")}}function gs(t,o){if(t&1&&(s(0,"div",7),l(1),p(2,"translate"),a()),t&2){let e=o.$implicit;r(),f(" ",D(2,1,"global.validation-errors."+e.error,e.params)," ")}}function fs(t,o){if(t&1&&(s(0,"div",7),l(1),p(2,"translate"),a()),t&2){let e=o.$implicit;r(),f(" ",D(2,1,"global.validation-errors."+e.error,e.params)," ")}}function vs(t,o){if(t&1&&(s(0,"div",29)(1,"div",30)(2,"div",16)(3,"label",31),l(4),p(5,"translate"),a(),s(6,"div",32),C(7,"input",33),p(8,"async"),H(9,gs,3,4,"div",7,Me),p(11,"async"),a()()(),s(12,"div",30)(13,"div",16)(14,"label",34),l(15),p(16,"translate"),a(),s(17,"div",32),C(18,"input",35),p(19,"async"),H(20,fs,3,4,"div",7,Me),p(22,"async"),a()()()(),s(23,"div",36),Ut(),s(24,"math")(25,"mi"),l(26),p(27,"translate"),a(),s(28,"mo"),l(29,"="),a(),s(30,"mfrac")(31,"mrow")(32,"mi"),l(33),p(34,"translate"),a(),s(35,"mo"),l(36,"\xD7"),a(),s(37,"mn"),l(38,"5"),a()(),s(39,"mi"),l(40),p(41,"translate"),a()(),s(42,"mo"),l(43,"+"),a(),s(44,"mn"),l(45,"1"),a()()()),t&2){let e,i,n=m(2);r(4),v(c(5,9,"tests.form.max-points")),r(3),le("is-invalid",((e=c(8,11,n.maxPointsErrors$))==null?null:e.length)||!1),r(2),N(c(11,13,n.maxPointsErrors$)),r(6),v(c(16,15,"tests.form.max-points-adjusted")),r(3),le("is-invalid",((i=c(19,17,n.maxPointsAdjustedErrors$))==null?null:i.length)||!1),r(2),N(c(22,19,n.maxPointsAdjustedErrors$)),r(6),f(" ",c(27,21,"tests.form.math.grade")," "),r(7),f(" ",c(34,23,"tests.form.math.points")," "),r(7),v(c(41,25,"tests.form.math.max-points"))}}function Cs(t,o){t&1&&(s(0,"div",28)(1,"span",37),l(2,"Loading..."),a()())}function _s(t,o){if(t&1){let e=L();s(0,"form",2),b("ngSubmit",function(){E(e);let n=m();return w(n.onSubmit())}),s(1,"div",3)(2,"div",4)(3,"label",5),l(4),p(5,"translate"),a(),C(6,"input",6),p(7,"async"),p(8,"translate"),H(9,ms,3,4,"div",7,Me),p(11,"async"),a(),s(12,"div",8)(13,"label",9),l(14),p(15,"translate"),a(),s(16,"div",10)(17,"span",11)(18,"i",12),l(19,"calendar_today"),a()(),s(20,"input",13,0),p(22,"async"),p(23,"translate"),b("click",function(){E(e);let n=Se(21);return w(n.toggle())}),a(),H(24,us,3,4,"div",7,Me),p(26,"async"),a()()(),s(27,"div",14)(28,"label",15),l(29),p(30,"translate"),a(),s(31,"div",4)(32,"div",16)(33,"label",17),l(34),p(35,"translate"),a(),s(36,"div",18),C(37,"input",19),p(38,"async"),H(39,hs,3,4,"div",7,Me),p(41,"async"),a()()()(),s(42,"div")(43,"label",15),l(44),p(45,"translate"),a(),s(46,"div",20),C(47,"input",21),s(48,"label",22),l(49),p(50,"translate"),a()(),s(51,"div",20),C(52,"input",23),s(53,"label",24),l(54),p(55,"translate"),a()(),T(56,vs,46,27),a(),s(57,"div",25)(58,"button",26),p(59,"async"),l(60),p(61,"translate"),a(),s(62,"button",27),l(63),p(64,"translate"),T(65,Cs,3,0,"div",28),a()()()}if(t&2){let e,i,n,d,u=m();h("formGroup",u.formGroup),r(4),v(c(5,26,"tests.form.designation")),r(2),le("is-invalid",((e=c(7,28,u.designationErrors$))==null?null:e.length)||!1),h("placeholder",c(8,30,"tests.form.designation-placeholder")),r(3),N(c(11,32,u.designationErrors$)),r(5),v(c(15,34,"tests.form.date")),r(3),h("id",u.componentId),r(3),le("is-invalid",((i=c(22,36,u.dateErrors$))==null?null:i.length)||!1),h("placeholder",c(23,38,"shared.date-select.default-placeholder")),r(4),N(c(26,40,u.dateErrors$)),r(5),v(c(30,42,"tests.form.weight")),r(5),v(c(35,44,"tests.form.factor")),r(3),le("is-invalid",((n=c(38,46,u.weightErrors$))==null?null:n.length)||!1),r(2),N(c(41,48,u.weightErrors$)),r(5),v(c(45,50,"tests.form.grading-type")),r(3),h("value",!1),r(2),v(c(50,52,"tests.form.grades")),r(3),h("value",!0),r(2),v(c(55,54,"tests.form.points")),r(2),S((d=u.formGroup.get("isPointGrading"))!=null&&d.value?56:-1),r(2),h("disabled",u.saving)("routerLink",G(62,cs,c(59,56,u.courseId$))),r(2),f(" ",c(61,58,"tests.form.cancel")," "),r(2),h("disabled",u.saving),r(),f(" ",c(64,60,"tests.form.save")," "),r(2),S(u.saving?65:-1)}}var yt=(()=>{class t{constructor(e,i,n){this.fb=e,this.translate=i,this.testStateService=n,this.test=null,this.saving=!1,this.save=new J,this.componentId=vi("bkd-tests-edit-form"),this.formGroup=this.createFormGroup(),this.submitted$=new z(!1),this.destroy$=new te,this.designationErrors$=Fe(V(this.formGroup),this.submitted$,"designation"),this.dateErrors$=Fe(V(this.formGroup),this.submitted$,"date"),this.maxPointsErrors$=Fe(V(this.formGroup),this.submitted$,"maxPoints"),this.maxPointsAdjustedErrors$=Fe(V(this.formGroup),this.submitted$,"maxPointsAdjusted"),this.weightErrors$=Fe(V(this.formGroup),this.submitted$,"weight"),this.courseId$=this.testStateService.courseId$}ngOnInit(){this.test&&this.setInitialValues(this.test),Si(V(this.formGroup),"isPointGrading").pipe(_e(this.destroy$)).subscribe(this.togglePointFieldsDisability.bind(this))}ngOnDestroy(){this.destroy$.next()}onSubmit(){this.submitted$.next(!0),this.formGroup.valid&&this.save.emit(this.formGroup.value)}createFormGroup(){return this.fb.group({designation:["",De.required],date:[null,De.required],weight:[1,De.compose([De.required,Cn(0)])],isPointGrading:[!1],maxPoints:[{value:null,disabled:!0},De.required],maxPointsAdjusted:[{value:null,disabled:!0},null]})}setInitialValues(e){this.formGroup.patchValue({designation:e.Designation,date:e.Date,weight:e.Weight,isPointGrading:e.IsPointGrading,maxPoints:e.MaxPoints,maxPointsAdjusted:e.MaxPointsAdjusted}),e.Results&&e.Results.length>0&&(this.formGroup.get("isPointGrading")?.disable(),this.formGroup.get("maxPoints")?.disable(),this.formGroup.get("maxPointsAdjusted")?.disable()),this.togglePointFieldsDisability()}togglePointFieldsDisability(){let e=this.formGroup.get("maxPoints"),i=this.formGroup.get("maxPointsAdjusted");this.formGroup.get("isPointGrading")?.value?(e?.enable(),i?.enable()):(e?.reset({value:this.test?.MaxPoints,disabled:!0}),i?.reset({value:this.test?.MaxPointsAdjusted,disabled:!0}))}static{this.\u0275fac=function(i){return new(i||t)(x(li),x(ae),x(Y))}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-edit-form"]],inputs:{test:"test",saving:"saving"},outputs:{save:"save"},features:[ne([{provide:ci,useClass:hi},{provide:mi,useClass:Wi}])],decls:1,vars:1,consts:[["dp","ngbDatepicker"],[3,"formGroup"],[3,"ngSubmit","formGroup"],[1,"row","g-3","mb-3"],[1,"col-md-6"],["for","designation",1,"form-label"],["id","designation","name","designation","type","text","formControlName","designation","required","",1,"form-control",3,"placeholder"],[1,"invalid-feedback"],[1,"col-md-6","mb-3"],["for","date",1,"form-label"],[1,"input-group"],[1,"input-group-text",3,"id"],[1,"material-icons"],["id","date","name","date","type","text","ngbDatepicker","","formControlName","date","required","",1,"form-control",3,"click","placeholder"],[1,"row","mb-3"],[1,"form-label"],[1,"row"],["for","factor",1,"form-label","col-3","col-sm-2"],[1,"col-9","col-sm-10"],["id","factor","name","factor","type","number","formControlName","weight","step","0.05","min","0","required","",1,"form-control"],[1,"form-check"],["type","radio","formControlName","isPointGrading","id","type-grades",1,"form-check-input",3,"value"],["for","type-grades",1,"form-check-label"],["type","radio","formControlName","isPointGrading","id","type-points",1,"form-check-input",3,"value"],["for","type-points",1,"form-check-label"],[1,"d-flex","justify-content-end","mt-4"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","routerLink"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"row","ms-4","mb-3","g-3"],[1,"col-sm-6","col-md-4"],["for","max-points",1,"ms-2","col-4","col-form-label"],[1,"col-6"],["type","number","name","maxPoints","id","max-points","formControlName","maxPoints","step","0.01","min","0","max","999","required","",1,"form-control"],["for","max-points-adjusted",1,"ms-2","col-4","col-form-label"],["type","number","name","maxPointsAdjusted","id","max-points-adjusted","formControlName","maxPointsAdjusted","step","0.01","min","0","max","999",1,"form-control"],[1,"ms-4","ps-3","py-3"],[1,"visually-hidden"]],template:function(i,n){i&1&&T(0,_s,66,64,"form",1),i&2&&S(n.formGroup?0:-1)},dependencies:[Le,ri,Ze,Xe,si,Qe,ii,di,et,Je,pi,ai,oi,ui,X,K,I],styles:["#factor[_ngcontent-%COMP%], #max-points[_ngcontent-%COMP%], #max-points-adjusted[_ngcontent-%COMP%]{width:5em}"]})}}return t})();var Pn=(()=>{class t{constructor(e,i,n,d,u){this.route=e,this.courseService=i,this.toastService=n,this.translate=d,this.router=u,this.saving$=new z(!1),this.courseId$=this.route.paramMap.pipe(y(g=>Number(g.get("id"))),Z())}save(e){this.saving$.next(!0);let{designation:i,date:n,weight:d,isPointGrading:u,maxPoints:g,maxPointsAdjusted:k}=e;this.courseId$.pipe(O(W=>this.courseService.add(W,n,i,d,u,g,k)),Ke(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}navigateBack(){this.courseId$.subscribe(e=>void this.router.navigate(["events",e,"tests"]))}static{this.\u0275fac=function(i){return new(i||t)(x(re),x(ge),x(it),x(ae),x($e))}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-add"]],decls:6,vars:6,consts:[[1,"bkd-container","bkd-container-limited"],[3,"save","saving"]],template:function(i,n){i&1&&(s(0,"h1"),l(1),p(2,"translate"),a(),s(3,"div",0)(4,"bkd-tests-edit-form",1),p(5,"async"),b("save",function(u){return n.save(u)}),a()()),i&2&&(r(),v(c(2,2,"tests.add-title")),r(3),h("saving",c(5,4,n.saving$)))},dependencies:[yt,K,I],encapsulation:2})}}return t})();var Mn=(()=>{class t{constructor(e){this.activeModal=e}get canDeleteTest(){return(this.test?.Results?.filter(i=>i.GradeId!==null||i.GradeValue!==null||i.Points!==null)||[]).length===0}static{this.\u0275fac=function(i){return new(i||t)(x(tt))}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-delete"]],inputs:{test:"test"},decls:13,vars:10,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click","hidden"],[1,"px-2"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"],[1,"px-3"]],template:function(i,n){i&1&&(s(0,"div",0)(1,"p",1),l(2),p(3,"translate"),a()(),s(4,"div",2)(5,"button",3),b("click",function(){return n.activeModal.dismiss()}),s(6,"span",4),l(7),p(8,"translate"),a()(),s(9,"button",5),b("click",function(){return n.activeModal.close(n.canDeleteTest?n.test:null)}),s(10,"span",6),l(11),p(12,"translate"),a()()()),i&2&&(r(2),f(" ",c(3,4,n.canDeleteTest?"tests.form.confirm":"tests.form.delete-not-allowed")," "),r(3),h("hidden",!n.canDeleteTest),r(2),f(" ",c(8,6,"tests.dialog.no")," "),r(4),f(" ",c(12,8,n.canDeleteTest?"tests.dialog.yes":"tests.dialog.ok")," "))},dependencies:[I],encapsulation:2})}}return t})();var bs=t=>({test:t});function Ts(t,o){t&1&&C(0,"bkd-spinner")}function Es(t,o){if(t&1){let e=L();s(0,"div",1)(1,"h1"),l(2),p(3,"translate"),a(),s(4,"button",2),b("click",function(){E(e);let n=m(),d=P(0);return w(n.openDeleteModal(d))}),s(5,"i",3),l(6,"delete"),a()()(),s(7,"bkd-tests-edit-form",4),b("save",function(n){E(e);let d=m();return w(d.save(n))}),a()}if(t&2){m();let e=P(0),i=P(2);r(2),f(" ",D(3,3,"tests.edit-title",G(6,bs,e.Designation))," "),r(5),h("test",e)("saving",i)}}var On=(()=>{class t{constructor(e,i,n,d,u,g,k){this.state=e,this.courseService=i,this.route=n,this.toastService=d,this.translate=u,this.router=g,this.modalService=k,this.saving$=new z(!1),this.testId$=this.route.paramMap.pipe(y(W=>Number(W.get("testId"))),Z()),this.test$=q([this.state.tests$,this.testId$]).pipe(y(([W,fe])=>W.find(Ce=>Ce.Id===fe)))}openDeleteModal(e){let i=this.modalService.open(Mn);i.componentInstance.test=e,i.result.then(n=>{n&&this.courseService.delete(e.CourseId,e.Id).subscribe(this.onDeleteSuccess.bind(this))},()=>{})}save(e){this.saving$.next(!0);let{designation:i,date:n,weight:d,isPointGrading:u,maxPoints:g,maxPointsAdjusted:k}=e;q([this.state.courseId$,this.testId$]).pipe(oe(1),O(([W,fe])=>this.courseService.update(W,fe,i,n,d,u,g,k)),Ke(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}onDeleteSuccess(e){this.toastService.success(this.translate.instant("tests.form.delete-success")),this.state.deleteTest(e),this.navigateBack()}navigateBack(){this.state.courseId$.pipe(oe(1)).subscribe(e=>void this.router.navigate(["events",e,"tests"]))}static{this.\u0275fac=function(i){return new(i||t)(x(Y),x(ge),x(re),x(it),x(ae),x($e),x(lt))}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-edit"]],decls:8,vars:9,consts:[[1,"bkd-container","bkd-container-limited"],[1,"d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-primary","btn-icon",3,"click"],[1,"material-icons"],[3,"save","test","saving"]],template:function(i,n){if(i&1&&(F(0),p(1,"async"),F(2),p(3,"async"),s(4,"div",0),T(5,Ts,1,0,"bkd-spinner"),p(6,"async"),T(7,Es,8,8),a()),i&2){let d=A(c(1,1,n.test$));r(2),A(c(3,4,n.saving$)),r(3),S(c(6,7,n.state.loading$)?5:d?7:-1)}},dependencies:[yt,he,K,I],encapsulation:2})}}return t})();var ws=t=>({designation:t}),$n=(()=>{class t{constructor(e){this.activeModal=e}static{this.\u0275fac=function(i){return new(i||t)(x(tt))}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-publish-test"]],inputs:{test:"test"},decls:11,vars:12,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"]],template:function(i,n){i&1&&(s(0,"div",0)(1,"p",1),l(2),p(3,"translate"),a()(),s(4,"div",2)(5,"button",3),b("click",function(){return n.activeModal.dismiss()}),l(6),p(7,"translate"),a(),s(8,"button",4),b("click",function(){return n.activeModal.close(!0)}),l(9),p(10,"translate"),a()()),i&2&&(r(2),f(" ",D(3,3,n.test.IsPublished?"tests.publishing.unpublish":"tests.publishing.publish",G(10,ws,n.test.Designation))," "),r(4),f(" ",c(7,6,"tests.publishing.cancel")," "),r(3),f(" ",c(10,8,"tests.publishing.confirm")," "))},dependencies:[I],encapsulation:2})}}return t})();var Is=t=>({maxPoints:t});function ks(t,o){if(t&1&&(s(0,"div",6),l(1),p(2,"translate"),a()),t&2){let e=m(2);r(),f(" ",D(2,1,"global.validation-errors.invalidPoints",G(4,Is,e.maxPoints))," ")}}function Ps(t,o){if(t&1){let e=L();s(0,"div",3)(1,"input",5,0),b("ngModelChange",function(){E(e);let n=Se(2),d=m();return w(d.onPointsChange(n.value))}),a(),T(3,ks,3,6,"div",6),a()}if(t&2){let e=Se(2),i=m();r(),le("is-invalid",e.errors),pe("max",i.maxPoints),pe("tabindex",i.tabIndex),h("disabled",i.grade.test.IsPublished||i.hasFinalGrade)("ngModel",i.grade.kind==="grade"?i.grade.result.Points:null),r(2),S(e.errors?3:-1)}}var Ms=1250,Dn=(()=>{class t{constructor(e){this.state=e,this.hasFinalGrade=!1,this.maxPoints=0,this.pointsSubject$=new te,this.gradeSubject$=new te,this.gradingScaleDisabledSubject$=new z(!0),this.gradingScaleDisabled$=this.gradingScaleDisabledSubject$.asObservable(),this.destroy$=new te}ngOnInit(){this.gradingScaleDisabledSubject$.next(this.isGradingScaleDisabled()),this.maxPoints=bn(this.grade),this.initSave(this.pointsSubject$.pipe(ve(this.isValid.bind(this)),y(e=>({studentId:this.student.Id,testId:this.grade.test.Id,points:e?Number(e):null})))),this.initSave(this.gradeSubject$.pipe(y(e=>({studentId:this.student.Id,testId:this.grade.test.Id,gradeId:e}))))}ngOnChanges(){this.gradingScaleDisabledSubject$.next(this.isGradingScaleDisabled())}ngOnDestroy(){this.destroy$.next()}onPointsChange(e){this.pointsSubject$.next(e),this.gradingScaleDisabledSubject$.next(!(e===null||e===""))}onGradeChange(e){this.gradeSubject$.next(e)}isValid(e){return e===""||e===null?!0:isNaN(Number(e))?!1:!(Number(e)<0||Number(e)>this.maxPoints)}initSave(e){e.pipe(Rt(i=>this.state.optimisticallyUpdateGrade(i).pipe(y(n=>({params:i,originalResult:n})))),Bt(Ms),_e(this.destroy$)).subscribe(({params:i,originalResult:n})=>this.state.saveGrade(i,n))}isGradingScaleDisabled(){return this.grade.test.IsPublished||this.hasFinalGrade||this.grade.test.IsPointGrading&&this.grade.kind==="grade"&&this.grade.result.Points!=null}static{this.\u0275fac=function(i){return new(i||t)(x(Y))}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-grade"]],inputs:{grade:"grade",student:"student",tabIndex:"tabIndex",gradeOptions:"gradeOptions",hasFinalGrade:"hasFinalGrade"},features:[ke],decls:5,vars:8,consts:[["points","ngModel"],[1,"d-flex","flex-column","w-100"],[1,"d-flex","flex-row"],[1,"point-input-container","me-2","me-md-3"],["data-testid","grade-select",1,"grade-select",3,"valueChange","options","allowEmpty","value","disabled","tabindex"],["type","number","step","0.01","min","0","data-testid","point-input",1,"form-control",3,"ngModelChange","max","disabled","tabindex","ngModel"],["data-testid","validation-error-message",1,"invalid-feedback"]],template:function(i,n){i&1&&(s(0,"div",1)(1,"div",2),T(2,Ps,4,7,"div",3),s(3,"bkd-select",4),p(4,"async"),b("valueChange",function(u){return n.onGradeChange(u)}),a()()()),i&2&&(r(2),S(n.grade.test.IsPointGrading?2:-1),r(),h("options",n.gradeOptions)("allowEmpty",!0)("value",n.grade.kind==="grade"?n.grade.result.GradeId:null)("disabled",c(4,6,n.gradingScaleDisabled$))("tabindex",n.tabIndex))},dependencies:[Le,Ze,Xe,Qe,et,Je,ni,Be,K,I],styles:[".point-input-container[_ngcontent-%COMP%]{width:4em}[_nghost-%COMP%]     select{width:127px}@media (min-width: 576px){.point-input-container[_ngcontent-%COMP%]{width:5em}}"]})}}return t})();function Os(t,o){if(t&1&&(s(0,"span",1),l(1),a()),t&2){let e=m();r(),v(e.calculatePointsAverage(e.test))}}var Ln=(()=>{class t{constructor(e){this.locale=e}calculatePointsAverage(e){return this.safeAverage(e,2,at)}calculateGradeAverage(e){return this.safeAverage(e,3,ot)}safeAverage(e,i,n){try{return ji(n(e),this.locale,i)}catch{return Ri}}static{this.\u0275fac=function(i){return new(i||t)(x(Xt))}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-average-grades"]],inputs:{test:"test"},decls:4,vars:2,consts:[[1,"d-flex","flex-row","w-100"],["data-testid","average-points",1,"mr-2","mr-md-3","average-points"],["data-testid","average-grade"]],template:function(i,n){i&1&&(s(0,"div",0),T(1,Os,2,1,"span",1),s(2,"span",2),l(3),a()()),i&2&&(r(),S(n.test.IsPointGrading?1:-1),r(2),v(n.calculateGradeAverage(n.test)))},styles:[".average-points[_ngcontent-%COMP%]{min-width:4.5em}@media (min-width: 576px){.average-points[_ngcontent-%COMP%]{min-width:6em}}"]})}}return t})();var Gn=(()=>{class t{constructor(){this.disabled=!1,this.width="127px",this.gradeIdSelected=new J}onGradeChange(e){this.gradeId?.valueOf()!==void 0&&this.gradeIdSelected.emit({id:this.gradeId?.valueOf(),selectedGradeId:e})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-grade-select"]],inputs:{options:"options",valueId:"valueId",gradeId:"gradeId",disabled:"disabled",width:"width"},outputs:{gradeIdSelected:"gradeIdSelected"},decls:1,vars:5,consts:[["data-testid","grade-select",3,"valueChange","options","allowEmpty","value","disabled","width"]],template:function(i,n){i&1&&(s(0,"bkd-select",0),b("valueChange",function(u){return n.onGradeChange(u)}),a()),i&2&&h("options",n.options)("allowEmpty",!0)("value",n.valueId)("disabled",n.disabled)("width",n.width)},dependencies:[Be],encapsulation:2})}}return t})();var $s=576,Fn=(()=>{class t{constructor(e,i){this.portal=e,this.state=i,this.destroy$=new te,this.handleWindowScroll=()=>{this.updateStickyVisibility(),this.updateStickyTopOffset()},this.handleWindowResize=()=>{this.updateStickyWidth(),this.updateStickyVisibility(),this.updateStickyTopOffset()},this.handleTableScroll=()=>{this.updateStickyLeftOffset()}}ngOnInit(){q([this.state.filteredTests$,this.state.expandedHeader$]).pipe(_e(this.destroy$)).subscribe(()=>setTimeout(()=>this.updateStickyWidth()))}ngAfterViewInit(){this.handleWindowScroll(),this.handleTableScroll(),this.handleWindowResize(),this.window.addEventListener("scroll",this.handleWindowScroll),this.getTableScrollContainer()?.addEventListener("scroll",this.handleTableScroll),this.window.addEventListener("resize",this.handleWindowResize)}ngOnDestroy(){this.window.removeEventListener("scroll",this.handleWindowScroll),this.getTableScrollContainer()?.removeEventListener("scroll",this.handleTableScroll),this.window.removeEventListener("resize",this.handleWindowResize)}get window(){return this.portal.window??window}getTableScrollContainer(){return document.querySelector(".table-responsive-wrapper")??null}updateStickyVisibility(){if(this.isSmallBreakpointDown())return;let e=this.inlineHeader.getTop()+this.getIframeScrollY();this.stickyHeader.shown=this.getScrollTop()>e}updateStickyTopOffset(){this.isSmallBreakpointDown()||this.stickyHeader.setTopOffset(this.portal.inIframe?this.getScrollTop():0)}updateStickyLeftOffset(){this.isSmallBreakpointDown()||this.stickyHeader.setLeftOffset(this.inlineHeader.getLeft())}updateStickyWidth(){this.isSmallBreakpointDown()||(this.stickyHeader.setWidth(this.inlineHeader.getWidth()),this.stickyHeader.setColumnWidths(this.inlineHeader.getColumnWidths()),this.stickyHeader.setStickyColumnHeights(this.inlineHeader.getStickyColumnsHeights()))}getScrollTop(){return this.window.scrollY-this.portal.getIframeTop()}getIframeScrollY(){return window.scrollY}isSmallBreakpointDown(){return window.innerWidth<$s}static{this.\u0275fac=function(i){return new(i||t)(x(Hi),x(Y))}}static{this.\u0275dir=Kt({type:t,selectors:[["","bkdTestEditGradesHeaderSticky",""]],inputs:{inlineHeader:"inlineHeader",stickyHeader:"stickyHeader"}})}}return t})();var Rn=(t,o)=>({"btn-primary":t,"btn-outline-secondary":o}),Bn=(()=>{class t{constructor(){this.filter=Dt,this.filterChange=new J}showOnlyMine(){this.filterChange.next(B(R({},this.filter),{onlyMine:!0}))}showAll(){this.filterChange.next(B(R({},this.filter),{onlyMine:!1}))}onHidePublishedChange(e){let i=(e.target&&e.target instanceof HTMLInputElement&&e.target?.checked)??!1;this.filterChange.next(B(R({},this.filter),{hidePublished:i}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-test-table-filter"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},decls:13,vars:18,consts:[[1,"only-mine-buttons"],["type","button",1,"btn","desktop",3,"click","ngClass"],["type","button",1,"btn","ms-2","desktop",3,"click","ngClass"],[1,"hide-published"],[1,"form-check"],["id","hide-published","type","checkbox",1,"form-check-input",3,"change","checked"],["for","hide-published",1,"form-check-label"]],template:function(i,n){i&1&&(s(0,"div",0)(1,"button",1),b("click",function(){return n.showAll()}),l(2),p(3,"translate"),a(),s(4,"button",2),b("click",function(){return n.showOnlyMine()}),l(5),p(6,"translate"),a()(),s(7,"div",3)(8,"div",4)(9,"input",5),b("change",function(u){return n.onHidePublishedChange(u)}),a(),s(10,"label",6),l(11),p(12,"translate"),a()()()),i&2&&(r(),h("ngClass",Et(12,Rn,!n.filter.onlyMine,n.filter.onlyMine)),r(),f(" ",c(3,6,"tests.all-tests")," "),r(2),h("ngClass",Et(15,Rn,n.filter.onlyMine,!n.filter.onlyMine)),r(),f(" ",c(6,8,"tests.owned-tests")," "),r(4),h("checked",n.filter.hidePublished),r(2),f(" ",c(12,10,"tests.hide-published")," "))},dependencies:[ce,Le,I],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:100%}.only-mine-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;height:3.625rem}.hide-published[_ngcontent-%COMP%]{display:flex;align-items:center;height:2.375rem;margin-bottom:1rem}.hide-published[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:300}.hide-published[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]{margin-bottom:0}"]})}}return t})();var Ds=["*"],jn=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-preserve-line-height"]],ngContentSelectors:Ds,decls:3,vars:0,template:function(i,n){i&1&&(Zt(),s(0,"div"),Qt(1),l(2,"\xA0"),a())},encapsulation:2})}}return t})();var Vn=(()=>{class t{constructor(e){this.translate=e}transform(e){return`${e.Weight} (${e.WeightPercent}%)${this.getPoints(e)}`}getPoints(e){return e.IsPointGrading?`, ${e.MaxPointsAdjusted??e.MaxPoints} ${this.translate.instant("tests.summary.points")}`:""}static{this.\u0275fac=function(i){return new(i||t)(x(ae,16))}}static{this.\u0275pipe=Yt({name:"testSummaryShort",type:t,pure:!0})}}return t})();var Ls=t=>[t,"edit"];function Gs(t,o){t&1&&(s(0,"i",9),l(1,"edit"),a())}function Fs(t,o){if(t&1&&(s(0,"div",5)(1,"div",7)(2,"bkd-preserve-line-height"),l(3),p(4,"date"),a(),s(5,"a",8),T(6,Gs,2,0,"i",9),a()(),s(7,"bkd-preserve-line-height"),l(8),p(9,"testSummaryShort"),a(),s(10,"bkd-preserve-line-height"),l(11),a()()),t&2){let e=m();r(3),v(D(4,5,e.test.Date,"dd.MM.yyyy")),r(2),h("routerLink",G(10,Ls,e.test.Id)),r(),S(e.test.IsOwner&&e.test.IsPublished===!1?6:-1),r(2),f(" ",c(9,8,e.test)," "),r(3),v(e.test.Owner)}}function Rs(t,o){if(t&1){let e=L();s(0,"div",6)(1,"a",10),p(2,"translate"),b("click",function(){E(e);let n=m();return w(n.unpublishTest())}),s(3,"i",11),l(4,"lock"),a(),s(5,"span"),l(6),p(7,"translate"),a()(),s(8,"bkd-caret",12),b("click",function(){E(e);let n=m();return w(n.emitToggleHeader())}),a()()}if(t&2){let e=m();r(),pe("title",c(2,3,"tests.edit")),r(5),v(c(7,5,"tests.published")),r(2),h("expanded",e.expanded)}}function Bs(t,o){if(t&1){let e=L();s(0,"div",6)(1,"a",13),p(2,"translate"),b("click",function(){E(e);let n=m();return w(n.publishTest())}),s(3,"i",11),l(4,"lock_open"),a(),s(5,"span"),l(6),p(7,"translate"),a()(),s(8,"bkd-caret",12),b("click",function(){E(e);let n=m();return w(n.emitToggleHeader())}),a()()}if(t&2){let e=m();r(),pe("title",c(2,3,"tests.publish")),r(5),v(c(7,5,"tests.not-published")),r(2),h("expanded",e.expanded)}}var An=(()=>{class t{constructor(){this.toggleHeader=new J,this.publish=new J,this.unpublish=new J}emitToggleHeader(){this.toggleHeader.emit(!this.expanded)}publishTest(){this.publish.emit(this.test)}unpublishTest(){this.unpublish.emit(this.test)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-test-table-header"]],inputs:{test:"test",expanded:"expanded"},outputs:{toggleHeader:"toggleHeader",publish:"publish",unpublish:"unpublish"},decls:9,vars:5,consts:[[1,"d-flex","flex-column","h-100","justify-content-between"],["role","button",1,"test-designation","d-flex","flex-row","my-3","align-items-end","justify-content-between",3,"click"],[3,"ngClass"],[1,"align-self-start",3,"expanded"],[1,"d-flex","flex-column"],[1,"d-flex","flex-column","mb-3"],[1,"d-flex","align-items-center","justify-content-between","test-status"],[1,"d-flex","flex-row","justify-content-between"],[1,"btn","btn-link","p-0","edit",3,"routerLink"],[1,"material-icons"],[1,"d-flex","btn","btn-link","ps-0","edit",3,"click","title"],[1,"material-icons","me-1"],[1,"expand-mobile",3,"click","expanded"],[1,"d-flex","btn","btn-link","ps-0",3,"click","title"]],template:function(i,n){i&1&&(s(0,"div",0)(1,"div",1),b("click",function(){return n.emitToggleHeader()}),s(2,"div",2),l(3),a(),C(4,"bkd-caret",3),a(),s(5,"div",4),T(6,Fs,12,12,"div",5)(7,Rs,9,7,"div",6)(8,Bs,9,7,"div",6),a()()),i&2&&(r(2),h("ngClass",n.expanded?"expanded":"collapsed"),r(),f(" ",n.test.Designation," "),r(),h("expanded",n.expanded),r(2),S(n.expanded?6:-1),r(),S(n.test.IsPublished?7:8))},dependencies:[ce,wi,jn,X,ye,I,Vn],styles:["[_nghost-%COMP%]{font-weight:300}.collapsed[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.test-designation[_ngcontent-%COMP%]{display:none!important}.test-status[_ngcontent-%COMP%]{order:-1;padding-bottom:1rem}.test-status[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.test-status[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#000}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.edit[_ngcontent-%COMP%]{color:#00000080;text-decoration:none}@media (min-width: 811px){.test-designation[_ngcontent-%COMP%]{display:inherit!important}.test-status[_ngcontent-%COMP%]{order:initial}.expand-mobile[_ngcontent-%COMP%]{display:none!important}}"]})}}return t})();var js=["bkdTestEditGradesHeader",""],Lt=(t,o)=>o.Id,Vs=t=>({"test-point-grading":t}),As=t=>({selected:t});function Hs(t,o){if(t&1){let e=L();s(0,"th",3)(1,"bkd-test-table-header",14),b("toggleHeader",function(n){E(e);let d=m();return w(d.state.toggleHeader(n))})("publish",function(n){E(e);let d=m();return w(d.publish.emit(n))})("unpublish",function(n){E(e);let d=m();return w(d.unpublish.emit(n))}),a()()}if(t&2){let e=o.$implicit,i=m(),n=P(4);h("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),r(),h("test",e)("expanded",n)}}function Ns(t,o){if(t&1){let e=L();s(0,"th",4)(1,"bkd-test-table-header",14),b("toggleHeader",function(n){E(e);let d=m();return w(d.state.toggleHeader(n))})("publish",function(n){E(e);let d=m();return w(d.publish.emit(n))})("unpublish",function(n){E(e);let d=m();return w(d.unpublish.emit(n))}),a()()}if(t&2){let e=o.$implicit,i=m(),n=P(4);h("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),r(),h("test",e)("expanded",n)}}function Us(t,o){if(t&1){let e=L();s(0,"div",15)(1,"span",16),b("click",function(){E(e);let n=m().$implicit,d=m();return w(d.state.sortBy(n))}),l(2),p(3,"translate"),a()()}t&2&&(r(2),f("",c(3,1,"tests.points")," "))}function Ws(t,o){if(t&1){let e=L();s(0,"th",13)(1,"div",8),T(2,Us,4,3,"div",15),s(3,"div",9)(4,"span",16),b("click",function(){let n=E(e).$implicit,d=m();return w(d.state.sortBy(n))}),l(5),p(6,"translate"),a()(),s(7,"div",10),l(8),p(9,"async"),a()()()}if(t&2){let e=o.$implicit,i=m();h("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),r(2),S(e.IsPointGrading?2:-1),r(3),v(c(6,4,"tests.grade")),r(3),f(" ",c(9,6,i.state.getSortingChar$(e))," ")}}var Hn=(()=>{class t{set shown(e){let i=this.element.nativeElement.classList;e?i.add("shown"):i.remove("shown")}constructor(e,i){this.state=e,this.element=i,this.sticky=!1,this.publish=new J,this.unpublish=new J}getTop(){return this.element.nativeElement.getBoundingClientRect().top}getLeft(){return this.element.nativeElement.getBoundingClientRect().left}setTopOffset(e){this.element.nativeElement.style.top=`${e}px`}setLeftOffset(e){this.element.nativeElement.style.left=`${e}px`}getWidth(){return this.element.nativeElement.getBoundingClientRect().width}setWidth(e){this.element.nativeElement.style.width=`${e}px`}getColumnWidths(){return this.getRowsAndColumns().map(e=>e.map(i=>i.getBoundingClientRect().width))}setColumnWidths(e){let i=this.getRowsAndColumns();if(i.length!==e.length||!i.every((n,d)=>n.length===e[d].length))throw new Error("Given column widths do not match number of header rows/columns");i.forEach((n,d)=>n.forEach((u,g)=>{u.style.width=`${e[d][g]}px`,u.style.minWidth=`${e[d][g]}px`}))}getStickyColumnsHeights(){return this.getRowsAndColumns(".sticky").map(e=>e.map(i=>i.getBoundingClientRect().height))}setStickyColumnHeights(e){let i=this.getRowsAndColumns(".sticky");if(i.length!==e.length||!i.every((n,d)=>n.length===e[d].length))throw new Error("Given column heights do not match number of sticky header columns");i.forEach((n,d)=>n.forEach((u,g)=>{u.style.height=`${e[d][g]}px`})),this.getRows().forEach((n,d)=>{let u=e[d].reduce((g,k)=>Math.max(g,k),0);n.style.height=`${u}px`})}getRowsAndColumns(e){return this.getRows().map(i=>Array.from(i.querySelectorAll(`th:not(.header-mobile)${e??""}`)))}getRows(){return Array.from(this.element.nativeElement.querySelectorAll("tr"))}static{this.\u0275fac=function(i){return new(i||t)(x(Y),x(qt))}}static{this.\u0275cmp=_({type:t,selectors:[["thead","bkdTestEditGradesHeader",""]],hostVars:2,hostBindings:function(i,n){i&2&&le("sticky",n.sticky)},inputs:{selectedTest:"selectedTest",sticky:"sticky",shown:"shown"},outputs:{publish:"publish",unpublish:"unpublish"},attrs:js,decls:42,vars:32,consts:[[1,"header-collapsible"],["colspan","3",1,"desktop","sticky"],[3,"filterChange","filter"],["container","body",1,"test-grade","grade","test-info-desktop",3,"ngClass"],["container","body","colspan","3",1,"test-grade","header-mobile","test-info-mobile",3,"ngClass"],[1,"filler"],[3,"ngClass"],[1,"sticky","student-name",3,"click"],[1,"d-flex"],[1,"column-title"],[1,"sort-direction","ms-1"],[1,"sticky","student-grade","desktop",3,"click","ngClass"],[1,"border-end","sticky","student-average","desktop",3,"click"],["container","body",1,"test-grade",3,"ngClass"],[3,"toggleHeader","publish","unpublish","test","expanded"],[1,"column-title","point-input-container","me-2","me-md-3"],[3,"click"]],template:function(i,n){if(i&1){let d=L();F(0),p(1,"async"),F(2),p(3,"async"),F(4),p(5,"async"),s(6,"tr",0)(7,"th",1)(8,"bkd-test-table-filter",2),b("filterChange",function(g){return E(d),w(n.state.setFilter(g))}),a()(),H(9,Hs,2,3,"th",3,Lt),H(11,Ns,2,3,"th",4,Lt),C(13,"th",5),a(),s(14,"tr",6)(15,"th",7),b("click",function(){return E(d),w(n.state.sortBy("FullName"))}),s(16,"div",8)(17,"div",9),l(18),p(19,"translate"),a(),s(20,"div",10),l(21),p(22,"async"),a()()(),s(23,"th",11),b("click",function(){return E(d),w(n.state.sortBy("FinalGrade"))}),s(24,"div",8)(25,"div",9),l(26),p(27,"translate"),a(),s(28,"div",10),l(29),p(30,"async"),a()()(),s(31,"th",12),b("click",function(){return E(d),w(n.state.sortBy("TestsMean"))}),s(32,"div",8)(33,"div",9),l(34),p(35,"translate"),a(),s(36,"div",10),l(37),p(38,"async"),a()()(),H(39,Ws,10,8,"th",13,Lt),C(41,"th",5),a()}if(i&2){let d=c(1,9,n.state.filteredTests$),u=c(3,11,n.state.filter$);r(4),A(c(5,13,n.state.expandedHeader$)),r(4),h("filter",u),r(),N(d),r(2),N(d),r(3),h("ngClass",G(28,Vs,n.selectedTest==null?null:n.selectedTest.IsPointGrading)),r(4),f(" ",c(19,16,"tests.student.name")," "),r(3),f(" ",c(22,18,n.state.getSortingChar$("FullName"))," "),r(2),h("ngClass",G(30,As,n.selectedTest===void 0)),r(3),f(" ",c(27,20,"tests.grade")," "),r(3),f(" ",c(30,22,n.state.getSortingChar$("FinalGrade"))," "),r(5),f(" ",c(35,24,"tests.mean")," "),r(3),f(" ",c(38,26,n.state.getSortingChar$("TestsMean"))," "),r(2),N(d)}},dependencies:[K,ce,I,Bn,An],styles:["[_nghost-%COMP%]{--spacer: 16px;--point-input-size: 4em;--grade-input-size: 127px;--points-grade-gap: 1rem;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-average-column-width: 100px;--test-grade-column-width: calc( var(--spacer) + var(--point-input-size) + var(--points-grade-gap) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--student-average-column-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) );--test-columns-offset: calc( var(--student-average-column-offset) + var(--student-average-column-width) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}@media (max-width: 767.98px){[_nghost-%COMP%]{--points-grade-gap: calc(.5 * var(--spacer))}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (min-width: 576px){[_nghost-%COMP%]{--point-input-size: 5em}}tr[_ngcontent-%COMP%]:not(.header-collapsible)   th.test-grade[_ngcontent-%COMP%], td.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}@media (max-width: 810px){tr[_ngcontent-%COMP%]:not(.header-collapsible):not(.test-point-grading)   th.test-grade[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]:not(.test-point-grading)   th.student-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.test-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.student-grade[_ngcontent-%COMP%]{width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));min-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));max-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer))}}th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}th.test-grade[_ngcontent-%COMP%]   .column-title.point-input-container[_ngcontent-%COMP%]{width:var(--point-input-size)}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-average[_ngcontent-%COMP%], .test-grade[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex;width:100%}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.test-grade[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}.student-average[_ngcontent-%COMP%]{width:var(--student-average-column-width);min-width:var(--student-average-column-width);max-width:var(--student-average-column-width)}.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}th.sticky.student-average[_ngcontent-%COMP%], td.sticky.student-average[_ngcontent-%COMP%]{left:var(--student-average-column-offset)}}@media (max-width: 1200px){[_nghost-%COMP%]{--student-average-column-width: 1px}.student-average[_ngcontent-%COMP%]{padding:0;overflow:hidden}}@media (min-width: 1201px){.student-average-inline[_ngcontent-%COMP%]{display:none}}.sticky[_nghost-%COMP%]{position:fixed;top:0;left:0;z-index:1000;display:none}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;vertical-align:top}.header-collapsible[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:0 1rem}tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:none!important}@media (min-width: 811px){.sticky.shown[_nghost-%COMP%]{display:table-header-group}tr[_ngcontent-%COMP%]   th.test-info-mobile[_ngcontent-%COMP%]{display:none!important}tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:table-cell!important}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;padding-top:.25rem;padding-bottom:.25rem;border-top:initial}.sticky[_nghost-%COMP%]{margin-left:var(--test-columns-offset)}.sticky[_nghost-%COMP%]   th.sticky[_ngcontent-%COMP%]{position:fixed}}"],changeDetection:0})}}return t})();var zs=(t,o)=>o.student.Id,qs=(t,o)=>o.Id,Ks=(t,o)=>o.id,Ys=t=>({"test-point-grading":t}),Nn=t=>({selected:t}),Zs=t=>["student",t,"grades"],Qs=t=>({"visible-on-mobile":t});function Xs(t,o){if(t&1&&(s(0,"div"),l(1),a()),t&2){let e=m().$implicit;r(),f(" ",e.finalGrade.finalGradeValue," ")}}function Js(t,o){if(t&1){let e=L();s(0,"bkd-grade-select",19),p(1,"async"),p(2,"async"),b("gradeIdSelected",function(n){E(e);let d=m(2);return w(d.state.overwriteFinalGrade(n))}),a()}if(t&2){let e,i,n=m().$implicit,d=m();h("options",c(1,4,d.state.gradingOptionsForCourse$()))("valueId",(e=n.finalGrade.gradeId)!==null&&e!==void 0?e:null)("gradeId",(i=n.finalGrade.gradingId)!==null&&i!==void 0?i:null)("disabled",c(2,6,d.isEditFinalGradesAllowed(n))===!1)}}function ea(t,o){if(t&1&&(F(0),s(1,"td",11),C(2,"bkd-grade",20),p(3,"async"),a()),t&2){let e=o.$implicit,i=o.$index,n=m(),d=n.$implicit,u=n.$index,g=m(),k=e.grade;r(),h("ngClass",g.selectedTest!==void 0&&k.test.Id===g.selectedTest.Id?"selected":""),r(),h("grade",k)("gradeOptions",c(3,6,g.state.gradingOptionsForTest$(k.test)))("student",d.student)("hasFinalGrade",!!d.finalGrade.finalGradeValue)("tabIndex",(1+i)*1e3+u)}}function ta(t,o){if(t&1&&(s(0,"tr")(1,"td",6)(2,"a",15)(3,"div"),l(4),a(),s(5,"div",8),l(6),p(7,"translate"),p(8,"decimalOrDash"),a()()(),s(9,"td",16),T(10,Xs,2,1,"div")(11,Js,3,8,"bkd-grade-select",17),a(),s(12,"td",18),l(13),p(14,"decimalOrDash"),a(),H(15,ea,4,8,"td",11,Ks),C(17,"td",12),a()),t&2){let e=o.$implicit,i=m();r(2),h("routerLink",G(15,Zs,e.student.Id)),r(2),v(e.student.FullName),r(2),Ue(" ",c(7,7,"tests.mean"),": ",D(8,9,e.finalGrade.average,"1-3")," "),r(3),h("ngClass",G(17,Nn,i.selectedTest===void 0)),r(),S(e.finalGrade.finalGradeValue?10:11),r(3),f(" ",D(14,12,e.finalGrade.average,"1-3")," "),r(2),N(i.getGrades(e))}}function ia(t,o){if(t&1&&(s(0,"td",11),C(1,"bkd-average-grades",21),a()),t&2){let e=o.$implicit,i=m();h("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)||e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),r(),h("test",e)}}function na(t,o){if(t&1){let e=L();s(0,"button",22),b("click",function(){E(e);let n=m();return w(n.setAverageAsFinalGrade())}),l(1),p(2,"translate"),a()}if(t&2){let e=m(),i=P(2);h("ngClass",G(4,Qs,!i||!e.selectedTest)),r(),f(" ",c(2,2,"tests.set-final-grade")," ")}}var Un=(()=>{class t{constructor(e,i){this.state=e,this.modalService=i}ngOnInit(){this.state.setSorting({key:"FullName",ascending:!0})}setAverageAsFinalGrade(){this.state.course$.pipe(oe(1)).subscribe(e=>this.state.setAveragesAsFinalGrades({CourseIds:[e.Id]}))}isEditFinalGradesAllowed(e){return this.state.course$.pipe(y(i=>!!(ht(i)?.value&&e.finalGrade?.canGrade)))}getGrades(e){return e.grades.flatMap(i=>({id:`${e.student.Id}-${i.test.Id}`,grade:i}))}publish(e){let i=this.openModal(e);this.onCloseModal(i,()=>this.state.publish(e))}unpublish(e){let i=this.openModal(e);this.onCloseModal(i,()=>this.state.unpublish(e))}calculatePointsAverage(e){return this.safeAverage(e,at)}calculateGradeAverage(e){return this.safeAverage(e,ot)}safeAverage(e,i){try{return i(e).toString()}catch{return"\u2013"}}openModal(e){let i=this.modalService.open($n);return i.componentInstance.test=e,i}onCloseModal(e,i){e.result.then(n=>{n&&i()},()=>{})}static{this.\u0275fac=function(i){return new(i||t)(x(Y),x(lt))}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-test-edit-grades"]],inputs:{selectedTest:"selectedTest"},features:[ne([He])],decls:40,vars:45,consts:[["inlineHeader",""],["stickyHeader",""],[1,"table-responsive-wrapper"],["bkdTestEditGradesHeaderSticky","",1,"table","table-hover","h-100",3,"ngClass","inlineHeader","stickyHeader"],["bkdTestEditGradesHeader","",3,"publish","unpublish","selectedTest"],["bkdTestEditGradesHeader","",3,"publish","unpublish","sticky","selectedTest"],[1,"sticky","student-name"],[1,"d-flex","flex-column"],[1,"student-average-inline"],[1,"desktop","sticky","student-grade",3,"ngClass"],[1,"desktop","border-end","sticky","student-average"],[1,"test-grade",3,"ngClass"],[1,"filler"],[1,"action-buttons"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"ngClass"],[3,"routerLink"],[1,"sticky","student-grade",3,"ngClass"],[3,"options","valueId","gradeId","disabled"],[1,"border-end","sticky","student-average"],[3,"gradeIdSelected","options","valueId","gradeId","disabled"],[3,"grade","gradeOptions","student","hasFinalGrade","tabIndex"],[3,"test"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"click","ngClass"]],template:function(i,n){if(i&1){let d=L();F(0),p(1,"async"),F(2),p(3,"async"),F(4),p(5,"async"),s(6,"div",2)(7,"table",3)(8,"thead",4,0),b("publish",function(g){return E(d),w(n.publish(g))})("unpublish",function(g){return E(d),w(n.unpublish(g))}),a(),s(10,"thead",5,1),b("publish",function(g){return E(d),w(n.publish(g))})("unpublish",function(g){return E(d),w(n.unpublish(g))}),a(),s(12,"tbody"),H(13,ta,18,19,"tr",null,zs),s(15,"tr")(16,"td",6)(17,"div",7)(18,"div"),l(19),p(20,"translate"),a(),s(21,"div",8),l(22),p(23,"translate"),p(24,"async"),p(25,"decimalOrDash"),a()()(),s(26,"td",9),l(27),p(28,"async"),p(29,"decimalOrDash"),a(),s(30,"td",10),l(31),p(32,"async"),p(33,"decimalOrDash"),a(),H(34,ia,2,2,"td",11,qs),C(36,"td",12),a()()(),s(37,"div",13),T(38,na,3,6,"button",14),p(39,"async"),a()()}if(i&2){let d=Se(9),u=Se(11),g=c(1,13,n.state.filteredTests$);r(2),A(c(3,15,n.state.hasTests$));let k=c(5,18,n.state.studentGrades$);r(5),h("ngClass",G(41,Ys,n.selectedTest==null?null:n.selectedTest.IsPointGrading))("inlineHeader",d)("stickyHeader",u),r(),h("selectedTest",n.selectedTest),r(2),h("sticky",!0)("selectedTest",n.selectedTest),r(3),N(k),r(6),v(c(20,20,"tests.average")),r(3),Ue(" ",c(23,22,"tests.mean"),": ",D(25,26,c(24,24,n.state.meanOfStudentGradesForCourse$),"1-3")," "),r(4),h("ngClass",G(43,Nn,n.selectedTest===void 0)),r(),f(" ",D(29,31,c(28,29,n.state.meanOfFinalGradesForCourse$),"1-3")," "),r(4),f(" ",D(33,36,c(32,34,n.state.meanOfStudentGradesForCourse$),"1-3")," "),r(3),N(g),r(4),S(c(39,39,n.state.canSetFinalGrade$)?38:-1)}},dependencies:[ce,X,Gn,Dn,Ln,K,I,Bi,Fn,Hn],styles:["[_nghost-%COMP%]{--spacer: 16px;--point-input-size: 4em;--grade-input-size: 127px;--points-grade-gap: 1rem;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-average-column-width: 100px;--test-grade-column-width: calc( var(--spacer) + var(--point-input-size) + var(--points-grade-gap) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--student-average-column-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) );--test-columns-offset: calc( var(--student-average-column-offset) + var(--student-average-column-width) )}@media (min-width: 1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}@media (max-width: 767.98px){[_nghost-%COMP%]{--points-grade-gap: calc(.5 * var(--spacer))}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media (min-width: 576px){[_nghost-%COMP%]{--point-input-size: 5em}}tr[_ngcontent-%COMP%]:not(.header-collapsible)   th.test-grade[_ngcontent-%COMP%], td.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}@media (max-width: 810px){tr[_ngcontent-%COMP%]:not(.header-collapsible):not(.test-point-grading)   th.test-grade[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]:not(.test-point-grading)   th.student-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.test-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.student-grade[_ngcontent-%COMP%]{width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));min-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));max-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer))}}th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media (max-width: 810px){th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}th.test-grade[_ngcontent-%COMP%]   .column-title.point-input-container[_ngcontent-%COMP%]{width:var(--point-input-size)}@media (max-width: 810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-average[_ngcontent-%COMP%], .test-grade[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex;width:100%}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.test-grade[_ngcontent-%COMP%]{flex:none;display:block}}@media (min-width: 811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}.student-average[_ngcontent-%COMP%]{width:var(--student-average-column-width);min-width:var(--student-average-column-width);max-width:var(--student-average-column-width)}.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}th.sticky.student-average[_ngcontent-%COMP%], td.sticky.student-average[_ngcontent-%COMP%]{left:var(--student-average-column-offset)}}@media (max-width: 1200px){[_nghost-%COMP%]{--student-average-column-width: 1px}.student-average[_ngcontent-%COMP%]{padding:0;overflow:hidden}}@media (min-width: 1201px){.student-average-inline[_ngcontent-%COMP%]{display:none}}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child{text-decoration:underline}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}.student-average-inline[_ngcontent-%COMP%]{color:#4e4e4ef2;font-size:.875rem;line-height:1}@media (min-width: 811px){.table-responsive-wrapper[_ngcontent-%COMP%]{display:block;overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.action-buttons[_ngcontent-%COMP%]{position:sticky;left:0}}@media (max-width: 810px){.apply-average-button[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]})}}return t})();var ra=()=>["/events"],sa=t=>({count:t});function aa(t,o){if(t&1&&(s(0,"div",7),l(1),p(2,"translate"),a()),t&2){let e=m();r(),f(" ",D(2,1,e.course.ParticipatingStudents.length===1?"courses.registration":"courses.registrations",G(4,sa,e.course.ParticipatingStudents.length))," ")}}var Wn=(()=>{class t{constructor(e){this.reportsService=e,this.course$=new z(null),this.reports$=this.course$.pipe(y(i=>i?.Id),Z(),O(i=>i?this.reportsService.getCourseTestsReports(i):V([])),Vt([]))}ngOnChanges(e){e.course&&this.course$.next(e.course.currentValue)}getDesignation(){return gt(this.course)}static{this.\u0275fac=function(i){return new(i||t)(x(dt))}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-header"]],inputs:{course:"course"},features:[ke],decls:12,vars:7,consts:[[3,"link"],[1,"d-flex"],["routerLink","add",1,"edit","btn","btn-primary","btn-icon","ms-2"],[1,"material-icons"],[1,"ms-2",3,"reports"],["id","excel-import"],[1,"d-flex","flex-column","header"],[1,"additional-info"]],template:function(i,n){i&1&&(s(0,"bkd-backlink",0)(1,"div",1)(2,"a",2)(3,"i",3),l(4,"add"),a()(),C(5,"bkd-reports-link",4),p(6,"async"),C(7,"div",5),a()(),s(8,"div",6)(9,"h1"),l(10),a(),T(11,aa,3,6,"div",7),a()),i&2&&(h("link",Oe(6,ra)),r(5),h("reports",c(6,4,n.reports$)),r(5),v(n.getDesignation()),r(),S(n.course.ParticipatingStudents?11:-1))},dependencies:[Ve,X,rt,K,I],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem;border-bottom:1px solid #dee2e6}h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"]})}}return t})();var oa=()=>[],da=t=>({"visible-on-mobile":t});function la(t,o){t&1&&C(0,"bkd-spinner")}function pa(t,o){if(t&1){let e=L();s(0,"bkd-select",4),b("valueChange",function(n){E(e);let d=m(2);return w(n&&d.testSelected(n))}),a(),C(1,"bkd-test-edit-grades",5)}if(t&2){m(2);let e=P(6),i=P(8),n=P(10);h("options",e)("value",i)("allowEmpty",!1),r(),h("selectedTest",n)}}function ca(t,o){t&1&&(s(0,"p",2),l(1),p(2,"translate"),a()),t&2&&(r(),v(c(2,1,"tests.no-tests")))}function ma(t,o){if(t&1&&(s(0,"a",3),p(1,"async"),s(2,"i",6),l(3,"arrow_right_alt"),a(),s(4,"span",7),l(5),p(6,"translate"),a()()),t&2){let e=m(2),i=P(4),n=P(10);pe("href",c(1,3,e.buildLinkToRatingOverview()),ie),h("ngClass",G(7,da,!i||!n)),r(5),v(c(6,5,"tests.link-to-rating-overview"))}}function ua(t,o){if(t&1&&(C(0,"bkd-tests-header",1),T(1,pa,2,4)(2,ca,3,3,"p",2)(3,ma,7,9,"a",3),p(4,"async")),t&2){let e=m(),i=P(0),n=P(2);h("course",i),r(),S(n.length>0?1:2),r(2),S(c(4,3,e.state.canSetFinalGrade$)?3:-1)}}var zn=(()=>{class t{constructor(e,i,n){this.settings=e,this.state=i,this.translate=n,this.selectTest$=new te,this.testOptions$=this.state.tests$.pipe(y(d=>[{Key:-1,Value:this.translate.instant("tests.grade")},...d.map(u=>({Key:u.Id,Value:u.Designation}))]),Z()),this.selectedTestId$=qe(this.selectTest$,this.state.tests$.pipe(oe(1),y(d=>d[0]?.Id))).pipe(Z()),this.selectedTest$=this.selectedTestId$.pipe(O(d=>this.state.tests$.pipe(y(u=>u.find(g=>g.Id===d)))),Z())}testSelected(e){this.selectTest$.next(e)}buildLinkToRatingOverview(){return this.state.course$.pipe(oe(1),y(e=>this.settings.eventlist.evaluation.replace(":id",String(e.Id))))}static{this.\u0275fac=function(i){return new(i||t)(x(me),x(Y),x(ae))}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-list"]],decls:16,vars:22,consts:[[1,"bkd-container"],[3,"course"],[1,"mt-3","px-3"],[1,"rating-overview","d-flex","justify-content-end","pe-3","border-top","pt-3",3,"ngClass","href"],["width","100%",1,"tests-dropdown",3,"valueChange","options","value","allowEmpty"],[3,"selectedTest"],[1,"material-icons","fw-bold"],[1,"ps-1"]],template:function(i,n){if(i&1&&(F(0),p(1,"async"),F(2),p(3,"async"),F(4),p(5,"async"),F(6),p(7,"async"),F(8),p(9,"async"),F(10),p(11,"async"),s(12,"div",0),T(13,la,1,0,"bkd-spinner"),p(14,"async"),T(15,ua,5,5),a()),i&2){let d;A(c(1,1,n.state.course$)),r(2),A((d=c(3,4,n.state.tests$))!==null&&d!==void 0?d:Oe(21,oa)),r(2),A(c(5,7,n.state.hasTests$)),r(2),A(c(7,10,n.testOptions$)),r(2),A(c(9,13,n.selectedTestId$)),r(2),A(c(11,16,n.selectedTest$)),r(3),S(c(14,19,n.state.loading$)?13:15)}},dependencies:[Wn,Be,Un,ce,he,K,I],styles:[".tests-dropdown[_ngcontent-%COMP%]{display:block;padding:1rem 0}@media (min-width: 811px){.tests-dropdown[_ngcontent-%COMP%]{display:none}}a.rating-overview[_ngcontent-%COMP%]{text-decoration:none}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}@media (max-width: 810px){a.rating-overview[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]})}}return t})();var xt=(()=>{class t{constructor(e,i){this.state=e,this.route=i,this.courseId$=this.route.paramMap.pipe(y(n=>Number(n.get("id"))),Z()),this.destroy$=new te}ngOnInit(){this.courseId$.pipe(_e(this.destroy$)).subscribe(e=>this.state.setCourseId(e))}ngOnDestroy(){this.destroy$.next()}static{this.\u0275fac=function(i){return new(i||t)(x(Y),x(re))}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests"]],features:[ne([Y])],decls:1,vars:0,template:function(i,n){i&1&&C(0,"router-outlet")},dependencies:[xe],encapsulation:2})}}return t})();function qn(t){return{path:t,component:gn,children:[{path:"",component:un},{path:"study-course-student/:id",component:hn},It]}}var Dc=[{path:"",component:vn,children:[{path:"",component:fn},{path:"current",component:sn,children:[{path:"",component:rn},qn(":id")]},{path:":id",component:xt,children:[{path:"tests",component:zn},qn("students")]},{path:":id/tests/:testId/edit",component:xt,children:[{path:"",component:On}]},{path:":id/tests/add",component:xt,children:[{path:"",component:Pn}]},{path:":id/tests",children:[It]}]}];export{Qi as a,qn as b,Dc as c};
