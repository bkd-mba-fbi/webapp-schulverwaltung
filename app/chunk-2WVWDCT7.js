import{a as Yn,b as li}from"./chunk-2ALKCRZO.js";import{a as ut,b as vt}from"./chunk-YU2OE6DK.js";import{a as un,b as gn,d as hn,e as vn,g as Qn}from"./chunk-GXPKR22I.js";import{a as ht}from"./chunk-VGYWDNUP.js";import{a as si}from"./chunk-JUJUBHJT.js";import{a as we}from"./chunk-4PVX2UE5.js";import{a as oi}from"./chunk-ILQMUXFQ.js";import{e as zn}from"./chunk-75Y5MX3T.js";import{a as Dn,b as On}from"./chunk-RDNZARDR.js";import{a as wt,b as Vn,c as Nn,d as Bn,e as Rn,f as ii,g as ni,h as An,i as Hn,k as Wn,l as xe,m as ai,o as jn,p as ri,q as Un,r as Ee}from"./chunk-HMAHRXLK.js";import{g as $n,i as pt}from"./chunk-XWISOVKN.js";import{a as In,d as kn}from"./chunk-3DIISX7M.js";import{e as Fn}from"./chunk-D2AAKETU.js";import{B as Pn,C as ze,G as Ke,H as Kn}from"./chunk-KGCZGVNH.js";import{a as lt,c as Tn}from"./chunk-WORSXEGE.js";import{e as te,f as ct}from"./chunk-6LRQCBUO.js";import{a as Gn}from"./chunk-Y4QYVF5K.js";import{p as Mn}from"./chunk-JE6RMKPQ.js";import{b as Oe,c as q}from"./chunk-RXV77OBQ.js";import{A as mn,c as Wt,e as rt,f as jt,g as Ut,h as rn,j as on,k as qt,l as zt,m as sn,p as dn,q as ln,u as Kt,v as Yt,w as cn,y as pn,z as qe}from"./chunk-M3VKTN3S.js";import{a as st}from"./chunk-USF5QQBL.js";import{a as di,b as gt}from"./chunk-QLQ6HFBO.js";import{a as Le,b as mt,c as qn,d as Fe}from"./chunk-S6U5TJNW.js";import{a as Ln,b as Et}from"./chunk-LZEU6TW7.js";import{a as ei}from"./chunk-YHCR7GAG.js";import{d as ti}from"./chunk-KFP6476W.js";import{a as dt,b as Pi,i as de}from"./chunk-QWYAXZZX.js";import{a as En,b as Jt}from"./chunk-WNZFLLQC.js";import{a as wn,b as Ge}from"./chunk-DQAQYQ7K.js";import{a as ot}from"./chunk-M732YBIP.js";import{A as fe,F as Qt,H as Xt,I as fn,J as Cn,K as _n,L as bn,M as Mi,N as Sn,O as yn,P as Zt,Q as xn,e as xt,f as nt,g as en,i as Ie,r as ve,s as ke,t as De,u as ne}from"./chunk-RYYQAFJB.js";import{$b as D,$c as me,$d as Ht,Ac as R,Ba as _e,Bc as W,Cc as O,Dc as Re,E as Pt,Ec as Ae,F as Qe,Fa as A,Fb as Se,Fc as ce,Gc as He,Ha as Lt,Hb as f,Hc as F,Ia as Wi,Ib as Be,Ic as wi,J as It,Ja as tt,Jb as C,Ka as Gt,Kb as zi,L as kt,Lb as it,Lc as c,M as Dt,Ma as ji,Mb as V,Mc as p,Md as Ze,Nb as N,Nc as H,Nd as Ue,O as ge,Ob as g,Od as tn,Pb as o,Q as se,Qb as d,Rb as S,Rc as Xi,Rd as Ti,S as Ot,Sb as Q,Sc as y,Sd as at,Tb as J,Tc as Xe,Td as nn,V as Ni,Vc as We,Wc as I,Wd as an,X as le,Xc as At,Z as Me,_ as L,a as $,aa as Pe,ac as $t,b as B,bc as M,cb as Ne,cc as $e,d as pe,dc as u,ec as Ki,fb as a,fc as Yi,h as ae,ha as X,hc as Qi,i as re,ic as Vt,ie as ee,j as xi,jc as Nt,je as P,lc as Bt,ma as m,mc as Rt,nc as ye,o as G,p as Vi,pc as Y,qa as Bi,qd as he,ra as Ri,rc as l,rd as Zi,s as Ve,sa as E,sc as b,t as T,ta as w,tc as v,td as ie,u as Z,ua as et,ub as _,uc as yt,ud as je,va as Ai,wa as Ei,wb as Ui,xa as Hi,xb as qi,xc as z,xd as Ji,yc as U,zb as Ft,zc as K}from"./chunk-CHBP6U4G.js";var Sr=10300,yr=10260,xr=10250,Er=14030,wr=10350;function ci(t){let{HasEvaluationStarted:s,EvaluationUntil:e,HasTestGrading:i}=t.EvaluationStatusRef;if(s===!0&&(t.StatusId===Er||t.StatusId===wr))return{value:be.Rating};if(s===!0&&i===!1){if(e)return{value:be.RatingUntil};if(t.StatusId===Sr)return{value:be.IntermediateRating}}return s===!1&&i===!0&&t.StatusId!==yr&&t.StatusId!==xr?{value:be.Tests}:s===!0&&i===!0?e?{value:be.Tests,label:be.RatingUntil}:{value:be.Tests,label:be.IntermediateRating}:null}function Xn(t){return t.EvaluationStatusRef.HasEvaluationStarted===!0}function Zn(t){return t.EvaluationStatusRef.HasReviewOfEvaluationStarted===!0&&!!t.FinalGrades?.length}function pi(t){let s=t.Classes?t.Classes.map(e=>e.Number).join(", "):null;return s?t.Designation+", "+s:t.Designation}function Jn(t,s){return t?(s.Leadership??"").split(",").some(e=>e.trim()===t.fullname):!1}function mi(t,s){let e=new URLSearchParams({returnlink:s});return s.startsWith("/dashboard")?`/dashboard/students/${t}?${e}`:s.startsWith("/events/current")?`/events/current/${t}?${e}`:s.startsWith("/events/study-courses")?`/events/study-courses/${t}?${e}`:`/events/${t}/students?${e}`}function ea(t){let s=t.Participants?.filter(e=>e.IsActive).map(e=>({id:e.PersonId,name:e.FullName,email:e.DisplayEmail??void 0}))??[];return{eventId:t.Id,eventDesignation:t.Designation,studyClasses:(t.Classes??[]).map(e=>e.Designation).sort(),entries:s}}function Ii(t,s){return B($({},t),{entries:t.entries.map(e=>{let i=s.find(r=>r.StudentId===e.id),n=i?[i.CompanyName,i.CompanyNameAddition].filter(Boolean).join(" \u2013 "):void 0;return B($({},e),{company:n})})})}function ki(t,s,e,i){return{eventId:t,eventDesignation:i??e[0]?.EventDesignation??"",studyClasses:[],entries:s.map(n=>{let r=e.find(h=>h.PersonId===n.Id);return{id:n.Id,subscriptionId:r?.Id,name:n.FullName,email:n.DisplayEmail??void 0,status:r?.Status,statusId:r?.StatusId??void 0,registrationDate:r?.RegistrationDate??void 0}})}}function ta(t,s){return B($({},t),{entries:t.entries.map(e=>B($({},e),{studyClass:s.find(i=>i.StudentRef.Id===e.id)?.StudyClassNumber}))})}var be=(function(t){return t.Rating="rating",t.RatingUntil="rating-until",t.IntermediateRating="intermediate-rating",t.Tests="add-tests",t})(be||{}),ft=(()=>{class t{constructor(){this.coursesRestService=m(xe),this.studyClassRestService=m(si),this.loadingService=m(te),this.translate=m(ee),this.router=m(De),this.loading$=this.loadingService.loading$,this.searchFields$=new re(["designation"]),this.searchSubject$=new re(""),this.search$=this.searchSubject$.asObservable(),this.roles$=new re(null),this.isClassTeacher$=this.roles$.pipe(T(e=>Gn(e,"ClassTeacherRole")),le(1)),this.unratedCourses$=this.roles$.pipe(L(this.loadUnratedCourses.bind(this)),le(1)),this.formativeAssessments$=this.isClassTeacher$.pipe(L(this.loadFormativeAssessments.bind(this)),le(1)),this.studyClasses$=this.isClassTeacher$.pipe(L(this.loadStudyClasses.bind(this)),le(1)),this.events$=this.getEvents().pipe(le(1)),this.filteredEvents$=Z([this.events$,this.searchFields$,this.search$]).pipe(T(ze(ut)))}setSearch(e){this.searchSubject$.next(e)}setRoles(e){this.roles$.next(e)}setSearchFields(e){this.searchFields$.next(e)}getEntries(e=!1){return this.filteredEvents$.pipe(T(i=>e?i.filter(n=>n.evaluationText):i))}getEvents(){return this.loadingService.load(Z([this.unratedCourses$,this.formativeAssessments$,this.studyClasses$]),{stopOnFirstValue:!0}).pipe(T(ze(this.createAndSortEvents.bind(this))))}loadUnratedCourses(e){return this.coursesRestService.getExpandedCourses(e).pipe(T(i=>i.filter(n=>!Zn(n))))}loadFormativeAssessments(e){return e?this.studyClassRestService.getActiveFormativeAssessments():G([])}loadStudyClasses(e){return e?this.studyClassRestService.getActive():G([])}createAndSortEvents(e,i,n){let r=n.filter(h=>!i.map(x=>x.Id).includes(h.Id));return[...this.createFromCourses(e),...this.createFromAssessments(i),...this.createFromStudyClasses(r)].sort((h,x)=>h.designation.localeCompare(x.designation))}createFromCourses(e){return e.map(i=>{let n=ci(i);return{id:i.Id,designation:pi(i),detailLink:this.buildStudentsLink(i.Id),studentCount:i.AttendanceRef.StudentCount||0,dateFrom:i.DateFrom,dateTo:i.DateTo,state:n?.value||null,evaluationText:this.getEvaluationText(n,i.EvaluationStatusRef.EvaluationUntil),evaluationLink:n?.value&&n?.value!==be.Tests?["/events",i.Id,"evaluation"]:["/events",i.Id,"tests"]}})}createFromAssessments(e){return this.createFromStudyClasses(e).map(n=>B($({},n),{state:be.Rating,evaluationText:this.translate.instant("events.state.rating"),evaluationLink:["/events",n.id,"evaluation"]}))}createFromStudyClasses(e){return e.map(i=>({id:i.Id,designation:i.Number,detailLink:this.buildStudentsLink(i.Id),studentCount:i.StudentCount,state:null}))}getEvaluationText(e,i){let n=e?.label||e?.value;return n?this.translate.instant(`events.state.${n}`)+(n===be.RatingUntil?` ${i?Mn(i,"dd.MM.yyyy"):""}`:""):""}buildStudentsLink(e){return mi(e,this.router.url)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var ia=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events"]],features:[ce([ft,Pn])],decls:1,vars:0,template:function(i,n){i&1&&S(0,"router-outlet")},dependencies:[ke],encapsulation:2})}}return t})();var aa=at({adAsColumns:Ti(Ue),adAsCriteria:Ti(Ue)});var ra=(()=>{class t{constructor(){this.settings=m(fe),this.resourcePath="Configurations",this.http=m(Ie)}getSubscriptionDetailsDisplay(){return this.http.get(`${this.baseUrl}/Grading`).pipe(L(En(aa)))}get baseUrl(){return`${this.settings.apiUrl}/${this.resourcePath}`}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var oa=at({Id:Ze,IdPerson:Ue,PersonFullname:Ze,IdGrade:Ht(Ue),GradeValue:Ht(Ze),Comment:Ht(Ze)});var ui=(()=>{class t extends dt{constructor(){let e=m(Ie),i=m(fe);super(e,i,oa,"GradingItems")}getListForEvent(e){let i=new nt().set("idEvent",e);return this.getList({params:i})}updateForEvent(e,i){let n=new nt().set("idEvent",e);return this.http.put(`${this.baseUrl}/`,i,{params:n})}update(e,i){let n=`${this.baseUrl}/${e}`;return this.http.put(n,i)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function da(t){return(s,e)=>{let i=0;switch(t.primarySortKey){case"name":i=sa(s,e);break;case"grade":i=Tr(s,e),i===0&&(i=sa(s,e));break;default:throw new ei(t.primarySortKey,"Unhandled sort criteria")}return t.ascending?i:-i}}function sa(t,s){return t.gradingItem.PersonFullname.localeCompare(s.gradingItem.PersonFullname)}function Tr(t,s){return(t.grade?.Sort??"-").localeCompare(s.grade?.Sort??"-")*-1}var Mr={primarySortKey:"name",ascending:!0},la="events-evaluation",Ce=(()=>{class t{constructor(){this.route=m(ve),this.loadingService=m(te),this.coursesService=m(xe),this.studyClassesService=m(si),this.gradingItemsService=m(ui),this.gradingScalesService=m(ai),this.configurationsService=m(ra),this.subscriptionDetailsService=m(di),this.eventId$=(this.route.parent?.params??G({})).pipe(T(e=>{let i=e.id;return i?Number(i):null}))??G(null),this.sortCriteria=A(Mr),this.loading=q(this.loadingService.loading(la),{requireSync:!0}),this.noEvaluation=y(()=>!this.gradingScale()&&this.columns().length===0&&this.entries().every(({criteria:e})=>e.length===0)),this.hasReviewStarted=y(()=>this.event()?.hasReviewOfEvaluationStarted&&!this.event()?.hasEvaluationStarted),this.event=q(this.eventId$.pipe(L(this.loadEvaluationEvent.bind(this))),{initialValue:null}),this.columns=y(()=>this.collectColumns(this.columnSubscriptionDetails())),this.entries=y(()=>this.sortEntries(this.unsortedEntries(),this.sortCriteria())),this.gradingItems=Xe({source:q(this.eventId$.pipe(L(this.loadGradingItems.bind(this)),Me([])),{initialValue:[]}),computation:e=>e}),this.gradingScale=q(Oe(this.event).pipe(L(e=>this.loadGradingScale(e?.gradingScaleId??null))),{initialValue:null}),this.subscriptionDetailsDisplay=q(this.loadSubscriptionDetailsDisplay(),{initialValue:null}),this.fetchedSubscriptionDetails=q(this.eventId$.pipe(L(this.loadSubscriptionDetails.bind(this))),{initialValue:[]}),this.subscriptionDetails=Xe(()=>this.fetchedSubscriptionDetails()),this.subscriptionDetailsValues=y(()=>this.fetchedSubscriptionDetails().reduce((e,i)=>B($({},e),{[this.getDetailId(i)]:A(i.Value)}),{})),this.columnSubscriptionDetails=y(()=>this.filterColumns(this.subscriptionDetails(),this.subscriptionDetailsDisplay())),this.criteriaSubscriptionDetails=y(()=>this.filterCriteria(this.subscriptionDetails(),this.subscriptionDetailsDisplay())),this.unsortedEntries=y(()=>this.collectEntries(this.gradingItems(),this.gradingScale(),this.columns(),this.columnSubscriptionDetails(),this.criteriaSubscriptionDetails(),this.subscriptionDetailsValues()))}updateGradingItems(e){this.gradingItems.set(e)}updateSubscriptionDetail(e,i){let n=this.subscriptionDetails().map(r=>this.getDetailId(r)===this.getDetailId(e)?B($({},r),{Value:i}):r);this.subscriptionDetails.set(n)}loadEvaluationEvent(e){return e===null?G(null):this.loadingService.load(Z([this.loadCourse(e),this.loadStudyClass(e)]).pipe(T(([i,n])=>i??n)),la)}loadCourse(e){let i=new xt().set(Et,{disableErrorHandlingForStatus:[404]});return this.coursesService.getCourseWithStudentCount(e,{context:i}).pipe(Pi(),T(n=>n?this.buildEvaluationEventFromCourse(n):null))}loadStudyClass(e){let i=new xt().set(Et,{disableErrorHandlingForStatus:[404]});return this.studyClassesService.get(e,{context:i}).pipe(Pi(),T(n=>n?this.buildEvaluationEventFromStudyClass(n):null))}buildEvaluationEventFromCourse(e){let i=e.Classes?.map(r=>r.Number)??[],n=i.length>0?`${e.Designation}, ${i.join(", ")}`:e.Designation;return{id:e.Id,designation:n,type:"course",studentCount:e.AttendanceRef.StudentCount??0,gradingScaleId:e.GradingScaleId,hasReviewOfEvaluationStarted:e.EvaluationStatusRef.HasReviewOfEvaluationStarted||!1,hasEvaluationStarted:e.EvaluationStatusRef.HasEvaluationStarted||!1}}buildEvaluationEventFromStudyClass(e){return{id:e.Id,designation:e.Number,type:"study-class",studentCount:e.StudentCount,gradingScaleId:null,hasReviewOfEvaluationStarted:!1,hasEvaluationStarted:!0}}loadGradingItems(e){return e?this.gradingItemsService.getListForEvent(e):G([])}loadGradingScale(e){return e?this.gradingScalesService.get(e):G(null)}loadSubscriptionDetailsDisplay(){return this.configurationsService.getSubscriptionDetailsDisplay()}loadSubscriptionDetails(e){return e?this.subscriptionDetailsService.getListForEvent(e):G([])}filterColumns(e,i){if(!i)return[];let n=i.adAsColumns,r=e.filter(h=>n.includes(Number(h.VssId)));return Mi(r,h=>h.Sort)}filterCriteria(e,i){if(!i)return[];let n=i.adAsCriteria,r=e.filter(h=>n.includes(Number(h.VssId)));return Mi(r,h=>h.Sort)}getDetailId(e){return`${e.Id}_${e.IdPerson}`}getDetailIdByGradingItem(e,i){return`${e.Id}_${i}_${e.IdPerson}`}getSubscriptionDetailValue(e,i){return e[this.getDetailId(i)]??null}collectColumns(e){return Zt(e,i=>i.VssId).map(i=>({vssId:i.VssId,title:i.VssDesignation,tooltip:i.Tooltip,sort:i.Sort}))}collectEntries(e,i,n,r,h,x){return e.map(j=>this.buildEntry(j,i,n,r,h,x))}buildEntry(e,i,n,r,h,x){let j=r.filter(ue=>ue.IdPerson===e.IdPerson),Te=n.map(({vssId:ue})=>j.find(br=>br.VssId===ue)??null),Je=h.filter(ue=>ue.IdPerson===e.IdPerson);return{gradingItem:e,grade:this.findGrade(e,i),columns:Te.map(ue=>ue?{detail:ue,value:this.getSubscriptionDetailValue(x,ue)}:null),criteria:Je.map(ue=>({detail:ue,value:this.getSubscriptionDetailValue(x,ue)})),evaluationRequired:this.isEvaluationRequired(e,i,Te,Je,x[this.getDetailIdByGradingItem(e,3959)]??null)}}isEvaluationRequired(e,i,n,r,h){let x=i&&this.findGrade(e,i);return!!(i!==null&&x===null||[...n,...r].some(j=>j?.VssInternet==="M"&&j?.Value===null)||!x?.Sufficient&&h!==null&&r.filter(j=>j?.Value!==null).length===0)}findGrade(e,i){let n=i?.Grades??[];return e.IdGrade?n.find(r=>r.Id===e.IdGrade)??null:null}sortEntries(e,i){return[...e].sort(da(i))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac})}}return t})();var ca="events-evaluation-update",Ct=(()=>{class t{constructor(){this.loadingService=m(te),this.subscriptionDetailsService=m(di),this.state=m(Ce),this.restErrorService=m(Ln),this.toastService=m(ot),this.translate=m(ee),this.updating=q(this.loadingService.loading(ca),{requireSync:!0})}updateSubscriptionDetail(e){return pe(this,null,function*(){let{detail:i,value:n}=e;if(!n||i.Value===n())return;let{error:r}=yield Ve(this.saveSubscriptionDetail({detail:i,value:n}));r?this.handleSubscriptionDetailError(e,r):this.handleSubscriptionDetailSuccess(e)})}handleSubscriptionDetailSuccess(e){let{detail:i,value:n}=e;n&&this.state.updateSubscriptionDetail(i,n())}handleSubscriptionDetailError(e,i){i instanceof en?this.restErrorService.notifyHttpError(i):this.toastService.error(this.translate.instant("global.app-errors.exception-message"),this.translate.instant("global.app-errors.exception-title"));let{detail:n,value:r}=e;r?.set(n.Value)}saveSubscriptionDetail(e){let{detail:i,value:n}=e;if(!n)return G({});let r=new xt().set(Et,{disableErrorHandlingExceptForStatus:[401,403]});return this.loadingService.load(this.subscriptionDetailsService.update(i,n(),r).pipe(T(()=>({})),It(h=>G({error:h}))),ca)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac})}}return t})();function Di(t){return t.map(({finalGrade:s})=>s).filter(Pr)}function Pr(t){return t!==null}function ua(t,s,e,i){return t?.map(n=>({student:n,finalGrade:kr(n,e,i),grades:Ir(n,s)}))}function Ir(t,s){return s.map(e=>{if(e.Results===void 0||e.Results?.length===0)return{kind:"no-result",test:e};let i=e.Results?.find(n=>n.StudentId===t.Id);return i!==void 0?{kind:"grade",result:i,test:e}:{kind:"no-result",test:e}})}function kr(t,s,e){let i=s.find(r=>r.StudentId===t.Id);if(i)return{gradingId:i.Id,gradeId:i.GradeId??void 0,average:i.AverageTestResult||void 0,canGrade:i.CanGrade};let n=e.find(r=>r.StudentId===t.Id);if(n)return{finalGradeValue:n.Grade,average:n.AverageTestResult||void 0,canGrade:!1};throw new Error(`Student ${t.FullName} has neither a grading and nor a final grade, this should not happen`)}var ga=({primarySortKey:t,ascending:s},e)=>{let i=s?1:-1,n=null;if(t.startsWith("Test-")){let r=Number(t.replace("Test-",""));n=e.find(h=>h.Id===r)??null}return(r,h)=>{switch(t){case"FullName":return i*r.student.FullName.localeCompare(h.student.FullName);case"FinalGrade":return!r.finalGrade?.gradeId||!h.finalGrade?.gradeId?i*-1:i*pa(r.finalGrade.gradeId,h.finalGrade.gradeId);case"TestsMean":return!r.finalGrade?.average||!h.finalGrade?.average?i*-1:i*pa(r.finalGrade.average,h.finalGrade.average);default:return t.startsWith("Test-")&&n?i*Dr(n,r,h):0}}},Dr=(t,s,e)=>{let i=s.grades.filter(ma).find(r=>r.test.Id===t.Id),n=e.grades.filter(ma).find(r=>r.test.Id===t.Id);return t.IsPointGrading&&i?.result.GradeId===n?.result.GradeId?(i?.result.Points??0)-(n?.result.Points??0):((i?.result.GradeId??Number.POSITIVE_INFINITY)-(n?.result.GradeId??Number.POSITIVE_INFINITY))*-1};function pa(t,s){return t===s?0:t<s?-1:1}function ma(t){return t.kind==="grade"}function ha(t){return t?.test?.MaxPoints??0}function va(t){return(t?.test?.MaxPointsAdjusted||t?.test?.MaxPoints)??0}function fa(t){let s=t.map(e=>e.average).filter(e=>e!=null&&e!==0).map(Number);return wt(s)}function Ca(t,s){return wt(t.map(e=>Or(e,s)).filter(wn))}function Or({gradeId:t,finalGradeValue:s},e){let i;t?i=e.find(h=>h.Key===t)?.Value:i=s;let n=Number(i);return isNaN(n)?0:n}var _a=(()=>{class t extends dt{constructor(){let e=m(Ie),i=m(fe);super(e,i,Wn,"Gradings")}updateGrade(e,i){return this.http.put(`${this.baseUrl}/${e}`,{GradeId:i}).pipe(T(()=>e))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Oi(t,s){return[...s.filter(e=>e.Id!==t?.Id),t].filter(e=>e!=null)}function ba({id:t,selectedGradeId:s},e){return e.map(i=>i.Id!==t?i:B($({},i),{GradeId:s}))}function Sa(t,s){switch(s.type){case"reset":return s.payload;case"updateResult":return t?B($({},t),{Tests:Nn(s.payload.testResult,t.Tests||[],s.payload.ignore),Gradings:s.payload.grading?Oi(s.payload.grading,t.Gradings||[]):t.Gradings}):null;case"deleteResult":return t?B($({},t),{Tests:Bn(s.payload.testId,s.payload.studentId,t.Tests||[]),Gradings:s.payload.grading?Oi(s.payload.grading,t.Gradings||[]):t.Gradings||[]}):null;case"toggle-test-state":return t?B($({},t),{Tests:Rn(s.payload,t.Tests||[])}):null;case"final-grade-overwritten":return t?B($({},t),{Gradings:ba({id:s.payload.id,selectedGradeId:s.payload.selectedGradeId},t.Gradings||[])}):null;case"replace-grades":return t?B($({},t),{Gradings:s.payload}):null;case"delete-test":return t?B($({},t),{Tests:An(s.payload,t.Tests||[])}):null;default:return t}}var Li={onlyMine:!1,hidePublished:!1},oe=(()=>{class t{constructor(){this.coursesRestService=m(xe),this.gradingScalesRestService=m(ai),this.gradingsRestService=m(_a),this.loadingService=m(te),this.sortService=m(Kn),this.action$=new xi(1),this.loading$=this.loadingService.loading$,this._courseId$=new xi(1),this.courseId$=this._courseId$.asObservable(),this.fetchedCourse$=this._courseId$.pipe(L(e=>this.loadingService.load(this.coursesRestService.getExpandedCourse(e))),le(1)),this.course$=Pt(this.action$,this.fetchedCourse$.pipe(Qe(Ge),T(e=>({type:"reset",payload:e})))).pipe(Ni(Sa,null),Qe(Ge),le(1)),this.tests$=this.course$.pipe(T(e=>e.Tests||[]),T(Hn)),this.hasTests$=this.tests$.pipe(T(e=>e.length>0)),this.filterSubject$=new re(Li),this.filter$=this.filterSubject$.asObservable(),this.expandedHeaderSubject$=new re(!1),this.expandedHeader$=this.expandedHeaderSubject$.asObservable(),this.filteredTests$=Z([this.tests$,this.filter$]).pipe(T(([e,i])=>e.filter(n=>(!i.onlyMine||n.IsOwner)&&(!i.hidePublished||!n.IsPublished)))),this.sortCriteria$=this.sortService.sortCriteria$,this.sortCriteria=this.sortService.sortCriteria,this.studentGrades$=Z([this.course$,this.filteredTests$,this.sortCriteria$]).pipe(T(ze(this.toStudentGrades.bind(this)))),this.canSetFinalGrade$=this.course$.pipe(T(Xn)),this.gradingScaleIds$=this.course$.pipe(T(e=>yn([...(e.Tests??[]).map(i=>i.GradingScaleId),e.GradingScaleId]).filter(Ge)),se(Xt),le(1)),this.gradingScales$=this.gradingScaleIds$.pipe(L(e=>this.gradingScalesRestService.getListForIds(e)),le(1)),this.UNDEFINED_GRADINGSCALE_ID=-1,this.gradingScalesOptions$=this.gradingScales$.pipe(T(e=>e.map(i=>{let n=i?.Id||this.UNDEFINED_GRADINGSCALE_ID,r=i?.Grades.map(h=>({Key:h.Id,Value:h.Designation}))||[];return{id:n,options:r}}).reduce((i,n)=>B($({},i),{[n.id]:n.options}),{})),le(1)),this.meanOfStudentGradesForCourse$=this.studentGrades$.pipe(T(e=>fa(Di(e)))),this.meanOfFinalGradesForCourse$=Z([this.gradingScalesOptions$,this.studentGrades$]).pipe(L(ze(this.meanOfOverwrittenGradesForCourse.bind(this))))}setCourseId(e){this._courseId$.next(e)}reload(){this._courseId$.pipe(ge(1)).subscribe(e=>{this.setCourseId(e)})}setFilter(e){this.filterSubject$.next(e)}gradingOptionsForTest$(e){return this.gradingOptions$(e.GradingScaleId)}gradingOptionsForCourse$(){return this.course$.pipe(L(e=>this.gradingOptions$(e.GradingScaleId)))}toStudentGrades(e,i=[],n){let r=ua(e.ParticipatingStudents??[],i,e.Gradings??[],e.FinalGrades??[]);return n?r.sort(ga(n,i)):r}toggleHeader(e){this.expandedHeaderSubject$.next(e)}optimisticallyUpdateGrade(e){return this.course$.pipe(ge(1),T(i=>{let{originalResult:n,updatedResult:r}=this.buildOptimisticResultUpdate(i,e);return this.updateTestResult(r,null),n}))}saveGrade(e,i){this.course$.pipe(ge(1),L(n=>this.coursesRestService.updateTestResult(n.Id,e).pipe(It(r=>(i&&this.updateTestResult($({},i),null),Vi(()=>r)))))).subscribe(({testResult:n,grading:r})=>this.updateOrDeleteTestResult(e.testId,e.studentId,n,r,"gradeId"in e?"grade":"points"))}publish(e){this.coursesRestService.publishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}unpublish(e){this.coursesRestService.unpublishTest(e.Id).subscribe(this.toggleTestPublishedState.bind(this))}deleteTest(e){this.action$.next({type:"delete-test",payload:e})}overwriteFinalGrade({id:e,selectedGradeId:i}){this.gradingsRestService.updateGrade(e,i).subscribe(()=>{this.action$.next({type:"final-grade-overwritten",payload:{id:e,selectedGradeId:i}})})}setAveragesAsFinalGrades(e){this.coursesRestService.setAverageAsFinalGrade(e).subscribe(i=>this.action$.next({type:"replace-grades",payload:i.Gradings}))}buildOptimisticResultUpdate(e,i){let n=Vn(e,i.testId,i.studentId),r=n?$({},n):{Id:"",TestId:i.testId,StudentId:i.studentId,CourseRegistrationId:0,GradeId:null,GradeValue:null,GradeDesignation:null,Points:null};return r.GradeId="gradeId"in i?i.gradeId:n?.GradeId??null,r.Points="points"in i?i.points:n?.Points??null,{originalResult:n,updatedResult:r}}updateOrDeleteTestResult(e,i,n,r,h){n?this.updateTestResult(n,r,h):this.deleteTestResult(e,i,r)}updateTestResult(e,i,n){this.action$.next({type:"updateResult",payload:{testResult:e,grading:i??null,ignore:n}})}deleteTestResult(e,i,n){this.action$.next({type:"deleteResult",payload:{testId:e,studentId:i,grading:n}})}toggleTestPublishedState(e){this.action$.next({type:"toggle-test-state",payload:e})}gradingOptions$(e){return e===null?G(null):this.gradingScalesOptions$.pipe(T(i=>i[e]),le(1))}meanOfOverwrittenGradesForCourse(e,i){return this.course$.pipe(T(n=>{if(n.GradingScaleId===null||e[n.GradingScaleId]===void 0)return null;let r=e[n.GradingScaleId];return Ca(Di(i),r)}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac})}}return t})();var Gi="events-evaluation-default-grade-update",_t=(()=>{class t{constructor(){this.gradingItemsRestService=m(ui),this.evaluationStateService=m(Ce),this.testStateService=m(oe),this.loadingService=m(te),this.updating=q(this.loadingService.loading(Gi),{requireSync:!0}),this.updateQueue$=new ae,this.subscription=this.updateQueue$.pipe(kt(e=>pe(this,null,function*(){return this.update(e)}))).subscribe()}ngOnDestroy(){this.subscription.unsubscribe()}update(e){return pe(this,null,function*(){let i=this.evaluationStateService.gradingItems().find(r=>r.Id===e.updateElement.Id);if(!i)return console.error("Grading item not found"),!1;let n;e.updateElement.type==="grade"?n=B($({},i),{IdGrade:e.updateElement.IdGrade}):n=B($({},i),{Comment:e.updateElement.Comment});try{return yield Ve(this.loadingService.load(this.gradingItemsRestService.update(n.Id,n),Gi)),this.testStateService.reload(),this.evaluationStateService.updateGradingItems(this.evaluationStateService.gradingItems().map(r=>r.Id===n.Id?n:r)),G(!0)}catch(r){return console.error("Error updating comment",r),G(!1)}})}updateDefaultGrade(e){return pe(this,null,function*(){let i=this.evaluationStateService.gradingItems().map(r=>B($({},r),{IdGrade:e})),n=this.evaluationStateService.event();if(!n)return console.error("No event selected"),!1;try{yield Ve(this.loadingService.load(this.gradingItemsRestService.updateForEvent(n.id,i),Gi)),this.testStateService.reload()}catch(r){return console.error("Error updating grades",r),!1}return this.evaluationStateService.updateGradingItems(i),!0})}updateGrade(e,i){this.updateQueue$.next({updateElement:{Id:e,IdGrade:i,Comment:null,type:"grade"}})}updateComment(e,i){this.updateQueue$.next({updateElement:{Id:e,IdGrade:null,Comment:i,type:"comment"}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac})}}return t})();var ya=(()=>{class t{constructor(){this.activeModal=m(Le),this.gradingScale=I.required(),this.selectedGradeKey=A(null),this.gradeOptions=y(()=>this.gradingScale().Grades.map(e=>({Key:e.Id,Value:e.Designation}))),this.selectedGrade=y(()=>{let e=this.selectedGradeKey();return this.gradingScale().Grades.find(i=>i.Id===e)??null})}updateGrades(){return pe(this,null,function*(){let e=this.selectedGrade();e&&(yield this.updateService.updateDefaultGrade(e.Id).then(()=>this.activeModal.close()))})}cancel(){this.activeModal.dismiss()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-evaluation-dialog"]],inputs:{gradingScale:[1,"gradingScale"]},decls:20,vars:19,consts:[[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"dropdown-row"],["for","grade"],["id","grade",3,"valueChange","options","value","allowEmpty"],[1,"info-text"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"h5",1),l(2),c(3,"translate"),d()(),o(4,"div",2)(5,"div",3)(6,"label",4),l(7),c(8,"translate"),d(),o(9,"bkd-select",5),K("valueChange",function(h){return U(n.selectedGradeKey,h)||(n.selectedGradeKey=h),h}),d()(),o(10,"p",6),l(11),c(12,"translate"),d()(),o(13,"div",7)(14,"button",8),M("click",function(){return n.cancel()}),l(15),c(16,"translate"),d(),o(17,"button",9),M("click",function(){return n.updateGrades()}),l(18),c(19,"translate"),d()()),i&2&&(a(2),v(" ",p(3,9,"evaluation.set-default-modal.title")," "),a(5),b(p(8,11,"evaluation.set-default-modal.grade")),a(2),g("options",n.gradeOptions()),z("value",n.selectedGradeKey),g("allowEmpty",!1),a(2),v(" ",p(12,13,"evaluation.set-default-modal.message")," "),a(4),v(" ",p(16,15,"evaluation.set-default-modal.cancel")," "),a(2),g("disabled",!n.selectedGrade()||n.updateService.updating()),a(),v(" ",p(19,17,"evaluation.set-default-modal.save")," "))},dependencies:[Ee,P],styles:[".dropdown-row[_ngcontent-%COMP%]{display:flex;align-items:center}.dropdown-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{flex:1}.dropdown-row[_ngcontent-%COMP%]   bkd-select[_ngcontent-%COMP%]{flex:1}.info-text[_ngcontent-%COMP%]{margin-top:1.5rem}"],changeDetection:0})}}return t})();var xa=t=>({returnlink:t}),Lr=t=>({count:t});function Gr(t,s){if(t&1&&(o(0,"button",4)(1,"i",7),l(2,"equalizer"),d()()),t&2){let e=u(2);g("routerLink","statistic")("queryParams",F(3,xa,e.queryParam()))("disabled",!e.hasGradeEntries())}}function Fr(t,s){if(t&1&&(o(0,"div",1),f(1,Gr,3,5,"button",4),S(2,"bkd-reports-link",5)(3,"div",6),d()),t&2){let e=u();a(),C(e.event().gradingScaleId!==null?1:-1),a(),g("reports",e.reports())}}var gi=(()=>{class t{constructor(){this.reportsService=m(pt),this.route=m(ve),this.state=m(Ce),this.hasGradeEntries=y(()=>this.state.entries().some(e=>(e.grade?.Value??0)>0)),this.event=I.required(),this.showActions=I(!0),this.queryParam=A(this.route.snapshot.queryParamMap.get("returnlink")),this.reports=q(Oe(this.event).pipe(T(e=>e.id),se(),L(e=>e?this.reportsService.getEvaluationReports(e):G([])),Me([]))),this.returnlink=y(()=>this.showActions()?this.queryParam()?this.queryParam():"/events":`/events/${this.event().id}/evaluation`)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-evaluation-header"]],inputs:{event:[1,"event"],showActions:[1,"showActions"]},decls:8,vars:12,consts:[[3,"link","params"],[1,"d-flex"],[1,"d-flex","flex-column","header"],[1,"additional-info"],[1,"btn","btn-primary","btn-icon","chart-btn",3,"routerLink","queryParams","disabled"],[1,"ms-2",3,"reports"],["id","excel-import"],[1,"material-icons"]],template:function(i,n){if(i&1&&(o(0,"bkd-backlink",0),f(1,Fr,4,2,"div",1),d(),o(2,"div",2)(3,"h1"),l(4),d(),o(5,"div",3),l(6),c(7,"translate"),d()()),i&2){g("link",n.returnlink())("params",n.queryParam()&&n.queryParam()!==n.returnlink()?F(8,xa,n.queryParam()):null),a(),C(n.showActions()?1:-1),a(3),b(n.event().designation);let r=n.event().studentCount;a(2),v(" ",H(7,5,r===1?"courses.registration":"courses.registrations",F(10,Lr,r))," ")}},dependencies:[Ke,ct,ne,P],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem;border-bottom:1px solid #dee2e6}h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}a[_ngcontent-%COMP%]{text-decoration:none;color:#fff}"],changeDetection:0})}}return t})();var Ea=(()=>{class t{constructor(){this.value=me(null),this.commit=We()}onInput(e){let{value:i}=e.target;this.value.set(i||null)}onBlur(){this.commit.emit(this.value()??null)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-grading-item-comment-textarea"]],inputs:{value:[1,"value"]},outputs:{value:"valueChange",commit:"commit"},decls:1,vars:1,consts:[["bkdTextareaAutosize","",1,"form-control",3,"input","blur","value"]],template:function(i,n){i&1&&(o(0,"textarea",0),M("input",function(h){return n.onInput(h)})("blur",function(){return n.onBlur()}),d()),i&2&&g("value",n.value()||"")},dependencies:[Yn],styles:["[_nghost-%COMP%]{display:block}textarea[_ngcontent-%COMP%]{min-width:30ch}@media(max-width:810px){textarea[_ngcontent-%COMP%]{min-width:auto}}"],changeDetection:0})}}return t})();var $r=576,Ye=(()=>{class t{constructor(){this.portal=m(qn),this.inlineHeader=I.required(),this.stickyHeader=I.required(),this.handleWindowScroll=()=>{this.updateStickyVisibility(),this.updateStickyTopOffset()},this.handleWindowResize=()=>{this.updateStickyWidth(),this.updateStickyVisibility(),this.updateStickyTopOffset()},this.handleTableScroll=()=>{this.updateStickyLeftOffset()}}ngAfterViewInit(){this.handleWindowScroll(),this.handleTableScroll(),this.handleWindowResize(),this.window.addEventListener("scroll",this.handleWindowScroll),this.getTableScrollContainer()?.addEventListener("scroll",this.handleTableScroll),this.window.addEventListener("resize",this.handleWindowResize)}ngOnDestroy(){this.window.removeEventListener("scroll",this.handleWindowScroll),this.getTableScrollContainer()?.removeEventListener("scroll",this.handleTableScroll),this.window.removeEventListener("resize",this.handleWindowResize)}refresh(){setTimeout(()=>this.updateStickyWidth())}get window(){return this.portal.window??window}getTableScrollContainer(){return document.querySelector(".table-responsive-wrapper")??null}updateStickyVisibility(){if(this.isSmallBreakpointDown())return;let e=this.inlineHeader().getTop()+this.getIframeScrollY();this.stickyHeader().shown.set(this.getScrollTop()>e)}updateStickyTopOffset(){this.isSmallBreakpointDown()||this.stickyHeader().setTopOffset(this.portal.inIframe?this.getScrollTop():0)}updateStickyLeftOffset(){this.isSmallBreakpointDown()||this.stickyHeader().setLeftOffset(this.inlineHeader().getLeft())}updateStickyWidth(){this.isSmallBreakpointDown()||(this.stickyHeader().setWidth(this.inlineHeader().getWidth()),this.stickyHeader().setColumnWidths(this.inlineHeader().getColumnWidths()),this.stickyHeader().setStickyColumnHeights(this.inlineHeader().getStickyColumnsHeights()))}getScrollTop(){return this.window.scrollY-this.portal.getIframeTop()}getIframeScrollY(){return window.scrollY}isSmallBreakpointDown(){return window.innerWidth<$r}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=Ui({type:t,selectors:[["","bkdTableHeaderSticky",""]],inputs:{inlineHeader:[1,"inlineHeader"],stickyHeader:[1,"stickyHeader"]}})}}return t})();var Vr=(t,s)=>s.detail.Id;function Nr(t,s){if(t&1){let e=D();o(0,"bkd-subscription-detail-field",4),K("valueChange",function(n){let r=E(e).$implicit;return U(r.value,n)||(r.value=n),w(n)}),M("commit",function(){let n=E(e).$implicit,r=u(2);return w(r.subscriptionDetailChange.emit(n))}),d()}if(t&2){let e,i=s.$implicit,n=u(2);Y("hide-for-mobile",((e=n.headingDetail())==null?null:e.Id)===i.detail.Id),g("detail",i.detail)("layout","horizontal"),z("value",i.value)}}function Br(t,s){if(t&1&&(o(0,"div",2),V(1,Nr,1,5,"bkd-subscription-detail-field",3,Vr),d()),t&2){let e=u();a(),N(e.entry().criteria)}}var wa=(()=>{class t{constructor(){this.translate=m(ee),this.entry=I.required(),this.visible=me.required(),this.subscriptionDetailChange=We(),this.heading=y(()=>this.headingDetail()?.VssDesignation??this.translate.instant("evaluation.set-criteria")),this.headingDetail=y(()=>this.entry().criteria.find(e=>e.detail.VssStyle==="HE")?.detail)}get visibleClass(){return this.visible()}toggle(){this.visible.update(e=>!e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-evaluation-criteria"]],hostVars:2,hostBindings:function(i,n){i&2&&Y("criteria-visible",n.visibleClass)},inputs:{entry:[1,"entry"],visible:[1,"visible"]},outputs:{visible:"visibleChange",subscriptionDetailChange:"subscriptionDetailChange"},decls:6,vars:3,consts:[[1,"btn","btn-link","criteria-toggle",3,"click"],[1,"material-icons"],[1,"criteria-container"],[3,"detail","hide-for-mobile","layout","value"],[3,"valueChange","commit","detail","layout","value"]],template:function(i,n){i&1&&(o(0,"button",0),M("click",function(){return n.toggle()}),o(1,"i",1),l(2),d(),o(3,"span"),l(4),d()(),f(5,Br,3,0,"div",2)),i&2&&(a(2),b(n.visible()?"keyboard_arrow_up":"keyboard_arrow_down"),a(2),b(n.heading()),a(),C(n.visible()?5:-1))},dependencies:[li],styles:["[_nghost-%COMP%]{display:block;padding:0 1rem 1rem}.criteria-toggle[_ngcontent-%COMP%]{display:flex;padding-left:0;padding-right:0;color:#00000080}.criteria-toggle[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.25rem}.criteria-toggle[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.criteria-toggle[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.criteria-container[_ngcontent-%COMP%]{margin-top:1rem;display:flex;flex-direction:column;gap:1rem}@media(max-width:810px){.hide-for-mobile[_ngcontent-%COMP%]{display:none}}@media(min-width:811px){[_nghost-%COMP%]:not(.criteria-visible){padding:0}.criteria-toggle[_ngcontent-%COMP%]{display:none}.criteria-container[_ngcontent-%COMP%]{margin-top:0;gap:.5rem}}"],changeDetection:0})}}return t})();var Ta=an([nn({IsDelete:tn}),at({IdStatus:Ue,Status:Ze})]);var bt=(()=>{class t{constructor(){this.http=m(Ie),this.settings=m(fe),this.loadingService=m(te),this.baseUrl=`${this.settings.apiUrl}/StatusProcesses/`}forwardStatus(e,i){return pe(this,null,function*(){try{let n=yield Ve(this.loadingService.load(this.getStatus(e),we));return n?(yield Ve(this.loadingService.load(this.updateNextStatus(n,i),we)),!0):(console.error("No next status found"),!1)}catch(n){return console.error("Error updating status",n),!1}})}getStatusList(e){return this.loadStatus(e).pipe(T(i=>(i=i.filter(n=>!n.IsDelete),[...new Map(i.map(n=>[n.IdStatus,n])).values()])))}updateStatus(e,i,n,r){return this.http.post(this.baseUrl,{DataClassId:e,Id1:i,Id2:n,IdStatus:r})}getStatus(e){return this.http.get(`${this.baseUrl}forward/`,{params:new nt().set("idStatus",e.toString())}).pipe(T(i=>Array.isArray(i)&&i.length>0?i[0]:null))}loadStatus(e){return this.loadingService.load(this.http.get(`${this.baseUrl}/`,{params:new nt().set("idStatus",e.toString())}).pipe(L(Jt(Ta))),we)}updateNextStatus(e,i){return this.http.post(this.baseUrl,B($({},e),{DataClassId:"Anlass",Id1:i}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Rr(t,s){t&1&&(Q(0,"div",3)(1,"i",8),l(2,"info"),J(),Q(3,"p",9),l(4),c(5,"translate"),J()()),t&2&&(a(4),v(" ",p(5,1,"evaluation.finalise-modal.open-evaluations")," "))}function Ar(t,s){t&1&&(Q(0,"p",4),l(1),c(2,"translate"),J()),t&2&&(a(),v(" ",p(2,1,"evaluation.finalise-modal.note")," "))}var Hr=3,Ma=(()=>{class t{constructor(){this.activeModal=m(Le),this.eventsService=m(gt),this.loadingService=m(te),this.evaluationStatusService=m(bt),this.eventId=A(null),this.hasOpenEvaluations=A(!1),this.loading=q(this.loadingService.loading(we),{initialValue:!0}),this.eventSummary=q(Oe(this.eventId).pipe(L(e=>e?this.loadEventSummary(e):G(null))),{initialValue:null}),this.isModuleEvent=y(()=>this.eventSummary()?.EventTypeId===Hr)}loadEventSummary(e){return this.loadingService.load(this.eventsService.getEventSummary(e),we)}cancel(){this.activeModal.dismiss()}confirm(){return pe(this,null,function*(){this.isModuleEvent()?yield this.updateModuleEventStatus():this.activeModal.close(!0)})}updateModuleEventStatus(){return pe(this,null,function*(){let e=this.eventSummary();if(!e)throw new Error("No event available");try{yield this.evaluationStatusService.forwardStatus(e.StatusId,e.Id),this.activeModal.close(!0)}catch(i){console.error("Error updating module event status",i),this.activeModal.close(!1)}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-evaluation-finalise-dialog"]],decls:17,vars:15,consts:[[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"text-danger","d-flex","my-3"],[1,"module-event-notice"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"material-icons","me-2"],[1,"mb-0"]],template:function(i,n){i&1&&(Q(0,"div",0)(1,"h5",1),l(2),c(3,"translate"),J()(),Q(4,"div",2),f(5,Rr,6,3,"div",3),Q(6,"p"),l(7),c(8,"translate"),J(),f(9,Ar,3,3,"p",4),J(),Q(10,"div",5)(11,"button",6),$e("click",function(){return n.cancel()}),l(12),c(13,"translate"),J(),Q(14,"button",7),$e("click",function(){return n.confirm()}),l(15),c(16,"translate"),J()()),i&2&&(a(2),v(" ",p(3,7,"evaluation.finalise-modal.title")," "),a(3),C(n.hasOpenEvaluations()?5:-1),a(2),v(" ",p(8,9,"evaluation.finalise-modal.message")," "),a(2),C(n.isModuleEvent()?9:-1),a(3),v(" ",p(13,11,"evaluation.finalise-modal.cancel")," "),a(2),$t("disabled",n.loading()),a(),v(" ",p(16,13,"evaluation.finalise-modal.confirm")," "))},dependencies:[P],encapsulation:2,changeDetection:0})}}return t})();var Wr=1e3,Pa=(()=>{class t{constructor(){this.options=I.required(),this.value=I.required(),this.valueChange=We(),this.valueSubject=new ae,this.destroy$=new ae,this.valueSubject.pipe(Dt(Wr),Pe(this.destroy$)).subscribe(e=>{this.valueChange.emit(e)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onValueChange(e){this.valueSubject.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-evaluation-grade"]],inputs:{options:[1,"options"],value:[1,"value"]},outputs:{valueChange:"valueChange"},decls:1,vars:3,consts:[["id","grade",3,"valueChange","options","value","width"]],template:function(i,n){i&1&&(o(0,"bkd-select",0),M("valueChange",function(h){return n.onValueChange(h)}),d()),i&2&&g("options",n.options())("value",n.value())("width","100%")},dependencies:[Ee],encapsulation:2,changeDetection:0})}}return t})();var hi=(()=>{class t{get stickyClass(){return this.sticky()}constructor(){this.element=m(ji),this.sticky=I(!1),this.shown=A(!1),Lt(this.updateShownClass.bind(this))}getTop(){return this.element.nativeElement.getBoundingClientRect().top}getLeft(){return this.element.nativeElement.getBoundingClientRect().left}setTopOffset(e){this.element.nativeElement.style.top=`${e}px`}setLeftOffset(e){this.element.nativeElement.style.left=`${e}px`}getWidth(){return this.element.nativeElement.getBoundingClientRect().width}setWidth(e){this.element.nativeElement.style.width=`${e}px`}getColumnWidths(){return this.getRowsAndColumns().map(e=>e.map(i=>i.getBoundingClientRect().width))}setColumnWidths(e){let i=this.getRowsAndColumns();if(i.length!==e.length||!i.every((n,r)=>n.length===e[r].length))throw new Error("Given column widths do not match number of header rows/columns");i.forEach((n,r)=>n.forEach((h,x)=>{h.style.width=`${e[r][x]}px`,h.style.minWidth=`${e[r][x]}px`}))}getStickyColumnsHeights(){return this.getRowsAndColumns(".sticky").map(e=>e.map(i=>i.getBoundingClientRect().height))}setStickyColumnHeights(e){let i=this.getRowsAndColumns(".sticky");if(i.length!==e.length||!i.every((n,r)=>n.length===e[r].length))throw new Error("Given column heights do not match number of sticky header columns");i.forEach((n,r)=>n.forEach((h,x)=>{h.style.height=`${e[r][x]}px`})),this.getRows().forEach((n,r)=>{let h=e[r].reduce((x,j)=>Math.max(x,j),0);n.style.height=`${h}px`})}updateShownClass(){let e=this.element.nativeElement.classList;this.shown()?e.add("shown"):e.remove("shown")}getRowsAndColumns(e){return this.getRows().map(i=>Array.from(i.querySelectorAll(`th:not(.header-mobile)${e??""}`)))}getRows(){return Array.from(this.element.nativeElement.querySelectorAll("tr"))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["ng-component"]],hostVars:2,hostBindings:function(i,n){i&2&&Y("sticky",n.stickyClass)},inputs:{sticky:[1,"sticky"]},decls:0,vars:0,template:function(i,n){},encapsulation:2})}}return t})();var jr=["bkdEvaluationTableHeader",""],Ur=(t,s)=>s.vssId;function qr(t,s){if(t&1){let e=D();o(0,"th",5)(1,"bkd-sortable-header",1),c(2,"translate"),K("sortCriteriaChange",function(n){E(e);let r=u();return U(r.sortCriteria,n)||(r.sortCriteria=n),w(n)}),d()()}if(t&2){let e=u();Y("selected",e.gradeColumnSelected()),a(),g("label",p(2,5,"evaluation.columns.grade"))("sortKey","grade"),z("sortCriteria",e.sortCriteria)}}function zr(t,s){if(t&1&&(o(0,"th",6),l(1),d()),t&2){let e=s.$implicit,i=u();Y("selected",i.isColumnSelected(e)),g("title",e.tooltip??""),a(),v(" ",e.title," ")}}function Kr(t,s){if(t&1&&(o(0,"th",7),l(1),c(2,"translate"),d()),t&2){let e=u();Y("selected",e.commentColumnSelected()),a(),v(" ",p(2,3,"evaluation.columns.comment")," ")}}var Ia=(()=>{class t extends hi{constructor(){super(...arguments),this.columns=I.required(),this.sortCriteria=me.required(),this.selectedColumn=I.required(),this.hasGrades=I.required(),this.hasGradeComments=I(!1),this.gradeColumnSelected=y(()=>this.selectedColumn()===-1),this.commentColumnSelected=y(()=>this.selectedColumn()===-2)}isColumnSelected(e){return e.vssId===this.selectedColumn()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=Gt(t)))(n||t)}})()}static{this.\u0275cmp=_({type:t,selectors:[["thead","bkdEvaluationTableHeader",""]],inputs:{columns:[1,"columns"],sortCriteria:[1,"sortCriteria"],selectedColumn:[1,"selectedColumn"],hasGrades:[1,"hasGrades"],hasGradeComments:[1,"hasGradeComments"]},outputs:{sortCriteria:"sortCriteriaChange"},features:[Ft],attrs:jr,decls:8,vars:7,consts:[[1,"student-name"],[3,"sortCriteriaChange","label","sortKey","sortCriteria"],[1,"student-grade","desktop",3,"selected"],[1,"subscription-detail",3,"selected","title"],[1,"student-comment","desktop",3,"selected"],[1,"student-grade","desktop"],[1,"subscription-detail",3,"title"],[1,"student-comment","desktop"]],template:function(i,n){i&1&&(o(0,"tr")(1,"th",0)(2,"bkd-sortable-header",1),c(3,"translate"),K("sortCriteriaChange",function(h){return U(n.sortCriteria,h)||(n.sortCriteria=h),h}),d()(),f(4,qr,3,7,"th",2),V(5,zr,2,4,"th",3,Ur),f(7,Kr,3,5,"th",4),d()),i&2&&(a(2),g("label",p(3,5,"evaluation.columns.name"))("sortKey","name"),z("sortCriteria",n.sortCriteria),a(2),C(n.hasGrades()?4:-1),a(),N(n.columns()),a(2),C(n.hasGradeComments()?7:-1))},dependencies:[ht,P],styles:["[_nghost-%COMP%]{--spacer: 16px;--grade-input-size: 17ch;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) )}@media(min-width:1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media(max-width:810px){th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%], th.subscription-detail[_ngcontent-%COMP%], td.subscription-detail[_ngcontent-%COMP%]{width:66%;min-width:66%;max-width:66%}}@media(max-width:500px){th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%], th.subscription-detail[_ngcontent-%COMP%], td.subscription-detail[_ngcontent-%COMP%]{width:50%;min-width:50%;max-width:50%}}th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media(max-width:810px){th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}@media(max-width:810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-comment[_ngcontent-%COMP%]:not(.selected), .subscription-detail[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%], tfoot[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.student-grade[_ngcontent-%COMP%], .subscription-detail[_ngcontent-%COMP%], .student-comment[_ngcontent-%COMP%]{flex:none;display:block;width:50%}}@media(min-width:811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}}.sticky[_nghost-%COMP%]{position:fixed;top:0;left:0;z-index:1000;display:none}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;vertical-align:top}tr[_ngcontent-%COMP%]   th.subscription-detail.absences[_ngcontent-%COMP%]{flex:1}@media(min-width:811px){.sticky.shown[_nghost-%COMP%]{display:table-header-group}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;padding-top:.25rem;padding-bottom:.25rem;border-top:initial}}"],changeDetection:0})}}return t})();var Yr=t=>["student",t,"grades"],Qr=(t,s)=>s.gradingItem.Id,Xr=(t,s)=>s.vssId;function Zr(t,s){if(t&1){let e=D();o(0,"button",18),M("click",function(){E(e);let n=u().$implicit,r=u();return w(r.toggleCriteria(n))}),o(1,"i",19),l(2),d()()}if(t&2){let e=u().$implicit,i=u();a(2),b(i.isCriteriaVisible(e)()?"keyboard_arrow_up":"keyboard_arrow_down")}}function Jr(t,s){t&1&&(o(0,"span",13),l(1),c(2,"translate"),d()),t&2&&(a(),v(" ",p(2,1,"evaluation.required")," "))}function eo(t,s){if(t&1){let e=D();o(0,"td",20)(1,"bkd-evaluation-grade",21),M("valueChange",function(n){E(e);let r=u().$implicit,h=u();return w(h.updateGrade(n,r.gradingItem.Id))}),d()()}if(t&2){let e=u().$implicit,i=u();Y("selected",i.gradeColumnSelected()),a(),g("options",i.gradeOptions())("value",e.gradingItem.IdGrade)}}function to(t,s){if(t&1){let e=D();R(0),o(1,"bkd-subscription-detail-field",24),K("valueChange",function(n){E(e);let r=O(0);return U(r,n),w(n)}),M("commit",function(){E(e);let n=u().$implicit,r=u(2);return w(r.subscriptionDetailChange.emit(n))}),d()}if(t&2){let e=u().$implicit,i=W(u(2).getDetailValue(e));a(),g("detail",e.detail)("hideLabel",!0)("layout","horizontal"),z("value",i)}}function io(t,s){if(t&1&&(o(0,"td",22),f(1,to,2,5,"bkd-subscription-detail-field",23),d()),t&2){let e=s.$implicit,i=u(2);Y("selected",i.isColumnSelected(e)),a(),C(e?1:-1)}}function no(t,s){if(t&1){let e=D();o(0,"td",25)(1,"bkd-grading-item-comment-textarea",26),K("valueChange",function(n){E(e);let r=u().$implicit;return U(r.gradingItem.Comment,n)||(r.gradingItem.Comment=n),w(n)}),M("commit",function(n){E(e);let r=u().$implicit,h=u();return w(h.updateComment(n,r.gradingItem.Id))}),d()()}if(t&2){let e=u().$implicit,i=u();Y("selected",i.commentColumnSelected()),a(),z("value",e.gradingItem.Comment)}}function ao(t,s){if(t&1){let e=D();o(0,"tr",17)(1,"td"),R(2),o(3,"bkd-evaluation-criteria",27),K("visibleChange",function(n){E(e);let r=O(2);return U(r,n),w(n)}),M("subscriptionDetailChange",function(n){E(e);let r=u(2);return w(r.subscriptionDetailChange.emit(n))}),d()()()}if(t&2){let e=u().$implicit,i=u();a(),Se("colspan",i.totalColumns()),a();let n=W(i.isCriteriaVisible(e));a(),g("entry",e),z("visible",n)}}function ro(t,s){if(t&1){let e=D();o(0,"tr",8),M("click",function(n){E(e);let r=u();return w(r.onRowClick(n))}),o(1,"td",9)(2,"div",10),f(3,Zr,3,1,"button",11),o(4,"a",12)(5,"span"),l(6),d(),f(7,Jr,3,3,"span",13),d()()(),f(8,eo,2,4,"td",14),V(9,io,2,3,"td",15,zi),f(11,no,2,3,"td",16),d(),f(12,ao,4,4,"tr",17)}if(t&2){let e=s.$implicit,i=u();a(3),C(e.criteria.length>0?3:-1),a(),g("routerLink",F(7,Yr,e.gradingItem.IdPerson)),a(2),b(e.gradingItem.PersonFullname),a(),C(e.evaluationRequired?7:-1),a(),C(i.hasGrades()?8:-1),a(),N(e.columns),a(2),C(i.hasGradeComments()?11:-1),a(),C(e.criteria.length>0?12:-1)}}function oo(t,s){if(t&1&&S(0,"td",22),t&2){let e=s.$implicit,i=u(2);Y("selected",i.isColumnSelected(e))}}function so(t,s){if(t&1&&S(0,"td",25),t&2){let e=u(2);Y("selected",e.commentColumnSelected())}}function lo(t,s){if(t&1&&(o(0,"td",9),l(1),c(2,"translate"),d(),o(3,"td",20),l(4),c(5,"decimalOrDash"),d(),V(6,oo,1,2,"td",15,Xr),f(8,so,1,2,"td",16)),t&2){let e=u();a(),v(" ",p(2,5,"evaluation.average")," "),a(2),Y("selected",e.gradeColumnSelected()),a(),v(" ",H(5,7,e.gradesAverage(),"1-3")," "),a(2),N(e.columns()),a(2),C(e.hasGradeComments()?8:-1)}}var ka=(()=>{class t{constructor(){this.state=m(Ce),this.gradingItemUpdateService=m(_t),this.subscriptionDetailUpdateService=m(Ct),this.modalService=m(Fe),this.router=m(De),this.sortCriteria=me.required(),this.selectedColumn=I.required(),this.columns=I.required(),this.entries=I.required(),this.hasGrades=I.required(),this.hasGradeComments=I.required(),this.subscriptionDetailChange=We(),this.gradingScale=I.required(),this.gradeColumnSelected=y(()=>this.selectedColumn()===-1),this.commentColumnSelected=y(()=>this.selectedColumn()===-2),this.gradesAverage=y(()=>this.getGradesAverage(this.entries())),this.totalColumns=y(()=>1+(this.hasGrades()?1:0)+(this.hasGradeComments()?1:0)+this.columns().length),this.hasPendingRequests=y(()=>this.gradingItemUpdateService.updating()||this.subscriptionDetailUpdateService.updating()),this.criteriaVisibilities=Xe({source:this.entries,computation:(e,i)=>e.reduce((n,r)=>{let h=i?.value&&i.value[r.gradingItem.Id]||A(!1);return B($({},n),{[r.gradingItem.Id]:h})},{})}),this.sticky=At(Ye),this.gradeOptions=y(()=>this.gradingScale()?.Grades.map(e=>({Key:e.Id,Value:e.Designation}))),Lt(()=>{this.columns(),this.sticky()?.refresh()})}isColumnSelected(e){return e?this.getColumnKey(e)===this.selectedColumn():!1}getDetailValue(e){return e?e.value??A(null):A(null)}isCriteriaVisible(e){return this.criteriaVisibilities()[e.gradingItem.Id]??A(!1)}toggleCriteria(e){this.criteriaVisibilities()[e.gradingItem.Id]?.update(i=>!i)}onRowClick(e){let i=e.target;i.tagName==="TD"&&i.closest("tr")?.querySelector("button.criteria-toggle")?.click()}getColumnKey(e){return"detail"in e?e.detail.VssId:e.vssId}getGradesAverage(e){let i=e.map(({grade:n})=>n?.Value).filter(n=>n!=null&&n!==0);return wt(i)}updateGrade(e,i){this.gradingItemUpdateService.updateGrade(i,e)}updateComment(e,i){this.gradingItemUpdateService.updateComment(i,e)}openFinaliseEvaluationDialog(){let e=this.modalService.open(Ma),i=e.componentInstance;i.eventId.set(this.state.event()?.id??null);let n=this.entries().some(r=>r.evaluationRequired);i.hasOpenEvaluations.set(n),e.result.then(r=>pe(this,null,function*(){r&&(yield this.router.navigate(["events"]))}),()=>{})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-evaluation-table"]],viewQuery:function(i,n){i&1&&Bt(n.sticky,Ye,5),i&2&&Rt()},inputs:{sortCriteria:[1,"sortCriteria"],selectedColumn:[1,"selectedColumn"],columns:[1,"columns"],entries:[1,"entries"],hasGrades:[1,"hasGrades"],hasGradeComments:[1,"hasGradeComments"],gradingScale:[1,"gradingScale"]},outputs:{sortCriteria:"sortCriteriaChange",subscriptionDetailChange:"subscriptionDetailChange"},decls:16,vars:20,consts:[["inlineHeader",""],["stickyHeader",""],[1,"table-responsive-wrapper"],["bkdTableHeaderSticky","",1,"table","table-hover","h-100",3,"inlineHeader","stickyHeader"],["bkdEvaluationTableHeader","",3,"sortCriteriaChange","columns","sortCriteria","selectedColumn","hasGrades","hasGradeComments"],["bkdEvaluationTableHeader","",3,"sortCriteriaChange","sticky","columns","sortCriteria","selectedColumn","hasGrades","hasGradeComments"],[1,"action-buttons"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[3,"click"],[1,"student-name"],[1,"d-flex"],[1,"btn","btn-link","criteria-toggle"],[3,"routerLink"],[1,"open-evaluations"],[1,"student-grade",3,"selected"],[1,"subscription-detail",3,"selected"],[1,"student-comment",3,"selected"],[1,"criteria"],[1,"btn","btn-link","criteria-toggle",3,"click"],[1,"material-icons"],[1,"student-grade"],[3,"valueChange","options","value"],[1,"subscription-detail"],[3,"detail","hideLabel","layout","value"],[3,"valueChange","commit","detail","hideLabel","layout","value"],[1,"student-comment"],[3,"valueChange","commit","value"],[3,"visibleChange","subscriptionDetailChange","entry","visible"]],template:function(i,n){if(i&1){let r=D();o(0,"div",2)(1,"table",3)(2,"thead",4,0),K("sortCriteriaChange",function(x){return E(r),U(n.sortCriteria,x)||(n.sortCriteria=x),w(x)}),d(),o(4,"thead",5,1),K("sortCriteriaChange",function(x){return E(r),U(n.sortCriteria,x)||(n.sortCriteria=x),w(x)}),d(),o(6,"tbody"),V(7,ro,13,9,null,null,Qr),d(),o(9,"tfoot")(10,"tr"),f(11,lo,9,10),d()()(),o(12,"div",6)(13,"button",7),M("click",function(){return E(r),w(n.openFinaliseEvaluationDialog())}),l(14),c(15,"translate"),d()()()}if(i&2){let r=ye(3),h=ye(5);a(),g("inlineHeader",r)("stickyHeader",h),a(),g("columns",n.columns()),z("sortCriteria",n.sortCriteria),g("selectedColumn",n.selectedColumn())("hasGrades",n.hasGrades())("hasGradeComments",n.hasGradeComments()),a(2),g("sticky",!0)("columns",n.columns()),z("sortCriteria",n.sortCriteria),g("selectedColumn",n.selectedColumn())("hasGrades",n.hasGrades())("hasGradeComments",n.hasGradeComments()),a(3),N(n.entries()),a(4),C(n.hasGrades()?11:-1),a(),Y("mobile-finalise-visible",n.gradeColumnSelected()||!n.hasGrades()),a(),g("disabled",n.hasPendingRequests()),a(),v(" ",p(15,18,"evaluation.finalise")," ")}},dependencies:[ne,Ia,Ye,li,wa,Pa,Ea,P,ri],styles:["[_nghost-%COMP%]{--spacer: 16px;--grade-input-size: 17ch;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) )}@media(min-width:1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media(max-width:810px){th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%], th.subscription-detail[_ngcontent-%COMP%], td.subscription-detail[_ngcontent-%COMP%]{width:66%;min-width:66%;max-width:66%}}@media(max-width:500px){th.student-grade[_ngcontent-%COMP%], td.student-grade[_ngcontent-%COMP%], th.subscription-detail[_ngcontent-%COMP%], td.subscription-detail[_ngcontent-%COMP%]{width:50%;min-width:50%;max-width:50%}}th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media(max-width:810px){th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}@media(max-width:810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-comment[_ngcontent-%COMP%]:not(.selected), .subscription-detail[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%], tfoot[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.student-grade[_ngcontent-%COMP%], .subscription-detail[_ngcontent-%COMP%], .student-comment[_ngcontent-%COMP%]{flex:none;display:block;width:50%}}@media(min-width:811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}}[_nghost-%COMP%]{border-top:1px solid #dee2e6;display:block}td[_ngcontent-%COMP%]{vertical-align:top}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]{padding-top:1.25rem}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;gap:.25rem;text-decoration:none;font-size:1rem;line-height:1.25;height:2.59375rem}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{text-decoration:underline}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span.open-evaluations[_ngcontent-%COMP%]{color:#ea161f;font-size:.875rem;line-height:1.25}tr.criteria[_ngcontent-%COMP%]:hover > *[_ngcontent-%COMP%]{--bs-table-bg-state: $table-body-bg}tr.criteria[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:0;width:100%}tr.criteria[_ngcontent-%COMP%]   td[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}tr[_ngcontent-%COMP%]:has(+tr.criteria)   td[_ngcontent-%COMP%]{border-bottom:0}button.criteria-toggle[_ngcontent-%COMP%]{display:none}.action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:1rem;padding-right:1rem}@media(min-width:811px){.table-responsive-wrapper[_ngcontent-%COMP%]{display:block;overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.action-buttons[_ngcontent-%COMP%]{position:sticky;left:0}tr.criteria[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{width:auto}button.criteria-toggle[_ngcontent-%COMP%]{flex:none;display:block;margin:-.5rem 0 -.5rem -.5rem;padding:.5rem;cursor:pointer}  bkd-subscription-detail-label{min-width:auto!important;width:calc(var(--student-name-column-width) - 1rem)!important}}@media(max-width:810px){.action-buttons[_ngcontent-%COMP%]:not(.mobile-finalise-visible){display:none}}"],changeDetection:0})}}return t})();var co=t=>({"grade-column-selected":t});function po(t,s){t&1&&S(0,"bkd-spinner")}function mo(t,s){t&1&&(o(0,"p",1),l(1),c(2,"translate"),d()),t&2&&(a(),b(p(2,1,"evaluation.no-event")))}function uo(t,s){t&1&&(o(0,"p",1),l(1),c(2,"translate"),d()),t&2&&(a(),b(p(2,1,"evaluation.no-items")))}function go(t,s){t&1&&(o(0,"p",1),l(1),c(2,"translate"),d()),t&2&&(a(),b(p(2,1,"evaluation.no-evaluation")))}function ho(t,s){t&1&&(o(0,"p",1),l(1),c(2,"translate"),d()),t&2&&(a(),v(" ",p(2,1,"evaluation.review-started")," "))}function vo(t,s){if(t&1){let e=D();o(0,"bkd-select",6),K("valueChange",function(n){E(e);let r=u(4);return U(r.selectedColumn,n)||(r.selectedColumn=n),w(n)}),d()}if(t&2){let e=u(4);g("options",e.columnOptions()),z("value",e.selectedColumn),g("allowEmpty",!1)}}function fo(t,s){if(t&1){let e=D();o(0,"a",7),M("click",function(){E(e);let n=u(4);return w(n.openDefaultGradeDialog())}),o(1,"i",8),l(2,"edit"),d(),o(3,"span"),l(4),c(5,"translate"),d()()}if(t&2){let e=u(4);g("ngClass",F(4,co,e.selectedColumn()===e.GRADE_COLUMN)),a(4),b(p(5,2,"evaluation.set-default-modal.title"))}}function Co(t,s){if(t&1){let e=D();f(0,vo,1,3,"bkd-select",3),f(1,fo,6,6,"a",4),o(2,"bkd-evaluation-table",5),K("sortCriteriaChange",function(n){E(e);let r=u(3);return U(r.state.sortCriteria,n)||(r.state.sortCriteria=n),w(n)}),M("subscriptionDetailChange",function(n){E(e);let r=u(3);return w(r.updateSubscriptionDetail(n))}),d()}if(t&2){u();let e=O(1),i=u(2);C(i.columnOptions().length>1?0:-1),a(),C(i.hasGrades()?1:-1),a(),z("sortCriteria",i.state.sortCriteria),g("columns",i.state.columns())("entries",e)("selectedColumn",i.selectedColumn())("hasGrades",i.hasGrades())("hasGradeComments",i.hasGradeComments())("gradingScale",i.state.gradingScale())}}function _o(t,s){if(t&1&&(S(0,"bkd-evaluation-header",2),R(1),f(2,uo,3,3,"p",1)(3,go,3,3,"p",1)(4,ho,3,3,"p",1)(5,Co,3,9)),t&2){let e=u(2),i=O(0);g("event",i),a();let n=W(e.state.entries());a(),C(n.length===0?2:e.state.noEvaluation()?3:e.state.hasReviewStarted()?4:5)}}function bo(t,s){if(t&1&&f(0,_o,6,3),t&2){u();let e=O(0);C(e?0:-1)}}var Da=(()=>{class t{constructor(){this.state=m(Ce),this.updateDefaultGradeService=m(_t),this.updateSubscriptionDetailService=m(Ct),this.translate=m(ee),this.modalService=m(Fe),this.GRADE_COLUMN=-1,this.hasGrades=y(()=>this.state.gradingScale()!==null),this.hasGradeComments=y(()=>this.state.gradingScale()?.CommentsAllowed===!0),this.columnOptions=y(()=>{let e={Key:-1,Value:this.translate.instant("evaluation.columns.grade")},i={Key:-2,Value:this.translate.instant("evaluation.columns.comment")},n=Zt(this.state.columns().map(({vssId:r,title:h})=>({Key:r,Value:h})),r=>r.Key);return[this.hasGrades()?e:null,...n,this.hasGradeComments()?i:null].filter(Ge)}),this.selectedColumn=Xe({source:this.columnOptions,computation:(e,i)=>{let n=i?.source,r=i?.value;return Xt(e,n)&&r&&e.find(h=>h.Key===r)?r:e.length>0?Number(e[0].Key):null}})}openDefaultGradeDialog(){let e=this.modalService.open(ya);e.componentInstance.gradingScale=this.state.gradingScale,e.componentInstance.updateService=this.updateDefaultGradeService,e.result.then(()=>{},()=>{})}updateSubscriptionDetail(e){this.updateSubscriptionDetailService.updateSubscriptionDetail(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-evaluation-list"]],decls:5,vars:2,consts:[[1,"bkd-container"],[1,"mt-3","px-3"],[3,"event"],["width","100%",1,"columns-dropdown",3,"options","value","allowEmpty"],[1,"set-default","btn","btn-link","my-1",3,"ngClass"],[3,"sortCriteriaChange","subscriptionDetailChange","sortCriteria","columns","entries","selectedColumn","hasGrades","hasGradeComments","gradingScale"],["width","100%",1,"columns-dropdown",3,"valueChange","options","value","allowEmpty"],[1,"set-default","btn","btn-link","my-1",3,"click","ngClass"],[1,"material-icons"]],template:function(i,n){if(i&1&&(R(0),o(1,"div",0),f(2,po,1,0,"bkd-spinner")(3,mo,3,3,"p",1)(4,bo,1,1),d()),i&2){let r=W(n.state.event());a(2),C(n.state.loading()?2:r?4:3)}},dependencies:[gi,ka,de,Ee,he,P],styles:[".columns-dropdown[_ngcontent-%COMP%]{display:block;padding:1rem 0}.set-default[_ngcontent-%COMP%]{color:#00000080;padding-right:1.5rem;display:flex;width:max-content;text-decoration:none;padding-left:1rem}.set-default[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.set-default[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.set-default[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.3em}@media(min-width:811px){.columns-dropdown[_ngcontent-%COMP%]{display:none}}@media(max-width:810px){.set-default[_ngcontent-%COMP%]:not(.grade-column-selected){display:none}}"],changeDetection:0})}}return t})();var So=["chartWrapper"],yo=["chartLegend"],xo=["xAxisLabel"],Oa=t=>({"margin-left":t}),La=(t,s)=>s.text,Eo=(t,s)=>s.value,wo=(t,s)=>s.text+"-"+s.x;function To(t,s){if(t&1&&(o(0,"div",6),et(),o(1,"svg",15),S(2,"rect",15),d(),Ei(),o(3,"span",12),l(4),d()()),t&2){let e=s.$implicit;a(2),Se("class",e.colorClass),a(2),v(" ",e.text," ")}}function Mo(t,s){if(t&1&&(et(),S(0,"rect")),t&2){let e=s.$implicit;Se("x",e.x)("y",e.y)("width",e.width)("height",e.height)("class",e.colorClass)}}function Po(t,s){if(t&1&&(et(),o(0,"text",11),l(1),d()),t&2){let e=s.$implicit;Se("x",e.x)("y",e.y),a(),v(" ",e.text," ")}}function Io(t,s){if(t&1&&(et(),o(0,"text",12),l(1),d()),t&2){let e=s.$implicit;Se("x",e.x)("y",e.y)("text-anchor",e.textAnchor),a(),v(" ",e.text," ")}}function ko(t,s){if(t&1&&(o(0,"div",5,0),V(2,To,5,2,"div",6,La),d(),o(4,"div",7,1)(6,"div",8),et(),o(7,"svg")(8,"g"),S(9,"line",9)(10,"line",10),V(11,Mo,1,5,":svg:rect",null,Eo),V(13,Po,2,3,":svg:text",11,wo),V(15,Io,2,4,":svg:text",12,La),o(17,"text",13),l(18),c(19,"translate"),d()()()()(),Ei(),o(20,"div",14,2)(22,"span",12),l(23),c(24,"translate"),d()()),t&2){let e=u();g("ngClass",e.overflowClass())("ngStyle",F(20,Oa,e.isOverflowing()?"unset":e.legendPosition()+"px")),a(2),N(e.legendLabels()),a(5),Se("width",e.renderedChartWidth())("viewBox",e.viewBox()),a(),Se("transform","translate("+e.chartMargin().left+","+e.chartMargin().top+")"),a(),Se("y2",e.chartInnerHeight()),a(),Se("y1",e.chartInnerHeight())("x2",e.chartInnerWidth())("y2",e.chartInnerHeight()),a(),N(e.bars()),a(2),N(e.barLabels()),a(2),N(e.xLabels()),a(2),Se("transform","rotate(-90)")("x",-(e.chartInnerHeight()/2))("y",-e.chartMargin().left+15),a(),v(" ",p(19,16,"evaluation.chart.amount")," "),a(2),g("ngClass",e.overflowClass())("ngStyle",F(22,Oa,e.isOverflowing()?"unset":e.xAxisLabelPosition()+"px")),a(3),b(p(24,18,"evaluation.chart.grade"))}}function Do(t,s){t&1&&(o(0,"div",4),l(1),c(2,"translate"),d()),t&2&&(a(),v(" ",p(2,1,"evaluation.chart.no-items")," "))}var Ga=(()=>{class t{constructor(){this.entries=I.required(),this.gradingScale=I.required(),this.translate=m(ee),this.chartWidth=A(600),this.minChartWidth=A(300),this.chartHeight=A(350),this.chartMargin=A({top:5,right:25,bottom:25,left:25}),this.minBarWidth=A(20),this.maxBarWidth=A(25),this.barPaddingFactor=A(.7),this.barCountForSmallerWidth=A(25),this.currentChartWidth=A(0),this.currentScrollWidth=A(0),this.legendWidth=A(0),this.xAxisLabelWidth=A(0),this.isOverflowing=y(()=>this.currentScrollWidth()>this.currentChartWidth()),this.overflowClass=y(()=>this.isOverflowing()?"is-overflowing":""),this.hasData=y(()=>this.chartData().length>0),this.chartInnerWidth=y(()=>{let i=this.chartData().length;if(i===0)return this.minChartWidth();let n=i*(this.maxBarWidth()/this.barPaddingFactor());return Math.max(this.minChartWidth(),n)}),this.chartInnerHeight=y(()=>this.chartHeight()-this.chartMargin().top-this.chartMargin().bottom),this.renderedChartWidth=y(()=>this.chartInnerWidth()+this.chartMargin().left+this.chartMargin().right),this.legendPosition=y(()=>(this.renderedChartWidth()-this.legendWidth())/2),this.xAxisLabelPosition=y(()=>(this.renderedChartWidth()-this.xAxisLabelWidth())/2),this.viewBox=y(()=>`0 0 ${this.renderedChartWidth()} ${this.chartHeight()}`),this.bars=y(()=>{let e=this.chartData(),i=this.xScaleBar(),n=this.yScaleLinear();return e.length===0?[]:e.map((r,h)=>{let x=i.step*h+(i.step-i.barWidth)/2,j=this.scaleY(r.Count,n.domain,n.range),Te=this.chartInnerHeight()-j,Je=i.barWidth,ue=r.Sufficient?"bar-sufficient":"bar-insufficient";return{x,y:j,width:Je,height:Te,colorClass:ue,value:r.Value,count:r.Count}})}),this.xLabels=y(()=>{let e=this.chartData(),i=this.xScaleBar(),n=this.chartInnerHeight();if(e.length===0)return[];let r=[];return e.forEach((h,x)=>{let j=i.step*x+i.step/2,Te=n+18;r.push({x:j,y:Te,text:h.Value.toString(),textAnchor:"middle"})}),r}),this.barLabels=y(()=>this.bars().map(e=>({x:e.x+e.width/2,y:e.y-5,text:e.count.toString()}))),this.legendLabels=y(()=>{let e=this.chartMargin().top/2;return[{text:this.translate.instant("evaluation.chart.unsufficient"),colorClass:"bar-insufficient",x:this.renderedChartWidth()/2-80,y:e},{text:this.translate.instant("evaluation.chart.sufficient"),colorClass:"bar-sufficient",x:this.renderedChartWidth()/2+50,y:e}]}),this.chartData=y(()=>{let e=this.gradingScale();if(!e||e.Grades.length===0||this.entries().length===0)return[];let i=this.countGrades();return e.Grades.map(n=>({Value:n.Value,Count:i.get(n.Value)||0,Sufficient:n.Sufficient,Sort:n.Sort||n.Value.toString().padStart(2,"0")})).filter(n=>n.Value>0).filter(n=>n.Count>0).sort((n,r)=>r.Sort.localeCompare(n.Sort))}),this.xScaleBar=y(()=>{if(this.chartData().length===0)return{domain:[],range:[0,0],step:0,barWidth:0};let e=this.chartData().map(j=>j.Value),i=[0,this.chartInnerWidth()],n=this.chartData().length,r=0,h=0,x=this.chartInnerWidth()/n*this.barPaddingFactor();return x>this.maxBarWidth()?r=this.maxBarWidth():n>=this.barCountForSmallerWidth()?r=this.minBarWidth():r=x,h=this.chartInnerWidth()/n,{domain:e,range:i,step:h,barWidth:r}}),this.yScaleLinear=y(()=>{if(this.chartData().length===0)return{domain:[0,0],range:[0,0]};let i=[0,Math.max(...this.chartData().map(r=>r.Count),0)*1.1],n=[this.chartInnerHeight(),0];return{domain:i,range:n}})}ngAfterViewInit(){let e=this.chartWrapper?.nativeElement,i=this.chartLegend?.nativeElement,n=this.xAxisLabel?.nativeElement;e&&(this.currentChartWidth.set(Math.round(e.clientWidth)),this.currentScrollWidth.set(Math.round(e.scrollWidth)),this.legendWidth.set(Math.round(i?.clientWidth??0)),this.xAxisLabelWidth.set(Math.round(n?.clientWidth??0)),this.resizeObserver=new ResizeObserver(r=>{for(let h of r)this.currentChartWidth.set(Math.round(h.contentRect.width)),this.currentScrollWidth.set(Math.round(h.target.scrollWidth))}),this.resizeObserver.observe(e))}ngOnDestroy(){this.resizeObserver&&this.resizeObserver.disconnect()}countGrades(){return this.entries().reduce((e,{grade:i})=>{let n=i?.Value;return n==null?e:e.set(n,(e.get(n)??0)+1)},new Map)}scaleY(e,i,n){let[r,h]=i,[x,j]=n;return h===r?x:x-(e-r)/(h-r)*(x-j)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-evaluation-chart"]],viewQuery:function(i,n){if(i&1&&Qi(So,5)(yo,5)(xo,5),i&2){let r;Vt(r=Nt())&&(n.chartWrapper=r.first),Vt(r=Nt())&&(n.chartLegend=r.first),Vt(r=Nt())&&(n.xAxisLabel=r.first)}},inputs:{entries:[1,"entries"],gradingScale:[1,"gradingScale"]},decls:3,vars:1,consts:[["chartLegend",""],["chartWrapper",""],["xAxisLabel",""],[1,"chart-container","mt-3"],[1,"no-data-message"],[1,"chart-legend",3,"ngClass","ngStyle"],[1,"legend-item"],[1,"chart-wrapper"],["id","chart",1,"chart"],["x1","0","y1","0","x2","0",1,"axis"],["x1","0",1,"axis"],["text-anchor","middle",1,"label","bar-label"],[1,"label"],["text-anchor","middle",1,"label"],[1,"x-axis-label",3,"ngClass","ngStyle"],["width","10","height","10"]],template:function(i,n){i&1&&(o(0,"div",3),f(1,ko,25,24)(2,Do,3,3,"div",4),d()),i&2&&(a(),C(n.hasData()?1:2))},dependencies:[he,Zi,P],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%}.chart-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:100%;height:auto;font-family:sans-serif;box-sizing:border-box;justify-content:center}.chart-legend[_ngcontent-%COMP%], .x-axis-label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;align-self:flex-start;height:1.5em}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:baseline;padding:0 5px}.legend-item[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:0 2px}.chart-wrapper[_ngcontent-%COMP%]{width:100%;height:auto;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow-x:auto;overflow-y:hidden}.chart[_ngcontent-%COMP%]{height:100%;align-self:flex-start}svg[_ngcontent-%COMP%]{display:block;height:100%}.axis[_ngcontent-%COMP%]{stroke:#495057;stroke-width:1}.bar-sufficient[_ngcontent-%COMP%]{fill:#3d8608}.bar-insufficient[_ngcontent-%COMP%]{fill:#ea161f}.bar-label[_ngcontent-%COMP%]{font-weight:700}.no-data-message[_ngcontent-%COMP%]{text-align:center;padding:20px}.is-overflowing[_ngcontent-%COMP%]{align-self:center}"],changeDetection:0})}}return t})();function Oo(t,s){t&1&&S(0,"bkd-spinner")}function Lo(t,s){t&1&&(o(0,"p",1),l(1),c(2,"translate"),d()),t&2&&(a(),b(p(2,1,"evaluation.no-event")))}function Go(t,s){if(t&1&&(S(0,"bkd-evaluation-header",2),o(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),l(5),c(6,"translate"),d(),o(7,"div",7),l(8),d()(),o(9,"div",5)(10,"div",6),l(11),c(12,"translate"),d(),o(13,"div",7),l(14),d()(),o(15,"div",5)(16,"div",6),l(17),c(18,"translate"),d(),o(19,"div",7),l(20),d()(),o(21,"div",5)(22,"div",6),l(23),c(24,"translate"),d(),o(25,"div",7),l(26),d()(),o(27,"div",5)(28,"div",6),l(29),c(30,"translate"),d(),o(31,"div",7),l(32),d()(),o(33,"div",5)(34,"div",6),l(35),c(36,"translate"),d(),o(37,"div",7),l(38),d()()(),S(39,"bkd-evaluation-chart",8),d()),t&2){let e=u(2),i=O(0);g("event",i)("showActions",!1),a(5),v(" ",p(6,16,"evaluation.statistics.average")," "),a(3),v(" ",e.average()," "),a(3),v(" ",p(12,18,"evaluation.statistics.standard-deviation")," "),a(3),b(e.standardDeviation()),a(3),v(" ",p(18,20,"evaluation.statistics.amount-of-notes")," "),a(3),v(" ",e.entries().length," "),a(3),v(" ",p(24,22,"evaluation.statistics.highest-note")," "),a(3),b(e.highestGrade()),a(3),v(" ",p(30,24,"evaluation.statistics.lowest-note")," "),a(3),b(e.lowestGrade()),a(3),v(" ",p(36,26,"evaluation.statistics.unsufficient")," "),a(3),b(e.unsufficientCount()),a(),g("entries",e.state.entries())("gradingScale",e.state.gradingScale())}}function Fo(t,s){if(t&1&&f(0,Go,40,28),t&2){u();let e=O(0);C(e?0:-1)}}var Fa=(()=>{class t{constructor(){this.state=m(Ce),this.entries=y(()=>this.state.entries().filter(e=>e.grade?.Value!=null&&e.grade.Value>0)),this.average=y(()=>this.entries().length===0?0:bn(Cn(this.entries(),e=>e.grade?.Value??0),2)),this.standardDeviation=y(()=>{if(this.entries().length<=1)return 0;let e=Sn(Qt(this.entries(),i=>Math.pow((i.grade?.Value??0)-this.average(),2)));return Number(Math.sqrt(e/this.entries().length).toFixed(2))}),this.highestGrade=y(()=>this.findGrade(!0)),this.lowestGrade=y(()=>this.findGrade(!1)),this.unsufficientCount=y(()=>this.entries().filter(e=>!e.grade?.Sufficient).length)}findGrade(e){if(this.entries().length===0)return"-";let i=this.state.gradingScale()?.RisingGrades;return i&&e||!i&&!e?fn(Qt(this.entries(),r=>r.grade?.Value??0)):_n(Qt(this.entries(),r=>r.grade?.Value??0))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-evaluation-statistic"]],decls:5,vars:2,consts:[[1,"bkd-container"],[1,"mt-3","px-3"],[3,"event","showActions"],[1,"d-flex","flex-column"],[1,"statistic-values","px-3"],[1,"row"],[1,"col-8","col-sm-4","col-md-3","col-lg-2"],[1,"col"],[3,"entries","gradingScale"]],template:function(i,n){if(i&1&&(R(0),o(1,"div",0),f(2,Oo,1,0,"bkd-spinner")(3,Lo,3,3,"p",1)(4,Fo,1,1),d()),i&2){let r=W(n.state.event());a(2),C(n.state.loading()?2:r?4:3)}},dependencies:[gi,Ga,de,P],styles:[".statistic-values[_ngcontent-%COMP%]{padding-bottom:1rem;padding-top:1rem;border-bottom:1px solid #dee2e6}"],changeDetection:0})}}return t})();var $a=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-evaluation"]],features:[ce([Ce,_t,Ct])],decls:1,vars:0,template:function(i,n){i&1&&S(0,"router-outlet")},dependencies:[ke],encapsulation:2,changeDetection:0})}}return t})();var Va=(()=>{class t extends dt{constructor(){let e=m(Ie),i=m(fe);super(e,i,Dn,"ApprenticeshipContracts")}getCompaniesForStudents(e){if(e.length===0)return G([]);let i=new Date,n={"filter.StudentId":`;${e.join(";")}`,"filter.ApprenticeshipDateFrom":`<${i.toISOString()}`,"filter.ApprenticeshipDateTo":`>${i.toISOString()}`,fields:"Id,StudentId,CompanyName,CompanyNameAddition"};return this.http.get(`${this.baseUrl}/`,{params:n}).pipe(L(Jt(On)))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Na(t,s,e){s||Ri(t);let i=s??m(Hi);return e?Bi(i,e):i}function Mt(t,s){let e=Na(Mt,s?.injector),i;return y(()=>(i||(i=Wi(()=>q(t,B($({},s),{injector:e})))),i()))}var vi=1;var Ba=10,fi=(()=>{class t{constructor(){this.route=m(ve),this.loadingService=m(te),this.eventsService=m(gt),this.coursesService=m(xe),this.subscriptionsService=m(mt),this.personsService=m(ti),this.apprenticeshipContractsService=m(Va),this.lessonPresencesService=m(Fn),this.reportsService=m(pt),this.eventId$=Z([this.route.paramMap,this.route.parent?.paramMap??G(null)]).pipe(T(([e,i])=>Number(e.get("id")||i?.get("id"))),se()),this.eventSummary$=this.eventId$.pipe(L(this.loadEventSummary.bind(this)),le(1)),this.eventSummary=Mt(this.eventSummary$,{initialValue:null}),this.eventTypeId=y(()=>this.eventSummary()?.EventTypeId??null),this.studentEntries=Mt(this.loadStudentEntries(),{initialValue:null}),this.isStudyCourse=y(()=>this.eventTypeId()===vi),this.loading=q(this.loadingService.loading(we)),this.title=y(()=>this.getTitle(this.studentEntries())),this.multipleStudyClasses=y(()=>(this.studentEntries()?.studyClasses?.length??0)>1),this.searchTerm=A(""),this.sortCriteria=A({primarySortKey:"registrationDate",ascending:!1}),this.entries=y(()=>this.studentEntries()?.entries??[]),this.sortedEntries=y(()=>this.sortStudentEntries(this.entries(),this.sortCriteria())),this.filteredEntries=y(()=>ut(this.sortedEntries(),["name","status","company","studyClass"],this.searchTerm())),this.mailtoLink=y(()=>this.getMailtoLink(this.eventTypeId(),this.entries())),this.reports=Mt(this.eventSummary$.pipe(Qe(Ge)).pipe(L(this.loadReports.bind(this))),{initialValue:[]})}loadEventSummary(e){return this.loadingService.load(this.eventsService.getEventSummary(e),we)}loadStudentEntries(){return this.eventSummary$.pipe(L(e=>{let i=()=>{if(!e)return G(null);switch(e.EventTypeId){case vi:return this.loadStudyCourseStudents(e);case Ba:return this.loadStudyClassStudents(e);default:return this.loadCourseStudents(e.Id)}};return this.loadingService.load(i(),we)}))}loadStudyCourseStudents({Id:e,Designation:i}){return this.subscriptionsService.getSubscriptionsByCourse(e).pipe(L(n=>this.personsService.getSummaries(n.map(({PersonId:r})=>r).filter(Ge)).pipe(T(r=>ki(e,r,n,i)))))}loadStudyClassStudents({Id:e,Number:i}){return this.subscriptionsService.getSubscriptionsByCourse(e,{"filter.IsOkay":"=1"}).pipe(L(n=>{let r=n.map(({PersonId:h})=>h).filter(Ge);return Z([this.personsService.getSummaries(r),this.apprenticeshipContractsService.getCompaniesForStudents(r)]).pipe(T(([h,x])=>{let j=ki(e,h,n,i);return Ii(j,x)}))}))}loadCourseStudents(e){return this.coursesService.getExpandedCourseWithParticipants(e).pipe(T(ea),L(i=>Z([this.apprenticeshipContractsService.getCompaniesForStudents(i.entries.map(({id:n})=>n)),this.lessonPresencesService.getLessonStudyClassesByEvent(e)]).pipe(T(([n,r])=>{let h=Ii(i,n);return ta(h,r)}))))}getTitle(e){if(!e||!e.eventDesignation)return null;let{eventDesignation:i,studyClasses:n}=e;return[i,...n].join(", ")}getMailtoLink(e,i){if(e===null||e===vi)return null;let n=i.map(r=>r.email).filter(Boolean);return n.length>0?`mailto:${n.join(";")}`:null}loadReports({Id:e,EventTypeId:i}){switch(i){case null:case vi:return G([]);case Ba:return this.reportsService.getStudyClassStudentsReports(e);default:return this.reportsService.getCourseStudentsReports(e)}}sortStudentEntries(e,i){return[...e].sort($o(i))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function $o(t){return(s,e)=>{switch(t.primarySortKey){case"registrationDate":return Vo(s,e,t.ascending);case"name":return Ra(s,e,t.ascending);default:throw new ei(t.primarySortKey,"Unhandled sort criteria")}}}function Vo(t,s,e){let i=t.registrationDate?new Date(t.registrationDate).getTime():0,n=s.registrationDate?new Date(s.registrationDate).getTime():0,r=e?i-n:n-i;return r===0?Ra(t,s,!0):r}function Ra(t,s,e){return e?t.name.localeCompare(s.name):s.name.localeCompare(t.name)}var Aa=(()=>{class t{constructor(){this.entry=I.required(),this.multipleStudyClasses=I(!1),this.returnLink=I(null),this.link=y(()=>["student",this.entry().id,"contact"]),this.linkParams=y(()=>{let e=this.returnLink();return e?{returnparams:new URLSearchParams({returnlink:e}).toString()}:{}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-course-entry"]],inputs:{entry:[1,"entry"],multipleStudyClasses:[1,"multipleStudyClasses"],returnLink:[1,"returnLink"]},decls:7,vars:10,consts:[[1,"avatar","large",3,"studentId","link","linkParams"],[1,"name",3,"title","routerLink","queryParams"],[1,"study-class"],[1,"company",3,"title"]],template:function(i,n){i&1&&(S(0,"bkd-avatar",0),o(1,"a",1),l(2),d(),o(3,"div",2),l(4),d(),o(5,"div",3),l(6),d()),i&2&&(g("studentId",n.entry().id)("link",n.link())("linkParams",n.linkParams()),a(),g("title",n.entry().name)("routerLink",n.link())("queryParams",n.linkParams()),a(),b(n.entry().name),a(2),v(" ",n.multipleStudyClasses()?n.entry().studyClass:"",`
`),a(),g("title",n.entry().company),a(),b(n.entry().company))},dependencies:[ne,zn],styles:['[_nghost-%COMP%]{display:grid;grid-template-columns:min-content 1fr;grid-template-rows:min-content min-content 1fr;grid-template-areas:"avatar name" "avatar study-class" "avatar company";padding:2rem 1rem}.avatar[_ngcontent-%COMP%]{grid-area:avatar;margin-right:1.5rem}.name[_ngcontent-%COMP%]{grid-area:name}.study-class[_ngcontent-%COMP%]{grid-area:study-class;font-size:.875rem}.company[_ngcontent-%COMP%]{grid-area:company;align-content:end;padding-bottom:1.5rem}.name[_ngcontent-%COMP%], .company[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}'],changeDetection:0})}}return t})();var No=t=>({count:t});function Bo(t,s){if(t&1&&(o(0,"div",0),l(1),c(2,"translate"),d()),t&2){u();let e=O(2);a(),v(" ",H(2,1,e===1?"events-students.registration":"events-students.registrations",F(4,No,e))," ")}}var Ci=(()=>{class t{constructor(){this.title=I.required(),this.count=I(null),this.searchTerm=me()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-header"]],inputs:{title:[1,"title"],count:[1,"count"],searchTerm:[1,"searchTerm"]},outputs:{searchTerm:"searchTermChange"},decls:7,vars:10,consts:[[1,"additional-info"],[1,"search",3,"valueChange","value","placeholder","label"]],template:function(i,n){if(i&1){let r=D();o(0,"h1"),l(1),d(),R(2),f(3,Bo,3,6,"div",0),o(4,"bkd-resettable-input",1),c(5,"translate"),c(6,"translate"),M("valueChange",function(x){return E(r),w(n.searchTerm.set(x))}),d()}if(i&2){a(),b(n.title()),a();let r=W(n.count());a(),C(r!==null?3:-1),a(),g("value",n.searchTerm())("placeholder",p(5,6,"events-students.search-placeholder"))("label",p(6,8,"events-students.search"))}},dependencies:[vt,P],styles:["h1[_ngcontent-%COMP%]{margin-bottom:0}.search[_ngcontent-%COMP%]{margin-top:1rem;display:flex;max-width:300px}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"],changeDetection:0})}}return t})();var Ro=(t,s)=>s.id;function Ao(t,s){t&1&&(o(0,"p"),l(1),c(2,"translate"),d()),t&2&&(a(),b(p(2,1,"events-students.no-entries")))}function Ho(t,s){if(t&1&&S(0,"bkd-events-students-course-entry",2),t&2){let e=s.$implicit,i=u();g("entry",e)("multipleStudyClasses",i.multipleStudyClasses())("returnLink",i.returnLink())}}var Ha=(()=>{class t{constructor(){this.title=I.required(),this.count=I.required(),this.entries=I.required(),this.multipleStudyClasses=I(!1),this.returnLink=I(null),this.searchTerm=me()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-course-list"]],inputs:{title:[1,"title"],count:[1,"count"],entries:[1,"entries"],multipleStudyClasses:[1,"multipleStudyClasses"],returnLink:[1,"returnLink"],searchTerm:[1,"searchTerm"]},outputs:{searchTerm:"searchTermChange"},decls:5,vars:4,consts:[[3,"searchTermChange","title","count","searchTerm"],[1,"list"],[3,"entry","multipleStudyClasses","returnLink"]],template:function(i,n){i&1&&(o(0,"bkd-events-students-header",0),K("searchTermChange",function(h){return U(n.searchTerm,h)||(n.searchTerm=h),h}),d(),o(1,"section",1),f(2,Ao,3,3,"p"),V(3,Ho,1,3,"bkd-events-students-course-entry",2,Ro),d()),i&2&&(g("title",n.title())("count",n.count()),z("searchTerm",n.searchTerm),a(2),C(n.entries().length===0?2:-1),a(),N(n.entries()))},dependencies:[Ci,Aa,P],styles:["[_nghost-%COMP%]{display:block;overflow:hidden}section.list[_ngcontent-%COMP%]{width:calc(100% + 1px);margin-top:1rem;display:grid;grid-template-columns:repeat(auto-fill,minmax(400px,1fr))}bkd-events-students-course-entry[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;border-right:1px solid #dee2e6}"],changeDetection:0})}}return t})();var Wa=(()=>{class t{constructor(){this.entry=I.required(),this.returnLink=I(null),this.link=y(()=>["study-course-student",this.entry().id]),this.linkParams=y(()=>{let e=this.returnLink();return e?{returnparams:new URLSearchParams({returnlink:e}).toString()}:{}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-study-course-entry"]],inputs:{entry:[1,"entry"],returnLink:[1,"returnLink"]},decls:7,vars:8,consts:[[1,"name",3,"routerLink","queryParams"],[1,"status"],[1,"registration-date"]],template:function(i,n){i&1&&(o(0,"a",0),l(1),d(),o(2,"div",1),l(3),d(),o(4,"div",2),l(5),c(6,"date"),d()),i&2&&(g("routerLink",n.link())("queryParams",n.linkParams()),a(),b(n.entry().name),a(2),b(n.entry().status),a(2),v(" ",H(6,5,n.entry().registrationDate,"dd.MM.yyyy"),`
`))},dependencies:[ne,Ji,je],styles:['[_nghost-%COMP%]{display:grid;align-items:center;grid-template-areas:"name status registration-date";grid-template-columns:2fr 1fr 1fr;border-bottom:1px solid #dee2e6}.name[_ngcontent-%COMP%], .status[_ngcontent-%COMP%], .registration-date[_ngcontent-%COMP%]{padding:1rem}.name[_ngcontent-%COMP%]{grid-area:name;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.status[_ngcontent-%COMP%]{grid-area:status;padding-left:0}.registration-date[_ngcontent-%COMP%]{grid-area:registration-date}@media(max-width:750px){[_nghost-%COMP%]{grid-template-areas:"name registration-date" "status registration-date";grid-template-columns:2fr 1fr;align-items:start}.name[_ngcontent-%COMP%]{padding-bottom:0}.status[_ngcontent-%COMP%]{padding-top:0;padding-left:1rem;font-size:.875rem}}'],changeDetection:0})}}return t})();var Wo=(t,s)=>s.id;function jo(t,s){if(t&1){let e=D();o(0,"div",2)(1,"bkd-sortable-header",5),c(2,"translate"),K("sortCriteriaChange",function(n){E(e);let r=u();return U(r.sortCriteria,n)||(r.sortCriteria=n),w(n)}),d(),o(3,"bkd-sortable-header",6),c(4,"translate"),K("sortCriteriaChange",function(n){E(e);let r=u();return U(r.sortCriteria,n)||(r.sortCriteria=n),w(n)}),d()()}if(t&2){let e=u();a(),g("label",p(2,6,"events-students.list.header.name"))("sortKey","name"),z("sortCriteria",e.sortCriteria),a(2),g("label",p(4,8,"events-students.list.header.registration-date"))("sortKey","registrationDate"),z("sortCriteria",e.sortCriteria)}}function Uo(t,s){t&1&&(o(0,"p",3),l(1),c(2,"translate"),d()),t&2&&(a(),b(p(2,1,"events-students.no-entries")))}function qo(t,s){if(t&1&&S(0,"bkd-events-students-study-course-entry",4),t&2){let e=s.$implicit,i=u();g("entry",e)("returnLink",i.returnLink())}}var ja=(()=>{class t{constructor(){this.title=I.required(),this.count=I.required(),this.entries=I.required(),this.returnLink=I(null),this.sortCriteria=me.required(),this.searchTerm=me()}updateSortCriteria(e){this.sortCriteria.set(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-study-course-list"]],inputs:{title:[1,"title"],count:[1,"count"],entries:[1,"entries"],returnLink:[1,"returnLink"],sortCriteria:[1,"sortCriteria"],searchTerm:[1,"searchTerm"]},outputs:{sortCriteria:"sortCriteriaChange",searchTerm:"searchTermChange"},features:[ce([])],decls:6,vars:4,consts:[[3,"searchTermChange","title","count","searchTerm"],[1,"list"],[1,"list-header"],[1,"mt-3"],[3,"entry","returnLink"],[1,"name",3,"sortCriteriaChange","label","sortKey","sortCriteria"],[1,"registration-date",3,"sortCriteriaChange","label","sortKey","sortCriteria"]],template:function(i,n){i&1&&(o(0,"bkd-events-students-header",0),K("searchTermChange",function(h){return U(n.searchTerm,h)||(n.searchTerm=h),h}),d(),o(1,"section",1),f(2,jo,5,10,"div",2)(3,Uo,3,3,"p",3),V(4,qo,1,2,"bkd-events-students-study-course-entry",4,Wo),d()),i&2&&(g("title",n.title())("count",n.count()),z("searchTerm",n.searchTerm),a(2),C(n.entries().length>0?2:3),a(2),N(n.entries()))},dependencies:[Ci,Wa,ht,P],styles:[".list-header[_ngcontent-%COMP%]{cursor:pointer;display:grid;grid-template-columns:3fr 1fr;align-items:center;border-bottom:2px solid #dee2e6}.name[_ngcontent-%COMP%], .registration-date[_ngcontent-%COMP%]{padding:1rem}.name[_ngcontent-%COMP%]{flex:3}.registration-date[_ngcontent-%COMP%]{flex:1}@media(max-width:750px){.list-header[_ngcontent-%COMP%]{grid-template-columns:2fr 1fr}.name[_ngcontent-%COMP%]{flex:2}.registration-date[_ngcontent-%COMP%]{flex:1;white-space:nowrap}}"],changeDetection:0})}}return t})();var zo=t=>[t];function Ko(t,s){if(t&1&&(o(0,"a",5)(1,"i",7),l(2,"mail"),d()()),t&2){let e=u(2);g("href",e.state.mailtoLink(),Ne)}}function Yo(t,s){if(t&1&&(o(0,"bkd-backlink",0)(1,"div",4),f(2,Ko,3,1,"a",5),S(3,"bkd-reports-link",6),d()()),t&2){let e=u(),i=O(0);g("link",F(3,zo,i)),a(2),C(e.state.mailtoLink()?2:-1),a(),g("reports",e.state.reports())}}function Qo(t,s){t&1&&S(0,"bkd-spinner")}function Xo(t,s){t&1&&(o(0,"p",1),l(1),c(2,"translate"),d()),t&2&&(a(),b(p(2,1,"events-students.no-entries")))}function Zo(t,s){if(t&1){let e=D();o(0,"bkd-events-students-study-course-list",8),K("sortCriteriaChange",function(n){E(e);let r=u();return U(r.state.sortCriteria,n)||(r.state.sortCriteria=n),w(n)})("searchTermChange",function(n){E(e);let r=u();return U(r.state.searchTerm,n)||(r.state.searchTerm=n),w(n)}),d()}if(t&2){let e=u();g("title",e.state.title())("count",e.state.entries().length)("entries",e.state.filteredEntries())("returnLink",e.returnLink()),z("sortCriteria",e.state.sortCriteria)("searchTerm",e.state.searchTerm)}}function Jo(t,s){if(t&1){let e=D();o(0,"bkd-events-students-course-list",9),K("searchTermChange",function(n){E(e);let r=u();return U(r.state.searchTerm,n)||(r.state.searchTerm=n),w(n)}),d()}if(t&2){let e=u();g("title",e.state.title())("count",e.state.entries().length)("entries",e.state.filteredEntries())("multipleStudyClasses",e.state.multipleStudyClasses())("returnLink",e.returnLink()),z("searchTerm",e.state.searchTerm)}}var Ua=(()=>{class t{constructor(){this.state=m(fi),this.route=m(ve),this.returnLink=q(this.route.queryParams.pipe(T(({returnlink:e})=>e?decodeURIComponent(e):null)))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-list"]],decls:6,vars:3,consts:[[3,"link"],[1,"mt-3"],[3,"title","count","entries","returnLink","sortCriteria","searchTerm"],[3,"title","count","entries","multipleStudyClasses","returnLink","searchTerm"],[1,"d-flex"],["target","_blank",1,"mail","btn","btn-primary","btn-icon","me-2",3,"href"],[1,"ms-2",3,"reports"],[1,"material-icons"],[3,"sortCriteriaChange","searchTermChange","title","count","entries","returnLink","sortCriteria","searchTerm"],[3,"searchTermChange","title","count","entries","multipleStudyClasses","returnLink","searchTerm"]],template:function(i,n){if(i&1&&(R(0),f(1,Yo,4,5,"bkd-backlink",0),f(2,Qo,1,0,"bkd-spinner")(3,Xo,3,3,"p",1)(4,Zo,1,6,"bkd-events-students-study-course-list",2)(5,Jo,1,6,"bkd-events-students-course-list",3)),i&2){let r=W(n.returnLink());a(),C(r?1:-1),a(),C(n.state.loading()?2:n.state.entries().length===0?3:n.state.isStudyCourse()?4:5)}},dependencies:[de,Ke,ct,Ha,ja,P],encapsulation:2,changeDetection:0})}}return t})();var es=(t,s)=>s.IdStatus;function ts(t,s){t&1&&S(0,"bkd-spinner")}function is(t,s){if(t&1){let e=D();o(0,"div",6)(1,"input",7),M("change",function(){let n=E(e).$implicit,r=u(2);return w(r.onSelectionChange(n))}),d(),o(2,"label",8),l(3),d()()}if(t&2){let e=s.$implicit,i=s.$index,n=u(2);a(),g("id",Ae("status-",i))("checked",e.IdStatus===n.currentStatus().IdStatus)("value",e.IdStatus),a(),g("for",Ae("status-",i)),a(),v(" ",e.Status," ")}}function ns(t,s){if(t&1&&(o(0,"form"),V(1,is,4,7,"div",6,es),d()),t&2){let e=u();a(),N(e.statusList())}}var za=(()=>{class t{constructor(){this.statusProcessesService=m(bt),this.loadingService=m(te),this.activeModal=m(Le),this.currentStatus=I.required(),this.subscriptionId=I.required(),this.personId=I.required(),this.loading=q(this.loadingService.loading$,{initialValue:!0}),this.statusId=y(()=>this.currentStatus().IdStatus),this.statusList=q(Oe(this.statusId).pipe(se(),L(e=>this.statusProcessesService.getStatusList(e)),T(e=>(e=[...e,this.currentStatus()],e.sort((i,n)=>i.Status.localeCompare(n.Status)))),Me([]))),this.canUpdate=y(()=>this.selected().IdStatus?this.selected().IdStatus!==this.statusId():!1),this.selected=A({})}onSelectionChange(e){this.selected.set(e)}cancel(){this.activeModal.dismiss()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-study-course-edit-dialog"]],inputs:{currentStatus:[1,"currentStatus"],subscriptionId:[1,"subscriptionId"],personId:[1,"personId"]},decls:14,vars:11,consts:[[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"form-check"],["type","radio","name","status",1,"form-check-input",3,"change","id","checked","value"],[1,"form-check-label",3,"for"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"h5",1),l(2),c(3,"translate"),d()(),o(4,"div",2),f(5,ts,1,0,"bkd-spinner")(6,ns,3,0,"form"),d(),o(7,"div",3)(8,"button",4),M("click",function(){return n.activeModal.dismiss()}),l(9),c(10,"translate"),d(),o(11,"button",5),M("click",function(){return n.activeModal.close(n.selected())}),l(12),c(13,"translate"),d()()),i&2&&(a(2),v(" ",p(3,5,"events-students.study-course-edit.status-dialog.title")," "),a(3),C(n.loading()?5:6),a(4),v(" ",p(10,7,"events-students.study-course-edit.status-dialog.cancel")," "),a(2),g("disabled",!n.canUpdate()),a(),v(" ",p(13,9,"events-students.study-course-edit.status-dialog.save")," "))},dependencies:[qe,qt,Ut,rn,de,P],encapsulation:2,changeDetection:0})}}return t})();var as=(t,s)=>s.id;function rs(t,s){if(t&1&&(l(0),c(1,"date")),t&2){u(2);let e=O(2);v(" ",H(1,1,e.Birthdate,"dd.MM.yyyy")," ")}}function os(t,s){if(t&1&&l(0),t&2){u(2);let e=O(2);v(" (",e.Gender,") ")}}function ss(t,s){if(t&1&&(l(0),S(1,"br")),t&2){u(2);let e=O(2);v(" ",e.AddressLine1)}}function ds(t,s){if(t&1&&(l(0),S(1,"br")),t&2){u(2);let e=O(2);v(" ",e.AddressLine2)}}function ls(t,s){if(t&1&&(l(0),S(1,"br")),t&2){u(2);let e=O(2);yt(" ",e.Zip," ",e.Location)}}function cs(t,s){if(t&1&&(o(0,"a",4),l(1),d(),S(2,"br")),t&2){u(2);let e=O(2);g("href",Ae("tel:",e.PhonePrivate),Ne),a(),b(e.PhonePrivate)}}function ps(t,s){if(t&1&&(o(0,"a",4),l(1),d(),S(2,"br")),t&2){u(2);let e=O(2);g("href",Ae("tel:",e.PhoneMobile),Ne),a(),b(e.PhoneMobile)}}function ms(t,s){if(t&1&&(o(0,"a",4),l(1),d(),S(2,"br")),t&2){u(2);let e=O(2);g("href",Ae("mailto:",e.Email),Ne),a(),v(" ",e.Email," ")}}function us(t,s){if(t&1&&(o(0,"a",4),l(1),d(),S(2,"br")),t&2){u(2);let e=O(2);g("href",Ae("mailto:",e.Email2),Ne),a(),v(" ",e.Email2," ")}}function gs(t,s){if(t&1&&(o(0,"h1"),l(1),d(),o(2,"span",3),f(3,rs,2,4),f(4,os,1,1),d(),o(5,"address"),f(6,ss,2,1),f(7,ds,2,1),f(8,ls,2,2),f(9,cs,3,3),f(10,ps,3,3),f(11,ms,3,3),f(12,us,3,3),d()),t&2){u();let e=O(2);a(),b(e.FullName),a(2),C(e.Birthdate?3:-1),a(),C(e.Gender?4:-1),a(2),C(e.AddressLine1?6:-1),a(),C(e.AddressLine2?7:-1),a(),C(e.Zip&&e.Location?8:-1),a(),C(e.PhonePrivate?9:-1),a(),C(e.PhoneMobile?10:-1),a(),C(e.Email?11:-1),a(),C(e.Email2?12:-1)}}function hs(t,s){if(t&1){let e=D();o(0,"div",2),l(1),c(2,"translate"),o(3,"button",5),M("click",function(){E(e);let n=u();return w(n.updateStatus())}),o(4,"i",6),l(5,"edit"),d(),o(6,"span",7),l(7),d()()()}if(t&2){u();let e=O(4);a(),v(" ",p(2,2,"events-students.study-course-detail.status"),": "),a(6),b(e)}}function vs(t,s){if(t&1&&(o(0,"div",8)(1,"h2"),l(2),d()()),t&2){let e=u().$implicit;a(2),b(e.label)}}function fs(t,s){if(t&1&&(o(0,"a",9),l(1),d()),t&2){let e=u(2).$implicit;g("href",Re(e.file),Ne),a(),b(e.value)}}function Cs(t,s){if(t&1&&l(0),t&2){let e=u(2).$implicit;v(" ",e.value," ")}}function _s(t,s){if(t&1&&(o(0,"div",8)(1,"div"),l(2),d(),f(3,fs,2,3,"a",9)(4,Cs,1,1),d()),t&2){let e=u().$implicit;a(2),b(e.label),a(),C(e.file!==null?3:4)}}function bs(t,s){if(t&1&&f(0,vs,3,1,"div",8)(1,_s,5,2,"div",8),t&2){let e=s.$implicit;C(e.heading?0:e.value?1:-1)}}function Ss(t,s){t&1&&S(0,"bkd-spinner")}var Ka=(()=>{class t{constructor(){this.settings=m(fe),this.route=m(ve),this.personsService=m(ti),this.subscriptionsService=m(mt),this.storageService=m(st),this.statusProcessesService=m(bt),this.loadingService=m(te),this.modalService=m(Fe),this.translate=m(ee),this.refreshSubscription=new ae,this.eventId$=this.route.parent?.paramMap.pipe(T(e=>Number(e.get("id"))))??G(0),this.personId$=this.route.paramMap.pipe(T(e=>Number(e.get("id")))),this.person=q(this.personId$.pipe(L(e=>this.personsService.get(e))),{initialValue:null}),this.subscription=q(this.refreshSubscription.pipe(Me(null),L(()=>this.loadSubscription()))),this.subscriptionId=y(()=>this.subscription()?.Id??null),this.subscriptionDetails=q(this.loadSubscriptionDetails(),{initialValue:[]}),this.currentStatus=y(()=>({IdStatus:this.subscription()?.StatusId??0,Status:this.subscription()?.Status??""})),this.backLink=q(this.route.queryParams.pipe(T(({returnparams:e})=>e),T(In))),this.loading=q(this.loadingService.loading$,{initialValue:!0})}updateStatus(){let e=this.subscriptionId(),i=this.person();if(!e||!i)return;let n=this.modalService.open(za);n.componentInstance.currentStatus=this.currentStatus,n.componentInstance.subscriptionId=e,n.componentInstance.personId=i.Id,n.result.then(r=>{this.statusProcessesService.updateStatus("PersonenAnmeldung",e,i.Id,r.IdStatus).subscribe(()=>this.refreshSubscription.next())},()=>{})}loadSubscription(){return this.loadingService.load(Z([this.eventId$,this.personId$]).pipe(L(([e,i])=>this.subscriptionsService.getSubscriptionsByCourse(e,{"filter.PersonId":`=${i}`})),T(e=>e[0]??null)),{stopOnFirstValue:!0})}loadSubscriptionDetails(){return this.loadingService.load(Oe(this.subscriptionId).pipe(L(e=>e===null?G([]):this.subscriptionsService.getSubscriptionDetailsById(e)),T(e=>e.map(i=>this.toSubscriptionDetailsEntry(i)))),{stopOnFirstValue:!0})}toSubscriptionDetailsEntry(e){let i=e.Value??"";return i=this.normalizeSubscriptionDetailsDropdownValue(e,i)??"",i=this.translateSubscriptionDetailsValue(e,i)??i,{id:e.Id,label:e.VssDesignation,value:i,file:this.buildFileUrl(e),heading:e.VssStyle==="HE"}}normalizeSubscriptionDetailsDropdownValue(e,i){return e.DropdownItems&&e.VssStyle!=="CB"?e.DropdownItems.find(n=>String(n.Key)===i)?.Value??i:i}translateSubscriptionDetailsValue(e,i){return e.VssType==="Yes"||e.VssType==="YesNo"?this.translate.instant(`events-students.subscriptionDetails.${i||"empty"}`):i}buildFileUrl(e){if(e.VssStyle==="PD"||e.VssStyle==="PF"||e.VssStyle==="DA"){let i=this.storageService.getAccessToken()||"";return`${this.settings.apiUrl}/Files/SubscriptionDetails/${e.Id}?token=${i}`}return null}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students-study-course-detail"]],decls:9,vars:6,consts:[[1,"bkd-container","bkd-container-limited"],["link","../..",3,"params"],[1,"status"],[1,"additional-info"],[3,"href"],["type","button",1,"d-flex","btn","btn-link","p-0","ms-1","status-update",3,"click"],[1,"material-icons"],[1,"label"],[1,"detail"],["target","_blank",3,"href"]],template:function(i,n){if(i&1&&(o(0,"div",0),S(1,"bkd-backlink",1),R(2),f(3,gs,13,10),R(4),f(5,hs,8,4,"div",2),V(6,bs,2,1,null,null,as),f(8,Ss,1,0,"bkd-spinner"),d()),i&2){let r;a(),g("params",n.backLink()),a();let h=W(n.person());a(),C(h?3:-1),a();let x=W((r=n.currentStatus())==null?null:r.Status);a(),C(x?5:-1),a(),N(n.subscriptionDetails()),a(2),C(n.loading()?8:-1)}},dependencies:[Ke,de,P,je],styles:["h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}address[_ngcontent-%COMP%]{margin:1rem 0}.status[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem 0;border-top:1px solid #dee2e6;border-bottom:1px solid #dee2e6}.detail[_ngcontent-%COMP%]{max-width:70ch;padding-top:1rem}.detail[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.detail[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-weight:400;color:#00000080}.status-update[_ngcontent-%COMP%]{color:#00000080;text-decoration:none}.status-update[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#000;text-decoration:underline;font-weight:300}"],changeDetection:0})}}return t})();var Ya=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-students"]],features:[ce([fi])],decls:1,vars:0,template:function(i,n){i&1&&S(0,"router-outlet")},dependencies:[ke],encapsulation:2,changeDetection:0})}}return t})();function ys(t,s){if(t&1&&(o(0,"span"),l(1),c(2,"date"),S(3,"wbr"),l(4),c(5,"date"),d()),t&2){let e=u(2);a(),v("",H(2,2,e.event().dateFrom,"dd.MM.yyyy"),"\u2013"),a(3),b(H(5,5,e.event().dateTo,"dd.MM.yyyy"))}}function xs(t,s){if(t&1&&(o(0,"div",2),f(1,ys,6,8,"span"),d()),t&2){let e=u();a(),C(e.event().dateFrom&&e.event().dateTo?1:-1)}}function Es(t,s){if(t&1&&(o(0,"div",5)(1,"a",6)(2,"i",7),l(3,"arrow_right_alt"),d(),o(4,"span",8),l(5),d()()()),t&2){let e=u();a(),g("routerLink",e.event().evaluationLink),a(4),v("",e.event().evaluationText," ")}}var _i=(()=>{class t{constructor(){this.event=I.required(),this.withRatings=I(!0),this.withDate=I(!0),this.link=y(()=>kn(this.event().detailLink))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-list-entry"]],hostVars:4,hostBindings:function(i,n){i&2&&Y("with-ratings",n.withRatings())("with-date",n.withDate())},inputs:{event:[1,"event"],withRatings:[1,"withRatings"],withDate:[1,"withDate"]},decls:10,vars:9,consts:[[1,"designation"],[3,"routerLink","queryParams"],[1,"date"],[1,"registrations"],[1,"registrations-label"],[1,"rating"],[1,"d-flex",3,"routerLink"],[1,"material-icons"],[1,"ps-1"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"a",1),l(2),d()(),f(3,xs,2,1,"div",2),o(4,"div",3),l(5),o(6,"span",4),l(7),c(8,"translate"),d()(),f(9,Es,6,2,"div",5)),i&2&&(a(),g("routerLink",n.link().link)("queryParams",n.link().params),a(),b(n.event().designation),a(),C(n.withDate()?3:-1),a(2),v(" ",n.event().studentCount," "),a(2),b(p(8,7,n.event().studentCount===1?"events.registration":"events.registrations")),a(2),C(n.withRatings()&&n.event().evaluationText?9:-1))},dependencies:[ne,je,P],styles:['[_nghost-%COMP%]{display:grid;padding:1rem;border-bottom:1px solid #dee2e6;grid-template-areas:"designation registrations";grid-template-columns:4fr 2fr}.with-ratings.with-date[_nghost-%COMP%]{grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}.with-ratings[_nghost-%COMP%]:not(.with-date){grid-template-areas:"designation registrations rating";grid-template-columns:4fr 2fr 3fr}.with-date[_nghost-%COMP%]:not(.with-ratings){grid-template-areas:"designation date registrations";grid-template-columns:4fr 2fr 2fr}.designation[_ngcontent-%COMP%]{grid-area:designation;padding-right:1rem}.date[_ngcontent-%COMP%]{grid-area:date;padding-right:1rem}.registrations[_ngcontent-%COMP%]{grid-area:registrations;padding-right:1rem}.rating[_ngcontent-%COMP%]{grid-area:rating}.rating[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.rating[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.registrations-label[_ngcontent-%COMP%]{display:none}@media(max-width:575.98px){.registrations-label[_ngcontent-%COMP%]{display:inline}.designation[_ngcontent-%COMP%], .date[_ngcontent-%COMP%], .registrations[_ngcontent-%COMP%]{padding-right:0}[_nghost-%COMP%]{grid-template-areas:"designation" "date" "registrations" "rating";grid-template-columns:1fr}}']})}}return t})();var bi=(()=>{class t{constructor(){this.router=m(De),this.loadingService=m(te),this.storageService=m(st),this.eventsRestService=m(gt),this.subscriptionsRestService=m(mt),this.loading$=this.loadingService.loading$,this.searchSubject$=new re(""),this.search$=this.searchSubject$.asObservable(),this.unfilteredStudyCourses$=this.loadStudyCourses().pipe(le(1)),this.studyCourses$=Z([this.unfilteredStudyCourses$,G(["designation"]),this.search$]).pipe(T(ze(ut)))}setSearch(e){this.searchSubject$.next(e)}loadStudyCourses(){let e=this.storageService.getPayload();return this.loadingService.load(this.eventsRestService.getStudyCourseEvents().pipe(T(i=>i.filter(n=>Jn(e,n))),L(this.decorateWithStudentCounts.bind(this)),T(this.createFromStudyCourses.bind(this)),T(i=>[...i].sort((n,r)=>n.designation.localeCompare(r.designation)))),{stopOnFirstValue:!0})}decorateWithStudentCounts(e){return e.length>0?this.subscriptionsRestService.getSubscriptionCountsByEvents(e.map(i=>i.Id)).pipe(T(i=>e.map(n=>B($({},n),{StudentCount:i[n.Id]??0})))):G(e)}createFromStudyCourses(e){return e.map(i=>({id:i.Id,designation:i.Designation,detailLink:this.buildStudentsLink(i.Id),studentCount:i.StudentCount,state:null}))}buildStudentsLink(e){return mi(e,this.router.url)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=X({token:t,factory:t.\u0275fac})}}return t})();var ws=()=>[],Ts=(t,s)=>s.id;function Ms(t,s){t&1&&S(0,"bkd-spinner")}function Ps(t,s){if(t&1&&S(0,"bkd-events-list-entry",6),t&2){let e=s.$implicit;g("event",e)("withRatings",!1)("withDate",!1)}}function Is(t,s){if(t&1&&(o(0,"div",3)(1,"div",4),l(2),c(3,"translate"),d(),o(4,"div",5),l(5),c(6,"translate"),d()(),V(7,Ps,1,3,"bkd-events-list-entry",6,Ts)),t&2){u(2);let e=O(0);a(2),b(p(3,2,"events.designation")),a(3),v(" ",p(6,4,"events.registrations")," "),a(2),N(e)}}function ks(t,s){t&1&&(o(0,"p",2),l(1),c(2,"translate"),d()),t&2&&(a(),v(" ",p(2,1,"events.study-courses.no-study-courses")," "))}function Ds(t,s){if(t&1&&f(0,Is,9,6)(1,ks,3,3,"p",2),t&2){u();let e=O(0);C(e.length>0?0:1)}}var Qa=(()=>{class t{constructor(){this.state=m(bi)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-study-courses-list"]],decls:13,vars:20,consts:[[1,"bkd-container"],[1,"d-flex","search",3,"valueChange","value","placeholder","label","disabled"],[1,"mt-3"],[1,"event-header"],[1,"designation"],[1,"registrations"],[3,"event","withRatings","withDate"]],template:function(i,n){if(i&1){let r=D();R(0),c(1,"async"),o(2,"h1"),l(3),c(4,"translate"),d(),o(5,"div",0)(6,"bkd-resettable-input",1),c(7,"async"),c(8,"translate"),c(9,"translate"),M("valueChange",function(x){return E(r),w(n.state.setSearch(x))}),d(),f(10,Ms,1,0,"bkd-spinner"),c(11,"async"),Be(12,Ds,2,1),d()}if(i&2){let r=W(p(1,6,n.state.studyCourses$)??He(19,ws));a(3),b(p(4,9,"events.study-courses.title")),a(3),g("value",p(7,11,n.state.search$))("placeholder",p(8,13,"events.search-by"))("label",p(9,15,"events.search"))("disabled",!r),a(4),C(p(11,17,n.state.loading$)?10:12)}},dependencies:[vt,de,_i,P,ie],styles:['.search[_ngcontent-%COMP%]{max-width:500px}.event-header[_ngcontent-%COMP%]{display:grid;padding:1rem;border-bottom:2px solid #dee2e6;grid-template-areas:"designation registrations";grid-template-columns:4fr 2fr;font-weight:500}@media(max-width:575.98px){.event-header[_ngcontent-%COMP%]{display:none}}'],changeDetection:0})}}return t})();var Xa=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-study-courses"]],features:[ce([bi])],decls:1,vars:0,template:function(i,n){i&1&&S(0,"router-outlet")},dependencies:[ke],encapsulation:2,changeDetection:0})}}return t})();var Os=()=>[],Ls=(t,s)=>s.id;function Gs(t,s){t&1&&S(0,"bkd-spinner")}function Fs(t,s){t&1&&(o(0,"div",7),l(1),c(2,"translate"),d()),t&2&&(a(),v(" ",p(2,1,"events.rating")," "))}function $s(t,s){if(t&1&&S(0,"bkd-events-list-entry",8),t&2){let e=s.$implicit,i=u(3);g("event",e)("withRatings",i.withRatings)}}function Vs(t,s){if(t&1&&(o(0,"div",3)(1,"div",4),l(2),c(3,"translate"),d(),o(4,"div",5),l(5),c(6,"translate"),d(),o(7,"div",6),l(8),c(9,"translate"),d(),f(10,Fs,3,3,"div",7),d(),V(11,$s,1,2,"bkd-events-list-entry",8,Ls)),t&2){let e=u(2),i=O(0);Y("with-ratings",e.withRatings),a(2),b(p(3,6,"events.designation")),a(3),b(p(6,8,"events.date")),a(3),v(" ",p(9,10,"events.registrations")," "),a(2),C(e.withRatings?10:-1),a(),N(i)}}function Ns(t,s){t&1&&(o(0,"p",2),l(1),c(2,"translate"),d()),t&2&&(a(),b(p(2,1,"events.no-events")))}function Bs(t,s){if(t&1&&f(0,Vs,13,12)(1,Ns,3,3,"p",2),t&2){u();let e=O(0);C(e.length>0?0:1)}}var Za=["designation"],Rs=[...Za,"evaluationText"],Si=(()=>{class t{constructor(){this.state=m(ft),this.storage=m(st),this.withRatings=!0,this.state.setRoles(this.storage.getPayload()?.roles??null)}ngOnChanges(e){e.withRatings&&this.state.setSearchFields(e.withRatings.currentValue?Rs:Za)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-list"]],inputs:{withRatings:"withRatings"},features:[tt],decls:10,vars:17,consts:[[1,"bkd-container"],[1,"d-flex","search",3,"valueChange","value","placeholder","label","disabled"],[1,"mt-3"],[1,"event-header"],[1,"designation"],[1,"date"],[1,"registrations"],[1,"rating"],[3,"event","withRatings"]],template:function(i,n){if(i&1){let r=D();R(0),c(1,"async"),o(2,"div",0)(3,"bkd-resettable-input",1),c(4,"async"),c(5,"translate"),c(6,"translate"),M("valueChange",function(x){return E(r),w(n.state.setSearch(x))}),d(),f(7,Gs,1,0,"bkd-spinner"),c(8,"async"),Be(9,Bs,2,1),d()}if(i&2){let r=W(p(1,5,n.state.getEntries(n.withRatings))??He(16,Os));a(3),g("value",p(4,8,n.state.search$))("placeholder",p(5,10,"events.search-by"))("label",p(6,12,"events.search"))("disabled",!r),a(4),C(p(8,14,n.state.loading$)?7:9)}},dependencies:[vt,de,_i,ie,P],styles:['.search[_ngcontent-%COMP%]{max-width:500px}.event-header[_ngcontent-%COMP%]{display:grid;padding:1rem;border-bottom:2px solid #dee2e6;grid-template-areas:"designation date registrations";grid-template-columns:4fr 2fr 2fr;font-weight:500}.event-header.with-ratings[_ngcontent-%COMP%]{grid-template-areas:"designation date registrations rating";grid-template-columns:4fr 2fr 2fr 3fr}@media(max-width:575.98px){.event-header[_ngcontent-%COMP%]{display:none}}']})}}return t})();var Ja=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-tests"]],decls:4,vars:4,consts:[[3,"withRatings"]],template:function(i,n){i&1&&(o(0,"h1"),l(1),c(2,"translate"),d(),S(3,"bkd-events-list",0)),i&2&&(a(),b(p(2,2,"events.title")),a(2),g("withRatings",!0))},dependencies:[Si,P],encapsulation:2})}}return t})();function er(t){return s=>{let e=Number(s.value);return e<=t?{greaterThan:{value:e,greaterThanValue:t}}:null}}var As=t=>["/events",t,"tests"];function Hs(t,s){if(t&1&&(o(0,"div",7),l(1),c(2,"translate"),d()),t&2){let e=s.$implicit;a(),v(" ",H(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Ws(t,s){if(t&1&&(o(0,"div",7),l(1),c(2,"translate"),d()),t&2){let e=s.$implicit;a(),v(" ",H(2,1,"global.validation-errors."+e.error,e.params)," ")}}function js(t,s){if(t&1&&(o(0,"div",7),l(1),c(2,"translate"),d()),t&2){let e=s.$implicit;a(),v(" ",H(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Us(t,s){if(t&1&&(o(0,"div",7),l(1),c(2,"translate"),d()),t&2){let e=s.$implicit;a(),v(" ",H(2,1,"global.validation-errors."+e.error,e.params)," ")}}function qs(t,s){if(t&1&&(o(0,"div",7),l(1),c(2,"translate"),d()),t&2){let e=s.$implicit;a(),v(" ",H(2,1,"global.validation-errors."+e.error,e.params)," ")}}function zs(t,s){if(t&1&&(o(0,"div",30)(1,"div",31)(2,"div",17)(3,"label",32),l(4),c(5,"translate"),d(),o(6,"div",33),S(7,"input",34),c(8,"async"),V(9,Us,3,4,"div",7,it),c(11,"async"),d()()(),o(12,"div",31)(13,"div",17)(14,"label",35),l(15),c(16,"translate"),d(),o(17,"div",33),S(18,"input",36),c(19,"async"),V(20,qs,3,4,"div",7,it),c(22,"async"),d()()()(),o(23,"div",37),Ai(),o(24,"math")(25,"mi"),l(26),c(27,"translate"),d(),o(28,"mo"),l(29,"="),d(),o(30,"mfrac")(31,"mrow")(32,"mi"),l(33),c(34,"translate"),d(),o(35,"mo"),l(36,"\xD7"),d(),o(37,"mn"),l(38,"5"),d()(),o(39,"mi"),l(40),c(41,"translate"),d()(),o(42,"mo"),l(43,"+"),d(),o(44,"mn"),l(45,"1"),d()()()),t&2){let e,i,n=u(2);a(4),b(p(5,9,"tests.form.max-points")),a(3),Y("is-invalid",((e=p(8,11,n.maxPointsErrors$))==null?null:e.length)||!1),a(2),N(p(11,13,n.maxPointsErrors$)),a(6),b(p(16,15,"tests.form.max-points-adjusted")),a(3),Y("is-invalid",((i=p(19,17,n.maxPointsAdjustedErrors$))==null?null:i.length)||!1),a(2),N(p(22,19,n.maxPointsAdjustedErrors$)),a(6),v(" ",p(27,21,"tests.form.math.grade")," "),a(7),v(" ",p(34,23,"tests.form.math.points")," "),a(7),b(p(41,25,"tests.form.math.max-points"))}}function Ks(t,s){t&1&&(o(0,"div",29)(1,"span",38),l(2,"Loading..."),d()())}function Ys(t,s){if(t&1){let e=D();o(0,"form",2),M("ngSubmit",function(){E(e);let n=u();return w(n.onSubmit())}),o(1,"div",3)(2,"div",4)(3,"label",5),l(4),c(5,"translate"),d(),S(6,"input",6),c(7,"async"),c(8,"translate"),V(9,Hs,3,4,"div",7,it),c(11,"async"),d(),o(12,"div",8)(13,"label",9),l(14),c(15,"translate"),d(),o(16,"div",10)(17,"div",11)(18,"button",12),M("click",function(){E(e);let n=ye(22);return w(n.toggle())}),o(19,"i",13),l(20,"calendar_today"),d()()(),o(21,"input",14,0),c(23,"async"),c(24,"translate"),M("click",function(){E(e);let n=ye(22);return w(n.toggle())}),d(),V(25,Ws,3,4,"div",7,it),c(27,"async"),d()()(),o(28,"div",15)(29,"label",16),l(30),c(31,"translate"),d(),o(32,"div",4)(33,"div",17)(34,"label",18),l(35),c(36,"translate"),d(),o(37,"div",19),S(38,"input",20),c(39,"async"),V(40,js,3,4,"div",7,it),c(42,"async"),d()()()(),o(43,"div")(44,"label",16),l(45),c(46,"translate"),d(),o(47,"div",21),S(48,"input",22),o(49,"label",23),l(50),c(51,"translate"),d()(),o(52,"div",21),S(53,"input",24),o(54,"label",25),l(55),c(56,"translate"),d()(),f(57,zs,46,27),d(),o(58,"div",26)(59,"button",27),c(60,"async"),l(61),c(62,"translate"),d(),o(63,"button",28),l(64),c(65,"translate"),f(66,Ks,3,0,"div",29),d()()()}if(t&2){let e,i,n,r,h=u();g("formGroup",h.formGroup),a(4),b(p(5,26,"tests.form.designation")),a(2),Y("is-invalid",((e=p(7,28,h.designationErrors$))==null?null:e.length)||!1),g("placeholder",p(8,30,"tests.form.designation-placeholder")),a(3),N(p(11,32,h.designationErrors$)),a(5),b(p(15,34,"tests.form.date")),a(4),g("id",h.componentId),a(3),Y("is-invalid",((i=p(23,36,h.dateErrors$))==null?null:i.length)||!1),g("placeholder",p(24,38,"shared.date-select.default-placeholder")),a(4),N(p(27,40,h.dateErrors$)),a(5),b(p(31,42,"tests.form.weight")),a(5),b(p(36,44,"tests.form.factor")),a(3),Y("is-invalid",((n=p(39,46,h.weightErrors$))==null?null:n.length)||!1),a(2),N(p(42,48,h.weightErrors$)),a(5),b(p(46,50,"tests.form.grading-type")),a(3),g("value",!1),a(2),b(p(51,52,"tests.form.grades")),a(3),g("value",!0),a(2),b(p(56,54,"tests.form.points")),a(2),C((r=h.formGroup.get("isPointGrading"))!=null&&r.value?57:-1),a(2),g("disabled",h.saving)("routerLink",F(62,As,p(60,56,h.courseId$))),a(2),v(" ",p(62,58,"tests.form.cancel")," "),a(2),g("disabled",h.saving),a(),v(" ",p(65,60,"tests.form.save")," "),a(2),C(h.saving?66:-1)}}var yi=(()=>{class t{constructor(){this.fb=m(pn),this.translate=m(ee),this.testStateService=m(oe),this.test=null,this.saving=!1,this.save=new _e,this.componentId=xn("bkd-tests-edit-form"),this.formGroup=this.createFormGroup(),this.submitted$=new re(!1),this.destroy$=new ae,this.designationErrors$=lt(G(this.formGroup),this.submitted$,"designation"),this.dateErrors$=lt(G(this.formGroup),this.submitted$,"date"),this.maxPointsErrors$=lt(G(this.formGroup),this.submitted$,"maxPoints"),this.maxPointsAdjustedErrors$=lt(G(this.formGroup),this.submitted$,"maxPointsAdjusted"),this.weightErrors$=lt(G(this.formGroup),this.submitted$,"weight"),this.courseId$=this.testStateService.courseId$}ngOnInit(){this.test&&this.setInitialValues(this.test),Tn(G(this.formGroup),"isPointGrading").pipe(Pe(this.destroy$)).subscribe(this.togglePointFieldsDisability.bind(this))}ngOnDestroy(){this.destroy$.next()}onSubmit(){this.submitted$.next(!0),this.formGroup.valid&&this.save.emit(this.formGroup.value)}createFormGroup(){return this.fb.group({designation:["",rt.required],date:[null,rt.required],weight:[1,rt.compose([rt.required,er(0)])],isPointGrading:[!1],maxPoints:[{value:null,disabled:!0},rt.required],maxPointsAdjusted:[{value:null,disabled:!0},null]})}setInitialValues(e){this.formGroup.patchValue({designation:e.Designation,date:e.Date,weight:e.Weight,isPointGrading:e.IsPointGrading,maxPoints:e.MaxPoints,maxPointsAdjusted:e.MaxPointsAdjusted}),e.Results&&e.Results.length>0&&(this.formGroup.get("isPointGrading")?.disable(),this.formGroup.get("maxPoints")?.disable(),this.formGroup.get("maxPointsAdjusted")?.disable()),this.togglePointFieldsDisability()}togglePointFieldsDisability(){let e=this.formGroup.get("maxPoints"),i=this.formGroup.get("maxPointsAdjusted");this.formGroup.get("isPointGrading")?.value?(e?.enable(),i?.enable()):(e?.reset({value:this.test?.MaxPoints,disabled:!0}),i?.reset({value:this.test?.MaxPointsAdjusted,disabled:!0}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-edit-form"]],inputs:{test:"test",saving:"saving"},outputs:{save:"save"},features:[ce([{provide:un,useClass:vn},{provide:gn,useClass:Qn}])],decls:1,vars:1,consts:[["dp","ngbDatepicker"],[3,"formGroup"],[3,"ngSubmit","formGroup"],[1,"row","g-3","mb-3"],[1,"col-md-6"],["for","designation",1,"form-label"],["id","designation","name","designation","type","text","formControlName","designation","required","",1,"form-control",3,"placeholder"],[1,"invalid-feedback"],[1,"col-md-6","mb-3"],["for","date",1,"form-label"],[1,"input-group"],[1,"input-group-prepend"],["type","button",1,"btn","btn-outline-secondary",3,"click","id"],[1,"material-icons"],["id","date","name","date","type","text","ngbDatepicker","","formControlName","date","required","",1,"form-control",3,"click","placeholder"],[1,"row","mb-3"],[1,"form-label"],[1,"row"],["for","factor",1,"form-label","col-3","col-sm-2"],[1,"col-9","col-sm-10"],["id","factor","name","factor","type","number","formControlName","weight","step","0.05","min","0","required","",1,"form-control"],[1,"form-check"],["type","radio","formControlName","isPointGrading","id","type-grades",1,"form-check-input",3,"value"],["for","type-grades",1,"form-check-label"],["type","radio","formControlName","isPointGrading","id","type-points",1,"form-check-input",3,"value"],["for","type-points",1,"form-check-label"],[1,"d-flex","justify-content-end","mt-4"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","routerLink"],["type","submit",1,"btn","btn-primary","ms-2",3,"disabled"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"row","ms-4","mb-3","g-3"],[1,"col-sm-6","col-md-4"],["for","max-points",1,"ms-2","col-4","col-form-label"],[1,"col-6"],["type","number","name","maxPoints","id","max-points","formControlName","maxPoints","step","0.01","min","0","max","999","required","",1,"form-control"],["for","max-points-adjusted",1,"ms-2","col-4","col-form-label"],["type","number","name","maxPointsAdjusted","id","max-points-adjusted","formControlName","maxPointsAdjusted","step","0.01","min","0","max","999",1,"form-control"],[1,"ms-4","ps-3","py-3"],[1,"visually-hidden"]],template:function(i,n){i&1&&f(0,Ys,67,64,"form",1),i&2&&C(n.formGroup?0:-1)},dependencies:[qe,qt,Wt,zt,sn,jt,Ut,cn,Yt,Kt,mn,ln,dn,hn,ne,ie,P],styles:["#factor[_ngcontent-%COMP%], #max-points[_ngcontent-%COMP%], #max-points-adjusted[_ngcontent-%COMP%]{width:5em}.input-group-prepend[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.375rem .75rem;background-color:var(--bs-tertiary-bg);border-color:#dedede;border-radius:0;height:100%}"]})}}return t})();var tr=(()=>{class t{constructor(){this.courseService=m(xe),this.toastService=m(ot),this.translate=m(ee),this.router=m(De),this.state=m(oe),this.saving$=new re(!1)}save(e){this.saving$.next(!0);let{designation:i,date:n,weight:r,isPointGrading:h,maxPoints:x,maxPointsAdjusted:j}=e;this.state.courseId$.pipe(ge(1),L(Te=>this.courseService.add(Te,n,i,r,h,x,j)),Ot(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.state.reload(),this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}navigateBack(){this.state.courseId$.pipe(ge(1)).subscribe(e=>{this.router.navigate(["events",e,"tests"])})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-add"]],decls:6,vars:6,consts:[[1,"bkd-container","bkd-container-limited"],[3,"save","saving"]],template:function(i,n){i&1&&(o(0,"h1"),l(1),c(2,"translate"),d(),o(3,"div",0)(4,"bkd-tests-edit-form",1),c(5,"async"),M("save",function(h){return n.save(h)}),d()()),i&2&&(a(),b(p(2,2,"tests.add-title")),a(3),g("saving",p(5,4,n.saving$)))},dependencies:[yi,ie,P],encapsulation:2})}}return t})();var ir=(()=>{class t{constructor(){this.activeModal=m(Le)}get canDeleteTest(){return(this.test?.Results?.filter(i=>i.GradeId!==null||i.GradeValue!==null||i.Points!==null)||[]).length===0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-delete"]],inputs:{test:"test"},decls:13,vars:10,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click","hidden"],[1,"px-2"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"],[1,"px-3"]],template:function(i,n){i&1&&(Q(0,"div",0)(1,"p",1),l(2),c(3,"translate"),J()(),Q(4,"div",2)(5,"button",3),$e("click",function(){return n.activeModal.dismiss()}),Q(6,"span",4),l(7),c(8,"translate"),J()(),Q(9,"button",5),$e("click",function(){return n.activeModal.close(n.canDeleteTest?n.test:null)}),Q(10,"span",6),l(11),c(12,"translate"),J()()()),i&2&&(a(2),v(" ",p(3,4,n.canDeleteTest?"tests.form.confirm":"tests.form.delete-not-allowed")," "),a(3),$t("hidden",!n.canDeleteTest),a(2),v(" ",p(8,6,"tests.dialog.no")," "),a(4),v(" ",p(12,8,n.canDeleteTest?"tests.dialog.yes":"tests.dialog.ok")," "))},dependencies:[P],encapsulation:2})}}return t})();var Qs=t=>({test:t});function Xs(t,s){t&1&&S(0,"bkd-spinner")}function Zs(t,s){if(t&1){let e=D();o(0,"div",1)(1,"h1"),l(2),c(3,"translate"),d(),o(4,"button",2),M("click",function(){E(e);let n=u(),r=O(0);return w(n.openDeleteModal(r))}),o(5,"i",3),l(6,"delete"),d()()(),o(7,"bkd-tests-edit-form",4),M("save",function(n){E(e);let r=u();return w(r.save(n))}),d()}if(t&2){u();let e=O(0),i=O(2);a(2),v(" ",H(3,3,"tests.edit-title",F(6,Qs,e.Designation))," "),a(5),g("test",e)("saving",i)}}var nr=(()=>{class t{constructor(){this.state=m(oe),this.courseService=m(xe),this.route=m(ve),this.toastService=m(ot),this.translate=m(ee),this.router=m(De),this.modalService=m(Fe),this.saving$=new re(!1),this.testId$=this.route.paramMap.pipe(T(e=>Number(e.get("testId"))),se()),this.test$=Z([this.state.tests$,this.testId$]).pipe(T(([e,i])=>e.find(n=>n.Id===i)))}openDeleteModal(e){let i=this.modalService.open(ir);i.componentInstance.test=e,i.result.then(n=>{n&&this.courseService.delete(e.CourseId,e.Id).subscribe(this.onDeleteSuccess.bind(this))},()=>{})}save(e){this.saving$.next(!0);let{designation:i,date:n,weight:r,isPointGrading:h,maxPoints:x,maxPointsAdjusted:j}=e;Z([this.state.courseId$,this.testId$]).pipe(ge(1),L(([Te,Je])=>this.courseService.update(Te,Je,i,n,r,h,x,j)),Ot(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.state.reload(),this.toastService.success(this.translate.instant("tests.form.save-success")),this.navigateBack()}onDeleteSuccess(e){this.toastService.success(this.translate.instant("tests.form.delete-success")),this.state.deleteTest(e),this.navigateBack()}navigateBack(){this.state.courseId$.pipe(ge(1)).subscribe(e=>{this.router.navigate(["events",e,"tests"])})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-edit"]],decls:8,vars:9,consts:[[1,"bkd-container","bkd-container-limited"],[1,"d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-primary","btn-icon",3,"click"],[1,"material-icons"],[3,"save","test","saving"]],template:function(i,n){if(i&1&&(R(0),c(1,"async"),R(2),c(3,"async"),o(4,"div",0),f(5,Xs,1,0,"bkd-spinner"),c(6,"async"),Be(7,Zs,8,8),d()),i&2){let r=W(p(1,1,n.test$));a(2),W(p(3,4,n.saving$)),a(3),C(p(6,7,n.state.loading$)?5:r?7:-1)}},dependencies:[yi,de,ie,P],encapsulation:2})}}return t})();var Js=()=>["/events"],ed=t=>({count:t});function td(t,s){if(t&1&&(o(0,"div",7),l(1),c(2,"translate"),d()),t&2){let e=u();a(),v(" ",H(2,1,e.course.ParticipatingStudents.length===1?"courses.registration":"courses.registrations",F(4,ed,e.course.ParticipatingStudents.length))," ")}}var ar=(()=>{class t{constructor(){this.reportsService=m(pt),this.course$=new re(null),this.reports$=this.course$.pipe(T(e=>e?.Id),se(),L(e=>e?this.reportsService.getCourseTestsReports(e):G([])),Me([]))}ngOnChanges(e){e.course&&this.course$.next(e.course.currentValue)}getDesignation(){return pi(this.course)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-header"]],inputs:{course:"course"},features:[tt],decls:12,vars:7,consts:[[3,"link"],[1,"d-flex"],["routerLink","add",1,"edit","btn","btn-primary","btn-icon","ms-2"],[1,"material-icons"],[1,"ms-2",3,"reports"],["id","excel-import"],[1,"d-flex","flex-column","header"],[1,"additional-info"]],template:function(i,n){i&1&&(o(0,"bkd-backlink",0)(1,"div",1)(2,"a",2)(3,"i",3),l(4,"add"),d()(),S(5,"bkd-reports-link",4),c(6,"async"),S(7,"div",5),d()(),o(8,"div",6)(9,"h1"),l(10),d(),f(11,td,3,6,"div",7),d()),i&2&&(g("link",He(6,Js)),a(5),g("reports",p(6,4,n.reports$)),a(5),b(n.getDesignation()),a(),C(n.course.ParticipatingStudents?11:-1))},dependencies:[Ke,ne,ct,ie,P],styles:[".header[_ngcontent-%COMP%]{padding-bottom:1rem;border-bottom:1px solid #dee2e6}h1[_ngcontent-%COMP%]{margin-bottom:0}.additional-info[_ngcontent-%COMP%]{color:#adb5bd}"]})}}return t})();var id=t=>({designation:t}),rr=(()=>{class t{constructor(){this.activeModal=m(Le)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-publish"]],inputs:{test:"test"},decls:11,vars:12,consts:[[1,"modal-body"],["data-testid","confirmation-message"],[1,"modal-footer"],["data-testid","cancel-button","type","button",1,"btn","btn-outline-secondary",3,"click"],["data-testid","confirm-button","type","button",1,"btn","btn-primary",3,"click"]],template:function(i,n){i&1&&(Q(0,"div",0)(1,"p",1),l(2),c(3,"translate"),J()(),Q(4,"div",2)(5,"button",3),$e("click",function(){return n.activeModal.dismiss()}),l(6),c(7,"translate"),J(),Q(8,"button",4),$e("click",function(){return n.activeModal.close(!0)}),l(9),c(10,"translate"),J()()),i&2&&(a(2),v(" ",H(3,3,n.test.IsPublished?"tests.publishing.unpublish":"tests.publishing.publish",F(10,id,n.test.Designation))," "),a(4),v(" ",p(7,6,"tests.publishing.cancel")," "),a(3),v(" ",p(10,8,"tests.publishing.confirm")," "))},dependencies:[P],encapsulation:2})}}return t})();function nd(t,s){if(t&1&&(Q(0,"span",1),l(1),J()),t&2){let e=u();a(),b(e.calculatePointsAverage(e.test))}}var or=(()=>{class t{constructor(){this.locale=m(Xi)}calculatePointsAverage(e){return this.safeAverage(e,2,ii)}calculateGradeAverage(e){return this.safeAverage(e,3,ni)}safeAverage(e,i,n){try{return Un(n(e),this.locale,i)}catch(r){return jn}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-average-grades"]],inputs:{test:"test"},decls:4,vars:2,consts:[[1,"d-flex","flex-row","w-100"],["data-testid","average-points",1,"mr-2","mr-md-3","average-points"],["data-testid","average-grade"]],template:function(i,n){i&1&&(Q(0,"div",0),f(1,nd,2,1,"span",1),Q(2,"span",2),l(3),J()()),i&2&&(a(),C(n.test.IsPointGrading?1:-1),a(2),b(n.calculateGradeAverage(n.test)))},styles:[".average-points[_ngcontent-%COMP%]{min-width:4.5em}@media(min-width:576px){.average-points[_ngcontent-%COMP%]{min-width:6em}}"]})}}return t})();var sr=(()=>{class t{constructor(){this.disabled=!1,this.width="127px",this.gradeIdSelected=new _e}onGradeChange(e){this.gradeId?.valueOf()!==void 0&&this.gradeIdSelected.emit({id:this.gradeId?.valueOf(),selectedGradeId:e})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-grade-select"]],inputs:{options:"options",valueId:"valueId",gradeId:"gradeId",disabled:"disabled",width:"width"},outputs:{gradeIdSelected:"gradeIdSelected"},decls:1,vars:5,consts:[["data-testid","grade-select",3,"valueChange","options","allowEmpty","value","disabled","width"]],template:function(i,n){i&1&&(o(0,"bkd-select",0),M("valueChange",function(h){return n.onGradeChange(h)}),d()),i&2&&g("options",n.options)("allowEmpty",!0)("value",n.valueId)("disabled",n.disabled)("width",n.width)},dependencies:[Ee],encapsulation:2})}}return t})();var ad=t=>({maxPoints:t});function rd(t,s){if(t&1&&(o(0,"div",6)(1,"i",8),l(2,"error_outlined"),d(),l(3),c(4,"translate"),d()),t&2){let e=u(2);a(3),v(" ",H(4,1,"global.validation-errors.invalidPoints",F(4,ad,e.maxPoints))," ")}}function od(t,s){t&1&&(o(0,"div",7)(1,"i",8),l(2,"info_outlined"),d(),l(3),c(4,"translate"),d()),t&2&&(a(3),v(" ",p(4,1,"tests.greater-than-max-points-adjusted")," "))}function sd(t,s){if(t&1){let e=D();o(0,"div",3)(1,"input",5,0),M("ngModelChange",function(){E(e);let n=ye(2),r=u();return w(r.onPointsChange(n.value))}),d(),f(3,rd,5,6,"div",6),f(4,od,5,3,"div",7),d()}if(t&2){let e=ye(2),i=u();a(),Y("is-invalid",e.errors),g("max",Re(i.maxPoints))("tabindex",Re(i.tabIndex))("disabled",i.grade.test.IsPublished||i.hasFinalGrade)("ngModel",i.grade.kind==="grade"?i.grade.result.Points:null),a(2),C(e.errors?3:-1),a(),C(i.isGreaterThanMaxPointsAdjusted(e.value)?4:-1)}}var dd=1250,dr=(()=>{class t{constructor(){this.state=m(oe),this.hasFinalGrade=!1,this.maxPoints=0,this.maxPointsAdjusted=0,this.pointsSubject$=new ae,this.gradeSubject$=new ae,this.gradingScaleDisabledSubject$=new re(!0),this.gradingScaleDisabled$=this.gradingScaleDisabledSubject$.asObservable(),this.destroy$=new ae}ngOnInit(){this.gradingScaleDisabledSubject$.next(this.isGradingScaleDisabled()),this.maxPoints=ha(this.grade),this.maxPointsAdjusted=va(this.grade),this.initSave(this.pointsSubject$.pipe(Qe(this.isValid.bind(this)),T(e=>({studentId:this.student.Id,testId:this.grade.test.Id,points:e?Number(e):null})))),this.initSave(this.gradeSubject$.pipe(T(e=>({studentId:this.student.Id,testId:this.grade.test.Id,gradeId:e}))))}ngOnChanges(){this.gradingScaleDisabledSubject$.next(this.isGradingScaleDisabled())}ngOnDestroy(){this.destroy$.next()}onPointsChange(e){this.pointsSubject$.next(e),this.gradingScaleDisabledSubject$.next(!(e===null||e===""))}onGradeChange(e){this.gradeSubject$.next(e)}isGreaterThanMaxPointsAdjusted(e){let i=Number(e);return this.maxPointsAdjusted>0&&i>this.maxPointsAdjusted&&i<=this.maxPoints}isValid(e){return e===""||e===null?!0:isNaN(Number(e))?!1:!(Number(e)<0||Number(e)>this.maxPoints)}initSave(e){e.pipe(kt(i=>this.state.optimisticallyUpdateGrade(i).pipe(T(n=>({params:i,originalResult:n})))),Dt(dd),Pe(this.destroy$)).subscribe(({params:i,originalResult:n})=>this.state.saveGrade(i,n))}isGradingScaleDisabled(){return this.grade.test.IsPublished||this.hasFinalGrade||this.grade.test.IsPointGrading&&this.grade.kind==="grade"&&this.grade.result.Points!=null}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-grade"]],inputs:{grade:"grade",student:"student",tabIndex:"tabIndex",gradeOptions:"gradeOptions",hasFinalGrade:"hasFinalGrade"},features:[tt],decls:5,vars:8,consts:[["points","ngModel"],[1,"d-flex","flex-column","w-100"],[1,"d-flex","flex-row"],[1,"point-input-container","me-2","me-md-3"],["data-testid","grade-select",1,"grade-select",3,"valueChange","options","allowEmpty","value","disabled","tabindex"],["type","number","step","0.01","min","0","data-testid","point-input",1,"form-control",3,"ngModelChange","max","disabled","tabindex","ngModel"],["data-testid","validation-error-message",1,"invalid-feedback"],[1,"max-points-adjusted-warning"],[1,"material-icons"]],template:function(i,n){i&1&&(o(0,"div",1)(1,"div",2),f(2,sd,5,10,"div",3),o(3,"bkd-select",4),c(4,"async"),M("valueChange",function(h){return n.onGradeChange(h)}),d()()()),i&2&&(a(2),C(n.grade.test.IsPointGrading?2:-1),a(),g("options",n.gradeOptions)("allowEmpty",!0)("value",n.grade.kind==="grade"?n.grade.result.GradeId:null)("disabled",p(4,6,n.gradingScaleDisabled$))("tabindex",n.tabIndex))},dependencies:[qe,Wt,zt,jt,Yt,Kt,on,Ee,ie,P],styles:[".point-input-container[_ngcontent-%COMP%]{width:4em}.point-input-container[_ngcontent-%COMP%]   input.is-invalid[_ngcontent-%COMP%]{padding-right:.75rem;background:#fff}.point-input-container[_ngcontent-%COMP%]   .invalid-feedback[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .point-input-container[_ngcontent-%COMP%]   .max-points-adjusted-warning[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:inline-block;vertical-align:middle;width:24px}.point-input-container[_ngcontent-%COMP%]   .max-points-adjusted-warning[_ngcontent-%COMP%]{width:100%;margin-top:.25rem;font-size:.875em;color:#055160}[_nghost-%COMP%]     select{width:127px}@media(min-width:576px){.point-input-container[_ngcontent-%COMP%]{width:5em}}"]})}}return t})();var lr=(t,s)=>({"btn-primary":t,"btn-outline-secondary":s}),cr=(()=>{class t{constructor(){this.filter=Li,this.filterChange=new _e}showOnlyMine(){this.filterChange.next(B($({},this.filter),{onlyMine:!0}))}showAll(){this.filterChange.next(B($({},this.filter),{onlyMine:!1}))}onHidePublishedChange(e){let i=(e.target&&e.target instanceof HTMLInputElement&&e.target?.checked)??!1;this.filterChange.next(B($({},this.filter),{hidePublished:i}))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-table-filter"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},decls:13,vars:18,consts:[[1,"only-mine-buttons"],["type","button",1,"btn","desktop",3,"click","ngClass"],["type","button",1,"btn","ms-2","desktop",3,"click","ngClass"],[1,"hide-published"],[1,"form-check"],["id","hide-published","type","checkbox",1,"form-check-input",3,"change","checked"],["for","hide-published",1,"form-check-label"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"button",1),M("click",function(){return n.showAll()}),l(2),c(3,"translate"),d(),o(4,"button",2),M("click",function(){return n.showOnlyMine()}),l(5),c(6,"translate"),d()(),o(7,"div",3)(8,"div",4)(9,"input",5),M("change",function(h){return n.onHidePublishedChange(h)}),d(),o(10,"label",6),l(11),c(12,"translate"),d()()()),i&2&&(a(),g("ngClass",wi(12,lr,!n.filter.onlyMine,n.filter.onlyMine)),a(),v(" ",p(3,6,"tests.all-tests")," "),a(2),g("ngClass",wi(15,lr,n.filter.onlyMine,!n.filter.onlyMine)),a(),v(" ",p(6,8,"tests.owned-tests")," "),a(4),g("checked",n.filter.hidePublished),a(2),v(" ",p(12,10,"tests.hide-published")," "))},dependencies:[he,qe,P],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:100%}.only-mine-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;height:3.625rem}.hide-published[_ngcontent-%COMP%]{display:flex;align-items:center;height:2.375rem;margin-bottom:1rem}.hide-published[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:300}.hide-published[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]{margin-bottom:0}"]})}}return t})();var pr=(()=>{class t{constructor(){this.translate=m(ee)}transform(e){return`${e.Weight} (${e.WeightPercent}%)${this.getPoints(e)}`}getPoints(e){return e.IsPointGrading?`, ${e.MaxPointsAdjusted??e.MaxPoints} ${this.translate.instant("tests.summary.points")}`:""}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275pipe=qi({name:"testSummaryShort",type:t,pure:!0})}}return t})();var ld=["*"],mr=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-preserve-line-height"]],ngContentSelectors:ld,decls:3,vars:0,template:function(i,n){i&1&&(Ki(),Q(0,"div"),Yi(1),l(2,"\xA0"),J())},encapsulation:2})}}return t})();var cd=t=>[t,"edit"];function pd(t,s){if(t&1&&(o(0,"a",8)(1,"i",9),l(2,"edit"),d()()),t&2){let e=u(2);g("routerLink",F(1,cd,e.test.Id))}}function md(t,s){if(t&1&&(o(0,"div",5)(1,"div",7)(2,"bkd-preserve-line-height"),l(3),c(4,"date"),d(),f(5,pd,3,3,"a",8),d(),o(6,"bkd-preserve-line-height"),l(7),c(8,"testSummaryShort"),d(),o(9,"bkd-preserve-line-height"),l(10),d()()),t&2){let e=u();a(3),b(H(4,4,e.test.Date,"dd.MM.yyyy")),a(2),C(e.test.IsOwner&&e.test.IsPublished===!1?5:-1),a(2),v(" ",p(8,7,e.test)," "),a(3),b(e.test.Owner)}}function ud(t,s){if(t&1){let e=D();o(0,"div",6)(1,"button",10),c(2,"translate"),M("click",function(){E(e);let n=u();return w(n.unpublishTest())}),o(3,"i",11),l(4,"lock"),d(),o(5,"span"),l(6),c(7,"translate"),d()(),o(8,"bkd-caret",12),M("click",function(){E(e);let n=u();return w(n.emitToggleHeader())}),d()()}if(t&2){let e=u();a(),g("title",Re(p(2,5,"tests.edit")))("disabled",!e.test.IsOwner),a(5),b(p(7,7,"tests.published")),a(2),g("expanded",e.expanded)}}function gd(t,s){if(t&1){let e=D();o(0,"div",6)(1,"button",13),c(2,"translate"),M("click",function(){E(e);let n=u();return w(n.publishTest())}),o(3,"i",11),l(4,"lock_open"),d(),o(5,"span"),l(6),c(7,"translate"),d()(),o(8,"bkd-caret",12),M("click",function(){E(e);let n=u();return w(n.emitToggleHeader())}),d()()}if(t&2){let e=u();a(),g("title",Re(p(2,5,"tests.publish")))("disabled",!e.test.IsOwner),a(5),b(p(7,7,"tests.not-published")),a(2),g("expanded",e.expanded)}}var ur=(()=>{class t{constructor(){this.toggleHeader=new _e,this.publish=new _e,this.unpublish=new _e}emitToggleHeader(){this.toggleHeader.emit(!this.expanded)}publishTest(){this.publish.emit(this.test)}unpublishTest(){this.unpublish.emit(this.test)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-test-table-test-header"]],inputs:{test:"test",expanded:"expanded"},outputs:{toggleHeader:"toggleHeader",publish:"publish",unpublish:"unpublish"},decls:9,vars:5,consts:[[1,"d-flex","flex-column","h-100","justify-content-between"],["role","button",1,"test-designation","d-flex","flex-row","my-3","align-items-end","justify-content-between",3,"click"],[3,"ngClass"],[1,"align-self-start",3,"expanded"],[1,"d-flex","flex-column"],[1,"d-flex","flex-column","mb-3"],[1,"d-flex","align-items-center","justify-content-between","test-status"],[1,"d-flex","flex-row","justify-content-between"],[1,"btn","btn-link","p-0","edit",3,"routerLink"],[1,"material-icons"],["type","button",1,"d-flex","btn","btn-link","ps-0","edit",3,"click","disabled","title"],[1,"material-icons","me-1"],[1,"expand-mobile",3,"click","expanded"],["type","button",1,"d-flex","btn","btn-link","ps-0",3,"click","disabled","title"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"div",1),M("click",function(){return n.emitToggleHeader()}),o(2,"div",2),l(3),d(),S(4,"bkd-caret",3),d(),o(5,"div",4),f(6,md,11,9,"div",5),f(7,ud,9,9,"div",6)(8,gd,9,9,"div",6),d()()),i&2&&(a(2),g("ngClass",n.expanded?"expanded":"collapsed"),a(),v(" ",n.test.Designation," "),a(),g("expanded",n.expanded),a(2),C(n.expanded?6:-1),a(),C(n.test.IsPublished?7:8))},dependencies:[he,$n,mr,ne,je,P,pr],styles:["[_nghost-%COMP%]{font-weight:300}.collapsed[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.test-designation[_ngcontent-%COMP%]{display:none!important}.test-status[_ngcontent-%COMP%]{order:-1;padding-bottom:1rem}.test-status[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{text-decoration:none}.test-status[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:#000}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}.test-status[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}.edit[_ngcontent-%COMP%]{color:#00000080;text-decoration:none}@media(min-width:811px){.test-designation[_ngcontent-%COMP%]{display:inherit!important}.test-status[_ngcontent-%COMP%]{order:initial}.expand-mobile[_ngcontent-%COMP%]{display:none!important}}"]})}}return t})();var hd=["bkdTestsTableHeader",""],vd=t=>({"test-point-grading":t}),fd=t=>({selected:t}),Fi=(t,s)=>s.Id;function Cd(t,s){if(t&1){let e=D();o(0,"th",3)(1,"bkd-test-table-test-header",12),M("toggleHeader",function(n){E(e);let r=u();return w(r.state.toggleHeader(n))})("publish",function(n){E(e);let r=u();return w(r.publish.emit(n))})("unpublish",function(n){E(e);let r=u();return w(r.unpublish.emit(n))}),d()()}if(t&2){let e=s.$implicit,i=u(),n=O(4);g("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),a(),g("test",e)("expanded",n)}}function _d(t,s){if(t&1){let e=D();o(0,"th",4)(1,"bkd-test-table-test-header",12),M("toggleHeader",function(n){E(e);let r=u();return w(r.state.toggleHeader(n))})("publish",function(n){E(e);let r=u();return w(r.publish.emit(n))})("unpublish",function(n){E(e);let r=u();return w(r.unpublish.emit(n))}),d()()}if(t&2){let e=s.$implicit,i=u(),n=O(4);g("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),a(),g("test",e)("expanded",n)}}function bd(t,s){t&1&&(o(0,"div",14),l(1),c(2,"translate"),d()),t&2&&(a(),v(" ",p(2,1,"tests.points")," "))}function Sd(t,s){if(t&1){let e=D();o(0,"th",11)(1,"div",13),f(2,bd,3,3,"div",14),o(3,"bkd-sortable-header",8),c(4,"translate"),K("sortCriteriaChange",function(n){E(e);let r=u();return U(r.state.sortCriteria,n)||(r.state.sortCriteria=n),w(n)}),d()()()}if(t&2){let e=s.$implicit,i=u();g("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),a(2),C(e.IsPointGrading?2:-1),a(),g("label",p(4,5,"tests.grade"))("sortKey","Test-"+e.Id),z("sortCriteria",i.state.sortCriteria)}}var gr=(()=>{class t extends hi{constructor(){super(...arguments),this.state=m(oe),this.publish=new _e,this.unpublish=new _e}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=Gt(t)))(n||t)}})()}static{this.\u0275cmp=_({type:t,selectors:[["thead","bkdTestsTableHeader",""]],inputs:{selectedTest:"selectedTest"},outputs:{publish:"publish",unpublish:"unpublish"},features:[Ft],attrs:hd,decls:27,vars:29,consts:[[1,"header-collapsible"],["colspan","3",1,"desktop","sticky"],[3,"filterChange","filter"],["container","body",1,"test-grade","grade","test-info-desktop",3,"ngClass"],["container","body","colspan","3",1,"test-grade","header-mobile","test-info-mobile",3,"ngClass"],[1,"filler"],[3,"ngClass"],[1,"sticky","student-name"],[3,"sortCriteriaChange","label","sortKey","sortCriteria"],[1,"sticky","student-grade","desktop",3,"ngClass"],[1,"border-end","sticky","student-average","desktop"],["container","body",1,"test-grade",3,"ngClass"],[3,"toggleHeader","publish","unpublish","test","expanded"],[1,"d-flex"],[1,"point-column-title","me-2","me-md-3"]],template:function(i,n){if(i&1){let r=D();R(0),c(1,"async"),R(2),c(3,"async"),R(4),c(5,"async"),o(6,"tr",0)(7,"th",1)(8,"bkd-tests-table-filter",2),M("filterChange",function(x){return E(r),w(n.state.setFilter(x))}),d()(),V(9,Cd,2,3,"th",3,Fi),V(11,_d,2,3,"th",4,Fi),S(13,"th",5),d(),o(14,"tr",6)(15,"th",7)(16,"bkd-sortable-header",8),c(17,"translate"),K("sortCriteriaChange",function(x){return E(r),U(n.state.sortCriteria,x)||(n.state.sortCriteria=x),w(x)}),d()(),o(18,"th",9)(19,"bkd-sortable-header",8),c(20,"translate"),K("sortCriteriaChange",function(x){return E(r),U(n.state.sortCriteria,x)||(n.state.sortCriteria=x),w(x)}),d()(),o(21,"th",10)(22,"bkd-sortable-header",8),c(23,"translate"),K("sortCriteriaChange",function(x){return E(r),U(n.state.sortCriteria,x)||(n.state.sortCriteria=x),w(x)}),d()(),V(24,Sd,5,7,"th",11,Fi),S(26,"th",5),d()}if(i&2){let r=p(1,12,n.state.filteredTests$),h=p(3,14,n.state.filter$);a(4),W(p(5,16,n.state.expandedHeader$)),a(4),g("filter",h),a(),N(r),a(2),N(r),a(3),g("ngClass",F(25,vd,n.selectedTest==null?null:n.selectedTest.IsPointGrading)),a(2),g("label",p(17,19,"tests.student.name"))("sortKey","FullName"),z("sortCriteria",n.state.sortCriteria),a(2),g("ngClass",F(27,fd,n.selectedTest===void 0)),a(),g("label",p(20,21,"tests.grade"))("sortKey","FinalGrade"),z("sortCriteria",n.state.sortCriteria),a(3),g("label",p(23,23,"tests.mean"))("sortKey","TestsMean"),z("sortCriteria",n.state.sortCriteria),a(2),N(r)}},dependencies:[he,cr,ur,ht,ie,P],styles:["[_nghost-%COMP%]{--spacer: 16px;--point-input-size: 4em;--grade-input-size: 17ch;--points-grade-gap: 1rem;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-average-column-width: 120px;--test-grade-column-width: calc( var(--spacer) + var(--point-input-size) + var(--points-grade-gap) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--student-average-column-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) );--test-columns-offset: calc( var(--student-average-column-offset) + var(--student-average-column-width) )}@media(min-width:1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}@media(max-width:767.98px){[_nghost-%COMP%]{--points-grade-gap: calc(.5 * var(--spacer))}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media(min-width:576px){[_nghost-%COMP%]{--point-input-size: 5em}}tr[_ngcontent-%COMP%]:not(.header-collapsible)   th.test-grade[_ngcontent-%COMP%], td.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}@media(max-width:810px){tr[_ngcontent-%COMP%]:not(.header-collapsible):not(.test-point-grading)   th.test-grade[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]:not(.test-point-grading)   th.student-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.test-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.student-grade[_ngcontent-%COMP%]{width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));min-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));max-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer))}}th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media(max-width:810px){th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}th.test-grade[_ngcontent-%COMP%]   .point-column-title[_ngcontent-%COMP%]{width:var(--point-input-size)}@media(max-width:810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-average[_ngcontent-%COMP%], .test-grade[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex;width:100%}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.test-grade[_ngcontent-%COMP%]{flex:none;display:block}}@media(min-width:811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}.student-average[_ngcontent-%COMP%]{width:var(--student-average-column-width);min-width:var(--student-average-column-width);max-width:var(--student-average-column-width)}.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}th.sticky.student-average[_ngcontent-%COMP%], td.sticky.student-average[_ngcontent-%COMP%]{left:var(--student-average-column-offset)}}@media(max-width:1200px){[_nghost-%COMP%]{--student-average-column-width: 1px}.student-average[_ngcontent-%COMP%]{padding:0;overflow:hidden}}@media(min-width:1201px){.student-average-inline[_ngcontent-%COMP%]{display:none}}.sticky[_nghost-%COMP%]{position:fixed;top:0;left:0;z-index:1000;display:none}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;vertical-align:top}.header-collapsible[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:0 1rem}tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:none!important}@media(min-width:811px){.sticky.shown[_nghost-%COMP%]{display:table-header-group}tr[_ngcontent-%COMP%]   th.test-info-mobile[_ngcontent-%COMP%]{display:none!important}tr[_ngcontent-%COMP%]   th.test-info-desktop[_ngcontent-%COMP%]{display:table-cell!important}tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;padding-top:.25rem;padding-bottom:.25rem;border-top:initial}.sticky[_nghost-%COMP%]{margin-left:var(--test-columns-offset)}.sticky[_nghost-%COMP%]   th.sticky[_ngcontent-%COMP%]{position:fixed}}"],changeDetection:0})}}return t})();var yd=t=>({"test-point-grading":t}),hr=t=>({selected:t}),xd=t=>["student",t,"grades"],Ed=t=>({"visible-on-mobile":t}),wd=(t,s)=>s.student.Id,Td=(t,s)=>s.Id,Md=(t,s)=>s.id;function Pd(t,s){if(t&1&&(o(0,"div"),l(1),d()),t&2){let e=u().$implicit;a(),v(" ",e.finalGrade.finalGradeValue," ")}}function Id(t,s){if(t&1){let e=D();o(0,"bkd-grade-select",19),c(1,"async"),c(2,"async"),M("gradeIdSelected",function(n){E(e);let r=u(2);return w(r.state.overwriteFinalGrade(n))}),d()}if(t&2){let e=u().$implicit,i=u();g("options",p(1,4,i.state.gradingOptionsForCourse$()))("valueId",e.finalGrade.gradeId??null)("gradeId",e.finalGrade.gradingId??null)("disabled",p(2,6,i.isEditFinalGradesAllowed(e))===!1)}}function kd(t,s){if(t&1&&(o(0,"td",11),S(1,"bkd-grade",20),c(2,"async"),d()),t&2){let e=s.$implicit,i=s.$index,n=u(),r=n.$implicit,h=n.$index,x=u(),j=e.grade;g("ngClass",x.selectedTest!==void 0&&j.test.Id===x.selectedTest.Id?"selected":""),a(),g("grade",j)("gradeOptions",p(2,6,x.state.gradingOptionsForTest$(j.test)))("student",r.student)("hasFinalGrade",!!r.finalGrade.finalGradeValue)("tabIndex",(1+i)*1e3+h)}}function Dd(t,s){if(t&1&&(o(0,"tr")(1,"td",6)(2,"a",15)(3,"div"),l(4),d(),o(5,"div",8),l(6),c(7,"translate"),c(8,"decimalOrDash"),d()()(),o(9,"td",16),f(10,Pd,2,1,"div")(11,Id,3,8,"bkd-grade-select",17),d(),o(12,"td",18),l(13),c(14,"decimalOrDash"),d(),V(15,kd,3,8,"td",11,Md),S(17,"td",12),d()),t&2){let e=s.$implicit,i=u();a(2),g("routerLink",F(15,xd,e.student.Id)),a(2),b(e.student.FullName),a(2),yt(" ",p(7,7,"tests.mean"),": ",H(8,9,e.finalGrade.average,"1-3")," "),a(3),g("ngClass",F(17,hr,i.selectedTest===void 0)),a(),C(e.finalGrade.finalGradeValue?10:11),a(3),v(" ",H(14,12,e.finalGrade.average,"1-3")," "),a(2),N(i.getGrades(e))}}function Od(t,s){if(t&1&&(o(0,"td",11),S(1,"bkd-average-grades",21),d()),t&2){let e=s.$implicit,i=u();g("ngClass",e.Id===(i.selectedTest==null?null:i.selectedTest.Id)||e.Id===(i.selectedTest==null?null:i.selectedTest.Id)?"selected":""),a(),g("test",e)}}function Ld(t,s){if(t&1){let e=D();o(0,"button",22),M("click",function(){E(e);let n=u();return w(n.setAverageAsFinalGrade())}),l(1),c(2,"translate"),d()}if(t&2){let e=u(),i=O(2);g("ngClass",F(4,Ed,!i||!e.selectedTest)),a(),v(" ",p(2,2,"tests.set-final-grade")," ")}}var vr=(()=>{class t{constructor(){this.state=m(oe),this.modalService=m(Fe),this.destroy$=new ae,this.sticky=At(Ye)}ngOnInit(){this.state.sortCriteria.set({primarySortKey:"FullName",ascending:!0}),Z([this.state.filteredTests$,this.state.expandedHeader$]).pipe(Pe(this.destroy$)).subscribe(()=>this.sticky()?.refresh())}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setAverageAsFinalGrade(){this.state.course$.pipe(ge(1)).subscribe(e=>this.state.setAveragesAsFinalGrades({CourseIds:[e.Id]}))}isEditFinalGradesAllowed(e){return this.state.course$.pipe(T(i=>!!(ci(i)?.value&&e.finalGrade?.canGrade)))}getGrades(e){return e.grades.flatMap(i=>({id:`${e.student.Id}-${i.test.Id}`,grade:i}))}publish(e){let i=this.openModal(e);this.onCloseModal(i,()=>this.state.publish(e))}unpublish(e){let i=this.openModal(e);this.onCloseModal(i,()=>this.state.unpublish(e))}calculatePointsAverage(e){return this.safeAverage(e,ii)}calculateGradeAverage(e){return this.safeAverage(e,ni)}safeAverage(e,i){try{return i(e).toString()}catch(n){return"\u2013"}}openModal(e){let i=this.modalService.open(rr);return i.componentInstance.test=e,i}onCloseModal(e,i){e.result.then(n=>{n&&i()},()=>{})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-table"]],viewQuery:function(i,n){i&1&&Bt(n.sticky,Ye,5),i&2&&Rt()},inputs:{selectedTest:"selectedTest"},features:[ce([ft])],decls:40,vars:45,consts:[["inlineHeader",""],["stickyHeader",""],[1,"table-responsive-wrapper"],["bkdTableHeaderSticky","",1,"table","table-hover","h-100",3,"ngClass","inlineHeader","stickyHeader"],["bkdTestsTableHeader","",3,"publish","unpublish","selectedTest"],["bkdTestsTableHeader","",3,"publish","unpublish","sticky","selectedTest"],[1,"sticky","student-name"],[1,"d-flex","flex-column"],[1,"student-average-inline"],[1,"desktop","sticky","student-grade",3,"ngClass"],[1,"desktop","border-end","sticky","student-average"],[1,"test-grade",3,"ngClass"],[1,"filler"],[1,"action-buttons"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"ngClass"],[3,"routerLink"],[1,"sticky","student-grade",3,"ngClass"],[3,"options","valueId","gradeId","disabled"],[1,"border-end","sticky","student-average"],[3,"gradeIdSelected","options","valueId","gradeId","disabled"],[3,"grade","gradeOptions","student","hasFinalGrade","tabIndex"],[3,"test"],["data-testId","apply-average-button","type","button",1,"apply-average-button","btn","btn-primary","m-3",3,"click","ngClass"]],template:function(i,n){if(i&1){let r=D();R(0),c(1,"async"),R(2),c(3,"async"),R(4),c(5,"async"),o(6,"div",2)(7,"table",3)(8,"thead",4,0),M("publish",function(x){return E(r),w(n.publish(x))})("unpublish",function(x){return E(r),w(n.unpublish(x))}),d(),o(10,"thead",5,1),M("publish",function(x){return E(r),w(n.publish(x))})("unpublish",function(x){return E(r),w(n.unpublish(x))}),d(),o(12,"tbody"),V(13,Dd,18,19,"tr",null,wd),o(15,"tr")(16,"td",6)(17,"div",7)(18,"div"),l(19),c(20,"translate"),d(),o(21,"div",8),l(22),c(23,"translate"),c(24,"async"),c(25,"decimalOrDash"),d()()(),o(26,"td",9),l(27),c(28,"async"),c(29,"decimalOrDash"),d(),o(30,"td",10),l(31),c(32,"async"),c(33,"decimalOrDash"),d(),V(34,Od,2,2,"td",11,Td),S(36,"td",12),d()()(),o(37,"div",13),f(38,Ld,3,6,"button",14),c(39,"async"),d()()}if(i&2){let r=ye(9),h=ye(11),x=p(1,13,n.state.filteredTests$);a(2),W(p(3,15,n.state.hasTests$));let j=p(5,18,n.state.studentGrades$);a(5),g("ngClass",F(41,yd,n.selectedTest==null?null:n.selectedTest.IsPointGrading))("inlineHeader",r)("stickyHeader",h),a(),g("selectedTest",n.selectedTest),a(2),g("sticky",!0)("selectedTest",n.selectedTest),a(3),N(j),a(6),b(p(20,20,"tests.average")),a(3),yt(" ",p(23,22,"tests.mean"),": ",H(25,26,p(24,24,n.state.meanOfStudentGradesForCourse$),"1-3")," "),a(4),g("ngClass",F(43,hr,n.selectedTest===void 0)),a(),v(" ",H(29,31,p(28,29,n.state.meanOfFinalGradesForCourse$),"1-3")," "),a(4),v(" ",H(33,36,p(32,34,n.state.meanOfStudentGradesForCourse$),"1-3")," "),a(3),N(x),a(4),C(p(39,39,n.state.canSetFinalGrade$)?38:-1)}},dependencies:[he,ne,sr,dr,or,Ye,gr,ie,P,ri],styles:["[_nghost-%COMP%]{--spacer: 16px;--point-input-size: 4em;--grade-input-size: 17ch;--points-grade-gap: 1rem;--student-name-column-width: 225px;--student-grade-column-width: calc( var(--spacer) + var(--grade-input-size) + var(--spacer) );--student-average-column-width: 120px;--test-grade-column-width: calc( var(--spacer) + var(--point-input-size) + var(--points-grade-gap) + var(--grade-input-size) + var(--spacer) );--student-grade-column-offset: var(--student-name-column-width);--student-average-column-offset: calc( var(--student-grade-column-offset) + var(--student-grade-column-width) );--test-columns-offset: calc( var(--student-average-column-offset) + var(--student-average-column-width) )}@media(min-width:1000px){[_nghost-%COMP%]{--student-name-column-width: 275px}}@media(max-width:767.98px){[_nghost-%COMP%]{--points-grade-gap: calc(.5 * var(--spacer))}}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{vertical-align:middle}@media(min-width:576px){[_nghost-%COMP%]{--point-input-size: 5em}}tr[_ngcontent-%COMP%]:not(.header-collapsible)   th.test-grade[_ngcontent-%COMP%], td.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}@media(max-width:810px){tr[_ngcontent-%COMP%]:not(.header-collapsible):not(.test-point-grading)   th.test-grade[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]:not(.test-point-grading)   th.student-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.test-grade[_ngcontent-%COMP%], table[_ngcontent-%COMP%]:not(.test-point-grading)   td.student-grade[_ngcontent-%COMP%]{width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));min-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer));max-width:calc(var(--spacer) + var(--grade-input-size) + var(--spacer))}}th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{padding:0;width:auto}@media(max-width:810px){th.filler[_ngcontent-%COMP%], .header-collapsible[_ngcontent-%COMP%]   th.filler[_ngcontent-%COMP%], td.filler[_ngcontent-%COMP%]{width:0}}th.test-grade[_ngcontent-%COMP%]   .point-column-title[_ngcontent-%COMP%]{width:var(--point-input-size)}@media(max-width:810px){.desktop[_ngcontent-%COMP%]:not(.selected), .student-grade[_ngcontent-%COMP%]:not(.selected), .student-average[_ngcontent-%COMP%], .test-grade[_ngcontent-%COMP%]:not(.selected){display:none}table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}th[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{display:flex;width:100%}.student-name[_ngcontent-%COMP%]{flex:1;display:block;padding-right:0}.test-grade[_ngcontent-%COMP%]{flex:none;display:block}}@media(min-width:811px){.mobile[_ngcontent-%COMP%]{display:none}.student-name[_ngcontent-%COMP%]{width:var(--student-name-column-width);min-width:var(--student-name-column-width);max-width:var(--student-name-column-width)}.student-grade[_ngcontent-%COMP%]{width:var(--student-grade-column-width);min-width:var(--student-grade-column-width);max-width:var(--student-grade-column-width)}.student-average[_ngcontent-%COMP%]{width:var(--student-average-column-width);min-width:var(--student-average-column-width);max-width:var(--student-average-column-width)}.test-grade[_ngcontent-%COMP%]{width:var(--test-grade-column-width);min-width:var(--test-grade-column-width);max-width:var(--test-grade-column-width)}th.sticky[_ngcontent-%COMP%], td.sticky[_ngcontent-%COMP%]{position:sticky;left:0;background-color:#fff}th.sticky.student-grade[_ngcontent-%COMP%], td.sticky.student-grade[_ngcontent-%COMP%]{left:var(--student-grade-column-offset)}th.sticky.student-average[_ngcontent-%COMP%], td.sticky.student-average[_ngcontent-%COMP%]{left:var(--student-average-column-offset)}}@media(max-width:1200px){[_nghost-%COMP%]{--student-average-column-width: 1px}.student-average[_ngcontent-%COMP%]{padding:0;overflow:hidden}}@media(min-width:1201px){.student-average-inline[_ngcontent-%COMP%]{display:none}}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child{text-decoration:underline}tbody[_ngcontent-%COMP%]   td.student-name[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child:hover{text-decoration-color:#ea161f}.student-average-inline[_ngcontent-%COMP%]{color:#4e4e4ef2;font-size:.875rem;line-height:1}@media(min-width:811px){.table-responsive-wrapper[_ngcontent-%COMP%]{display:block;overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.action-buttons[_ngcontent-%COMP%]{position:sticky;left:0}}@media(max-width:810px){.apply-average-button[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]})}}return t})();var Gd=()=>[],Fd=t=>({"visible-on-mobile":t}),$d=t=>["/events",t,"evaluation"],Vd=t=>({returnlink:t});function Nd(t,s){t&1&&S(0,"bkd-spinner")}function Bd(t,s){if(t&1){let e=D();o(0,"bkd-select",4),M("valueChange",function(n){E(e);let r=u(2);return w(n&&r.testSelected(n))}),d(),S(1,"bkd-tests-table",5)}if(t&2){u(2);let e=O(6),i=O(8),n=O(10);g("options",e)("value",i)("allowEmpty",!1),a(),g("selectedTest",n)}}function Rd(t,s){t&1&&(o(0,"p",2),l(1),c(2,"translate"),d()),t&2&&(a(),b(p(2,1,"tests.no-tests")))}function Ad(t,s){if(t&1&&(o(0,"a",3)(1,"i",6),l(2,"arrow_right_alt"),d(),o(3,"span",7),l(4),c(5,"translate"),d()()),t&2){u(2);let e=O(0),i=O(4),n=O(10);g("ngClass",F(6,Fd,!i||!n))("routerLink",F(8,$d,e==null?null:e.Id))("queryParams",F(10,Vd,"/events/"+(e==null?null:e.Id)+"/tests")),a(4),b(p(5,4,"tests.link-to-rating-overview"))}}function Hd(t,s){if(t&1&&(S(0,"bkd-tests-header",1),f(1,Bd,2,4)(2,Rd,3,3,"p",2),f(3,Ad,6,12,"a",3),c(4,"async")),t&2){let e=u(),i=O(0),n=O(2);g("course",i),a(),C(n.length>0?1:2),a(2),C(i&&p(4,3,e.state.canSetFinalGrade$)?3:-1)}}var fr=(()=>{class t{constructor(){this.settings=m(fe),this.state=m(oe),this.translate=m(ee),this.selectTest$=new ae,this.testOptions$=this.state.tests$.pipe(T(e=>[{Key:-1,Value:this.translate.instant("tests.grade")},...e.map(i=>({Key:i.Id,Value:i.Designation}))]),se()),this.selectedTestId$=Pt(this.selectTest$,this.state.tests$.pipe(ge(1),T(e=>e[0]?.Id))).pipe(se()),this.selectedTest$=this.selectedTestId$.pipe(L(e=>this.state.tests$.pipe(T(i=>i.find(n=>n.Id===e)))),se())}testSelected(e){this.selectTest$.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests-list"]],decls:16,vars:22,consts:[[1,"bkd-container"],[3,"course"],[1,"mt-3","px-3"],[1,"rating-overview","d-flex","justify-content-end","pe-3","border-top","pt-3",3,"ngClass","routerLink","queryParams"],["width","100%",1,"tests-dropdown",3,"valueChange","options","value","allowEmpty"],[3,"selectedTest"],[1,"material-icons","fw-bold"],[1,"ps-1"]],template:function(i,n){i&1&&(R(0),c(1,"async"),R(2),c(3,"async"),R(4),c(5,"async"),R(6),c(7,"async"),R(8),c(9,"async"),R(10),c(11,"async"),o(12,"div",0),f(13,Nd,1,0,"bkd-spinner"),c(14,"async"),Be(15,Hd,5,5),d()),i&2&&(W(p(1,1,n.state.course$)),a(2),W(p(3,4,n.state.tests$)??He(21,Gd)),a(2),W(p(5,7,n.state.hasTests$)),a(2),W(p(7,10,n.testOptions$)),a(2),W(p(9,13,n.selectedTestId$)),a(2),W(p(11,16,n.selectedTest$)),a(3),C(p(14,19,n.state.loading$)?13:15))},dependencies:[ar,Ee,vr,he,de,ne,ie,P],styles:[".tests-dropdown[_ngcontent-%COMP%]{display:block;padding:1rem 0}@media(min-width:811px){.tests-dropdown[_ngcontent-%COMP%]{display:none}}a.rating-overview[_ngcontent-%COMP%]{text-decoration:none}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-decoration:underline}a.rating-overview[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration-color:#ea161f}@media(max-width:810px){a.rating-overview[_ngcontent-%COMP%]:not(.visible-on-mobile){display:none!important}}"]})}}return t})();var Cr=(()=>{class t{constructor(){this.state=m(oe),this.route=m(ve),this.courseId$=this.route.paramMap.pipe(T(e=>Number(e.get("id"))),se()),this.destroy$=new ae}ngOnInit(){this.courseId$.pipe(Pe(this.destroy$)).subscribe(e=>this.state.setCourseId(e))}ngOnDestroy(){this.destroy$.next()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-tests"]],features:[ce([oe])],decls:1,vars:0,template:function(i,n){i&1&&S(0,"router-outlet")},dependencies:[ke],encapsulation:2})}}return t})();var _r=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["bkd-events-current-list"]],decls:4,vars:4,consts:[[3,"withRatings"]],template:function(i,n){i&1&&(o(0,"h1"),l(1),c(2,"translate"),d(),S(3,"bkd-events-list",0)),i&2&&(a(),b(p(2,2,"events.current.title")),a(2),g("withRatings",!1))},dependencies:[Si,P],encapsulation:2,changeDetection:0})}}return t})();var y_=[{path:"study-courses",component:Xa,children:[{path:"",component:Qa},$i(":id")]},{path:"",component:ia,children:[{path:"current",children:[{path:"",component:_r},$i(":id")]},{path:"",component:Ja},{path:":id",component:Cr,children:[{path:"tests",children:[{path:"",component:fr},{path:":testId/edit",component:nr},{path:"add",component:tr},oi]},{path:"evaluation",component:$a,children:[{path:"",component:Da},{path:"statistic",component:Fa},oi]},$i("students")]}]}];function $i(t){return{path:t,component:Ya,children:[{path:"",component:Ua},{path:"study-course-student/:id",component:Ka},oi]}}export{mi as a,y_ as b,$i as c};
