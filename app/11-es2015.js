(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{pXY1:function(e,t,n){"use strict";n.r(t),n.d(t,"EditAbsencesModule",function(){return Je});var s=n("PCNd"),c=n("tyNb"),i=n("itXk"),a=n("UXun"),r=n("lJxs"),l=n("1G5W"),o=n("v6cN"),b=n("CCnw"),d=n("CqUA"),u=n("KJh6"),p=n("FJ3f"),h=n("eB9A"),f=n("NPit"),g=n("fhBx"),m=n("Xr/R"),y=n("2jKe"),v=n("fXoL"),S=n("ofXK");let z=(()=>{class e extends g.b{constructor(e,t,n,s,c,o){super(e,t,n,"/edit-absences"),this.lessonPresencesService=s,this.presenceTypesService=c,this.dropDownItemsService=o,this.presenceTypes$=this.loadPresenceTypes().pipe(Object(a.a)(1)),this.absenceConfirmationStates$=this.loadAbsenceConfirmationStates().pipe(Object(r.a)(p.b),Object(a.a)(1)),this.presenceControlEntries$=Object(i.a)([this.entries$,this.presenceTypes$,this.absenceConfirmationStates$]).pipe(Object(r.a)(Object(h.a)(y.a)),Object(a.a)(1)),this.selected=[],this.queryParamsString$.pipe(Object(l.a)(this.destroy$)).subscribe(e=>this.confirmBackLinkParams={returnparams:e})}resetSelection(){this.selected=[]}getInitialFilter(){return{student:null,educationalEvent:null,studyClass:null,dateFrom:null,dateTo:null,presenceTypes:null,confirmationStates:null,incidentTypes:null}}isValidFilter(e){return Boolean(e.student||e.educationalEvent||e.studyClass||e.dateFrom||e.dateTo||e.presenceTypes||e.confirmationStates||e.incidentTypes)}loadEntries(e,t,n){return this.loadingService.load(this.lessonPresencesService.getFilteredList(e,n,{sort:"StudentFullName.asc,LessonDateTimeFrom.asc"}),g.a)}buildParamsFromFilter(e){return Object(f.a)(e)}loadPresenceTypes(){return this.loadingService.load(this.presenceTypesService.activePresenceTypes$)}loadAbsenceConfirmationStates(){return this.loadingService.load(this.dropDownItemsService.getAbsenceConfirmationStates())}}return e.\u0275fac=function(t){return new(t||e)(v.Zb(S.i),v.Zb(d.a),v.Zb(m.a),v.Zb(b.a),v.Zb(u.a),v.Zb(o.a))},e.\u0275prov=v.Ib({token:e,factory:e.\u0275fac}),e})();var I=n("qUtt"),R=n("0HM3");let O=(()=>{class e{constructor(e){this.state=e}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(v.Mb(z))},e.\u0275cmp=v.Gb({type:e,selectors:[["erz-edit-absences"]],features:[v.yb([z,{provide:I.a,useExisting:z},{provide:R.a,useValue:"/edit-absences"}])],decls:1,vars:0,template:function(e,t){1&e&&v.Nb(0,"router-outlet")},directives:[c.k],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),e})();var C=n("XNiG"),$=n("IzEk"),T=n("wO+i"),P=n("pLZG"),j=n("ulei");let D=(()=>{class e extends j.a{}return e.\u0275fac=function(t){return F(t||e)},e.\u0275prov=v.Ib({token:e,factory:e.\u0275fac}),e})();const F=v.Ub(D);var k=n("yl8S"),E=n("KCaQ"),x=n("K+0v"),A=n("EOpz"),B=n("1kSV"),M=n("M34a"),w=n("vlqf"),G=n("YDIV"),q=n("PAVU"),N=n("vjgy"),L=n("mmcK"),V=n("4vbw"),_=n("sYmb"),K=n("jSy9"),H=n("DKSB"),Z=n("/N9o");let X=(()=>{class e{constructor(e,t,n,s,c){this.studentsService=e,this.educationalEventsService=t,this.studyClassService=n,this.state=s,this.translate=c,this.filter={student:null,educationalEvent:null,studyClass:null,dateFrom:null,dateTo:null,presenceTypes:null,confirmationStates:null,incidentTypes:null},this.filterChange=new v.n,this.absenceConfirmationStatesGrouped$=this.state.absenceConfirmationStates$.pipe(Object(r.a)(e=>Object(q.a)(e,this.translate.instant("shared.multiselect.all-option")))),this.presenceTypesGrouped$=this.state.presenceTypes$.pipe(Object(r.a)(e=>e.filter(Object(x.d)(w.d)).filter(Object(x.d)(w.f))),Object(r.a)(q.c),Object(r.a)(q.b),Object(r.a)(e=>Object(q.a)(e,this.translate.instant("shared.multiselect.all-option")))),this.incidentTypesGrouped$=this.state.presenceTypes$.pipe(Object(r.a)(e=>e.filter(w.f)),Object(r.a)(q.c),Object(r.a)(q.b),Object(r.a)(e=>Object(q.a)(e,this.translate.instant("shared.multiselect.all-option")))),this.classesHttpFilter={params:{fields:"IsActive","filter.IsActive":"=true"}}}ngOnInit(){}show(){this.filterChange.emit(Object.assign(Object.assign({},this.filter),{dateFrom:J(this.filter.dateFrom),dateTo:J(this.filter.dateTo)}))}}return e.\u0275fac=function(t){return new(t||e)(v.Mb(L.a),v.Mb(N.a),v.Mb(V.a),v.Mb(z),v.Mb(_.d))},e.\u0275cmp=v.Gb({type:e,selectors:[["erz-edit-absences-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},features:[v.yb([{provide:B.c,useClass:B.d},{provide:B.e,useClass:G.a}])],decls:49,vars:48,consts:[[1,"filters","mb-2"],[1,"form-group"],[3,"typeaheadService","value","valueChange"],[3,"typeaheadService","value","additionalHttpParams","valueChange"],[3,"value","valueChange"],[1,"filters","mt-2"],[3,"options","values","valuesChange"],[1,"buttons"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(e,t){1&e&&(v.Sb(0,"div",0),v.Sb(1,"div",1),v.Sb(2,"label"),v.Dc(3),v.gc(4,"translate"),v.Rb(),v.Sb(5,"erz-typeahead",2),v.dc("valueChange",function(e){return t.filter.student=e}),v.Rb(),v.Rb(),v.Sb(6,"div",1),v.Sb(7,"label"),v.Dc(8),v.gc(9,"translate"),v.Rb(),v.Sb(10,"erz-typeahead",2),v.dc("valueChange",function(e){return t.filter.educationalEvent=e}),v.Rb(),v.Rb(),v.Sb(11,"div",1),v.Sb(12,"label"),v.Dc(13),v.gc(14,"translate"),v.Rb(),v.Sb(15,"erz-typeahead",3),v.dc("valueChange",function(e){return t.filter.studyClass=e}),v.Rb(),v.Rb(),v.Sb(16,"div",1),v.Sb(17,"label"),v.Dc(18),v.gc(19,"translate"),v.Rb(),v.Sb(20,"erz-date-select",4),v.dc("valueChange",function(e){return t.filter.dateFrom=e}),v.Rb(),v.Rb(),v.Sb(21,"div",1),v.Sb(22,"label"),v.Dc(23),v.gc(24,"translate"),v.Rb(),v.Sb(25,"erz-date-select",4),v.dc("valueChange",function(e){return t.filter.dateTo=e}),v.Rb(),v.Rb(),v.Rb(),v.Sb(26,"div",5),v.Sb(27,"div",1),v.Sb(28,"label"),v.Dc(29),v.gc(30,"translate"),v.Rb(),v.Sb(31,"erz-multiselect",6),v.dc("valuesChange",function(e){return t.filter.confirmationStates=e}),v.gc(32,"async"),v.Rb(),v.Rb(),v.Sb(33,"div",1),v.Sb(34,"label"),v.Dc(35),v.gc(36,"translate"),v.Rb(),v.Sb(37,"erz-multiselect",6),v.dc("valuesChange",function(e){return t.filter.presenceTypes=e}),v.gc(38,"async"),v.Rb(),v.Rb(),v.Sb(39,"div",1),v.Sb(40,"label"),v.Dc(41),v.gc(42,"translate"),v.Rb(),v.Sb(43,"erz-multiselect",6),v.dc("valuesChange",function(e){return t.filter.incidentTypes=e}),v.gc(44,"async"),v.Rb(),v.Rb(),v.Sb(45,"div",7),v.Sb(46,"button",8),v.dc("click",function(){return t.show()}),v.Dc(47),v.gc(48,"translate"),v.Rb(),v.Rb(),v.Rb()),2&e&&(v.zb(3),v.Ec(v.hc(4,24,"edit-absences.header.student")),v.zb(2),v.lc("typeaheadService",t.studentsService)("value",t.filter.student),v.zb(3),v.Ec(v.hc(9,26,"edit-absences.header.module-instance")),v.zb(2),v.lc("typeaheadService",t.educationalEventsService)("value",t.filter.educationalEvent),v.zb(3),v.Ec(v.hc(14,28,"edit-absences.header.study-class")),v.zb(2),v.lc("typeaheadService",t.studyClassService)("value",t.filter.studyClass)("additionalHttpParams",t.classesHttpFilter),v.zb(3),v.Ec(v.hc(19,30,"edit-absences.header.date-from")),v.zb(2),v.lc("value",t.filter.dateFrom),v.zb(3),v.Ec(v.hc(24,32,"edit-absences.header.date-to")),v.zb(2),v.lc("value",t.filter.dateTo),v.zb(4),v.Ec(v.hc(30,34,"edit-absences.header.confirmation-state")),v.zb(2),v.lc("options",v.hc(32,36,t.absenceConfirmationStatesGrouped$))("values",t.filter.confirmationStates),v.zb(4),v.Ec(v.hc(36,38,"edit-absences.header.presence-type")),v.zb(2),v.lc("options",v.hc(38,40,t.presenceTypesGrouped$))("values",t.filter.presenceTypes),v.zb(4),v.Ec(v.hc(42,42,"edit-absences.header.incident")),v.zb(2),v.lc("options",v.hc(44,44,t.incidentTypesGrouped$))("values",t.filter.incidentTypes),v.zb(4),v.Fc(" ",v.hc(48,46,"edit-absences.header.show")," "))},directives:[K.a,H.a,Z.a],pipes:[_.c,S.b],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1.5rem;border-bottom:1px solid #dee2e6}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.form-group[_ngcontent-%COMP%]{flex:1;min-width:20rem;max-width:40rem;margin-right:1.5rem;margin-bottom:.75rem}.buttons[_ngcontent-%COMP%]{flex:none;margin-top:2.75rem;margin-right:0}@media (max-width:767.98px){.buttons[_ngcontent-%COMP%]{width:100%;margin-top:1.5rem;margin-bottom:1.5rem}}"],changeDetection:0}),e})();function J(e){return e?Object(M.a)(e):null}var U=n("dlKe"),Q=n("4Kj8");const Y=function(e){return{count:e}},W=function(e){return{returnparams:e}};function ee(e,t){if(1&e&&(v.Sb(0,"div",12),v.Sb(1,"div",13),v.Dc(2),v.gc(3,"translate"),v.gc(4,"async"),v.gc(5,"translate"),v.Rb(),v.Sb(6,"a",14),v.gc(7,"async"),v.Sb(8,"i",15),v.Dc(9,"edit"),v.Rb(),v.Rb(),v.Rb()),2&e){const e=v.fc(4).erzLet,t=v.fc();v.zb(2),v.Gc(" ",v.ic(3,5,"edit-absences.list.total",v.pc(15,Y,v.hc(4,8,t.state.total$)||0)),", ",v.ic(5,10,"edit-absences.list.selected",v.pc(17,Y,e.selection.length))," "),v.zb(4),v.Eb("disabled",0===e.selection.length),v.lc("queryParams",v.pc(19,W,v.hc(7,13,t.state.queryParamsString$)))}}const te=function(e){return["student",e]};function ne(e,t){if(1&e){const e=v.Tb();v.Sb(0,"tr"),v.Sb(1,"td",20),v.dc("click",function(t){v.vc(e);const n=v.uc(3);return v.fc(6).onCheckboxCellClick(t,n)}),v.Sb(2,"input",17,21),v.dc("change",function(){v.vc(e);const n=t.$implicit;return v.fc(6).selectionService.toggle(n.lessonPresence)}),v.gc(4,"async"),v.Rb(),v.Rb(),v.Sb(5,"td",18),v.gc(6,"translate"),v.Sb(7,"span",22),v.Sb(8,"i",15),v.Dc(9),v.Rb(),v.Rb(),v.Rb(),v.Sb(10,"td"),v.gc(11,"translate"),v.Sb(12,"a",23),v.gc(13,"async"),v.Dc(14),v.Rb(),v.Nb(15,"br"),v.Dc(16),v.Rb(),v.Sb(17,"td"),v.gc(18,"translate"),v.Dc(19),v.gc(20,"date"),v.Rb(),v.Sb(21,"td"),v.gc(22,"translate"),v.Dc(23),v.gc(24,"date"),v.gc(25,"date"),v.Rb(),v.Sb(26,"td"),v.gc(27,"translate"),v.Dc(28),v.Rb(),v.Sb(29,"td",24),v.gc(30,"translate"),v.Dc(31),v.Rb(),v.Sb(32,"td"),v.gc(33,"translate"),v.Dc(34),v.Rb(),v.Rb()}if(2&e){const e=t.$implicit,n=v.fc(6);v.zb(2),v.lc("checked",v.hc(4,21,n.selectionService.isSelected$(e.lessonPresence))),v.zb(3),v.Ab("data-label",v.hc(6,23,"edit-absences.list.header.presence")),v.zb(2),v.lc("className",e.presenceCategory),v.zb(2),v.Ec(e.presenceCategoryIcon),v.zb(1),v.Ab("data-label",v.hc(11,25,"edit-absences.list.header.mobil-student-module-instance-study-class")),v.zb(2),v.lc("routerLink",v.pc(48,te,e.lessonPresence.StudentRef.Id))("queryParams",v.pc(50,W,v.hc(13,27,n.profileReturnParams$))),v.zb(2),v.Fc(" ",e.lessonPresence.StudentFullName," "),v.zb(2),v.Gc(" ",e.lessonPresence.EventDesignation,", ",e.lessonPresence.StudyClassNumber," "),v.zb(1),v.Ab("data-label",v.hc(18,29,"edit-absences.list.header.date")),v.zb(2),v.Fc(" ",v.ic(20,31,e.lessonPresence.LessonDateTimeFrom,"mediumDate")," "),v.zb(2),v.Ab("data-label",v.hc(22,34,"edit-absences.list.header.time")),v.zb(2),v.Gc(" ",v.ic(24,36,e.lessonPresence.LessonDateTimeFrom,"shortTime"),"\u2013",v.ic(25,39,e.lessonPresence.LessonDateTimeTo,"shortTime")," "),v.zb(3),v.Ab("data-label",v.hc(27,42,"edit-absences.list.header.confirmation-state")),v.zb(2),v.Fc(" ",null==e.confirmationState?null:e.confirmationState.Value," "),v.zb(1),v.Ab("data-label",v.hc(30,44,"edit-absences.list.header.mobil-presence-type-incident")),v.zb(2),v.Fc(" ",null==e.presenceType?null:e.presenceType.Designation," "),v.zb(1),v.Ab("data-label",v.hc(33,46,"edit-absences.list.header.teacher")),v.zb(2),v.Fc(" ",e.lessonPresence.TeacherInformation," ")}}function se(e,t){if(1&e){const e=v.Tb();v.Sb(0,"table",16),v.Sb(1,"thead"),v.Sb(2,"tr"),v.Sb(3,"th"),v.Sb(4,"input",17),v.dc("change",function(t){return v.vc(e),v.fc(5).toggleAll(t.currentTarget.checked)}),v.Rb(),v.Rb(),v.Sb(5,"th",18),v.Dc(6),v.gc(7,"translate"),v.Rb(),v.Sb(8,"th"),v.Dc(9),v.gc(10,"translate"),v.Nb(11,"br"),v.Dc(12),v.gc(13,"translate"),v.gc(14,"translate"),v.Rb(),v.Sb(15,"th"),v.Dc(16),v.gc(17,"translate"),v.Rb(),v.Sb(18,"th"),v.Dc(19),v.gc(20,"translate"),v.Rb(),v.Sb(21,"th"),v.Dc(22),v.gc(23,"translate"),v.Rb(),v.Sb(24,"th"),v.Dc(25),v.gc(26,"translate"),v.gc(27,"translate"),v.Rb(),v.Sb(28,"th"),v.Dc(29),v.gc(30,"translate"),v.Rb(),v.Rb(),v.Rb(),v.Sb(31,"tbody"),v.Bc(32,ne,35,52,"tr",19),v.Rb(),v.Rb()}if(2&e){const e=v.fc(4).erzLet;v.zb(4),v.lc("checked",e.selection.length===e.entries.length),v.zb(2),v.Fc(" ",v.hc(7,12,"edit-absences.list.header.presence")," "),v.zb(3),v.Fc(" ",v.hc(10,14,"edit-absences.list.header.student")," "),v.zb(3),v.Gc(" ",v.hc(13,16,"edit-absences.list.header.module-instance"),", ",v.hc(14,18,"edit-absences.list.header.study-class")," "),v.zb(4),v.Fc(" ",v.hc(17,20,"edit-absences.list.header.date")," "),v.zb(3),v.Ec(v.hc(20,22,"edit-absences.list.header.time")),v.zb(3),v.Fc(" ",v.hc(23,24,"edit-absences.list.header.confirmation-state")," "),v.zb(3),v.Gc(" ",v.hc(26,26,"edit-absences.list.header.presence-type")," / ",v.hc(27,28,"edit-absences.list.header.incident")," "),v.zb(4),v.Ec(v.hc(30,30,"edit-absences.list.header.teacher")),v.zb(3),v.lc("ngForOf",e.entries)}}function ce(e,t){1&e&&v.Nb(0,"erz-spinner",25)}function ie(e,t){if(1&e){const e=v.Tb();v.Sb(0,"button",26),v.dc("click",function(){return v.vc(e),v.fc(5).state.nextPage()}),v.Dc(1),v.gc(2,"translate"),v.Rb()}2&e&&(v.zb(1),v.Fc(" ",v.hc(2,1,"global.pagination.load-more")," "))}function ae(e,t){if(1&e){const e=v.Tb();v.Sb(0,"div",7),v.dc("scrolled",function(){return v.vc(e),v.fc(4).onScroll()}),v.Bc(1,ee,10,21,"div",8),v.Bc(2,se,33,32,"table",9),v.Bc(3,ce,1,0,"erz-spinner",10),v.Bc(4,ie,3,3,"button",11),v.Rb()}if(2&e){const e=v.fc(3).erzLet;v.zb(1),v.lc("ngIf",e.entries&&e.entries.length>0),v.zb(1),v.lc("ngIf",e.entries&&e.entries.length>0),v.zb(1),v.lc("ngIf",e.loadingPage),v.zb(1),v.lc("ngIf",e.hasMore&&!e.loadingPage)}}function re(e,t){1&e&&(v.Sb(0,"p",27),v.Dc(1),v.gc(2,"translate"),v.Rb()),2&e&&(v.zb(1),v.Ec(v.hc(2,1,"edit-absences.no-entries")))}function le(e,t){if(1&e&&(v.Qb(0),v.Bc(1,ae,5,4,"div",5),v.Bc(2,re,3,3,"ng-template",null,6,v.Cc),v.Pb()),2&e){const e=v.uc(3),t=v.fc(2).erzLet;v.zb(1),v.lc("ngIf",t.entries&&t.entries.length>0||t.loadingPage)("ngIfElse",e)}}function oe(e,t){1&e&&v.Nb(0,"erz-spinner")}function be(e,t){if(1&e&&(v.Qb(0),v.Bc(1,le,4,2,"ng-container",2),v.gc(2,"async"),v.Bc(3,oe,1,0,"ng-template",null,4,v.Cc),v.Pb()),2&e){const e=v.uc(4),t=v.fc(2);v.zb(1),v.lc("ngIf",!v.hc(2,2,t.state.loading$))("ngIfElse",e)}}function de(e,t){1&e&&(v.Sb(0,"p",27),v.Dc(1),v.gc(2,"translate"),v.Rb()),2&e&&(v.zb(1),v.Ec(v.hc(2,1,"edit-absences.no-filter")))}function ue(e,t){if(1&e){const e=v.Tb();v.Qb(0),v.Sb(1,"erz-edit-absences-header",1),v.dc("filterChange",function(t){return v.vc(e),v.fc().state.setFilter(t)}),v.gc(2,"async"),v.Rb(),v.Bc(3,be,5,4,"ng-container",2),v.gc(4,"async"),v.Bc(5,de,3,3,"ng-template",null,3,v.Cc),v.Pb()}if(2&e){const e=v.uc(6),t=v.fc();v.zb(1),v.lc("filter",v.hc(2,3,t.filterFromParams$)),v.zb(2),v.lc("ngIf",v.hc(4,5,t.state.isFilterValid$))("ngIfElse",e)}}const pe=function(e,t,n,s){return{selection:e,entries:t,hasMore:n,loadingPage:s}};let he=(()=>{class e{constructor(e,t,n,s){this.state=e,this.selectionService=t,this.scrollPosition=n,this.route=s,this.filterFromParams$=this.route.queryParams.pipe(Object(r.a)(fe)),this.profileReturnParams$=this.state.queryParamsString$,this.destroy$=new C.a}ngOnInit(){this.filterFromParams$.pipe(Object($.a)(1)).subscribe(e=>this.state.setFilter(e)),this.state.validFilter$.pipe(Object(l.a)(this.destroy$)).subscribe(()=>this.selectionService.clear()),this.selectionService.selection$.pipe(Object(l.a)(this.destroy$)).subscribe(e=>this.state.selected=e),this.route.queryParams.pipe(Object($.a)(1),Object(T.a)("reload"),Object(P.a)(x.b)).subscribe(()=>this.state.resetEntries())}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}toggleAll(e){this.state.entries$.pipe(Object($.a)(1)).subscribe(t=>this.selectionService.clear(e?t:null))}onCheckboxCellClick(e,t){e.target!==t&&t.click()}onScroll(){this.state.nextPage()}}return e.\u0275fac=function(t){return new(t||e)(v.Mb(z),v.Mb(D),v.Mb(k.a),v.Mb(c.a))},e.\u0275cmp=v.Gb({type:e,selectors:[["erz-edit-absences-list"]],features:[v.yb([D])],decls:5,vars:14,consts:[[4,"erzLet"],[3,"filter","filterChange"],[4,"ngIf","ngIfElse"],["noFilter",""],["loading",""],["class","p-3","infiniteScroll","",3,"scrolled",4,"ngIf","ngIfElse"],["noEntries",""],["infiniteScroll","",1,"p-3",3,"scrolled"],["class","d-flex align-items-center justify-content-between",4,"ngIf"],["class","table table-striped",4,"ngIf"],["class","inline",4,"ngIf"],["type","button","class","btn btn-secondary btn-sm d-block mx-auto",3,"click",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between"],[1,"total"],["routerLink","/edit-absences/edit",1,"edit","btn","btn-primary","mt-1","mb-2",3,"queryParams"],[1,"material-icons"],[1,"table","table-striped"],["type","checkbox",3,"checked","change"],[1,"presence-category"],[4,"ngFor","ngForOf"],[1,"edit-absences-checkbox",3,"click"],["checkbox",""],[3,"className"],[1,"student",3,"routerLink","queryParams"],[1,"designation-incident"],[1,"inline"],["type","button",1,"btn","btn-secondary","btn-sm","d-block","mx-auto",3,"click"],[1,"mt-3","px-3"]],template:function(e,t){1&e&&(v.Bc(0,ue,7,7,"ng-container",0),v.gc(1,"async"),v.gc(2,"async"),v.gc(3,"async"),v.gc(4,"async")),2&e&&v.lc("erzLet",v.sc(9,pe,v.hc(1,1,t.selectionService.selection$),v.hc(2,3,t.state.presenceControlEntries$),v.hc(3,5,t.state.hasMore$),v.hc(4,7,t.state.loadingPage$)))},directives:[A.a,X,S.m,U.a,c.i,S.l,Q.a],pipes:[S.b,_.c,S.e],styles:[".edit[_ngcontent-%COMP%]{line-height:1;font-size:2.2rem}.presence-category[_ngcontent-%COMP%]{text-align:center}.presence-category[_ngcontent-%COMP%]   .absent[_ngcontent-%COMP%]{color:#dc3545}.presence-category[_ngcontent-%COMP%]   .present[_ngcontent-%COMP%]{color:#28a745}.presence-category[_ngcontent-%COMP%]   .unapproved[_ngcontent-%COMP%]{color:#ffa814}.designation-incident[_ngcontent-%COMP%]{max-width:50ch}.student[_ngcontent-%COMP%]{color:#33333d}@media screen and (max-width:820px){.edit-absences-checkbox[_ngcontent-%COMP%]{text-align:left}.presence-category[_ngcontent-%COMP%]{text-align:right}.designation-incident[_ngcontent-%COMP%]{max-width:none}}"],changeDetection:0}),e})();function fe(e){return{student:e.student?Number(e.student):null,educationalEvent:e.educationalEvent?Number(e.educationalEvent):null,studyClass:e.studyClass?Number(e.studyClass):null,dateFrom:e.dateFrom?Object(E.c)(e.dateFrom):null,dateTo:e.dateTo?Object(E.c)(e.dateTo):null,presenceTypes:e.presenceTypes?e.presenceTypes.split(",").map(Number):null,confirmationStates:e.confirmationStates?e.confirmationStates.split(",").map(Number):null,incidentTypes:e.incidentTypes?e.incidentTypes.split(",").map(Number):null}}var ge=n("3Pt+"),me=n("2Vo4"),ye=n("eIep"),ve=n("nYR2"),Se=n("BeL+"),ze=n("CqXF"),Ie=n("LpL1"),Re=n("IClS"),Oe=function(e){return e.Absent="absent",e.Dispensation="dispensation",e.HalfDay="half-day",e.Incident="incident",e.Present="present",e}({});let Ce=(()=>{class e{constructor(e,t){this.updateService=e,this.settings=t}update(e,t,n,s,c,a){let r=[];switch(n){case Oe.Present:r=this.createResetBulkRequests(e);break;case Oe.Absent:r=this.createAbsentEditBulkRequests(e,t,s,c);break;case Oe.Dispensation:r=this.createEditBulkRequests(e,null,this.settings.dispensationPresenceTypeId);break;case Oe.HalfDay:r=this.createEditBulkRequests(e,null,this.settings.halfDayPresenceTypeId);break;case Oe.Incident:r=this.createEditBulkRequests(e,null,a)}return Object(i.a)(r).pipe(Object(ze.a)(void 0))}createAbsentEditBulkRequests(e,t,n,s){return n===this.settings.excusedAbsenceStateId?this.createEditBulkRequests(e,n,s):n===this.settings.unexcusedAbsenceStateId?this.createEditBulkRequests(e,n,this.settings.absencePresenceTypeId):[...this.createEditBulkRequests(e.filter($e(t,this.settings)),n,this.settings.absencePresenceTypeId),...this.createEditBulkRequests(e.filter(Object(x.d)($e(t,this.settings))),n,null)]}createResetBulkRequests(e){return Object(Re.a)(e).map(({lessonIds:e,personIds:t})=>this.updateService.removeLessonPresences(e,t))}createEditBulkRequests(e,t,n){return Object(Re.a)(e).map(({lessonIds:e,personIds:s})=>this.updateService.editLessonPresences(e,s,n||void 0,t||void 0))}}return e.\u0275fac=function(t){return new(t||e)(v.Zb(Ie.a),v.Zb(m.a))},e.\u0275prov=v.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function $e(e,t){return n=>{const s=e.find(e=>e.Id===n.TypeRef.Id);return!s||s.Id===t.dispensationPresenceTypeId||s.Id===t.halfDayPresenceTypeId||s.IsIncident}}var Te=n("A6ef"),Pe=n("AEFh"),je=n("5eHb");function De(e,t){if(1&e&&(v.Sb(0,"div",11),v.Dc(1),v.gc(2,"translate"),v.Rb()),2&e){const e=t.$implicit;v.zb(1),v.Fc(" ",v.ic(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Fe(e,t){if(1&e&&(v.Sb(0,"option",23),v.Dc(1),v.Rb()),2&e){const e=t.$implicit;v.lc("ngValue",e.Id),v.zb(1),v.Fc(" ",e.Designation," ")}}function ke(e,t){if(1&e&&(v.Sb(0,"select",22),v.gc(1,"async"),v.Sb(2,"option",23),v.Dc(3),v.gc(4,"translate"),v.Rb(),v.Bc(5,Fe,2,2,"option",24),v.gc(6,"async"),v.Rb()),2&e){const e=v.fc(6);v.Eb("is-invalid",v.hc(1,5,e.absenceTypeIdErrors$).length>0),v.zb(2),v.lc("ngValue",null),v.zb(1),v.Fc(" ",v.hc(4,7,"edit-absences.edit.absence-type-placeholder")," "),v.zb(2),v.lc("ngForOf",v.hc(6,9,e.absenceTypes$))}}function Ee(e,t){if(1&e&&(v.Sb(0,"div",25),v.Dc(1),v.gc(2,"translate"),v.Rb()),2&e){const e=t.$implicit;v.zb(1),v.Fc(" ",v.ic(2,1,"global.validation-errors."+e.error,e.params)," ")}}function xe(e,t){if(1&e&&(v.Sb(0,"div",18),v.Nb(1,"input",19),v.Sb(2,"label",14),v.Dc(3),v.Rb(),v.Bc(4,ke,7,11,"select",20),v.Bc(5,Ee,3,4,"div",21),v.gc(6,"async"),v.Rb()),2&e){const e=t.$implicit,n=v.fc(5);v.zb(1),v.lc("id","state-"+e.Key)("value",e.Key),v.zb(1),v.mc("for","state-"+e.Key),v.zb(1),v.Fc(" ",e.Value," "),v.zb(1),v.lc("ngIf",n.isExcused(e)),v.zb(1),v.lc("ngForOf",v.hc(6,6,n.absenceTypeIdErrors$))}}function Ae(e,t){if(1&e&&(v.Sb(0,"div",16),v.Bc(1,xe,7,8,"div",17),v.Rb()),2&e){const e=v.fc(3).erzLet;v.zb(1),v.lc("ngForOf",e.confirmationStates)}}function Be(e,t){if(1&e&&(v.Sb(0,"option",23),v.Dc(1),v.Rb()),2&e){const e=t.$implicit;v.lc("ngValue",e.Id),v.zb(1),v.Fc(" ",e.Designation," ")}}function Me(e,t){if(1&e&&(v.Sb(0,"div",25),v.Dc(1),v.gc(2,"translate"),v.Rb()),2&e){const e=t.$implicit;v.zb(1),v.Fc(" ",v.ic(2,1,"global.validation-errors."+e.error,e.params)," ")}}function we(e,t){if(1&e&&(v.Sb(0,"div",16),v.Sb(1,"select",26),v.gc(2,"async"),v.Sb(3,"option",23),v.Dc(4),v.gc(5,"translate"),v.Rb(),v.Bc(6,Be,2,2,"option",24),v.gc(7,"async"),v.Rb(),v.Bc(8,Me,3,4,"div",21),v.gc(9,"async"),v.Rb()),2&e){const e=v.fc(4);v.zb(1),v.Eb("is-invalid",v.hc(2,6,e.incidentIdErrors$).length>0),v.zb(2),v.lc("ngValue",null),v.zb(1),v.Fc(" ",v.hc(5,8,"edit-absences.edit.incident-placeholder")," "),v.zb(2),v.lc("ngForOf",v.hc(7,10,e.incidents$)),v.zb(2),v.lc("ngForOf",v.hc(9,12,e.incidentIdErrors$))}}function Ge(e,t){if(1&e&&(v.Sb(0,"div",12),v.Nb(1,"input",13),v.Sb(2,"label",14),v.Dc(3),v.gc(4,"translate"),v.Rb(),v.Bc(5,Ae,2,1,"div",15),v.Bc(6,we,10,14,"div",15),v.Rb()),2&e){const e=t.$implicit,n=v.fc(3);v.zb(1),v.lc("id","category-"+e)("value",e),v.zb(1),v.mc("for","category-"+e),v.zb(1),v.Fc(" ",v.hc(4,6,"edit-absences.edit.categories."+e)," "),v.zb(2),v.lc("ngIf",n.isAbsent(e)),v.zb(1),v.lc("ngIf",n.isIncident(e))}}function qe(e,t){1&e&&(v.Sb(0,"div",27),v.Sb(1,"span",28),v.Dc(2,"Loading..."),v.Rb(),v.Rb())}function Ne(e,t){if(1&e){const e=v.Tb();v.Sb(0,"form",3),v.dc("ngSubmit",function(){return v.vc(e),v.fc(2).onSubmit()}),v.Bc(1,De,3,4,"div",4),v.gc(2,"async"),v.Sb(3,"div",5),v.Bc(4,Ge,7,8,"div",6),v.Rb(),v.Sb(5,"div",7),v.Sb(6,"button",8),v.dc("click",function(){return v.vc(e),v.fc(2).cancel()}),v.gc(7,"async"),v.Dc(8),v.gc(9,"translate"),v.Rb(),v.Sb(10,"button",9),v.gc(11,"async"),v.Dc(12),v.gc(13,"translate"),v.Bc(14,qe,3,0,"div",10),v.gc(15,"async"),v.Rb(),v.Rb(),v.Rb()}if(2&e){const e=v.fc().erzLet,t=v.fc();v.lc("formGroup",e.formGroup),v.zb(1),v.lc("ngForOf",v.hc(2,8,t.formErrors$)),v.zb(3),v.lc("ngForOf",e.categories),v.zb(2),v.lc("disabled",v.hc(7,10,t.saving$)),v.zb(2),v.Fc(" ",v.hc(9,12,"edit-absences.edit.cancel")," "),v.zb(2),v.lc("disabled",v.hc(11,14,t.saving$)),v.zb(2),v.Fc(" ",v.hc(13,16,"edit-absences.edit.save")," "),v.zb(2),v.lc("ngIf",v.hc(15,18,t.saving$))}}function Le(e,t){if(1&e&&(v.Sb(0,"div",1),v.Bc(1,Ne,16,20,"form",2),v.Rb()),2&e){const e=t.erzLet;v.zb(1),v.lc("ngIf",e.formGroup&&e.confirmationStates)}}const Ve=function(e,t,n){return{confirmationStates:e,categories:t,formGroup:n}};let _e=(()=>{class e{constructor(e,t,n,s,c,i,l,o,b,d){this.fb=e,this.router=t,this.route=n,this.toastr=s,this.translate=c,this.state=i,this.dropDownItemsService=l,this.presenceTypesService=o,this.updateService=b,this.settings=d,this.absenceTypes$=this.presenceTypesService.confirmationTypes$,this.incidents$=this.presenceTypesService.incidentTypes$,this.formGroup$=this.createFormGroup(),this.saving$=new me.a(!1),this.submitted$=new me.a(!1),this.formErrors$=Object(Te.c)(this.formGroup$,this.submitted$),this.absenceTypeIdErrors$=Object(Te.c)(this.formGroup$,this.submitted$,"absenceTypeId"),this.incidentIdErrors$=Object(Te.c)(this.formGroup$,this.submitted$,"incidentId"),this.availableCategories=[Oe.Absent,Oe.Dispensation,Oe.HalfDay,Oe.Incident,Oe.Present],this.confirmationStates$=this.dropDownItemsService.getAbsenceConfirmationStates().pipe(Object(r.a)(this.sortAbsenceConfirmationStates.bind(this)),Object(a.a)(1)),this.activeCategories$=this.presenceTypesService.halfDayActive$.pipe(Object(r.a)(e=>e?this.availableCategories:this.availableCategories.filter(e=>e!==Oe.HalfDay))),this.destroy$=new C.a}ngOnInit(){0===this.state.selected.length&&this.navigateBack(),Object(Te.b)(this.formGroup$,"category").pipe(Object(l.a)(this.destroy$)).subscribe(this.updateConfirmationValueDisabled.bind(this)),Object(Te.b)(this.formGroup$,"confirmationValue").pipe(Object(l.a)(this.destroy$)).subscribe(this.updateAbsenceTypeIdDisabled.bind(this))}ngOnDestroy(){this.destroy$.next()}isAbsent(e){return e===Oe.Absent}isExcused(e){return e.Key===this.settings.excusedAbsenceStateId}isIncident(e){return e===Oe.Incident}onSubmit(){this.submitted$.next(!0),this.formGroup$.pipe(Object($.a)(1)).subscribe(e=>{e.valid&&this.save(e)})}cancel(){this.navigateBack()}createFormGroup(){return this.getInitialAbsenceTypeId().pipe(Object(r.a)(e=>this.fb.group({category:[Oe.Absent,ge.q.required],confirmationValue:[this.settings.excusedAbsenceStateId,ge.q.required],absenceTypeId:[e,ge.q.required],incidentId:[{value:null,disabled:!0},ge.q.required]})),Object(a.a)(1))}getInitialAbsenceTypeId(){return this.absenceTypes$.pipe(Object($.a)(1),Object(r.a)(e=>{const t=e.map(e=>e.Id),n=Object(Se.a)(this.state.selected.map(e=>e.TypeRef.Id));return 1===n.length&&null!=n[0]&&t.includes(n[0])?n[0]:null}))}updateConfirmationValueDisabled(){this.formGroup$.pipe(Object($.a)(1)).subscribe(e=>{const t=e.get("category"),n=e.get("confirmationValue"),s=e.get("absenceTypeId"),c=e.get("incidentId");t&&n&&s&&c&&(t.value===Oe.Absent?(n.enable(),this.updateAbsenceTypeIdDisabled()):(n.disable(),s.disable()),t.value===Oe.Incident?c.enable():c.disable())})}updateAbsenceTypeIdDisabled(){this.formGroup$.pipe(Object($.a)(1)).subscribe(e=>{const t=e.get("confirmationValue"),n=e.get("absenceTypeId");t&&n&&(t.value===this.settings.excusedAbsenceStateId?n.enable():n.disable())})}save(e){this.saving$.next(!0);const{category:t,confirmationValue:n,absenceTypeId:s,incidentId:c}=e.value;this.presenceTypesService.presenceTypes$.pipe(Object(ye.a)(e=>this.updateService.update(this.state.selected,e,t,n,s,c)),Object(ve.a)(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.state.resetSelection(),this.toastr.success(this.translate.instant("edit-absences.edit.save-success")),this.navigateBack(!0)}navigateBack(e){this.route.queryParams.pipe(Object($.a)(1)).subscribe(t=>{this.router.navigate(["/edit-absences"],{queryParams:Object.assign(Object.assign({},Object(Pe.b)(t.returnparams)),{reload:e})})})}sortAbsenceConfirmationStates(e){return e.slice().sort((e,t)=>e.Key===this.settings.excusedAbsenceStateId?-1:t.Key===this.settings.excusedAbsenceStateId?1:e.Value.localeCompare(t.Value))}}return e.\u0275fac=function(t){return new(t||e)(v.Mb(ge.c),v.Mb(c.g),v.Mb(c.a),v.Mb(je.b),v.Mb(_.d),v.Mb(z),v.Mb(o.a),v.Mb(u.a),v.Mb(Ce),v.Mb(m.a))},e.\u0275cmp=v.Gb({type:e,selectors:[["erz-edit-absences-edit"]],decls:4,vars:11,consts:[["class","erz-container erz-container-limited erz-container-padding-y",4,"erzLet"],[1,"erz-container","erz-container-limited","erz-container-padding-y"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"formGroup","ngSubmit"],["class","alert alert-danger",4,"ngFor","ngForOf"],[1,"form-group","pb-4"],["class","form-check mt-2 mb-3",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],["type","submit",1,"btn","btn-primary","ml-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"alert","alert-danger"],[1,"form-check","mt-2","mb-3"],["type","radio","formControlName","category",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],["class","ml-5",4,"ngIf"],[1,"ml-5"],["class","form-check mt-2 mb-2",4,"ngFor","ngForOf"],[1,"form-check","mt-2","mb-2"],["type","radio","formControlName","confirmationValue",1,"form-check-input",3,"id","value"],["class","form-control mt-1","formControlName","absenceTypeId",3,"is-invalid",4,"ngIf"],["class","invalid-feedback",4,"ngFor","ngForOf"],["formControlName","absenceTypeId",1,"form-control","mt-1"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"invalid-feedback"],["formControlName","incidentId",1,"form-control","mt-1"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"sr-only"]],template:function(e,t){1&e&&(v.Bc(0,Le,2,1,"div",0),v.gc(1,"async"),v.gc(2,"async"),v.gc(3,"async")),2&e&&v.lc("erzLet",v.rc(7,Ve,v.hc(1,1,t.confirmationStates$),v.hc(2,3,t.activeCategories$),v.hc(3,5,t.formGroup$)))},directives:[A.a,S.m,ge.r,ge.j,ge.e,S.l,ge.n,ge.b,ge.i,ge.d,ge.p,ge.m,ge.s],pipes:[S.b,_.c],styles:[""],changeDetection:0}),e})();var Ke=n("ccj6"),He=n("hH5/");const Ze=[{path:"",component:O,children:[{path:"",component:he,data:{restoreScrollPositionFrom:["/edit-absences/edit","/edit-absences/student/:id"]}},{path:"edit",component:_e},{path:"student/:id",children:[{path:"",component:Ke.a},{path:"confirm",component:He.a}]}]}];let Xe=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=v.Kb({type:e}),e.\u0275inj=v.Jb({imports:[[c.j.forChild(Ze)],c.j]}),e})(),Je=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=v.Kb({type:e}),e.\u0275inj=v.Jb({imports:[[s.a,Xe]]}),e})()}}]);