(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{pXY1:function(e,t,n){"use strict";n.r(t),n.d(t,"EditAbsencesModule",function(){return Ue});var s=n("PCNd"),c=n("tyNb"),i=n("itXk"),a=n("UXun"),r=n("lJxs"),l=n("1G5W"),o=n("v6cN"),b=n("CCnw"),d=n("CqUA"),u=n("KJh6"),p=n("FJ3f"),h=n("eB9A"),f=n("NPit"),g=n("fhBx"),m=n("Xr/R"),y=n("RYjX");function v(e,t,n){return e.map(e=>{let s,c=null;return e.TypeRef.Id&&(c=t.find(t=>t.Id===e.TypeRef.Id)||null),e.ConfirmationStateId&&(s=n.find(t=>t.Key===e.ConfirmationStateId)),new y.b(e,c,null,s)})}var S=n("fXoL"),z=n("ofXK");let I=(()=>{class e extends g.b{constructor(e,t,n,s,c,o){super(e,t,n,"/edit-absences"),this.lessonPresencesService=s,this.presenceTypesService=c,this.dropDownItemsService=o,this.presenceTypes$=this.loadPresenceTypes().pipe(Object(a.a)(1)),this.absenceConfirmationStates$=this.loadAbsenceConfirmationStates().pipe(Object(r.a)(p.b),Object(a.a)(1)),this.presenceControlEntries$=Object(i.a)([this.entries$,this.presenceTypes$,this.absenceConfirmationStates$]).pipe(Object(r.a)(Object(h.a)(v)),Object(a.a)(1)),this.selected=[],this.queryParamsString$.pipe(Object(l.a)(this.destroy$)).subscribe(e=>this.confirmBackLinkParams={returnparams:e})}resetSelection(){this.selected=[]}getInitialFilter(){return{student:null,educationalEvent:null,studyClass:null,dateFrom:null,dateTo:null,presenceTypes:null,confirmationStates:null,incidentTypes:null}}isValidFilter(e){return Boolean(e.student||e.educationalEvent||e.studyClass||e.dateFrom||e.dateTo||e.presenceTypes||e.confirmationStates||e.incidentTypes)}loadEntries(e,t,n){return this.loadingService.load(this.lessonPresencesService.getFilteredList(e,n,{sort:"StudentFullName.asc,LessonDateTimeFrom.asc"}),g.a)}buildParamsFromFilter(e){return Object(f.a)(e)}loadPresenceTypes(){return this.loadingService.load(this.presenceTypesService.activePresenceTypes$)}loadAbsenceConfirmationStates(){return this.loadingService.load(this.dropDownItemsService.getAbsenceConfirmationStates())}}return e.\u0275fac=function(t){return new(t||e)(S.Zb(z.i),S.Zb(d.a),S.Zb(m.a),S.Zb(b.a),S.Zb(u.a),S.Zb(o.a))},e.\u0275prov=S.Ib({token:e,factory:e.\u0275fac}),e})();var R=n("qUtt"),O=n("0HM3");let C=(()=>{class e{constructor(e){this.state=e}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(S.Mb(I))},e.\u0275cmp=S.Gb({type:e,selectors:[["erz-edit-absences"]],features:[S.yb([I,{provide:R.a,useExisting:I},{provide:O.a,useValue:"/edit-absences"}])],decls:1,vars:0,template:function(e,t){1&e&&S.Nb(0,"router-outlet")},directives:[c.k],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),e})();var $=n("XNiG"),T=n("IzEk"),P=n("wO+i"),j=n("pLZG"),D=n("ulei");let F=(()=>{class e extends D.a{}return e.\u0275fac=function(t){return k(t||e)},e.\u0275prov=S.Ib({token:e,factory:e.\u0275fac}),e})();const k=S.Ub(F);var E=n("yl8S"),x=n("KCaQ"),A=n("K+0v"),B=n("EOpz"),M=n("1kSV"),w=n("M34a"),G=n("vlqf"),q=n("YDIV"),N=n("PAVU"),L=n("vjgy"),V=n("mmcK"),_=n("4vbw"),K=n("sYmb"),H=n("jSy9"),X=n("DKSB"),Z=n("/N9o");let J=(()=>{class e{constructor(e,t,n,s,c){this.studentsService=e,this.educationalEventsService=t,this.studyClassService=n,this.state=s,this.translate=c,this.filter={student:null,educationalEvent:null,studyClass:null,dateFrom:null,dateTo:null,presenceTypes:null,confirmationStates:null,incidentTypes:null},this.filterChange=new S.n,this.absenceConfirmationStatesGrouped$=this.state.absenceConfirmationStates$.pipe(Object(r.a)(e=>Object(N.a)(e,this.translate.instant("shared.multiselect.all-option")))),this.presenceTypesGrouped$=this.state.presenceTypes$.pipe(Object(r.a)(e=>e.filter(Object(A.d)(G.d)).filter(Object(A.d)(G.f))),Object(r.a)(N.c),Object(r.a)(N.b),Object(r.a)(e=>Object(N.a)(e,this.translate.instant("shared.multiselect.all-option")))),this.incidentTypesGrouped$=this.state.presenceTypes$.pipe(Object(r.a)(e=>e.filter(G.f)),Object(r.a)(N.c),Object(r.a)(N.b),Object(r.a)(e=>Object(N.a)(e,this.translate.instant("shared.multiselect.all-option")))),this.classesHttpFilter={params:{fields:"IsActive","filter.IsActive":"=true"}}}ngOnInit(){}show(){this.filterChange.emit(Object.assign(Object.assign({},this.filter),{dateFrom:U(this.filter.dateFrom),dateTo:U(this.filter.dateTo)}))}}return e.\u0275fac=function(t){return new(t||e)(S.Mb(V.a),S.Mb(L.a),S.Mb(_.a),S.Mb(I),S.Mb(K.d))},e.\u0275cmp=S.Gb({type:e,selectors:[["erz-edit-absences-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},features:[S.yb([{provide:M.c,useClass:M.d},{provide:M.e,useClass:q.a}])],decls:49,vars:48,consts:[[1,"filters","mb-2"],[1,"form-group"],[3,"typeaheadService","value","valueChange"],[3,"typeaheadService","value","additionalHttpParams","valueChange"],[3,"value","valueChange"],[1,"filters","mt-2"],[3,"options","values","valuesChange"],[1,"buttons"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(e,t){1&e&&(S.Sb(0,"div",0),S.Sb(1,"div",1),S.Sb(2,"label"),S.Dc(3),S.gc(4,"translate"),S.Rb(),S.Sb(5,"erz-typeahead",2),S.dc("valueChange",function(e){return t.filter.student=e}),S.Rb(),S.Rb(),S.Sb(6,"div",1),S.Sb(7,"label"),S.Dc(8),S.gc(9,"translate"),S.Rb(),S.Sb(10,"erz-typeahead",2),S.dc("valueChange",function(e){return t.filter.educationalEvent=e}),S.Rb(),S.Rb(),S.Sb(11,"div",1),S.Sb(12,"label"),S.Dc(13),S.gc(14,"translate"),S.Rb(),S.Sb(15,"erz-typeahead",3),S.dc("valueChange",function(e){return t.filter.studyClass=e}),S.Rb(),S.Rb(),S.Sb(16,"div",1),S.Sb(17,"label"),S.Dc(18),S.gc(19,"translate"),S.Rb(),S.Sb(20,"erz-date-select",4),S.dc("valueChange",function(e){return t.filter.dateFrom=e}),S.Rb(),S.Rb(),S.Sb(21,"div",1),S.Sb(22,"label"),S.Dc(23),S.gc(24,"translate"),S.Rb(),S.Sb(25,"erz-date-select",4),S.dc("valueChange",function(e){return t.filter.dateTo=e}),S.Rb(),S.Rb(),S.Rb(),S.Sb(26,"div",5),S.Sb(27,"div",1),S.Sb(28,"label"),S.Dc(29),S.gc(30,"translate"),S.Rb(),S.Sb(31,"erz-multiselect",6),S.dc("valuesChange",function(e){return t.filter.confirmationStates=e}),S.gc(32,"async"),S.Rb(),S.Rb(),S.Sb(33,"div",1),S.Sb(34,"label"),S.Dc(35),S.gc(36,"translate"),S.Rb(),S.Sb(37,"erz-multiselect",6),S.dc("valuesChange",function(e){return t.filter.presenceTypes=e}),S.gc(38,"async"),S.Rb(),S.Rb(),S.Sb(39,"div",1),S.Sb(40,"label"),S.Dc(41),S.gc(42,"translate"),S.Rb(),S.Sb(43,"erz-multiselect",6),S.dc("valuesChange",function(e){return t.filter.incidentTypes=e}),S.gc(44,"async"),S.Rb(),S.Rb(),S.Sb(45,"div",7),S.Sb(46,"button",8),S.dc("click",function(){return t.show()}),S.Dc(47),S.gc(48,"translate"),S.Rb(),S.Rb(),S.Rb()),2&e&&(S.zb(3),S.Ec(S.hc(4,24,"edit-absences.header.student")),S.zb(2),S.lc("typeaheadService",t.studentsService)("value",t.filter.student),S.zb(3),S.Ec(S.hc(9,26,"edit-absences.header.module-instance")),S.zb(2),S.lc("typeaheadService",t.educationalEventsService)("value",t.filter.educationalEvent),S.zb(3),S.Ec(S.hc(14,28,"edit-absences.header.study-class")),S.zb(2),S.lc("typeaheadService",t.studyClassService)("value",t.filter.studyClass)("additionalHttpParams",t.classesHttpFilter),S.zb(3),S.Ec(S.hc(19,30,"edit-absences.header.date-from")),S.zb(2),S.lc("value",t.filter.dateFrom),S.zb(3),S.Ec(S.hc(24,32,"edit-absences.header.date-to")),S.zb(2),S.lc("value",t.filter.dateTo),S.zb(4),S.Ec(S.hc(30,34,"edit-absences.header.confirmation-state")),S.zb(2),S.lc("options",S.hc(32,36,t.absenceConfirmationStatesGrouped$))("values",t.filter.confirmationStates),S.zb(4),S.Ec(S.hc(36,38,"edit-absences.header.presence-type")),S.zb(2),S.lc("options",S.hc(38,40,t.presenceTypesGrouped$))("values",t.filter.presenceTypes),S.zb(4),S.Ec(S.hc(42,42,"edit-absences.header.incident")),S.zb(2),S.lc("options",S.hc(44,44,t.incidentTypesGrouped$))("values",t.filter.incidentTypes),S.zb(4),S.Fc(" ",S.hc(48,46,"edit-absences.header.show")," "))},directives:[H.a,X.a,Z.a],pipes:[K.c,z.b],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1.5rem;border-bottom:1px solid #dee2e6}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.form-group[_ngcontent-%COMP%]{flex:1;min-width:20rem;max-width:40rem;margin-right:1.5rem;margin-bottom:.75rem}.buttons[_ngcontent-%COMP%]{flex:none;margin-top:2.75rem;margin-right:0}@media (max-width:767.98px){.buttons[_ngcontent-%COMP%]{width:100%;margin-top:1.5rem;margin-bottom:1.5rem}}"],changeDetection:0}),e})();function U(e){return e?Object(w.a)(e):null}var Y=n("dlKe"),Q=n("4Kj8");const W=function(e){return{count:e}},ee=function(e){return{returnparams:e}};function te(e,t){if(1&e&&(S.Sb(0,"div",12),S.Sb(1,"div",13),S.Dc(2),S.gc(3,"translate"),S.gc(4,"async"),S.gc(5,"translate"),S.Rb(),S.Sb(6,"a",14),S.gc(7,"async"),S.Sb(8,"i",15),S.Dc(9,"edit"),S.Rb(),S.Rb(),S.Rb()),2&e){const e=S.fc(4).erzLet,t=S.fc();S.zb(2),S.Gc(" ",S.ic(3,5,"edit-absences.list.total",S.pc(15,W,S.hc(4,8,t.state.total$)||0)),", ",S.ic(5,10,"edit-absences.list.selected",S.pc(17,W,e.selection.length))," "),S.zb(4),S.Eb("disabled",0===e.selection.length),S.lc("queryParams",S.pc(19,ee,S.hc(7,13,t.state.queryParamsString$)))}}const ne=function(e){return["student",e]};function se(e,t){if(1&e){const e=S.Tb();S.Sb(0,"tr"),S.Sb(1,"td",20),S.dc("click",function(t){S.vc(e);const n=S.uc(3);return S.fc(6).onCheckboxCellClick(t,n)}),S.Sb(2,"input",17,21),S.dc("change",function(){S.vc(e);const n=t.$implicit;return S.fc(6).selectionService.toggle(n.lessonPresence)}),S.gc(4,"async"),S.Rb(),S.Rb(),S.Sb(5,"td",18),S.gc(6,"translate"),S.Sb(7,"span",22),S.Sb(8,"i",15),S.Dc(9),S.Rb(),S.Rb(),S.Rb(),S.Sb(10,"td"),S.gc(11,"translate"),S.Sb(12,"a",23),S.gc(13,"async"),S.Dc(14),S.Rb(),S.Nb(15,"br"),S.Dc(16),S.Rb(),S.Sb(17,"td"),S.gc(18,"translate"),S.Dc(19),S.gc(20,"date"),S.Rb(),S.Sb(21,"td"),S.gc(22,"translate"),S.Dc(23),S.gc(24,"date"),S.gc(25,"date"),S.Rb(),S.Sb(26,"td"),S.gc(27,"translate"),S.Dc(28),S.Rb(),S.Sb(29,"td",24),S.gc(30,"translate"),S.Dc(31),S.Rb(),S.Sb(32,"td"),S.gc(33,"translate"),S.Dc(34),S.Rb(),S.Rb()}if(2&e){const e=t.$implicit,n=S.fc(6);S.zb(2),S.lc("checked",S.hc(4,21,n.selectionService.isSelected$(e.lessonPresence))),S.zb(3),S.Ab("data-label",S.hc(6,23,"edit-absences.list.header.presence")),S.zb(2),S.lc("className",e.presenceCategory),S.zb(2),S.Ec(e.presenceCategoryIcon),S.zb(1),S.Ab("data-label",S.hc(11,25,"edit-absences.list.header.mobil-student-module-instance-study-class")),S.zb(2),S.lc("routerLink",S.pc(48,ne,e.lessonPresence.StudentRef.Id))("queryParams",S.pc(50,ee,S.hc(13,27,n.profileReturnParams$))),S.zb(2),S.Fc(" ",e.lessonPresence.StudentFullName," "),S.zb(2),S.Gc(" ",e.lessonPresence.EventDesignation,", ",e.lessonPresence.StudyClassNumber," "),S.zb(1),S.Ab("data-label",S.hc(18,29,"edit-absences.list.header.date")),S.zb(2),S.Fc(" ",S.ic(20,31,e.lessonPresence.LessonDateTimeFrom,"mediumDate")," "),S.zb(2),S.Ab("data-label",S.hc(22,34,"edit-absences.list.header.time")),S.zb(2),S.Gc(" ",S.ic(24,36,e.lessonPresence.LessonDateTimeFrom,"shortTime"),"\u2013",S.ic(25,39,e.lessonPresence.LessonDateTimeTo,"shortTime")," "),S.zb(3),S.Ab("data-label",S.hc(27,42,"edit-absences.list.header.confirmation-state")),S.zb(2),S.Fc(" ",null==e.confirmationState?null:e.confirmationState.Value," "),S.zb(1),S.Ab("data-label",S.hc(30,44,"edit-absences.list.header.mobil-presence-type-incident")),S.zb(2),S.Fc(" ",null==e.presenceType?null:e.presenceType.Designation," "),S.zb(1),S.Ab("data-label",S.hc(33,46,"edit-absences.list.header.teacher")),S.zb(2),S.Fc(" ",e.lessonPresence.TeacherInformation," ")}}function ce(e,t){if(1&e){const e=S.Tb();S.Sb(0,"table",16),S.Sb(1,"thead"),S.Sb(2,"tr"),S.Sb(3,"th"),S.Sb(4,"input",17),S.dc("change",function(t){return S.vc(e),S.fc(5).toggleAll(t.currentTarget.checked)}),S.Rb(),S.Rb(),S.Sb(5,"th",18),S.Dc(6),S.gc(7,"translate"),S.Rb(),S.Sb(8,"th"),S.Dc(9),S.gc(10,"translate"),S.Nb(11,"br"),S.Dc(12),S.gc(13,"translate"),S.gc(14,"translate"),S.Rb(),S.Sb(15,"th"),S.Dc(16),S.gc(17,"translate"),S.Rb(),S.Sb(18,"th"),S.Dc(19),S.gc(20,"translate"),S.Rb(),S.Sb(21,"th"),S.Dc(22),S.gc(23,"translate"),S.Rb(),S.Sb(24,"th"),S.Dc(25),S.gc(26,"translate"),S.gc(27,"translate"),S.Rb(),S.Sb(28,"th"),S.Dc(29),S.gc(30,"translate"),S.Rb(),S.Rb(),S.Rb(),S.Sb(31,"tbody"),S.Bc(32,se,35,52,"tr",19),S.Rb(),S.Rb()}if(2&e){const e=S.fc(4).erzLet;S.zb(4),S.lc("checked",e.selection.length===e.entries.length),S.zb(2),S.Fc(" ",S.hc(7,12,"edit-absences.list.header.presence")," "),S.zb(3),S.Fc(" ",S.hc(10,14,"edit-absences.list.header.student")," "),S.zb(3),S.Gc(" ",S.hc(13,16,"edit-absences.list.header.module-instance"),", ",S.hc(14,18,"edit-absences.list.header.study-class")," "),S.zb(4),S.Fc(" ",S.hc(17,20,"edit-absences.list.header.date")," "),S.zb(3),S.Ec(S.hc(20,22,"edit-absences.list.header.time")),S.zb(3),S.Fc(" ",S.hc(23,24,"edit-absences.list.header.confirmation-state")," "),S.zb(3),S.Gc(" ",S.hc(26,26,"edit-absences.list.header.presence-type")," / ",S.hc(27,28,"edit-absences.list.header.incident")," "),S.zb(4),S.Ec(S.hc(30,30,"edit-absences.list.header.teacher")),S.zb(3),S.lc("ngForOf",e.entries)}}function ie(e,t){1&e&&S.Nb(0,"erz-spinner",25)}function ae(e,t){if(1&e){const e=S.Tb();S.Sb(0,"button",26),S.dc("click",function(){return S.vc(e),S.fc(5).state.nextPage()}),S.Dc(1),S.gc(2,"translate"),S.Rb()}2&e&&(S.zb(1),S.Fc(" ",S.hc(2,1,"global.pagination.load-more")," "))}function re(e,t){if(1&e){const e=S.Tb();S.Sb(0,"div",7),S.dc("scrolled",function(){return S.vc(e),S.fc(4).onScroll()}),S.Bc(1,te,10,21,"div",8),S.Bc(2,ce,33,32,"table",9),S.Bc(3,ie,1,0,"erz-spinner",10),S.Bc(4,ae,3,3,"button",11),S.Rb()}if(2&e){const e=S.fc(3).erzLet;S.zb(1),S.lc("ngIf",e.entries&&e.entries.length>0),S.zb(1),S.lc("ngIf",e.entries&&e.entries.length>0),S.zb(1),S.lc("ngIf",e.loadingPage),S.zb(1),S.lc("ngIf",e.hasMore&&!e.loadingPage)}}function le(e,t){1&e&&(S.Sb(0,"p",27),S.Dc(1),S.gc(2,"translate"),S.Rb()),2&e&&(S.zb(1),S.Ec(S.hc(2,1,"edit-absences.no-entries")))}function oe(e,t){if(1&e&&(S.Qb(0),S.Bc(1,re,5,4,"div",5),S.Bc(2,le,3,3,"ng-template",null,6,S.Cc),S.Pb()),2&e){const e=S.uc(3),t=S.fc(2).erzLet;S.zb(1),S.lc("ngIf",t.entries&&t.entries.length>0||t.loadingPage)("ngIfElse",e)}}function be(e,t){1&e&&S.Nb(0,"erz-spinner")}function de(e,t){if(1&e&&(S.Qb(0),S.Bc(1,oe,4,2,"ng-container",2),S.gc(2,"async"),S.Bc(3,be,1,0,"ng-template",null,4,S.Cc),S.Pb()),2&e){const e=S.uc(4),t=S.fc(2);S.zb(1),S.lc("ngIf",!S.hc(2,2,t.state.loading$))("ngIfElse",e)}}function ue(e,t){1&e&&(S.Sb(0,"p",27),S.Dc(1),S.gc(2,"translate"),S.Rb()),2&e&&(S.zb(1),S.Ec(S.hc(2,1,"edit-absences.no-filter")))}function pe(e,t){if(1&e){const e=S.Tb();S.Qb(0),S.Sb(1,"erz-edit-absences-header",1),S.dc("filterChange",function(t){return S.vc(e),S.fc().state.setFilter(t)}),S.gc(2,"async"),S.Rb(),S.Bc(3,de,5,4,"ng-container",2),S.gc(4,"async"),S.Bc(5,ue,3,3,"ng-template",null,3,S.Cc),S.Pb()}if(2&e){const e=S.uc(6),t=S.fc();S.zb(1),S.lc("filter",S.hc(2,3,t.filterFromParams$)),S.zb(2),S.lc("ngIf",S.hc(4,5,t.state.isFilterValid$))("ngIfElse",e)}}const he=function(e,t,n,s){return{selection:e,entries:t,hasMore:n,loadingPage:s}};let fe=(()=>{class e{constructor(e,t,n,s){this.state=e,this.selectionService=t,this.scrollPosition=n,this.route=s,this.filterFromParams$=this.route.queryParams.pipe(Object(r.a)(ge)),this.profileReturnParams$=this.state.queryParamsString$,this.destroy$=new $.a}ngOnInit(){this.filterFromParams$.pipe(Object(T.a)(1)).subscribe(e=>this.state.setFilter(e)),this.state.validFilter$.pipe(Object(l.a)(this.destroy$)).subscribe(()=>this.selectionService.clear()),this.selectionService.selection$.pipe(Object(l.a)(this.destroy$)).subscribe(e=>this.state.selected=e),this.route.queryParams.pipe(Object(T.a)(1),Object(P.a)("reload"),Object(j.a)(A.b)).subscribe(()=>this.state.resetEntries())}ngAfterViewInit(){this.scrollPosition.restore()}ngOnDestroy(){this.destroy$.next()}toggleAll(e){this.state.entries$.pipe(Object(T.a)(1)).subscribe(t=>this.selectionService.clear(e?t:null))}onCheckboxCellClick(e,t){e.target!==t&&t.click()}onScroll(){this.state.nextPage()}}return e.\u0275fac=function(t){return new(t||e)(S.Mb(I),S.Mb(F),S.Mb(E.a),S.Mb(c.a))},e.\u0275cmp=S.Gb({type:e,selectors:[["erz-edit-absences-list"]],features:[S.yb([F])],decls:5,vars:14,consts:[[4,"erzLet"],[3,"filter","filterChange"],[4,"ngIf","ngIfElse"],["noFilter",""],["loading",""],["class","p-3","infiniteScroll","",3,"scrolled",4,"ngIf","ngIfElse"],["noEntries",""],["infiniteScroll","",1,"p-3",3,"scrolled"],["class","d-flex align-items-center justify-content-between",4,"ngIf"],["class","table table-striped",4,"ngIf"],["class","inline",4,"ngIf"],["type","button","class","btn btn-secondary btn-sm d-block mx-auto",3,"click",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between"],[1,"total"],["routerLink","/edit-absences/edit",1,"edit","btn","btn-primary","mt-1","mb-2",3,"queryParams"],[1,"material-icons"],[1,"table","table-striped"],["type","checkbox",3,"checked","change"],[1,"presence-category"],[4,"ngFor","ngForOf"],[1,"edit-absences-checkbox",3,"click"],["checkbox",""],[3,"className"],[1,"student",3,"routerLink","queryParams"],[1,"designation-incident"],[1,"inline"],["type","button",1,"btn","btn-secondary","btn-sm","d-block","mx-auto",3,"click"],[1,"mt-3","px-3"]],template:function(e,t){1&e&&(S.Bc(0,pe,7,7,"ng-container",0),S.gc(1,"async"),S.gc(2,"async"),S.gc(3,"async"),S.gc(4,"async")),2&e&&S.lc("erzLet",S.sc(9,he,S.hc(1,1,t.selectionService.selection$),S.hc(2,3,t.state.presenceControlEntries$),S.hc(3,5,t.state.hasMore$),S.hc(4,7,t.state.loadingPage$)))},directives:[B.a,J,z.m,Y.a,c.i,z.l,Q.a],pipes:[z.b,K.c,z.e],styles:[".edit[_ngcontent-%COMP%]{line-height:1;font-size:2.2rem}.presence-category[_ngcontent-%COMP%]{text-align:center}.presence-category[_ngcontent-%COMP%]   .absent[_ngcontent-%COMP%]{color:#dc3545}.presence-category[_ngcontent-%COMP%]   .present[_ngcontent-%COMP%]{color:#28a745}.presence-category[_ngcontent-%COMP%]   .unapproved[_ngcontent-%COMP%]{color:#ffa814}.designation-incident[_ngcontent-%COMP%]{max-width:50ch}.student[_ngcontent-%COMP%]{color:#33333d}@media screen and (max-width:820px){.edit-absences-checkbox[_ngcontent-%COMP%]{text-align:left}.presence-category[_ngcontent-%COMP%]{text-align:right}.designation-incident[_ngcontent-%COMP%]{max-width:none}}"],changeDetection:0}),e})();function ge(e){return{student:e.student?Number(e.student):null,educationalEvent:e.educationalEvent?Number(e.educationalEvent):null,studyClass:e.studyClass?Number(e.studyClass):null,dateFrom:e.dateFrom?Object(x.c)(e.dateFrom):null,dateTo:e.dateTo?Object(x.c)(e.dateTo):null,presenceTypes:e.presenceTypes?e.presenceTypes.split(",").map(Number):null,confirmationStates:e.confirmationStates?e.confirmationStates.split(",").map(Number):null,incidentTypes:e.incidentTypes?e.incidentTypes.split(",").map(Number):null}}var me=n("3Pt+"),ye=n("2Vo4"),ve=n("eIep"),Se=n("nYR2"),ze=n("BeL+"),Ie=n("CqXF"),Re=n("LpL1"),Oe=n("IClS"),Ce=function(e){return e.Absent="absent",e.Dispensation="dispensation",e.HalfDay="half-day",e.Incident="incident",e.Present="present",e}({});let $e=(()=>{class e{constructor(e,t){this.updateService=e,this.settings=t}update(e,t,n,s,c,a){let r=[];switch(n){case Ce.Present:r=this.createResetBulkRequests(e);break;case Ce.Absent:r=this.createAbsentEditBulkRequests(e,t,s,c);break;case Ce.Dispensation:r=this.createEditBulkRequests(e,null,this.settings.dispensationPresenceTypeId);break;case Ce.HalfDay:r=this.createEditBulkRequests(e,null,this.settings.halfDayPresenceTypeId);break;case Ce.Incident:r=this.createEditBulkRequests(e,null,a)}return Object(i.a)(r).pipe(Object(Ie.a)(void 0))}createAbsentEditBulkRequests(e,t,n,s){return n===this.settings.excusedAbsenceStateId?this.createEditBulkRequests(e,n,s):n===this.settings.unexcusedAbsenceStateId?this.createEditBulkRequests(e,n,this.settings.absencePresenceTypeId):[...this.createEditBulkRequests(e.filter(Te(t,this.settings)),n,this.settings.absencePresenceTypeId),...this.createEditBulkRequests(e.filter(Object(A.d)(Te(t,this.settings))),n,null)]}createResetBulkRequests(e){return Object(Oe.a)(e).map(({lessonIds:e,personIds:t})=>this.updateService.removeLessonPresences(e,t))}createEditBulkRequests(e,t,n){return Object(Oe.a)(e).map(({lessonIds:e,personIds:s})=>this.updateService.editLessonPresences(e,s,n||void 0,t||void 0))}}return e.\u0275fac=function(t){return new(t||e)(S.Zb(Re.a),S.Zb(m.a))},e.\u0275prov=S.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Te(e,t){return n=>{const s=e.find(e=>e.Id===n.TypeRef.Id);return!s||s.Id===t.dispensationPresenceTypeId||s.Id===t.halfDayPresenceTypeId||s.IsIncident}}var Pe=n("A6ef"),je=n("AEFh"),De=n("5eHb");function Fe(e,t){if(1&e&&(S.Sb(0,"div",11),S.Dc(1),S.gc(2,"translate"),S.Rb()),2&e){const e=t.$implicit;S.zb(1),S.Fc(" ",S.ic(2,1,"global.validation-errors."+e.error,e.params)," ")}}function ke(e,t){if(1&e&&(S.Sb(0,"option",23),S.Dc(1),S.Rb()),2&e){const e=t.$implicit;S.lc("ngValue",e.Id),S.zb(1),S.Fc(" ",e.Designation," ")}}function Ee(e,t){if(1&e&&(S.Sb(0,"select",22),S.gc(1,"async"),S.Sb(2,"option",23),S.Dc(3),S.gc(4,"translate"),S.Rb(),S.Bc(5,ke,2,2,"option",24),S.gc(6,"async"),S.Rb()),2&e){const e=S.fc(6);S.Eb("is-invalid",S.hc(1,5,e.absenceTypeIdErrors$).length>0),S.zb(2),S.lc("ngValue",null),S.zb(1),S.Fc(" ",S.hc(4,7,"edit-absences.edit.absence-type-placeholder")," "),S.zb(2),S.lc("ngForOf",S.hc(6,9,e.absenceTypes$))}}function xe(e,t){if(1&e&&(S.Sb(0,"div",25),S.Dc(1),S.gc(2,"translate"),S.Rb()),2&e){const e=t.$implicit;S.zb(1),S.Fc(" ",S.ic(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Ae(e,t){if(1&e&&(S.Sb(0,"div",18),S.Nb(1,"input",19),S.Sb(2,"label",14),S.Dc(3),S.Rb(),S.Bc(4,Ee,7,11,"select",20),S.Bc(5,xe,3,4,"div",21),S.gc(6,"async"),S.Rb()),2&e){const e=t.$implicit,n=S.fc(5);S.zb(1),S.lc("id","state-"+e.Key)("value",e.Key),S.zb(1),S.mc("for","state-"+e.Key),S.zb(1),S.Fc(" ",e.Value," "),S.zb(1),S.lc("ngIf",n.isExcused(e)),S.zb(1),S.lc("ngForOf",S.hc(6,6,n.absenceTypeIdErrors$))}}function Be(e,t){if(1&e&&(S.Sb(0,"div",16),S.Bc(1,Ae,7,8,"div",17),S.Rb()),2&e){const e=S.fc(3).erzLet;S.zb(1),S.lc("ngForOf",e.confirmationStates)}}function Me(e,t){if(1&e&&(S.Sb(0,"option",23),S.Dc(1),S.Rb()),2&e){const e=t.$implicit;S.lc("ngValue",e.Id),S.zb(1),S.Fc(" ",e.Designation," ")}}function we(e,t){if(1&e&&(S.Sb(0,"div",25),S.Dc(1),S.gc(2,"translate"),S.Rb()),2&e){const e=t.$implicit;S.zb(1),S.Fc(" ",S.ic(2,1,"global.validation-errors."+e.error,e.params)," ")}}function Ge(e,t){if(1&e&&(S.Sb(0,"div",16),S.Sb(1,"select",26),S.gc(2,"async"),S.Sb(3,"option",23),S.Dc(4),S.gc(5,"translate"),S.Rb(),S.Bc(6,Me,2,2,"option",24),S.gc(7,"async"),S.Rb(),S.Bc(8,we,3,4,"div",21),S.gc(9,"async"),S.Rb()),2&e){const e=S.fc(4);S.zb(1),S.Eb("is-invalid",S.hc(2,6,e.incidentIdErrors$).length>0),S.zb(2),S.lc("ngValue",null),S.zb(1),S.Fc(" ",S.hc(5,8,"edit-absences.edit.incident-placeholder")," "),S.zb(2),S.lc("ngForOf",S.hc(7,10,e.incidents$)),S.zb(2),S.lc("ngForOf",S.hc(9,12,e.incidentIdErrors$))}}function qe(e,t){if(1&e&&(S.Sb(0,"div",12),S.Nb(1,"input",13),S.Sb(2,"label",14),S.Dc(3),S.gc(4,"translate"),S.Rb(),S.Bc(5,Be,2,1,"div",15),S.Bc(6,Ge,10,14,"div",15),S.Rb()),2&e){const e=t.$implicit,n=S.fc(3);S.zb(1),S.lc("id","category-"+e)("value",e),S.zb(1),S.mc("for","category-"+e),S.zb(1),S.Fc(" ",S.hc(4,6,"edit-absences.edit.categories."+e)," "),S.zb(2),S.lc("ngIf",n.isAbsent(e)),S.zb(1),S.lc("ngIf",n.isIncident(e))}}function Ne(e,t){1&e&&(S.Sb(0,"div",27),S.Sb(1,"span",28),S.Dc(2,"Loading..."),S.Rb(),S.Rb())}function Le(e,t){if(1&e){const e=S.Tb();S.Sb(0,"form",3),S.dc("ngSubmit",function(){return S.vc(e),S.fc(2).onSubmit()}),S.Bc(1,Fe,3,4,"div",4),S.gc(2,"async"),S.Sb(3,"div",5),S.Bc(4,qe,7,8,"div",6),S.Rb(),S.Sb(5,"div",7),S.Sb(6,"button",8),S.dc("click",function(){return S.vc(e),S.fc(2).cancel()}),S.gc(7,"async"),S.Dc(8),S.gc(9,"translate"),S.Rb(),S.Sb(10,"button",9),S.gc(11,"async"),S.Dc(12),S.gc(13,"translate"),S.Bc(14,Ne,3,0,"div",10),S.gc(15,"async"),S.Rb(),S.Rb(),S.Rb()}if(2&e){const e=S.fc().erzLet,t=S.fc();S.lc("formGroup",e.formGroup),S.zb(1),S.lc("ngForOf",S.hc(2,8,t.formErrors$)),S.zb(3),S.lc("ngForOf",e.categories),S.zb(2),S.lc("disabled",S.hc(7,10,t.saving$)),S.zb(2),S.Fc(" ",S.hc(9,12,"edit-absences.edit.cancel")," "),S.zb(2),S.lc("disabled",S.hc(11,14,t.saving$)),S.zb(2),S.Fc(" ",S.hc(13,16,"edit-absences.edit.save")," "),S.zb(2),S.lc("ngIf",S.hc(15,18,t.saving$))}}function Ve(e,t){if(1&e&&(S.Sb(0,"div",1),S.Bc(1,Le,16,20,"form",2),S.Rb()),2&e){const e=t.erzLet;S.zb(1),S.lc("ngIf",e.formGroup&&e.confirmationStates)}}const _e=function(e,t,n){return{confirmationStates:e,categories:t,formGroup:n}};let Ke=(()=>{class e{constructor(e,t,n,s,c,i,l,o,b,d){this.fb=e,this.router=t,this.route=n,this.toastr=s,this.translate=c,this.state=i,this.dropDownItemsService=l,this.presenceTypesService=o,this.updateService=b,this.settings=d,this.absenceTypes$=this.presenceTypesService.confirmationTypes$,this.incidents$=this.presenceTypesService.incidentTypes$,this.formGroup$=this.createFormGroup(),this.saving$=new ye.a(!1),this.submitted$=new ye.a(!1),this.formErrors$=Object(Pe.c)(this.formGroup$,this.submitted$),this.absenceTypeIdErrors$=Object(Pe.c)(this.formGroup$,this.submitted$,"absenceTypeId"),this.incidentIdErrors$=Object(Pe.c)(this.formGroup$,this.submitted$,"incidentId"),this.availableCategories=[Ce.Absent,Ce.Dispensation,Ce.HalfDay,Ce.Incident,Ce.Present],this.confirmationStates$=this.dropDownItemsService.getAbsenceConfirmationStates().pipe(Object(r.a)(this.sortAbsenceConfirmationStates.bind(this)),Object(a.a)(1)),this.activeCategories$=this.presenceTypesService.halfDayActive$.pipe(Object(r.a)(e=>e?this.availableCategories:this.availableCategories.filter(e=>e!==Ce.HalfDay))),this.destroy$=new $.a}ngOnInit(){0===this.state.selected.length&&this.navigateBack(),Object(Pe.b)(this.formGroup$,"category").pipe(Object(l.a)(this.destroy$)).subscribe(this.updateConfirmationValueDisabled.bind(this)),Object(Pe.b)(this.formGroup$,"confirmationValue").pipe(Object(l.a)(this.destroy$)).subscribe(this.updateAbsenceTypeIdDisabled.bind(this))}ngOnDestroy(){this.destroy$.next()}isAbsent(e){return e===Ce.Absent}isExcused(e){return e.Key===this.settings.excusedAbsenceStateId}isIncident(e){return e===Ce.Incident}onSubmit(){this.submitted$.next(!0),this.formGroup$.pipe(Object(T.a)(1)).subscribe(e=>{e.valid&&this.save(e)})}cancel(){this.navigateBack()}createFormGroup(){return this.getInitialAbsenceTypeId().pipe(Object(r.a)(e=>this.fb.group({category:[Ce.Absent,me.q.required],confirmationValue:[this.settings.excusedAbsenceStateId,me.q.required],absenceTypeId:[e,me.q.required],incidentId:[{value:null,disabled:!0},me.q.required]})),Object(a.a)(1))}getInitialAbsenceTypeId(){return this.absenceTypes$.pipe(Object(T.a)(1),Object(r.a)(e=>{const t=e.map(e=>e.Id),n=Object(ze.a)(this.state.selected.map(e=>e.TypeRef.Id));return 1===n.length&&null!=n[0]&&t.includes(n[0])?n[0]:null}))}updateConfirmationValueDisabled(){this.formGroup$.pipe(Object(T.a)(1)).subscribe(e=>{const t=e.get("category"),n=e.get("confirmationValue"),s=e.get("absenceTypeId"),c=e.get("incidentId");t&&n&&s&&c&&(t.value===Ce.Absent?(n.enable(),this.updateAbsenceTypeIdDisabled()):(n.disable(),s.disable()),t.value===Ce.Incident?c.enable():c.disable())})}updateAbsenceTypeIdDisabled(){this.formGroup$.pipe(Object(T.a)(1)).subscribe(e=>{const t=e.get("confirmationValue"),n=e.get("absenceTypeId");t&&n&&(t.value===this.settings.excusedAbsenceStateId?n.enable():n.disable())})}save(e){this.saving$.next(!0);const{category:t,confirmationValue:n,absenceTypeId:s,incidentId:c}=e.value;this.presenceTypesService.presenceTypes$.pipe(Object(ve.a)(e=>this.updateService.update(this.state.selected,e,t,n,s,c)),Object(Se.a)(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.state.resetSelection(),this.toastr.success(this.translate.instant("edit-absences.edit.save-success")),this.navigateBack(!0)}navigateBack(e){this.route.queryParams.pipe(Object(T.a)(1)).subscribe(t=>{this.router.navigate(["/edit-absences"],{queryParams:Object.assign(Object.assign({},Object(je.b)(t.returnparams)),{reload:e})})})}sortAbsenceConfirmationStates(e){return e.slice().sort((e,t)=>e.Key===this.settings.excusedAbsenceStateId?-1:t.Key===this.settings.excusedAbsenceStateId?1:e.Value.localeCompare(t.Value))}}return e.\u0275fac=function(t){return new(t||e)(S.Mb(me.c),S.Mb(c.g),S.Mb(c.a),S.Mb(De.b),S.Mb(K.d),S.Mb(I),S.Mb(o.a),S.Mb(u.a),S.Mb($e),S.Mb(m.a))},e.\u0275cmp=S.Gb({type:e,selectors:[["erz-edit-absences-edit"]],decls:4,vars:11,consts:[["class","erz-container erz-container-limited erz-container-padding-y",4,"erzLet"],[1,"erz-container","erz-container-limited","erz-container-padding-y"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"formGroup","ngSubmit"],["class","alert alert-danger",4,"ngFor","ngForOf"],[1,"form-group","pb-4"],["class","form-check mt-2 mb-3",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],["type","submit",1,"btn","btn-primary","ml-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"alert","alert-danger"],[1,"form-check","mt-2","mb-3"],["type","radio","formControlName","category",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],["class","ml-5",4,"ngIf"],[1,"ml-5"],["class","form-check mt-2 mb-2",4,"ngFor","ngForOf"],[1,"form-check","mt-2","mb-2"],["type","radio","formControlName","confirmationValue",1,"form-check-input",3,"id","value"],["class","form-control mt-1","formControlName","absenceTypeId",3,"is-invalid",4,"ngIf"],["class","invalid-feedback",4,"ngFor","ngForOf"],["formControlName","absenceTypeId",1,"form-control","mt-1"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"invalid-feedback"],["formControlName","incidentId",1,"form-control","mt-1"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"sr-only"]],template:function(e,t){1&e&&(S.Bc(0,Ve,2,1,"div",0),S.gc(1,"async"),S.gc(2,"async"),S.gc(3,"async")),2&e&&S.lc("erzLet",S.rc(7,_e,S.hc(1,1,t.confirmationStates$),S.hc(2,3,t.activeCategories$),S.hc(3,5,t.formGroup$)))},directives:[B.a,z.m,me.r,me.j,me.e,z.l,me.n,me.b,me.i,me.d,me.p,me.m,me.s],pipes:[z.b,K.c],styles:[""],changeDetection:0}),e})();var He=n("ccj6"),Xe=n("hH5/");const Ze=[{path:"",component:C,children:[{path:"",component:fe,data:{restoreScrollPositionFrom:["/edit-absences/edit","/edit-absences/student/:id"]}},{path:"edit",component:Ke},{path:"student/:id",children:[{path:"",component:He.a},{path:"confirm",component:Xe.a}]}]}];let Je=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=S.Kb({type:e}),e.\u0275inj=S.Jb({imports:[[c.j.forChild(Ze)],c.j]}),e})(),Ue=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=S.Kb({type:e}),e.\u0275inj=S.Jb({imports:[[s.a,Je]]}),e})()}}]);