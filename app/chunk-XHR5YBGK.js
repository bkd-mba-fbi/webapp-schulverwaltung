import{c as Ue}from"./chunk-673RVEOB.js";import{b as J}from"./chunk-KDAC4GJ5.js";import{a as ze}from"./chunk-NYTDIO5P.js";import{a as Ne}from"./chunk-GXZYLK4L.js";import"./chunk-U4HODSW3.js";import{p as Fe}from"./chunk-7LCBKZQT.js";import"./chunk-PSXDSPKS.js";import{e as Y}from"./chunk-C7XT5XXE.js";import{b as we}from"./chunk-YMJC6QZX.js";import"./chunk-Y4QYVF5K.js";import"./chunk-HII3S2DL.js";import{c as U,d as je}from"./chunk-24AFRN2G.js";import"./chunk-RFO4NYUO.js";import"./chunk-5RDJZAUT.js";import"./chunk-DB66EACG.js";import{P as Le,c as Re,j as re,t as Ae,u as Oe}from"./chunk-ZK2MNT7Z.js";import"./chunk-AW7CSGKI.js";import"./chunk-FTDG26ID.js";import{a as W,b as Be,c as Z}from"./chunk-SOHFFTKU.js";import{u as Ee}from"./chunk-C56YGDXA.js";import"./chunk-UX5TA32W.js";import{$ as y,$a as b,Ab as r,Ac as De,Bb as c,Cb as O,Eb as L,Fc as $e,Ga as m,Gd as D,Ha as te,Hd as $,Ia as s,Id as Me,Ja as he,L as x,N as de,O as I,R as pe,Rb as ve,Sa as l,Sb as k,Ta as d,Ua as f,Ub as Se,Va as ie,Vb as B,Vc as w,W as V,Wa as ne,Wb as K,Xa as ae,Ya as be,Z as P,_a as z,ab as ue,bb as fe,ca as le,dc as Ce,f as ee,g as ce,ha as G,ia as q,ib as A,ic as xe,ja as me,jb as h,k as j,kb as T,lb as S,m as u,mb as oe,n as H,nb as ge,pc as Te,qc as Ie,rc as Pe,sb as _e,ta as F,tb as v,ua as o,ub as N,va as _,yb as ye,zc as ke}from"./chunk-XTHSYQMN.js";var at=["*"];function ot(e,t){e&1&&ae(0)}function rt(e,t){if(e&1&&(l(0,"a",4),m(1,ot,1,0,"ng-container",5),d()),e&2){let a=b(),i=A(3);s("routerLink",a.link)("queryParams",a.linkParams),o(),s("ngTemplateOutlet",i)}}function st(e,t){e&1&&ae(0)}function ct(e,t){if(e&1&&(l(0,"a",6),m(1,st,1,0,"ng-container",5),d()),e&2){let a=b(),i=A(3);s("href",a.externalLink,F),o(),s("ngTemplateOutlet",i)}}function dt(e,t){if(e&1&&(l(0,"span",9),h(1),d()),e&2){let a=b(2);o(),T(a.count)}}function pt(e,t){e&1&&(me(),l(0,"svg",10),f(1,"path",11),d())}function lt(e,t){if(e&1&&(l(0,"span",7),h(1),r(2,"translate"),d(),l(3,"div"),fe(4),m(5,dt,2,1,"span",8)(6,pt,2,0,"ng-template",null,1,L),d()),e&2){let a=A(7),i=b();o(),T(c(2,3,i.label)),o(4),s("ngIf",i.hasCount(i.count))("ngIfElse",a)}}var He=(()=>{let t=class t{constructor(){}hasCount(i){return typeof i=="number"&&i>=0}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=y({type:t,selectors:[["bkd-dashboard-action"]],inputs:{label:"label",count:"count",link:"link",linkParams:"linkParams",externalLink:"externalLink"},standalone:!0,features:[v],ngContentSelectors:at,decls:4,vars:2,consts:[["actionContent",""],["icon",""],[3,"routerLink","queryParams",4,"ngIf"],[3,"href",4,"ngIf"],[3,"routerLink","queryParams"],[4,"ngTemplateOutlet"],[3,"href"],[1,"label"],["class","count",4,"ngIf","ngIfElse"],[1,"count"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none"],["fill","currentColor","d","m12 20-1.425-1.4 5.6-5.6H4v-2h12.175l-5.6-5.6L12 4l8 8-8 8Z"]],template:function(n,p){n&1&&(ue(),m(0,rt,2,3,"a",2)(1,ct,2,2,"a",3)(2,lt,8,5,"ng-template",null,0,L)),n&2&&(s("ngIf",!p.externalLink),o(),s("ngIf",p.externalLink))},dependencies:[k,Pe,Se,$,D],styles:["a[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:space-between;align-items:center;padding:1rem 1.5rem;background:#f7e9d2;text-decoration:none;line-height:1}a[_ngcontent-%COMP%]:hover{background:#f2e0c3}a[_ngcontent-%COMP%]:focus-visible{outline-width:2px;outline-offset:-2px}div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:1rem}.label[_ngcontent-%COMP%]{font-weight:400}.count[_ngcontent-%COMP%]{font-size:1.5rem}"]});let e=t;return e})();var Ve=(()=>{let t=class t{constructor(){}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=y({type:t,selectors:[["bkd-dashboard-deadline"]],inputs:{count:"count"},standalone:!0,features:[v],decls:3,vars:8,template:function(n,p){n&1&&(h(0),r(1,"translate"),r(2,"addSpace")),n&2&&ge("",c(1,3,"dashboard.actions.deadline"),"",O(2,5,": ",":"),"",p.count,`
`)},dependencies:[$,D,je],styles:["[_nghost-%COMP%]{background:#ea161f;color:#fff;white-space:nowrap;font-weight:500;font-size:.875rem;min-height:1.5rem;display:flex;padding:.375rem .5rem;align-items:center;border-radius:2.5rem}"]});let e=t;return e})();var Ge=$e({Id:De,Holder:ke});var qe=(()=>{let t=class t extends Be{constructor(i,n){super(i,n,Ge,"TeacherSubstitutions")}getTeacherSubstitution(i){return this.getList({params:{"filter.Id":`=${i}`}}).pipe(u(n=>n[0]||null))}};t.\u0275fac=function(n){return new(n||t)(P(Ce),P(w))},t.\u0275prov=V({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var ut=["LessonTeacherRole","ClassTeacherRole","TeacherRole","AbsenceAdministratorRole"],ft=["LessonTeacherRole","TeacherRole","StudentRole","SubstituteAdministratorRole"],gt=["LessonTeacherRole","StudentRole"],E=(()=>{let t=class t{constructor(i,n,p,C,R,tt,it,nt){this.settingsService=i,this.lessonPresencesService=n,this.studentsService=p,this.courseService=C,this.teacherSubstitutionService=R,this.personService=tt,this.storageService=it,this.settings=nt,this.rolesAndPermissions$=this.settingsService.getRolesAndPermissions(),this.studentId$=new ce(1),this.lessonAbsences$=this.studentId$.pipe(I(g=>this.studentsService.getLessonAbsences(g)),x(1)),this.lessonIncidents$=this.studentId$.pipe(I(g=>this.studentsService.getLessonIncidents(g)),x(1)),this.loading$=this.rolesAndPermissions$.pipe(u(g=>g==null)),this.hasSearch$=this.rolesAndPermissions$.pipe(u(this.hasRoles(ut))),this.hasActions$=this.rolesAndPermissions$.pipe(u(this.hasRoles(ft))),this.hasTimetable$=this.rolesAndPermissions$.pipe(u(this.hasRoles(gt))),this.hasLessonTeacherRole$=this.rolesAndPermissions$.pipe(u(this.hasRoles(["LessonTeacherRole"])),x(1)),this.hasTeacherRole$=this.rolesAndPermissions$.pipe(u(this.hasRoles(["TeacherRole"])),x(1)),this.hasStudentRole$=this.rolesAndPermissions$.pipe(u(this.hasRoles(["StudentRole"])),x(1)),this.hasSubstituteAdministratorRole$=this.rolesAndPermissions$.pipe(u(this.hasRoles(["SubstituteAdministratorRole"])),x(1)),this.editAbsencesCount$=this.hasLessonTeacherRole$.pipe(I(g=>g?this.lessonPresencesService.checkableAbsencesCount():j(!1)),x(1)),this.openAbsencesCount$=this.rolesAndPermissions$.pipe(u(this.hasRoles(["LessonTeacherRole","ClassTeacherRole"])),I(g=>g?this.lessonPresencesService.getListOfUnconfirmed():j([])),u(g=>g.length),x(1)),this.myAbsencesCount$=this.hasStudentRole$.pipe(I(g=>g?this.getMyAbsences():j([])),u(this.getMyAbsencesCount.bind(this)),x(1)),this.coursesToRateCount$=this.courseService.getNumberOfCoursesForRating().pipe(de(0),x(1)),this.hasPresenceControl$=this.hasLessonTeacherRole$.pipe(I(g=>g?this.lessonPresencesService.hasLessonsLessonTeacher():j(!1)),x(1)),this.hasOpenAbsences$=this.openAbsencesCount$.pipe(u(g=>g>0),x(1)),this.editAbsencesParams$=this.getFullName().pipe(u(g=>({confirmationStates:this.settings.checkableAbsenceStateId,teacher:g})),x(1));let se=this.storageService.getPayload()?.id_person;se&&this.studentId$.next(Number(se))}hasRoles(i){return n=>(n??[]).some(p=>i.includes(p))}getMyAbsences(){return H([this.studentId$,this.lessonAbsences$,this.lessonIncidents$]).pipe(I(([i,n,p])=>this.loadTimetableEntries(i,n,p).pipe(u(C=>[...n,...p].map(R=>this.withTimetableEntry(R,C)).filter(Ee)))))}getMyAbsencesCount(i){return i?.filter(n=>("ConfirmationStateId"in n?n.ConfirmationStateId:null)===this.settings.unconfirmedAbsenceStateId).length||0}getFullName(){let i=Number(this.storageService.getPayload()?.substitution_id)||null;return i?this.teacherSubstitutionService.getTeacherSubstitution(i).pipe(u(n=>n?.Holder)):this.personService.getMyself().pipe(u(n=>n.FullName))}withTimetableEntry(i,n){return n.find(p=>p.Id===i.LessonRef.Id)?i:null}loadTimetableEntries(i,n,p){return this.studentsService.getTimetableEntries(i,{"filter.Id":`;${[...n,...p].map(C=>C.LessonRef.Id).join(";")}`})}};t.\u0275fac=function(n){return new(n||t)(P(J),P(Y),P(U),P(Fe),P(qe),P(we),P(Me),P(w))},t.\u0275prov=V({token:t,factory:t.\u0275fac});let e=t;return e})();var _t=()=>["/presence-control"],yt=()=>["/edit-absences"],vt=()=>["/open-absences"],St=()=>["/events"],Ct=()=>["/my-absences","report"],xt=()=>["/my-absences"];function Tt(e,t){e&1&&f(0,"bkd-dashboard-action",4),e&2&&s("label","dashboard.actions.presence-control")("link",N(2,_t))}function It(e,t){if(e&1&&(f(0,"bkd-dashboard-action",5),r(1,"async"),r(2,"async")),e&2){let a=b();s("label","dashboard.actions.edit-absences")("link",N(8,yt))("linkParams",c(1,4,a.dashboardService.editAbsencesParams$))("count",c(2,6,a.dashboardService.editAbsencesCount$))}}function Pt(e,t){if(e&1&&(f(0,"bkd-dashboard-action",6),r(1,"async")),e&2){let a=b();s("label","dashboard.actions.open-absences")("link",N(5,vt))("count",c(1,3,a.dashboardService.openAbsencesCount$))}}function kt(e,t){if(e&1&&(f(0,"bkd-dashboard-deadline",8),r(1,"async")),e&2){let a=b(2);s("count",c(1,1,a.dashboardService.coursesToRateCount$))}}function Dt(e,t){if(e&1&&(l(0,"bkd-dashboard-action",4),m(1,kt,2,3,"bkd-dashboard-deadline",7),r(2,"async"),d()),e&2){let a,i=b();s("label","dashboard.actions.tests")("link",N(5,St)),o(),s("ngIf",(a=c(2,3,i.dashboardService.coursesToRateCount$))!==null&&a!==void 0?a:!1)}}function $t(e,t){e&1&&f(0,"bkd-dashboard-action",4),e&2&&s("label","dashboard.actions.my-absences-report")("link",N(2,Ct))}function Mt(e,t){if(e&1&&(f(0,"bkd-dashboard-action",6),r(1,"async")),e&2){let a=b();s("label","dashboard.actions.my-absences")("link",N(5,xt))("count",c(1,3,a.dashboardService.myAbsencesCount$))}}function Et(e,t){if(e&1&&f(0,"bkd-dashboard-action",9),e&2){let a=b();s("label","dashboard.actions.substitutions")("externalLink",a.substitutionsAdminLink)}}var We=(()=>{let t=class t{constructor(i,n){this.dashboardService=i,this.settings=n}get substitutionsAdminLink(){return this.settings.dashboard.substitutionsAdminLink}};t.\u0275fac=function(n){return new(n||t)(_(E),_(w))},t.\u0275cmp=y({type:t,selectors:[["bkd-dashboard-actions"]],standalone:!0,features:[v],decls:15,vars:23,consts:[[3,"label","link",4,"ngIf"],[3,"label","link","linkParams","count",4,"ngIf"],[3,"label","link","count",4,"ngIf"],[3,"label","externalLink",4,"ngIf"],[3,"label","link"],[3,"label","link","linkParams","count"],[3,"label","link","count"],[3,"count",4,"ngIf"],[3,"count"],[3,"label","externalLink"]],template:function(n,p){n&1&&(m(0,Tt,1,3,"bkd-dashboard-action",0),r(1,"async"),m(2,It,3,9,"bkd-dashboard-action",1),r(3,"async"),r(4,"async"),m(5,Pt,2,6,"bkd-dashboard-action",2),r(6,"async"),m(7,Dt,3,6,"bkd-dashboard-action",0),r(8,"async"),m(9,$t,1,3,"bkd-dashboard-action",0),r(10,"async"),m(11,Mt,2,6,"bkd-dashboard-action",2),r(12,"async"),m(13,Et,1,2,"bkd-dashboard-action",3),r(14,"async")),n&2&&(s("ngIf",c(1,7,p.dashboardService.hasPresenceControl$)),o(2),s("ngIf",c(3,9,p.dashboardService.hasLessonTeacherRole$)&&c(4,11,p.dashboardService.editAbsencesParams$)),o(3),s("ngIf",c(6,13,p.dashboardService.hasOpenAbsences$)),o(2),s("ngIf",c(8,15,p.dashboardService.hasTeacherRole$)),o(2),s("ngIf",c(10,17,p.dashboardService.hasStudentRole$)),o(2),s("ngIf",c(12,19,p.dashboardService.hasStudentRole$)),o(2),s("ngIf",c(14,21,p.dashboardService.hasSubstituteAdministratorRole$)))},dependencies:[k,He,Ve,B],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:.5rem}"]});let e=t;return e})();var Ye=(()=>{let t=class t{constructor(i,n){this.studentsRestService=i,this.router=n}navigateToDossier(i){let n=Number(i);this.router.navigate(["dashboard","student",n,"addresses"])}};t.\u0275fac=function(n){return new(n||t)(_(U),_(Ie))},t.\u0275cmp=y({type:t,selectors:[["bkd-dashboard-search"]],standalone:!0,features:[v],decls:1,vars:2,consts:[[3,"valueChange","typeaheadService","placeholder"]],template:function(n,p){n&1&&(l(0,"bkd-typeahead",0),z("valueChange",function(R){return R&&p.navigateToDossier(R)}),d()),n&2&&s("typeaheadService",p.studentsRestService)("placeholder","dashboard.search.placeholder")},dependencies:[ze],styles:["[_nghost-%COMP%]{display:block;padding:.75rem;background:#f7e9d2}"]});let e=t;return e})();var Ze=(()=>{let t=class t{constructor(i){this.sanitizer=i}transform(i,n){switch(n){case"html":return this.sanitizer.bypassSecurityTrustHtml(i);case"style":return this.sanitizer.bypassSecurityTrustStyle(i);case"script":return this.sanitizer.bypassSecurityTrustScript(i);case"url":return this.sanitizer.bypassSecurityTrustUrl(i);case"resourceUrl":return this.sanitizer.bypassSecurityTrustResourceUrl(i);default:throw new Error(`Invalid safe type specified: ${n}`)}}};t.\u0275fac=function(n){return new(n||t)(_(xe,16))},t.\u0275pipe=le({name:"safe",type:t,pure:!0,standalone:!0});let e=t;return e})();function Rt(e,t){e&1&&(l(0,"th"),h(1),r(2,"translate"),d()),e&2&&(o(),S(" ",c(2,1,"dashboard.timetable.table.teacher")," "))}function At(e,t){e&1&&(l(0,"th"),h(1),r(2,"translate"),d()),e&2&&(o(),S(" ",c(2,1,"dashboard.timetable.table.room")," "))}function Ot(e,t){if(e&1&&(l(0,"a",12),h(1),l(2,"span",13),h(3),d()()),e&2){let a=b().$implicit,i=b(2);s("href",i.buildLink(a.eventId),F),o(),S(" ",a.subject,""),o(2),S(", ",a.studyClass,"")}}function Lt(e,t){if(e&1&&h(0),e&2){let a=b().$implicit;S(" ",a.subject," ")}}function Bt(e,t){if(e&1&&(l(0,"td",14),h(1),r(2,"translate"),d()),e&2){let a=b().$implicit;o(),oe(" ",c(2,2,"dashboard.timetable.table.study-class"),": ",a.studyClass," ")}}function wt(e,t){if(e&1&&(l(0,"td",15),h(1),d()),e&2){let a=b().$implicit;o(),S(" ",a.teacher," ")}}function jt(e,t){e&1&&(l(0,"span",18),h(1),r(2,"translate"),d()),e&2&&(o(),T(c(2,1,"dashboard.timetable.table.room")))}function Ft(e,t){if(e&1&&(l(0,"td",16),m(1,jt,3,3,"span",17),h(2),d()),e&2){let a=b().$implicit;o(),s("ngIf",a.room),o(),S(" ",a.room," ")}}function Nt(e,t){if(e&1&&(l(0,"tr")(1,"td",6),h(2),r(3,"date"),r(4,"date"),d(),l(5,"td",7),m(6,Ot,4,3,"a",8),r(7,"async"),m(8,Lt,1,1,"ng-template",null,1,L),d(),m(10,Bt,3,4,"td",9),r(11,"async"),m(12,wt,2,1,"td",10),r(13,"async"),m(14,Ft,3,2,"td",11),r(15,"async"),d()),e&2){let a=t.$implicit,i=A(9),n=b(2);o(2),oe(" ",O(3,7,a.from,"HH:mm"),"\u2013",O(4,10,a.until,"HH:mm")," "),o(4),s("ngIf",c(7,13,n.isTeacher$))("ngIfElse",i),o(4),s("ngIf",c(11,15,n.isTeacher$)),o(2),s("ngIf",c(13,17,n.isStudent$)),o(2),s("ngIf",c(15,19,n.isStudent$))}}function zt(e,t){if(e&1&&(l(0,"table",3)(1,"thead")(2,"tr")(3,"th"),h(4),r(5,"translate"),d(),l(6,"th"),h(7),r(8,"translate"),d(),m(9,Rt,3,3,"th",4),r(10,"async"),m(11,At,3,3,"th",4),r(12,"async"),d()(),l(13,"tbody"),m(14,Nt,16,21,"tr",5),d()()),e&2){let a=b();o(4),T(c(5,5,"dashboard.timetable.table.time")),o(3),T(c(8,7,"dashboard.timetable.table.subject")),o(2),s("ngIf",c(10,9,a.isStudent$)),o(2),s("ngIf",c(12,11,a.isStudent$)),o(3),s("ngForOf",a.entries)}}function Ut(e,t){e&1&&(l(0,"p"),h(1),r(2,"translate"),d()),e&2&&(o(),T(c(2,1,"dashboard.timetable.no-entries")))}var Je=(()=>{let t=class t{constructor(i,n){this.dashboardService=i,this.settings=n,this.entries=[],this.isStudent$=this.dashboardService.hasStudentRole$,this.isTeacher$=this.dashboardService.hasLessonTeacherRole$}buildLink(i){return this.settings.eventlist.eventdetail.replace(":id",String(i))}};t.\u0275fac=function(n){return new(n||t)(_(E),_(w))},t.\u0275cmp=y({type:t,selectors:[["bkd-dashboard-timetable-table"]],inputs:{entries:"entries"},standalone:!0,features:[v],decls:3,vars:2,consts:[["noEntries",""],["noLink",""],["class","table",4,"ngIf","ngIfElse"],[1,"table"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"time"],[1,"subject"],["target","_parent",3,"href",4,"ngIf","ngIfElse"],["class","study-class",4,"ngIf"],["class","teacher",4,"ngIf"],["class","room",4,"ngIf"],["target","_parent",3,"href"],[1,"subject-study-class"],[1,"study-class"],[1,"teacher"],[1,"room"],["class","room-label",4,"ngIf"],[1,"room-label"]],template:function(n,p){if(n&1&&m(0,zt,15,13,"table",2)(1,Ut,3,3,"ng-template",null,0,L),n&2){let C=A(2);s("ngIf",p.entries.length>0)("ngIfElse",C)}},dependencies:[k,ve,B,K,$,D],styles:['td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{padding:1rem 1.75rem}.room-label[_ngcontent-%COMP%], td.study-class[_ngcontent-%COMP%]{display:none}@media (max-width: 767.98px){table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{display:none}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]{border-top:1px solid var(--bs-border-color)}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-template-areas:"time room" "subject subject" "study-class study-class" "teacher teacher";gap:.5rem;padding:1rem;border-bottom:1px solid var(--bs-border-color)}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:0;padding:0}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.time[_ngcontent-%COMP%]{grid-area:time;font-size:.875rem;line-height:1.125rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.subject[_ngcontent-%COMP%]{grid-area:subject;font-size:1rem;line-height:1.25rem;font-weight:400}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.teacher[_ngcontent-%COMP%]{grid-area:teacher;font-size:.8125rem;line-height:1.0625rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.room[_ngcontent-%COMP%]{grid-area:room;text-align:right;font-size:.875rem;line-height:1.125rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.study-class[_ngcontent-%COMP%]{grid-area:study-class;font-size:.8125rem;line-height:1.0625rem;font-weight:300}td.study-class[_ngcontent-%COMP%]{display:block}.subject-study-class[_ngcontent-%COMP%]{display:none}.room-label[_ngcontent-%COMP%]{display:inline}}']});let e=t;return e})();function Ht(e,t){if(e&1&&(l(0,"a",9),r(1,"safe"),h(2),r(3,"translate"),d()),e&2){let a=t.ngIf;s("href",O(1,2,a,"url"),F),o(2),S(" ",c(3,5,"dashboard.timetable.subscribe-calendar")," ")}}function Vt(e,t){if(e&1&&(l(0,"a",13),r(1,"safe"),h(2),r(3,"translate"),d()),e&2){let a=t.ngIf;s("href",O(1,2,a,"url"),F),o(2),S(" ",c(3,5,"dashboard.timetable.subscribe-calendar")," ")}}function Gt(e,t){if(e&1&&(ie(0),f(1,"bkd-dashboard-timetable-table",11),m(2,Vt,4,7,"a",12),r(3,"async"),ne()),e&2){let a=b().bkdLet,i=b();o(),s("entries",a),o(),s("ngIf",c(3,2,i.getSubscribeCalendarUrl()))}}function qt(e,t){if(e&1&&(ie(0),m(1,Gt,4,4,"ng-container",10),r(2,"async"),ne()),e&2){let a=b(),i=A(21);o(),s("ngIf",c(2,2,a.loading$)===!1)("ngIfElse",i)}}function Kt(e,t){e&1&&f(0,"bkd-spinner")}var Wt="cal",Qe=(()=>{let t=class t{constructor(i,n,p,C){this.studentsService=i,this.lessonPresencesService=n,this.userSettings=p,this.dashboardService=C,this.studentId$=this.dashboardService.studentId$,this.isTeacher$=this.dashboardService.hasLessonTeacherRole$,this.isStudent$=this.dashboardService.hasStudentRole$,this.date$=new ee(re(new Date)),this.loading$=new ee(!0),this.timetableEntries$=this.loadTimetableEntries()}gotoToday(){this.loading$.next(!0),this.date$.next(re(new Date))}gotoPreviousDay(){this.loading$.next(!0),this.date$.next(Oe(this.date$.getValue(),1))}gotoNextDay(){this.loading$.next(!0),this.date$.next(Re(this.date$.getValue(),1))}getSubscribeCalendarUrl(){return this.userSettings.getSetting(Wt)}loadTimetableEntries(){return H([this.isTeacher$,this.isStudent$]).pipe(I(([i,n])=>i?this.loadTeacherTimetableEntries():n?this.loadStudentTimetableEntries():j([])),pe(()=>this.loading$.next(!1)))}loadTeacherTimetableEntries(){return this.date$.pipe(I(i=>this.lessonPresencesService.getLessonsByDate(i)),u(Ue),u(i=>i.map(this.convertLesson.bind(this))))}loadStudentTimetableEntries(){return H([this.studentId$,this.date$]).pipe(I(([i,n])=>this.studentsService.getTimetableEntries(i,{"filter.From":`=${Ae(n,"yyyy-MM-dd")}`,sort:"From,To"})),u(i=>i.map(this.convertTimetableEntry.bind(this))))}convertLesson(i){return{id:i.LessonRef.Id,from:i.LessonDateTimeFrom,until:i.LessonDateTimeTo,eventId:i.EventRef.Id,subject:i.EventDesignation,studyClass:i.StudyClassNumber}}convertTimetableEntry(i){return{id:i.Id,from:i.From,until:i.To,eventId:i.EventId,subject:i.EventDesignation,room:i.EventLocation||void 0,teacher:i.EventManagerInformation||void 0}}};t.\u0275fac=function(n){return new(n||t)(_(U),_(Y),_(J),_(E))},t.\u0275cmp=y({type:t,selectors:[["bkd-dashboard-timetable"]],standalone:!0,features:[v],decls:22,vars:21,consts:[["loading",""],[1,"header"],["type","button",1,"btn","btn-primary","today",3,"click"],["type","button",1,"btn","btn-secondary","previous-day",3,"click"],[1,"material-icons"],["type","button",1,"btn","btn-secondary","next-day",3,"click"],[1,"date"],["target","_parent","class","btn btn-secondary subscribe-calendar-header",3,"href",4,"ngIf"],[4,"bkdLet"],["target","_parent",1,"btn","btn-secondary","subscribe-calendar-header",3,"href"],[4,"ngIf","ngIfElse"],[3,"entries"],["target","_parent","class","btn btn-secondary subscribe-calendar-bottom",3,"href",4,"ngIf"],["target","_parent",1,"btn","btn-secondary","subscribe-calendar-bottom",3,"href"]],template:function(n,p){if(n&1){let C=be();l(0,"div",1)(1,"button",2),z("click",function(){return G(C),q(p.gotoToday())}),h(2),r(3,"translate"),d(),l(4,"button",3),r(5,"translate"),z("click",function(){return G(C),q(p.gotoPreviousDay())}),l(6,"span",4),h(7,"chevron_left"),d()(),l(8,"button",5),r(9,"translate"),z("click",function(){return G(C),q(p.gotoNextDay())}),l(10,"span",4),h(11,"chevron_right"),d()(),l(12,"div",6),h(13),r(14,"async"),r(15,"date"),d(),m(16,Ht,4,7,"a",7),r(17,"async"),d(),m(18,qt,3,4,"ng-container",8),r(19,"async"),m(20,Kt,1,0,"ng-template",null,0,L)}n&2&&(o(2),S(" ",c(3,6,"dashboard.timetable.today")," "),o(2),te("aria-label",c(5,8,"dashboard.timetable.previousDay")),o(4),te("aria-label",c(9,10,"dashboard.timetable.nextDay")),o(5),T(O(15,14,c(14,12,p.date$),"E, dd. MMMM yyyy")),o(3),s("ngIf",c(17,17,p.getSubscribeCalendarUrl())),o(2),s("bkdLet",c(19,19,p.timetableEntries$)))},dependencies:[k,W,Je,Z,B,K,$,D,Ze],styles:["[_nghost-%COMP%]{display:block;margin-bottom:1rem}.header[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:2rem;display:flex;align-items:center;gap:1rem}.previous-day[_ngcontent-%COMP%], .next-day[_ngcontent-%COMP%]{padding-left:.375rem;padding-right:.375rem}.date[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600}.subscribe-calendar-header[_ngcontent-%COMP%]{margin-left:auto}.subscribe-calendar-bottom[_ngcontent-%COMP%]{display:none}a.btn[_ngcontent-%COMP%]{text-decoration:none}@media (max-width: 767.98px){.subscribe-calendar-header[_ngcontent-%COMP%]{display:none}.subscribe-calendar-bottom[_ngcontent-%COMP%]{display:block;margin-top:2rem}}@media (max-width: 767.98px) and (max-width: 575.98px){.header[_ngcontent-%COMP%]{flex-wrap:wrap-reverse}.header[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{width:100%}}"]});let e=t;return e})();var Yt=(e,t,a,i)=>({loading:e,hasSearch:t,hasActions:a,hasTimetable:i});function Zt(e,t){e&1&&f(0,"bkd-spinner")}function Jt(e,t){e&1&&(l(0,"p"),h(1),r(2,"translate"),d()),e&2&&(o(),S(" ",c(2,1,"dashboard.no-access")," "))}function Qt(e,t){e&1&&(l(0,"div")(1,"h2"),h(2),r(3,"translate"),d(),f(4,"bkd-dashboard-search"),d()),e&2&&(o(2),T(c(3,1,"dashboard.search.title")))}function Xt(e,t){e&1&&(l(0,"div")(1,"h2"),h(2),r(3,"translate"),d(),f(4,"bkd-dashboard-actions"),d()),e&2&&(o(2),T(c(3,1,"dashboard.actions.title")))}function ei(e,t){if(e&1&&(l(0,"div",5),m(1,Qt,5,3,"div",1)(2,Xt,5,3,"div",1),d()),e&2){let a=b().bkdLet;o(),s("ngIf",a.hasSearch),o(),s("ngIf",a.hasActions)}}function ti(e,t){e&1&&(l(0,"div",6)(1,"h2"),h(2),r(3,"translate"),d(),f(4,"bkd-dashboard-timetable"),d()),e&2&&(o(2),T(c(3,1,"dashboard.timetable.title")))}function ii(e,t){if(e&1&&(l(0,"div")(1,"h1"),h(2),r(3,"translate"),d(),m(4,Zt,1,0,"bkd-spinner",1)(5,Jt,3,3,"p",1),l(6,"div",2),m(7,ei,3,2,"div",3)(8,ti,5,3,"div",4),d()()),e&2){let a=t.bkdLet;o(),he("visually-hidden",a.loading||a.hasSearch||a.hasActions||a.hasTimetable),o(),S(" ",c(3,7,"dashboard.heading")," "),o(2),s("ngIf",a.loading),o(),s("ngIf",!a.loading&&!a.hasSearch&&!a.hasActions&&!a.hasTimetable),o(2),s("ngIf",a.hasSearch||a.hasActions),o(),s("ngIf",a.hasTimetable)}}var Xe=(()=>{let t=class t{constructor(i){this.dashboardService=i}};t.\u0275fac=function(n){return new(n||t)(_(E))},t.\u0275cmp=y({type:t,selectors:[["bkd-dashboard-layout"]],standalone:!0,features:[v],decls:5,vars:14,consts:[[4,"bkdLet"],[4,"ngIf"],[1,"columns"],["class","search-actions-column",4,"ngIf"],["class","timetable-column",4,"ngIf"],[1,"search-actions-column"],[1,"timetable-column"]],template:function(n,p){n&1&&(m(0,ii,9,9,"div",0),r(1,"async"),r(2,"async"),r(3,"async"),r(4,"async")),n&2&&s("bkdLet",ye(9,Yt,c(1,1,p.dashboardService.loading$),c(2,3,p.dashboardService.hasSearch$),c(3,5,p.dashboardService.hasActions$),c(4,7,p.dashboardService.hasTimetable$)))},dependencies:[W,k,Z,Ye,We,Qe,B,$,D],styles:[".columns[_ngcontent-%COMP%]{display:flex;flex-direction:column}.columns[_ngcontent-%COMP%], .search-actions-column[_ngcontent-%COMP%]{gap:3rem}.search-actions-column[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;max-width:40rem}.timetable-column[_ngcontent-%COMP%]{flex:2}@media (min-width: 992px){.columns[_ngcontent-%COMP%]{flex-direction:row;gap:1.5rem}.search-actions-column[_ngcontent-%COMP%]{max-width:33%}}"],changeDetection:0});let e=t;return e})();var et=(()=>{let t=class t{constructor(){}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=y({type:t,selectors:[["bkd-dashboard"]],standalone:!0,features:[_e([E,Le]),v],decls:1,vars:0,template:function(n,p){n&1&&f(0,"router-outlet")},dependencies:[Te],changeDetection:0});let e=t;return e})();var dn=[{path:"",component:et,children:[{path:"",component:Xe},Ne]}];export{dn as DASHBOARD_ROUTES};
