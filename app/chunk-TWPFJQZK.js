import{a as Ve,b as qe}from"./chunk-YO5BCTET.js";import{b as X}from"./chunk-QB4CDTWV.js";import"./chunk-3P4HUOY6.js";import"./chunk-LQUABKN6.js";import{a as Ge}from"./chunk-Y3BQLEPF.js";import"./chunk-WTWAOIVR.js";import{b as He}from"./chunk-TBAOP5LK.js";import"./chunk-KGBYWMYF.js";import{l as Ue}from"./chunk-J4ZWCX23.js";import"./chunk-N2RKIMWO.js";import{e as J}from"./chunk-FMUJPUYQ.js";import{b as Fe}from"./chunk-SKUS47ZU.js";import"./chunk-Y4QYVF5K.js";import"./chunk-H664QRX4.js";import"./chunk-ETZGBBG5.js";import"./chunk-2ZRHGKSY.js";import{d as Ne,f as B,g as ze}from"./chunk-26VH6QDS.js";import"./chunk-JGKXAFYO.js";import{d as Be}from"./chunk-A7EOJZ46.js";import"./chunk-ZELJ2QPT.js";import{D as we,g as Oe,h as Le}from"./chunk-KQORGECX.js";import"./chunk-K42F6AEW.js";import{e as re,o as Ie}from"./chunk-NC6UEGAF.js";import{i as je}from"./chunk-SL67CYEF.js";import{a as Z,h as Q}from"./chunk-HQSONWXM.js";import{x as Ae}from"./chunk-RXRYDGZR.js";import"./chunk-F4XODHS2.js";import{$ as l,$a as ue,Cc as Te,Dc as Pe,Eb as k,Ec as W,Fb as F,Gb as N,Hb as ye,Ia as v,Ib as I,La as me,M as y,Mc as De,Nb as o,Nc as $e,Nd as ke,O as le,Ob as r,Od as Me,P as T,Pa as m,Pb as M,Ra as te,Rb as ve,Sa as f,Sc as Y,Sd as D,Ta as he,Ud as Ee,Wd as Re,X as L,Xa as h,_a as be,a as z,ab as d,b as U,bb as c,cb as g,d as se,ea as V,fa as q,fb as ie,fc as Se,g as ce,ga as pe,gb as fe,gc as R,h as de,hc as G,hd as A,ib as w,jb as u,kb as _e,l as E,lb as Ce,mc as ae,n as b,o as H,qc as K,ub as ne,vb as p,vc as xe,wb as x,xa as j,xb as S,ya as n,yb as oe,zb as ge}from"./chunk-NEW5VGRB.js";var Ke=Y({Id:$e,Holder:De});var We=(()=>{class e extends Z{constructor(){let i=l(K),t=l(A);super(i,t,Ke,"TeacherSubstitutions")}getTeacherSubstitution(i){return this.getList({params:{"filter.Id":`=${i}`}}).pipe(b(t=>t[0]||null))}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275prov=L({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var lt=["LessonTeacherRole","ClassTeacherRole","TeacherRole","AbsenceAdministratorRole"],pt=["LessonTeacherRole","TeacherRole","StudentRole","SubstituteAdministratorRole"],mt=["LessonTeacherRole","StudentRole"],$=(()=>{class e{constructor(){this.settingsService=l(X),this.lessonPresencesService=l(J),this.studentsService=l(B),this.courseService=l(Ue),this.teacherSubstitutionService=l(We),this.personService=l(Fe),this.storageService=l(Ee),this.settings=l(A),this.rolesAndPermissions$=this.settingsService.getRolesAndPermissions(),this.userId$=new de(1),this.lessonAbsences$=this.userId$.pipe(T(t=>this.studentsService.getLessonAbsences(t)),y(1)),this.lessonIncidents$=this.userId$.pipe(T(t=>this.studentsService.getLessonIncidents(t)),y(1)),this.loading$=this.rolesAndPermissions$.pipe(b(t=>t==null)),this.hasSearch$=this.rolesAndPermissions$.pipe(b(this.hasRoles(lt))),this.hasActions$=this.rolesAndPermissions$.pipe(b(this.hasRoles(pt))),this.hasTimetable$=this.rolesAndPermissions$.pipe(b(this.hasRoles(mt))),this.hasLessonTeacherRole$=this.rolesAndPermissions$.pipe(b(this.hasRoles(["LessonTeacherRole"])),y(1)),this.hasTeacherRole$=this.rolesAndPermissions$.pipe(b(this.hasRoles(["TeacherRole"])),y(1)),this.hasStudentRole$=this.rolesAndPermissions$.pipe(b(this.hasRoles(["StudentRole"])),y(1)),this.hasSubstituteAdministratorRole$=this.rolesAndPermissions$.pipe(b(this.hasRoles(["SubstituteAdministratorRole"])),y(1)),this.editAbsencesCount$=this.hasLessonTeacherRole$.pipe(T(t=>t?this.lessonPresencesService.checkableAbsencesCount():E(!1)),y(1)),this.openAbsencesCount$=this.rolesAndPermissions$.pipe(b(this.hasRoles(["LessonTeacherRole","ClassTeacherRole"])),T(t=>t?this.lessonPresencesService.getListOfUnconfirmed():E([])),b(t=>t.length),y(1)),this.myAbsencesCount$=this.hasStudentRole$.pipe(T(t=>t?this.getMyAbsences():E([])),b(this.getMyAbsencesCount.bind(this)),y(1)),this.coursesToRateCount$=this.courseService.getNumberOfCoursesForRating().pipe(le(0),y(1)),this.hasPresenceControl$=this.hasLessonTeacherRole$.pipe(T(t=>t?this.lessonPresencesService.hasLessonsLessonTeacher():E(!1)),y(1)),this.hasOpenAbsences$=this.openAbsencesCount$.pipe(b(t=>t>0),y(1)),this.editAbsencesParams$=this.getFullName().pipe(b(t=>({confirmationStates:this.settings.checkableAbsenceStateId,teacher:t})),y(1));let i=this.storageService.getPayload()?.id_person;i&&this.userId$.next(Number(i))}hasRoles(i){return t=>(t??[]).some(a=>i.includes(a))}getMyAbsences(){return H([this.userId$,this.lessonAbsences$,this.lessonIncidents$]).pipe(T(([i,t,a])=>this.loadTimetableEntries(i,t,a).pipe(b(_=>[...t,...a].map(C=>this.withTimetableEntry(C,_)).filter(Ae)))))}getMyAbsencesCount(i){return i?.filter(t=>("ConfirmationStateId"in t?t.ConfirmationStateId:null)===this.settings.unconfirmedAbsenceStateId).length||0}getFullName(){let i=Number(this.storageService.getPayload()?.substitution_id)||null;return i?this.teacherSubstitutionService.getTeacherSubstitution(i).pipe(b(t=>t?.Holder)):this.personService.getMyself().pipe(b(t=>t.FullName))}withTimetableEntry(i,t){return t.find(a=>a.Id===i.LessonRef.Id)?i:null}loadTimetableEntries(i,t,a){return this.studentsService.getTimetableEntries(i,{"filter.Id":`;${[...t,...a].map(_=>_.LessonRef.Id).join(";")}`})}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275prov=L({token:e,factory:e.\u0275fac})}}return e})();var ht=["*"];function bt(e,s){e&1&&ie(0)}function ut(e,s){if(e&1&&(d(0,"a",1),m(1,bt,1,0,"ng-container",3),c()),e&2){let i=u(),t=ne(3);f("routerLink",i.link)("queryParams",i.linkParams),n(),f("ngTemplateOutlet",t)}}function ft(e,s){e&1&&ie(0)}function _t(e,s){if(e&1&&(d(0,"a",2),m(1,ft,1,0,"ng-container",3),c()),e&2){let i=u(),t=ne(3);f("href",i.externalLink,j),n(),f("ngTemplateOutlet",t)}}function Ct(e,s){if(e&1&&(d(0,"span",5),p(1),c()),e&2){let i=u(2);n(),x(i.count)}}function gt(e,s){e&1&&(pe(),d(0,"svg",6),g(1,"path",7),c())}function yt(e,s){if(e&1&&(d(0,"span",4),p(1),o(2,"translate"),c(),d(3,"div"),Ce(4),m(5,Ct,2,1,"span",5)(6,gt,2,0,":svg:svg",6),c()),e&2){let i=u();n(),x(r(2,2,i.label)),n(4),h(i.hasCount(i.count)?5:6)}}var Ye=(()=>{class e{constructor(){}hasCount(i){return typeof i=="number"&&i>=0}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=v({type:e,selectors:[["bkd-dashboard-action"]],inputs:{label:"label",count:"count",link:"link",linkParams:"linkParams",externalLink:"externalLink"},ngContentSelectors:ht,decls:4,vars:2,consts:[["actionContent",""],[3,"routerLink","queryParams"],[3,"href"],[4,"ngTemplateOutlet"],[1,"label"],[1,"count"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none"],["fill","currentColor","d","m12 20-1.425-1.4 5.6-5.6H4v-2h12.175l-5.6-5.6L12 4l8 8-8 8Z"]],template:function(t,a){t&1&&(_e(),m(0,ut,2,3,"a",1)(1,_t,2,2,"a",2)(2,yt,7,4,"ng-template",null,0,ve)),t&2&&(h(a.externalLink?-1:0),n(),h(a.externalLink?1:-1))},dependencies:[W,Se,D],styles:["a[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:space-between;align-items:center;padding:1rem 1.5rem;background:#f7e9d2;text-decoration:none;line-height:1}a[_ngcontent-%COMP%]:hover{background:#f2e0c3}a[_ngcontent-%COMP%]:focus-visible{outline-width:2px;outline-offset:-2px}div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:1rem}.label[_ngcontent-%COMP%]{font-weight:400}.count[_ngcontent-%COMP%]{font-size:1.5rem}"]})}}return e})();var Ze=(()=>{class e{constructor(){}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=v({type:e,selectors:[["bkd-dashboard-deadline"]],inputs:{count:"count"},decls:3,vars:8,template:function(t,a){t&1&&(p(0),o(1,"translate"),o(2,"addSpace")),t&2&&ge("",r(1,3,"dashboard.actions.deadline"),"",M(2,5,": ",":"),"",a.count,`
`)},dependencies:[D,ze],styles:["[_nghost-%COMP%]{background:#ea161f;color:#fff;white-space:nowrap;font-weight:500;font-size:.875rem;min-height:1.5rem;display:flex;padding:.375rem .5rem;align-items:center;border-radius:2.5rem}"]})}}return e})();var vt=()=>["/presence-control"],St=()=>["/edit-absences"],xt=()=>["/open-absences"],Tt=()=>["/events"],Pt=()=>["/my-absences","report"],Dt=()=>["/my-absences"];function $t(e,s){e&1&&g(0,"bkd-dashboard-action",0),e&2&&f("label","dashboard.actions.presence-control")("link",I(2,vt))}function kt(e,s){if(e&1&&(g(0,"bkd-dashboard-action",1),o(1,"async"),o(2,"async")),e&2){let i=u();f("label","dashboard.actions.edit-absences")("link",I(8,St))("linkParams",r(1,4,i.dashboardService.editAbsencesParams$))("count",r(2,6,i.dashboardService.editAbsencesCount$))}}function Mt(e,s){if(e&1&&(g(0,"bkd-dashboard-action",2),o(1,"async")),e&2){let i=u();f("label","dashboard.actions.open-absences")("link",I(5,xt))("count",r(1,3,i.dashboardService.openAbsencesCount$))}}function Et(e,s){if(e&1&&(g(0,"bkd-dashboard-deadline",4),o(1,"async")),e&2){let i=u(2);f("count",r(1,1,i.dashboardService.coursesToRateCount$))}}function Rt(e,s){if(e&1&&(d(0,"bkd-dashboard-action",0),m(1,Et,2,3,"bkd-dashboard-deadline",4),o(2,"async"),c()),e&2){let i,t=u();f("label","dashboard.actions.tests")("link",I(5,Tt)),n(),h((i=r(2,3,t.dashboardService.coursesToRateCount$))!==null&&i!==void 0&&i?1:-1)}}function At(e,s){e&1&&g(0,"bkd-dashboard-action",0),e&2&&f("label","dashboard.actions.my-absences-report")("link",I(2,Pt))}function Ot(e,s){if(e&1&&(g(0,"bkd-dashboard-action",2),o(1,"async")),e&2){let i=u();f("label","dashboard.actions.my-absences")("link",I(5,Dt))("count",r(1,3,i.dashboardService.myAbsencesCount$))}}function It(e,s){if(e&1&&g(0,"bkd-dashboard-action",3),e&2){let i=u();f("label","dashboard.actions.substitutions")("externalLink",i.substitutionsAdminLink)}}var Je=(()=>{class e{constructor(){this.dashboardService=l($),this.settings=l(A)}get substitutionsAdminLink(){return this.settings.dashboard.substitutionsAdminLink}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=v({type:e,selectors:[["bkd-dashboard-actions"]],decls:15,vars:23,consts:[[3,"label","link"],[3,"label","link","linkParams","count"],[3,"label","link","count"],[3,"label","externalLink"],[3,"count"]],template:function(t,a){t&1&&(m(0,$t,1,3,"bkd-dashboard-action",0),o(1,"async"),m(2,kt,3,9,"bkd-dashboard-action",1),o(3,"async"),o(4,"async"),m(5,Mt,2,6,"bkd-dashboard-action",2),o(6,"async"),m(7,Rt,3,6,"bkd-dashboard-action",0),o(8,"async"),m(9,At,1,3,"bkd-dashboard-action",0),o(10,"async"),m(11,Ot,2,6,"bkd-dashboard-action",2),o(12,"async"),m(13,It,1,2,"bkd-dashboard-action",3),o(14,"async")),t&2&&(h(r(1,7,a.dashboardService.hasPresenceControl$)?0:-1),n(2),h(r(3,9,a.dashboardService.hasLessonTeacherRole$)&&r(4,11,a.dashboardService.editAbsencesParams$)?2:-1),n(3),h(r(6,13,a.dashboardService.hasOpenAbsences$)?5:-1),n(2),h(r(8,15,a.dashboardService.hasTeacherRole$)?7:-1),n(2),h(r(10,17,a.dashboardService.hasStudentRole$)?9:-1),n(2),h(r(12,19,a.dashboardService.hasStudentRole$)?11:-1),n(2),h(r(14,21,a.dashboardService.hasSubstituteAdministratorRole$)?13:-1))},dependencies:[Ye,Ze,R],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:.5rem}"]})}}return e})();var Qe=(()=>{class e{constructor(){this.studentsRestService=l(B),this.router=l(Pe)}navigateToDossier(i){return se(this,null,function*(){let t=Number(i);yield this.router.navigate(["dashboard","student",t,"contact"])})}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=v({type:e,selectors:[["bkd-dashboard-search"]],decls:1,vars:2,consts:[[3,"valueChange","typeaheadService","placeholder"]],template:function(t,a){t&1&&(d(0,"bkd-typeahead",0),w("valueChange",function(C){return C&&a.navigateToDossier(C)}),c()),t&2&&f("typeaheadService",a.studentsRestService)("placeholder","dashboard.search.placeholder")},dependencies:[Ge],styles:["[_nghost-%COMP%]{display:block;padding:.75rem;background:#f7e9d2}"]})}}return e})();var Lt=Y({}),Xe=(()=>{class e extends Z{constructor(){let i=l(K),t=l(A);super(i,t,Lt,"Teachers")}getTimetableEntries(i,t={}){let a=t instanceof ae?t:new ae({fromObject:t});return a=a.set("fields","Id,From,To,EventId,EventNumber,EventDesignation,EventLocation"),this.http.get(`${this.baseUrl}/${i}/TimetableEntries/CurrentSemester`,{params:a}).pipe(T(Re(Ne)))}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275prov=L({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var et=(()=>{class e{constructor(){this.sanitizer=l(xe)}transform(i,t){switch(t){case"html":return this.sanitizer.bypassSecurityTrustHtml(i);case"style":return this.sanitizer.bypassSecurityTrustStyle(i);case"script":return this.sanitizer.bypassSecurityTrustScript(i);case"url":return this.sanitizer.bypassSecurityTrustUrl(i);case"resourceUrl":return this.sanitizer.bypassSecurityTrustResourceUrl(i);default:throw new Error(`Invalid safe type specified: ${t}`)}}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275pipe=me({name:"safe",type:e,pure:!0})}}return e})();function tt(e){return{id:ot(e.EventId,e.Id),from:e.From,until:e.To,eventId:e.EventId,subject:e.EventDesignation,room:e.EventLocation||void 0,teacher:e.EventManagerInformation||void 0}}function it(e){let s=e.reduce((i,t)=>{let a=ot(t.EventRef.Id,t.LessonRef.Id);return U(z({},i),{[a]:[...i[a]??[],t.StudyClassNumber]})},{});return Object.keys(s).reduce((i,t)=>U(z({},i),{[t]:ke([...s[t]].sort())}),{})}function nt(e,s){return e.map(i=>U(z({},i),{studyClass:s[i.id]?.join(", ")}))}function ot(e,s){return`${e}-${s}`}var wt=(e,s)=>s.id;function Bt(e,s){e&1&&(d(0,"th"),p(1),o(2,"translate"),c()),e&2&&(n(),S(" ",r(2,1,"dashboard.timetable.table.teacher")," "))}function jt(e,s){if(e&1&&(k(0),d(1,"a",3),p(2),d(3,"span",8),p(4),c()()),e&2){let i=u().$implicit,t=u(2).buildLink(i.eventId);n(),f("routerLink",t.link)("queryParams",t.params),n(),S(" ",i.subject,""),n(2),S(", ",i.studyClass,"")}}function Ft(e,s){if(e&1&&p(0),e&2){let i=u().$implicit;S(" ",i.subject," ")}}function Nt(e,s){if(e&1&&(d(0,"td",4),p(1),o(2,"translate"),c()),e&2){let i=u().$implicit;n(),oe(" ",r(2,2,"dashboard.timetable.table.study-class"),": ",i.studyClass," ")}}function zt(e,s){if(e&1&&(d(0,"td",5),p(1),c()),e&2){let i=u().$implicit;n(),S(" ",i.teacher," ")}}function Ut(e,s){e&1&&(d(0,"span",7),p(1),o(2,"translate"),c()),e&2&&(n(),x(r(2,1,"dashboard.timetable.table.room")))}function Ht(e,s){if(e&1&&(d(0,"tr")(1,"td",1),p(2),o(3,"date"),o(4,"date"),c(),d(5,"td",2),m(6,jt,5,4,"a",3),o(7,"async"),m(8,Ft,1,1),c(),m(9,Nt,3,4,"td",4),o(10,"async"),m(11,zt,2,1,"td",5),o(12,"async"),d(13,"td",6),m(14,Ut,3,3,"span",7),p(15),c()()),e&2){let i=s.$implicit,t=u(2);n(2),oe(" ",M(3,7,i.from,"HH:mm"),"\u2013",M(4,10,i.until,"HH:mm")," "),n(4),h(r(7,13,t.isTeacher$)?6:8),n(3),h(r(10,15,t.isTeacher$)?9:-1),n(2),h(r(12,17,t.isStudent$)?11:-1),n(3),h(i.room?14:-1),n(),S(" ",i.room," ")}}function Vt(e,s){if(e&1&&(d(0,"table",0)(1,"thead")(2,"tr")(3,"th"),p(4),o(5,"translate"),c(),d(6,"th"),p(7),o(8,"translate"),c(),m(9,Bt,3,3,"th"),o(10,"async"),d(11,"th"),p(12),o(13,"translate"),c()()(),d(14,"tbody"),be(15,Ht,16,19,"tr",null,wt),c()()),e&2){let i=u();n(4),x(r(5,4,"dashboard.timetable.table.time")),n(3),x(r(8,6,"dashboard.timetable.table.subject")),n(2),h(r(10,8,i.isStudent$)?9:-1),n(3),S(" ",r(13,10,"dashboard.timetable.table.room")," "),n(3),ue(i.entries)}}function qt(e,s){e&1&&(d(0,"p"),p(1),o(2,"translate"),c()),e&2&&(n(),x(r(2,1,"dashboard.timetable.no-entries")))}var at=(()=>{class e{constructor(){this.dashboardService=l($),this.entries=[],this.isStudent$=this.dashboardService.hasStudentRole$,this.isTeacher$=this.dashboardService.hasLessonTeacherRole$}buildLink(i){return Be(Ve(i,"/dashboard"))}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=v({type:e,selectors:[["bkd-dashboard-timetable-table"]],inputs:{entries:"entries"},decls:2,vars:1,consts:[[1,"table"],[1,"time"],[1,"subject"],[3,"routerLink","queryParams"],[1,"study-class"],[1,"teacher"],[1,"room"],[1,"room-label"],[1,"subject-study-class"]],template:function(t,a){t&1&&m(0,Vt,17,12,"table",0)(1,qt,3,3,"p"),t&2&&h(a.entries.length>0?0:1)},dependencies:[R,G,D,W],styles:['td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{padding:1rem 1.75rem}.room-label[_ngcontent-%COMP%], td.study-class[_ngcontent-%COMP%]{display:none}@media (max-width: 767.98px){table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{display:none}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]{border-top:1px solid var(--bs-border-color)}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-template-areas:"time room" "subject subject" "study-class study-class" "teacher teacher";gap:.5rem;padding:1rem;border-bottom:1px solid var(--bs-border-color)}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:0;padding:0}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.time[_ngcontent-%COMP%]{grid-area:time;font-size:.875rem;line-height:1.125rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.subject[_ngcontent-%COMP%]{grid-area:subject;font-size:1rem;line-height:1.25rem;font-weight:400}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.teacher[_ngcontent-%COMP%]{grid-area:teacher;font-size:.8125rem;line-height:1.0625rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.room[_ngcontent-%COMP%]{grid-area:room;text-align:right;font-size:.875rem;line-height:1.125rem;font-weight:300}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.study-class[_ngcontent-%COMP%]{grid-area:study-class;font-size:.8125rem;line-height:1.0625rem;font-weight:300}td.study-class[_ngcontent-%COMP%]{display:block}.subject-study-class[_ngcontent-%COMP%]{display:none}.room-label[_ngcontent-%COMP%]{display:inline}}']})}}return e})();function Gt(e,s){e&1&&(d(0,"a",6),o(1,"safe"),p(2),o(3,"translate"),c()),e&2&&(f("href",M(1,2,s,"url"),j),n(2),S(" ",r(3,5,"dashboard.timetable.subscribe-calendar")," "))}function Kt(e,s){e&1&&g(0,"bkd-spinner")}function Wt(e,s){e&1&&(d(0,"a",8),o(1,"safe"),p(2),o(3,"translate"),c()),e&2&&(f("href",M(1,2,s,"url"),j),n(2),S(" ",r(3,5,"dashboard.timetable.subscribe-calendar")," "))}function Yt(e,s){if(e&1&&(g(0,"bkd-dashboard-timetable-table",7),m(1,Wt,4,7,"a",8),o(2,"async")),e&2){let i,t=u(),a=N(18);f("entries",a),n(),h((i=r(2,2,t.getSubscribeCalendarUrl()))?1:-1,i)}}var Zt="cal",rt=(()=>{class e{constructor(){this.teachersService=l(Xe),this.studentsService=l(B),this.lessonPresencesService=l(J),this.userSettings=l(X),this.dashboardService=l($),this.loadingService=l(je),this.userId$=this.dashboardService.userId$,this.isTeacher$=this.dashboardService.hasLessonTeacherRole$,this.isStudent$=this.dashboardService.hasStudentRole$,this.date$=new ce(re(new Date)),this.loading$=this.loadingService.loading$,this.timetableEntries$=this.loadTimetableEntries()}gotoToday(){this.date$.next(re(new Date))}gotoPreviousDay(){this.date$.next(Le(this.date$.getValue(),1))}gotoNextDay(){this.date$.next(Oe(this.date$.getValue(),1))}getSubscribeCalendarUrl(){return this.userSettings.getSetting(Zt)}loadTimetableEntries(){return H([this.isTeacher$,this.isStudent$,this.userId$,this.date$]).pipe(T(([i,t,a,_])=>{let C=()=>i?this.fetchTimetableEntries("teacher",a,_):t?this.fetchTimetableEntries("student",a,_):E([]);return this.loadingService.load(C())}),y(1))}fetchTimetableEntries(i,t,a){let _={"filter.From":`=${Ie(a,"yyyy-MM-dd")}`,sort:"From,To"};return(i==="teacher"?this.teachersService.getTimetableEntries(t,_):this.studentsService.getTimetableEntries(t,_)).pipe(b(C=>C.map(tt)),b(C=>Me(C,O=>O.id)),T(C=>i==="teacher"?this.loadStudyClasses(a).pipe(b(O=>nt(C,O))):E(C)))}loadStudyClasses(i){return this.lessonPresencesService.getLessonStudyClassesByDate(i).pipe(b(it))}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=v({type:e,selectors:[["bkd-dashboard-timetable"]],decls:23,vars:24,consts:[[1,"header"],["type","button",1,"btn","btn-primary","today",3,"click"],["type","button",1,"btn","btn-secondary","previous-day",3,"click"],[1,"material-icons"],["type","button",1,"btn","btn-secondary","next-day",3,"click"],[1,"date"],["target","_parent",1,"btn","btn-secondary","subscribe-calendar-header",3,"href"],[3,"entries"],["target","_parent",1,"btn","btn-secondary","subscribe-calendar-bottom",3,"href"]],template:function(t,a){if(t&1){let _=fe();d(0,"div",0)(1,"button",1),w("click",function(){return V(_),q(a.gotoToday())}),p(2),o(3,"translate"),c(),d(4,"button",2),o(5,"translate"),w("click",function(){return V(_),q(a.gotoPreviousDay())}),d(6,"span",3),p(7,"chevron_left"),c()(),d(8,"button",4),o(9,"translate"),w("click",function(){return V(_),q(a.gotoNextDay())}),d(10,"span",3),p(11,"chevron_right"),c()(),d(12,"div",5),p(13),o(14,"async"),o(15,"date"),c(),m(16,Gt,4,7,"a",6),o(17,"async"),c(),k(18),o(19,"async"),m(20,Kt,1,0,"bkd-spinner"),o(21,"async"),m(22,Yt,3,4)}if(t&2){let _;n(2),S(" ",r(3,6,"dashboard.timetable.today")," "),n(2),te("aria-label",r(5,8,"dashboard.timetable.previousDay")),n(4),te("aria-label",r(9,10,"dashboard.timetable.nextDay")),n(5),x(M(15,14,r(14,12,a.date$),"E, dd. MMMM yyyy")),n(3),h((_=r(17,17,a.getSubscribeCalendarUrl()))?16:-1,_),n(2),F(r(19,19,a.timetableEntries$)),n(2),h(r(21,22,a.loading$)?20:22)}},dependencies:[at,Q,R,G,D,et],styles:["[_nghost-%COMP%]{display:block;margin-bottom:1rem}.header[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:2rem;display:flex;align-items:center;gap:1rem}.previous-day[_ngcontent-%COMP%], .next-day[_ngcontent-%COMP%]{padding-left:.375rem;padding-right:.375rem}.date[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600}.subscribe-calendar-header[_ngcontent-%COMP%]{margin-left:auto}.subscribe-calendar-bottom[_ngcontent-%COMP%]{display:none}a.btn[_ngcontent-%COMP%]{text-decoration:none}@media (max-width: 767.98px){.subscribe-calendar-header[_ngcontent-%COMP%]{display:none}.subscribe-calendar-bottom[_ngcontent-%COMP%]{display:block;margin-top:2rem}}@media (max-width: 767.98px) and (max-width: 575.98px){.header[_ngcontent-%COMP%]{flex-wrap:wrap-reverse}.header[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{width:100%}}"]})}}return e})();function Jt(e,s){e&1&&g(0,"bkd-spinner")}function Qt(e,s){e&1&&(d(0,"p"),p(1),o(2,"translate"),c()),e&2&&(n(),S(" ",r(2,1,"dashboard.no-access")," "))}function Xt(e,s){e&1&&(d(0,"div")(1,"h2"),p(2),o(3,"translate"),c(),g(4,"bkd-dashboard-search"),c()),e&2&&(n(2),x(r(3,1,"dashboard.search.title")))}function ei(e,s){e&1&&(d(0,"div")(1,"h2"),p(2),o(3,"translate"),c(),g(4,"bkd-dashboard-actions"),c()),e&2&&(n(2),x(r(3,1,"dashboard.actions.title")))}function ti(e,s){if(e&1&&(d(0,"div",1),m(1,Xt,5,3,"div")(2,ei,5,3,"div"),c()),e&2){u();let i=N(2),t=N(4);n(),h(i?1:-1),n(),h(t?2:-1)}}function ii(e,s){e&1&&(d(0,"div",2)(1,"h2"),p(2),o(3,"translate"),c(),g(4,"bkd-dashboard-timetable"),c()),e&2&&(n(2),x(r(3,1,"dashboard.timetable.title")))}var st=(()=>{class e{constructor(){this.dashboardService=l($)}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=v({type:e,selectors:[["bkd-dashboard-layout"]],decls:17,vars:19,consts:[[1,"columns"],[1,"search-actions-column"],[1,"timetable-column"]],template:function(t,a){if(t&1&&(k(0),o(1,"async"),k(2),o(3,"async"),k(4),o(5,"async"),k(6),o(7,"async"),d(8,"div")(9,"h1"),p(10),o(11,"translate"),c(),m(12,Jt,1,0,"bkd-spinner")(13,Qt,3,3,"p"),d(14,"div",0),m(15,ti,3,2,"div",1)(16,ii,5,3,"div",2),c()()),t&2){let _=r(1,7,a.dashboardService.loading$);n(2);let C=F(r(3,9,a.dashboardService.hasSearch$));n(2);let O=F(r(5,12,a.dashboardService.hasActions$)),ee=r(7,15,a.dashboardService.hasTimetable$);n(5),he("visually-hidden",_||C||O||ee),n(),S(" ",r(11,17,"dashboard.heading")," "),n(2),h(_?12:-1),n(),h(!_&&!C&&!O&&!ee?13:-1),n(2),h(C||O?15:-1),n(),h(ee?16:-1)}},dependencies:[Q,Qe,Je,rt,R,D],styles:[".columns[_ngcontent-%COMP%]{display:flex;flex-direction:column}.columns[_ngcontent-%COMP%], .search-actions-column[_ngcontent-%COMP%]{gap:3rem}.search-actions-column[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;max-width:40rem}.timetable-column[_ngcontent-%COMP%]{flex:2}@media (min-width: 992px){.columns[_ngcontent-%COMP%]{flex-direction:row;gap:1.5rem}.search-actions-column[_ngcontent-%COMP%]{max-width:33%}}"],changeDetection:0})}}return e})();var ct=(()=>{class e{constructor(){}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=v({type:e,selectors:[["bkd-dashboard"]],features:[ye([$,we])],decls:1,vars:0,template:function(t,a){t&1&&g(0,"router-outlet")},dependencies:[Te],encapsulation:2,changeDetection:0})}}return e})();var no=[{path:"",component:ct,children:[{path:"",component:st},He,qe("students/:id")]}];export{no as DASHBOARD_ROUTES};
