"use strict";(self.webpackChunkwebapp_schulverwaltung=self.webpackChunkwebapp_schulverwaltung||[]).push([[416],{3817:(F,f,o)=>{o.r(f),o.d(f,{EvaluateAbsencesModule:()=>_t});var g=o(6971),d=o(5357),A=o(2722),p=o(5186),h=o(6649),E=o(8029),t=o(5e3),m=o(9808),P=o(2024),C=o(7129);let v=(()=>{class e extends h.f{constructor(n,s,i,u){super(n,s,i,"/evaluate-absences"),this.lessonPresenceService=u,this.queryParamsString$.pipe((0,A.R)(this.destroy$)).subscribe(x=>this.confirmBackLinkParams={returnparams:x})}getInitialFilter(){return{student:null,educationalEvent:null,studyClass:null}}isValidFilter(n){return Boolean(n.student||n.educationalEvent||n.studyClass)}getInitialSorting(){return{key:"StudentFullName",ascending:!0}}loadEntries(n,s,i){return this.loadingService.load(this.lessonPresenceService.getStatistics(n,s,i),h.O)}buildParamsFromFilter(n){return(0,p.i)(n)}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(m.Ye),t.LFG(P.b),t.LFG(E.L),t.LFG(C.q))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})();var T=o(3509),b=o(8109);let Z=(()=>{class e{constructor(n){this.state=n}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(v))},e.\u0275cmp=t.Xpm({type:e,selectors:[["erz-evaluate-absences"]],features:[t._Bn([v,{provide:T.m,useExisting:v},{provide:b.b,useValue:"/evaluate-absences"}])],decls:1,vars:0,template:function(n,s){1&n&&t._UZ(0,"router-outlet")},directives:[d.lC],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),e})();var y=o(4004),L=o(5698),S=o(3900),O=o(4782),c=o(3657),M=o(6501),r=o(6401),l=o(1104),_=o(5861),R=o(77),$=o(8699),U=o(6628),I=o(8995);let D=(()=>{class e{constructor(n,s,i){this.studentsService=n,this.educationalEventsService=s,this.studyClassesService=i,this.filter={student:null,educationalEvent:null,studyClass:null},this.filterChange=new t.vpe,this.classesHttpFilter={params:{fields:"IsActive","filter.IsActive":"=true"}}}show(){this.filterChange.emit(this.filter)}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(_.l),t.Y36(R.$),t.Y36($.R))},e.\u0275cmp=t.Xpm({type:e,selectors:[["erz-evaluate-absences-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},decls:20,vars:19,consts:[[1,"filters","mb-2"],[1,"form-group"],[3,"typeaheadService","value","valueChange"],[3,"typeaheadService","value","additionalHttpParams","valueChange"],[1,"buttons"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(n,s){1&n&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"label"),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"erz-typeahead",2),t.NdJ("valueChange",function(u){return s.filter.student=u}),t.qZA(),t.qZA(),t.TgZ(6,"div",1),t.TgZ(7,"label"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"erz-typeahead",2),t.NdJ("valueChange",function(u){return s.filter.educationalEvent=u}),t.qZA(),t.qZA(),t.TgZ(11,"div",1),t.TgZ(12,"label"),t._uU(13),t.ALo(14,"translate"),t.qZA(),t.TgZ(15,"erz-typeahead",3),t.NdJ("valueChange",function(u){return s.filter.studyClass=u}),t.qZA(),t.qZA(),t.TgZ(16,"div",4),t.TgZ(17,"button",5),t.NdJ("click",function(){return s.show()}),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.qZA(),t.qZA()),2&n&&(t.xp6(3),t.Oqu(t.lcZ(4,11,"evaluate-absences.header.student")),t.xp6(2),t.Q6J("typeaheadService",s.studentsService)("value",s.filter.student),t.xp6(3),t.Oqu(t.lcZ(9,13,"evaluate-absences.header.module-instance")),t.xp6(2),t.Q6J("typeaheadService",s.educationalEventsService)("value",s.filter.educationalEvent),t.xp6(3),t.Oqu(t.lcZ(14,15,"evaluate-absences.header.study-class")),t.xp6(2),t.Q6J("typeaheadService",s.studyClassesService)("value",s.filter.studyClass)("additionalHttpParams",s.classesHttpFilter),t.xp6(3),t.hij(" ",t.lcZ(19,17,"evaluate-absences.header.show")," "))},directives:[U.t],pipes:[I.X$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1.5rem;border-bottom:1px solid #dee2e6}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.form-group[_ngcontent-%COMP%]{flex:1;min-width:20rem;max-width:40rem;margin-right:1.5rem;margin-bottom:.75rem}.buttons[_ngcontent-%COMP%]{flex:none;margin-top:2.75rem;margin-right:0}@media (max-width: 767.98px){.buttons[_ngcontent-%COMP%]{width:100%;margin-top:1.5rem;margin-bottom:1.5rem}}"],changeDetection:0}),e})();var N=o(8689),J=o(2925);function Y(e,a){if(1&e&&(t.TgZ(0,"a",15),t.ALo(1,"async"),t.TgZ(2,"i",16),t._uU(3,"description"),t.qZA(),t.qZA()),2&e){const n=t.oxw(5);t.Q6J("href",t.lcZ(1,1,n.reportUrl$),t.LSH)}}function B(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"th",17),t.NdJ("click",function(){const u=t.CHM(n).$implicit;return t.oxw(5).state.toggleSorting(u.key)}),t.TgZ(1,"div",18),t.TgZ(2,"div",19),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"div",20),t._uU(6),t.ALo(7,"async"),t.qZA(),t.qZA(),t.qZA()}if(2&e){const n=a.$implicit,s=t.oxw(5);t.Q6J("ngClass",n.label),t.xp6(3),t.hij(" ",t.lcZ(4,3,"evaluate-absences.list.header."+n.label)," "),t.xp6(3),t.hij(" ",t.lcZ(7,5,s.getSortingChar$(n))," ")}}const z=function(e){return["student",e]},j=function(e){return{returnparams:e}};function Q(e,a){if(1&e&&(t.TgZ(0,"a",24),t.ALo(1,"async"),t._uU(2),t.qZA()),2&e){const n=t.oxw().$implicit,s=t.oxw().$implicit,i=t.oxw(6);t.Q6J("routerLink",t.VKq(5,z,s.StudentRef.Id))("queryParams",t.VKq(7,j,t.lcZ(1,3,i.profileReturnParams$))),t.xp6(2),t.hij(" ",s[n.key]," ")}}function W(e,a){if(1&e&&t._uU(0),2&e){const n=t.oxw().$implicit,s=t.oxw().$implicit;t.hij(" ",s[n.key]," ")}}function H(e,a){if(1&e&&(t.TgZ(0,"td"),t.ALo(1,"translate"),t.YNc(2,Q,3,9,"a",22),t.YNc(3,W,1,1,"ng-template",null,23,t.W1O),t.qZA()),2&e){const n=a.$implicit,s=t.MAs(4);t.uIk("data-label",t.lcZ(1,3,"evaluate-absences.list.header."+n.label)),t.xp6(2),t.Q6J("ngIf","StudentFullName"===n.key)("ngIfElse",s)}}function K(e,a){if(1&e&&(t.TgZ(0,"tr"),t.YNc(1,H,5,5,"td",21),t.qZA()),2&e){const n=t.oxw(6);t.xp6(1),t.Q6J("ngForOf",n.columns)}}function w(e,a){if(1&e&&(t.TgZ(0,"tbody"),t.YNc(1,K,2,1,"tr",21),t.qZA()),2&e){const n=t.oxw(4).erzLet;t.xp6(1),t.Q6J("ngForOf",n.entries)}}function k(e,a){1&e&&t._UZ(0,"erz-spinner",25)}function q(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){return t.CHM(n),t.oxw(5).state.nextPage()}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&e&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"global.pagination.load-more")," "))}function X(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"div",7),t.TgZ(1,"div",8),t.YNc(2,Y,4,3,"a",9),t.ALo(3,"async"),t.qZA(),t.TgZ(4,"table",10),t.NdJ("scrolled",function(){return t.CHM(n),t.oxw(4).onScroll()}),t.TgZ(5,"thead"),t.TgZ(6,"tr"),t.YNc(7,B,8,7,"th",11),t.qZA(),t.qZA(),t.YNc(8,w,2,1,"tbody",12),t.qZA(),t.YNc(9,k,1,0,"erz-spinner",13),t.YNc(10,q,3,3,"button",14),t.qZA()}if(2&e){const n=t.oxw(3).erzLet,s=t.oxw();t.xp6(2),t.Q6J("ngIf",t.lcZ(3,5,s.reportUrl$)),t.xp6(5),t.Q6J("ngForOf",s.columns),t.xp6(1),t.Q6J("ngIf",n.entries&&n.entries.length>0),t.xp6(1),t.Q6J("ngIf",n.loadingPage),t.xp6(1),t.Q6J("ngIf",n.hasMore&&!n.loadingPage)}}function G(e,a){1&e&&(t.TgZ(0,"p",27),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&e&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"evaluate-absences.no-entries")," "))}function V(e,a){if(1&e&&(t.ynx(0),t.YNc(1,X,11,7,"div",5),t.YNc(2,G,3,3,"ng-template",null,6,t.W1O),t.BQk()),2&e){const n=t.MAs(3),s=t.oxw(2).erzLet;t.xp6(1),t.Q6J("ngIf",s.entries&&s.entries.length>0||s.loadingPage)("ngIfElse",n)}}function tt(e,a){1&e&&t._UZ(0,"erz-spinner")}function et(e,a){if(1&e&&(t.ynx(0),t.YNc(1,V,4,2,"ng-container",2),t.ALo(2,"async"),t.YNc(3,tt,1,0,"ng-template",null,4,t.W1O),t.BQk()),2&e){const n=t.MAs(4),s=t.oxw(2);t.xp6(1),t.Q6J("ngIf",!1===t.lcZ(2,2,s.state.loading$))("ngIfElse",n)}}function nt(e,a){1&e&&(t.TgZ(0,"p",27),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"evaluate-absences.no-filter")))}function st(e,a){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"erz-evaluate-absences-header",1),t.NdJ("filterChange",function(i){return t.CHM(n),t.oxw().state.setFilter(i)}),t.ALo(2,"async"),t.qZA(),t.YNc(3,et,5,4,"ng-container",2),t.ALo(4,"async"),t.YNc(5,nt,3,3,"ng-template",null,3,t.W1O),t.BQk()}if(2&e){const n=t.MAs(6),s=t.oxw();t.xp6(1),t.Q6J("filter",t.lcZ(2,3,s.filterFromParams$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(4,5,s.state.isFilterValid$))("ngIfElse",n)}}const ot=function(e,a,n){return{entries:e,hasMore:a,loadingPage:n}};let at=(()=>{class e{constructor(n,s,i,u,x,dt){this.state=n,this.scrollPosition=s,this.route=i,this.presenceTypesService=u,this.reportsService=x,this.lessonPresencesService=dt,this.reportUrl$=this.loadReportUrl(),this.columns=[{key:"StudentFullName",label:"student"},{key:"TotalAbsences",label:"total"},{key:"TotalAbsencesValidExcuse",label:"valid-excuse"},{key:"TotalAbsencesWithoutExcuse",label:"without-excuse"},{key:"TotalAbsencesUnconfirmed",label:"unconfirmed"},{key:"TotalIncidents",label:"incident"}],this.filterFromParams$=this.route.queryParams.pipe((0,y.U)(rt)),this.profileReturnParams$=this.state.queryParamsString$}ngOnInit(){this.filterFromParams$.pipe((0,L.q)(1)).subscribe(n=>this.state.setFilter(n)),this.presenceTypesService.halfDayActive$.subscribe(n=>{n&&(this.columns=[...this.columns,{key:"TotalHalfDays",label:"halfday"}])})}ngAfterViewInit(){this.scrollPosition.restore()}onScroll(){this.state.nextPage()}getSortingChar$(n){return this.state.sorting$.pipe((0,y.U)(s=>s&&n.key===s.key?s.ascending?"\u2193":"\u2191":""))}loadReportUrl(){return this.state.validFilter$.pipe((0,S.w)(n=>this.lessonPresencesService.getLessonRefs(n)),(0,y.U)(n=>n.length>0?this.reportsService.getEvaluateAbsencesUrl(this.getReportRecordIds(n)):null),(0,O.d)(1))}getReportRecordIds(n){return n.map(s=>`${s.LessonRef.Id}_${s.RegistrationRef.Id}`)}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(v),t.Y36(c.X),t.Y36(d.gz),t.Y36(M.c),t.Y36(r.F),t.Y36(C.q))},e.\u0275cmp=t.Xpm({type:e,selectors:[["erz-evaluate-absences-list"]],decls:4,vars:11,consts:[[4,"erzLet"],[3,"filter","filterChange"],[4,"ngIf","ngIfElse"],["noFilter",""],["loading",""],["class","p-3",4,"ngIf","ngIfElse"],["noEntries",""],[1,"p-3"],[1,"buttons"],["class","report btn btn-primary mb-2","target","_blank",3,"href",4,"ngIf"],["infiniteScroll","",1,"table","table-striped","table-fixed",3,"scrolled"],["scope","col",3,"ngClass","click",4,"ngFor","ngForOf"],[4,"ngIf"],["class","inline",4,"ngIf"],["type","button","class","btn btn-secondary btn-sm d-block mx-auto",3,"click",4,"ngIf"],["target","_blank",1,"report","btn","btn-primary","mb-2",3,"href"],[1,"material-icons"],["scope","col",3,"ngClass","click"],[1,"d-flex"],[1,"column-title"],[1,"sort-direction"],[4,"ngFor","ngForOf"],["class","student",3,"routerLink","queryParams",4,"ngIf","ngIfElse"],["noLink",""],[1,"student",3,"routerLink","queryParams"],[1,"inline"],["type","button",1,"btn","btn-secondary","btn-sm","d-block","mx-auto",3,"click"],[1,"mt-3","px-3"]],template:function(n,s){1&n&&(t.YNc(0,st,7,7,"ng-container",0),t.ALo(1,"async"),t.ALo(2,"async"),t.ALo(3,"async")),2&n&&t.Q6J("erzLet",t.kEZ(7,ot,t.lcZ(1,1,s.state.entries$),t.lcZ(2,3,s.state.hasMore$),t.lcZ(3,5,s.state.loadingPage$)))},directives:[l.e,D,m.O5,N.R,m.sg,m.mk,d.yS,J.O],pipes:[m.Ov,I.X$],styles:["th[_ngcontent-%COMP%]{cursor:pointer}th.student[_ngcontent-%COMP%]{width:30%}.column-title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}a.student[_ngcontent-%COMP%]{color:#33333d}.buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.buttons[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{line-height:1;font-size:2.2rem}"],changeDetection:0}),e})();function rt(e){return{student:e.student?Number(e.student):null,educationalEvent:e.educationalEvent?Number(e.educationalEvent):null,studyClass:e.studyClass?Number(e.studyClass):null}}var it=o(8574),lt=o(5275);const ct=[{path:"",component:Z,children:[{path:"",component:at,data:{restoreScrollPositionFrom:["/evaluate-absences/student/:id"]}},{path:"student/:id",children:[{path:"",component:it.$},{path:"confirm",component:lt.A}]}]}];let ut=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[d.Bz.forChild(ct)],d.Bz]}),e})(),_t=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[g.m,ut]]}),e})()},3657:(F,f,o)=>{o.d(f,{X:()=>y});var g=o(5357),d=o(7579),A=o(9646),p=o(9300),h=o(4004),E=o(5698),t=o(5577),m=o(3900),P=o(3843),C=o(4782),v=o(2722),T=o(5684),b=o(5e3),Z=o(9808);let y=(()=>{class c{constructor(r,l){this.router=r,this.viewportScroller=l,this.scrollPositions={},this.previousRoute=null,this.currentRoute=null,this.currentScrollPosition=[0,0],this.destroy$=new d.x,this.scrollPosition$=this.router.events.pipe((0,p.h)(S),(0,h.U)(this.getScrollPosition.bind(this))),this.activationEnd$=this.router.events.pipe((0,p.h)(L)),this.navigationEnd$=this.router.events.pipe((0,p.h)(O)),this.route$=this.activationEnd$.pipe((0,E.q)(1)).pipe((0,t.z)(_=>[(0,A.of)(_),this.navigationEnd$.pipe((0,m.w)(()=>this.activationEnd$.pipe((0,E.q)(1))))]),(0,P.B)(),(0,h.U)(_=>_.snapshot),(0,C.d)(1)),this.scrollPosition$.pipe((0,v.R)(this.destroy$)).subscribe(_=>this.currentScrollPosition=_),this.route$.pipe((0,v.R)(this.destroy$)).subscribe(_=>{this.previousRoute=this.currentRoute,this.currentRoute=_})}ngOnDestroy(){this.destroy$.next()}restore(){if(!this.currentRoute||!this.requiresStoring(this.currentRoute))return;if(this.previousRoute&&this.shouldStoreFor(this.currentRoute,this.previousRoute)){const l=this.getPath(this.currentRoute);this.scrollToPosition(this.scrollPositions[l]||[0,0])}const r=this.currentRoute;this.route$.pipe((0,T.T)(1),(0,E.q)(1),(0,v.R)(this.destroy$),(0,p.h)(l=>this.shouldStoreFor(r,l))).subscribe(()=>{const l=this.getPath(r);this.scrollPositions[l]=this.currentScrollPosition})}getScrollPosition(){return this.viewportScroller.getScrollPosition()}scrollToPosition(r){this.viewportScroller.scrollToPosition(r)}getPath(r){return r?"/"+r.pathFromRoot.map(l=>l.routeConfig&&l.routeConfig.path).filter(l=>l).join("/"):"/"}requiresStoring(r){return Boolean(r&&r.routeConfig&&r.routeConfig.data&&Array.isArray(r.routeConfig.data.restoreScrollPositionFrom)&&r.routeConfig.data.restoreScrollPositionFrom.length>0)}shouldStoreFor(r,l){return(r&&r.routeConfig&&r.routeConfig.data&&Array.isArray(r.routeConfig.data.restoreScrollPositionFrom)?r.routeConfig.data.restoreScrollPositionFrom:[]).includes(this.getPath(l))}}return c.\u0275fac=function(r){return new(r||c)(b.LFG(g.F0),b.LFG(Z.EM))},c.\u0275prov=b.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})();function L(c){return c instanceof g.jw}function S(c){return c instanceof g.OD}function O(c){return c instanceof g.m2}},1854:(F,f,o)=>{o.d(f,{Z:()=>A});var g=o(7088);const A=function d(p,h){return(0,g.Z)(p,h)}}}]);