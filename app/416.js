"use strict";(self.webpackChunkwebapp_schulverwaltung=self.webpackChunkwebapp_schulverwaltung||[]).push([[416],{3817:(y,u,a)=>{a.r(u),a.d(u,{EvaluateAbsencesModule:()=>ge});var p=a(9121),l=a(5357),v=a(2722),m=a(8029),_=a(6649),x=a(5186),e=a(5e3),c=a(9808),C=a(2024),h=a(7129),Z=a(4379);let d=(()=>{class t extends _.f{constructor(n,s,i,r,g){super(n,s,g,i,"/evaluate-absences"),this.lessonPresenceService=r,this.queryParamsString$.pipe((0,v.R)(this.destroy$)).subscribe(f=>this.confirmBackLinkParams={returnparams:f})}getInitialFilter(){return{student:null,educationalEvent:null,studyClass:null}}isValidFilter(n){return Boolean(n.student||n.educationalEvent||n.studyClass)}getInitialSorting(){return{key:"StudentFullName",ascending:!0}}loadEntries(n,s,i){return this.loadingService.load(this.lessonPresenceService.getStatistics(n,s,i),_.O)}buildParamsFromFilter(n){return(0,x.i)(n)}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(c.Ye),e.LFG(C.b),e.LFG(m.L),e.LFG(h.q),e.LFG(Z.K))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})();var E=a(3509),T=a(8109);let L=(()=>{class t{constructor(n){this.state=n}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(d))},t.\u0275cmp=e.Xpm({type:t,selectors:[["erz-evaluate-absences"]],features:[e._Bn([d,{provide:E.m,useExisting:d},{provide:T.b,useValue:"/evaluate-absences"}])],decls:1,vars:0,template:function(n,s){1&n&&e._UZ(0,"router-outlet")},directives:[l.lC],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),t})();var b=a(4004),P=a(5698),S=a(3900),F=a(4782),I=a(3657),M=a(6501),O=a(6401),$=a(1104),N=a(386),J=a(77),Y=a(7283),U=a(6628),A=a(8995);let z=(()=>{class t{constructor(n,s,i){this.studentsService=n,this.educationalEventsService=s,this.studyClassesService=i,this.filter={student:null,educationalEvent:null,studyClass:null},this.filterChange=new e.vpe,this.classesHttpFilter={params:{fields:"IsActive","filter.IsActive":"=true"}}}show(){this.filterChange.emit(this.filter)}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(N.l),e.Y36(J.$),e.Y36(Y.R))},t.\u0275cmp=e.Xpm({type:t,selectors:[["erz-evaluate-absences-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},decls:20,vars:19,consts:[[1,"filters","mb-2"],[1,"form-group"],[3,"typeaheadService","value","valueChange"],[3,"typeaheadService","value","additionalHttpParams","valueChange"],[1,"buttons"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(n,s){1&n&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"label"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"erz-typeahead",2),e.NdJ("valueChange",function(r){return s.filter.student=r}),e.qZA(),e.qZA(),e.TgZ(6,"div",1),e.TgZ(7,"label"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"erz-typeahead",2),e.NdJ("valueChange",function(r){return s.filter.educationalEvent=r}),e.qZA(),e.qZA(),e.TgZ(11,"div",1),e.TgZ(12,"label"),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"erz-typeahead",3),e.NdJ("valueChange",function(r){return s.filter.studyClass=r}),e.qZA(),e.qZA(),e.TgZ(16,"div",4),e.TgZ(17,"button",5),e.NdJ("click",function(){return s.show()}),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.qZA(),e.qZA()),2&n&&(e.xp6(3),e.Oqu(e.lcZ(4,11,"evaluate-absences.header.student")),e.xp6(2),e.Q6J("typeaheadService",s.studentsService)("value",s.filter.student),e.xp6(3),e.Oqu(e.lcZ(9,13,"evaluate-absences.header.module-instance")),e.xp6(2),e.Q6J("typeaheadService",s.educationalEventsService)("value",s.filter.educationalEvent),e.xp6(3),e.Oqu(e.lcZ(14,15,"evaluate-absences.header.study-class")),e.xp6(2),e.Q6J("typeaheadService",s.studyClassesService)("value",s.filter.studyClass)("additionalHttpParams",s.classesHttpFilter),e.xp6(3),e.hij(" ",e.lcZ(19,17,"evaluate-absences.header.show")," "))},directives:[U.t],pipes:[A.X$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1.5rem;border-bottom:1px solid #dee2e6}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.form-group[_ngcontent-%COMP%]{flex:1;min-width:20rem;max-width:40rem;margin-right:1.5rem;margin-bottom:.75rem}.buttons[_ngcontent-%COMP%]{flex:none;margin-top:2.75rem;margin-right:0}@media (max-width: 767.98px){.buttons[_ngcontent-%COMP%]{width:100%;margin-top:1.5rem;margin-bottom:1.5rem}}"],changeDetection:0}),t})();var Q=a(8689),R=a(2925);function k(t,o){if(1&t&&(e.TgZ(0,"a",15),e.ALo(1,"async"),e.TgZ(2,"i",16),e._uU(3,"description"),e.qZA(),e.qZA()),2&t){const n=e.oxw(5);e.Q6J("href",e.lcZ(1,1,n.reportUrl$),e.LSH)}}function w(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"th",17),e.NdJ("click",function(){const r=e.CHM(n).$implicit;return e.oxw(5).state.sortService.toggleSorting(r.key)}),e.TgZ(1,"div",18),e.TgZ(2,"div",19),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"div",20),e._uU(6),e.ALo(7,"async"),e.qZA(),e.qZA(),e.qZA()}if(2&t){const n=o.$implicit,s=e.oxw(5);e.Q6J("ngClass",n.label),e.xp6(3),e.hij(" ",e.lcZ(4,3,"evaluate-absences.list.header."+n.label)," "),e.xp6(3),e.hij(" ",e.lcZ(7,5,s.state.sortService.getSortingChar$(n))," ")}}const H=function(t){return["student",t]},q=function(t){return{returnparams:t}};function B(t,o){if(1&t&&(e.TgZ(0,"a",24),e.ALo(1,"async"),e._uU(2),e.qZA()),2&t){const n=e.oxw().$implicit,s=e.oxw().$implicit,i=e.oxw(6);e.Q6J("routerLink",e.VKq(5,H,s.StudentRef.Id))("queryParams",e.VKq(7,q,e.lcZ(1,3,i.profileReturnParams$))),e.xp6(2),e.hij(" ",s[n.key]," ")}}function j(t,o){if(1&t&&e._uU(0),2&t){const n=e.oxw().$implicit,s=e.oxw().$implicit;e.hij(" ",s[n.key]," ")}}function D(t,o){if(1&t&&(e.TgZ(0,"td"),e.ALo(1,"translate"),e.YNc(2,B,3,9,"a",22),e.YNc(3,j,1,1,"ng-template",null,23,e.W1O),e.qZA()),2&t){const n=o.$implicit,s=e.MAs(4);e.uIk("data-label",e.lcZ(1,3,"evaluate-absences.list.header."+n.label)),e.xp6(2),e.Q6J("ngIf","StudentFullName"===n.key)("ngIfElse",s)}}function W(t,o){if(1&t&&(e.TgZ(0,"tr"),e.YNc(1,D,5,5,"td",21),e.qZA()),2&t){const n=e.oxw(6);e.xp6(1),e.Q6J("ngForOf",n.columns)}}function X(t,o){if(1&t&&(e.TgZ(0,"tbody"),e.YNc(1,W,2,1,"tr",21),e.qZA()),2&t){const n=e.oxw(4).erzLet;e.xp6(1),e.Q6J("ngForOf",n.entries)}}function G(t,o){1&t&&e._UZ(0,"erz-spinner",25)}function K(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"button",26),e.NdJ("click",function(){return e.CHM(n),e.oxw(5).state.nextPage()}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"global.pagination.load-more")," "))}function V(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"div",7),e.TgZ(1,"div",8),e.YNc(2,k,4,3,"a",9),e.ALo(3,"async"),e.qZA(),e.TgZ(4,"table",10),e.NdJ("scrolled",function(){return e.CHM(n),e.oxw(4).onScroll()}),e.TgZ(5,"thead"),e.TgZ(6,"tr"),e.YNc(7,w,8,7,"th",11),e.qZA(),e.qZA(),e.YNc(8,X,2,1,"tbody",12),e.qZA(),e.YNc(9,G,1,0,"erz-spinner",13),e.YNc(10,K,3,3,"button",14),e.qZA()}if(2&t){const n=e.oxw(3).erzLet,s=e.oxw();e.xp6(2),e.Q6J("ngIf",e.lcZ(3,5,s.reportUrl$)),e.xp6(5),e.Q6J("ngForOf",s.columns),e.xp6(1),e.Q6J("ngIf",n.entries&&n.entries.length>0),e.xp6(1),e.Q6J("ngIf",n.loadingPage),e.xp6(1),e.Q6J("ngIf",n.hasMore&&!n.loadingPage)}}function ee(t,o){1&t&&(e.TgZ(0,"p",27),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"evaluate-absences.no-entries")," "))}function te(t,o){if(1&t&&(e.ynx(0),e.YNc(1,V,11,7,"div",5),e.YNc(2,ee,3,3,"ng-template",null,6,e.W1O),e.BQk()),2&t){const n=e.MAs(3),s=e.oxw(2).erzLet;e.xp6(1),e.Q6J("ngIf",s.entries&&s.entries.length>0||s.loadingPage)("ngIfElse",n)}}function ne(t,o){1&t&&e._UZ(0,"erz-spinner")}function se(t,o){if(1&t&&(e.ynx(0),e.YNc(1,te,4,2,"ng-container",2),e.ALo(2,"async"),e.YNc(3,ne,1,0,"ng-template",null,4,e.W1O),e.BQk()),2&t){const n=e.MAs(4),s=e.oxw(2);e.xp6(1),e.Q6J("ngIf",!1===e.lcZ(2,2,s.state.loading$))("ngIfElse",n)}}function ae(t,o){1&t&&(e.TgZ(0,"p",27),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"evaluate-absences.no-filter")))}function oe(t,o){if(1&t){const n=e.EpF();e.ynx(0),e.TgZ(1,"erz-evaluate-absences-header",1),e.NdJ("filterChange",function(i){return e.CHM(n),e.oxw().state.setFilter(i)}),e.ALo(2,"async"),e.qZA(),e.YNc(3,se,5,4,"ng-container",2),e.ALo(4,"async"),e.YNc(5,ae,3,3,"ng-template",null,3,e.W1O),e.BQk()}if(2&t){const n=e.MAs(6),s=e.oxw();e.xp6(1),e.Q6J("filter",e.lcZ(2,3,s.filterFromParams$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,5,s.state.isFilterValid$))("ngIfElse",n)}}const ie=function(t,o,n){return{entries:t,hasMore:o,loadingPage:n}};let re=(()=>{class t{constructor(n,s,i,r,g,f){this.state=n,this.scrollPosition=s,this.route=i,this.presenceTypesService=r,this.reportsService=g,this.lessonPresencesService=f,this.reportUrl$=this.loadReportUrl(),this.columns=[{key:"StudentFullName",label:"student"},{key:"TotalAbsences",label:"total"},{key:"TotalAbsencesValidExcuse",label:"valid-excuse"},{key:"TotalAbsencesWithoutExcuse",label:"without-excuse"},{key:"TotalAbsencesUnconfirmed",label:"unconfirmed"},{key:"TotalIncidents",label:"incident"}],this.filterFromParams$=this.route.queryParams.pipe((0,b.U)(le)),this.profileReturnParams$=this.state.queryParamsString$}ngOnInit(){this.filterFromParams$.pipe((0,P.q)(1)).subscribe(n=>this.state.setFilter(n)),this.presenceTypesService.halfDayActive$.subscribe(n=>{n&&(this.columns=[...this.columns,{key:"TotalHalfDays",label:"halfday"}])})}ngAfterViewInit(){this.scrollPosition.restore()}onScroll(){this.state.nextPage()}loadReportUrl(){return this.state.validFilter$.pipe((0,S.w)(n=>this.lessonPresencesService.getLessonRefs(n)),(0,b.U)(n=>n.length>0?this.reportsService.getEvaluateAbsencesUrl(this.getReportRecordIds(n)):null),(0,F.d)(1))}getReportRecordIds(n){return n.map(s=>`${s.LessonRef.Id}_${s.RegistrationRef.Id}`)}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(d),e.Y36(I.X),e.Y36(l.gz),e.Y36(M.c),e.Y36(O.F),e.Y36(h.q))},t.\u0275cmp=e.Xpm({type:t,selectors:[["erz-evaluate-absences-list"]],decls:4,vars:11,consts:[[4,"erzLet"],[3,"filter","filterChange"],[4,"ngIf","ngIfElse"],["noFilter",""],["loading",""],["class","p-3",4,"ngIf","ngIfElse"],["noEntries",""],[1,"p-3"],[1,"buttons"],["class","report btn btn-primary mb-2","target","_blank",3,"href",4,"ngIf"],["infiniteScroll","",1,"table","table-striped","table-fixed",3,"scrolled"],["scope","col",3,"ngClass","click",4,"ngFor","ngForOf"],[4,"ngIf"],["class","inline",4,"ngIf"],["type","button","class","btn btn-secondary btn-sm d-block mx-auto",3,"click",4,"ngIf"],["target","_blank",1,"report","btn","btn-primary","mb-2",3,"href"],[1,"material-icons"],["scope","col",3,"ngClass","click"],[1,"d-flex"],[1,"column-title"],[1,"sort-direction"],[4,"ngFor","ngForOf"],["class","student",3,"routerLink","queryParams",4,"ngIf","ngIfElse"],["noLink",""],[1,"student",3,"routerLink","queryParams"],[1,"inline"],["type","button",1,"btn","btn-secondary","btn-sm","d-block","mx-auto",3,"click"],[1,"mt-3","px-3"]],template:function(n,s){1&n&&(e.YNc(0,oe,7,7,"ng-container",0),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async")),2&n&&e.Q6J("erzLet",e.kEZ(7,ie,e.lcZ(1,1,s.state.entries$),e.lcZ(2,3,s.state.hasMore$),e.lcZ(3,5,s.state.loadingPage$)))},directives:[$.e,z,c.O5,Q.R,c.sg,c.mk,l.yS,R.O],pipes:[c.Ov,A.X$],styles:["th[_ngcontent-%COMP%]{cursor:pointer}th.student[_ngcontent-%COMP%]{width:30%}.column-title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}a.student[_ngcontent-%COMP%]{color:#33333d}.buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.buttons[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{line-height:1;font-size:2.2rem}"],changeDetection:0}),t})();function le(t){return{student:t.student?Number(t.student):null,educationalEvent:t.educationalEvent?Number(t.educationalEvent):null,studyClass:t.studyClass?Number(t.studyClass):null}}var ce=a(8574),ue=a(5275);const _e=[{path:"",component:L,children:[{path:"",component:re,data:{restoreScrollPositionFrom:["/evaluate-absences/student/:id"]}},{path:"student/:id",children:[{path:"",component:ce.$},{path:"confirm",component:ue.A}]}]}];let de=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[l.Bz.forChild(_e)],l.Bz]}),t})(),ge=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[p.m,de]]}),t})()},1854:(y,u,a)=>{a.d(u,{Z:()=>v});var p=a(7088);const v=function l(m,_){return(0,p.Z)(m,_)}}}]);