import{b as Me}from"./chunk-GZOANHXY.js";import{b as Se}from"./chunk-Y4QYVF5K.js";import{A as fe,a as re,b as le,f as $,g as ce,j as pe,k as de,p as me,q as ue,y as he,z as F}from"./chunk-M3VKTN3S.js";import{a as ve}from"./chunk-USF5QQBL.js";import{i as _e}from"./chunk-QWYAXZZX.js";import"./chunk-KKDVS2NL.js";import"./chunk-WNZFLLQC.js";import{a as be}from"./chunk-M732YBIP.js";import{A as ae,O as ge,Q as ye,s as se}from"./chunk-RYYQAFJB.js";import{Ac as L,Ba as J,Bc as A,Cc as j,E as W,Fb as S,Fc as ie,Hb as y,Jb as b,Lb as Q,Lc as l,Mb as _,Mc as c,Nb as M,Ob as u,Pb as a,Q as q,Qb as s,Rb as g,S as G,X as D,Y as z,_ as N,a as E,aa as w,b as P,bc as X,cd as ne,da as R,dc as x,fb as o,ga as H,h as U,ha as Y,i as K,ie as Ce,je as O,ma as d,o as I,pc as B,rc as h,sc as C,t as v,tc as T,td as oe,ub as m,xc as Z,yc as ee,zc as te}from"./chunk-CHBP6U4G.js";var xe=(()=>{class t{constructor(){this.settings=d(ae),this.storage=d(ve),this.currentRoles=null}getNotificationTypes(){return this.getNotificationTypeKeys().map(e=>{if(!(e in this.settings.notificationTypes))throw new Error(`Key '${e}' is missing in 'notificationTypes' setting`);return{key:e,text:this.settings.notificationTypes[e]}})}getNotificationTypeKeys(){return ge(this.settings.notificationTypesAssignments.reduce((e,{roles:i,types:n})=>this.hasAnyRole(i)?[...e,...n]:e,[]))}hasAnyRole(e){return this.currentRoles===null&&(this.currentRoles=Se(this.storage.getPayload()?.roles)),this.currentRoles.some(i=>e.includes(i))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Y({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Te=(()=>{class t{constructor(){this.id=null,this.label=null,this.disabled=!1,this.value=!1,this.valueChange=new J,this.fallbackId=ye("bkd-switch")}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=m({type:t,selectors:[["bkd-switch"]],inputs:{id:"id",label:"label",disabled:"disabled",value:"value"},outputs:{valueChange:"valueChange"},decls:3,vars:5,consts:[["type","checkbox",3,"ngModelChange","disabled","ngModel"]],template:function(i,n){i&1&&(a(0,"input",0),X("ngModelChange",function(f){return n.valueChange.emit(f)}),s(),a(1,"label"),h(2),s()),i&2&&(u("disabled",n.disabled)("ngModel",n.value),S("id",n.id??n.fallbackId),o(),S("for",n.id??n.fallbackId),o(),C(n.label))},dependencies:[F,le,$,pe],styles:['input[_ngcontent-%COMP%]{opacity:0;position:absolute}label[_ngcontent-%COMP%]{cursor:pointer;text-indent:-9999px;width:36px;height:18px;border:1px solid rgb(0,0,0);background:#fff;display:block;border-radius:18px;position:relative}label[_ngcontent-%COMP%]:after{content:"";position:absolute;top:1px;left:1px;width:14px;height:14px;background:#000;border-radius:14px;transition:.3s}input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{border-color:#000;background:#000}input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:after{left:calc(100% - 1px);transform:translate(-100%);background:#fff}input[_ngcontent-%COMP%]:focus + label[_ngcontent-%COMP%]{box-shadow:0 0 0 .25rem #4e4e4e40}input[_ngcontent-%COMP%]:disabled + label[_ngcontent-%COMP%]{cursor:default;background:#fff;border-color:#dedede}input[_ngcontent-%COMP%]:disabled + label[_ngcontent-%COMP%]:after{background:#dedede}label[_ngcontent-%COMP%]:active:after{width:18.2px}'],changeDetection:0})}}return t})();function Ee(t,r){if(t&1&&(a(0,"div"),h(1),s()),t&2){let e=r.$implicit;o(),T(" ",e," ")}}function Pe(t,r){if(t&1&&(a(0,"div",3),_(1,Ee,2,1,"div",null,Q),s()),t&2){let e=x();o(),M(e.descriptionLines)}}var ke=(()=>{class t{constructor(){this.cd=d(ne),this.id="",this.label="",this.description=null,this.disabled=!1,this.onChange=e=>{},this.onTouched=()=>{},this._value=!1}get value(){return this._value}set value(e){this._value=e,this.onChange(e)}get descriptionLines(){return this.description?this.description.split(`
`):[]}writeValue(e){this._value=e}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled=e,this.cd.markForCheck()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=m({type:t,selectors:[["bkd-my-settings-notifications-toggle"]],inputs:{id:"id",label:"label",description:"description",disabled:"disabled"},features:[ie([{provide:re,useExisting:H(()=>t),multi:!0}])],decls:5,vars:6,consts:[[1,"d-flex","align-items-center"],[1,"flex-fill"],[3,"valueChange","id","value","disabled"],[1,"form-text"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"label",1),h(2),s(),a(3,"bkd-switch",2),te("valueChange",function(f){return ee(n.value,f)||(n.value=f),f}),s()(),y(4,Pe,3,0,"div",3)),i&2&&(o(),S("for",n.id),o(),T(" ",n.label," "),o(),u("id",n.id),Z("value",n.value),u("disabled",n.disabled),o(),b(n.description?4:-1))},dependencies:[Te],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}}return t})();var Ne=(t,r)=>r.key;function Ie(t,r){t&1&&(a(0,"div",2),g(1,"bkd-spinner",5),s())}function Ge(t,r){if(t&1&&(g(0,"bkd-my-settings-notifications-toggle",7),l(1,"async"),l(2,"async")),t&2){let e=r.$implicit,i=r.$index;B("mt-4",i>0),u("id","notification-channels-"+e.key)("label",c(1,6,e.label))("description",c(2,8,e.description))("formControlName",e.key)}}function De(t,r){if(t&1&&(a(0,"form",3),_(1,Ge,3,10,"bkd-my-settings-notifications-toggle",6,Ne),s()),t&2){let e=x(),i=j(0);u("formGroup",i),o(),M(e.channelsSettings)}}function Re(t,r){if(t&1&&(g(0,"bkd-my-settings-notifications-toggle",7),l(1,"async"),l(2,"async")),t&2){let e=r.$implicit,i=r.$index;B("mt-4",i>0),u("id","notification-types-"+e.key)("label",c(1,6,e.label))("description",c(2,8,e.description))("formControlName",e.key)}}function Be(t,r){if(t&1&&(a(0,"form",3),_(1,Re,3,10,"bkd-my-settings-notifications-toggle",6,Ne),s()),t&2){let e=x(),i=j(2);u("formGroup",i),o(),M(e.typesSettings)}}var we=(()=>{class t{constructor(){this.userSettings=d(Me),this.formBuilder=d(he),this.toastService=d(be),this.translate=d(Ce),this.notificationTypes=d(xe),this.channelsSettings=[{key:"gui",label:this.translate.get("my-settings.notifications.gui")},{key:"mail",label:this.translate.get("my-settings.notifications.mail")},{key:"phoneMobile",label:this.translate.get("my-settings.notifications.phoneMobile")}],this.typesSettings=this.notificationTypes.getNotificationTypes().map(e=>{let{label:i,description:n}=this.translate.getCurrentLang()==="fr-CH"?e.text.fr:e.text.de;return{key:e.key,label:I(i),description:I(n)}}),this.channelsValue$=this.userSettings.getNotificationChannels(),this.typesValue$=this.userSettings.getNotificationTypesInactive().pipe(v(this.typesArrayToRecord.bind(this))),this.channelsFormGroup$=this.channelsValue$.pipe(v(e=>this.createFormGroup(this.channelsSettings,e)),D(1)),this.allChannelsInactive$=W(this.channelsValue$,this.channelsFormGroup$.pipe(N(e=>e.valueChanges))).pipe(v(e=>Object.values(e).every(i=>!i)),q()),this.typesFormGroup$=this.typesValue$.pipe(R(this.allChannelsInactive$),v(([e,i])=>this.createFormGroup(this.typesSettings,e,!0,i)),D(1)),this.saving$=new K(!1),this.destroy$=new U}ngOnInit(){this.userSettings.refetch(),this.allChannelsInactive$.pipe(z(1),R(this.typesFormGroup$),w(this.destroy$)).subscribe(([e,i])=>{Object.values(i.controls).forEach(n=>e?n.disable():n.enable())}),this.channelsFormGroup$.pipe(w(this.destroy$),N(e=>e.valueChanges)).subscribe(this.saveChannels.bind(this)),this.typesFormGroup$.pipe(w(this.destroy$),N(e=>e.valueChanges)).subscribe(this.saveTypes.bind(this))}ngOnDestroy(){this.destroy$.next()}createFormGroup(e,i,n=!1,p=!1){return this.formBuilder.group(e.reduce((f,{key:V})=>P(E({},f),{[V]:[{value:i[V]??n,disabled:p}]}),{}))}saveChannels(e){this.saving$.next(!0),this.userSettings.saveNotificationChannels(e).pipe(G(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}saveTypes(e){this.saving$.next(!0),this.userSettings.saveNotificationTypesInactive(this.typesRecordToArray(e)).pipe(G(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("my-settings.notifications.save-success"))}typesArrayToRecord(e){return this.typesSettings.reduce((n,{key:p})=>P(E({},n),{[p]:!e.includes(p)}),{})}typesRecordToArray(e){return Object.keys(e).reduce((n,p)=>e[p]?n:[...n,p],[])}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=m({type:t,selectors:[["bkd-my-settings-notifications"]],decls:17,vars:17,consts:[[1,"pb-4"],[1,"m-0","pb-3","d-flex","align-items-stretch"],[1,"position-relative"],[3,"formGroup"],[1,"mt-4","form-text"],[1,"position-absolute","inline","small","d-inline-block","ms-2"],[3,"id","label","description","formControlName","mt-4"],[3,"id","label","description","formControlName"]],template:function(i,n){if(i&1&&(L(0),l(1,"async"),L(2),l(3,"async"),a(4,"div",0)(5,"h2",1)(6,"span"),h(7),l(8,"translate"),s(),y(9,Ie,2,0,"div",2),l(10,"async"),s(),y(11,De,3,1,"form",3),a(12,"p",4),h(13),l(14,"translate"),s(),g(15,"hr"),y(16,Be,3,1,"form",3),s()),i&2){let p=A(c(1,5,n.channelsFormGroup$));o(2);let f=A(c(3,8,n.typesFormGroup$));o(5),C(c(8,11,"my-settings.notifications.title")),o(2),b(c(10,13,n.saving$)?9:-1),o(2),b(p?11:-1),o(2),T(" ",c(14,15,"my-settings.notifications.privacy-hint")," "),o(3),b(f?16:-1)}},dependencies:[_e,F,de,$,ce,fe,ue,me,ke,oe,O],styles:[".checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important}"],changeDetection:0})}}return t})();var $e=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=m({type:t,selectors:[["bkd-my-settings-show"]],decls:5,vars:3,consts:[[1,"bkd-container","bkd-container-limited"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"h1"),h(2),l(3,"translate"),s(),g(4,"bkd-my-settings-notifications"),s()),i&2&&(o(2),C(c(3,1,"my-settings.title")))},dependencies:[we,O],encapsulation:2})}}return t})();var Fe=(()=>{class t{constructor(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=m({type:t,selectors:[["bkd-my-settings"]],decls:1,vars:0,template:function(i,n){i&1&&g(0,"router-outlet")},dependencies:[se],encapsulation:2,changeDetection:0})}}return t})();var $t=[{path:"",component:Fe,children:[{path:"",component:$e}]}];export{$t as MY_SETTINGS_ROUTES};
