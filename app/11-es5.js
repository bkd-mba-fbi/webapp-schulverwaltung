!function(){function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var c=Object.prototype.toString.call(e).slice(8,-1);"Object"===c&&e.constructor&&(c=e.constructor.name);if("Map"===c||"Set"===c)return Array.from(e);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return t(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,c=new Array(t);n<t;n++)c[n]=e[n];return c}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var c=t[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function i(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function r(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,c=l(e);if(t){var i=l(this).constructor;n=Reflect.construct(c,arguments,i)}else n=c.apply(this,arguments);return o(this,n)}}function o(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{pXY1:function(t,c,a){"use strict";a.r(c),a.d(c,"EditAbsencesModule",function(){return lt});var o,l,b,u,d=a("PCNd"),f=a("tyNb"),p=a("itXk"),h=a("UXun"),g=a("lJxs"),m=a("1G5W"),v=a("v6cN"),y=a("CCnw"),S=a("CqUA"),z=a("KJh6"),O=a("FJ3f"),R=a("eB9A"),I=a("NPit"),k=a("fhBx"),C=a("Xr/R"),$=a("2jKe"),T=a("fXoL"),j=a("ofXK"),P=((o=function(e){s(c,e);var t=r(c);function c(e,i,s,a,r,o){var l;return n(this,c),(l=t.call(this,e,i,s,"/edit-absences")).lessonPresencesService=a,l.presenceTypesService=r,l.dropDownItemsService=o,l.presenceTypes$=l.loadPresenceTypes().pipe(Object(h.a)(1)),l.absenceConfirmationStates$=l.loadAbsenceConfirmationStates().pipe(Object(g.a)(O.b),Object(h.a)(1)),l.presenceControlEntries$=Object(p.a)([l.entries$,l.presenceTypes$,l.absenceConfirmationStates$]).pipe(Object(g.a)(Object(R.a)($.a)),Object(h.a)(1)),l.selected=[],l.queryParamsString$.pipe(Object(m.a)(l.destroy$)).subscribe(function(e){return l.confirmBackLinkParams={returnparams:e}}),l}return i(c,[{key:"resetSelection",value:function(){this.selected=[]}},{key:"getInitialFilter",value:function(){return{student:null,educationalEvent:null,studyClass:null,dateFrom:null,dateTo:null,presenceTypes:null,confirmationStates:null,incidentTypes:null}}},{key:"isValidFilter",value:function(e){return Boolean(e.student||e.educationalEvent||e.studyClass||e.dateFrom||e.dateTo||e.presenceTypes||e.confirmationStates||e.incidentTypes)}},{key:"loadEntries",value:function(e,t,n){return this.loadingService.load(this.lessonPresencesService.getFilteredList(e,n,{sort:"StudentFullName.asc,LessonDateTimeFrom.asc"}),k.a)}},{key:"buildParamsFromFilter",value:function(e){return Object(I.a)(e)}},{key:"loadPresenceTypes",value:function(){return this.loadingService.load(this.presenceTypesService.activePresenceTypes$)}},{key:"loadAbsenceConfirmationStates",value:function(){return this.loadingService.load(this.dropDownItemsService.getAbsenceConfirmationStates())}}]),c}(k.b)).\u0275fac=function(e){return new(e||o)(T.Zb(j.i),T.Zb(S.a),T.Zb(C.a),T.Zb(y.a),T.Zb(z.a),T.Zb(v.a))},o.\u0275prov=T.Ib({token:o,factory:o.\u0275fac}),o),D=a("qUtt"),F=a("0HM3"),E=((l=function(){function e(t){n(this,e),this.state=t}return i(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||l)(T.Mb(P))},l.\u0275cmp=T.Gb({type:l,selectors:[["erz-edit-absences"]],features:[T.yb([P,{provide:D.a,useExisting:P},{provide:F.a,useValue:"/edit-absences"}])],decls:1,vars:0,template:function(e,t){1&e&&T.Nb(0,"router-outlet")},directives:[f.k],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),l),A=a("XNiG"),w=a("IzEk"),x=a("wO+i"),B=a("pLZG"),M=a("ulei"),G=((b=function(e){s(c,e);var t=r(c);function c(){return n(this,c),t.apply(this,arguments)}return c}(M.a)).\u0275fac=function(e){return q(e||b)},b.\u0275prov=T.Ib({token:b,factory:b.\u0275fac}),b),q=T.Ub(G),N=a("yl8S"),L=a("KCaQ"),_=a("K+0v"),V=a("EOpz"),K=a("1kSV"),H=a("M34a"),Z=a("vlqf"),X=a("YDIV"),J=a("PAVU"),U=a("vjgy"),Q=a("mmcK"),Y=a("4vbw"),W=a("sYmb"),ee=a("jSy9"),te=a("DKSB"),ne=a("/N9o"),ce=((u=function(){function e(t,c,i,s,a){var r=this;n(this,e),this.studentsService=t,this.educationalEventsService=c,this.studyClassService=i,this.state=s,this.translate=a,this.filter={student:null,educationalEvent:null,studyClass:null,dateFrom:null,dateTo:null,presenceTypes:null,confirmationStates:null,incidentTypes:null},this.filterChange=new T.n,this.absenceConfirmationStatesGrouped$=this.state.absenceConfirmationStates$.pipe(Object(g.a)(function(e){return Object(J.a)(e,r.translate.instant("shared.multiselect.all-option"))})),this.presenceTypesGrouped$=this.state.presenceTypes$.pipe(Object(g.a)(function(e){return e.filter(Object(_.d)(Z.d)).filter(Object(_.d)(Z.f))}),Object(g.a)(J.c),Object(g.a)(J.b),Object(g.a)(function(e){return Object(J.a)(e,r.translate.instant("shared.multiselect.all-option"))})),this.incidentTypesGrouped$=this.state.presenceTypes$.pipe(Object(g.a)(function(e){return e.filter(Z.f)}),Object(g.a)(J.c),Object(g.a)(J.b),Object(g.a)(function(e){return Object(J.a)(e,r.translate.instant("shared.multiselect.all-option"))})),this.classesHttpFilter={params:{fields:"IsActive","filter.IsActive":"=true"}}}return i(e,[{key:"ngOnInit",value:function(){}},{key:"show",value:function(){this.filterChange.emit(Object.assign(Object.assign({},this.filter),{dateFrom:ie(this.filter.dateFrom),dateTo:ie(this.filter.dateTo)}))}}]),e}()).\u0275fac=function(e){return new(e||u)(T.Mb(Q.a),T.Mb(U.a),T.Mb(Y.a),T.Mb(P),T.Mb(W.d))},u.\u0275cmp=T.Gb({type:u,selectors:[["erz-edit-absences-header"]],inputs:{filter:"filter"},outputs:{filterChange:"filterChange"},features:[T.yb([{provide:K.c,useClass:K.d},{provide:K.e,useClass:X.a}])],decls:49,vars:48,consts:[[1,"filters","mb-2"],[1,"form-group"],[3,"typeaheadService","value","valueChange"],[3,"typeaheadService","value","additionalHttpParams","valueChange"],[3,"value","valueChange"],[1,"filters","mt-2"],[3,"options","values","valuesChange"],[1,"buttons"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(e,t){1&e&&(T.Sb(0,"div",0),T.Sb(1,"div",1),T.Sb(2,"label"),T.Dc(3),T.gc(4,"translate"),T.Rb(),T.Sb(5,"erz-typeahead",2),T.dc("valueChange",function(e){return t.filter.student=e}),T.Rb(),T.Rb(),T.Sb(6,"div",1),T.Sb(7,"label"),T.Dc(8),T.gc(9,"translate"),T.Rb(),T.Sb(10,"erz-typeahead",2),T.dc("valueChange",function(e){return t.filter.educationalEvent=e}),T.Rb(),T.Rb(),T.Sb(11,"div",1),T.Sb(12,"label"),T.Dc(13),T.gc(14,"translate"),T.Rb(),T.Sb(15,"erz-typeahead",3),T.dc("valueChange",function(e){return t.filter.studyClass=e}),T.Rb(),T.Rb(),T.Sb(16,"div",1),T.Sb(17,"label"),T.Dc(18),T.gc(19,"translate"),T.Rb(),T.Sb(20,"erz-date-select",4),T.dc("valueChange",function(e){return t.filter.dateFrom=e}),T.Rb(),T.Rb(),T.Sb(21,"div",1),T.Sb(22,"label"),T.Dc(23),T.gc(24,"translate"),T.Rb(),T.Sb(25,"erz-date-select",4),T.dc("valueChange",function(e){return t.filter.dateTo=e}),T.Rb(),T.Rb(),T.Rb(),T.Sb(26,"div",5),T.Sb(27,"div",1),T.Sb(28,"label"),T.Dc(29),T.gc(30,"translate"),T.Rb(),T.Sb(31,"erz-multiselect",6),T.dc("valuesChange",function(e){return t.filter.confirmationStates=e}),T.gc(32,"async"),T.Rb(),T.Rb(),T.Sb(33,"div",1),T.Sb(34,"label"),T.Dc(35),T.gc(36,"translate"),T.Rb(),T.Sb(37,"erz-multiselect",6),T.dc("valuesChange",function(e){return t.filter.presenceTypes=e}),T.gc(38,"async"),T.Rb(),T.Rb(),T.Sb(39,"div",1),T.Sb(40,"label"),T.Dc(41),T.gc(42,"translate"),T.Rb(),T.Sb(43,"erz-multiselect",6),T.dc("valuesChange",function(e){return t.filter.incidentTypes=e}),T.gc(44,"async"),T.Rb(),T.Rb(),T.Sb(45,"div",7),T.Sb(46,"button",8),T.dc("click",function(){return t.show()}),T.Dc(47),T.gc(48,"translate"),T.Rb(),T.Rb(),T.Rb()),2&e&&(T.zb(3),T.Ec(T.hc(4,24,"edit-absences.header.student")),T.zb(2),T.lc("typeaheadService",t.studentsService)("value",t.filter.student),T.zb(3),T.Ec(T.hc(9,26,"edit-absences.header.module-instance")),T.zb(2),T.lc("typeaheadService",t.educationalEventsService)("value",t.filter.educationalEvent),T.zb(3),T.Ec(T.hc(14,28,"edit-absences.header.study-class")),T.zb(2),T.lc("typeaheadService",t.studyClassService)("value",t.filter.studyClass)("additionalHttpParams",t.classesHttpFilter),T.zb(3),T.Ec(T.hc(19,30,"edit-absences.header.date-from")),T.zb(2),T.lc("value",t.filter.dateFrom),T.zb(3),T.Ec(T.hc(24,32,"edit-absences.header.date-to")),T.zb(2),T.lc("value",t.filter.dateTo),T.zb(4),T.Ec(T.hc(30,34,"edit-absences.header.confirmation-state")),T.zb(2),T.lc("options",T.hc(32,36,t.absenceConfirmationStatesGrouped$))("values",t.filter.confirmationStates),T.zb(4),T.Ec(T.hc(36,38,"edit-absences.header.presence-type")),T.zb(2),T.lc("options",T.hc(38,40,t.presenceTypesGrouped$))("values",t.filter.presenceTypes),T.zb(4),T.Ec(T.hc(42,42,"edit-absences.header.incident")),T.zb(2),T.lc("options",T.hc(44,44,t.incidentTypesGrouped$))("values",t.filter.incidentTypes),T.zb(4),T.Fc(" ",T.hc(48,46,"edit-absences.header.show")," "))},directives:[ee.a,te.a,ne.a],pipes:[W.c,j.b],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1.5rem;border-bottom:1px solid #dee2e6}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.form-group[_ngcontent-%COMP%]{flex:1;min-width:20rem;max-width:40rem;margin-right:1.5rem;margin-bottom:.75rem}.buttons[_ngcontent-%COMP%]{flex:none;margin-top:2.75rem;margin-right:0}@media (max-width:767.98px){.buttons[_ngcontent-%COMP%]{width:100%;margin-top:1.5rem;margin-bottom:1.5rem}}"],changeDetection:0}),u);function ie(e){return e?Object(H.a)(e):null}var se=a("dlKe"),ae=a("4Kj8"),re=function(e){return{count:e}},oe=function(e){return{returnparams:e}};function le(e,t){if(1&e&&(T.Sb(0,"div",12),T.Sb(1,"div",13),T.Dc(2),T.gc(3,"translate"),T.gc(4,"async"),T.gc(5,"translate"),T.Rb(),T.Sb(6,"a",14),T.gc(7,"async"),T.Sb(8,"i",15),T.Dc(9,"edit"),T.Rb(),T.Rb(),T.Rb()),2&e){var n=T.fc(4).erzLet,c=T.fc();T.zb(2),T.Gc(" ",T.ic(3,5,"edit-absences.list.total",T.pc(15,re,T.hc(4,8,c.state.total$)||0)),", ",T.ic(5,10,"edit-absences.list.selected",T.pc(17,re,n.selection.length))," "),T.zb(4),T.Eb("disabled",0===n.selection.length),T.lc("queryParams",T.pc(19,oe,T.hc(7,13,c.state.queryParamsString$)))}}var be=function(e){return["student",e]};function ue(e,t){if(1&e){var n=T.Tb();T.Sb(0,"tr"),T.Sb(1,"td",20),T.dc("click",function(e){T.vc(n);var t=T.uc(3);return T.fc(6).onCheckboxCellClick(e,t)}),T.Sb(2,"input",17,21),T.dc("change",function(){T.vc(n);var e=t.$implicit;return T.fc(6).selectionService.toggle(e.lessonPresence)}),T.gc(4,"async"),T.Rb(),T.Rb(),T.Sb(5,"td",18),T.gc(6,"translate"),T.Sb(7,"span",22),T.Sb(8,"i",15),T.Dc(9),T.Rb(),T.Rb(),T.Rb(),T.Sb(10,"td"),T.gc(11,"translate"),T.Sb(12,"a",23),T.gc(13,"async"),T.Dc(14),T.Rb(),T.Nb(15,"br"),T.Dc(16),T.Rb(),T.Sb(17,"td"),T.gc(18,"translate"),T.Dc(19),T.gc(20,"date"),T.Rb(),T.Sb(21,"td"),T.gc(22,"translate"),T.Dc(23),T.gc(24,"date"),T.gc(25,"date"),T.Rb(),T.Sb(26,"td"),T.gc(27,"translate"),T.Dc(28),T.Rb(),T.Sb(29,"td",24),T.gc(30,"translate"),T.Dc(31),T.Rb(),T.Sb(32,"td"),T.gc(33,"translate"),T.Dc(34),T.Rb(),T.Rb()}if(2&e){var c=t.$implicit,i=T.fc(6);T.zb(2),T.lc("checked",T.hc(4,21,i.selectionService.isSelected$(c.lessonPresence))),T.zb(3),T.Ab("data-label",T.hc(6,23,"edit-absences.list.header.presence")),T.zb(2),T.lc("className",c.presenceCategory),T.zb(2),T.Ec(c.presenceCategoryIcon),T.zb(1),T.Ab("data-label",T.hc(11,25,"edit-absences.list.header.mobil-student-module-instance-study-class")),T.zb(2),T.lc("routerLink",T.pc(48,be,c.lessonPresence.StudentRef.Id))("queryParams",T.pc(50,oe,T.hc(13,27,i.profileReturnParams$))),T.zb(2),T.Fc(" ",c.lessonPresence.StudentFullName," "),T.zb(2),T.Gc(" ",c.lessonPresence.EventDesignation,", ",c.lessonPresence.StudyClassNumber," "),T.zb(1),T.Ab("data-label",T.hc(18,29,"edit-absences.list.header.date")),T.zb(2),T.Fc(" ",T.ic(20,31,c.lessonPresence.LessonDateTimeFrom,"mediumDate")," "),T.zb(2),T.Ab("data-label",T.hc(22,34,"edit-absences.list.header.time")),T.zb(2),T.Gc(" ",T.ic(24,36,c.lessonPresence.LessonDateTimeFrom,"shortTime"),"\u2013",T.ic(25,39,c.lessonPresence.LessonDateTimeTo,"shortTime")," "),T.zb(3),T.Ab("data-label",T.hc(27,42,"edit-absences.list.header.confirmation-state")),T.zb(2),T.Fc(" ",null==c.confirmationState?null:c.confirmationState.Value," "),T.zb(1),T.Ab("data-label",T.hc(30,44,"edit-absences.list.header.mobil-presence-type-incident")),T.zb(2),T.Fc(" ",null==c.presenceType?null:c.presenceType.Designation," "),T.zb(1),T.Ab("data-label",T.hc(33,46,"edit-absences.list.header.teacher")),T.zb(2),T.Fc(" ",c.lessonPresence.TeacherInformation," ")}}function de(e,t){if(1&e){var n=T.Tb();T.Sb(0,"table",16),T.Sb(1,"thead"),T.Sb(2,"tr"),T.Sb(3,"th"),T.Sb(4,"input",17),T.dc("change",function(e){return T.vc(n),T.fc(5).toggleAll(e.currentTarget.checked)}),T.Rb(),T.Rb(),T.Sb(5,"th",18),T.Dc(6),T.gc(7,"translate"),T.Rb(),T.Sb(8,"th"),T.Dc(9),T.gc(10,"translate"),T.Nb(11,"br"),T.Dc(12),T.gc(13,"translate"),T.gc(14,"translate"),T.Rb(),T.Sb(15,"th"),T.Dc(16),T.gc(17,"translate"),T.Rb(),T.Sb(18,"th"),T.Dc(19),T.gc(20,"translate"),T.Rb(),T.Sb(21,"th"),T.Dc(22),T.gc(23,"translate"),T.Rb(),T.Sb(24,"th"),T.Dc(25),T.gc(26,"translate"),T.gc(27,"translate"),T.Rb(),T.Sb(28,"th"),T.Dc(29),T.gc(30,"translate"),T.Rb(),T.Rb(),T.Rb(),T.Sb(31,"tbody"),T.Bc(32,ue,35,52,"tr",19),T.Rb(),T.Rb()}if(2&e){var c=T.fc(4).erzLet;T.zb(4),T.lc("checked",c.selection.length===c.entries.length),T.zb(2),T.Fc(" ",T.hc(7,12,"edit-absences.list.header.presence")," "),T.zb(3),T.Fc(" ",T.hc(10,14,"edit-absences.list.header.student")," "),T.zb(3),T.Gc(" ",T.hc(13,16,"edit-absences.list.header.module-instance"),", ",T.hc(14,18,"edit-absences.list.header.study-class")," "),T.zb(4),T.Fc(" ",T.hc(17,20,"edit-absences.list.header.date")," "),T.zb(3),T.Ec(T.hc(20,22,"edit-absences.list.header.time")),T.zb(3),T.Fc(" ",T.hc(23,24,"edit-absences.list.header.confirmation-state")," "),T.zb(3),T.Gc(" ",T.hc(26,26,"edit-absences.list.header.presence-type")," / ",T.hc(27,28,"edit-absences.list.header.incident")," "),T.zb(4),T.Ec(T.hc(30,30,"edit-absences.list.header.teacher")),T.zb(3),T.lc("ngForOf",c.entries)}}function fe(e,t){1&e&&T.Nb(0,"erz-spinner",25)}function pe(e,t){if(1&e){var n=T.Tb();T.Sb(0,"button",26),T.dc("click",function(){return T.vc(n),T.fc(5).state.nextPage()}),T.Dc(1),T.gc(2,"translate"),T.Rb()}2&e&&(T.zb(1),T.Fc(" ",T.hc(2,1,"global.pagination.load-more")," "))}function he(e,t){if(1&e){var n=T.Tb();T.Sb(0,"div",7),T.dc("scrolled",function(){return T.vc(n),T.fc(4).onScroll()}),T.Bc(1,le,10,21,"div",8),T.Bc(2,de,33,32,"table",9),T.Bc(3,fe,1,0,"erz-spinner",10),T.Bc(4,pe,3,3,"button",11),T.Rb()}if(2&e){var c=T.fc(3).erzLet;T.zb(1),T.lc("ngIf",c.entries&&c.entries.length>0),T.zb(1),T.lc("ngIf",c.entries&&c.entries.length>0),T.zb(1),T.lc("ngIf",c.loadingPage),T.zb(1),T.lc("ngIf",c.hasMore&&!c.loadingPage)}}function ge(e,t){1&e&&(T.Sb(0,"p",27),T.Dc(1),T.gc(2,"translate"),T.Rb()),2&e&&(T.zb(1),T.Ec(T.hc(2,1,"edit-absences.no-entries")))}function me(e,t){if(1&e&&(T.Qb(0),T.Bc(1,he,5,4,"div",5),T.Bc(2,ge,3,3,"ng-template",null,6,T.Cc),T.Pb()),2&e){var n=T.uc(3),c=T.fc(2).erzLet;T.zb(1),T.lc("ngIf",c.entries&&c.entries.length>0||c.loadingPage)("ngIfElse",n)}}function ve(e,t){1&e&&T.Nb(0,"erz-spinner")}function ye(e,t){if(1&e&&(T.Qb(0),T.Bc(1,me,4,2,"ng-container",2),T.gc(2,"async"),T.Bc(3,ve,1,0,"ng-template",null,4,T.Cc),T.Pb()),2&e){var n=T.uc(4),c=T.fc(2);T.zb(1),T.lc("ngIf",!T.hc(2,2,c.state.loading$))("ngIfElse",n)}}function Se(e,t){1&e&&(T.Sb(0,"p",27),T.Dc(1),T.gc(2,"translate"),T.Rb()),2&e&&(T.zb(1),T.Ec(T.hc(2,1,"edit-absences.no-filter")))}function ze(e,t){if(1&e){var n=T.Tb();T.Qb(0),T.Sb(1,"erz-edit-absences-header",1),T.dc("filterChange",function(e){return T.vc(n),T.fc().state.setFilter(e)}),T.gc(2,"async"),T.Rb(),T.Bc(3,ye,5,4,"ng-container",2),T.gc(4,"async"),T.Bc(5,Se,3,3,"ng-template",null,3,T.Cc),T.Pb()}if(2&e){var c=T.uc(6),i=T.fc();T.zb(1),T.lc("filter",T.hc(2,3,i.filterFromParams$)),T.zb(2),T.lc("ngIf",T.hc(4,5,i.state.isFilterValid$))("ngIfElse",c)}}var Oe,Re=function(e,t,n,c){return{selection:e,entries:t,hasMore:n,loadingPage:c}},Ie=((Oe=function(){function e(t,c,i,s){n(this,e),this.state=t,this.selectionService=c,this.scrollPosition=i,this.route=s,this.filterFromParams$=this.route.queryParams.pipe(Object(g.a)(ke)),this.profileReturnParams$=this.state.queryParamsString$,this.destroy$=new A.a}return i(e,[{key:"ngOnInit",value:function(){var e=this;this.filterFromParams$.pipe(Object(w.a)(1)).subscribe(function(t){return e.state.setFilter(t)}),this.state.validFilter$.pipe(Object(m.a)(this.destroy$)).subscribe(function(){return e.selectionService.clear()}),this.selectionService.selection$.pipe(Object(m.a)(this.destroy$)).subscribe(function(t){return e.state.selected=t}),this.route.queryParams.pipe(Object(w.a)(1),Object(x.a)("reload"),Object(B.a)(_.b)).subscribe(function(){return e.state.resetEntries()})}},{key:"ngAfterViewInit",value:function(){this.scrollPosition.restore()}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"toggleAll",value:function(e){var t=this;this.state.entries$.pipe(Object(w.a)(1)).subscribe(function(n){return t.selectionService.clear(e?n:null)})}},{key:"onCheckboxCellClick",value:function(e,t){e.target!==t&&t.click()}},{key:"onScroll",value:function(){this.state.nextPage()}}]),e}()).\u0275fac=function(e){return new(e||Oe)(T.Mb(P),T.Mb(G),T.Mb(N.a),T.Mb(f.a))},Oe.\u0275cmp=T.Gb({type:Oe,selectors:[["erz-edit-absences-list"]],features:[T.yb([G])],decls:5,vars:14,consts:[[4,"erzLet"],[3,"filter","filterChange"],[4,"ngIf","ngIfElse"],["noFilter",""],["loading",""],["class","p-3","infiniteScroll","",3,"scrolled",4,"ngIf","ngIfElse"],["noEntries",""],["infiniteScroll","",1,"p-3",3,"scrolled"],["class","d-flex align-items-center justify-content-between",4,"ngIf"],["class","table table-striped",4,"ngIf"],["class","inline",4,"ngIf"],["type","button","class","btn btn-secondary btn-sm d-block mx-auto",3,"click",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between"],[1,"total"],["routerLink","/edit-absences/edit",1,"edit","btn","btn-primary","mt-1","mb-2",3,"queryParams"],[1,"material-icons"],[1,"table","table-striped"],["type","checkbox",3,"checked","change"],[1,"presence-category"],[4,"ngFor","ngForOf"],[1,"edit-absences-checkbox",3,"click"],["checkbox",""],[3,"className"],[1,"student",3,"routerLink","queryParams"],[1,"designation-incident"],[1,"inline"],["type","button",1,"btn","btn-secondary","btn-sm","d-block","mx-auto",3,"click"],[1,"mt-3","px-3"]],template:function(e,t){1&e&&(T.Bc(0,ze,7,7,"ng-container",0),T.gc(1,"async"),T.gc(2,"async"),T.gc(3,"async"),T.gc(4,"async")),2&e&&T.lc("erzLet",T.sc(9,Re,T.hc(1,1,t.selectionService.selection$),T.hc(2,3,t.state.presenceControlEntries$),T.hc(3,5,t.state.hasMore$),T.hc(4,7,t.state.loadingPage$)))},directives:[V.a,ce,j.m,se.a,f.i,j.l,ae.a],pipes:[j.b,W.c,j.e],styles:[".edit[_ngcontent-%COMP%]{line-height:1;font-size:2.2rem}.presence-category[_ngcontent-%COMP%]{text-align:center}.presence-category[_ngcontent-%COMP%]   .absent[_ngcontent-%COMP%]{color:#dc3545}.presence-category[_ngcontent-%COMP%]   .present[_ngcontent-%COMP%]{color:#28a745}.presence-category[_ngcontent-%COMP%]   .unapproved[_ngcontent-%COMP%]{color:#ffa814}.designation-incident[_ngcontent-%COMP%]{max-width:50ch}.student[_ngcontent-%COMP%]{color:#33333d}@media screen and (max-width:820px){.edit-absences-checkbox[_ngcontent-%COMP%]{text-align:left}.presence-category[_ngcontent-%COMP%]{text-align:right}.designation-incident[_ngcontent-%COMP%]{max-width:none}}"],changeDetection:0}),Oe);function ke(e){return{student:e.student?Number(e.student):null,educationalEvent:e.educationalEvent?Number(e.educationalEvent):null,studyClass:e.studyClass?Number(e.studyClass):null,dateFrom:e.dateFrom?Object(L.c)(e.dateFrom):null,dateTo:e.dateTo?Object(L.c)(e.dateTo):null,presenceTypes:e.presenceTypes?e.presenceTypes.split(",").map(Number):null,confirmationStates:e.confirmationStates?e.confirmationStates.split(",").map(Number):null,incidentTypes:e.incidentTypes?e.incidentTypes.split(",").map(Number):null}}var Ce,$e=a("3Pt+"),Te=a("2Vo4"),je=a("eIep"),Pe=a("nYR2"),De=a("BeL+"),Fe=a("CqXF"),Ee=a("LpL1"),Ae=a("IClS"),we=function(e){return e.Absent="absent",e.Dispensation="dispensation",e.HalfDay="half-day",e.Incident="incident",e.Present="present",e}({}),xe=((Ce=function(){function t(e,c){n(this,t),this.updateService=e,this.settings=c}return i(t,[{key:"update",value:function(e,t,n,c,i,s){var a=[];switch(n){case we.Present:a=this.createResetBulkRequests(e);break;case we.Absent:a=this.createAbsentEditBulkRequests(e,t,c,i);break;case we.Dispensation:a=this.createEditBulkRequests(e,null,this.settings.dispensationPresenceTypeId);break;case we.HalfDay:a=this.createEditBulkRequests(e,null,this.settings.halfDayPresenceTypeId);break;case we.Incident:a=this.createEditBulkRequests(e,null,s)}return Object(p.a)(a).pipe(Object(Fe.a)(void 0))}},{key:"createAbsentEditBulkRequests",value:function(t,n,c,i){return c===this.settings.excusedAbsenceStateId?this.createEditBulkRequests(t,c,i):c===this.settings.unexcusedAbsenceStateId?this.createEditBulkRequests(t,c,this.settings.absencePresenceTypeId):[].concat(e(this.createEditBulkRequests(t.filter(Be(n,this.settings)),c,this.settings.absencePresenceTypeId)),e(this.createEditBulkRequests(t.filter(Object(_.d)(Be(n,this.settings))),c,null)))}},{key:"createResetBulkRequests",value:function(e){var t=this;return Object(Ae.a)(e).map(function(e){var n=e.lessonIds,c=e.personIds;return t.updateService.removeLessonPresences(n,c)})}},{key:"createEditBulkRequests",value:function(e,t,n){var c=this;return Object(Ae.a)(e).map(function(e){var i=e.lessonIds,s=e.personIds;return c.updateService.editLessonPresences(i,s,n||void 0,t||void 0)})}}]),t}()).\u0275fac=function(e){return new(e||Ce)(T.Zb(Ee.a),T.Zb(C.a))},Ce.\u0275prov=T.Ib({token:Ce,factory:Ce.\u0275fac,providedIn:"root"}),Ce);function Be(e,t){return function(n){var c=e.find(function(e){return e.Id===n.TypeRef.Id});return!c||c.Id===t.dispensationPresenceTypeId||c.Id===t.halfDayPresenceTypeId||c.IsIncident}}var Me=a("A6ef"),Ge=a("AEFh"),qe=a("5eHb");function Ne(e,t){if(1&e&&(T.Sb(0,"div",11),T.Dc(1),T.gc(2,"translate"),T.Rb()),2&e){var n=t.$implicit;T.zb(1),T.Fc(" ",T.ic(2,1,"global.validation-errors."+n.error,n.params)," ")}}function Le(e,t){if(1&e&&(T.Sb(0,"option",23),T.Dc(1),T.Rb()),2&e){var n=t.$implicit;T.lc("ngValue",n.Id),T.zb(1),T.Fc(" ",n.Designation," ")}}function _e(e,t){if(1&e&&(T.Sb(0,"select",22),T.gc(1,"async"),T.Sb(2,"option",23),T.Dc(3),T.gc(4,"translate"),T.Rb(),T.Bc(5,Le,2,2,"option",24),T.gc(6,"async"),T.Rb()),2&e){var n=T.fc(6);T.Eb("is-invalid",T.hc(1,5,n.absenceTypeIdErrors$).length>0),T.zb(2),T.lc("ngValue",null),T.zb(1),T.Fc(" ",T.hc(4,7,"edit-absences.edit.absence-type-placeholder")," "),T.zb(2),T.lc("ngForOf",T.hc(6,9,n.absenceTypes$))}}function Ve(e,t){if(1&e&&(T.Sb(0,"div",25),T.Dc(1),T.gc(2,"translate"),T.Rb()),2&e){var n=t.$implicit;T.zb(1),T.Fc(" ",T.ic(2,1,"global.validation-errors."+n.error,n.params)," ")}}function Ke(e,t){if(1&e&&(T.Sb(0,"div",18),T.Nb(1,"input",19),T.Sb(2,"label",14),T.Dc(3),T.Rb(),T.Bc(4,_e,7,11,"select",20),T.Bc(5,Ve,3,4,"div",21),T.gc(6,"async"),T.Rb()),2&e){var n=t.$implicit,c=T.fc(5);T.zb(1),T.lc("id","state-"+n.Key)("value",n.Key),T.zb(1),T.mc("for","state-"+n.Key),T.zb(1),T.Fc(" ",n.Value," "),T.zb(1),T.lc("ngIf",c.isExcused(n)),T.zb(1),T.lc("ngForOf",T.hc(6,6,c.absenceTypeIdErrors$))}}function He(e,t){if(1&e&&(T.Sb(0,"div",16),T.Bc(1,Ke,7,8,"div",17),T.Rb()),2&e){var n=T.fc(3).erzLet;T.zb(1),T.lc("ngForOf",n.confirmationStates)}}function Ze(e,t){if(1&e&&(T.Sb(0,"option",23),T.Dc(1),T.Rb()),2&e){var n=t.$implicit;T.lc("ngValue",n.Id),T.zb(1),T.Fc(" ",n.Designation," ")}}function Xe(e,t){if(1&e&&(T.Sb(0,"div",25),T.Dc(1),T.gc(2,"translate"),T.Rb()),2&e){var n=t.$implicit;T.zb(1),T.Fc(" ",T.ic(2,1,"global.validation-errors."+n.error,n.params)," ")}}function Je(e,t){if(1&e&&(T.Sb(0,"div",16),T.Sb(1,"select",26),T.gc(2,"async"),T.Sb(3,"option",23),T.Dc(4),T.gc(5,"translate"),T.Rb(),T.Bc(6,Ze,2,2,"option",24),T.gc(7,"async"),T.Rb(),T.Bc(8,Xe,3,4,"div",21),T.gc(9,"async"),T.Rb()),2&e){var n=T.fc(4);T.zb(1),T.Eb("is-invalid",T.hc(2,6,n.incidentIdErrors$).length>0),T.zb(2),T.lc("ngValue",null),T.zb(1),T.Fc(" ",T.hc(5,8,"edit-absences.edit.incident-placeholder")," "),T.zb(2),T.lc("ngForOf",T.hc(7,10,n.incidents$)),T.zb(2),T.lc("ngForOf",T.hc(9,12,n.incidentIdErrors$))}}function Ue(e,t){if(1&e&&(T.Sb(0,"div",12),T.Nb(1,"input",13),T.Sb(2,"label",14),T.Dc(3),T.gc(4,"translate"),T.Rb(),T.Bc(5,He,2,1,"div",15),T.Bc(6,Je,10,14,"div",15),T.Rb()),2&e){var n=t.$implicit,c=T.fc(3);T.zb(1),T.lc("id","category-"+n)("value",n),T.zb(1),T.mc("for","category-"+n),T.zb(1),T.Fc(" ",T.hc(4,6,"edit-absences.edit.categories."+n)," "),T.zb(2),T.lc("ngIf",c.isAbsent(n)),T.zb(1),T.lc("ngIf",c.isIncident(n))}}function Qe(e,t){1&e&&(T.Sb(0,"div",27),T.Sb(1,"span",28),T.Dc(2,"Loading..."),T.Rb(),T.Rb())}function Ye(e,t){if(1&e){var n=T.Tb();T.Sb(0,"form",3),T.dc("ngSubmit",function(){return T.vc(n),T.fc(2).onSubmit()}),T.Bc(1,Ne,3,4,"div",4),T.gc(2,"async"),T.Sb(3,"div",5),T.Bc(4,Ue,7,8,"div",6),T.Rb(),T.Sb(5,"div",7),T.Sb(6,"button",8),T.dc("click",function(){return T.vc(n),T.fc(2).cancel()}),T.gc(7,"async"),T.Dc(8),T.gc(9,"translate"),T.Rb(),T.Sb(10,"button",9),T.gc(11,"async"),T.Dc(12),T.gc(13,"translate"),T.Bc(14,Qe,3,0,"div",10),T.gc(15,"async"),T.Rb(),T.Rb(),T.Rb()}if(2&e){var c=T.fc().erzLet,i=T.fc();T.lc("formGroup",c.formGroup),T.zb(1),T.lc("ngForOf",T.hc(2,8,i.formErrors$)),T.zb(3),T.lc("ngForOf",c.categories),T.zb(2),T.lc("disabled",T.hc(7,10,i.saving$)),T.zb(2),T.Fc(" ",T.hc(9,12,"edit-absences.edit.cancel")," "),T.zb(2),T.lc("disabled",T.hc(11,14,i.saving$)),T.zb(2),T.Fc(" ",T.hc(13,16,"edit-absences.edit.save")," "),T.zb(2),T.lc("ngIf",T.hc(15,18,i.saving$))}}function We(e,t){if(1&e&&(T.Sb(0,"div",1),T.Bc(1,Ye,16,20,"form",2),T.Rb()),2&e){var n=t.erzLet;T.zb(1),T.lc("ngIf",n.formGroup&&n.confirmationStates)}}var et,tt,nt,ct=function(e,t,n){return{confirmationStates:e,categories:t,formGroup:n}},it=((et=function(){function e(t,c,i,s,a,r,o,l,b,u){var d=this;n(this,e),this.fb=t,this.router=c,this.route=i,this.toastr=s,this.translate=a,this.state=r,this.dropDownItemsService=o,this.presenceTypesService=l,this.updateService=b,this.settings=u,this.absenceTypes$=this.presenceTypesService.confirmationTypes$,this.incidents$=this.presenceTypesService.incidentTypes$,this.formGroup$=this.createFormGroup(),this.saving$=new Te.a(!1),this.submitted$=new Te.a(!1),this.formErrors$=Object(Me.c)(this.formGroup$,this.submitted$),this.absenceTypeIdErrors$=Object(Me.c)(this.formGroup$,this.submitted$,"absenceTypeId"),this.incidentIdErrors$=Object(Me.c)(this.formGroup$,this.submitted$,"incidentId"),this.availableCategories=[we.Absent,we.Dispensation,we.HalfDay,we.Incident,we.Present],this.confirmationStates$=this.dropDownItemsService.getAbsenceConfirmationStates().pipe(Object(g.a)(this.sortAbsenceConfirmationStates.bind(this)),Object(h.a)(1)),this.activeCategories$=this.presenceTypesService.halfDayActive$.pipe(Object(g.a)(function(e){return e?d.availableCategories:d.availableCategories.filter(function(e){return e!==we.HalfDay})})),this.destroy$=new A.a}return i(e,[{key:"ngOnInit",value:function(){0===this.state.selected.length&&this.navigateBack(),Object(Me.b)(this.formGroup$,"category").pipe(Object(m.a)(this.destroy$)).subscribe(this.updateConfirmationValueDisabled.bind(this)),Object(Me.b)(this.formGroup$,"confirmationValue").pipe(Object(m.a)(this.destroy$)).subscribe(this.updateAbsenceTypeIdDisabled.bind(this))}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"isAbsent",value:function(e){return e===we.Absent}},{key:"isExcused",value:function(e){return e.Key===this.settings.excusedAbsenceStateId}},{key:"isIncident",value:function(e){return e===we.Incident}},{key:"onSubmit",value:function(){var e=this;this.submitted$.next(!0),this.formGroup$.pipe(Object(w.a)(1)).subscribe(function(t){t.valid&&e.save(t)})}},{key:"cancel",value:function(){this.navigateBack()}},{key:"createFormGroup",value:function(){var e=this;return this.getInitialAbsenceTypeId().pipe(Object(g.a)(function(t){return e.fb.group({category:[we.Absent,$e.q.required],confirmationValue:[e.settings.excusedAbsenceStateId,$e.q.required],absenceTypeId:[t,$e.q.required],incidentId:[{value:null,disabled:!0},$e.q.required]})}),Object(h.a)(1))}},{key:"getInitialAbsenceTypeId",value:function(){var e=this;return this.absenceTypes$.pipe(Object(w.a)(1),Object(g.a)(function(t){var n=t.map(function(e){return e.Id}),c=Object(De.a)(e.state.selected.map(function(e){return e.TypeRef.Id}));return 1===c.length&&null!=c[0]&&n.includes(c[0])?c[0]:null}))}},{key:"updateConfirmationValueDisabled",value:function(){var e=this;this.formGroup$.pipe(Object(w.a)(1)).subscribe(function(t){var n=t.get("category"),c=t.get("confirmationValue"),i=t.get("absenceTypeId"),s=t.get("incidentId");n&&c&&i&&s&&(n.value===we.Absent?(c.enable(),e.updateAbsenceTypeIdDisabled()):(c.disable(),i.disable()),n.value===we.Incident?s.enable():s.disable())})}},{key:"updateAbsenceTypeIdDisabled",value:function(){var e=this;this.formGroup$.pipe(Object(w.a)(1)).subscribe(function(t){var n=t.get("confirmationValue"),c=t.get("absenceTypeId");n&&c&&(n.value===e.settings.excusedAbsenceStateId?c.enable():c.disable())})}},{key:"save",value:function(e){var t=this;this.saving$.next(!0);var n=e.value,c=n.category,i=n.confirmationValue,s=n.absenceTypeId,a=n.incidentId;this.presenceTypesService.presenceTypes$.pipe(Object(je.a)(function(e){return t.updateService.update(t.state.selected,e,c,i,s,a)}),Object(Pe.a)(function(){return t.saving$.next(!1)})).subscribe(this.onSaveSuccess.bind(this))}},{key:"onSaveSuccess",value:function(){this.state.resetSelection(),this.toastr.success(this.translate.instant("edit-absences.edit.save-success")),this.navigateBack(!0)}},{key:"navigateBack",value:function(e){var t=this;this.route.queryParams.pipe(Object(w.a)(1)).subscribe(function(n){t.router.navigate(["/edit-absences"],{queryParams:Object.assign(Object.assign({},Object(Ge.b)(n.returnparams)),{reload:e})})})}},{key:"sortAbsenceConfirmationStates",value:function(e){var t=this;return e.slice().sort(function(e,n){return e.Key===t.settings.excusedAbsenceStateId?-1:n.Key===t.settings.excusedAbsenceStateId?1:e.Value.localeCompare(n.Value)})}}]),e}()).\u0275fac=function(e){return new(e||et)(T.Mb($e.c),T.Mb(f.g),T.Mb(f.a),T.Mb(qe.b),T.Mb(W.d),T.Mb(P),T.Mb(v.a),T.Mb(z.a),T.Mb(xe),T.Mb(C.a))},et.\u0275cmp=T.Gb({type:et,selectors:[["erz-edit-absences-edit"]],decls:4,vars:11,consts:[["class","erz-container erz-container-limited erz-container-padding-y",4,"erzLet"],[1,"erz-container","erz-container-limited","erz-container-padding-y"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"formGroup","ngSubmit"],["class","alert alert-danger",4,"ngFor","ngForOf"],[1,"form-group","pb-4"],["class","form-check mt-2 mb-3",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],["type","submit",1,"btn","btn-primary","ml-2",3,"disabled"],["class","spinner-border spinner-border-sm align-middle","role","status",4,"ngIf"],[1,"alert","alert-danger"],[1,"form-check","mt-2","mb-3"],["type","radio","formControlName","category",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"],["class","ml-5",4,"ngIf"],[1,"ml-5"],["class","form-check mt-2 mb-2",4,"ngFor","ngForOf"],[1,"form-check","mt-2","mb-2"],["type","radio","formControlName","confirmationValue",1,"form-check-input",3,"id","value"],["class","form-control mt-1","formControlName","absenceTypeId",3,"is-invalid",4,"ngIf"],["class","invalid-feedback",4,"ngFor","ngForOf"],["formControlName","absenceTypeId",1,"form-control","mt-1"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"invalid-feedback"],["formControlName","incidentId",1,"form-control","mt-1"],["role","status",1,"spinner-border","spinner-border-sm","align-middle"],[1,"sr-only"]],template:function(e,t){1&e&&(T.Bc(0,We,2,1,"div",0),T.gc(1,"async"),T.gc(2,"async"),T.gc(3,"async")),2&e&&T.lc("erzLet",T.rc(7,ct,T.hc(1,1,t.confirmationStates$),T.hc(2,3,t.activeCategories$),T.hc(3,5,t.formGroup$)))},directives:[V.a,j.m,$e.r,$e.j,$e.e,j.l,$e.n,$e.b,$e.i,$e.d,$e.p,$e.m,$e.s],pipes:[j.b,W.c],styles:[""],changeDetection:0}),et),st=a("ccj6"),at=a("hH5/"),rt=[{path:"",component:E,children:[{path:"",component:Ie,data:{restoreScrollPositionFrom:["/edit-absences/edit","/edit-absences/student/:id"]}},{path:"edit",component:it},{path:"student/:id",children:[{path:"",component:st.a},{path:"confirm",component:at.a}]}]}],ot=((nt=function e(){n(this,e)}).\u0275fac=function(e){return new(e||nt)},nt.\u0275mod=T.Kb({type:nt}),nt.\u0275inj=T.Jb({imports:[[f.j.forChild(rt)],f.j]}),nt),lt=((tt=function e(){n(this,e)}).\u0275fac=function(e){return new(e||tt)},tt.\u0275mod=T.Kb({type:tt}),tt.\u0275inj=T.Jb({imports:[[d.a,ot]]}),tt)}}])}();