"use strict";(self.webpackChunkwebapp_schulverwaltung=self.webpackChunkwebapp_schulverwaltung||[]).push([[917],{9917:(N,h,o)=>{o.r(h),o.d(h,{MySettingsModule:()=>W});var d=o(6482),p=o(3519),t=o(4650),g=o(9646),Z=o(6451),x=o(1135),b=o(7579),m=o(4004),S=o(4782),y=o(3900),C=o(2722),T=o(8746),F=o(8623),l=o(4006),A=o(1443),M=o(6188),$=o(6569),z=o(8029),L=o(5060),G=o(1303);let O=(()=>{class n{constructor(e,i){this.settings=e,this.storage=i,this.currentRoles=null}getNotificationTypes(){return this.getNotificationTypeKeys().map(e=>{if(!(e in this.settings.notificationTypes))throw new Error(`Key '${e}' is missing in 'notificationTypes' setting`);return{key:e,text:this.settings.notificationTypes[e]}})}getNotificationTypeKeys(){return(0,$.Z)(this.settings.notificationTypesAssignments.reduce((e,{roles:i,types:a})=>this.hasAnyRole(i)?[...e,...a]:e,[]))}hasAnyRole(e){return null===this.currentRoles&&(this.currentRoles=(0,L.F)(this.storage.getPayload()?.roles)),this.currentRoles.some(i=>e.includes(i))}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(z.L6),t.LFG(G.V))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var u=o(6895),J=o(1104),U=o(2925),R=o(6755);function I(n,s){if(1&n&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&n){const e=s.$implicit;t.xp6(1),t.hij(" ",e," ")}}function Y(n,s){if(1&n&&(t.TgZ(0,"div",4),t.YNc(1,I,2,1,"div",5),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.descriptionLines)}}let w=(()=>{class n{constructor(){this.id="",this.label="",this.description=null,this.disabled=!1,this.onChange=e=>{},this.onTouched=()=>{},this._value=!1}get value(){return this._value}set value(e){this._value=e,this.onChange(e)}get descriptionLines(){return this.description?this.description.split("\n"):[]}writeValue(e){this._value=e}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled=e}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-my-settings-notifications-toggle"]],inputs:{id:"id",label:"label",description:"description",disabled:"disabled"},features:[t._Bn([{provide:l.JU,useExisting:(0,t.Gpc)(()=>n),multi:!0}])],decls:5,vars:6,consts:[[1,"d-flex","align-items-center"],[1,"flex-fill"],[3,"id","value","disabled","valueChange"],["class","form-text",4,"ngIf"],[1,"form-text"],[4,"ngFor","ngForOf"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"label",1),t._uU(2),t.qZA(),t.TgZ(3,"erz-switch",2),t.NdJ("valueChange",function(r){return i.value=r}),t.qZA()(),t.YNc(4,Y,2,1,"div",3)),2&e&&(t.xp6(1),t.uIk("for",i.id),t.xp6(1),t.hij(" ",i.label," "),t.xp6(1),t.Q6J("id",i.id)("value",i.value)("disabled",i.disabled),t.xp6(1),t.Q6J("ngIf",i.description))},dependencies:[u.sg,u.O5,R.q],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),n})();function Q(n,s){1&n&&(t.TgZ(0,"div",6),t._UZ(1,"erz-spinner",7),t.qZA())}function j(n,s){if(1&n&&(t._UZ(0,"erz-my-settings-notifications-toggle",10),t.ALo(1,"async"),t.ALo(2,"async")),2&n){const e=s.$implicit;t.ekj("mt-4",s.index>0),t.Q6J("id","notification-channels-"+e.key)("label",t.lcZ(1,6,e.label))("description",t.lcZ(2,8,e.description))("formControlName",e.key)}}function B(n,s){if(1&n&&(t.TgZ(0,"form",8),t.YNc(1,j,3,10,"erz-my-settings-notifications-toggle",9),t.qZA()),2&n){const e=t.oxw().erzLet,i=t.oxw();t.Q6J("formGroup",e.channelsFormGroup),t.xp6(1),t.Q6J("ngForOf",i.channelsSettings)}}function E(n,s){if(1&n&&(t._UZ(0,"erz-my-settings-notifications-toggle",12),t.ALo(1,"async"),t.ALo(2,"async")),2&n){const e=s.$implicit,i=s.index,a=t.oxw(2).erzLet;t.ekj("mt-4",i>0),t.Q6J("id","notification-types-"+e.key)("label",t.lcZ(1,7,e.label))("description",t.lcZ(2,9,e.description))("formControlName",e.key)("disabled",a.allChannelsInactive)}}function D(n,s){if(1&n&&(t.TgZ(0,"form",8),t.YNc(1,E,3,11,"erz-my-settings-notifications-toggle",11),t.qZA()),2&n){const e=t.oxw().erzLet,i=t.oxw();t.Q6J("formGroup",e.typesFormGroup),t.xp6(1),t.Q6J("ngForOf",i.typesSettings)}}function P(n,s){if(1&n&&(t.TgZ(0,"div",1)(1,"h5",2)(2,"span"),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.YNc(5,Q,2,0,"div",3),t.ALo(6,"async"),t.qZA(),t.YNc(7,B,2,2,"form",4),t.TgZ(8,"p",5),t._uU(9),t.ALo(10,"translate"),t.qZA(),t._UZ(11,"hr"),t.YNc(12,D,2,2,"form",4),t.qZA()),2&n){const e=s.erzLet,i=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,5,"my-settings.notifications.title")),t.xp6(2),t.Q6J("ngIf",t.lcZ(6,7,i.saving$)),t.xp6(2),t.Q6J("ngIf",e.channelsFormGroup),t.xp6(2),t.hij(" ",t.lcZ(10,9,"my-settings.notifications.privacy-hint")," "),t.xp6(3),t.Q6J("ngIf",e.typesFormGroup)}}const V=function(n,s,e){return{channelsFormGroup:n,typesFormGroup:s,allChannelsInactive:e}};let X=(()=>{class n{constructor(e,i,a,r,f){this.userSettings=e,this.formBuilder=i,this.toastService=a,this.translate=r,this.notificationTypes=f,this.channelsSettings=[{key:"gui",label:this.translate.get("my-settings.notifications.gui")},{key:"mail",label:this.translate.get("my-settings.notifications.mail")},{key:"phoneMobile",label:this.translate.get("my-settings.notifications.phoneMobile")}],this.typesSettings=this.notificationTypes.getNotificationTypes().map(c=>{const{label:v,description:H}="fr"===this.translate.currentLang?c.text.fr:c.text.de;return{key:c.key,label:(0,g.of)(v),description:(0,g.of)(H)}}),this.channelsValue$=this.userSettings.getNotificationChannels(),this.typesValue$=this.userSettings.getNotificationTypesInactive().pipe((0,m.U)(this.typesArrayToRecord.bind(this))),this.channelsFormGroup$=this.channelsValue$.pipe((0,m.U)(c=>this.createFormGroup(this.channelsSettings,c)),(0,S.d)(1)),this.allChannelsInactive$=(0,Z.T)(this.channelsValue$,this.channelsFormGroup$.pipe((0,y.w)(c=>c.valueChanges))).pipe((0,m.U)(c=>Object.values(c).every(v=>!v))),this.typesFormGroup$=this.typesValue$.pipe((0,m.U)(c=>this.createFormGroup(this.typesSettings,c,!0)),(0,S.d)(1)),this.saving$=new x.X(!1),this.destroy$=new b.x}ngOnInit(){this.userSettings.refetch(),this.channelsFormGroup$.pipe((0,C.R)(this.destroy$),(0,y.w)(e=>e.valueChanges)).subscribe(this.saveChannels.bind(this)),this.typesFormGroup$.pipe((0,C.R)(this.destroy$),(0,y.w)(e=>e.valueChanges)).subscribe(this.saveTypes.bind(this))}ngOnDestroy(){this.destroy$.next()}createFormGroup(e,i,a=!1){return this.formBuilder.group(e.reduce((r,{key:f})=>({...r,[f]:[i[f]??a]}),{}))}saveChannels(e){this.saving$.next(!0),this.userSettings.saveNotificationChannels(e).pipe((0,T.x)(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}saveTypes(e){this.saving$.next(!0),this.userSettings.saveNotificationTypesInactive(this.typesRecordToArray(e)).pipe((0,T.x)(()=>this.saving$.next(!1))).subscribe(this.onSaveSuccess.bind(this))}onSaveSuccess(){this.toastService.success(this.translate.instant("my-settings.notifications.save-success"))}typesArrayToRecord(e){return this.typesSettings.reduce((a,{key:r})=>({...a,[r]:!e.includes(r)}),{})}typesRecordToArray(e){return Object.keys(e).reduce((a,r)=>e[r]?a:[...a,r],[])}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(F.s),t.Y36(l.QS),t.Y36(A.k),t.Y36(M.sK),t.Y36(O))},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-my-settings-notifications"]],decls:4,vars:11,consts:[["class","pb-4",4,"erzLet"],[1,"pb-4"],[1,"m-0","pb-3","d-flex","align-items-stretch"],["class","position-relative",4,"ngIf"],[3,"formGroup",4,"ngIf"],[1,"mt-4","form-text"],[1,"position-relative"],[1,"position-absolute","inline","small","d-inline-block","ms-2"],[3,"formGroup"],[3,"id","label","description","formControlName","mt-4",4,"ngFor","ngForOf"],[3,"id","label","description","formControlName"],[3,"id","label","description","formControlName","mt-4","disabled",4,"ngFor","ngForOf"],[3,"id","label","description","formControlName","disabled"]],template:function(e,i){1&e&&(t.YNc(0,P,13,11,"div",0),t.ALo(1,"async"),t.ALo(2,"async"),t.ALo(3,"async")),2&e&&t.Q6J("erzLet",t.kEZ(7,V,t.lcZ(1,1,i.channelsFormGroup$),t.lcZ(2,3,i.typesFormGroup$),t.lcZ(3,5,i.allChannelsInactive$)))},dependencies:[u.sg,u.O5,l._Y,l.JJ,l.JL,l.sg,l.u,J.e,U.O,w,u.Ov,M.X$],styles:[".checkbox[_ngcontent-%COMP%]   input.form-check-input[_ngcontent-%COMP%]{position:static!important;margin:0!important}"],changeDetection:0}),n})();const K=[{path:"",component:(()=>{class n{constructor(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-my-settings"]],decls:1,vars:0,template:function(e,i){1&e&&t._UZ(0,"router-outlet")},dependencies:[p.lC],changeDetection:0}),n})(),children:[{path:"",component:(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["erz-my-settings-show"]],decls:2,vars:0,consts:[[1,"erz-container","erz-container-limited","erz-container-padding-y"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"erz-my-settings-notifications"),t.qZA())},dependencies:[X]}),n})()}]}];let _=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[p.Bz.forChild(K),p.Bz]}),n})(),W=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[d.m,_]}),n})()},6569:(N,h,o)=>{o.d(h,{Z:()=>t});var d=o(2374);const t=function p(g){return g&&g.length?(0,d.Z)(g):[]}}}]);